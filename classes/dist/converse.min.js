/*! For license information please see converse.min.js.LICENSE.txt */
(()=>{var e,t,n,r,i={33:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},134:(e,t,n)=>{var r=n(4776),i=n(3884);e.exports=function(e,t,n,s,o){return new i(r().w(e,t,n,s),o||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},152:e=>{e.exports=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},182:(e,t,n)=>{var r=n(5361);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},216:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>GH});var r={};n.r(r),n.d(r,{isError:()=>Gr,isErrorObject:()=>Kr,isFunction:()=>Wr,isPersistableModel:()=>Jr,isUndefined:()=>Vr,merge:()=>Hr});var i={};n.r(i),n.d(i,{clearSession:()=>ci,getUnloadEvent:()=>ii,isTestEnv:()=>ri,isUniView:()=>ni,replacePromise:()=>si,shouldClearCache:()=>oi,tearDown:()=>ai});var s={};n.r(s),n.d(s,{ACTIVE:()=>so,ANONYMOUS:()=>Js,BOSH_WAIT:()=>qs,CHATROOMS_TYPE:()=>uo,CHAT_STATES:()=>go,CLOSED:()=>Ys,COMPOSING:()=>oo,CONNECTION_STATUS:()=>po,CONTROLBOX_TYPE:()=>fo,CORE_PLUGINS:()=>mo,EXTERNAL:()=>Xs,FAILURE:()=>ro,GONE:()=>co,HEADLINES_TYPE:()=>ho,INACTIVE:()=>io,KEYCODES:()=>yo,LOGIN:()=>Qs,LOGOUT:()=>Zs,MARKER_TYPES:()=>vo,METADATA_ATTRIBUTES:()=>Ks,OPENED:()=>eo,PAUSED:()=>ao,PREBIND:()=>to,PRES_SHOW_VALUES:()=>Gs,PRES_TYPE_VALUES:()=>Ws,PRIVATE_CHAT_TYPE:()=>lo,STATUS_WEIGHTS:()=>Vs,SUCCESS:()=>no,VERSION_NAME:()=>Hs,XFORM_TYPE_MAP:()=>bo,XFORM_VALIDATE_TYPE_MAP:()=>_o});var o={};n.r(o),n.d(o,{createStore:()=>tl,getDefaultStore:()=>Zc,initStorage:()=>nl});var a={};n.r(a),n.d(a,{getJIDFromURI:()=>cl,isOwnJID:()=>ll,isSameBareJID:()=>ol,isSameDomain:()=>al,isValidJID:()=>il,isValidMUCJID:()=>sl});var c={};n.r(c),n.d(c,{attemptNonPreboundSession:()=>Sl,cleanup:()=>_l,initClientConfig:()=>fl,initPersistentStorage:()=>ml,initPlugins:()=>hl,initSession:()=>yl,initSessionStorage:()=>pl,registerGlobalEventHandlers:()=>bl,safeSave:()=>jl,savedLoginInfo:()=>xl,setUserJID:()=>vl});var l={};n.r(l),n.d(l,{debounce:()=>Il,getOpenPromise:()=>ue,waitUntil:()=>Dl});var u={};n.r(u),n.d(u,{BadRequestError:()=>Fl,ConflictError:()=>ql,FeatureNotImplementedError:()=>Hl,ForbiddenError:()=>Gl,GoneError:()=>Wl,InternalServerError:()=>Vl,ItemNotFoundError:()=>Kl,JIDMalformedError:()=>Jl,MethodNotImplementedError:()=>zl,NotAcceptableError:()=>Yl,NotAllowedError:()=>Xl,NotAuthorizedError:()=>Ql,PaymentRequiredError:()=>Zl,RecipientUnavailableError:()=>eu,RedirectError:()=>tu,RegistrationRequiredError:()=>nu,RemoteServerNotFoundError:()=>ru,RemoteServerTimeoutError:()=>iu,ResourceConstraintError:()=>su,ServiceUnavailableError:()=>ou,StanzaError:()=>Ul,StanzaParseError:()=>Bl,SubscriptionRequiredError:()=>au,TimeoutError:()=>Ll,UndefinedConditionError:()=>cu,UnexpectedRequestError:()=>lu});var d={};n.r(d),n.d(d,{decodeHTMLEntities:()=>ih,isElement:()=>Qd,isTagEqual:()=>Zd,queryChildren:()=>th,siblingIndex:()=>nh,stringToElement:()=>eh});var h={};n.r(h),n.d(h,{getAttributes:()=>ch,isErrorStanza:()=>sh,isForbiddenError:()=>oh,isServiceUnavailableError:()=>ah,toStanza:()=>Fs});var f={};n.r(f),n.d(f,{unique:()=>Hf});var p={};n.r(p),n.d(p,{appendArrayBuffer:()=>Gf,arrayBufferToBase64:()=>Jf,arrayBufferToHex:()=>Wf,arrayBufferToString:()=>Vf,base64ToArrayBuffer:()=>Yf,hexToArrayBuffer:()=>Xf,stringToArrayBuffer:()=>Kf});var m={};n.r(m),n.d(m,{colorize:()=>tp});var g={};n.r(g),n.d(g,{getCurrentWord:()=>op,getSelectValues:()=>ip,isMentionBoundary:()=>ap,placeCaretAtEnd:()=>lp,replaceCurrentWord:()=>cp,webForm2xForm:()=>sp});var v={};n.r(v),n.d(v,{firstCharToUpperCase:()=>up,getLongestSubstring:()=>dp,isString:()=>hp});var y={};n.r(y),n.d(y,{addMediaURLsOffset:()=>Ip,checkFileTypes:()=>Sp,getHeaders:()=>kp,getMediaURLs:()=>Mp,getMediaURLsMetadata:()=>Np,getMetadataForURL:()=>Tp,getURL:()=>wp,isAudioURL:()=>jp,isEncryptedFileURL:()=>Op,isGIFURL:()=>Ap,isImageURL:()=>Ep,isURLWithImageExtension:()=>xp,isValidURL:()=>_p,isVideoURL:()=>$p,withinString:()=>Cp});var b={};n.r(b),n.d(b,{ACTION_INFO_CODES:()=>nv,ADMIN_COMMANDS:()=>iv,AFFILIATIONS:()=>sv,AFFILIATION_CHANGES:()=>fv,AFFILIATION_CHANGES_LIST:()=>pv,DISCONNECT_CODES:()=>ov,INFO_CODES:()=>bv,MODERATOR_COMMANDS:()=>av,MUC_NICK_CHANGED_CODE:()=>Sv,MUC_ROLE_CHANGES:()=>vv,MUC_ROLE_CHANGES_LIST:()=>yv,MUC_ROLE_WEIGHTS:()=>hv,MUC_TRAFFIC_STATES:()=>mv,MUC_TRAFFIC_STATES_LIST:()=>gv,NEW_NICK_CODES:()=>rv,OWNER_COMMANDS:()=>cv,ROLES:()=>lv,ROOMSTATUS:()=>_v,ROOM_FEATURES:()=>wv,STATUS_CODE_STANZAS:()=>dv,VISITOR_COMMANDS:()=>uv});var _={};n.r(_),n.d(_,{addClass:()=>sj,ancestor:()=>cj,default:()=>gj,getFileName:()=>nj,getHyperlinkTemplate:()=>lj,getNameAndValue:()=>tj,getOuterWidth:()=>fj,getRootElement:()=>mj,hasClass:()=>ij,removeClass:()=>oj,removeElement:()=>aj,slideIn:()=>dj,slideOut:()=>uj,xFormField2TemplateResult:()=>hj});var w={};n.r(w),n.d(w,{afterMain:()=>Bj,afterRead:()=>zj,afterWrite:()=>Hj,applyStyles:()=>Xj,arrow:()=>v$,auto:()=>$j,basePlacements:()=>Ej,beforeMain:()=>Lj,beforeRead:()=>Dj,beforeWrite:()=>Fj,bottom:()=>xj,clippingParents:()=>kj,computeStyles:()=>w$,createPopper:()=>X$,createPopperBase:()=>Y$,createPopperLite:()=>Q$,detectOverflow:()=>R$,end:()=>Cj,eventListeners:()=>x$,flip:()=>z$,hide:()=>B$,left:()=>jj,main:()=>Uj,modifierPhases:()=>Gj,offset:()=>F$,placements:()=>Pj,popper:()=>Nj,popperGenerator:()=>J$,popperOffsets:()=>q$,preventOverflow:()=>H$,read:()=>Rj,reference:()=>Mj,right:()=>Aj,start:()=>Oj,top:()=>Sj,variationPlacements:()=>Ij,viewport:()=>Tj,write:()=>qj});var S={};n.r(S),n.d(S,{getAuthorStyle:()=>eC});var x={};n.r(x),n.d(x,{MIMETYPES_MAP:()=>sC,compressImage:()=>aC,isImageWithAlphaChannel:()=>oC});var A={};n.r(A),n.d(A,{filterQueryParamsFromURL:()=>hC,isDomainAllowed:()=>lC,isDomainWhitelisted:()=>cC,isMediaURLDomainAllowed:()=>uC,shouldRenderMediaFromURL:()=>dC});var j=n(5072),$=n.n(j),E=n(7825),O=n.n(E),C=n(7659),k=n.n(C),T=n(5056),N=n.n(T),M=n(540),I=n.n(M),P=n(1113),D=n.n(P),R=n(845),z={};z.styleTagTransform=D(),z.setAttributes=N(),z.insert=k().bind(null,"head"),z.domAPI=O(),z.insertStyleElement=I();$()(R.A,z);R.A&&R.A.locals&&R.A.locals;var L,U,B,F,q=n(3968),H=n.n(q),G=n(2978),W=n.n(G),V=n(9144),K=n.n(V);const J={debug:0,info:1,warn:2,error:3,fatal:4},Y=Object.assign({debug:(null===(L=console)||void 0===L?void 0:L.log)?console.log.bind(console):function(){},error:(null===(U=console)||void 0===U?void 0:U.log)?console.log.bind(console):function(){},info:(null===(B=console)||void 0===B?void 0:B.log)?console.log.bind(console):function(){},warn:(null===(F=console)||void 0===F?void 0:F.log)?console.log.bind(console):function(){}},console),X={loglevel:"info",setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t,n=""){if(J[t]<J[this.loglevel])return;var r;"error"===t||"fatal"===t?n=n||"color: maroon":"debug"===t&&(n=n||"color: green"),e instanceof Error?e=e.stack:((r=e)instanceof Element||r instanceof Document)&&(e=e.outerHTML);const i=n?"%c":"";"error"===t?Y.error(`${i} ERROR: ${e}`,n):"warn"===t?Y.warn(`${i} ${(new Date).toISOString()} WARNING: ${e}`,n):"fatal"===t?Y.error(`${i} FATAL: ${e}`,n):"debug"===t?Y.debug(`${i} ${(new Date).toISOString()} DEBUG: ${e}`,n):Y.info(`${i} ${(new Date).toISOString()} INFO: ${e}`,n)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}};const Q=X;var Z=n(5357),ee=n.n(Z),te=n(7181);function ne(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const re={initialize(){return(e=function*(){},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){ne(s,r,i,o,a,"next",e)}function a(e){ne(s,r,i,o,a,"throw",e)}o(void 0)}))})();var e},__:(...e)=>(0,te.sprintf)(...e)};function ie(e,t,n,r,...i){return"function"==typeof n&&(void 0===this.__super__&&(this.__super__=r),this.__super__[e]=n.bind(this)),t.apply(this,i)}class se{_overrideAttribute(e,t){const n=t.overrides[e];if("function"==typeof n){const t={};t[this.name]=this.plugged;const r=this.plugged[e];this.plugged[e]=function(...i){return ie.apply(this,[e,n,r,t,...i])}}else this.plugged[e]=n}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[n,r]of Object.entries(t))if("events"===n)e.prototype[n]=Object.assign(r,e.prototype[n]);else if("function"==typeof r){const t={};t[this.name]=this.plugged;const i=e.prototype[n];e.prototype[n]=function(...e){return ie.apply(this,[n,r,i,t,...e])}}else e.prototype[n]=r}loadPluginDependencies(e){var t;null===(t=e.dependencies)||void 0===t||t.forEach((t=>{const n=this.plugins[t];if(n){var r;if(null===(r=n.dependencies)||void 0===r?void 0:r.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(n)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const n=e.overrides[t];"object"==typeof n?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)}))}initializePlugin(e){var t;Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||(null===(t=e.enabled)||void 0===t?void 0:t.call(e,this.plugged))||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(e={},t=[],n=[]){if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,r]of Object.entries(this.plugins))t.length&&!t.includes(e)||n.includes(e)||(this.allowed_plugins[e]=r);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}}const oe={enable:function(e,t,n){return void 0===n&&(n="pluginSocket"),void 0===t&&(t="plugged"),e[n]=new se(e,t),e}};var ae=n(1263);function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function le(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ue(){let e,t=()=>{},n=()=>{};if("function"==typeof Promise.withResolvers){const{promise:r,resolve:i,reject:s}=Promise.withResolvers();e=r,t=i,n=s}else e=new Promise(((e,r)=>{t=e,n=r}));return Object.assign(e,le(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ce(e,t,n[t])}))}return e}({},{isResolved:!1,isPending:!0,isRejected:!1}),{resolve:t,reject:n})),e.then((t=>(e.isResolved=!0,e.isPending=!1,e.isRejected=!1,t)),(t=>{throw e.isResolved=!1,e.isPending=!1,e.isRejected=!0,t})),e}const de=function(){this.__data__=[],this.size=0};const he=function(e,t){return e===t||e!=e&&t!=t};const fe=function(e,t){for(var n=e.length;n--;)if(he(e[n][0],t))return n;return-1};var pe=Array.prototype.splice;const me=function(e){var t=this.__data__,n=fe(t,e);return!(n<0)&&(n==t.length-1?t.pop():pe.call(t,n,1),--this.size,!0)};const ge=function(e){var t=this.__data__,n=fe(t,e);return n<0?void 0:t[n][1]};const ve=function(e){return fe(this.__data__,e)>-1};const ye=function(e,t){var n=this.__data__,r=fe(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function be(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}be.prototype.clear=de,be.prototype.delete=me,be.prototype.get=ge,be.prototype.has=ve,be.prototype.set=ye;const _e=be;const we=function(){this.__data__=new _e,this.size=0};const Se=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const xe=function(e){return this.__data__.get(e)};const Ae=function(e){return this.__data__.has(e)};const je="object"==typeof global&&global&&global.Object===Object&&global;var $e="object"==typeof self&&self&&self.Object===Object&&self;const Ee=je||$e||Function("return this")();const Oe=Ee.Symbol;var Ce=Object.prototype,ke=Ce.hasOwnProperty,Te=Ce.toString,Ne=Oe?Oe.toStringTag:void 0;const Me=function(e){var t=ke.call(e,Ne),n=e[Ne];try{e[Ne]=void 0;var r=!0}catch(e){}var i=Te.call(e);return r&&(t?e[Ne]=n:delete e[Ne]),i};var Ie=Object.prototype.toString;const Pe=function(e){return Ie.call(e)};var De=Oe?Oe.toStringTag:void 0;const Re=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":De&&De in Object(e)?Me(e):Pe(e)};const ze=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const Le=function(e){if(!ze(e))return!1;var t=Re(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const Ue=Ee["__core-js_shared__"];var Be,Fe=(Be=/[^.]+$/.exec(Ue&&Ue.keys&&Ue.keys.IE_PROTO||""))?"Symbol(src)_1."+Be:"";const qe=function(e){return!!Fe&&Fe in e};var He=Function.prototype.toString;const Ge=function(e){if(null!=e){try{return He.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var We=/^\[object .+?Constructor\]$/,Ve=Function.prototype,Ke=Object.prototype,Je=Ve.toString,Ye=Ke.hasOwnProperty,Xe=RegExp("^"+Je.call(Ye).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Qe=function(e){return!(!ze(e)||qe(e))&&(Le(e)?Xe:We).test(Ge(e))};const Ze=function(e,t){return null==e?void 0:e[t]};const et=function(e,t){var n=Ze(e,t);return Qe(n)?n:void 0};const tt=et(Ee,"Map");const nt=et(Object,"create");const rt=function(){this.__data__=nt?nt(null):{},this.size=0};const it=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var st=Object.prototype.hasOwnProperty;const ot=function(e){var t=this.__data__;if(nt){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return st.call(t,e)?t[e]:void 0};var at=Object.prototype.hasOwnProperty;const ct=function(e){var t=this.__data__;return nt?void 0!==t[e]:at.call(t,e)};const lt=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=nt&&void 0===t?"__lodash_hash_undefined__":t,this};function ut(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ut.prototype.clear=rt,ut.prototype.delete=it,ut.prototype.get=ot,ut.prototype.has=ct,ut.prototype.set=lt;const dt=ut;const ht=function(){this.size=0,this.__data__={hash:new dt,map:new(tt||_e),string:new dt}};const ft=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const pt=function(e,t){var n=e.__data__;return ft(t)?n["string"==typeof t?"string":"hash"]:n.map};const mt=function(e){var t=pt(this,e).delete(e);return this.size-=t?1:0,t};const gt=function(e){return pt(this,e).get(e)};const vt=function(e){return pt(this,e).has(e)};const yt=function(e,t){var n=pt(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function bt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bt.prototype.clear=ht,bt.prototype.delete=mt,bt.prototype.get=gt,bt.prototype.has=vt,bt.prototype.set=yt;const _t=bt;const wt=function(e,t){var n=this.__data__;if(n instanceof _e){var r=n.__data__;if(!tt||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new _t(r)}return n.set(e,t),this.size=n.size,this};function St(e){var t=this.__data__=new _e(e);this.size=t.size}St.prototype.clear=we,St.prototype.delete=Se,St.prototype.get=xe,St.prototype.has=Ae,St.prototype.set=wt;const xt=St;const At=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const jt=function(e){return this.__data__.has(e)};function $t(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new _t;++t<n;)this.add(e[t])}$t.prototype.add=$t.prototype.push=At,$t.prototype.has=jt;const Et=$t;const Ot=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};const Ct=function(e,t){return e.has(t)};const kt=function(e,t,n,r,i,s){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var d=-1,h=!0,f=2&n?new Et:void 0;for(s.set(e,t),s.set(t,e);++d<a;){var p=e[d],m=t[d];if(r)var g=o?r(m,p,d,t,e,s):r(p,m,d,e,t,s);if(void 0!==g){if(g)continue;h=!1;break}if(f){if(!Ot(t,(function(e,t){if(!Ct(f,t)&&(p===e||i(p,e,n,r,s)))return f.push(t)}))){h=!1;break}}else if(p!==m&&!i(p,m,n,r,s)){h=!1;break}}return s.delete(e),s.delete(t),h};const Tt=Ee.Uint8Array;const Nt=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n};const Mt=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var It=Oe?Oe.prototype:void 0,Pt=It?It.valueOf:void 0;const Dt=function(e,t,n,r,i,s,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new Tt(e),new Tt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return he(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Nt;case"[object Set]":var c=1&r;if(a||(a=Mt),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=2,o.set(e,t);var u=kt(a(e),a(t),r,i,s,o);return o.delete(e),u;case"[object Symbol]":if(Pt)return Pt.call(e)==Pt.call(t)}return!1};const Rt=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e};const zt=Array.isArray;const Lt=function(e,t,n){var r=t(e);return zt(e)?r:Rt(r,n(e))};const Ut=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s};const Bt=function(){return[]};var Ft=Object.prototype.propertyIsEnumerable,qt=Object.getOwnPropertySymbols;const Ht=qt?function(e){return null==e?[]:(e=Object(e),Ut(qt(e),(function(t){return Ft.call(e,t)})))}:Bt;const Gt=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};const Wt=function(e){return null!=e&&"object"==typeof e};const Vt=function(e){return Wt(e)&&"[object Arguments]"==Re(e)};var Kt=Object.prototype,Jt=Kt.hasOwnProperty,Yt=Kt.propertyIsEnumerable;const Xt=Vt(function(){return arguments}())?Vt:function(e){return Wt(e)&&Jt.call(e,"callee")&&!Yt.call(e,"callee")};const Qt=function(){return!1};var Zt="object"==typeof exports&&exports&&!exports.nodeType&&exports,en=Zt&&"object"==typeof module&&module&&!module.nodeType&&module,tn=en&&en.exports===Zt?Ee.Buffer:void 0;const nn=(tn?tn.isBuffer:void 0)||Qt;var rn=/^(?:0|[1-9]\d*)$/;const sn=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&rn.test(e))&&e>-1&&e%1==0&&e<t};const on=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var an={};an["[object Float32Array]"]=an["[object Float64Array]"]=an["[object Int8Array]"]=an["[object Int16Array]"]=an["[object Int32Array]"]=an["[object Uint8Array]"]=an["[object Uint8ClampedArray]"]=an["[object Uint16Array]"]=an["[object Uint32Array]"]=!0,an["[object Arguments]"]=an["[object Array]"]=an["[object ArrayBuffer]"]=an["[object Boolean]"]=an["[object DataView]"]=an["[object Date]"]=an["[object Error]"]=an["[object Function]"]=an["[object Map]"]=an["[object Number]"]=an["[object Object]"]=an["[object RegExp]"]=an["[object Set]"]=an["[object String]"]=an["[object WeakMap]"]=!1;const cn=function(e){return Wt(e)&&on(e.length)&&!!an[Re(e)]};const ln=function(e){return function(t){return e(t)}};var un="object"==typeof exports&&exports&&!exports.nodeType&&exports,dn=un&&"object"==typeof module&&module&&!module.nodeType&&module,hn=dn&&dn.exports===un&&je.process;const fn=function(){try{var e=dn&&dn.require&&dn.require("util").types;return e||hn&&hn.binding&&hn.binding("util")}catch(e){}}();var pn=fn&&fn.isTypedArray;const mn=pn?ln(pn):cn;var gn=Object.prototype.hasOwnProperty;const vn=function(e,t){var n=zt(e),r=!n&&Xt(e),i=!n&&!r&&nn(e),s=!n&&!r&&!i&&mn(e),o=n||r||i||s,a=o?Gt(e.length,String):[],c=a.length;for(var l in e)!t&&!gn.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||sn(l,c))||a.push(l);return a};var yn=Object.prototype;const bn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||yn)};const _n=function(e,t){return function(n){return e(t(n))}};const wn=_n(Object.keys,Object);var Sn=Object.prototype.hasOwnProperty;const xn=function(e){if(!bn(e))return wn(e);var t=[];for(var n in Object(e))Sn.call(e,n)&&"constructor"!=n&&t.push(n);return t};const An=function(e){return null!=e&&on(e.length)&&!Le(e)};const jn=function(e){return An(e)?vn(e):xn(e)};const $n=function(e){return Lt(e,jn,Ht)};var En=Object.prototype.hasOwnProperty;const On=function(e,t,n,r,i,s){var o=1&n,a=$n(e),c=a.length;if(c!=$n(t).length&&!o)return!1;for(var l=c;l--;){var u=a[l];if(!(o?u in t:En.call(t,u)))return!1}var d=s.get(e),h=s.get(t);if(d&&h)return d==t&&h==e;var f=!0;s.set(e,t),s.set(t,e);for(var p=o;++l<c;){var m=e[u=a[l]],g=t[u];if(r)var v=o?r(g,m,u,t,e,s):r(m,g,u,e,t,s);if(!(void 0===v?m===g||i(m,g,n,r,s):v)){f=!1;break}p||(p="constructor"==u)}if(f&&!p){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(f=!1)}return s.delete(e),s.delete(t),f};const Cn=et(Ee,"DataView");const kn=et(Ee,"Promise");const Tn=et(Ee,"Set");const Nn=et(Ee,"WeakMap");var Mn="[object Map]",In="[object Promise]",Pn="[object Set]",Dn="[object WeakMap]",Rn="[object DataView]",zn=Ge(Cn),Ln=Ge(tt),Un=Ge(kn),Bn=Ge(Tn),Fn=Ge(Nn),qn=Re;(Cn&&qn(new Cn(new ArrayBuffer(1)))!=Rn||tt&&qn(new tt)!=Mn||kn&&qn(kn.resolve())!=In||Tn&&qn(new Tn)!=Pn||Nn&&qn(new Nn)!=Dn)&&(qn=function(e){var t=Re(e),n="[object Object]"==t?e.constructor:void 0,r=n?Ge(n):"";if(r)switch(r){case zn:return Rn;case Ln:return Mn;case Un:return In;case Bn:return Pn;case Fn:return Dn}return t});const Hn=qn;var Gn="[object Arguments]",Wn="[object Array]",Vn="[object Object]",Kn=Object.prototype.hasOwnProperty;const Jn=function(e,t,n,r,i,s){var o=zt(e),a=zt(t),c=o?Wn:Hn(e),l=a?Wn:Hn(t),u=(c=c==Gn?Vn:c)==Vn,d=(l=l==Gn?Vn:l)==Vn,h=c==l;if(h&&nn(e)){if(!nn(t))return!1;o=!0,u=!1}if(h&&!u)return s||(s=new xt),o||mn(e)?kt(e,t,n,r,i,s):Dt(e,t,c,n,r,i,s);if(!(1&n)){var f=u&&Kn.call(e,"__wrapped__"),p=d&&Kn.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,g=p?t.value():t;return s||(s=new xt),i(m,g,n,r,s)}}return!!h&&(s||(s=new xt),On(e,t,n,r,i,s))};const Yn=function e(t,n,r,i,s){return t===n||(null==t||null==n||!Wt(t)&&!Wt(n)?t!=t&&n!=n:Jn(t,n,r,i,e,s))};const Xn=function(e,t){return Yn(e,t)};const Qn=function(e){return"symbol"==typeof e||Wt(e)&&"[object Symbol]"==Re(e)};var Zn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,er=/^\w*$/;const tr=function(e,t){if(zt(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Qn(e))||(er.test(e)||!Zn.test(e)||null!=t&&e in Object(t))};function nr(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(nr.Cache||_t),n}nr.Cache=_t;const rr=nr;const ir=function(e){var t=rr(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t};var sr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,or=/\\(\\)?/g;const ar=ir((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(sr,(function(e,n,r,i){t.push(r?i.replace(or,"$1"):n||e)})),t}));const cr=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var lr=Oe?Oe.prototype:void 0,ur=lr?lr.toString:void 0;const dr=function e(t){if("string"==typeof t)return t;if(zt(t))return cr(t,e)+"";if(Qn(t))return ur?ur.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const hr=function(e){return null==e?"":dr(e)};const fr=function(e,t){return zt(e)?e:tr(e,t)?[e]:ar(hr(e))};const pr=function(e){if("string"==typeof e||Qn(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};const mr=function(e,t){for(var n=0,r=(t=fr(t,e)).length;null!=e&&n<r;)e=e[pr(t[n++])];return n&&n==r?e:void 0};var gr=function(){try{var e=et(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const vr=gr;const yr=function(e,t,n){"__proto__"==t&&vr?vr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var br=Object.prototype.hasOwnProperty;const _r=function(e,t,n){var r=e[t];br.call(e,t)&&he(r,n)&&(void 0!==n||t in e)||yr(e,t,n)};const wr=function(e,t,n,r){if(!ze(e))return e;for(var i=-1,s=(t=fr(t,e)).length,o=s-1,a=e;null!=a&&++i<s;){var c=pr(t[i]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var u=a[c];void 0===(l=r?r(u,c,a):void 0)&&(l=ze(u)?u:sn(t[i+1])?[]:{})}_r(a,c,l),a=a[c]}return e};const Sr=function(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=mr(e,o);n(a,o)&&wr(s,fr(o,e),a)}return s};const xr=function(e,t){return null!=e&&t in Object(e)};const Ar=function(e,t,n){for(var r=-1,i=(t=fr(t,e)).length,s=!1;++r<i;){var o=pr(t[r]);if(!(s=null!=e&&n(e,o)))break;e=e[o]}return s||++r!=i?s:!!(i=null==e?0:e.length)&&on(i)&&sn(o,i)&&(zt(e)||Xt(e))};const jr=function(e,t){return null!=e&&Ar(e,t,xr)};const $r=function(e,t){return Sr(e,t,(function(t,n){return jr(e,n)}))};var Er=Oe?Oe.isConcatSpreadable:void 0;const Or=function(e){return zt(e)||Xt(e)||!!(Er&&e&&e[Er])};const Cr=function e(t,n,r,i,s){var o=-1,a=t.length;for(r||(r=Or),s||(s=[]);++o<a;){var c=t[o];n>0&&r(c)?n>1?e(c,n-1,r,i,s):Rt(s,c):i||(s[s.length]=c)}return s};const kr=function(e){return(null==e?0:e.length)?Cr(e,1):[]};const Tr=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Nr=Math.max;const Mr=function(e,t,n){return t=Nr(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Nr(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),Tr(e,this,a)}};const Ir=function(e){return function(){return e}};const Pr=function(e){return e};var Dr=vr?function(e,t){return vr(e,"toString",{configurable:!0,enumerable:!1,value:Ir(t),writable:!0})}:Pr;const Rr=Dr;var zr=Date.now;const Lr=function(e){var t=0,n=0;return function(){var r=zr(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};const Ur=Lr(Rr);const Br=function(e){return Ur(Mr(e,void 0,kr),e+"")};const Fr=Br((function(e,t){return null==e?{}:$r(e,t)})),qr={allow_non_roster_messaging:!0,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,disable_effects:!1,discover_connection_methods:!0,embed_3rd_party_media_players:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,jid:void 0,reuse_scram_keys:!0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","en","eo","es","eu","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","mr","nb","nl","oc","pl","pt","pt_BR","ro","ru","sv","ta","th","tr","ug","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,stanza_timeout:6e4,view_mode:"fullscreen",websocket_url:void 0,whitelisted_plugins:[]};function Hr(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&"__proto__"!==n&&"constructor"!==n&&(e[n]instanceof Object?Hr(e[n],t[n]):e[n]=t[n])}function Gr(e){return"[object Error]"===Object.prototype.toString.call(e)}function Wr(e){return"function"==typeof e}function Vr(e){return void 0===e}function Kr(e){return e instanceof Error}function Jr(e){var t;return e.browserStorage||(null===(t=e.collection)||void 0===t?void 0:t.browserStorage)}let Yr,Xr={};class Qr extends((0,ae.EventEmitter)(Object)){}const Zr={extend:e=>function(e){Hr(qr,e);const t=Object.keys(e).filter((e=>e in qr)),n=Fr(Xr,t),r=Object.assign(Fr(e,t),n);Hr(Yr,r)}(e),get:e=>e?function(e){if(Object.keys(qr).includes(e))return Yr[e]}(e):Yr,set(e,t){!function(e,t){if(null==e)return this;let n;e instanceof Object?n=e:"string"==typeof e&&(n={},n[e]=t);const r=Object.keys(n).filter((e=>e in qr)),i={};r.forEach((e=>{const t=n[e];Xn(Yr[e],t)||(i[e]=t,Yr[e]=t)})),Object.keys(i).forEach((e=>Yr.trigger("change:"+e,i[e]))),Yr.trigger("change",i)}(e,t)},listen:{on(e,t,n){!function(e,t,n){Yr.on(e,t,n)}(e,t,n)},not(e,t){!function(e,t){Yr.off(e,t)}(e,t)}}};function ei(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const ti=Zr;function ni(){return["fullscreen","embedded"].includes(ti.get("view_mode"))}function ri(){return"montague.lit/http-bind"===Xr.bosh_service_url}function ii(){return"onpagehide"in window?"pagehide":"onbeforeunload"in window?"beforeunload":"unload"}function si(e,t){const n=e.promises[t];if(!n)throw new Error(`Tried to replace non-existing promise: ${t}`);if(n.replace){const r=ue();r.replace=n.replace,e.promises[t]=r}else Q.debug(`Not replacing promise "${t}"`)}function oi(e){const{api:t}=e;return!e.state.config.get("trusted")||t.settings.get("clear_cache_on_logout")||ri()}function ai(e){return(t=function*(){const{api:t}=e;return yield t.trigger("beforeTearDown",{synchronous:!0}),t.trigger("afterTearDown"),e},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){ei(s,r,i,o,a,"next",e)}function a(e){ei(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function ci(e){var t;oi(e)&&(e.api.user.settings.clear(),null===(t=e.state.login_info)||void 0===t||t.destroy());return e.initSession(),e.api.trigger("clearSession",{synchronous:!0})}function li(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function ui(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){li(s,r,i,o,a,"next",e)}function a(e){li(s,r,i,o,a,"throw",e)}o(void 0)}))}}function di(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function hi(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,di(e,t,"get"))}function fi(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function pi(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,di(e,t,"set"),n),n}function mi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){mi(e,t,n[t])}))}return e}function vi(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const yi={HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",SERVER:"jabber:server",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},bi={tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"]},_i={ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12,RECONNECTING:13},wi={BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},Si={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},xi={NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11};let Ai=Si.DEBUG;const ji={setLogLevel(e){if(e<Si.DEBUG||e>Si.FATAL)throw new Error("Invalid log level supplied to setLogLevel");Ai=e},log(e,t){var n;if(!(e<Ai))if(e>=Si.ERROR)null===(n=console)||void 0===n||n.error(t);else if(e===Si.INFO){var r;null===(r=console)||void 0===r||r.info(t)}else if(e===Si.WARN){var i;null===(i=console)||void 0===i||i.warn(t)}else if(e===Si.DEBUG){var s;null===(s=console)||void 0===s||s.debug(t)}},debug(e){this.log(Si.DEBUG,e)},info(e){this.log(Si.INFO,e)},warn(e){this.log(Si.WARN,e)},error(e){this.log(Si.ERROR,e)},fatal(e){this.log(Si.FATAL,e)}};function $i(e,t){const n=zi(e),r=Li(n);if(r)throw new Error(`Parser Error: ${r}`);const i=Ui(n);if(["message","iq","presence"].includes(i.nodeName.toLowerCase())&&"jabber:client"!==i.namespaceURI&&"jabber:server"!==i.namespaceURI){const e=`Invalid namespaceURI ${i.namespaceURI}`;if(t)throw new Error(e);ji.error(e)}return i}function Ei(e){void 0!==e.stack&&ji.fatal(e.stack),ji.fatal("error: "+e.message)}function Oi(e){let t="";const n=e.length;for(let r=0;r<n;r++){const n=e.charCodeAt(r);n>=0&&n<=127?t+=e.charAt(r):n>2047?(t+=String.fromCharCode(224|n>>12&15),t+=String.fromCharCode(128|n>>6&63),t+=String.fromCharCode(128|63&n)):(t+=String.fromCharCode(192|n>>6&31),t+=String.fromCharCode(128|63&n))}return t}function Ci(e,t){const n=new Uint8Array(e),r=new Uint8Array(t),i=new Uint8Array(e.byteLength);for(let t=0;t<e.byteLength;t++)i[t]=n[t]^r[t];return i.buffer}function ki(e){let t="";const n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return btoa(t)}function Ti(e){var t;return null===(t=Uint8Array.from(atob(e),(e=>e.charCodeAt(0))))||void 0===t?void 0:t.buffer}function Ni(e){return(new TextEncoder).encode(e).buffer}function Mi(e){"undefined"==typeof document&&ji.error("addCookies: not adding any cookies, since there's no document object"),e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",r="",i="";const s=e[t],o="object"==typeof s,a=escape(unescape(o?s.value:s));o&&(n=s.expires?";expires="+s.expires:"",r=s.domain?";domain="+s.domain:"",i=s.path?";path="+s.path:""),document.cookie=t+"="+a+n+r+i}}let Ii=null;function Pi(){return Ii||(Ii=document.implementation.createDocument("jabber:client","strophe",null)),Ii}function Di(e){return Pi().createTextNode(e)}function Ri(e){const t=Array.from(e.childNodes);return 1===t.length&&t[0].nodeType===xi.TEXT||t.forEach((t=>{"body"!==t.nodeName.toLowerCase()&&(t.nodeType!==xi.TEXT||/\S/.test(t.nodeValue)?t.nodeType===xi.NORMAL&&Ri(t):e.removeChild(t))})),e}function zi(e){return(new DOMParser).parseFromString(e,"text/xml")}function Li(e){var t;const n="parsererror"===(null===(t=e.firstElementChild)||void 0===t?void 0:t.nodeName)?e.firstElementChild:e.getElementsByTagNameNS("http://www.w3.org/1999/xhtml","parsererror")[0];return"parsererror"===(null==n?void 0:n.nodeName)?null==n?void 0:n.textContent:null}function Ui(e){if(e.firstElementChild)return e.firstElementChild;let t,n=0;const r=e.childNodes;for(;t=r[n++];)if(1===t.nodeType)return t;return null}function Bi(e,t,n){if(!e)return null;const r=Pi().createElement(e);if(!n||"string"!=typeof n&&"number"!=typeof n){if("string"==typeof t||"number"==typeof t)return r.appendChild(Di(t.toString())),r}else r.appendChild(Di(n.toString()));if(!t)return r;if(Array.isArray(t))for(const e of t)Array.isArray(e)&&null!=e[0]&&null!=e[1]&&r.setAttribute(e[0],e[1]);else if("object"==typeof t)for(const e of Object.keys(t))e&&null!=t[e]&&r.setAttribute(e,t[e].toString());return r}function Fi(e){for(let t=0;t<bi.tags.length;t++)if(e===bi.tags[t])return!0;return!1}function qi(e,t){const n=bi.attributes[e];if((null==n?void 0:n.length)>0)for(let e=0;e<n.length;e++)if(t===n[e])return!0;return!1}function Hi(e){for(let t=0;t<bi.css.length;t++)if(e===bi.css[t])return!0;return!1}function Gi(e){if(e.nodeType===xi.NORMAL)return function(e){let t;const n=e.nodeName.toLowerCase();if(Fi(n))try{if(t=Bi(n),n in bi.attributes){const i=bi.attributes[n];for(let n=0;n<i.length;n++){const s=i[n];let o=e.getAttribute(s);var r;if(null!=o&&""!==o)if("style"===s&&"object"==typeof o&&(o=null!==(r=o.cssText)&&void 0!==r?r:o),"style"===s){const e=[],n=o.split(";");for(let t=0;t<n.length;t++){const r=n[t].split(":"),i=r[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(Hi(i)){const t=r[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(o=e.join("; "),t.setAttribute(s,o))}else t.setAttribute(s,o)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(Gi(e.childNodes[n]))}}catch(e){t=Di("")}else{t=Pi().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(Gi(e.childNodes[n]))}return t}(e);if(e.nodeType===xi.FRAGMENT){const t=Pi().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(Gi(e.childNodes[n]));return t}return e.nodeType===xi.TEXT?Di(e.nodeValue):void 0}function Wi(e){let t;if(e.nodeType===xi.NORMAL){const n=e;t=Bi(n.tagName);for(let e=0;e<n.attributes.length;e++)t.setAttribute(n.attributes[e].nodeName,n.attributes[e].value);for(let e=0;e<n.childNodes.length;e++)t.appendChild(Wi(n.childNodes[e]))}else e.nodeType===xi.TEXT&&(t=Pi().createTextNode(e.nodeValue));return t}function Vi(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")}function Ki(e,t,n){for(let r=0;r<e.childNodes.length;r++){const i=e.childNodes[r];i.nodeType!==xi.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}}function Ji(e,t){return e.tagName===t}function Yi(e){if(!e)return null;let t="";e.childNodes.length||e.nodeType!==xi.TEXT||(t+=e.nodeValue);for(const n of e.childNodes)n.nodeType===xi.TEXT&&(t+=n.nodeValue);return Vi(t)}function Xi(e){return e.indexOf("@")<0?null:e.split("@")[0]}function Qi(e){const t=es(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}}function Zi(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))}function es(e){return e?e.split("/")[0]:null}const ts={utf16to8:Oi,xorArrayBuffers:Ci,arrayBufToBase64:ki,base64ToArrayBuf:Ti,stringToArrayBuf:Ni,addCookies:Mi};var ns=Object.freeze({__proto__:null,toElement:$i,handleError:Ei,utf16to8:Oi,xorArrayBuffers:Ci,arrayBufToBase64:ki,base64ToArrayBuf:Ti,stringToArrayBuf:Ni,addCookies:Mi,xmlGenerator:Pi,xmlTextNode:Di,stripWhitespace:Ri,xmlHtmlNode:zi,getParserError:Li,getFirstElementChild:Ui,xmlElement:Bi,validTag:Fi,validAttribute:qi,validCSS:Hi,createHtml:Gi,copyElement:Wi,xmlescape:Vi,xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},forEachChild:Ki,isTagEqual:Ji,getText:Yi,escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:Xi,getDomainFromJid:Qi,getResourceFromJid:Zi,getBareJidFromJid:es,default:ts});function rs(e,t){return new ds(e,t)}function is(e){return new ds("message",e)}function ss(e){return new ds("iq",e)}function os(e){return new ds("presence",e)}var as=new WeakMap,cs=new WeakMap,ls=new WeakMap,us=new WeakMap;class ds{static fromString(e){const t=$i(e,!0),n=new ds("");return pi(n,as,t),n}buildTree(){return Bi(hi(this,ls),hi(this,us))}get nodeTree(){return hi(this,as)||pi(this,as,this.buildTree()),hi(this,as)}get node(){return hi(this,cs)||pi(this,cs,this.tree()),hi(this,cs)}set node(e){pi(this,cs,e)}static serialize(e){if(!e)return null;const t=e instanceof ds?e.tree():e,n=[...Array(t.attributes.length).keys()].map((e=>t.attributes[e].nodeName));n.sort();let r=n.reduce(((e,n)=>`${e} ${n}="${Vi(t.attributes.getNamedItem(n).value)}"`),`<${t.nodeName}`);if(t.childNodes.length>0){r+=">";for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];switch(n.nodeType){case xi.NORMAL:r+=ds.serialize(n);break;case xi.TEXT:r+=Vi(n.nodeValue);break;case xi.CDATA:r+="<![CDATA["+n.nodeValue+"]]>"}}r+="</"+t.nodeName+">"}else r+="/>";return r}tree(){return this.nodeTree}toString(){return ds.serialize(this.tree())}up(){return this.node=this.node.parentElement?this.node.parentElement:this.node.parentNode,this}root(){return this.node=this.tree(),this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(null!=e[t]?this.node.setAttribute(t,e[t].toString()):this.node.removeAttribute(t));return this}c(e,t,n){const r=Bi(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this}cnode(e){let t;e instanceof ds&&(e=e.tree());const n=Pi();try{t=void 0!==n.importNode}catch(e){t=!1}const r=t?n.importNode(e,!0):Wi(e);return this.node.appendChild(r),this.node=r,this}t(e){const t=Di(e);return this.node.appendChild(t),this}h(e){const t=Pi().createElement("body");t.innerHTML=e;const n=Gi(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}constructor(e,t){fi(this,as,{writable:!0,value:void 0}),fi(this,cs,{writable:!0,value:void 0}),fi(this,ls,{writable:!0,value:void 0}),fi(this,us,{writable:!0,value:void 0}),"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=yi.CLIENT:t||(t={xmlns:yi.CLIENT})),pi(this,ls,e),pi(this,us,t)}}let hs=0;class fs{getResponse(){var e;const t=null===(e=this.xhr.responseXML)||void 0===e?void 0:e.documentElement;if(t){if("parsererror"===t.tagName)throw ji.error("invalid response received"),ji.error("responseText: "+this.xhr.responseText),ji.error("responseXML: "+ds.serialize(t)),new Error("parsererror")}else if(this.xhr.responseText){ji.debug("Got responseText but no responseXML; attempting to parse it with DOMParser...");const e=zi(this.xhr.responseText),t=Li(e);if(!e||t){t&&(ji.error("invalid response received: "+t),ji.error("responseText: "+this.xhr.responseText));const e=new Error;throw e.name=wi.BAD_FORMAT,e}}return t}_newXHR(){const e=new XMLHttpRequest;return e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"),e.onreadystatechange=this.func.bind(null,this),e}constructor(e,t,n,r=0){this.id=++hs,this.xmlData=e,this.data=ds.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r,this.abort=!1,this.dead=null,this.age=()=>this.date?((new Date).valueOf()-this.date.valueOf())/1e3:0,this.timeDead=()=>this.dead?((new Date).valueOf()-this.dead.valueOf())/1e3:0,this.xhr=this._newXHR()}}let ps=1.1,ms=.1;class gs{static setTimeoutMultiplier(e){ps=e}static getTimeoutMultplier(){return ps}static setSecondaryTimeoutMultiplier(e){ms=e}static getSecondaryTimeoutMultplier(){return ms}_buildBody(){const e=rs("body",{rid:this.rid++,xmlns:yi.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":yi.BOSH});n&&r.attrs({route:n});const i=this._conn._connect_cb;this._requests.push(new fs(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),Number(r.tree().getAttribute("rid")))),this._throttledRequestHandler()}_attach(e,t,n,r,i,s,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=Qi(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=s||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(_i.ATTACHED,null)}_restore(e,t,n,r,i){const s=JSON.parse(sessionStorage.getItem("strophe-bosh-session"));if(!(null!=s&&s.rid&&s.sid&&s.jid&&(null==e||es(s.jid)===es(e)||null===Xi(e)&&Qi(s.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(s.jid,s.sid,s.rid,t,n,r,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");ji.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(_i.CONNFAIL,t)):this._conn._changeConnectStatus(_i.CONNFAIL,"unknown"),this._conn._doDisconnect(t),_i.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const r=e.getAttribute("hold");r&&(this.hold=parseInt(r,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const s=e.getAttribute("inactivity");s&&(this.inactivity=parseInt(s,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(e){const t=gs._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)}_hitError(e){this.errors++,ji.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){ji.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new fs(t.tree(),this._onRequestStateChange.bind(this,e),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(ji.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":yi.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new fs(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(ps*this.wait)&&this._throttledRequestHandler(),e>Math.floor(ps*this.wait)&&(ji.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(ps*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){ji.error(`Caught an error while retrieving a request's status, reqStatus: ${n}, message: ${e.message}`)}return void 0===n&&(n="number"==typeof t?t:0),n}_onRequestStateChange(e,t){if(ji.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);if(4!==t.xhr.readyState)return;const n=gs._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this._conn.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);const r=this._requests[0]===t,i=this._requests[1]===t,s=n>0&&n<500,o=t.sends>this._conn.maxRetries;(s||o)&&(this._removeRequest(t),ji.debug("request id "+t.id+" should now be removed")),200===n?((i||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(ps*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(t.rid+1),ji.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):0===n||n>=400&&n<600||n>=12e3?(ji.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(_i.DISCONNECTING,null),this._conn._doDisconnect())):ji.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),s||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(_i.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(e){let t=this._requests[e];const n=gs._getRequestStatus(t,-1);if(t.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const r=t.age(),i=!isNaN(r)&&r>Math.floor(ps*this.wait),s=null!==t.dead&&t.timeDead()>Math.floor(ms*this.wait),o=4===t.xhr.readyState&&(n<1||n>=500);if((i||s||o)&&(s&&ji.error(`Request ${this._requests[e].id} timed out (secondary), restarting`),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){},this._requests[e]=new fs(t.xmlData,t.origFunc,t.rid,t.sends),t=this._requests[e]),0===t.xhr.readyState){var a,c;ji.debug("request id "+t.id+"."+t.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";t.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==t.xhr.setRequestHeader&&t.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(t.xhr.withCredentials=!0)}catch(e){return ji.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(_i.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(t.date=(new Date).valueOf(),this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.xhr.setRequestHeader(n,e[n])}t.xhr.send(t.data)};if(t.sends>1){const n=1e3*Math.min(Math.floor(ps*this.wait),Math.pow(t.sends,3));setTimeout((function(){e()}),n)}else e();var l,u,d,h;if(t.sends++,this.strip&&"body"===t.xmlData.nodeName&&t.xmlData.childNodes.length)null===(l=(u=this._conn).xmlOutput)||void 0===l||l.call(u,t.xmlData.children[0]);else null===(d=(h=this._conn).xmlOutput)||void 0===d||d.call(h,t.xmlData);null===(a=(c=this._conn).rawOutput)||void 0===a||a.call(c,t.data)}else ji.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+t.xhr.readyState)}_removeRequest(e){ji.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){ji.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"}),n=e instanceof ds?e.tree():e;e&&t.cnode(n);const r=new fs(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")));this._requests.push(r),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?ji.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):ji.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}constructor(e){var t;this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.strip=null!==(t=gs.prototype.strip)&&void 0!==t&&t,this.lastResponseHeaders=null,this._requests=[]}}class vs{getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t}namespaceMatch(e){if(!this.ns||this.getNamespace(e)===this.ns)return!0;for(const n of null!==(t=e.children)&&void 0!==t?t:[]){var t;if(this.getNamespace(n)===this.ns)return!0;if(this.namespaceMatch(n))return!0}return!1}isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=es(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!Ji(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)}run(e){let t=null;try{t=this.handler(e)}catch(e){throw Ei(e),e}return t}toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}constructor(e,t,n,r,i,s,o){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBareFromJid?this.from=s?es(s):null:this.from=s,this.user=!0}}class ys{run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}}class bs{test(e){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}constructor(e,t,n){this.mechname=e,this.isClientFirst=t,this.priority=n}}class _s extends bs{test(e){return null===e.authcid}constructor(e="ANONYMOUS",t=!1,n=20){super(e,t,n)}}class ws extends bs{onChallenge(e){return e.authcid===e.authzid?"":e.authzid}constructor(e="EXTERNAL",t=!0,n=10){super(e,t,n)}}class Ss extends bs{test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",ts.utf16to8(t)}constructor(e="OAUTHBEARER",t=!0,n=40){super(e,t,n)}}class xs extends bs{test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:n,domain:r,pass:i}=e;if(!r)throw new Error("SASLPlain onChallenge: domain is not defined!");let s=n!==`${t}@${r}`?n:"";return s+="\0",s+=t,s+="\0",s+=i,ts.utf16to8(s)}constructor(e="PLAIN",t=!0,n=50){super(e,t,n)}}const As={scramResponse:(e,t,n,r)=>ui((function*(){const i=e._sasl_data.cnonce,s=function(e){let t,n,r;const i=/([a-z]+)=([^,]+)(,|$)/;for(;e.match(i);){const s=e.match(i);switch(e=e.replace(s[0],""),s[1]){case"r":t=s[2];break;case"s":n=ts.base64ToArrayBuf(s[2]);break;case"i":r=parseInt(s[2],10);break;case"m":return}}if(isNaN(r)||r<4096)ji.warn("Failing SCRAM authentication because server supplied iteration count < 4096.");else{if(n)return{nonce:t,salt:n,iter:r};ji.warn("Failing SCRAM authentication because server supplied incorrect salt.")}}(t);if(!s&&(null==s?void 0:s.nonce.slice(0,i.length))!==i)return ji.warn("Failing SCRAM authentication because server supplied incorrect nonce."),e._sasl_data={},e._sasl_failure_cb();let o,a;const{pass:c}=e;if("string"==typeof e.pass||e.pass instanceof String){const e=yield function(e,t,n,r,i){return ui((function*(){const s=yield crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:n,hash:{name:r}},yield crypto.subtle.importKey("raw",ts.stringToArrayBuf(e),"PBKDF2",!1,["deriveBits"]),i),o=yield crypto.subtle.importKey("raw",s,{name:"HMAC",hash:r},!1,["sign"]);return{ck:yield crypto.subtle.sign("HMAC",o,ts.stringToArrayBuf("Client Key")),sk:yield crypto.subtle.sign("HMAC",o,ts.stringToArrayBuf("Server Key"))}}))()}(c,s.salt,s.iter,n,r);o=e.ck,a=e.sk}else{if((null==c?void 0:c.name)!==n||(null==c?void 0:c.salt)!==ts.arrayBufToBase64(s.salt)||(null==c?void 0:c.iter)!==s.iter)return e._sasl_failure_cb();{const{ck:e,sk:t}=c;o=ts.base64ToArrayBuf(e),a=ts.base64ToArrayBuf(t)}}const l=e._sasl_data["client-first-message-bare"],u=t,d=`c=biws,r=${s.nonce}`,h=`${l},${u},${d}`,f=yield function(e,t,n){return ui((function*(){const r=yield crypto.subtle.importKey("raw",yield crypto.subtle.digest(n,t),{name:"HMAC",hash:n},!1,["sign"]),i=yield crypto.subtle.sign("HMAC",r,ts.stringToArrayBuf(e));return ts.xorArrayBuffers(t,i)}))()}(h,o,n),p=yield function(e,t,n){return ui((function*(){const r=yield crypto.subtle.importKey("raw",t,{name:"HMAC",hash:n},!1,["sign"]);return crypto.subtle.sign("HMAC",r,ts.stringToArrayBuf(e))}))()}(h,a,n);return e._sasl_data["server-signature"]=ts.arrayBufToBase64(p),e._sasl_data.keys={name:n,iter:s.iter,salt:ts.arrayBufToBase64(s.salt),ck:ts.arrayBufToBase64(o),sk:ts.arrayBufToBase64(a)},`${d},p=${ts.arrayBufToBase64(f)}`}))(),clientChallenge(e,t){const n=t||function(){const e=new Uint8Array(16);return ts.arrayBufToBase64(crypto.getRandomValues(e).buffer)}(),r=`n=${e.authcid},r=${n}`;return e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=r,`n,,${r}`}};class js extends bs{test(e){return null!==e.authcid}onChallenge(e,t){return ui((function*(){return yield As.scramResponse(e,t,"SHA-1",160)}))()}clientChallenge(e,t){return As.clientChallenge(e,t)}constructor(e="SCRAM-SHA-1",t=!0,n=60){super(e,t,n)}}class $s extends bs{test(e){return null!==e.authcid}onChallenge(e,t){return ui((function*(){return yield As.scramResponse(e,t,"SHA-256",256)}))()}clientChallenge(e,t){return As.clientChallenge(e,t)}constructor(e="SCRAM-SHA-256",t=!0,n=70){super(e,t,n)}}class Es extends bs{test(e){return null!==e.authcid}onChallenge(e,t){return ui((function*(){return yield As.scramResponse(e,t,"SHA-384",384)}))()}clientChallenge(e,t){return As.clientChallenge(e,t)}constructor(e="SCRAM-SHA-384",t=!0,n=71){super(e,t,n)}}class Os extends bs{test(e){return null!==e.authcid}onChallenge(e,t){return ui((function*(){return yield As.scramResponse(e,t,"SHA-512",512)}))()}clientChallenge(e,t){return As.clientChallenge(e,t)}constructor(e="SCRAM-SHA-512",t=!0,n=72){super(e,t,n)}}class Cs extends bs{test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,ts.utf16to8(t)}constructor(e="X-OAUTH2",t=!0,n=30){super(e,t,n)}}class ks extends Error{constructor(e){super(e),this.name="StropheSessionError"}}class Ts{_buildStream(){return rs("open",{xmlns:yi.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(yi.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const r=n[0];let i="",s="";for(let e=0;e<r.childNodes.length;e++){const t=r.childNodes[e];if(t.nodeType===t.ELEMENT_NODE){if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break}"text"===t.nodeName?s=t.textContent:i=t.nodeName}let o="WebSocket stream error: ";return o+=i||"unknown",s&&(o+=" - "+s),ji.error(o),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,_i.CONNFAIL))return _i.CONNFAIL}_handleStreamStart(e){let t=null;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==yi.FRAMING&&(t="Wrong xmlns in <open />: "+n);const r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(_i.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(_i.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(_i.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(n,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);const t=rs("close",{xmlns:yi.FRAMING});this._conn.xmlOutput(t.tree());const n=ds.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){ji.warn(`Couldn't send <close /> tag. "${e.message}"`)}}setTimeout((()=>this._conn._doDisconnect()),0)}_doDisconnect(){ji.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){ji.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(ji.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(ji.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(_i.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):ji.debug("Websocket closed")}_no_auth_received(e){ji.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(_i.CONNFAIL,wi.NO_AUTH_MECH),null==e||e.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){ji.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(_i.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){const n="restart"===e[t]?this._buildStream().tree():e[t];if("restart"===n)throw new Error("Wrong type for stanza");const r=ds.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}}_onMessage(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new DOMParser).parseFromString(n,"text/xml").documentElement}return this._checkStreamError(t,_i.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstElementChild.nodeName&&"unavailable"===t.firstElementChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(ds.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){ji.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=ds.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==location.protocol?n+="ws":n+="wss",n+="://"+location.host,0!==t.indexOf("/")?n+=location.pathname+t:n+=t,e.service=n}}}class Ns extends Ts{_setSocket(){this.socket={send:e=>this.worker.port.postMessage(["send",e]),close:()=>this.worker.port.postMessage(["_closeSocket"]),onopen:()=>{},onerror:e=>this._onError(e),onclose:e=>this._onClose(e),onmessage:()=>{},readyState:null}}_connect(){this._setSocket(),this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._setSocket(),this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===_i.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(_i.ATTACHED)):e===_i.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(_i.ATTACHFAIL))}_disconnect(e){e&&this._conn.send(e);const t=rs("close",{xmlns:yi.FRAMING});this._conn.xmlOutput(t.tree());const n=ds.serialize(t);this._conn.rawOutput(n),this.worker.port.postMessage(["send",n]),this._conn._doDisconnect()}_closeSocket(){this.socket.close()}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){ji.error(e)}else if("log"===n){const e={debug:Si.DEBUG,info:Si.INFO,warn:Si.WARN,error:Si.ERROR,fatal:Si.FATAL},n=t[1],r=t[2];ji.log(e[n],r)}else ji.error(`Found unhandled service worker message: ${t}`)}constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{var t;null===(t=console)||void 0===t||t.error(e),ji.error(`Shared Worker Error: ${e}`)}}}const Ms={};class Is{static addConnectionPlugin(e,t){Ms[e]=t}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new Ns(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new Ts(this):this._proto=new gs(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,n){this.protocolErrorHandlers[e][t]=n}connect(e,t,n,r,i,s,o,a=3e3){this.jid=e,this.authzid=es(this.jid),this.authcid=o||Xi(this.jid),this.pass=t,this.scram_keys=null,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=a,this.domain=Qi(this.jid),this._changeConnectStatus(_i.CONNECTING,null),this._proto._connect(r,i,s)}attach(e,t,n,r,i,s,o){if(this._proto instanceof gs&&"string"==typeof e)return this._proto._attach(e,t,n,r,i,s,o);if(this._proto instanceof Ns&&"function"==typeof e){const t=e;return this._proto._attach(t)}throw new ks('The "attach" method is not available for your connection protocol')}restore(e,t,n,r,i){if(!(this._proto instanceof gs&&this._sessionCachingSupported()))throw new ks('The "restore" method can only be used with a BOSH connection.');this._sessionCachingSupported()&&this._proto._restore(e,t,n,r,i)}_sessionCachingSupported(){if(this._proto instanceof gs){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if(Array.isArray(e))e.forEach((e=>this._queueData(e instanceof ds?e.tree():e)));else{const t=e instanceof ds?e.tree():e;this._queueData(t)}this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,n,r){let i=null;const s=e instanceof ds?e.tree():e;let o=s.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),s.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?null==n||n(e):t&&t(e)}),null,"presence",null,o);r&&(i=this.addTimedHandler(r,(()=>(this.deleteHandler(e),null==n||n(null),!1))))}return this.send(s),o}sendIQ(e,t,n,r){let i=null;const s=e instanceof ds?e.tree():e;let o=s.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),s.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i);const r=e.getAttribute("type");if("result"===r)null==t||t(e);else{if("error"!==r){const e=new Error(`Got bad IQ type of ${r}`);throw e.name="StropheError",e}null==n||n(e)}}),null,"iq",["error","result"],o);r&&(i=this.addTimedHandler(r,(()=>(this.deleteHandler(e),null==n||n(null),!1))))}return this.send(s),o}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const n=new ys(e,t);return this.addTimeds.push(n),n}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,n,r,i,s,o){const a=new vs(e,t,n,r,i,s,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e||[_s,ws,Ss,Cs,xs,js,$s,Es,Os]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(_i.DISCONNECTING,e),e?ji.info("Disconnect was called because: "+e):ji.debug("Disconnect was called"),this.connected){let e=null;this.disconnecting=!0,this.authenticated&&(e=os({xmlns:yi.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else ji.debug("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,n){for(const n in Ms)if(Object.prototype.hasOwnProperty.call(Ms,n)){const r=this[n];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){ji.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){Ei(e),ji.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),ji.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(_i.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const n="_reqToData"in this._proto?this._proto._reqToData(e):e;if(null===n)return;for(this.xmlInput!==Is.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==Is.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(ds.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const r=n.getAttribute("type");if(null!==r&&"terminate"===r){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(_i.CONNFAIL,e)):this._changeConnectStatus(_i.CONNFAIL,wi.UNKNOWN_REASON),void this._doDisconnect(e)}Ki(n,null,(e=>{const t=[];this.handlers=this.handlers.reduce(((n,r)=>{try{!r.isMatch(e)||!this.authenticated&&r.user?n.push(r):(r.run(e)&&n.push(r),t.push(r))}catch(e){ji.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return n}),[]),!t.length&&this.iqFallbackHandler.isMatch(e)&&this.iqFallbackHandler.run(e)}))}_connect_cb(e,t,n){let r;ji.debug("_connect_cb was called"),this.connected=!0;try{r="_reqToData"in this._proto?this._proto._reqToData(e):e}catch(e){if(e.name!==wi.BAD_FORMAT)throw e;this._changeConnectStatus(_i.CONNFAIL,wi.BAD_FORMAT),this._doDisconnect(wi.BAD_FORMAT)}if(!r)return;this.xmlInput!==Is.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==Is.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(ds.serialize(r)));if(this._proto._connect_cb(r)===_i.CONNFAIL)return;let i;if(i=r.getElementsByTagNameNS?r.getElementsByTagNameNS(yi.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const s=Array.from(r.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==s.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(s):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let n=t;for(let r=t+1;r<e.length;++r)e[r].priority>e[n].priority&&(n=r);if(n!==t){const r=e[t];e[t]=e[n],e[n]=r}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);const r=rs("auth",{xmlns:yi.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);r.t(btoa(e))}this.send(r.tree()),t=!0;break}return t}_sasl_challenge_cb(e){return ui((function*(){const t=atob(Yi(e)),n=yield this._sasl_mechanism.onChallenge(this,t),r=rs("response",{xmlns:yi.SASL});return n&&r.t(btoa(n)),this.send(r.tree()),!0})).call(this)}_attemptLegacyAuth(){null===Xi(this.jid)?(this._changeConnectStatus(_i.CONNFAIL,wi.MISSING_JID_NODE),this.disconnect(wi.MISSING_JID_NODE)):(this._changeConnectStatus(_i.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(ss({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:yi.AUTH}).c("username",{}).t(Xi(this.jid)).tree()))}_onLegacyAuthIQResult(){const e="string"==typeof this.pass?this.pass:"",t=ss({type:"set",id:"_auth_2"}).c("query",{xmlns:yi.AUTH}).c("username",{}).t(Xi(this.jid)).up().c("password").t(e);return Zi(this.jid)||(this.jid=es(this.jid)+"/strophe"),t.up().c("resource",{}).t(Zi(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,r=atob(Yi(e)).match(n);if("v"===r[1]&&(t=r[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}ji.info("SASL authentication succeeded."),this._sasl_data.keys&&(this.scram_keys=this._sasl_data.keys),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>n(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>n(t,e)),yi.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(_i.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(_i.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void ji.info('Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=Zi(this.jid);e?this.send(ss({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:yi.BIND}).c("resource",{}).t(e).tree()):this.send(ss({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:yi.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){ji.warn("Resource binding failed.");let t;return e.getElementsByTagName("conflict").length>0&&(t=wi.CONFLICT),this._changeConnectStatus(_i.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return ji.warn("Resource binding failed."),this._changeConnectStatus(_i.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=Yi(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(_i.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Connection.prototype._establishSession called but apparently ${yi.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(ss({type:"set",id:"_session_auth_2"}).c("session",{xmlns:yi.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(_i.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,ji.warn("Session creation failed."),this._changeConnectStatus(_i.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(_i.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(_i.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(_i.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const n=new ys(e,t);return n.user=!1,this.addTimeds.push(n),n}_addSysHandler(e,t,n,r,i){const s=new vs(e,t,n,r,i);return s.user=!1,this.addHandlers.push(s),s}_onDisconnectTimeout(){return ji.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(_i.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const r=this.timedHandlers[n];if(this.authenticated||!r.user){r.lastCalled+r.period-e<=0?r.run()&&t.push(r):t.push(r)}}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}constructor(e,t={}){this.service=e,this.options=t,this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),Mi(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new vs((e=>this.send(ss({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:yi.STANZAS}))),null,"iq",["get","set"]);for(const e in Ms)if(Object.prototype.hasOwnProperty.call(Ms,e)){const t=function(){};t.prototype=Ms[e],this[e]=new t,this[e].init(this)}}}class Ps extends String{}var Ds=new WeakMap,Rs=new WeakMap,zs=new WeakMap;class Ls extends ds{static unsafeXML(e){return new Ps(e)}static toElement(e,t){const n=zi(e),r=Li(n);if(r)throw new Error(`Parser Error: ${r}`);const i=Ri(Ui(n));if(["message","iq","presence"].includes(i.nodeName.toLowerCase())&&"jabber:client"!==i.namespaceURI&&"jabber:server"!==i.namespaceURI){const e=`Invalid namespaceURI ${i.namespaceURI}`;if(t)throw new Error(e);ji.error(e)}return i}buildTree(){return Ls.toElement(this.toString(),!0)}toString(){return pi(this,Ds,hi(this,Ds)||hi(this,Rs).reduce(((e,t,n)=>{const r=hi(this,zs).length>n?hi(this,zs)[n]:"";return e+t+(Array.isArray(r)?r.map((e=>e instanceof Ps||e instanceof ds?e:Vi(e.toString()))).join(""):r instanceof Ps||r instanceof ds?r:Vi((null!=r?r:"").toString()))}),"").trim()),hi(this,Ds)}constructor(e,t){super("stanza"),fi(this,Ds,{writable:!0,value:void 0}),fi(this,Rs,{writable:!0,value:void 0}),fi(this,zs,{writable:!0,value:void 0}),pi(this,Rs,e),pi(this,zs,t)}}function Us(e,...t){return new Ls(e,t)}const Bs=vi(gi({VERSION:"3.0.0",get TIMEOUT(){return gs.getTimeoutMultplier()},set TIMEOUT(e){gs.setTimeoutMultiplier(e)},get SECONDARY_TIMEOUT(){return gs.getSecondaryTimeoutMultplier()},set SECONDARY_TIMEOUT(e){gs.setSecondaryTimeoutMultiplier(e)}},ns,ji),{Request:fs,Bosh:gs,Websocket:Ts,WorkerWebsocket:Ns,Connection:Is,Handler:vs,SASLAnonymous:_s,SASLPlain:xs,SASLSHA1:js,SASLSHA256:$s,SASLSHA384:Es,SASLSHA512:Os,SASLOAuthBearer:Ss,SASLExternal:ws,SASLXOAuth2:Cs,Stanza:Ls,Builder:ds,ElementType:xi,ErrorCondition:wi,LogLevel:Si,NS:yi,SASLMechanism:bs,Status:_i,TimedHandler:ys,XHTML:vi(gi({},bi),{validTag:Fi,validCSS:Hi,validAttribute:qi}),serialize:e=>ds.serialize(e),setLogLevel(e){ji.setLogLevel(e)},addNamespace(e,t){Bs.NS[e]=t},addConnectionPlugin(e,t){Is.addConnectionPlugin(e,t)}});globalThis.$build=rs,globalThis.$iq=ss,globalThis.$msg=is,globalThis.$pres=os,globalThis.Strophe=Bs,globalThis.stx=Us;const Fs=Ls.toElement;globalThis.toStanza=Ls.toElement;const qs=59,Hs="v11.0.1",Gs=["chat","dnd","away","xa"],Ws=["available","unavailable","error","probe","subscribe","subscribed","unsubscribe","unsubscribed"],Vs={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},Ks=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],Js="anonymous",Ys="closed",Xs="external",Qs="login",Zs="logout",eo="opened",to="prebind",no="success",ro="failure",io="inactive",so="active",oo="composing",ao="paused",co="gone",lo="chatbox",uo="chatroom",ho="headline",fo="controlbox",po={};po[Bs.Status.ATTACHED]="ATTACHED",po[Bs.Status.AUTHENTICATING]="AUTHENTICATING",po[Bs.Status.AUTHFAIL]="AUTHFAIL",po[Bs.Status.CONNECTED]="CONNECTED",po[Bs.Status.CONNECTING]="CONNECTING",po[Bs.Status.CONNFAIL]="CONNFAIL",po[Bs.Status.DISCONNECTED]="DISCONNECTED",po[Bs.Status.DISCONNECTING]="DISCONNECTING",po[Bs.Status.ERROR]="ERROR",po[Bs.Status.RECONNECTING]="RECONNECTING",po[Bs.Status.REDIRECT]="REDIRECT",Bs.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),Bs.addNamespace("CARBONS","urn:xmpp:carbons:2"),Bs.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),Bs.addNamespace("CSI","urn:xmpp:csi:0"),Bs.addNamespace("DELAY","urn:xmpp:delay"),Bs.addNamespace("EME","urn:xmpp:eme:0"),Bs.addNamespace("FALLBACK","urn:xmpp:fallback:0"),Bs.addNamespace("FASTEN","urn:xmpp:fasten:0"),Bs.addNamespace("FORWARD","urn:xmpp:forward:0"),Bs.addNamespace("HINTS","urn:xmpp:hints"),Bs.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),Bs.addNamespace("MAM","urn:xmpp:mam:2"),Bs.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),Bs.addNamespace("MENTIONS","urn:xmpp:mmn:0"),Bs.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),Bs.addNamespace("MODERATE","urn:xmpp:message-moderate:1"),Bs.addNamespace("MODERATE0","urn:xmpp:message-moderate:0"),Bs.addNamespace("NICK","http://jabber.org/protocol/nick"),Bs.addNamespace("OCCUPANTID","urn:xmpp:occupant-id:0"),Bs.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),Bs.addNamespace("OUTOFBAND","jabber:x:oob"),Bs.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),Bs.addNamespace("RAI","urn:xmpp:rai:0"),Bs.addNamespace("RECEIPTS","urn:xmpp:receipts"),Bs.addNamespace("REFERENCE","urn:xmpp:reference:0"),Bs.addNamespace("REGISTER","jabber:iq:register"),Bs.addNamespace("RETRACT","urn:xmpp:message-retract:1"),Bs.addNamespace("RETRACT0","urn:xmpp:message-retract:0"),Bs.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),Bs.addNamespace("RSM","http://jabber.org/protocol/rsm"),Bs.addNamespace("SID","urn:xmpp:sid:0"),Bs.addNamespace("SPOILER","urn:xmpp:spoiler:0"),Bs.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),Bs.addNamespace("STYLING","urn:xmpp:styling:0"),Bs.addNamespace("VCARD","vcard-temp"),Bs.addNamespace("VCARDUPDATE","vcard-temp:x:update"),Bs.addNamespace("XFORM","jabber:x:data"),Bs.addNamespace("XHTML","http://www.w3.org/1999/xhtml");const mo=["converse-adhoc","converse-bookmarks","converse-blocklist","converse-bosh","converse-caps","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],go=["active","composing","gone","inactive","paused"],vo=["displayed","received","acknowledged"],yo={TAB:"Tab",ENTER:"Enter",SHIFT:"Shift",CTRL:"Control",ALT:"Alt",ESCAPE:"Escape",LEFT_ARROW:"ArrowLeft",UP_ARROW:"ArrowUp",RIGHT_ARROW:"ArrowRight",DOWN_ARROW:"ArrowDown",FORWARD_SLASH:"Divide",AT:"Alt",META:"Meta"},bo={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"},_o={"xs:anyURI":"url","xs:byte":"number","xs:date":"date","xs:dateTime":"datetime","xs:int":"number","xs:integer":"number","xs:time":"time"},wo={chatboxes:null,bookmarks:null,ANONYMOUS:Js,CLOSED:Ys,EXTERNAL:Xs,LOGIN:Qs,LOGOUT:Zs,OPENED:eo,PREBIND:to,SUCCESS:no,FAILURE:ro,INACTIVE:io,ACTIVE:so,COMPOSING:oo,PAUSED:ao,GONE:co};class So extends((0,ae.EventEmitter)(Object)){initialize(){this.VERSION_NAME=Hs,this.strict_plugin_dependencies=!1,this.pluggable=null,this.templates={},this.storage={},this.promises={initialized:ue()},this.NUM_PREKEYS=100,this.TIMEOUTS={PAUSED:1e4,INACTIVE:9e4},Object.assign(this,wo),this.api=null,this.labels={},this.exports={},this.constants={},this.env={},this.state={},this.initSession()}initSession(){var e;null===(e=this.session)||void 0===e||e.destroy(),this.session=new ae.Model,Object.assign(this,{jid:void 0,bare_jid:void 0,domain:void 0,resource:void 0})}__(...e){return re.__(...e)}___(e){return e}constructor(){super();const e=new Proxy(this,{get:(e,t)=>(ri()||"string"!=typeof t||Object.keys(wo).includes(t)&&Q.warn(`Accessing ${t} on _converse is DEPRECATED`),Reflect.get(e,t))});return e.initialize(),e}}const xo=new So;oe.enable(xo,"_converse","pluggable");const Ao=xo;function jo(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const $o={trigger(e){return(t=function*(e){if(!Ao._events)return;const t=Array.from(arguments),n=t.pop();if(n&&n.synchronous){const n=Ao._events[e]||[],r=t.splice(1);yield Promise.all(n.map((e=>e.callback.apply(e.ctx,r))))}else Ao.trigger.apply(Ao,arguments);const r=Ao.promises[e];void 0!==r&&r.resolve(arguments[1])},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){jo(s,r,i,o,a,"next",e)}function a(e){jo(s,r,i,o,a,"throw",e)}o(void 0)}))}).apply(this,arguments);var t},hook(e,t,n){const r=Ao._events[e]||[];return r.length?r.reduce(((e,n)=>e.then((e=>n.callback(t,e)))),Promise.resolve(n)):n},listen:{once:Ao.once.bind(Ao),on:Ao.on.bind(Ao),not:Ao.off.bind(Ao),stanza(e,t,n){Wr(t)?(n=t,t={}):t=t||{},Ao.api.connection.get().addHandler(n,t.ns,e,t.type,t.id,t.from,t)}}};const Eo=function(){return Ee.Date.now()};var Oo=/\s/;const Co=function(e){for(var t=e.length;t--&&Oo.test(e.charAt(t)););return t};var ko=/^\s+/;const To=function(e){return e?e.slice(0,Co(e)+1).replace(ko,""):e};var No=/^[-+]0x[0-9a-f]+$/i,Mo=/^0b[01]+$/i,Io=/^0o[0-7]+$/i,Po=parseInt;const Do=function(e){if("number"==typeof e)return e;if(Qn(e))return NaN;if(ze(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ze(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=To(e);var n=Mo.test(e);return n||Io.test(e)?Po(e.slice(2),n?2:8):No.test(e)?NaN:+e};var Ro=Math.max,zo=Math.min;const Lo=function(e,t,n){var r,i,s,o,a,c,l=0,u=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,s=i;return r=i=void 0,l=t,o=e.apply(s,n)}function p(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=s}function m(){var e=Eo();if(p(e))return g(e);a=setTimeout(m,function(e){var n=t-(e-c);return d?zo(n,s-(e-l)):n}(e))}function g(e){return a=void 0,h&&r?f(e):(r=i=void 0,o)}function v(){var e=Eo(),n=p(e);if(r=arguments,i=this,c=e,n){if(void 0===a)return function(e){return l=e,a=setTimeout(m,t),u?f(e):o}(c);if(d)return clearTimeout(a),a=setTimeout(m,t),f(c)}return void 0===a&&(a=setTimeout(m,t)),o}return t=Do(t)||0,ze(n)&&(u=!!n.leading,s=(d="maxWait"in n)?Ro(Do(n.maxWait)||0,t):s,h="trailing"in n?!!n.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,r=c=i=a=void 0},v.flush=function(){return void 0===a?o:g(Eo())},v};var Uo=n(3002);const Bo=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};const Fo=function(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?yr(n,a,c):_r(n,a,c)}return n};const qo=function(e,t){return e&&Fo(t,jn(t),e)};const Ho=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var Go=Object.prototype.hasOwnProperty;const Wo=function(e){if(!ze(e))return Ho(e);var t=bn(e),n=[];for(var r in e)("constructor"!=r||!t&&Go.call(e,r))&&n.push(r);return n};const Vo=function(e){return An(e)?vn(e,!0):Wo(e)};const Ko=function(e,t){return e&&Fo(t,Vo(t),e)};var Jo="object"==typeof exports&&exports&&!exports.nodeType&&exports,Yo=Jo&&"object"==typeof module&&module&&!module.nodeType&&module,Xo=Yo&&Yo.exports===Jo?Ee.Buffer:void 0,Qo=Xo?Xo.allocUnsafe:void 0;const Zo=function(e,t){if(t)return e.slice();var n=e.length,r=Qo?Qo(n):new e.constructor(n);return e.copy(r),r};const ea=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};const ta=function(e,t){return Fo(e,Ht(e),t)};const na=_n(Object.getPrototypeOf,Object);const ra=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Rt(t,Ht(e)),e=na(e);return t}:Bt;const ia=function(e,t){return Fo(e,ra(e),t)};const sa=function(e){return Lt(e,Vo,ra)};var oa=Object.prototype.hasOwnProperty;const aa=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&oa.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const ca=function(e){var t=new e.constructor(e.byteLength);return new Tt(t).set(new Tt(e)),t};const la=function(e,t){var n=t?ca(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var ua=/\w*$/;const da=function(e){var t=new e.constructor(e.source,ua.exec(e));return t.lastIndex=e.lastIndex,t};var ha=Oe?Oe.prototype:void 0,fa=ha?ha.valueOf:void 0;const pa=function(e){return fa?Object(fa.call(e)):{}};const ma=function(e,t){var n=t?ca(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const ga=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return ca(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return la(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ma(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return da(e);case"[object Symbol]":return pa(e)}};var va=Object.create;const ya=function(){function e(){}return function(t){if(!ze(t))return{};if(va)return va(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const ba=function(e){return"function"!=typeof e.constructor||bn(e)?{}:ya(na(e))};const _a=function(e){return Wt(e)&&"[object Map]"==Hn(e)};var wa=fn&&fn.isMap;const Sa=wa?ln(wa):_a;const xa=function(e){return Wt(e)&&"[object Set]"==Hn(e)};var Aa=fn&&fn.isSet;const ja=Aa?ln(Aa):xa;var $a="[object Arguments]",Ea="[object Function]",Oa="[object Object]",Ca={};Ca[$a]=Ca["[object Array]"]=Ca["[object ArrayBuffer]"]=Ca["[object DataView]"]=Ca["[object Boolean]"]=Ca["[object Date]"]=Ca["[object Float32Array]"]=Ca["[object Float64Array]"]=Ca["[object Int8Array]"]=Ca["[object Int16Array]"]=Ca["[object Int32Array]"]=Ca["[object Map]"]=Ca["[object Number]"]=Ca[Oa]=Ca["[object RegExp]"]=Ca["[object Set]"]=Ca["[object String]"]=Ca["[object Symbol]"]=Ca["[object Uint8Array]"]=Ca["[object Uint8ClampedArray]"]=Ca["[object Uint16Array]"]=Ca["[object Uint32Array]"]=!0,Ca["[object Error]"]=Ca[Ea]=Ca["[object WeakMap]"]=!1;const ka=function e(t,n,r,i,s,o){var a,c=1&n,l=2&n,u=4&n;if(r&&(a=s?r(t,i,s,o):r(t)),void 0!==a)return a;if(!ze(t))return t;var d=zt(t);if(d){if(a=aa(t),!c)return ea(t,a)}else{var h=Hn(t),f=h==Ea||"[object GeneratorFunction]"==h;if(nn(t))return Zo(t,c);if(h==Oa||h==$a||f&&!s){if(a=l||f?{}:ba(t),!c)return l?ia(t,Ko(a,t)):ta(t,qo(a,t))}else{if(!Ca[h])return s?t:{};a=ga(t,h,c)}}o||(o=new xt);var p=o.get(t);if(p)return p;o.set(t,a),ja(t)?t.forEach((function(i){a.add(e(i,n,r,i,t,o))})):Sa(t)&&t.forEach((function(i,s){a.set(s,e(i,n,r,s,t,o))}));var m=d?void 0:(u?l?sa:$n:l?Vo:jn)(t);return Bo(m||t,(function(i,s){m&&(i=t[s=i]),_r(a,s,e(i,n,r,s,t,o))})),a};const Ta=function(e){return ka(e,5)};const Na=function(e){return"string"==typeof e||!zt(e)&&Wt(e)&&"[object String]"==Re(e)};var Ma=n(6691),Ia=n.n(Ma);const Pa=function(e,t,n){(void 0!==n&&!he(e[t],n)||void 0===n&&!(t in e))&&yr(e,t,n)};const Da=function(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===n(s[c],c,s))break}return t}};const Ra=Da();const za=function(e){return Wt(e)&&An(e)};var La=Function.prototype,Ua=Object.prototype,Ba=La.toString,Fa=Ua.hasOwnProperty,qa=Ba.call(Object);const Ha=function(e){if(!Wt(e)||"[object Object]"!=Re(e))return!1;var t=na(e);if(null===t)return!0;var n=Fa.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Ba.call(n)==qa};const Ga=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};const Wa=function(e){return Fo(e,Vo(e))};const Va=function(e,t,n,r,i,s,o){var a=Ga(e,n),c=Ga(t,n),l=o.get(c);if(l)Pa(e,n,l);else{var u=s?s(a,c,n+"",e,t,o):void 0,d=void 0===u;if(d){var h=zt(c),f=!h&&nn(c),p=!h&&!f&&mn(c);u=c,h||f||p?zt(a)?u=a:za(a)?u=ea(a):f?(d=!1,u=Zo(c,!0)):p?(d=!1,u=ma(c,!0)):u=[]:Ha(c)||Xt(c)?(u=a,Xt(a)?u=Wa(a):ze(a)&&!Le(a)||(u=ba(c))):d=!1}d&&(o.set(c,u),i(u,c,r,s,o),o.delete(c)),Pa(e,n,u)}};const Ka=function e(t,n,r,i,s){t!==n&&Ra(n,(function(o,a){if(s||(s=new xt),ze(o))Va(t,n,a,r,e,i,s);else{var c=i?i(Ga(t,a),o,a+"",t,n,s):void 0;void 0===c&&(c=o),Pa(t,a,c)}}),Vo)};const Ja=function(e,t){return Ur(Mr(e,t,Pr),e+"")};const Ya=function(e,t,n){if(!ze(n))return!1;var r=typeof t;return!!("number"==r?An(n)&&sn(t,n.length):"string"==r&&t in n)&&he(n[t],e)};const Xa=function(e){return Ja((function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,o&&Ya(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t}))};var Qa=Xa((function(e,t,n){Ka(e,t,n)}));const Za=Qa;var ec=Xa((function(e,t,n,r){Ka(e,t,n,r)}));const tc=ec,nc=Math.max,rc=Math.min;function ic(e){if("number"==typeof e)return e;if("string"==typeof e){const t=parseFloat(e);return isNaN(t)?0:t}return 0}const sc=function(e,t,n={}){let r,i,s,o,a,c,l=0,u=!1,d=n.promise?ue():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const s=r,a=i,c=d;return r=i=void 0,l=t,o=e.apply(a,s),n.promise&&(c.resolve(o),d=ue()),n.promise?c:o}function f(e){const n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=s}function p(){const e=Date.now();if(f(e))return m(e);a=setTimeout(p,function(e){const n=t-(e-c);return u?rc(n,s-(e-l)):n}(e))}function m(e){return a=void 0,r?h(e):(r=i=void 0,n.promise?d:o)}function g(e,t){if(Array.isArray(e)&&Array.isArray(t))return(null==n?void 0:n.dedupeArrays)?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function v(){const e=Date.now(),s=f(e);var m;if(m=Array.from(arguments),r=(null==r?void 0:r.length)?m.length?(null==n?void 0:n.concatArrays)||(null==n?void 0:n.dedupeArrays)?tc(r,m,g):Za(r,m):r:m||[],i=this,c=e,s){if(void 0===a)return function(e){return l=e,a=setTimeout(p,t),n.promise?d:o}(c);if(u)return clearTimeout(a),a=setTimeout(p,t),h(c)}return void 0===a&&(a=setTimeout(p,t)),n.promise?d:o}return t=ic(t)||0,function(e){const t=typeof e;return null!=e&&("object"===t||"function"===t)}(n)&&(u="maxWait"in n,s=u?nc(ic(n.maxWait)||0,t):s),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,r=c=i=a=void 0},v.flush=function(){return void 0===a?o:m(Date.now())},v};const oc=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))};function ac(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function cc(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}const lc=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}};var uc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dc=/^~~local_forage_type~([^~]+)~/,hc="__lfsc__:",fc="arbf",pc="blob",mc="si08",gc="ui08",vc="uic8",yc="si16",bc="si32",_c="ur16",wc="ui32",Sc="fl32",xc="fl64",Ac=Object.prototype.toString;function jc(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=uc.indexOf(e[t]),r=uc.indexOf(e[t+1]),i=uc.indexOf(e[t+2]),s=uc.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&s;return l}function $c(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=uc[n[t]>>2],r+=uc[(3&n[t])<<4|n[t+1]>>4],r+=uc[(15&n[t+1])<<2|n[t+2]>>6],r+=uc[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var Ec={serialize:function(e,t){var n="";if(e&&(n=Ac.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===Ac.call(e.buffer))){var r,i=hc;e instanceof ArrayBuffer?(r=e,i+=fc):(r=e.buffer,"[object Int8Array]"===n?i+=mc:"[object Uint8Array]"===n?i+=gc:"[object Uint8ClampedArray]"===n?i+=vc:"[object Int16Array]"===n?i+=yc:"[object Uint16Array]"===n?i+=_c:"[object Int32Array]"===n?i+=bc:"[object Uint32Array]"===n?i+=wc:"[object Float32Array]"===n?i+=Sc:"[object Float64Array]"===n?i+=xc:t(new Error("Failed to get type for BinaryArray"))),t(i+$c(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+$c(this.result);t(hc+pc+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,9)!==hc)return JSON.parse(e);var t,n=e.substring(13),r=e.substring(9,13);if(r===pc&&dc.test(n)){var i=n.match(dc);t=i[1],n=n.substring(i[0].length)}var s=jc(n);switch(r){case fc:return s;case pc:return lc([s],{type:t});case mc:return new Int8Array(s);case gc:return new Uint8Array(s);case vc:return new Uint8ClampedArray(s);case yc:return new Int16Array(s);case _c:return new Uint16Array(s);case bc:return new Int32Array(s);case wc:return new Uint32Array(s);case Sc:return new Float32Array(s);case xc:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}},stringToBuffer:jc,bufferToString:$c};function Oc(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Cc(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const kc={serializer:{serialize:Ec.serialize,deserialize:Ec.deserialize}};const Tc={_driver:"sessionStorageWrapper",_initStorage:function(e){if(kc.keyPrefix=Cc(e,this._defaultConfig),e)for(const t in e)kc[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const n=this.ready().then((function(){const t=kc.keyPrefix,n=t.length,r=sessionStorage.length;let i=1;for(let s=0;s<r;s++){const r=sessionStorage.key(s);if(0!==r.indexOf(t))continue;let o=sessionStorage.getItem(r);if(o&&(o=kc.serializer.deserialize(o)),o=e(o,r.substring(n),i++),void 0!==o)return o}}));return oc(n,t),n},getItem:function(e,t){e=cc(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(kc.keyPrefix+e);return t&&(t=kc.serializer.deserialize(t)),t}));return oc(n,t),n},setItem:function(e,t,n){return(r=function*(){e=cc(e),yield this.ready();const r=t=null!=t?t:null;return kc.serializer.serialize(t,((t,i)=>{if(i)throw i;try{sessionStorage.setItem(kc.keyPrefix+e,t),oc(Promise.resolve(r),n)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}})),t},function(){var e=this,t=arguments;return new Promise((function(n,i){var s=r.apply(e,t);function o(e){Oc(s,n,i,o,a,"next",e)}function a(e){Oc(s,n,i,o,a,"throw",e)}o(void 0)}))}).call(this);var r},removeItem:function(e,t){e=cc(e);const n=this.ready().then((function(){sessionStorage.removeItem(kc.keyPrefix+e)}));return oc(n,t),n},clear:function(e){const t=this.ready().then((function(){const e=kc.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return oc(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return oc(t,e),t},key:function(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(kc.keyPrefix.length)),t}));return oc(n,t),n},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(kc.keyPrefix)&&t.push(e.substring(kc.keyPrefix.length))}return t}));return oc(t,e),t},dropInstance:function(e,t){if(t=ac.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let r;return r=e.name?new Promise((function(t){e.storeName?t(Cc(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),oc(r,t),r}},Nc=Tc;var Mc=n(1273);function Ic(e){return Ic.result?Ic.result:e&&"function"==typeof e.getSerializer?(Ic.result=e.getSerializer(),Ic.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function Pc(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function Dc(e,t){var n=this.getItem(e).then((function(t){return{key:e,value:t}}));return Pc(n,t),n}function Rc(e){var t=this,n=new Promise((function(n,r){for(var i=[],s=0,o=e.length;s<o;s++)i.push(Dc.call(t,e[s]));Promise.all(i).then((function(e){for(var t={},r=0,i=e.length;r<i;r++){var s=e[r];t[s.key]=s.value}n(t)})).catch(r)}));return n}function zc(){var e={};return this.iterate((function(t,n){e[n]=t})).then((function(){return e}))}var Lc="undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0;function Uc(e){e=e.slice();var t=this;function n(e,t){return e<t?-1:e>t?1:0}var r=new Promise((function(r,i){t.ready().then((function(){var s,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),c=e.sort(n),l=Lc.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(s=a.getAll(l)).onsuccess=function(){var e=s.result;void 0===e&&(e=null),r(e)};else{s=a.openCursor(l);var u={},d=0;s.onsuccess=function(){var e=s.result;if(e){for(var t=e.key;t>c[d];)if(++d===c.length)return void r(u);if(t===c[d]){var n=e.value;void 0===n&&(n=null),u[t]=n,e.continue()}else e.continue(c[d])}else r(u)}}s.onerror=function(){i(s.error)}})).catch(i)}));return r}function Bc(e){var t=this,n=new Promise((function(n,r){t.ready().then((function(){return Ic(t)})).then((function(i){var s=t._dbInfo;s.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+s.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var r={},s=t.rows,o=0,a=s.length;o<a;o++){var c=s.item(o),l=c.value;l&&(l=i.deserialize(l)),r[c.key]=l}n(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return n}function Fc(e,t){var n,r=this;if(arguments.length&&null!==e){var i=r.driver();n=i===r.INDEXEDDB?Uc.apply(r,arguments):i===r.WEBSQL?Bc.apply(r,arguments):Rc.apply(r,arguments)}else n=zc.apply(r);return Pc(n,t),n}function qc(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=Fc,t.getItems.indexedDB=function(){return Uc.apply(this,arguments)},t.getItems.websql=function(){return Bc.apply(this,arguments)},t.getItems.generic=function(){return Rc.apply(this,arguments)})}qc(Ia());function Hc(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Gc(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Wc(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Gc(s,r,i,o,a,"next",e)}function a(e){Gc(s,r,i,o,a,"throw",e)}o(void 0)}))}}const Vc=Uo._driver;Ia().defineDriver(Uo),(0,Mc.extendPrototype)(Ia()),qc(Ia());class Kc{initStore(e,t){return Wc((function*(){if("session"===e)yield Ia().setDriver(Nc._driver);else if("local"===e)yield Ia().config({driver:Ia().LOCALSTORAGE});else if("in_memory"===e)yield Ia().config({driver:Vc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=Ia(),t&&(this.store.debouncedSetItems=sc((e=>this.store.setItems(e)),50,{promise:!0}))})).call(this)}flush(){var e;return null===(e=this.store.debouncedSetItems)||void 0===e?void 0:e.flush()}clear(){return Wc((function*(){yield this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(yield this.store.keys()).filter((t=>e.test(t)));yield Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))})).call(this)}sync(){const e=this;function t(t,n,r){return Wc((function*(){let i,s,o,a;const c=n.collection;["patch","update"].includes(t)&&(a=Ta(n.attributes)),yield e.storeInitialized;try{const s=n.attributes;switch(t){case"read":i=void 0!==n.id?yield e.find(n):yield e.findAll();break;case"create":i=yield e.create(n,r);break;case"patch":case"update":r.wait&&(n.attributes=a),o=e.update(n),r.wait&&(n.attributes=s),i=yield o;break;case"delete":i=yield e.destroy(n,c)}}catch(t){s=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(i){if(r&&r.success){const e="read"===t?i:null;r.success(e,r)}}else s=s||"Record Not Found",r&&r.error&&r.error(s)}))()}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),r=this.getItemName(e.id);return n.includes(r)||n.push(r),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const r={};return r[this.name]=t,r}save(e){return Wc((function*(){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=yield this.store.setItem(t,e.toJSON());return yield this.addCollectionReference(e,e.collection),n}})).call(this)}create(e,t){return e.id||(e.id=Hc()+Hc()+"-"+Hc()+"-"+Hc()+"-"+Hc()+"-"+Hc()+Hc()+Hc(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}findAll(){return Wc((function*(){const e=yield this.store.getItem(this.name);if(null==e?void 0:e.length){const t=yield this.store.getItems(e);return Object.values(t)}return[]})).call(this)}destroy(e,t){return Wc((function*(){return yield this.flush(),yield this.store.removeItem(this.getItemName(e.id)),yield this.removeCollectionReference(e,t),e})).call(this)}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}constructor(e,t,n=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");Na(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=sc((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}}Kc.sessionStorageInitialized=Ia().defineDriver(Nc),Kc.localForage=Ia();const Jc=Kc;var Yc=n(5186),Xc=n(9402);const Qc=Zr;function Zc(){if(Ao.state.config.get("trusted")){return"sessionStorage"===Qc.get("persistent_store")?"session":"persistent"}return"session"}function el(e){return"persistent"===e&&"IndexedDB"===Qc.get("persistent_store")}function tl(e,t){const n=t||Zc(),r=Ao.storage[n];if(void 0===r)throw new TypeError(`createStore: Could not find store for ${e}`);return new Jc(e,r,el(t))}function nl(e,t,n){const r=n||Zc();if(e.browserStorage=tl(t,r),el(r)){const t=()=>e.browserStorage.flush(),n=ii();window.addEventListener(n,t),e.on("destroy",(()=>window.removeEventListener(n,t))),e.listenTo(Ao,"beforeLogout",t)}}function rl(){return("WebSocket"in window||"MozWebSocket"in window)&&Zr.get("websocket_url")?Zr.get("websocket_url"):Zr.get("bosh_service_url")?Zr.get("bosh_service_url"):""}function il(e){if("string"!=typeof e)return!1;return!(e.split("/").length-1>1)&&(2===e.split("@").filter((e=>!!e)).length&&!e.startsWith("@")&&!e.endsWith("@"))}function sl(e){return!e.startsWith("@")&&!e.endsWith("@")}function ol(e,t){return"string"==typeof e&&"string"==typeof t&&Bs.getBareJidFromJid(e).toLowerCase()===Bs.getBareJidFromJid(t).toLowerCase()}function al(e,t){return"string"==typeof e&&"string"==typeof t&&Bs.getDomainFromJid(e).toLowerCase()===Bs.getDomainFromJid(t).toLowerCase()}function cl(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e}function ll(e,t=!1){return t?e===Ao.session.get("full_jid"):Bs.getBareJidFromJid(e)===Ao.session.get("bare_jid")}function ul(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function dl(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){ul(s,r,i,o,a,"next",e)}function a(e){ul(s,r,i,o,a,"throw",e)}o(void 0)}))}}function hl(e){e.pluggable.initialized_plugins=[];const t=mo.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}function fl(e){return dl((function*(){const t="converse.client-config",n=new ae.Model({id:t,trusted:!0});n.browserStorage=tl(t,"session"),Object.assign(e,{config:n}),Object.assign(e.state,{config:n}),yield new Promise((e=>n.fetch({success:e,error:e}))),e.api.trigger("clientConfigInitialized")}))()}function pl(e){return dl((function*(){yield Jc.sessionStorageInitialized,e.storage.session=Jc.localForage.createInstance({name:ri()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}))()}function ml(e,t,n="persistent"){const{api:r}=e;if("sessionStorage"===r.settings.get("persistent_store"))return void(e.storage[n]=e.storage.session);if("BrowserExtLocal"===r.settings.get("persistent_store"))return Jc.localForage.defineDriver(Yc.A).then((()=>Jc.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage[n]=Jc.localForage);if("BrowserExtSync"===r.settings.get("persistent_store"))return Jc.localForage.defineDriver(Xc.A).then((()=>Jc.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage[n]=Jc.localForage);const i={name:ri()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===r.settings.get("persistent_store")?(i.description="localStorage instance",i.driver=[Jc.localForage.LOCALSTORAGE]):"IndexedDB"===r.settings.get("persistent_store")&&(i.description="indexedDB instance",i.driver=[Jc.localForage.INDEXEDDB]),e.storage[n]=Jc.localForage.createInstance(i)}function gl(e,t){const{api:n,session:r}=e;n.settings.get("authentication")===Js||Bs.getResourceFromJid(t)||(t=t.toLowerCase()+`/converse.js-${Math.floor(139749528*Math.random()).toString()}`);const i=Bs.getBareJidFromJid(t),s=Bs.getResourceFromJid(t),o=Bs.getDomainFromJid(t);Object.assign(e,{jid:t,bare_jid:i,resource:s,domain:o}),r.save({jid:t,bare_jid:i,resource:s,domain:o,active:!0}),n.connection.get().jid=t}function vl(e){return dl((function*(){return yield yl(Ao,e),Ao.api.trigger("setUserJID"),e}))()}function yl(e,t){return dl((function*(){var n;const r=e.api.settings.get("connection_options").worker,i=Bs.getBareJidFromJid(t).toLowerCase(),s=`converse.session-${i}`;(null===(n=e.session)||void 0===n?void 0:n.get("id"))!==s?(ml(e,i),e.session.set({id:s}),nl(e.session,s,r?"persistent":"session"),yield new Promise((t=>e.session.fetch({success:t,error:t}))),!r&&e.session.get("active")&&(e.session.clear(),e.session.save({id:s})),gl(e,t),window.addEventListener(ii(),(()=>jl(e.session,{active:!1}))),e.api.trigger("userSessionInitialized")):gl(e,t)}))()}function bl(e){e.api.trigger("registeredGlobalEventHandlers")}function _l(e){return dl((function*(){var t;const{api:n}=e;yield n.trigger("cleanup",{synchronous:!0}),function(e){e.api.trigger("unregisteredGlobalEventHandlers")}(e),null===(t=n.connection.get())||void 0===t||t.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&n.promises.add("initialized")}))()}function wl(e=0){return new Promise(Lo(((e,t)=>dl((function*(){let n=new XMLHttpRequest;n.open("GET",Ao.api.settings.get("credentials_url"),!0),n.setRequestHeader("Accept","application/json, text/javascript"),n.onload=()=>{if(n.status>=200&&n.status<400){const t=JSON.parse(n.responseText);vl(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${n.status}: ${n.responseText}`))},n.onerror=t,n=yield Ao.api.hook("beforeFetchLoginCredentials",this,n),n.send()})).call(this)),e))}function Sl(e,t){return dl((function*(){const{api:n}=Ao,{credentials:r}=yield n.hook("beforeAttemptNonPreboundSession",this,{credentials:e,automatic:t});if(r)return Al(r);if(n.settings.get("authentication")===Qs){const t=Ao.session.get("jid");if(e)return Al(e);if(n.settings.get("credentials_url"))return Al(yield dl((function*(){let e,t=0;for(;!e;){try{e=yield wl(t)}catch(e){Q.error("Could not fetch login credentials"),Q.error(e)}t=2e3}return e}))());if(t&&(n.settings.get("password")||n.connection.get().pass))return Al();if(n.settings.get("reuse_scram_keys")){const e=yield dl((function*(){const e=localStorage.getItem("conversejs-session-jid");if(!e)return null;yield vl(e);const t=(yield xl(e)).get("scram_keys");return t?{jid:e,password:t}:null}))();if(e)return Al(e)}if(!ri()&&"credentials"in navigator){const e=yield dl((function*(){if(!localStorage.getItem("conversejs-session-jid"))return null;try{const e=yield navigator.credentials.get({password:!0});if(e&&"password"==e.type&&il(e.id))return yield vl(e.id),{jid:e.id,password:e.password}}catch(e){return Q.error(e),null}}))();if(e)return Al(e)}ri()||Q.debug("attemptNonPreboundSession: Couldn't find credentials to log in with")}else![Js,Xs].includes(n.settings.get("authentication"))||t&&!n.settings.get("auto_login")||Al()})).call(this)}function xl(e){return dl((function*(){var t;const n=`converse.scram-keys-${Bs.getBareJidFromJid(e)}`;if((null===(t=Ao.state.login_info)||void 0===t?void 0:t.get("id"))===n)return Ao.state.login_info;const r=new ae.Model({id:n});return Ao.state.login_info=r,nl(r,n,"persistent"),yield new Promise((e=>r.fetch({success:e,error:e}))),r}))()}function Al(e){return dl((function*(){const{api:t}=Ao,n=Ao.session.get("jid"),r=t.connection.get();if([Js,Xs].includes(t.settings.get("authentication"))){if(!n)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");r.reconnecting||r.reset(),r.connect(n.toLowerCase())}else if(t.settings.get("authentication")===Qs){var i;const s=null!==(i=null==e?void 0:e.password)&&void 0!==i?i:(null==r?void 0:r.pass)||t.settings.get("password");if(!s){if(t.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return r.setDisconnectionCause(Bs.Status.AUTHFAIL,void 0,!0),void t.connection.disconnect()}let o;if(r.reconnecting||(r.reset(),r.service=rl()),Ao.state.config.get("trusted")&&n&&t.settings.get("reuse_scram_keys")&&!(null==s?void 0:s.ck)){const e=yield xl(n);o=(t,n)=>{const{scram_keys:i}=r;i&&e.save({scram_keys:i}),r.onConnectStatusChanged(t,n)}}r.connect(n,s,o)}}))()}function jl(e,t,n){Jr(e)?e.save(t,n):e.set(t,n)}function $l(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function El(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){$l(s,r,i,o,a,"next",e)}function a(e){$l(s,r,i,o,a,"throw",e)}o(void 0)}))}}const Ol=Object.keys(Bs.Status).reduce(((e,t)=>Math.max(e,Bs.Status[t])),0);Bs.Status.RECONNECTING=Ol+1;class Cl extends Bs.Connection{xmlInput(e){Q.debug(e.outerHTML,"color: darkgoldenrod")}xmlOutput(e){Q.debug(e.outerHTML,"color: darkcyan")}bind(){var e=this,t=()=>super.bind;return El((function*(){const{api:n}=Ao;yield n.trigger("beforeResourceBinding",{synchronous:!0}),t().call(e)}))()}onDomainDiscovered(e){return El((function*(){const{api:t}=Ao,n=yield e.text(),r=(new DOMParser).parseFromString(n,"text/xml").firstElementChild;if("XRD"!=r.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=r.namespaceURI)return Q.info("Could not discover XEP-0156 connection methods");const i=ee()('Link[rel="urn:xmpp:alt-connections:xbosh"]',r),s=ee()('Link[rel="urn:xmpp:alt-connections:websocket"]',r),o=i.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("https:"))),a=s.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("wss:")));0===o.length&&0===a.length?Q.info("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(t.settings.set("websocket_url",a.pop()),t.settings.set("bosh_service_url",o.pop()),this.service=t.settings.get("websocket_url")||t.settings.get("bosh_service_url"),this.setProtocol())})).call(this)}discoverConnectionMethods(e){return El((function*(){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},n=`https://${e}/.well-known/host-meta`;let r;try{r=yield fetch(n,t)}catch(e){return Q.info(`Failed to discover alternative connection methods at ${n}`),void Q.error(e)}r.status>=200&&r.status<400?yield this.onDomainDiscovered(r):Q.info("Could not discover XEP-0156 connection methods")})).call(this)}connect(e,t,n){var r=this,i=()=>super.connect;return El((function*(){const{__:s,api:o}=Ao;if(o.settings.get("discover_connection_methods")){const t=Bs.getDomainFromJid(e);yield this.discoverConnectionMethods(t)}if(!o.settings.get("bosh_service_url")&&!o.settings.get("websocket_url"))return o.settings.set("show_connection_url_input",!0),void(n||this.onConnectStatusChanged.bind(this))(Bs.Status.DISCONNECTED,s("Could not automatically determine a connection URL"));i().call(r,e,t,n||this.onConnectStatusChanged,qs)})).call(this)}disconnect(e){super.disconnect(e),this.send_initial_presence=!0}switchTransport(){return El((function*(){const{api:e}=Ao,t=Ao.session.get("bare_jid");e.connection.isType("websocket")&&e.settings.get("bosh_service_url")?(yield vl(t),this._proto._doDisconnect(),this._proto=new Bs.Bosh(this),this.service=e.settings.get("bosh_service_url")):e.connection.isType("bosh")&&e.settings.get("websocket_url")&&(e.settings.get("authentication")===Js?yield vl(e.settings.get("jid")):yield vl(t),this._proto._doDisconnect(),this._proto=new Bs.Websocket(this),this.service=e.settings.get("websocket_url"))})).call(this)}reconnect(){return El((function*(){const{api:e}=Ao;Q.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.reconnecting=!0,yield ai(Ao);const t=Ao.state.connfeedback.get("connection_status");t===Bs.Status.CONNFAIL?this.switchTransport():t===Bs.Status.AUTHFAIL&&e.settings.get("authentication")===Js&&(yield vl(e.settings.get("jid"))),e.trigger("will-reconnect"),e.settings.get("authentication")===Js&&(yield ci(Ao));const n=Ao.session.get("jid");return e.user.login(n)})).call(this)}onConnected(e){return El((function*(){const{api:t}=Ao;if(delete this.reconnecting,this.flush(),yield vl(this.jid),Ao.state.config.get("trusted")){const e=Ao.session.get("bare_jid");localStorage.setItem("conversejs-session-jid",e)}yield t.trigger("afterResourceBinding",e,{synchronous:!0}),e?t.trigger("reconnected"):t.trigger("connected")})).call(this)}setDisconnectionCause(e,t,n){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||n)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,Ao.state.connfeedback.set({connection_status:e,message:t})}finishDisconnection(){return El((function*(){this.setConnectionStatus(Bs.Status.DISCONNECTED,this.disconnection_reason);const{api:e}=Ao;Q.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),ai(Ao),yield ci(Ao),e.connection.destroy(),e.trigger("disconnected")})).call(this)}onDisconnected(){const{api:e}=Ao;if(!e.settings.get("auto_reconnect"))return this.finishDisconnection();{const t=this.disconnection_reason;if(this.disconnection_cause===Bs.Status.AUTHFAIL)return e.settings.get("credentials_url")||e.settings.get("authentication")===Js?e.connection.reconnect():this.finishDisconnection();if(this.status===Bs.Status.CONNECTING){const{__:e}=Ao;return this.setConnectionStatus(Bs.Status.CONNFAIL,e("An error occurred while connecting to the chat server.")),this.finishDisconnection()}if(this.disconnection_cause===Zs||t===Bs.ErrorCondition.NO_AUTH_MECH||"host-unknown"===t||"remote-connection-failed"===t)return this.finishDisconnection();e.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:n}=Ao;var r;if(Q.debug(`Status changed to: ${po[e]}`),e===Bs.Status.ATTACHFAIL)this.setConnectionStatus(e),null===(r=this.worker_attach_promise)||void 0===r||r.resolve(!1);else if(e===Bs.Status.CONNECTED||e===Bs.Status.ATTACHED){var i,s;if((null===(i=this.worker_attach_promise)||void 0===i?void 0:i.isResolved)&&this.status===Bs.Status.ATTACHED)return;this.setConnectionStatus(e),null===(s=this.worker_attach_promise)||void 0===s||s.resolve(!0),this.setDisconnectionCause(),this.reconnecting?(Q.debug(e===Bs.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(Q.debug(e===Bs.Status.CONNECTED?"Connected":"Attached"),this.restored&&(this.send_initial_presence=!1),this.onConnected())}else if(e===Bs.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===Bs.Status.BINDREQUIRED)this.bind();else if(e===Bs.Status.ERROR)this.setConnectionStatus(e,n("An error occurred while connecting to the chat server."));else if(e===Bs.Status.CONNECTING)this.setConnectionStatus(e);else if(e===Bs.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===Bs.Status.AUTHFAIL)t||(t=n("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===Bs.Status.CONNFAIL){var o;let r=t;"host-unknown"===t||"remote-connection-failed"==t?r=n("We could not connect to %1$s, is your XMPP address correct?",Bs.getDomainFromJid(this.jid)):"policy-violation"===t?r=n("The XMPP server rejected the connection because of a policy violation"):void 0!==t&&t===(null==Bs||null===(o=Bs.ErrorCondition)||void 0===o?void 0:o.NO_AUTH_MECH)&&(r=n("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,r),this.setDisconnectionCause(e,t)}else e===Bs.Status.DISCONNECTING&&(this.setConnectionStatus(e),this.setDisconnectionCause(e,t))}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof Bs.Websocket:"bosh"===e.toLowerCase()?Bs.Bosh&&this._proto instanceof Bs.Bosh:void 0}hasResumed(){var e;const{api:t}=Ao;return(null===(e=t.settings.get("connection_options"))||void 0===e?void 0:e.worker)||this.isType("bosh")?Ao.state.connfeedback.get("connection_status")===Bs.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=ue(),this.worker_attach_promise}constructor(e,t){super(e,t),this.send_initial_presence=!0,this.debouncedReconnect=Lo(this.reconnect,3e3)}}class kl extends Cl{get _sasl_mechanism(){return new Bs.SASLSHA256}_processRequest(){}sendIQ(e,t,n){var r,i;e=null!==(i=null===(r=e.tree)||void 0===r?void 0:r.call(e))&&void 0!==i?i:e,this.IQ_stanzas.push(e);const s=super.sendIQ(e,t,n);return this.IQ_ids.push(s),s}send(e){var t,n;return e=null!==(n=null===(t=e.tree)||void 0===t?void 0:t.call(e))&&void 0!==n?n:e,this.sent_stanzas.push(e),super.send(e)}bind(){return El((function*(){const{api:e}=Ao;yield e.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,this._changeConnectStatus(Bs.Status.CONNECTED)})).call(this)}constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=Bs.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstElementChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(Bs.Status.BINDREQUIRED)}}}let Tl;const Nl={explicitResourceBinding:!0},Ml={init(e){if(e&&(null==Tl?void 0:Tl.jid)&&al(Tl.jid,e))return Tl;if(!Zr.get("bosh_service_url")&&Zr.get("authentication")===to)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");const t=ri()?kl:Cl;return Tl=new t(rl(),Object.assign(Nl,Zr.get("connection_options"),{keepalive:Zr.get("keepalive")})),function(){const e=Zr.get("loglevel");Bs.setLogLevel(Bs.LogLevel[e.toUpperCase()]);const t={};t[Bs.LogLevel.DEBUG]="debug",t[Bs.LogLevel.INFO]="info",t[Bs.LogLevel.WARN]="warn",t[Bs.LogLevel.ERROR]="error",t[Bs.LogLevel.FATAL]="fatal",Bs.log=(e,n)=>Q.log(n,t[e]),Bs.error=e=>Q.error(e)}(),$o.trigger("connectionInitialized"),Tl},get:()=>Tl,destroy(){this.disconnect(),null==Tl||Tl.disconnect(),Tl=void 0},authenticated:()=>(null==Tl?void 0:Tl.authenticated)&&!0,connected:()=>(null==Tl?void 0:Tl.connected)&&!0,disconnect(){null==Tl||Tl.disconnect()},reconnect:()=>(Tl.setConnectionStatus(Bs.Status.RECONNECTING,"The connection has dropped, attempting to reconnect."),(null==Tl?void 0:Tl.reconnecting)?Tl.debouncedReconnect():Tl.reconnect()),isType:e=>Tl.isType(e)};function Il(e,t){let n;return function(...r){clearTimeout(n),n=setTimeout((()=>{e.apply(this,r)}),t)}}function Pl(e,t){clearTimeout(e),clearInterval(t)}function Dl(e,t=300,n=3){try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const r=ue(),i=new Error;const s=setInterval((function(){try{const t=e();t&&(Pl(o,s),r.resolve(t))}catch(e){Pl(o,s),r.reject(e)}}),n);const o=setTimeout((function(){Pl(o,s);const e=`Wait until promise timed out: \n\n${i.stack}`;console.trace(),Q.error(e),r.reject(new Error(e))}),t);return r}const Rl={promises:{add(e,t=!0){(e=Array.isArray(e)?e:[e]).forEach((e=>{const n=ue();n.replace=t,Ao.promises[e]=n}))}},waitUntil(e){if(Wr(e))return Dl(e);{const t=Ao.promises[e];return void 0===t?null:t}}};class zl extends Error{}class Ll extends Error{constructor(e){super(e),this.retry_event_id=null}}class Ul extends Error{constructor(e,t,n){var r,i;super(null!==(i=null===(r=t.querySelector("text"))||void 0===r?void 0:r.textContent)&&void 0!==i?i:""),this.name=e,this.message=e,this.type=t.getAttribute("type"),this.el=t,this.extra=n}}class Bl extends Error{constructor(e,t){super(t),this.name="StanzaParseError",this.stanza=e}}class Fl extends Ul{}class ql extends Ul{}class Hl extends Ul{}class Gl extends Ul{}class Wl extends Ul{}class Vl extends Ul{}class Kl extends Ul{}class Jl extends Ul{}class Yl extends Ul{}class Xl extends Ul{}class Ql extends Ul{}class Zl extends Ul{}class eu extends Ul{}class tu extends Ul{}class nu extends Ul{}class ru extends Ul{}class iu extends Ul{}class su extends Ul{}class ou extends Ul{}class au extends Ul{}class cu extends Ul{}class lu extends Ul{}const uu={send(e){const{api:t}=Ao;if(!t.connection.connected())return Q.warn("Not sending stanza because we're not connected!"),void Q.warn(Bs.serialize(e));const n=e instanceof Element?e:e.tree();if("iq"===n.tagName)return t.sendIQ(n);t.connection.get().send(n),t.trigger("send",n)},sendIQ(e,t,n=!0){const{api:r}=Ao;if(!r.connection.connected())throw new Error("Not sending IQ stanza because we're not connected!");const i=r.connection.get();let s;const o=e instanceof Element?e:e.tree();return["get","set"].includes(o.getAttribute("type"))?(t=t||r.settings.get("stanza_timeout"),n?(s=new Promise(((e,n)=>i.sendIQ(o,e,n,t))),s.catch((e=>{if(null===e)throw new Ll(`Timeout error after ${t}ms for the following IQ stanza: ${Bs.serialize(o)}`)}))):s=new Promise((e=>i.sendIQ(o,e,e,t)))):(i.sendIQ(o),s=Promise.resolve()),r.trigger("send",o),s}};function du(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function hu(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){du(s,r,i,o,a,"next",e)}function a(e){du(s,r,i,o,a,"throw",e)}o(void 0)}))}}function fu(){return hu((function*(){if(oi(Ao)){const{chatboxes:e}=Ao.state;yield Promise.all(e.map((e=>{var t;return null===(t=e.messages)||void 0===t?void 0:t.clearStore({silent:!0})}))),e.clearStore({silent:!0},(e=>e.get("type")!==fo))}}))()}function pu(e,t,n){return hu((function*(){let r;e=Bs.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{r=new n(t,{collection:Ao.state.chatboxes})}catch(e){return Q.error(e),null}return yield r.initialized,r.isValid()?(Ao.state.chatboxes.add(r),r):(r.destroy(),null)}))()}function mu(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function gu(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){mu(s,r,i,o,a,"next",e)}function a(e){mu(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{waitUntil:vu}=Rl,yu={},bu={create(e){return gu((function*(e=[],t={},n){return yield vu("chatBoxesFetched"),"string"==typeof e?pu(e,t,n):Promise.all(e.map((e=>pu(e,t,n))))})).apply(this,arguments)},get:e=>gu((function*(){yield vu("chatBoxesFetched");const{chatboxes:t}=Ao.state;return void 0===e?t.models:"string"==typeof e?t.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),t.models.filter((t=>e.includes(t.get("jid")))))}))(),registry:{add(e,t){yu[e]=t},get:e=>yu[e]}};function _u(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function wu(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){_u(s,r,i,o,a,"next",e)}function a(e){_u(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{waitUntil:Su}=Rl,xu={create(e,t={}){if(!(t="string"==typeof t?{nick:t}:t||{}).nick&&Zr.get("muc_nickname_from_jid")){const e=Ao.session.get("bare_jid");t.nick=Bs.getNodeFromJid(e)}if(void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?xu.get(cl(e),t,!0):Promise.all(e.map((e=>xu.get(cl(e),t,!0))))},open(e){return wu((function*(e,t={},n=!1){if(yield Su("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw Q.error(e),new TypeError(e)}if("string"==typeof e){const r=yield xu.get(e,t,!0);return!t.hidden&&(null==r||r.maybeShow(n)),r}{const r=yield Promise.all(e.map((e=>r.get(e,t,!0))));return r.forEach((e=>!t.hidden&&e.maybeShow(n))),r}})).apply(this,arguments)},get(e){return wu((function*(e,t={},n=!1){function r(e){return wu((function*(){e=cl(e);let r=yield bu.get(e);return!r&&n?r=yield bu.create(e,t,Ao.exports.MUC):(r=r&&r.get("type")===uo?r:null,r&&Object.keys(t).length&&r.save(t)),r}))()}if(yield Su("chatBoxesFetched"),void 0===e){return(yield bu.get()).filter((e=>e.get("type")===uo))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))})).apply(this,arguments)}},Au={rooms:xu};function ju(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{waitUntil:$u}=Rl,{send:Eu}=uu,{rooms:Ou}=Au,Cu={presence:{send(e,t){return(n=function*(){yield $u("statusInitialized");let n=[];t&&(n=Array.isArray(t)?t:[t]);const r=Ao.state.profile,i=yield r.constructPresence(e);n.map((e=>{var t;return null!==(t=null==e?void 0:e.tree())&&void 0!==t?t:e})).forEach((e=>i.cnode(e).up())),Eu(i);const{show:s,type:o}=e||{};!s&&o||(yield Ou.get()).forEach((t=>t.sendStatusPresence(e,n)))},function(){var e=this,t=arguments;return new Promise((function(r,i){var s=n.apply(e,t);function o(e){ju(s,r,i,o,a,"next",e)}function a(e){ju(s,r,i,o,a,"throw",e)}o(void 0)}))})();var n}}};function ku(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Tu(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){ku(s,r,i,o,a,"next",e)}function a(e){ku(s,r,i,o,a,"throw",e)}o(void 0)}))}}let Nu;function Mu(){const e=Ao.session.get("bare_jid");if(!e){const e="No JID to fetch user settings for";throw Q.error(e),Error(e)}const t=`converse.user-settings.${e}`;if((null==Nu?void 0:Nu.get("id"))!==t)return Nu=new ae.Model({id:t}),nl(Nu,t),Nu.fetch({promise:!0})}function Iu(){return Tu((function*(){return yield Mu(),Nu}))()}function Pu(e,t){return Tu((function*(){return yield Mu(),Nu.save(e,t)}))()}function Du(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const Ru={getModel:()=>Iu(),get(e,t){return(n=function*(){const n=yield Iu();return void 0===n.get(e)?t:n.get(e)},function(){var e=this,t=arguments;return new Promise((function(r,i){var s=n.apply(e,t);function o(e){Du(s,r,i,o,a,"next",e)}function a(e){Du(s,r,i,o,a,"throw",e)}o(void 0)}))})();var n},set(e,t){if(e instanceof Object)return Pu(e,{promise:!0});{const n={};return n[e]=t,Pu(n,{promise:!0})}},clear:()=>Tu((function*(){if(Ao.session.get("bare_jid"))return yield Mu(),Nu.clear();Nu=void 0}))()};function zu(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Lu(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){zu(s,r,i,o,a,"next",e)}function a(e){zu(s,r,i,o,a,"throw",e)}o(void 0)}))}}function Uu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Bu={user:(Fu=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Uu(e,t,n[t])}))}return e}({settings:Ru},Cu),qu={jid(){var e;return null===(e=Ml.get())||void 0===e?void 0:e.jid},login(e,t,n=!1){return Lu((function*(){var r;const{api:i}=Ao;e=e||i.settings.get("jid");const s=Ml.init(e);if((null===(r=i.settings.get("connection_options"))||void 0===r?void 0:r.worker)&&(yield s.restoreWorkerSession()))return;e&&(e=yield vl(e));const{success:o}=yield Ao.api.hook("login",this,{jid:e,password:t,automatic:n});if(o)return;t=t||i.settings.get("password");const a=e&&t?{jid:e,password:t}:null;yield Sl(a,n)})).call(this)},logout:()=>Lu((function*(){const{api:e}=Ao;yield e.trigger("beforeLogout",{synchronous:!0});const t=ue(),n=()=>{Object.keys(Ao.promises).forEach((e=>si(Ao,e))),localStorage.removeItem("conversejs-session-jid"),e.trigger("logout"),t.resolve()},r=Ml.get();return r?(r.setDisconnectionCause(Zs,void 0,!0),e.listen.once("disconnected",(()=>n())),r.disconnect()):n(),t}))()},qu=null!=qu?qu:{},Object.getOwnPropertyDescriptors?Object.defineProperties(Fu,Object.getOwnPropertyDescriptors(qu)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(qu)).forEach((function(e){Object.defineProperty(Fu,e,Object.getOwnPropertyDescriptor(qu,e))})),Fu)};var Fu,qu;function Hu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Gu=function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Hu(e,t,n[t])}))}return e}({connection:Ml,settings:Zr},uu,Bu,$o,Rl),{disco:null,elements:null,contacts:null}),Wu=Gu,{entries:Vu,setPrototypeOf:Ku,isFrozen:Ju,getPrototypeOf:Yu,getOwnPropertyDescriptor:Xu}=Object;let{freeze:Qu,seal:Zu,create:ed}=Object,{apply:td,construct:nd}="undefined"!=typeof Reflect&&Reflect;Qu||(Qu=function(e){return e}),Zu||(Zu=function(e){return e}),td||(td=function(e,t,n){return e.apply(t,n)}),nd||(nd=function(e,t){return new e(...t)});const rd=yd(Array.prototype.forEach),id=yd(Array.prototype.lastIndexOf),sd=yd(Array.prototype.pop),od=yd(Array.prototype.push),ad=yd(Array.prototype.splice),cd=yd(String.prototype.toLowerCase),ld=yd(String.prototype.toString),ud=yd(String.prototype.match),dd=yd(String.prototype.replace),hd=yd(String.prototype.indexOf),fd=yd(String.prototype.trim),pd=yd(Object.prototype.hasOwnProperty),md=yd(RegExp.prototype.test),gd=(vd=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return nd(vd,t)});var vd;function yd(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return td(e,t,r)}}function bd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cd;Ku&&Ku(e,null);let r=t.length;for(;r--;){let i=t[r];if("string"==typeof i){const e=n(i);e!==i&&(Ju(t)||(t[r]=e),i=e)}e[i]=!0}return e}function _d(e){for(let t=0;t<e.length;t++){pd(e,t)||(e[t]=null)}return e}function wd(e){const t=ed(null);for(const[n,r]of Vu(e)){pd(e,n)&&(Array.isArray(r)?t[n]=_d(r):r&&"object"==typeof r&&r.constructor===Object?t[n]=wd(r):t[n]=r)}return t}function Sd(e,t){for(;null!==e;){const n=Xu(e,t);if(n){if(n.get)return yd(n.get);if("function"==typeof n.value)return yd(n.value)}e=Yu(e)}return function(){return null}}const xd=Qu(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ad=Qu(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),jd=Qu(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),$d=Qu(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ed=Qu(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Od=Qu(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Cd=Qu(["#text"]),kd=Qu(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Td=Qu(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Nd=Qu(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Md=Qu(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Id=Zu(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Pd=Zu(/<%[\w\W]*|[\w\W]*%>/gm),Dd=Zu(/\$\{[\w\W]*/gm),Rd=Zu(/^data-[\-\w.\u00B7-\uFFFF]+$/),zd=Zu(/^aria-[\-\w]+$/),Ld=Zu(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ud=Zu(/^(?:\w+script|data):/i),Bd=Zu(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Fd=Zu(/^html$/i),qd=Zu(/^[a-z][.\w]*(-[.\w]+)+$/i);var Hd=Object.freeze({__proto__:null,ARIA_ATTR:zd,ATTR_WHITESPACE:Bd,CUSTOM_ELEMENT:qd,DATA_ATTR:Rd,DOCTYPE_NAME:Fd,ERB_EXPR:Pd,IS_ALLOWED_URI:Ld,IS_SCRIPT_OR_DATA:Ud,MUSTACHE_EXPR:Id,TMPLIT_EXPR:Dd});const Gd=1,Wd=3,Vd=7,Kd=8,Jd=9,Yd=function(){return"undefined"==typeof window?null:window};var Xd=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();const n=t=>e(t);if(n.version="3.2.6",n.removed=[],!t||!t.document||t.document.nodeType!==Jd||!t.Element)return n.isSupported=!1,n;let{document:r}=t;const i=r,s=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:c,Element:l,NodeFilter:u,NamedNodeMap:d=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:p}=t,m=l.prototype,g=Sd(m,"cloneNode"),v=Sd(m,"remove"),y=Sd(m,"nextSibling"),b=Sd(m,"childNodes"),_=Sd(m,"parentNode");if("function"==typeof a){const e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let w,S="";const{implementation:x,createNodeIterator:A,createDocumentFragment:j,getElementsByTagName:$}=r,{importNode:E}=i;let O={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof Vu&&"function"==typeof _&&x&&void 0!==x.createHTMLDocument;const{MUSTACHE_EXPR:C,ERB_EXPR:k,TMPLIT_EXPR:T,DATA_ATTR:N,ARIA_ATTR:M,IS_SCRIPT_OR_DATA:I,ATTR_WHITESPACE:P,CUSTOM_ELEMENT:D}=Hd;let{IS_ALLOWED_URI:R}=Hd,z=null;const L=bd({},[...xd,...Ad,...jd,...Ed,...Cd]);let U=null;const B=bd({},[...kd,...Td,...Nd,...Md]);let F=Object.seal(ed(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),q=null,H=null,G=!0,W=!0,V=!1,K=!0,J=!1,Y=!0,X=!1,Q=!1,Z=!1,ee=!1,te=!1,ne=!1,re=!0,ie=!1,se=!0,oe=!1,ae={},ce=null;const le=bd({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ue=null;const de=bd({},["audio","video","img","source","image","track"]);let he=null;const fe=bd({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pe="http://www.w3.org/1998/Math/MathML",me="http://www.w3.org/2000/svg",ge="http://www.w3.org/1999/xhtml";let ve=ge,ye=!1,be=null;const _e=bd({},[pe,me,ge],ld);let we=bd({},["mi","mo","mn","ms","mtext"]),Se=bd({},["annotation-xml"]);const xe=bd({},["title","style","font","a","script"]);let Ae=null;const je=["application/xhtml+xml","text/html"];let $e=null,Ee=null;const Oe=r.createElement("form"),Ce=function(e){return e instanceof RegExp||e instanceof Function},ke=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ee||Ee!==e){if(e&&"object"==typeof e||(e={}),e=wd(e),Ae=-1===je.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,$e="application/xhtml+xml"===Ae?ld:cd,z=pd(e,"ALLOWED_TAGS")?bd({},e.ALLOWED_TAGS,$e):L,U=pd(e,"ALLOWED_ATTR")?bd({},e.ALLOWED_ATTR,$e):B,be=pd(e,"ALLOWED_NAMESPACES")?bd({},e.ALLOWED_NAMESPACES,ld):_e,he=pd(e,"ADD_URI_SAFE_ATTR")?bd(wd(fe),e.ADD_URI_SAFE_ATTR,$e):fe,ue=pd(e,"ADD_DATA_URI_TAGS")?bd(wd(de),e.ADD_DATA_URI_TAGS,$e):de,ce=pd(e,"FORBID_CONTENTS")?bd({},e.FORBID_CONTENTS,$e):le,q=pd(e,"FORBID_TAGS")?bd({},e.FORBID_TAGS,$e):wd({}),H=pd(e,"FORBID_ATTR")?bd({},e.FORBID_ATTR,$e):wd({}),ae=!!pd(e,"USE_PROFILES")&&e.USE_PROFILES,G=!1!==e.ALLOW_ARIA_ATTR,W=!1!==e.ALLOW_DATA_ATTR,V=e.ALLOW_UNKNOWN_PROTOCOLS||!1,K=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,J=e.SAFE_FOR_TEMPLATES||!1,Y=!1!==e.SAFE_FOR_XML,X=e.WHOLE_DOCUMENT||!1,ee=e.RETURN_DOM||!1,te=e.RETURN_DOM_FRAGMENT||!1,ne=e.RETURN_TRUSTED_TYPE||!1,Z=e.FORCE_BODY||!1,re=!1!==e.SANITIZE_DOM,ie=e.SANITIZE_NAMED_PROPS||!1,se=!1!==e.KEEP_CONTENT,oe=e.IN_PLACE||!1,R=e.ALLOWED_URI_REGEXP||Ld,ve=e.NAMESPACE||ge,we=e.MATHML_TEXT_INTEGRATION_POINTS||we,Se=e.HTML_INTEGRATION_POINTS||Se,F=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Ce(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(F.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Ce(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(F.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(F.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),J&&(W=!1),te&&(ee=!0),ae&&(z=bd({},Cd),U=[],!0===ae.html&&(bd(z,xd),bd(U,kd)),!0===ae.svg&&(bd(z,Ad),bd(U,Td),bd(U,Md)),!0===ae.svgFilters&&(bd(z,jd),bd(U,Td),bd(U,Md)),!0===ae.mathMl&&(bd(z,Ed),bd(U,Nd),bd(U,Md))),e.ADD_TAGS&&(z===L&&(z=wd(z)),bd(z,e.ADD_TAGS,$e)),e.ADD_ATTR&&(U===B&&(U=wd(U)),bd(U,e.ADD_ATTR,$e)),e.ADD_URI_SAFE_ATTR&&bd(he,e.ADD_URI_SAFE_ATTR,$e),e.FORBID_CONTENTS&&(ce===le&&(ce=wd(ce)),bd(ce,e.FORBID_CONTENTS,$e)),se&&(z["#text"]=!0),X&&bd(z,["html","head","body"]),z.table&&(bd(z,["tbody"]),delete q.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw gd('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw gd('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=e.TRUSTED_TYPES_POLICY,S=w.createHTML("")}else void 0===w&&(w=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(p,s)),null!==w&&"string"==typeof S&&(S=w.createHTML(""));Qu&&Qu(e),Ee=e}},Te=bd({},[...Ad,...jd,...$d]),Ne=bd({},[...Ed,...Od]),Me=function(e){od(n.removed,{element:e});try{_(e).removeChild(e)}catch(t){v(e)}},Ie=function(e,t){try{od(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){od(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||te)try{Me(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},Pe=function(e){let t=null,n=null;if(Z)e="<remove></remove>"+e;else{const t=ud(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===Ae&&ve===ge&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const i=w?w.createHTML(e):e;if(ve===ge)try{t=(new f).parseFromString(i,Ae)}catch(e){}if(!t||!t.documentElement){t=x.createDocument(ve,"template",null);try{t.documentElement.innerHTML=ye?S:i}catch(e){}}const s=t.body||t.documentElement;return e&&n&&s.insertBefore(r.createTextNode(n),s.childNodes[0]||null),ve===ge?$.call(t,X?"html":"body")[0]:X?t.documentElement:s},De=function(e){return A.call(e.ownerDocument||e,e,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Re=function(e){return e instanceof h&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof d)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},ze=function(e){return"function"==typeof c&&e instanceof c};function Le(e,t,r){rd(e,(e=>{e.call(n,t,r,Ee)}))}const Ue=function(e){let t=null;if(Le(O.beforeSanitizeElements,e,null),Re(e))return Me(e),!0;const r=$e(e.nodeName);if(Le(O.uponSanitizeElement,e,{tagName:r,allowedTags:z}),Y&&e.hasChildNodes()&&!ze(e.firstElementChild)&&md(/<[/\w!]/g,e.innerHTML)&&md(/<[/\w!]/g,e.textContent))return Me(e),!0;if(e.nodeType===Vd)return Me(e),!0;if(Y&&e.nodeType===Kd&&md(/<[/\w]/g,e.data))return Me(e),!0;if(!z[r]||q[r]){if(!q[r]&&Fe(r)){if(F.tagNameCheck instanceof RegExp&&md(F.tagNameCheck,r))return!1;if(F.tagNameCheck instanceof Function&&F.tagNameCheck(r))return!1}if(se&&!ce[r]){const t=_(e)||e.parentNode,n=b(e)||e.childNodes;if(n&&t){for(let r=n.length-1;r>=0;--r){const i=g(n[r],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,y(e))}}}return Me(e),!0}return e instanceof l&&!function(e){let t=_(e);t&&t.tagName||(t={namespaceURI:ve,tagName:"template"});const n=cd(e.tagName),r=cd(t.tagName);return!!be[e.namespaceURI]&&(e.namespaceURI===me?t.namespaceURI===ge?"svg"===n:t.namespaceURI===pe?"svg"===n&&("annotation-xml"===r||we[r]):Boolean(Te[n]):e.namespaceURI===pe?t.namespaceURI===ge?"math"===n:t.namespaceURI===me?"math"===n&&Se[r]:Boolean(Ne[n]):e.namespaceURI===ge?!(t.namespaceURI===me&&!Se[r])&&!(t.namespaceURI===pe&&!we[r])&&!Ne[n]&&(xe[n]||!Te[n]):!("application/xhtml+xml"!==Ae||!be[e.namespaceURI]))}(e)?(Me(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!md(/<\/no(script|embed|frames)/i,e.innerHTML)?(J&&e.nodeType===Wd&&(t=e.textContent,rd([C,k,T],(e=>{t=dd(t,e," ")})),e.textContent!==t&&(od(n.removed,{element:e.cloneNode()}),e.textContent=t)),Le(O.afterSanitizeElements,e,null),!1):(Me(e),!0)},Be=function(e,t,n){if(re&&("id"===t||"name"===t)&&(n in r||n in Oe))return!1;if(W&&!H[t]&&md(N,t));else if(G&&md(M,t));else if(!U[t]||H[t]){if(!(Fe(e)&&(F.tagNameCheck instanceof RegExp&&md(F.tagNameCheck,e)||F.tagNameCheck instanceof Function&&F.tagNameCheck(e))&&(F.attributeNameCheck instanceof RegExp&&md(F.attributeNameCheck,t)||F.attributeNameCheck instanceof Function&&F.attributeNameCheck(t))||"is"===t&&F.allowCustomizedBuiltInElements&&(F.tagNameCheck instanceof RegExp&&md(F.tagNameCheck,n)||F.tagNameCheck instanceof Function&&F.tagNameCheck(n))))return!1}else if(he[t]);else if(md(R,dd(n,P,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==hd(n,"data:")||!ue[e]){if(V&&!md(I,dd(n,P,"")));else if(n)return!1}else;return!0},Fe=function(e){return"annotation-xml"!==e&&ud(e,D)},qe=function(e){Le(O.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Re(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let i=t.length;for(;i--;){const s=t[i],{name:o,namespaceURI:a,value:c}=s,l=$e(o),u=c;let d="value"===o?u:fd(u);if(r.attrName=l,r.attrValue=d,r.keepAttr=!0,r.forceKeepAttr=void 0,Le(O.uponSanitizeAttribute,e,r),d=r.attrValue,!ie||"id"!==l&&"name"!==l||(Ie(o,e),d="user-content-"+d),Y&&md(/((--!?|])>)|<\/(style|title)/i,d)){Ie(o,e);continue}if(r.forceKeepAttr)continue;if(!r.keepAttr){Ie(o,e);continue}if(!K&&md(/\/>/i,d)){Ie(o,e);continue}J&&rd([C,k,T],(e=>{d=dd(d,e," ")}));const h=$e(e.nodeName);if(Be(h,l,d)){if(w&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(a);else switch(p.getAttributeType(h,l)){case"TrustedHTML":d=w.createHTML(d);break;case"TrustedScriptURL":d=w.createScriptURL(d)}if(d!==u)try{a?e.setAttributeNS(a,o,d):e.setAttribute(o,d),Re(e)?Me(e):sd(n.removed)}catch(t){Ie(o,e)}}else Ie(o,e)}Le(O.afterSanitizeAttributes,e,null)},He=function e(t){let n=null;const r=De(t);for(Le(O.beforeSanitizeShadowDOM,t,null);n=r.nextNode();)Le(O.uponSanitizeShadowNode,n,null),Ue(n),qe(n),n.content instanceof o&&e(n.content);Le(O.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,s=null,a=null,l=null;if(ye=!e,ye&&(e="\x3c!--\x3e"),"string"!=typeof e&&!ze(e)){if("function"!=typeof e.toString)throw gd("toString is not a function");if("string"!=typeof(e=e.toString()))throw gd("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Q||ke(t),n.removed=[],"string"==typeof e&&(oe=!1),oe){if(e.nodeName){const t=$e(e.nodeName);if(!z[t]||q[t])throw gd("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof c)r=Pe("\x3c!----\x3e"),s=r.ownerDocument.importNode(e,!0),s.nodeType===Gd&&"BODY"===s.nodeName||"HTML"===s.nodeName?r=s:r.appendChild(s);else{if(!ee&&!J&&!X&&-1===e.indexOf("<"))return w&&ne?w.createHTML(e):e;if(r=Pe(e),!r)return ee?null:ne?S:""}r&&Z&&Me(r.firstChild);const u=De(oe?e:r);for(;a=u.nextNode();)Ue(a),qe(a),a.content instanceof o&&He(a.content);if(oe)return e;if(ee){if(te)for(l=j.call(r.ownerDocument);r.firstChild;)l.appendChild(r.firstChild);else l=r;return(U.shadowroot||U.shadowrootmode)&&(l=E.call(i,l,!0)),l}let d=X?r.outerHTML:r.innerHTML;return X&&z["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&md(Fd,r.ownerDocument.doctype.name)&&(d="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+d),J&&rd([C,k,T],(e=>{d=dd(d,e," ")})),w&&ne?w.createHTML(d):d},n.setConfig=function(){ke(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Q=!0},n.clearConfig=function(){Ee=null,Q=!1},n.isValidAttribute=function(e,t,n){Ee||ke({});const r=$e(e),i=$e(t);return Be(r,i,n)},n.addHook=function(e,t){"function"==typeof t&&od(O[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=id(O[e],t);return-1===n?void 0:ad(O[e],n,1)[0]}return sd(O[e])},n.removeHooks=function(e){O[e]=[]},n.removeAllHooks=function(){O={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();function Qd(e){return e instanceof Element||e instanceof HTMLDocument}function Zd(e,t){if(e instanceof Bs.Builder)return Zd(e.tree(),t);if(e instanceof Element)return Bs.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")}function eh(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function th(e,t){return Array.from(e.childNodes).filter((e=>e instanceof Element&&e.matches(t)))}function nh(e){for(var t=0;e=e.previousElementSibling;t++);return t}const rh=document.createElement("div");function ih(e){return e&&"string"==typeof e&&(rh.innerHTML=Xd.sanitize(e),e=rh.textContent,rh.textContent=""),e}function sh(e){return!!Qd(e)&&"error"===e.getAttribute("type")}function oh(e){return!!Qd(e)&&ee()(`error[type="auth"] forbidden[xmlns="${Bs.NS.STANZAS}"]`,e).length>0}function ah(e){return!!Qd(e)&&ee()(`error[type="cancel"] service-unavailable[xmlns="${Bs.NS.STANZAS}"]`,e).length>0}function ch(e){return e.getAttributeNames().reduce(((t,n)=>(t[n]=Bs.xmlunescape(e.getAttribute(n)),t)),{})}const lh="bits",uh="bytes",dh="",hh="jedec",fh="round",ph="string",mh={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function gh(e,{bits:t=!1,pad:n=!1,base:r=-1,round:i=2,locale:s="",localeOptions:o={},separator:a="",spacer:c=" ",symbols:l={},standard:u="",output:d=ph,fullform:h=!1,fullforms:f=[],exponent:p=-1,roundingMethod:m=fh,precision:g=0}={}){let v=p,y=Number(e),b=[],_=0,w=dh;"si"===u?(r=10,u=hh):"iec"===u||u===hh?r=2:2===r?u="iec":(r=10,u=hh);const S=10===r?1e3:1024,x=!0===h,A=y<0,j=Math[m];if("bigint"!=typeof e&&isNaN(e))throw new TypeError("Invalid number");if("function"!=typeof j)throw new TypeError("Invalid rounding method");if(A&&(y=-y),(-1===v||isNaN(v))&&(v=Math.floor(Math.log(y)/Math.log(S)),v<0&&(v=0)),v>8&&(g>0&&(g+=8-v),v=8),"exponent"===d)return v;if(0===y)b[0]=0,w=b[1]=mh.symbol[u][t?lh:uh][v];else{_=y/(2===r?Math.pow(2,10*v):Math.pow(1e3,v)),t&&(_*=8,_>=S&&v<8&&(_/=S,v++));const e=Math.pow(10,v>0?i:0);b[0]=j(_*e)/e,b[0]===S&&v<8&&-1===p&&(b[0]=1,v++),w=b[1]=10===r&&1===v?t?"kbit":"kB":mh.symbol[u][t?lh:uh][v]}if(A&&(b[0]=-b[0]),g>0&&(b[0]=b[0].toPrecision(g)),b[1]=l[b[1]]||b[1],!0===s?b[0]=b[0].toLocaleString():s.length>0?b[0]=b[0].toLocaleString(s,o):a.length>0&&(b[0]=b[0].toString().replace(".",a)),n&&i>0){const e=b[0].toString(),t=a||(e.match(/(\D)/g)||[]).pop()||".",n=e.toString().split(t),r=n[1]||dh,s=r.length,o=i-s;b[0]=`${n[0]}${t}${r.padEnd(s+o,"0")}`}return x&&(b[1]=f[v]?f[v]:mh.fullform[u][v]+(t?"bit":"byte")+(1===b[0]?dh:"s")),"array"===d?b:"object"===d?{value:b[0],symbol:b[1],exponent:v,unit:w}:b.join(c)}const vh=globalThis,yh=vh.ShadowRoot&&(void 0===vh.ShadyCSS||vh.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,bh=Symbol(),_h=new WeakMap;class wh{get styleSheet(){let e=this.o;const t=this.t;if(yh&&void 0===e){const n=void 0!==t&&1===t.length;n&&(e=_h.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&_h.set(t,e))}return e}toString(){return this.cssText}constructor(e,t,n){if(this._$cssResult$=!0,n!==bh)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}}const Sh=(e,t)=>{if(yh)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const n of t){const t=document.createElement("style"),r=vh.litNonce;void 0!==r&&t.setAttribute("nonce",r),t.textContent=n.cssText,e.appendChild(t)}},xh=yh?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new wh("string"==typeof e?e:e+"",void 0,bh))(t)})(e):e;function Ah(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}var jh,$h,Eh;const{is:Oh,defineProperty:Ch,getOwnPropertyDescriptor:kh,getOwnPropertyNames:Th,getOwnPropertySymbols:Nh,getPrototypeOf:Mh}=Object,Ih=globalThis,Ph=Ih.trustedTypes,Dh=Ph?Ph.emptyScript:"",Rh=Ih.reactiveElementPolyfillSupport,zh=(e,t)=>e,Lh={toAttribute(e,t){switch(t){case Boolean:e=e?Dh:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},Uh=(e,t)=>!Oh(e,t),Bh={attribute:!0,type:String,converter:Lh,reflect:!1,useDefault:!1,hasChanged:Uh};var Fh,qh,Hh,Gh;null!==(Fh=(jh=Symbol).metadata)&&void 0!==Fh||(jh.metadata=Symbol("metadata")),null!==(qh=($h=Ih).litPropertyMetadata)&&void 0!==qh||($h.litPropertyMetadata=new WeakMap);class Wh extends HTMLElement{static addInitializer(e){var t;this._$Ei(),(null!==(t=this.l)&&void 0!==t?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Bh){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),r=this.getPropertyDescriptor(e,n,t);void 0!==r&&Ch(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){var r;const{get:i,set:s}=null!==(r=kh(this.prototype,e))&&void 0!==r?r:{get(){return this[t]},set(e){this[t]=e}};return{get:i,set(t){const r=null==i?void 0:i.call(this);null==s||s.call(this,t),this.requestUpdate(e,r,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return null!==(t=this.elementProperties.get(e))&&void 0!==t?t:Bh}static _$Ei(){if(this.hasOwnProperty(zh("elementProperties")))return;const e=Mh(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(zh("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(zh("properties"))){const e=this.properties,t=[...Th(e),...Nh(e)];for(const n of t)this.createProperty(n,e[n])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,n]of t)this.elementProperties.set(e,n)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const n=this._$Eu(e,t);void 0!==n&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(xh(e))}else void 0!==e&&t.push(xh(e));return t}static _$Eu(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}_$Ev(){var e;this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),null===(e=this.constructor.l)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(n=this._$EO)&&void 0!==n?n:this._$EO=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&(null===(t=e.hostConnected)||void 0===t||t.call(e))}removeController(e){var t;null===(t=this._$EO)||void 0===t||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return Sh(t,this.constructor.elementStyles),t}connectedCallback(){var e,t;null!==(t=this.renderRoot)&&void 0!==t||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$EO)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$EO)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$ET(e,t){const n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(void 0!==r&&!0===n.reflect){var i;const s=(void 0!==(null===(i=n.converter)||void 0===i?void 0:i.toAttribute)?n.converter:Lh).toAttribute(t,n.type);this._$Em=e,null==s?this.removeAttribute(r):this.setAttribute(r,s),this._$Em=null}}_$AK(e,t){const n=this.constructor,r=n._$Eh.get(e);if(void 0!==r&&this._$Em!==r){var i,s;const e=n.getPropertyOptions(r),c="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(i=e.converter)||void 0===i?void 0:i.fromAttribute)?e.converter:Lh;var o,a;this._$Em=r,this[r]=null!==(a=null!==(o=c.fromAttribute(t,e.type))&&void 0!==o?o:null===(s=this._$Ej)||void 0===s?void 0:s.get(r))&&void 0!==a?a:null,this._$Em=null}}requestUpdate(e,t,n){if(void 0!==e){var r;const s=this.constructor,o=this[e];var i;if(null!=n||(n=s.getPropertyOptions(e)),!((null!==(i=n.hasChanged)&&void 0!==i?i:Uh)(o,t)||n.useDefault&&n.reflect&&o===(null===(r=this._$Ej)||void 0===r?void 0:r.get(e))&&!this.hasAttribute(s._$Eu(e,n))))return;this.C(e,t,n)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:n,reflect:r,wrapped:i},s){var o,a,c;n&&!(null!==(o=this._$Ej)&&void 0!==o?o:this._$Ej=new Map).has(e)&&(this._$Ej.set(e,null!==(a=null!=s?s:t)&&void 0!==a?a:this[e]),!0!==i||void 0!==s)||(this._$AL.has(e)||(this.hasUpdated||n||(t=void 0),this._$AL.set(e,t)),!0===r&&this._$Em!==e&&(null!==(c=this._$Eq)&&void 0!==c?c:this._$Eq=new Set).add(e))}_$EP(){return(e=function*(){this.isUpdatePending=!0;try{yield this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&(yield e),!this.isUpdatePending},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Ah(s,r,i,o,a,"next",e)}function a(e){Ah(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){var e;if(null!==(e=this.renderRoot)&&void 0!==e||(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,n]of t){const{wrapped:t}=n,r=this[e];!0!==t||this._$AL.has(e)||void 0===r||this.C(e,void 0,n,r)}}let t=!1;const n=this._$AL;try{var r;t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(r=this._$EO)||void 0===r||r.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this._$EM()}catch(n){throw t=!1,this._$EM(),n}t&&this._$AE(n)}willUpdate(e){}_$AE(e){var t;null===(t=this._$EO)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach((e=>this._$ET(e,this[e])))),this._$EM()}updated(e){}firstUpdated(e){}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}}Wh.elementStyles=[],Wh.shadowRootOptions={mode:"open"},Wh[zh("elementProperties")]=new Map,Wh[zh("finalized")]=new Map,null==Rh||Rh({ReactiveElement:Wh}),(null!==(Hh=(Eh=Ih).reactiveElementVersions)&&void 0!==Hh?Hh:Eh.reactiveElementVersions=[]).push("2.1.0");const Vh=globalThis,Kh=Vh.trustedTypes,Jh=Kh?Kh.createPolicy("lit-html",{createHTML:e=>e}):void 0,Yh="$lit$",Xh=`lit$${Math.random().toFixed(9).slice(2)}$`,Qh="?"+Xh,Zh=`<${Qh}>`,ef=document,tf=()=>ef.createComment(""),nf=e=>null===e||"object"!=typeof e&&"function"!=typeof e,rf=Array.isArray,sf=e=>rf(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),of="[ \t\n\f\r]",af=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,cf=/-->/g,lf=/>/g,uf=RegExp(`>|${of}(?:([^\\s"'>=/]+)(${of}*=${of}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),df=/'/g,hf=/"/g,ff=/^(?:script|style|textarea|title)$/i,pf=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),mf=pf(1),gf=pf(2),vf=(pf(3),Symbol.for("lit-noChange")),yf=Symbol.for("lit-nothing"),bf=new WeakMap,_f=ef.createTreeWalker(ef,129);function wf(e,t){if(!rf(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==Jh?Jh.createHTML(t):t}const Sf=(e,t)=>{const n=e.length-1,r=[];let i,s=2===t?"<svg>":3===t?"<math>":"",o=af;for(let t=0;t<n;t++){const n=e[t];let a,c,l=-1,u=0;for(;u<n.length&&(o.lastIndex=u,c=o.exec(n),null!==c);)u=o.lastIndex,o===af?"!--"===c[1]?o=cf:void 0!==c[1]?o=lf:void 0!==c[2]?(ff.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=uf):void 0!==c[3]&&(o=uf):o===uf?">"===c[0]?(o=null!=i?i:af,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?uf:'"'===c[3]?hf:df):o===hf||o===df?o=uf:o===cf||o===lf?o=af:(o=uf,i=void 0);const d=o===uf&&e[t+1].startsWith("/>")?" ":"";s+=o===af?n+Zh:l>=0?(r.push(a),n.slice(0,l)+Yh+n.slice(l)+Xh+d):n+Xh+(-2===l?t:d)}return[wf(e,s+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),r]};class xf{static createElement(e,t){const n=ef.createElement("template");return n.innerHTML=e,n}constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let i=0,s=0;const o=e.length-1,a=this.parts,[c,l]=Sf(e,t);if(this.el=xf.createElement(c,n),_f.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(r=_f.nextNode())&&a.length<o;){if(1===r.nodeType){if(r.hasAttributes())for(const e of r.getAttributeNames())if(e.endsWith(Yh)){const t=l[s++],n=r.getAttribute(e).split(Xh),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:n,ctor:"."===o[1]?Of:"?"===o[1]?Cf:"@"===o[1]?kf:Ef}),r.removeAttribute(e)}else e.startsWith(Xh)&&(a.push({type:6,index:i}),r.removeAttribute(e));if(ff.test(r.tagName)){const e=r.textContent.split(Xh),t=e.length-1;if(t>0){r.textContent=Kh?Kh.emptyScript:"";for(let n=0;n<t;n++)r.append(e[n],tf()),_f.nextNode(),a.push({type:2,index:++i});r.append(e[t],tf())}}}else if(8===r.nodeType)if(r.data===Qh)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=r.data.indexOf(Xh,e+1));)a.push({type:7,index:i}),e+=Xh.length-1}i++}}}function Af(e,t,n=e,r){var i,s,o;if(t===vf)return t;let a=void 0!==r?null===(i=n._$Co)||void 0===i?void 0:i[r]:n._$Cl;const c=nf(t)?void 0:t._$litDirective$;var l;return(null==a?void 0:a.constructor)!==c&&(null==a||null===(s=a._$AO)||void 0===s||s.call(a,!1),void 0===c?a=void 0:(a=new c(e),a._$AT(e,n,r)),void 0!==r?(null!==(l=(o=n)._$Co)&&void 0!==l?l:o._$Co=[])[r]=a:n._$Cl=a),void 0!==a&&(t=Af(e,a._$AS(e,t.values),a,r)),t}class jf{get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:n},parts:r}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:ef).importNode(n,!0);_f.currentNode=i;let s=_f.nextNode(),o=0,a=0,c=r[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new $f(s,s.nextSibling,this,e):1===c.type?t=new c.ctor(s,c.name,c.strings,this,e):6===c.type&&(t=new Tf(s,this,e)),this._$AV.push(t),c=r[++a]}o!==(null==c?void 0:c.index)&&(s=_f.nextNode(),o++)}return _f.currentNode=ef,i}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}}class $f{get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cv}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Af(this,e,t),nf(e)?e===yf||null==e||""===e?(this._$AH!==yf&&this._$AR(),this._$AH=yf):e!==this._$AH&&e!==vf&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):sf(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==yf&&nf(this._$AH)?this._$AA.nextSibling.data=e:this.T(ef.createTextNode(e)),this._$AH=e}$(e){var t;const{values:n,_$litType$:r}=e,i="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=xf.createElement(wf(r.h,r.h[0]),this.options)),r);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.p(n);else{const e=new jf(i,this),t=e.u(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let t=bf.get(e.strings);return void 0===t&&bf.set(e.strings,t=new xf(e)),t}k(e){rf(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,r=0;for(const i of e)r===t.length?t.push(n=new $f(this.O(tf()),this.O(tf()),this,this.options)):n=t[r],n._$AI(i),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cv=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}constructor(e,t,n,r){var i;this.type=2,this._$AH=yf,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cv=null===(i=null==r?void 0:r.isConnected)||void 0===i||i}}class Ef{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,n,r){const i=this.strings;let s=!1;if(void 0===i)e=Af(this,e,t,0),s=!nf(e)||e!==this._$AH&&e!==vf,s&&(this._$AH=e);else{const r=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=Af(this,r[n+o],t,o),a===vf&&(a=this._$AH[o]),s||(s=!nf(a)||a!==this._$AH[o]),a===yf?e=yf:e!==yf&&(e+=(null!=a?a:"")+i[o+1]),this._$AH[o]=a}s&&!r&&this.j(e)}j(e){e===yf?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}constructor(e,t,n,r,i){this.type=1,this._$AH=yf,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=yf}}class Of extends Ef{j(e){this.element[this.name]=e===yf?void 0:e}constructor(){super(...arguments),this.type=3}}class Cf extends Ef{j(e){this.element.toggleAttribute(this.name,!!e&&e!==yf)}constructor(){super(...arguments),this.type=4}}class kf extends Ef{_$AI(e,t=this){var n;if((e=null!==(n=Af(this,e,t,0))&&void 0!==n?n:yf)===vf)return;const r=this._$AH,i=e===yf&&r!==yf||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==yf&&(r===yf||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this._$AH.handleEvent(e)}constructor(e,t,n,r,i){super(e,t,n,r,i),this.type=5}}class Tf{get _$AU(){return this._$AM._$AU}_$AI(e){Af(this,e)}constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}}const Nf={M:Yh,P:Xh,A:Qh,C:1,L:Sf,R:jf,D:sf,V:Af,I:$f,H:Ef,N:Cf,U:kf,B:Of,F:Tf},Mf=Vh.litHtmlPolyfillSupport;var If;null==Mf||Mf(xf,$f),(null!==(If=(Gh=Vh).litHtmlVersions)&&void 0!==If?If:Gh.litHtmlVersions=[]).push("3.3.0");const Pf=(e,t,n)=>{var r;const i=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:t;let s=i._$litPart$;if(void 0===s){var o;const e=null!==(o=null==n?void 0:n.renderBefore)&&void 0!==o?o:null;i._$litPart$=s=new $f(t.insertBefore(tf(),e),e,void 0,null!=n?n:{})}return s._$AI(e),s};var Df,Rf;const zf=globalThis;class Lf extends Wh{createRenderRoot(){var e;const t=super.createRenderRoot();var n;return null!==(n=(e=this.renderOptions).renderBefore)&&void 0!==n||(e.renderBefore=t.firstChild),t}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Pf(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return vf}constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}}Lf._$litElement$=!0,Lf.finalized=!0,null===(Df=zf.litElementHydrateSupport)||void 0===Df||Df.call(zf,{LitElement:Lf});const Uf=zf.litElementPolyfillSupport;null==Uf||Uf({LitElement:Lf});var Bf;(null!==(Bf=(Rf=zf).litElementVersions)&&void 0!==Bf?Bf:Rf.litElementVersions=[]).push("4.2.0");class Ff extends ae.Model{defaults(){return{connection_status:Bs.Status.DISCONNECTED,message:""}}initialize(){super.initialize();const{api:e}=Ao;this.on("change",(()=>e.trigger("connfeedback",Ao.state.connfeedback)))}}const qf=Ff;function Hf(e){return[...new Set(e)]}function Gf(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}function Wf(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function Vf(e){return new TextDecoder("utf-8").decode(e)}function Kf(e){return(new TextEncoder).encode(e).buffer}function Jf(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}function Yf(e){const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}function Xf(e){const t=new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16))));return t.buffer}class Qf{constructor(){this.hex="#000000",this.rgb_r=0,this.rgb_g=0,this.rgb_b=0,this.xyz_x=0,this.xyz_y=0,this.xyz_z=0,this.luv_l=0,this.luv_u=0,this.luv_v=0,this.lch_l=0,this.lch_c=0,this.lch_h=0,this.hsluv_h=0,this.hsluv_s=0,this.hsluv_l=0,this.hpluv_h=0,this.hpluv_p=0,this.hpluv_l=0,this.r0s=0,this.r0i=0,this.r1s=0,this.r1i=0,this.g0s=0,this.g0i=0,this.g1s=0,this.g1i=0,this.b0s=0,this.b0i=0,this.b1s=0,this.b1i=0}static fromLinear(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}static toLinear(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}static yToL(e){return e<=Qf.epsilon?e/Qf.refY*Qf.kappa:116*Math.pow(e/Qf.refY,1/3)-16}static lToY(e){return e<=8?Qf.refY*e/Qf.kappa:Qf.refY*Math.pow((e+16)/116,3)}static rgbChannelToHex(e){const t=Math.round(255*e),n=t%16,r=(t-n)/16|0;return Qf.hexChars.charAt(r)+Qf.hexChars.charAt(n)}static hexToRgbChannel(e,t){return(16*Qf.hexChars.indexOf(e.charAt(t))+Qf.hexChars.indexOf(e.charAt(t+1)))/255}static distanceFromOriginAngle(e,t,n){const r=t/(Math.sin(n)-e*Math.cos(n));return r<0?1/0:r}static distanceFromOrigin(e,t){return Math.abs(t)/Math.sqrt(Math.pow(e,2)+1)}static min6(e,t,n,r,i,s){return Math.min(e,Math.min(t,Math.min(n,Math.min(r,Math.min(i,s)))))}rgbToHex(){this.hex="#",this.hex+=Qf.rgbChannelToHex(this.rgb_r),this.hex+=Qf.rgbChannelToHex(this.rgb_g),this.hex+=Qf.rgbChannelToHex(this.rgb_b)}hexToRgb(){this.hex=this.hex.toLowerCase(),this.rgb_r=Qf.hexToRgbChannel(this.hex,1),this.rgb_g=Qf.hexToRgbChannel(this.hex,3),this.rgb_b=Qf.hexToRgbChannel(this.hex,5)}xyzToRgb(){this.rgb_r=Qf.fromLinear(Qf.m_r0*this.xyz_x+Qf.m_r1*this.xyz_y+Qf.m_r2*this.xyz_z),this.rgb_g=Qf.fromLinear(Qf.m_g0*this.xyz_x+Qf.m_g1*this.xyz_y+Qf.m_g2*this.xyz_z),this.rgb_b=Qf.fromLinear(Qf.m_b0*this.xyz_x+Qf.m_b1*this.xyz_y+Qf.m_b2*this.xyz_z)}rgbToXyz(){const e=Qf.toLinear(this.rgb_r),t=Qf.toLinear(this.rgb_g),n=Qf.toLinear(this.rgb_b);this.xyz_x=.41239079926595*e+.35758433938387*t+.18048078840183*n,this.xyz_y=.21263900587151*e+.71516867876775*t+.072192315360733*n,this.xyz_z=.019330818715591*e+.11919477979462*t+.95053215224966*n}xyzToLuv(){const e=this.xyz_x+15*this.xyz_y+3*this.xyz_z;let t=4*this.xyz_x,n=9*this.xyz_y;0!==e?(t/=e,n/=e):(t=NaN,n=NaN),this.luv_l=Qf.yToL(this.xyz_y),0===this.luv_l?(this.luv_u=0,this.luv_v=0):(this.luv_u=13*this.luv_l*(t-Qf.refU),this.luv_v=13*this.luv_l*(n-Qf.refV))}luvToXyz(){if(0===this.luv_l)return this.xyz_x=0,this.xyz_y=0,void(this.xyz_z=0);const e=this.luv_u/(13*this.luv_l)+Qf.refU,t=this.luv_v/(13*this.luv_l)+Qf.refV;this.xyz_y=Qf.lToY(this.luv_l),this.xyz_x=0-9*this.xyz_y*e/((e-4)*t-e*t),this.xyz_z=(9*this.xyz_y-15*t*this.xyz_y-t*this.xyz_x)/(3*t)}luvToLch(){if(this.lch_l=this.luv_l,this.lch_c=Math.sqrt(this.luv_u*this.luv_u+this.luv_v*this.luv_v),this.lch_c<1e-8)this.lch_h=0;else{const e=Math.atan2(this.luv_v,this.luv_u);this.lch_h=180*e/Math.PI,this.lch_h<0&&(this.lch_h=360+this.lch_h)}}lchToLuv(){const e=this.lch_h/180*Math.PI;this.luv_l=this.lch_l,this.luv_u=Math.cos(e)*this.lch_c,this.luv_v=Math.sin(e)*this.lch_c}calculateBoundingLines(e){const t=Math.pow(e+16,3)/1560896,n=t>Qf.epsilon?t:e/Qf.kappa,r=n*(284517*Qf.m_r0-94839*Qf.m_r2),i=n*(838422*Qf.m_r2+769860*Qf.m_r1+731718*Qf.m_r0),s=n*(632260*Qf.m_r2-126452*Qf.m_r1),o=n*(284517*Qf.m_g0-94839*Qf.m_g2),a=n*(838422*Qf.m_g2+769860*Qf.m_g1+731718*Qf.m_g0),c=n*(632260*Qf.m_g2-126452*Qf.m_g1),l=n*(284517*Qf.m_b0-94839*Qf.m_b2),u=n*(838422*Qf.m_b2+769860*Qf.m_b1+731718*Qf.m_b0),d=n*(632260*Qf.m_b2-126452*Qf.m_b1);this.r0s=r/s,this.r0i=i*e/s,this.r1s=r/(s+126452),this.r1i=(i-769860)*e/(s+126452),this.g0s=o/c,this.g0i=a*e/c,this.g1s=o/(c+126452),this.g1i=(a-769860)*e/(c+126452),this.b0s=l/d,this.b0i=u*e/d,this.b1s=l/(d+126452),this.b1i=(u-769860)*e/(d+126452)}calcMaxChromaHpluv(){const e=Qf.distanceFromOrigin(this.r0s,this.r0i),t=Qf.distanceFromOrigin(this.r1s,this.r1i),n=Qf.distanceFromOrigin(this.g0s,this.g0i),r=Qf.distanceFromOrigin(this.g1s,this.g1i),i=Qf.distanceFromOrigin(this.b0s,this.b0i),s=Qf.distanceFromOrigin(this.b1s,this.b1i);return Qf.min6(e,t,n,r,i,s)}calcMaxChromaHsluv(e){const t=e/360*Math.PI*2,n=Qf.distanceFromOriginAngle(this.r0s,this.r0i,t),r=Qf.distanceFromOriginAngle(this.r1s,this.r1i,t),i=Qf.distanceFromOriginAngle(this.g0s,this.g0i,t),s=Qf.distanceFromOriginAngle(this.g1s,this.g1i,t),o=Qf.distanceFromOriginAngle(this.b0s,this.b0i,t),a=Qf.distanceFromOriginAngle(this.b1s,this.b1i,t);return Qf.min6(n,r,i,s,o,a)}hsluvToLch(){if(this.hsluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hsluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hsluv_l,this.calculateBoundingLines(this.hsluv_l);const e=this.calcMaxChromaHsluv(this.hsluv_h);this.lch_c=e/100*this.hsluv_s}this.lch_h=this.hsluv_h}lchToHsluv(){if(this.lch_l>99.9999999)this.hsluv_s=0,this.hsluv_l=100;else if(this.lch_l<1e-8)this.hsluv_s=0,this.hsluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHsluv(this.lch_h);this.hsluv_s=this.lch_c/e*100,this.hsluv_l=this.lch_l}this.hsluv_h=this.lch_h}hpluvToLch(){if(this.hpluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hpluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hpluv_l,this.calculateBoundingLines(this.hpluv_l);const e=this.calcMaxChromaHpluv();this.lch_c=e/100*this.hpluv_p}this.lch_h=this.hpluv_h}lchToHpluv(){if(this.lch_l>99.9999999)this.hpluv_p=0,this.hpluv_l=100;else if(this.lch_l<1e-8)this.hpluv_p=0,this.hpluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHpluv();this.hpluv_p=this.lch_c/e*100,this.hpluv_l=this.lch_l}this.hpluv_h=this.lch_h}hsluvToRgb(){this.hsluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hpluvToRgb(){this.hpluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hsluvToHex(){this.hsluvToRgb(),this.rgbToHex()}hpluvToHex(){this.hpluvToRgb(),this.rgbToHex()}rgbToHsluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHsluv()}rgbToHpluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHpluv()}hexToHsluv(){this.hexToRgb(),this.rgbToHsluv()}hexToHpluv(){this.hexToRgb(),this.rgbToHpluv()}}function Zf(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Qf.hexChars="0123456789abcdef",Qf.refY=1,Qf.refU=.19783000664283,Qf.refV=.46831999493879,Qf.kappa=903.2962962,Qf.epsilon=.0088564516,Qf.m_r0=3.240969941904521,Qf.m_r1=-1.537383177570093,Qf.m_r2=-.498610760293,Qf.m_g0=-.96924363628087,Qf.m_g1=1.87596750150772,Qf.m_g2=.041555057407175,Qf.m_b0=.055630079696993,Qf.m_b1=-.20397695888897,Qf.m_b2=1.056971514242878;const ep=new Map;function tp(e){return(t=function*(){const t=ep.get(e);if(t)return t;const n=Array.from(new Uint8Array(yield crypto.subtle.digest("SHA-1",(new TextEncoder).encode(e)))),r=(n[0]+256*n[1])/65536*360,i=new Qf;return i.hsluv_h=r,i.hsluv_s=100,i.hsluv_l=50,i.hsluvToHex(),ep.set(e,i.hex),i.hex},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){Zf(s,r,i,o,a,"next",e)}function a(e){Zf(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}const np=(e,t)=>`<field var="${e}">${t}</field>`,rp=e=>`<value>${Bs.xmlescape(e)}</value>`;function ip(e){const t=[],n=null==e?void 0:e.options;for(let e=0,r=n.length;e<r;e++){const r=n[e];r.selected&&t.push(r.value||r.text)}return t}function sp(e){const t=e.getAttribute("name");if(!t)return null;let n;return n="checkbox"===e.getAttribute("type")?e.checked?"1":"0":"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?ip(e):e.value,Fs(np(t,Array.isArray(n)?n.map(rp):rp(n)))}function op(e,t,n){t||(t=e.selectionEnd||void 0);let[r]=e.value.slice(0,t).split(/\s/).slice(-1);return n&&([r]=r.split(n).slice(-1)),r}function ap(e){return"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e)}function cp(e,t){const n=e.selectionEnd||void 0,r=e.value.slice(0,n).split(/\s/).pop(),i=e.value,s=ap(r[0])?r[0]:"";e.value=i.slice(0,n-r.length)+s+`${t} `+i.slice(n);const o=n-r.length+t.length+1;e.selectionEnd=s?o+1:o}function lp(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),e.scrollTop=999999}function up(e){if(!e)return"";const t=e.codePointAt(0),n=t>65535?2:1;return String.fromCodePoint(t).toLocaleUpperCase()+e.substring(n)}function dp(e,t){return t.reduce((function(t,n){return e.startsWith(n)&&n.length>t.length?n:t}),"")}function hp(e){return"string"==typeof e||e instanceof String}function fp(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function pp(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){fp(s,r,i,o,a,"next",e)}function a(e){fp(s,r,i,o,a,"throw",e)}o(void 0)}))}}function mp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){mp(e,t,n[t])}))}return e}function vp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const yp=Zr,bp={start:/(\b|_)(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g};function _p(e){try{return e.startsWith("www.")?!!wp(`http://${e}`):!!wp(e)}catch(e){return!1}}function wp(e){return e instanceof URL?e:e.toLowerCase().startsWith("www.")?wp(`http://${e}`):new URL(e)}function Sp(e,t){let n;try{n=wp(t)}catch(e){throw new Error(`checkFileTypes: could not parse url ${t}`)}const r=n.pathname.split("/").pop().toLowerCase();return!!e.filter((e=>r.endsWith(e))).length}function xp(e){return Sp([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}function Ap(e){return Sp([".gif"],e)}function jp(e,t){var n;return!!(null==t||null===(n=t.get("content-type"))||void 0===n?void 0:n.startsWith("audio"))||Sp([".ogg",".mp3",".m4a"],e)}function $p(e,t){var n;return!!(null==t||null===(n=t.get("content-type"))||void 0===n?void 0:n.startsWith("video"))||Sp([".mp4",".webm"],e)}function Ep(e,t){var n;if(null==t||null===(n=t.get("content-type"))||void 0===n?void 0:n.startsWith("video"))return!0;const r=yp.get("image_urls_regex");return(null==r?void 0:r.test(e))||xp(e)}function Op(e){return wp(e).href.startsWith("aesgcm://")}function Cp(e,t,n){const r=(n=n||{}).start||bp.start,i=n.end||bp.end,s=n.trim||bp.trim,o=n.parens||bp.parens,a=/[a-z0-9-]=["']?$/i;for(r.lastIndex=0;;){const c=r.exec(e);if(!c)break;let l=c.index;if(n.ignoreHtml){const t=e.slice(Math.max(l-3,0),l);if(t&&a.test(t))continue}let u=l+e.slice(l).search(i),d=e.slice(l,u),h=-1;for(;;){const e=o.exec(d);if(!e)break;const t=e.index+e[0].length;h=Math.max(h,t)}if(d=h>-1?d.slice(0,h)+d.slice(h).replace(s,""):d.replace(s,""),d.length<=c[0].length)continue;if(n.ignore&&n.ignore.test(d))continue;u=l+d.length;const f=t(d,l,u);void 0!==f?(e=e.slice(0,l)+String(f)+e.slice(u),r.lastIndex=l+String(f).length):r.lastIndex=u}return r.lastIndex=0,e}function kp(e){return pp((function*(){try{return(yield fetch(e,{method:"HEAD"})).headers}catch(t){return console.debug(`Error calling HEAD on url ${e}: ${t}`),null}}))()}function Tp(e){return pp((function*(){const t=Zr.get("fetch_url_headers")?yield kp(e.url):null;return vp(gp({},e),{is_gif:Ap(e.url),is_audio:jp(e.url,t),is_image:Ep(e.url,t),is_video:$p(e.url,t),is_encrypted:Op(e.url)})}))()}function Np(e,t=0){return pp((function*(){const n=[];if(!e)return{};try{Cp(e,((e,r,i)=>(e.startsWith("_")&&(e=e.slice(1),r+=1),e.endsWith("_")&&(e=e.slice(0,e.length-1),i-=1),_p(e)&&n.push({url:e,start:r+t,end:i+t}),e)))}catch(e){Q.debug(e)}const r=yield Promise.all(n.map(Tp));return r.length?{media_urls:r}:{}}))()}function Mp(e,t){return e.map((e=>{if(e.start<0||e.start>=t.length)return null;const n=t.substring(e.start,e.end);return vp(gp({},e),{url:n})})).filter((e=>e))}function Ip(e,t,n=0){return e.map((e=>{const r=e.start-n,i=e.end-n;return r<0||r>=t.length?null:Object.assign({},e,{start:r,end:i,url:t.substring(e.start-n,e.end-n)})})).filter((e=>e))}function Pp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dp(e){if(location.hash.startsWith("#converse?loglevel=")){null==e||e.preventDefault();const t=location.hash.split("=").pop();Object.keys(J).includes(t)?Q.setLogLevel(t):Q.error(`Could not set loglevel of ${t}`)}}function Rp(e){return e instanceof ae.Model&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message||e.body)}function zp(e){return Math.random()*e|0}function Lp(e){var t,n,r;const i=null!==(r=null===(t=(n=crypto).randomUUID)||void 0===t?void 0:t.call(n))&&void 0!==r?r:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=zp(16);return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?i+":"+e:i}const Up=Object.assign(function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Pp(e,t,n[t])}))}return e}({},f,p,m,g,d,c,a,r,l,i,h,o,v,y),{getRandomInt:zp,getUniqueId:Lp,isEmptyMessage:Rp,onMultipleEvents:function(e=[],t){let n=[];function r(r){n.push(r),e.length===n.length&&(t(n),n=[])}e.forEach((e=>e.object.on(e.event,r)))},prefixMentions:function(e){let t=e.getMessageText();return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},shouldCreateMessage:function(e){return e.retracted||!Rp(e)},triggerEvent:function(e,t,n="Event",r=!0,i=!0){const s=document.createEvent(n);s.initEvent(t,r,i),e.dispatchEvent(s)}}),{muc:null,mam:null});function Bp(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Ao.api=Wu;const Fp={$build:rs,$iq:ss,$msg:is,$pres:os,Collection:ae.Collection,Model:ae.Model,Stanza:Ls,Strophe:Bs,TimeoutError:Ll,VERSION_NAME:Hs,css:(e,...t)=>{const n=1===e.length?e[0]:t.reduce(((t,n,r)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+e[r+1]),e[0]);return new wh(n,e,bh)},dayjs:W(),errors:u,filesize:gh,html:mf,log:Q,nothing:yf,render:Pf,sizzle:ee(),sprintf:te.sprintf,stx:Us,u:Up,utils:Up},qp=Object.assign(window.converse||{},{CHAT_STATES:go,keycodes:yo,initialize(e){return(t=function*(){var t,n;const{api:r}=Ao;if(yield _l(Ao),function(e){Xr=e,Yr=new Qr;const t=Fr(e,Object.keys(qr));Object.assign(Yr,qr,t)}(e),Ao.strict_plugin_dependencies=e.strict_plugin_dependencies,Q.setLogLevel(r.settings.get("loglevel")),r.settings.get("authentication")===Js&&r.settings.get("auto_login")&&!r.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");Dp(),addEventListener("hashchange",Dp);const i=new qf;Object.assign(Ao,{connfeedback:i}),Object.assign(Ao.state,{connfeedback:i}),Ao.env=Fp,yield pl(Ao),yield fl(Ao),yield re.initialize(),hl(Ao),null===(t=r.elements)||void 0===t||t.register(),bl(Ao);const s=Ao.pluggable.plugins;if((r.settings.get("auto_login")||r.settings.get("keepalive")&&(null===(n=s["converse-bosh"])||void 0===n?void 0:n.enabled()))&&(yield r.user.login(null,null,!0)),r.trigger("initialized"),ri())return Ao},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){Bp(s,r,i,o,a,"next",e)}function a(e){Bp(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t},plugins:{add(e,t){if(t.__name__=e,void 0!==Ao.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);Ao.pluggable.plugins[e]=t}},env:Fp}),Hp=qp,{u:Gp,stx:Wp,Stanza:Vp}=Hp.env;function Kp(e,t){Wu.send(Wp`<message to="${e.getAttribute("from")}"
                    type="error"
                    id="${e.getAttribute("id")}"
                    xmlns="jabber:client">
                <error type="cancel">
                    <not-allowed xmlns="${Bs.NS.STANZAS}"/>
                    <text xmlns="${Bs.NS.STANZAS}">${t}</text>
                </error>
            </message>`),Q.warn(`Rejecting message stanza with the following reason: ${t}`),Q.warn(e)}function Jp(e,t,n,r){if(!vo.includes(n))return void Q.error(`Invalid marker type: ${n}`);const i=Wp`
        <message from="${Wu.connection.get().jid}"
                id="${Gp.getUniqueId()}"
                to="${e}"
                type="${r||"chat"}"
                xmlns="jabber:client">
            <${Vp.unsafeXML(n)} xmlns="${Bs.NS.MARKERS}" id="${t}"/>
        </message>`;Wu.send(i)}function Yp(e,t){if(e)if(go.includes(t)){if(Wu.settings.get("send_chat_state_notifications")&&t){const n=Wu.settings.get("send_chat_state_notifications");if(Array.isArray(n)&&!n.includes(t))return;Wu.send(Wp`<message id="${Gp.getUniqueId()}" to="${e}" type="chat" xmlns="jabber:client">
                <${Vp.unsafeXML(t)} xmlns="${Bs.NS.CHATSTATES}"/>
                <no-store xmlns="${Bs.NS.HINTS}"/>
                <no-permanent-store xmlns="${Bs.NS.HINTS}"/>
            </message>`)}}else Q.error(`Invalid chat state: ${t}`);else Q.error("sendChatState called with no JID")}function Xp(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Qp(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Xp(s,r,i,o,a,"next",e)}function a(e){Xp(s,r,i,o,a,"throw",e)}o(void 0)}))}}function Zp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function em(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zp(e,t,n[t])}))}return e}function tm(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{NS:nm}=Bs;function rm(e){return Qp((function*(){var t;if(null===e)return null;if(e instanceof Error)return e;if("error"!==e.getAttribute("type"))return null;const n=e.querySelector("error");if(!n)return null;const r=null===(t=ee()(`[xmlns="${Bs.NS.STANZAS}"]`,n).filter((e=>e.nodeName&&"text"!==e.nodeName)).pop())||void 0===t?void 0:t.nodeName,i=yield Wu.hook("parseErrorStanza",e,{});return"bad-request"===r?new Fl(r,n,i):"conflict"===r?new ql(r,n,i):"feature-not-implemented"===r?new Hl(r,n,i):"forbidden"===r?new Gl(r,n,i):"gone"===r?new Wl(r,n,i):"internal-server-error"===r?new Vl(r,n,i):"item-not-found"===r?new Kl(r,n,i):"jid-malformed"===r?new Jl(r,n,i):"not-acceptable"===r?new Yl(r,n,i):"not-allowed"===r?new Xl(r,n,i):"not-authorized"===r?new Ql(r,n,i):"payment-required"===r?new Zl(r,n,i):"recipient-unavailable"===r?new eu(r,n,i):"redirect"===r?new tu(r,n,i):"registration-required"===r?new nu(r,n,i):"remote-server-not-found"===r?new ru(r,n,i):"remote-server-timeout"===r?new iu(r,n,i):"resource-constraint"===r?new su(r,n,i):"service-unavailable"===r?new ou(r,n,i):"subscription-required"===r?new au(r,n,i):"undefined-condition"===r?new cu(r,n,i):"unexpected-request"===r?new lu(r,n,i):new Ul("unknown",n)}))()}function im(e,t){var n;const r=ee()(`stanza-id[xmlns="${Bs.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{}),i=em({origin_id:null===(n=ee()(`origin-id[xmlns="${Bs.NS.SID}"]`,e).pop())||void 0===n?void 0:n.getAttribute("id"),msgid:e.getAttribute("id")||t.getAttribute("id")},r),s=ee()(`message > result[xmlns="${Bs.NS.MAM}"]`,t).pop();if(s){const e=Ao.session.get("bare_jid");i[`stanza_id ${t.getAttribute("from")||e}`]=s.getAttribute("id")}return i}function sm(e){const t=ee()(`encryption[xmlns="${Bs.NS.EME}"]`,e).pop(),n=null==t?void 0:t.getAttribute("namespace"),r={};return n?(r.is_encrypted=!0,r.encryption_namespace=n):ee()(`encrypted[xmlns="${Bs.NS.OMEMO}"]`,e).pop()&&(r.is_encrypted=!0,r.encryption_namespace=Bs.NS.OMEMO),r}function om(e,t){const n=ee()(`> retract[xmlns="${Bs.NS.RETRACT}"]`,e).pop();if(n){const e=ee()(`> delay[xmlns="${Bs.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:e?W()(e.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:n.getAttribute("id")}}{const t=ee()(`> retracted[xmlns="${Bs.NS.RETRACT}"]`,e).pop()||ee()(`> retracted[xmlns="${Bs.NS.RETRACT0}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp"),retraction_id:t.getAttribute("id")}}return function(e,t){const n=ee()(`> apply-to[xmlns="${Bs.NS.FASTEN}"]`,e).pop();if(n){const e=n.getAttribute("id");if(ee()(`> retract[xmlns="${Bs.NS.RETRACT0}"]`,n).pop()){const n=ee()(`delay[xmlns="${Bs.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:n?W()(n.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}return{}}(e,t)}function am(e,t){const n=ee()(`replace[xmlns="${Bs.NS.MESSAGE_CORRECT}"]`,e).pop();if(n){const e=n.getAttribute("id");if(e){const n=ee()(`delay[xmlns="${Bs.NS.DELAY}"]`,t).pop();return{replace_id:e,edited:n?W()(n.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function cm(e){const t=ee()(`spoiler[xmlns="${Bs.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:null==t?void 0:t.textContent}}function lm(e){const t=ee()(`x[xmlns="${Bs.NS.OUTOFBAND}"]`,e).pop();var n,r;return t?{oob_url:null===(n=t.querySelector("url"))||void 0===n?void 0:n.textContent,oob_desc:null===(r=t.querySelector("desc"))||void 0===r?void 0:r.textContent}:{}}function um(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),n=ee()(`text[xmlns="${Bs.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:null==n?void 0:n.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName,errors:Array.from(t.children).map((e=>({name:e.nodeName,xmlns:e.getAttribute("xmlns")})))}}return{}}function dm(e){return ee()(`reference[xmlns="${Bs.NS.REFERENCE}"]`,e).map((t=>{var n;const r=t.getAttribute("anchor"),i=null===(n=e.querySelector(r?`#${r}`:"body"))||void 0===n?void 0:n.textContent;if(!i)return Q.warn(`Could not find referenced text for ${t}`),null;const s=Number(t.getAttribute("begin")),o=Number(t.getAttribute("end"));return{begin:s,end:o,type:t.getAttribute("type"),value:i.slice(s,o),uri:t.getAttribute("uri")}})).filter((e=>e))}function hm(e){const t=ee()(`received[xmlns="${Bs.NS.RECEIPTS}"]`,e).pop();return null==t?void 0:t.getAttribute("id")}function fm(e){const t=Bs.NS.CARBONS;return ee()(`message > received[xmlns="${t}"]`,e).length>0||ee()(`message > sent[xmlns="${t}"]`,e).length>0}function pm(e){var t;return null===(t=ee()(`\n        composing[xmlns="${nm.CHATSTATES}"],\n        paused[xmlns="${nm.CHATSTATES}"],\n        inactive[xmlns="${nm.CHATSTATES}"],\n        active[xmlns="${nm.CHATSTATES}"],\n        gone[xmlns="${nm.CHATSTATES}"]`,e).pop())||void 0===t?void 0:t.nodeName}function mm(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&ee()(`request[xmlns="${Bs.NS.RECEIPTS}"]`,e).length}function gm(e){if(ee()(`message > forwarded[xmlns="${Bs.NS.FORWARD}"]`,e).length){Kp(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new Bl(e,`Ignoring unencapsulated forwarded message from ${t}`)}}function vm(e){return ee()(`\n        acknowledged[xmlns="${Bs.NS.MARKERS}"],\n        displayed[xmlns="${Bs.NS.MARKERS}"],\n        received[xmlns="${Bs.NS.MARKERS}"]`,e).pop()}function ym(e){return"headline"===e.getAttribute("type")}function bm(e){if(ee()(`mentions[xmlns="${Bs.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function _m(e){return!!ee()(`message > result[xmlns="${Bs.NS.MAM}"]`,e).pop()}function wm(e,t,n){var r;const i=e.getAttribute("var"),s=e.getAttribute("label")||"",o=e.getAttribute("type"),a={readonly:t,desc:null===(r=e.querySelector("desc"))||void 0===r?void 0:r.textContent};if("list-single"===o||"list-multi"===o){const t=Array.from(e.querySelectorAll(":scope > value")).map((e=>null==e?void 0:e.textContent)),n=Array.from(e.querySelectorAll(":scope > option")).map((n=>{var r;const i=null===(r=n.querySelector("value"))||void 0===r?void 0:r.textContent;return em({value:i,label:n.getAttribute("label"),selected:t.includes(i),required:!!e.querySelector("required")},a)}));return em({type:o,options:n,label:e.getAttribute("label"),var:i,required:!!e.querySelector("required")},a)}if("fixed"===o){var c;return em({text:null===(c=e.querySelector("value"))||void 0===c?void 0:c.textContent,label:s,type:o,var:i},a)}var l,u,d,h,f;if("jid-multi"===o)return em({type:o,var:i,label:s,value:null===(l=e.querySelector("value"))||void 0===l?void 0:l.textContent,required:!!e.querySelector("required")},a);if("boolean"===o){var p;const t=null===(p=e.querySelector("value"))||void 0===p?void 0:p.textContent;return em({type:o,var:i,label:s,checked:"1"===t||"true"===t},a)}if("url"===i)return em({var:i,label:s,value:null===(u=e.querySelector("value"))||void 0===u?void 0:u.textContent},a);if("username"===i)return em({var:i,label:s,value:null===(d=e.querySelector("value"))||void 0===d?void 0:d.textContent,required:!!e.querySelector("required"),type:Sm(e)},a);if("password"===i)return em({var:i,label:s,value:null===(h=e.querySelector("value"))||void 0===h?void 0:h.textContent,required:!!e.querySelector("required")},a);if("ocr"===i){const t=e.querySelector("uri"),r=ee()('data[cid="'+t.textContent.replace(/^cid:/,"")+'"]',n)[0];return em({label:e.getAttribute("label"),var:i,uri:{type:t.getAttribute("type"),data:null==r?void 0:r.textContent},required:!!e.querySelector("required")},a)}return em({label:s,var:i,required:!!e.querySelector("required"),value:null===(f=e.querySelector("value"))||void 0===f?void 0:f.textContent,type:Sm(e)},a)}function Sm(e){const t=bo[e.getAttribute("type")];if("text"==t){const n=e.getElementsByTagNameNS("http://jabber.org/protocol/xdata-validate","validate");if(1===n.length){const e=n[0].getAttribute("datatype");return _o[e]||t}}return t}function xm(e){var t;const n=ee()(`x[xmlns="${Bs.NS.XFORM}"]`,e);if(n.length>1)throw Q.error(e),new Error("Invalid stanza");if(0===n.length)return null;const r=n[0],i=r.getAttribute("type"),s={type:i,title:null===(t=r.querySelector("title"))||void 0===t?void 0:t.textContent};if("result"===i){const t=r.querySelector(":scope > reported");if(t){const e=t?Array.from(t.querySelectorAll(":scope > field")):[],n=Array.from(r.querySelectorAll(":scope > item"));return tm(em({},s),{reported:e.map(ch),items:n.map((e=>Array.from(e.querySelectorAll("field")).map((e=>{var t,n;return tm(em({},ch(e)),{value:null!==(n=null===(t=e.querySelector("value"))||void 0===t?void 0:t.textContent)&&void 0!==n?n:""})}))))})}return tm(em({},s),{fields:Array.from(r.querySelectorAll("field")).map((t=>wm(t,!0,e)))})}var o;if("form"===i)return tm(em({},s),{instructions:null===(o=r.querySelector("instructions"))||void 0===o?void 0:o.textContent,fields:Array.from(r.querySelectorAll("field")).map((t=>wm(t,!1,e)))});throw new Error(`Invalid type in XForm response stanza: ${i}`)}function Am(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function jm(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Am(s,r,i,o,a,"next",e)}function a(e){Am(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{safeSave:$m,colorize:Em}=Up;function Om(e){return class extends e{setColor(){return jm((function*(){const e=yield Em(this.getIdentifier());$m(this,{color:e})})).call(this)}getIdentifier(){return this.get("type")===uo?this.get("jid"):"groupchat"===this.get("type")?this.get("from_real_jid")||this.get("from"):this.get("occupant_id")||this.get("jid")||this.get("from")||this.get("nick")}getColor(){return jm((function*(){return this.get("color")||(yield this.setColor()),this.get("color")})).call(this)}getAvatarStyle(e=""){return jm((function*(){try{return`background-color: ${yield this.getColor()} !important; ${e}`}catch(t){return`background-color: gray !important; ${e}`}})).call(this)}}}function Cm(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function km(e){return class extends e{initialize(){super.initialize(),this.rosterContactAdded=ue(),this.contact=null}setModelContact(e){return(t=function*(){var t;if((null===(t=this.contact)||void 0===t?void 0:t.get("jid"))===e)return;const{session:n,state:r}=Ao;let i;Bs.getBareJidFromJid(e)===n.get("bare_jid")?i=r.profile:(i=yield Wu.contacts.get(e),i||(yield Wu.blocklist.get()).get(e)||(i=yield Wu.contacts.add({jid:e},!1,!1))),i&&(this.contact=i,this.set("nickname",i.get("nickname")),this.listenTo(this.contact,"vcard:add",(e=>{this.trigger("contact:change",e)})),this.listenTo(this.contact,"vcard:change",(e=>{this.trigger("contact:change",e)})),this.listenTo(this.contact,"change",(e=>{e.nickname&&this.set("nickname",e.nickname),this.trigger("contact:change",e)})),this.listenTo(this.contact,"destroy",(()=>{delete this.contact})),this.rosterContactAdded.resolve(),this.trigger("contactAdded",this.contact))},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){Cm(s,r,i,o,a,"next",e)}function a(e){Cm(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}}}function Tm(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{u:Nm}=Hp.env;function Mm(e){return(t=function*(){var t,n,r,i,s,o,a;const c={email:null===(t=e.querySelector(":scope > vCard EMAIL USERID"))||void 0===t?void 0:t.textContent,fullname:null===(n=e.querySelector(":scope > vCard FN"))||void 0===n?void 0:n.textContent,image:null===(r=e.querySelector(":scope > vCard PHOTO BINVAL"))||void 0===r?void 0:r.textContent,image_type:null===(i=e.querySelector(":scope > vCard PHOTO TYPE"))||void 0===i?void 0:i.textContent,nickname:null===(s=e.querySelector(":scope > vCard NICKNAME"))||void 0===s?void 0:s.textContent,role:null===(o=e.querySelector(":scope > vCard ROLE"))||void 0===o?void 0:o.textContent,stanza:e,url:null===(a=e.querySelector(":scope > vCard URL"))||void 0===a?void 0:a.textContent,vcard_updated:(new Date).toISOString(),error:void 0,vcard_error:void 0,image_hash:void 0};if(c.image){const e=Nm.base64ToArrayBuffer(c.image),t=yield crypto.subtle.digest("SHA-1",e);c.image_hash=Nm.arrayBufferToHex(t)}return c},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){Tm(s,r,i,o,a,"next",e)}function a(e){Tm(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function Im(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Pm(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Im(s,r,i,o,a,"next",e)}function a(e){Im(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:Dm,$iq:Rm,sizzle:zm,stx:Lm}=Hp.env;function Um(e,t,n){const r=Rm(t?{type:e,to:t}:{type:e});return n?r.cnode(n):r.c("vCard",{xmlns:Dm.NS.VCARD}),r}function Bm(e,t=!1){return Pm((function*(){let n;if(yield Wu.waitUntil("VCardsInitialized"),e instanceof Ao.exports.MUCOccupant)n=yield function(e,t=!0){return Pm((function*(){var n;yield Wu.waitUntil("VCardsInitialized");const{vcards:r,profile:i}=Ao.state,s=null==e||null===(n=e.collection)||void 0===n?void 0:n.chatroom,o=e.get("nick");if(o&&(null==s?void 0:s.get("nick"))===o)return i.vcard;{const n=e.get("jid")||e.get("from");return n?r.get(n)||r.create({jid:n},{lazy_load:t}):(Q.debug("Could not get VCard for occupant because no JID found!"),null)}}))()}(e,t);else if(e instanceof Ao.exports.MUCMessage)n=yield function(e,t=!0){return Pm((function*(){var n;if(["error","info"].includes(e.get("type")))return;yield Wu.waitUntil("VCardsInitialized");const{vcards:r,profile:i}=Ao.state,s=null==e||null===(n=e.collection)||void 0===n?void 0:n.chatbox,o=Dm.getResourceFromJid(e.get("from"));if(o&&(null==s?void 0:s.get("nick"))===o)return i.vcard;{var a;const n=(null===(a=e.occupant)||void 0===a?void 0:a.get("jid"))||e.get("from");return n?r.get(n)||r.create({jid:n},{lazy_load:t}):(Q.warn(`Could not get VCard for message because no JID found! msgid: ${e.get("msgid")}`),null)}}))()}(e,t);else{let r;if(e instanceof Ao.exports.Message){if(["error","info"].includes(e.get("type")))return;r=Dm.getBareJidFromJid(e.get("from"))}else r=e.get("jid");if(!r)return Q.warn("Could not set VCard on model because no JID found!"),null;const{vcards:i}=Ao.state;n=i.get(r)||i.create({jid:r},{lazy_load:t})}return n&&n.on("change",(()=>e.trigger("vcard:change"))),n}))()}function Fm(e){return Pm((function*(){const t=Ao.session.get("bare_jid"),n=Dm.getBareJidFromJid(e)===t?null:e;let r;try{r=yield Wu.sendIQ(Um("get",n))}catch(t){var i;const{message:n}=null!==(i=Qd(t)?yield rm(t):t)&&void 0!==i?i:{};return{jid:e,stanza:Qd(t)?t:null,error:n,vcard_error:(new Date).toISOString()}}return Mm(r)}))()}let qm;function Hm(){const e=Wu.connection.get();qm=e.addHandler((e=>{try{!function(e){Pm((function*(){yield Wu.waitUntil("VCardsInitialized");const t=zm(`x[xmlns="${Dm.NS.VCARD_UPDATE}"] photo`,e).pop();if(t){const n=t.textContent,r=Dm.getBareJidFromJid(e.getAttribute("from")),i=yield Ao.state.vcards.get(r);(null==i?void 0:i.get("image_hash"))!==n&&Wu.vcard.update(r,!0).catch((e=>Q.error(e)))}}))()}(e)}catch(e){Q.error(e)}return!0}),null,"presence",null)}function Gm(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Wm(e){return class extends e{initialize(){super.initialize(),this.getVCard()}get vcard(){return this._vcard}getVCard(){return(e=function*(){var e;const{pluggable:t}=Ao;return(null===(e=t.plugins["converse-vcard"])||void 0===e?void 0:e.enabled(Ao))?(this._vcard||(this._vcard=yield Bm(this,this.lazy_load_vcard),this.trigger("vcard:add",{vcard:this._vcard})),this._vcard):null},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Gm(s,r,i,o,a,"next",e)}function a(e){Gm(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}constructor(...e){super(...e),this._vcard=null,this.lazy_load_vcard=!1}}}function Vm(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Km(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Vm(s,r,i,o,a,"next",e)}function a(e){Vm(s,r,i,o,a,"throw",e)}o(void 0)}))}}Dm.addNamespace("VCARD_UPDATE","vcard-temp:x:update");class Jm extends(Wm(km(Om(ae.Model)))){defaults(){return{msgid:Lp(),time:(new Date).toISOString(),is_ephemeral:!1}}initialize(){var e;this.lazy_load_vcard=!0,super.initialize(),this.chatbox=null===(e=this.collection)||void 0===e?void 0:e.chatbox,this.checkValidity()&&(this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),this.setTimerForEphemeralMessage())}checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)}safeDestroy(){try{this.destroy()}catch(e){Q.warn(`safeDestroy: ${e}`)}}setTimerForEphemeralMessage(){this.ephemeral_timer&&clearTimeout(this.ephemeral_timer);const e=this.isEphemeral();if(e){const t="number"==typeof e?e:1e4;this.ephemeral_timer=setTimeout((()=>this.safeDestroy()),t)}}isEphemeral(){return this.get("is_ephemeral")}isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")}isRetracted(){return this.get("retracted")||"retracted"===this.get("moderated")}isFollowup(){var e;const t=null===(e=this.collection)||void 0===e?void 0:e.models;if(!t)return!1;const n=t.indexOf(this),r=n?t[n-1]:null;if(null===r)return!1;const i=W()(this.get("time"));return this.get("from")===r.get("from")&&!this.isRetracted()&&!r.isRetracted()&&!this.isMeCommand()&&!r.isMeCommand()&&!!this.get("is_encrypted")==!!r.get("is_encrypted")&&this.get("type")===r.get("type")&&"info"!==this.get("type")&&i.isBefore(W()(r.get("time")).add(10,"minutes"))&&("groupchat"!==this.get("type")||this.get("occupant_id")===r.get("occupant_id"))}mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(Wu.settings.get("allow_message_retraction"))}getMessageText(){if(this.get("is_encrypted")){const{__:e}=Ao;return this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message")}return["groupchat","chat","normal"].includes(this.get("type"))?this.get("body"):this.get("message")}sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=ss({from:Ao.session.get("jid"),to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:Bs.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return Wu.sendIQ(e)}getUploadRequestMetadata(e){return{headers:ee()(`slot[xmlns="${Bs.NS.HTTPUPLOAD}"] put header`,e).map((e=>({name:e.getAttribute("name"),value:e.textContent}))).filter((e=>["Authorization","Expires"].includes(e.name)))}}getRequestSlotURL(){return Km((function*(){const{__:e}=Ao;let t;try{t=yield this.sendSlotRequestStanza()}catch(t){return Q.error(t),this.save({is_ephemeral:!0,message:e("Sorry, could not determine upload URL."),type:"error"})}const n=ee()(`slot[xmlns="${Bs.NS.HTTPUPLOAD}"]`,t).pop();if(!n)return this.save({is_ephemeral:!0,message:e("Sorry, could not determine file upload URL."),type:"error"});this.upload_metadata=this.getUploadRequestMetadata(t),this.save({get:n.querySelector("get").getAttribute("url"),put:n.querySelector("put").getAttribute("url")})})).call(this)}uploadFile(){var e;const t=new XMLHttpRequest;t.onreadystatechange=e=>Km((function*(){if(t.readyState===XMLHttpRequest.DONE)if(Q.info("Status: "+t.status),200===t.status||201===t.status){let e={body:this.get("get"),message:this.get("get"),oob_url:this.get("get"),upload:no};e=yield Wu.hook("afterFileUploaded",this,e),this.save(e)}else Q.error(e),t.onerror(new ProgressEvent(`Response status: ${t.status}`))})).call(this),t.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),t.onerror=()=>{const{__:e}=Ao;let n;n=t.responseText?e('Sorry, could not succesfully upload your file. Your server’s response: "%1$s"',t.responseText):e("Sorry, could not succesfully upload your file."),this.save({is_ephemeral:!0,message:n,type:"error",upload:ro})},t.open("PUT",this.get("put"),!0),t.setRequestHeader("Content-type",this.file.type),null===(e=this.upload_metadata.headers)||void 0===e||e.forEach((e=>t.setRequestHeader(e.name,e.value))),t.send(this.file)}constructor(e,t){super(e,t),this.file=null,this.attributes}}const Ym=Jm;function Xm(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:Qm,sizzle:Zm}=Hp.env;function eg(e){return(t=function*(){var t,n,r,i,s;gm(e);let o=e.getAttribute("to");const a=Qm.getResourceFromJid(o),c=Ao.session.get("resource");if(Wu.settings.get("filter_by_resource")&&a&&a!==c)return new Bl(e,`Ignoring incoming message intended for a different resource: ${o}`);const l=Ao.session.get("bare_jid"),u=e;let d=e.getAttribute("from")||l;if(fm(e)){if(d!==l)return Kp(e,"Rejecting carbon from invalid JID"),new Bl(e,`Rejecting carbon from invalid JID ${o}`);{const t=`[xmlns="${Qm.NS.CARBONS}"] > forwarded[xmlns="${Qm.NS.FORWARD}"] > message`;o=(e=Zm(t,e).pop()).getAttribute("to"),d=e.getAttribute("from")}}const h=_m(e);if(h){if(d!==l)return new Bl(e,`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`);{const t=`[xmlns="${Qm.NS.MAM}"] > forwarded[xmlns="${Qm.NS.FORWARD}"] > message`;o=(e=Zm(t,e).pop()).getAttribute("to"),d=e.getAttribute("from")}}const f=Qm.getBareJidFromJid(d),p=f===l;if(p&&null===o)return new Bl(e,`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`);const m=ym(e),g=bm(e);let v,y;if(!m&&!g&&(y=p?Qm.getBareJidFromJid(o):f,v=yield Wu.contacts.get(y),void 0===v&&!Wu.settings.get("allow_non_roster_messaging")))return Q.error(e),new Bl(e,"Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.");const b=Zm(`delay[xmlns="${Qm.NS.DELAY}"]`,u).pop(),_=vm(e),w=(new Date).toISOString();let S=Object.assign({contact_jid:y,is_archived:h,is_headline:m,is_server_message:g,body:null===(n=e.querySelector("body"))||void 0===n||null===(t=n.textContent)||void 0===t?void 0:t.trim(),chat_state:pm(e),from:e.getAttribute("from"),is_carbon:fm(u),is_delayed:!!b,is_markable:!!Zm(`markable[xmlns="${Qm.NS.MARKERS}"]`,e).length,is_marker:!!_,is_unstyled:!!Zm(`unstyled[xmlns="${Qm.NS.STYLING}"]`,e).length,marker_id:_&&_.getAttribute("id"),nick:null==v||null===(r=v.attributes)||void 0===r?void 0:r.nickname,receipt_id:hm(e),received:(new Date).toISOString(),references:dm(e),sender:p?"me":"them",subject:null===(i=e.querySelector("subject"))||void 0===i?void 0:i.textContent,thread:null===(s=e.querySelector("thread"))||void 0===s?void 0:s.textContent,time:b?W()(b.getAttribute("stamp")).toISOString():w,to:e.getAttribute("to"),type:e.getAttribute("type")||"normal"},um(e),lm(e),cm(e),am(e,u),im(e,u),om(e,u),sm(e));if(S.is_archived){const t=u.getAttribute("from");if(t&&t!==l)return new Bl(e,`Invalid Stanza: Forged MAM message from ${t}`)}S=Object.assign({message:S.body||S.error,is_valid_receipt_request:mm(e,S)},S),S.id=S.origin_id||S[`stanza_id ${S.from}`]||Up.getUniqueId(),S=yield Wu.hook("parseMessage",e,S);const x=yield Up.getMediaURLsMetadata(S.is_encrypted?S.plaintext:S.body);return Object.assign(S,x)},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){Xm(s,r,i,o,a,"next",e)}function a(e){Xm(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function tg(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function ng(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){tg(s,r,i,o,a,"next",e)}function a(e){tg(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:rg,u:ig}=Hp.env;function sg(e){if(!location.hash.startsWith("#converse/chat?jid="))return;null==e||e.preventDefault();const t=location.hash.split("=").pop();if(!ig.isValidJID(t))return Q.warn(`Invalid JID "${t}" provided in URL fragment`);Wu.chats.open(t)}function og(){Wu.settings.get("auto_join_private_chats").forEach((e=>{Ao.state.chatboxes.where({jid:e}).length||("string"==typeof e?Wu.chats.open(e):Q.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),Wu.trigger("privateChatsAutoJoined")}function ag(){Wu.connection.get().addHandler((e=>!!(["groupchat","error"].includes(e.getAttribute("type"))||ym(e)||bm(e)||_m(e))||(Ao.exports.handleMessageStanza(e)||!0)),null,"message"),Wu.connection.get().addHandler((e=>(function(e){ng((function*(){const t=rg.getBareJidFromJid(e.getAttribute("from")),n=Ao.session.get("bare_jid");if(ig.isSameBareJID(t,n))return;const r=yield Wu.chatboxes.get(t);(null==r?void 0:r.get("type"))===lo&&(null==r||r.handleErrorMessageStanza(e))}))()}(e),!0)),null,"message","error")}function cg(e){return ng((function*(){if(bm(e=e instanceof Element?e:e.tree())){const t=e.getAttribute("from");return Q.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}if(yield function(e){return Qp((function*(){const t=Bs.getBareJidFromJid(e.getAttribute("from"));return!!(yield Wu.rooms.get(t))}))()}(e))return!0;let t;try{t=yield eg(e)}catch(e){return Q.error(e)}if(ig.isErrorObject(t)){const{stanza:e,message:n}=t;return e&&Q.error(e),Q.error(n)}const{body:n,plaintext:r,contact_jid:i,nick:s}=t,o=!(!n&&!r),a=yield Wu.chats.get(i,{nickname:s},o);yield null==a?void 0:a.queueMessage(t);const c={stanza:e,attrs:t,chatbox:a};Wu.trigger("message",c)}))()}function lg(){return ng((function*(){const e=Ao.session.get("bare_jid"),t=rg.getDomainFromJid(e);if(!(yield Wu.disco.supports(rg.NS.CARBONS,t)))return void Q.warn("Not enabling carbons because it's not supported!");const n=new rg.Builder("iq",{from:Wu.connection.get().jid,type:"set"}).c("enable",{xmlns:rg.NS.CARBONS}),r=yield Wu.sendIQ(n,null,!1);null===r?Q.warn("A timeout occurred while trying to enable carbons"):ig.isErrorStanza(r)?(Q.warn("An error occurred while trying to enable message carbons."),Q.error(r)):Q.debug("Message carbons have been enabled.")}))()}function ug(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function dg(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){ug(s,r,i,o,a,"next",e)}function a(e){ug(s,r,i,o,a,"throw",e)}o(void 0)}))}}function hg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Strophe:fg,stx:pg,u:mg}=Hp.env;function gg(e){return class extends e{initialize(){var e=this,t=()=>super.initialize;return dg((function*(){t().call(e),this.initUI(),this.initMessages(),this.initNotifications(),this.ui.on("change:scrolled",(()=>this.onScrolledChanged()))})).call(this)}initNotifications(){this.notifications=new ae.Model}initUI(){this.ui=new ae.Model}getDisplayName(){return this.get("jid")}canPostMessages(){return!0}createMessage(e,t){return dg((function*(){return e.time=e.time||(new Date).toISOString(),yield this.messages.fetched,this.messages.create(e,t)})).call(this)}getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${Ao.session.get("bare_jid")}`}getMessagesCollection(){return new Ao.exports.Messages}getNotificationsText(){var e,t,n;const{__:r}=Ao;return(null===(e=this.notifications)||void 0===e?void 0:e.get("chat_state"))===oo?r("%1$s is typing",this.getDisplayName()):(null===(t=this.notifications)||void 0===t?void 0:t.get("chat_state"))===ao?r("%1$s has stopped typing",this.getDisplayName()):(null===(n=this.notifications)||void 0===n?void 0:n.get("chat_state"))===co?r("%1$s has gone away",this.getDisplayName()):""}initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=ue(),this.messages.chatbox=this,nl(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"add",(e=>this.onMessageAdded(e))),this.listenTo(this.messages,"change:upload",(e=>this.onMessageUploadChanged(e))),this.listenTo(this.messages,"change:correcting",(e=>this.onMessageCorrecting(e)))}fetchMessages(){if(this.messages.fetched_flag)return void Q.info(`Not re-fetching messages for ${this.get("jid")}`);this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:()=>{this.afterMessagesFetched(),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched}afterMessagesFetched(){this.pruneHistoryWhenScrolledDown(),Wu.trigger("afterMessagesFetched",this)}onMessage(e){return dg((function*(){throw new zl("onMessage is not implemented")}))()}getUpdatedMessageAttributes(e,t){return t.error_type||"Decryption"!==e.get("error_type")?{is_archived:t.is_archived,time:t.time?t.time:e.get("time")}:Object.assign({},t,{error_condition:void 0,error_message:void 0,error_text:void 0,error_type:void 0,is_archived:t.is_archived,is_ephemeral:!1,is_error:!1})}updateMessage(e,t){const n=this.getUpdatedMessageAttributes(e,t);n&&e.save(n)}handleCorrection(e){return dg((function*(){if(!e.replace_id||!e.from)return;let t;if("groupchat"===e.type){const{occupant_id:n,replace_id:r}=e;t=n?({attributes:e})=>e.msgid===r&&e.occupant_id==n:({attributes:t})=>t.msgid===e.replace_id&&t.from===e.from&&null==t.occupant_id}else t=({attributes:t})=>t.msgid===e.replace_id&&t.from===e.from&&null==t.occupant_id;const n=this.messages.models.find(t);if(!n)return e.older_versions={},yield this.createMessage(e);const r=n.get("older_versions")||{};return e.time<n.get("time")&&n.get("edited")?(r[e.time]=e.message,n.save({older_versions:r})):(Object.keys(r).length?r[n.get("edited")]=n.getMessageText():r[n.get("time")]=n.getMessageText(),delete(e=Object.assign(e,{older_versions:r})).msgid,delete e.id,e.time=n.get("time"),n.save(e)),n})).call(this)}queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>Q.error(e))),this.msg_chain}getOutgoingMessageAttributes(e){return dg((function*(){throw new zl("getOutgoingMessageAttributes is not implemented")}))()}sendMessage(e){return dg((function*(){var t;if(yield null===(t=Hp.emojis)||void 0===t?void 0:t.initialized_promise,!this.canPostMessages())return void Q.warn("sendMessage was called but canPostMessages is false");e=yield this.getOutgoingMessageAttributes(e);let n=this.messages.findWhere("correcting");if(n){const t=n.get("older_versions")||{};t[n.get("edited")||n.get("time")]=n.getMessageText(),n.save(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){hg(e,t,n[t])}))}return e}({},["body","is_only_emojis","media_urls","references","is_encrypted"].reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{}),{correcting:!1,edited:(new Date).toISOString(),message:e.body,ogp_metadata:[],older_versions:t,origin_id:mg.getUniqueId(),plaintext:e.is_encrypted?e.message:void 0,received:void 0}))}else this.setEditable(e,(new Date).toISOString()),n=yield this.createMessage(e);try{const e=yield this.createMessageStanza(n);Wu.send(e)}catch(e){return n.destroy(),void Q.error(e)}return Wu.trigger("sendMessage",{chatbox:this,message:n}),n})).call(this)}retractOwnMessage(e){const t=mg.getUniqueId();!function(e,t,n){const r=t.get("origin_id");if(!r)throw new Error("Can't retract message without a XEP-0359 Origin ID");const i=Wp`
        <message id="${n}"
                 to="${e}"
                 type="chat"
                 xmlns="jabber:client">
            <retract id="${r}" xmlns="${Bs.NS.RETRACT}"/>
            <body>/me retracted a message</body>
            <store xmlns="${Bs.NS.HINTS}"/>
            <fallback xmlns="${Bs.NS.FALLBACK}" for="${Bs.NS.RETRACT}" />
        </message>`;Wu.connection.get().send(i)}(this.get("jid"),e,t),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:t,is_ephemeral:!0,editable:!1})}sendFiles(e){return dg((function*(){var t;const{__:n,session:r}=Ao,i=(yield Wu.disco.features.get(fg.NS.HTTPUPLOAD,r.get("domain"))).pop();if(!i)return void this.createMessage({message:n("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const s=i.dataforms.where({FORM_TYPE:{value:fg.NS.HTTPUPLOAD,type:"hidden"}}).pop(),o=parseInt(null===(t=((null==s?void 0:s.attributes)||{})["max-file-size"])||void 0===t?void 0:t.value,10),a=null==i?void 0:i.id;a?Array.from(e).forEach((e=>dg((function*(){if(e=yield Wu.hook("beforeFileUpload",this,e),!isNaN(o)&&e.size>o){const t=gh(o),r=Array.isArray(t)?n("The size of your file, %1$s, exceeds the maximum allowed by your server.",e.name):n("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,t);return this.createMessage({message:r,type:"error",is_ephemeral:!0})}{const t=yield this.getOutgoingMessageAttributes(),n=Object.assign(t,{file:!0,progress:0,slot_request_url:a});this.setEditable(n,(new Date).toISOString());const r=yield this.createMessage(n,{silent:!0});r.file=e,this.messages.trigger("add",r),r.getRequestSlotURL()}})).call(this))):this.createMessage({message:n("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})})).call(this)}setEditable(e,t){if(!e.is_headline&&!mg.isEmptyMessage(e)&&"me"===e.sender)if("all"===Wu.settings.get("allow_message_corrections"))e.editable=!(e.file||e.retracted||"oob_url"in e);else if("last"===Wu.settings.get("allow_message_corrections")&&t>this.get("time_sent")){var n;this.set({time_sent:t}),null===(n=this.messages.findWhere({editable:!0}))||void 0===n||n.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)}}setChatState(e,t){return void 0!==this.chat_state_timeout&&(clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===oo?this.chat_state_timeout=setTimeout(this.setChatState.bind(this),Ao.TIMEOUTS.PAUSED,ao):e===ao&&(this.chat_state_timeout=setTimeout(this.setChatState.bind(this),Ao.TIMEOUTS.INACTIVE,io)),this.set("chat_state",e,t),this}onMessageAdded(e){!Wu.settings.get("prune_messages_above")||"scrolled"!==Wu.settings.get("pruning_behavior")&&this.ui.get("scrolled")||mg.isEmptyMessage(e)||this.debouncedPruneHistory()}onMessageUploadChanged(e){return dg((function*(){if(e.get("upload")===no){const t={body:e.get("body"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};yield this.sendMessage(t),e.destroy()}})).call(this)}onMessageCorrecting(e){e.get("correcting")?this.save({correcting:e.get("id"),draft:mg.prefixMentions(e)}):this.save({correcting:void 0,draft:void 0})}onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())}pruneHistoryWhenScrolledDown(){Wu.settings.get("prune_messages_above")&&"unscrolled"===Wu.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&this.debouncedPruneHistory()}shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||!e.chat_state)return Promise.resolve(!0)}clearMessages(){return dg((function*(){try{yield this.messages.clearStore()}catch(e){this.messages.trigger("reset"),Q.error(e)}finally{this.messages.fetched.resolve()}})).call(this)}editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const n=this.messages.at(t);if(n.get("editable")){e=n;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),null==e||e.save("correcting",!0)}editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const n=this.messages.at(t);if(n.get("editable")){e=n,e.save("correcting",!0);break}}return e}isChatMessage(e){throw new zl}getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(this.isChatMessage(t))return t}}getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(this.isChatMessage(t))return t}}getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))}findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((({attributes:t})=>t.retracted_id===e.origin_id&&t.from===e.from&&!t.moderated_by))}return null}getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.find((t=>Object.keys(t).every((n=>e.get(n)===t[n]))))))}getOriginIdQueryAttrs(e){return e.origin_id&&{origin_id:e.origin_id,from:e.from}}getStanzaIdQueryAttrs(e){const t=Object.keys(e).filter((e=>e.startsWith("stanza_id ")));return t.map((t=>{const n={};return n[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],n}))}getMessageBodyQueryAttrs(e){if(e.msgid){const t={from:e.from,msgid:e.msgid};return!e.is_encrypted&&e.body&&(t.body=e.body),t}}sendMarkerForMessage(e,t="displayed",n=!1){return dg((function*(){if(!e||"groupchat"===(null==e?void 0:e.get("type"))||!Wu.settings.get("send_chat_markers").includes(t))return;const r=yield Wu.contacts.get(this.get("jid")),i=null==r?void 0:r.get("subscription");if(r&&"none"!==i&&"to"!==i&&((null==e?void 0:e.get("is_markable"))||n)){Jp(fg.getBareJidFromJid(e.get("from")),e.get("msgid"),t,e.get("type"))}})).call(this)}handleUnreadMessage(e){(null==e?void 0:e.get("body"))&&function(e){return e instanceof Element?!(ee()(`result[xmlns="${rg.NS.MAM}"]`,e).length&&ee()(`delay[xmlns="${rg.NS.DELAY}"]`,e).length):(e instanceof ae.Model&&(e=e.attributes),!(e.is_delayed&&e.is_archived))}(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))}getErrorAttributesForMessage(e,t){return dg((function*(){const{__:n}=Ao,r={editable:!1,error:t.error,error_condition:t.error_condition,error_text:t.error_text,error_type:t.error_type,is_error:!0};return t.msgid===e.get("retraction_id")?(r.retraction_id=void 0,t.error||("forbidden"===t.error_condition?r.error=n("You're not allowed to retract your message."):r.error=n("Sorry, an error occurred while trying to retract your message."))):t.error||("forbidden"===t.error_condition?r.error=n("You're not allowed to send a message."):r.error=n("Sorry, an error occurred while trying to send your message.")),yield Wu.hook("getErrorAttributesForMessage",t,r)}))()}handleErrorMessageStanza(e){return dg((function*(){const t=yield eg(e);if(mg.isErrorObject(t)){const{stanza:e,message:n}=t;return e&&Q.error(e),Q.error(n)}const n=t;if(!(yield this.shouldShowErrorMessage(n)))return;const r=this.getMessageReferencedByError(n);if(r){const e=yield this.getErrorAttributesForMessage(r,n);r.save(e)}else this.createMessage(n)})).call(this)}incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)}clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),mg.safeSave(this,{num_unread:0})}handleRetraction(e){return dg((function*(){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;for(const n of this.messages.models)if(n.get("from")===e.from&&(n.get("origin_id")===e.retracted_id||n.get("msgid")===e.retracted_id))return n.save(Fr(e,t)),!0;return e.dangling_retraction=!0,yield this.createMessage(e),!0}{const n=this.findDanglingRetraction(e);if(n){const r=Fr(n.attributes,t),i=Object.assign({dangling_retraction:!1},e,r);return delete i.id,n.save(i),!0}}return!1})).call(this)}handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)!function(e,t){const n=Wp`
        <message from="${Wu.connection.get().jid}"
                id="${Gp.getUniqueId()}"
                to="${e}"
                type="chat"
                xmlns="jabber:client">
            <received xmlns="${Bs.NS.RECEIPTS}" id="${t}"/>
            <store xmlns="${Bs.NS.HINTS}"/>
        </message>`;Wu.send(n)}(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1}createMessageStanza(e){return dg((function*(){const{body:t,edited:n,is_encrypted:r,is_spoiler:i,msgid:s,oob_url:o,origin_id:a,references:c,spoiler_hint:l,type:u}=e.attributes,d=pg`
                <message xmlns="jabber:client"
                        from="${"groupchat"===e.get("type")?Wu.connection.get().jid:e.get("from")}"
                        to="${e.get("to")||this.get("jid")}"
                        type="${this.get("message_type")}"
                        id="${n&&mg.getUniqueId()||s}">
                    ${t?pg`<body>${t}</body>`:""}
                    <active xmlns="${fg.NS.CHATSTATES}"/>
                    ${"chat"===u?pg`<request xmlns="${fg.NS.RECEIPTS}"></request>`:""}
                    ${!r&&o?pg`<x xmlns="${fg.NS.OUTOFBAND}"><url>${o}</url></x>`:""}
                    ${!r&&i?pg`<spoiler xmlns="${fg.NS.SPOILER}">${null!=l?l:""}</spoiler>`:""}
                    ${r?"":null==c?void 0:c.map((e=>pg`<reference xmlns="${fg.NS.REFERENCE}"
                                                begin="${e.begin}"
                                                end="${e.end}"
                                                type="${e.type}"
                                                uri="${e.uri}"></reference>`))}
                    ${n?pg`<replace xmlns="${fg.NS.MESSAGE_CORRECT}" id="${s}"></replace>`:""}
                    ${a?pg`<origin-id xmlns="${fg.NS.SID}" id="${a}"></origin-id>`:""}
                </message>`;return(yield Wu.hook("createMessageStanza",this,{message:e,stanza:d})).stanza})).call(this)}pruneHistory(){const e=Wu.settings.get("prune_messages_above");if(e&&"number"==typeof e&&this.messages.length>e){const t=this.messages.filter((e=>!mg.isEmptyMessage(e)));if(t.length>e){for(;t.length>e;)t.shift().destroy();this.trigger("historyPruned")}}}isScrolledUp(){return this.ui.get("scrolled")}isHidden(){return this.get("hidden")||this.isScrolledUp()||document.hidden}constructor(...e){super(e[0],e[1]),hg(this,"debouncedPruneHistory",Lo((()=>this.pruneHistory()),500,{maxWait:2e3})),this.disable_mam=!1}}}class vg extends ae.Model{defaults(){return{current_category:"smileys",current_skintone:"",scroll_position:0}}}const yg=vg;function bg(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const _g={initialize(){return(e=function*(){if(!Hp.emojis.initialized){Hp.emojis.initialized=!0;const e=yield n.e(2974).then(n.t.bind(n,7641,19)),t=yield Wu.hook("loadEmojis",{},e.default);Hp.emojis.json=t,Hp.emojis.by_sn=Object.keys(t).reduce(((e,n)=>Object.assign(e,t[n])),{}),Hp.emojis.list=Object.values(Hp.emojis.by_sn),Hp.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),Hp.emojis.shortnames=Hp.emojis.list.map((e=>e.sn));const r=()=>Hp.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");Hp.emojis.shortnames_regex=new RegExp(r(),"gi"),Hp.emojis.initialized_promise.resolve()}return Hp.emojis.initialized_promise},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){bg(s,r,i,o,a,"next",e)}function a(e){bg(s,r,i,o,a,"throw",e)}o(void 0)}))})();var e}},wg={emojis:_g},Sg=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Þ|\\:\\-Þ|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Þ|\\:Þ|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),xg=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,{u:Ag}=Hp.env,jg={},$g={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Þ":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Þ":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function Eg(e){if(e.indexOf("-")>-1){const t=[],n=e.split("-");for(let e=0;e<n.length;e++){const r=parseInt(n[e],16);if(r>=65536&&r<=1114111){const e=Math.floor((r-65536)/1024)+55296,n=(r-65536)%1024+56320;t.push(String.fromCharCode(e)+String.fromCharCode(n))}else t.push(String.fromCharCode(r))}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function Og(e){return e.replace(Sg,((e,t,n,r)=>{if(void 0===r||""===r||!(Ag.unescapeHTML(r)in $g))return e;r=Ag.unescapeHTML(r);return n+Eg($g[r].toUpperCase())}))}function Cg(e){if(!Hp.emojis.initialized)throw new Error("getShortnameReferences called before emojis are initialized. To avoid this problem, first await the converse.emojis.initialized_promise");return[...e.matchAll(Hp.emojis.shortnames_regex)].filter((e=>e[0].length>0)).map((e=>{const t=Hp.emojis.by_sn[e[0].toLowerCase()].cp;return{cp:t,begin:e.index,end:e.index+e[0].length,shortname:e[0],emoji:t?Eg(t):null}}))}function kg(e){const t=[];return function(e,t){const n=/\uFE0F/g,r=String.fromCharCode(8205);String(e).replace(xg,((e,i,s)=>{const o=function(e){const t=[];let n=0,r=0;for(;r<e.length;){const i=e.charCodeAt(r++);n?(t.push((65536+(n-55296<<10)+(i-56320)).toString(16)),n=0):55296<=i&&i<=56319?n=i:t.push(i.toString(16))}return t.join("-")}(e.indexOf(r)<0?e.replace(n,""):e);return o&&t(o,e,s),e}))}(e,((e,n,r)=>{var i;t.push({begin:r,cp:e,emoji:n,end:r+n.length,shortname:(null===(i=Ng("cp")[e])||void 0===i?void 0:i.sn)||""})})),t}function Tg(e){const t=e.trim().split(/\s+/);if(0===t.length||t.length>3)return!1;const n=t.filter((e=>{const t=kg(Ag.shortnamesToUnicode(e));return 1===t.length&&(e.toLowerCase()===t[0].shortname||e===t[0].emoji)}));return n.length===t.length}function Ng(e){if(jg[e])return jg[e];if("category"===e)return Hp.emojis.json;const t=Hp.emojis.list.map((t=>t[e])).filter(((e,t,n)=>n.indexOf(e)==t));return jg[e]={},t.forEach((t=>jg[e][t]=Hp.emojis.list.find((n=>n[e]===t)))),jg[e]}function Mg(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Ig(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Mg(s,r,i,o,a,"next",e)}function a(e){Mg(s,r,i,o,a,"throw",e)}o(void 0)}))}}function Pg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Pg(e,t,n[t])}))}return e}function Rg(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}Object.assign(Ag,{getCodePointReferences:kg,getShortnameReferences:Cg,convertASCII2Emoji:Og,getEmojisByAttribute:Ng,isOnlyEmojis:Tg,shortnamesToUnicode:function(e){return function(e){let t=[e];return[...Cg(e),...kg(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const n=t.shift(),r=e.emoji||e.shortname;t=[n.slice(0,e.begin)+r+n.slice(e.end),...t]})),t}(Og(e)).pop()}}),Hp.emojis={initialized:!1,initialized_promise:ue()},Hp.plugins.add("converse-emoji",{initialize(){const{___:e}=Ao;Wu.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}});const t={EmojiPicker:yg};function n(e,t){return Ig((function*(){return yield Wu.emojis.initialize(),Rg(Dg({},t),{is_only_emojis:!!t.body&&Tg(t.body)})}))()}Object.assign(Ao,t),Object.assign(Ao.exports,t),Object.assign(Wu,wg),Wu.listen.on("getOutgoingMessageAttributes",((e,t)=>Ig((function*(){yield Wu.emojis.initialize();const{original_text:e}=t;return Rg(Dg({},t),{is_only_emojis:!!e&&Tg(e)})}))())),Wu.listen.on("parseMUCMessage",n),Wu.listen.on("parseMessage",n)}});const{Strophe:zg}=Hp.env;class Lg extends ae.Model{get idAttribute(){return"jid"}getDisplayName(){return zg.xmlunescape(this.get("name"))}}const Ug=Lg;function Bg(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:Fg,sizzle:qg}=Hp.env;function Hg(e){return(t=function*(){let t,n;const r=Ao.session.get("bare_jid");return(yield Wu.disco.supports(`${Fg.NS.BOOKMARKS2}#compat`,r))?(t=Fg.NS.BOOKMARKS2,n=`items[node="${t}"] item conference`):(t=Fg.NS.BOOKMARKS,n=`items[node="${t}"] item storage[xmlns="${t}"] conference`),qg(n,e).map((e=>{var n,r,i;const s=t===Fg.NS.BOOKMARKS2?e.parentElement.getAttribute("id"):e.getAttribute("jid");var o,a,c;return{jid:s,name:e.getAttribute("name")||s,autojoin:["1","true"].includes(e.getAttribute("autojoin")),nick:null!==(o=null===(n=e.querySelector("nick"))||void 0===n?void 0:n.textContent)&&void 0!==o?o:"",password:null!==(a=null===(r=e.querySelector("password"))||void 0===r?void 0:r.textContent)&&void 0!==a?a:"",extensions:Array.from(null!==(c=null===(i=e.querySelector("extensions"))||void 0===i?void 0:i.children)&&void 0!==c?c:[]).map((e=>e.outerHTML))}}))},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){Bg(s,r,i,o,a,"next",e)}function a(e){Bg(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function Gg(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const Wg=class extends Ym{initialize(){super.initialize(),this.on("change:type",(()=>this.setOccupant())),this.setOccupant(),Wu.trigger("chatRoomMessageInitialized",this)}get occupants(){return"chat"===this.get("type")?this.chatbox.collection:this.chatbox.occupants}getDisplayName(){var e;return(null===(e=this.occupant)||void 0===e?void 0:e.getDisplayName())||this.get("nick")}mayBeModerated(){return(e=function*(){if(void 0!==this.get("from_muc"))return["all","moderator"].includes(Wu.settings.get("allow_message_retraction"))&&this.get(`stanza_id ${this.get("from_muc")}`)&&(yield this.chatbox.canModerateMessages())},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Gg(s,r,i,o,a,"next",e)}function a(e){Gg(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}checkValidity(){const e=super.checkValidity();return!e&&this.chatbox.debouncedRejoin(),e}onOccupantRemoved(){this.stopListening(this.occupant),delete this.occupant,this.listenTo(this.occupants,"add",this.onOccupantAdded)}onOccupantAdded(e){if(this.get("occupant_id")){if(e.get("occupant_id")!==this.get("occupant_id"))return}else if(e.get("nick")!==Bs.getResourceFromJid(this.get("from")))return;this.setOccupant(e)}getOccupant(){return this.occupant||this.setOccupant()}setOccupant(e){if(["groupchat","chat"].includes(this.get("type"))&&!this.isEphemeral()){if(e)this.occupant=e;else if("chat"===this.get("type")&&"them"===this.get("sender"))this.occupant=this.chatbox;else{if(this.occupant)return;const e=Bs.getResourceFromJid(this.get("from")),t=this.get("occupant_id");if(this.occupant=e||t?this.occupants.findOccupant({nick:e,occupant_id:t}):null,!this.occupant){const n=this.get("from_real_jid");if(!e&&!t&&!n)return;if(this.occupant=this.occupants.create({nick:e,occupant_id:t,jid:n}),Wu.settings.get("muc_send_probes")){const t=`${this.chatbox.get("jid")}/${e}`;Wu.user.presence.send({to:t,type:"probe"})}}}return this.get("from_real_jid")!==this.occupant.get("jid")&&this.save("from_real_jid",this.occupant.get("jid")),this.trigger("occupant:add"),this.listenTo(this.occupant,"change",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"vcard:add",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"vcard:change",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved),this.stopListening(this.occupants,"add",this.onOccupantAdded),this.occupant}}};class Vg extends ae.Collection{constructor(e,t={}){super(e,Object.assign({comparator:"time"},t)),this.model=Wg,this.fetched=null}}const Kg=Vg;function Jg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Jg(e,t,n[t])}))}return e}function Xg(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Qg={},Zg=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);Qg.escapeCharacters=e=>t=>e.split("").reduce(Zg,t),Qg.escapeRegexString=Qg.escapeCharacters("[\\^$.?*+(){}|"),Qg.findFirstMatchInArray=e=>t=>{for(let n=0;n<e.length;n++)if(0===t.localeCompare(e[n],void 0,{sensitivity:"base"}))return e[n];return null};const ev=([e,t],n,r)=>{let i=e,{begin:s,end:o}=n;const{value:a}=n;return s-=r,o=o-r-1,i=`${i.slice(0,s)}${a}${i.slice(o+1)}`,[i,[...t,Xg(Yg({},n),{begin:s,end:o})]]};Qg.reduceTextFromReferences=(e,t)=>t.reduce(ev,[e,[]]);const tv=Qg,nv=["301","333","307","321","322"],rv=["210","303"],iv=["admin","ban","deop","destroy","member","op","revoke"],sv=["owner","admin","member","outcast","none"],ov=["301","333","307","321","322","332"],av=["kick","mute","voice","modtools"],cv=["owner"],lv=["moderator","participant","visitor"],uv=["nick"],dv={100:["message","presence"],101:["message"],102:["message"],103:["message"],104:["message"],110:["presence"],170:["message","presence"],171:["message"],172:["message"],173:["message"],174:["message"],201:["presence"],210:["presence"],301:["presence"],303:["presence"],307:["presence"],321:["presence"],322:["presence"],332:["presence"],333:["presence"]},hv={moderator:1,participant:2,visitor:3,none:2},fv={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},pv=Object.values(fv),mv={ENTERED:"entered",EXITED:"exited"},gv=Object.values(mv),vv={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},yv=Object.values(vv),bv={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...pv],join_leave_events:[...gv],role_changes:[...yv]},_v={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7,CLOSING:8},wv=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled","vcard-temp"],Sv="303";function xv(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Av(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){xv(s,r,i,o,a,"next",e)}function a(e){xv(s,r,i,o,a,"throw",e)}o(void 0)}))}}function jv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){jv(e,t,n[t])}))}return e}function Ev(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{Strophe:Ov,sizzle:Cv,u:kv}=Hp.env,{NS:Tv}=Ov;function Nv(e){const t=Cv(`items[node="${Ov.NS.CONFINFO}"]`,e).pop();if(!t)return null;const n=e.getAttribute("from"),r=e.getAttribute("id"),i=`item conference-info[xmlns="${Ov.NS.CONFINFO}"] activity[xmlns="${Ov.NS.ACTIVITY}"]`;return Cv(i,t).map((t=>{var i;const s=null===(i=t.querySelector("text"))||void 0===i?void 0:i.textContent;if(s){var o;const i=dm(e),a=null===(o=t.querySelector("reason"))||void 0===o?void 0:o.textContent;return{from:n,msgid:r,message:s,reason:a,references:i,type:"mep"}}return{}}))}function Mv(e){const t=Cv(`> retract[xmlns="${Ov.NS.RETRACT}"]`,e).pop();if(t){const e=Cv(`moderated[xmlns="${Ov.NS.MODERATE}"]`,t).pop();var n,r;if(e)return{editable:!1,moderated:"retracted",moderated_by:e.getAttribute("by"),moderated_by_id:null===(n=e.querySelector("occupant-id"))||void 0===n?void 0:n.getAttribute("id"),moderated_id:t.getAttribute("id"),moderation_reason:null===(r=t.querySelector("reason"))||void 0===r?void 0:r.textContent}}else{const t=Cv(`retracted[xmlns="${Ov.NS.RETRACT}"]`,e).pop();var i,s;if(t)return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),moderated_by_id:null===(i=t.querySelector("occupant-id"))||void 0===i?void 0:i.getAttribute("id"),retracted:t.getAttribute("stamp"),moderation_reason:null===(s=t.querySelector("reason"))||void 0===s?void 0:s.textContent}}return function(e){const t=Cv(`apply-to[xmlns="${Ov.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),r=Cv(`moderated[xmlns="${Ov.NS.MODERATE0}"]`,t).pop();var n;if(r)if(Cv(`retract[xmlns="${Ov.NS.RETRACT0}"]`,r).pop())return{editable:!1,moderated:"retracted",moderated_by:r.getAttribute("by"),moderated_id:e,moderation_reason:null===(n=r.querySelector("reason"))||void 0===n?void 0:n.textContent}}else{const t=Cv(`> moderated[xmlns="${Ov.NS.MODERATE0}"]`,e).pop();var r;if(t)if(Cv(`retracted[xmlns="${Ov.NS.RETRACT0}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:null===(r=t.querySelector("reason"))||void 0===r?void 0:r.textContent}}return{}}(e)}function Iv(e,t){const n=Cv(`${t} > x[xmlns="${Ov.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code"))).filter((e=>{var n;return null===(n=dv[e])||void 0===n?void 0:n.includes(t)}));return"presence"===t&&n.includes("333")&&n.includes("307")&&n.splice(n.indexOf("307"),1),{codes:n,is_self:n.includes("110")}}function Pv(e,t){var n;if(t.features.get(Ov.NS.OCCUPANTID))return null===(n=Cv(`occupant-id[xmlns="${Ov.NS.OCCUPANTID}"]`,e).pop())||void 0===n?void 0:n.getAttribute("id")}function Dv(e,t){let n;const r=t.get("occupant_id");if(r)n=e.occupant_id===r;else if(e.from_real_jid){const t=Ao.session.get("bare_jid");n=Ov.getBareJidFromJid(e.from_real_jid)===t}else n=e.nick===t.get("nick");return n?"me":"them"}function Rv(e,t){return Av((function*(){var n,r,i;gm(e);const s=Cv(`result[xmlns="${Tv.MAM}"] > forwarded[xmlns="${Tv.FORWARD}"] > message`,e).pop(),o=s||e;if(Cv(`message > forwarded[xmlns="${Ov.NS.FORWARD}"]`,o).length)return new Bl(o,`Invalid Stanza: Forged MAM groupchat message from ${o.getAttribute("from")}`);let a,c;if(s){var l,u;if(Cv(`message > forwarded[xmlns="${Ov.NS.FORWARD}"]`,s).length)return new Bl(e,`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`);a=Cv(`delay[xmlns="${Ov.NS.DELAY}"]`,s.parentElement).pop(),c=null===(u=s.querySelector(":scope > body"))||void 0===u||null===(l=u.textContent)||void 0===l?void 0:l.trim()}else{var d,h;a=Cv(`message > delay[xmlns="${Ov.NS.DELAY}"]`,e).pop(),c=null===(h=e.querySelector(":scope > body"))||void 0===h||null===(d=h.textContent)||void 0===d?void 0:d.trim()}const f=o.getAttribute("from"),p=vm(o);let m=Object.assign({from:f,body:c,activities:Nv(o),chat_state:pm(o),from_muc:Ov.getBareJidFromJid(f),is_archived:_m(e),is_carbon:fm(e),is_delayed:!!a,is_forwarded:!!Cv(`message > forwarded[xmlns="${Ov.NS.FORWARD}"]`,o).length,is_headline:ym(o),is_markable:!!Cv(`message > markable[xmlns="${Ov.NS.MARKERS}"]`,o).length,is_marker:!!p,is_unstyled:!!Cv(`message > unstyled[xmlns="${Ov.NS.STYLING}"]`,o).length,marker_id:p&&p.getAttribute("id"),nick:Ov.unescapeNode(Ov.getResourceFromJid(f)),occupant_id:Pv(o,t),receipt_id:hm(o),received:(new Date).toISOString(),references:dm(o),subject:null===(n=o.querySelector(":scope > subject"))||void 0===n?void 0:n.textContent,thread:null===(r=o.querySelector(":scope > thread"))||void 0===r?void 0:r.textContent,time:a?W()(a.getAttribute("stamp")).toISOString():(new Date).toISOString(),to:o.getAttribute("to"),type:o.getAttribute("type")},um(o),lm(o),cm(o),am(o,e),im(o,e),function(e){const t=ee()(`> apply-to[xmlns="${Bs.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),r=ee()(`> meta[xmlns="${Bs.NS.XHTML}"]`,t);if(r.length){var n;const t=Wu.settings.get("message_limit"),i=r.reduce(((e,n)=>{const r=n.getAttribute("property");if(r){let i=ih(n.getAttribute("content")||"");t&&"og:description"===r&&i.length>=t&&(i=`${i.slice(0,t)}${ih("&#8230;")}`),e[r]=i}return e}),{ogp_for_id:e}),s=i["og:url"];if((null==s?void 0:s.startsWith("/"))&&"github"===(null===(n=i["og:site_name"])||void 0===n?void 0:n.toLowerCase())&&(i["og:url"]=`https://github.com${s}`),"og:description"in i||"og:title"in i||"og:image"in i)return i}}return{}}(o),om(o,e),Mv(o),sm(o),Iv(o,"message"));if(m.from_real_jid=m.is_archived&&function(e){const t=Cv(`message > x[xmlns="${Ov.NS.MUC_USER}"] item`,e).pop();return null==t?void 0:t.getAttribute("jid")}(o)||(null===(i=t.occupants.findOccupant(m))||void 0===i?void 0:i.get("jid")),m=Object.assign({is_valid_receipt_request:mm(o,m),message:m.body||m.error,sender:Dv(m,t)},m),m.is_archived&&e.getAttribute("from")!==m.from_muc)return new Bl(e,`Invalid Stanza: Forged MAM message from ${e.getAttribute("from")}`);if(m.is_archived&&e.getAttribute("from")!==t.get("jid"))return new Bl(e,`Invalid Stanza: Forged MAM groupchat message from ${o.getAttribute("from")}`);if(m.is_carbon)return new Bl(e,"Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied");m.id=m.origin_id||m[`stanza_id ${m.from_muc||m.from}`]||kv.getUniqueId(),m=yield Wu.hook("parseMUCMessage",e,m);const g=yield kv.getMediaURLsMetadata(m.is_encrypted?m.plaintext:m.body);return Object.assign(m,g)}))()}function zv(e,t){return Av((function*(){var n,r,i;yield t.initialized;const s=e.getAttribute("from"),o=e.getAttribute("type"),a=Ov.getResourceFromJid(s);var c,l;const u=$v({from:s,nick:a,type:o,muc_jid:Ov.getBareJidFromJid(s),occupant_id:Pv(e,t),status:null!==(c=null===(n=e.querySelector(":scope > status"))||void 0===n?void 0:n.textContent)&&void 0!==c?c:void 0,show:null!==(l=null===(r=e.querySelector(":scope > show"))||void 0===r?void 0:r.textContent)&&void 0!==l?l:void 0,image_hash:null===(i=Cv(`presence > x[xmlns="${Ov.NS.VCARDUPDATE}"] photo`,e).pop())||void 0===i?void 0:i.textContent,hats:Cv(`presence > hats[xmlns="${Ov.NS.MUC_HATS}"] hat`,e).map((e=>({title:e.getAttribute("title"),uri:e.getAttribute("uri")})))},Iv(e,"presence"),function(e,t){const n=Cv(`presence > x[xmlns="${Ov.NS.MUC_USER}"] item`,e).pop();if(n){var r;const e=n.querySelector("actor");var i,s,o;return Ev($v({affiliation:n.getAttribute("affiliation"),role:n.getAttribute("role"),jid:n.getAttribute("jid"),nick:n.getAttribute("nick")||t},e?{actor:{nick:null!==(i=null==e?void 0:e.getAttribute("nick"))&&void 0!==i?i:null,jid:null!==(s=null==e?void 0:e.getAttribute("jid"))&&void 0!==s?s:null}}:{}),{reason:null!==(o=null===(r=n.querySelector("reason"))||void 0===r?void 0:r.textContent)&&void 0!==o?o:null})}}(e,a));return yield Wu.hook("parseMUCPresence",e,u)}))()}function Lv(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Uv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Bv(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{Strophe:Fv,$iq:qv,u:Hv,stx:Gv}=Hp.env;function Wv(e,t){return(n=function*(){const n=Gv`
        <iq xmlns="jabber:client" to="${t}" type="get">
            <query xmlns="${Fv.NS.MUC_ADMIN}">
                <item affiliation="${e}"/>
            </query>
        </iq>`,r=yield Wu.sendIQ(n,null,!1);if(null===r){const n=`Error: timeout while fetching ${e} list for MUC ${t}`,r=new Error(n);return Q.warn(n),r}if(Hv.isErrorStanza(r)){const n=`Error: not allowed to fetch ${e} list for MUC ${t}`,i=new Error(n);return Q.warn(n),Q.warn(r),i}return function(e){return Cv(`query[xmlns="${Ov.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},n=e.getAttribute("jid");kv.isValidJID(n)?t.jid=n:t.nick=n;const r=e.getAttribute("nick");return r&&(t.nick=r),e.getAttribute("role")&&(t.role=r),t}))}(r).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))},function(){var e=this,t=arguments;return new Promise((function(r,i){var s=n.apply(e,t);function o(e){Lv(s,r,i,o,a,"next",e)}function a(e){Lv(s,r,i,o,a,"throw",e)}o(void 0)}))})();var n}function Vv(e,t){const n=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(n.map((n=>Kv(n,e,t))))}function Kv(e,t,n){return Array.isArray(t)||(t=[t]),n=n.filter((t=>[void 0,e].includes(t.affiliation))),Promise.all(t.reduce(((t,r)=>[...t,...n.map((t=>function(e,t,n){e=n.affiliation||e;const r=qv({to:t,type:"set"}).c("query",{xmlns:Fv.NS.MUC_ADMIN}).c("item",Bv(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Uv(e,t,n[t])}))}return e}({affiliation:e},"outcast"===e?{}:{nick:n.nick}),{jid:n.jid}));void 0!==n.reason&&r.c("reason",n.reason);return Wu.sendIQ(r)}(e,r,t)))]),[]))}function Jv(e,t,n,r){const i=n.map((e=>e.jid)),s=r.map((e=>e.jid));let o=i.filter((e=>!s.includes(e))).map((e=>n[i.indexOf(e)]));return e||(o=o.concat(n.filter((e=>{const t=s.indexOf(e.jid);return t>=0&&e.affiliation!==r[t].affiliation})))),t&&(o=o.concat(s.filter((e=>!i.includes(e))).map((e=>({jid:e,affiliation:"none"}))))),o}function Yv(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Xv(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Yv(s,r,i,o,a,"next",e)}function a(e){Yv(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{u:Qv}=Hp.env;class Zv extends(gg(ae.Model)){initialize(){var e=this,t=()=>super.initialize;return Xv((function*(){yield t().call(e);const n=this.get("jid");n&&this.set({box_id:`box-${n}`})})).call(this)}validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=Wu.settings.get("auto_join_rooms").map((e=>e instanceof Object?e.jid:e)),n=Wu.settings.get("auto_join_private_chats").concat(t);if(Wu.settings.get("singleton")&&!n.includes(e.jid)&&!Wu.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return Q.warn(t),t}}maybeShow(e){if(ni()){const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),n=Ao.state.chatboxes.filter(t);return(e||0===n.length)&&(n.forEach((e=>Qv.safeSave(e,{hidden:!0}))),Qv.safeSave(this,{hidden:!1}),this.trigger("show")),this}return Qv.safeSave(this,{hidden:!1,closed:!1}),this.trigger("show"),this}shouldDestroyOnClose(){return Xv((function*(){return yield Wu.hook("shouldDestroyOnClose",this,!0)})).call(this)}close(e){return Xv((function*(){if(yield this.shouldDestroyOnClose())try{yield new Promise(((e,t)=>this.destroy({success:e,error:(e,n)=>t(n)})))}catch(e){Q.debug(e)}else Qv.safeSave(this,{closed:!0});Wu.settings.get("clear_messages_on_reconnection")&&(yield this.clearMessages()),Wu.trigger("chatBoxClosed",this)})).call(this)}announceReconnection(){Wu.trigger("chatReconnected",this)}onReconnection(){return Xv((function*(){Wu.settings.get("clear_messages_on_reconnection")&&(yield this.clearMessages()),this.announceReconnection()})).call(this)}}function ey(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function ty(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){ey(s,r,i,o,a,"next",e)}function a(e){ey(s,r,i,o,a,"throw",e)}o(void 0)}))}}function ny(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Strophe:ry,sizzle:iy,u:sy}=Hp.env;function oy(e){return e.nick&&(sy.shouldCreateMessage(e)||e.is_tombstone)}function ay(e,t){const n=e.get("role")||"none",r=t.get("role")||"none";if(hv[n]===hv[r]){const n=e.getDisplayName().toLowerCase(),r=t.getDisplayName().toLowerCase();return n<r?-1:n>r?1:0}return hv[n]<hv[r]?-1:1}function cy(){Wu.connection.get().addHandler((e=>(Ao.exports.onDirectMUCInvitation(e),!0)),"jabber:x:conference","message")}function ly(){return Ao.state.chatboxes.filter((e=>e.get("type")===uo)).forEach((e=>e.session.save({connection_status:Hp.ROOMSTATUS.DISCONNECTED})))}function uy(){return ty((function*(){if(!document.hidden&&Wu.connection.connected()){(yield Wu.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}}))()}function dy(e){return ty((function*(){if(!location.hash.startsWith("#converse/room?jid="))return;null==e||e.preventDefault();const t=location.hash.split("=").pop();if(!sy.isValidMUCJID(t))return Q.warn(`invalid jid "${t}" provided in url fragment`);yield Wu.waitUntil("roomsAutoJoined"),Wu.settings.get("allow_bookmarks")&&(yield Wu.waitUntil("bookmarksInitialized")),Wu.rooms.open(t,{},!0)}))()}function hy(e){return ty((function*(){const t=iy('x[xmlns="jabber:x:conference"]',e).pop(),n=ry.getBareJidFromJid(e.getAttribute("from")),r=t.getAttribute("jid"),i=t.getAttribute("reason");let s;if(Wu.settings.get("auto_join_on_invite"))s=!0;else{var o,a;const e=null!==(a=null===(o=Ao.state.roster.get(n))||void 0===o?void 0:o.getDisplayName())&&void 0!==a?a:n;s=yield Wu.hook("confirmDirectMUCInvitation",{contact:e,reason:i,jid:r},!1)}if(s){const e=yield function(e,t){return ty((function*(){t.type=uo,t.id=e;const n=yield Wu.rooms.get(e,t,!0);return n.maybeShow(!0),n}))()}(r,{password:t.getAttribute("password")});e.session.get("connection_status")===Hp.ROOMSTATUS.DISCONNECTED&&Ao.state.chatboxes.get(r).rejoin()}}))()}function fy(){const{profile:e}=Ao.state;if(!e)return Q.error("Called getDefaultMUCNickname before statusInitialized has been fired."),"";const t=e.getNickname();if(t)return t;if(Wu.settings.get("muc_nickname_from_jid")){const e=Ao.session.get("bare_jid");return ry.unescapeNode(ry.getNodeFromJid(e))}}function py(e){return!!Wu.settings.get("muc_show_info_messages").includes(e)}function my(){return ty((function*(){yield Promise.all(Wu.settings.get("auto_join_rooms").map((e=>"string"==typeof e?Ao.state.chatboxes.where({jid:e}).length?Promise.resolve():Wu.rooms.open(e):e instanceof Object?Wu.rooms.open(e.jid,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ny(e,t,n[t])}))}return e}({},e)):(Q.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),Wu.trigger("roomsAutoJoined")}))()}function gy(){Wu.disco.own.features.add(ry.NS.MUC),Wu.settings.get("allow_muc_invitations")&&Wu.disco.own.features.add("jabber:x:conference")}function vy(){Ao.state.chatboxes.where({type:uo}).forEach((e=>jl(e.session,{connection_status:Hp.ROOMSTATUS.DISCONNECTED})))}function yy(){window.addEventListener(ii(),(()=>{!Wu.connection.isType("websocket")||Wu.settings.get("enable_smacks")&&Ao.session.get("smacks_stream_id")||ly()}))}function by(){Wu.connection.get().addHandler((e=>{const t=ry.getBareJidFromJid(e.getAttribute("from"));return Ao.state.chatboxes.get(t)||Wu.waitUntil("chatBoxesFetched").then((()=>ty((function*(){const n=Ao.state.chatboxes.get(t);n&&(yield n.initialized,n.message_handler.run(e))}))())),!0}),null,"message","groupchat")}class _y extends ae.Model{defaults(){return{connection_status:_v.DISCONNECTED}}}const wy=_y;function Sy(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function xy(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Sy(s,r,i,o,a,"next",e)}function a(e){Sy(s,r,i,o,a,"throw",e)}o(void 0)}))}}function Ay(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ay(e,t,n[t])}))}return e}function $y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{u:Ey,stx:Oy}=Hp.env;class Cy extends(Wm(gg(Om(Zv)))){defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:ni()&&!Wu.settings.get("singleton"),hidden_occupants:!!Wu.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:uo}}initialize(){var e=this,t=()=>super.initialize;return xy((function*(){t().call(e),this.initialized=ue(),this.debouncedRejoin=Lo(this.rejoin,250),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),yield this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:presence",this.onOccupantPresenceChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage);(yield this.restoreFromCache())||(yield this.join()),yield Wu.trigger("chatRoomInitialized",this,{synchronous:!0}),this.initialized.resolve()})).call(this)}isEntered(){var e;return(null===(e=this.session)||void 0===e?void 0:e.get("connection_status"))===_v.ENTERED}isRAICandidate(){return this.get("hidden")&&Wu.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()}restoreFromCache(){return xy((function*(){if(this.isEntered()){if(yield this.fetchOccupants().catch((e=>Q.error(e))),this.isRAICandidate())return this.session.save("connection_status",_v.DISCONNECTED),this.enableRAI(),!0;if(yield this.isJoined())return yield new Promise((e=>this.config.fetch({success:e,error:e}))),yield new Promise((e=>this.features.fetch({success:e,error:e}))),yield this.fetchMessages().catch((e=>Q.error(e))),!0}return this.session.save("connection_status",_v.DISCONNECTED),this.clearOccupantsCache(),!1})).call(this)}join(e,t){return xy((function*(){if(this.isEntered())return;this.session.save("connection_status",_v.CONNECTING);const n=(yield this.refreshDiscoInfo())instanceof Kl;if(!(e=yield this.getAndPersistNickname(e)))return jl(this.session,{connection_status:_v.NICKNAME_REQUIRED}),void(!n&&Wu.settings.get("muc_show_logs_before_join")&&(yield this.fetchMessages()));Wu.send(yield this.constructJoinPresence(t,n)),n&&(yield this.refreshDiscoInfo())})).call(this)}rejoin(){return this.session.save("connection_status",_v.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()}constructJoinPresence(e,t){return xy((function*(){const n=t||this.features.get("mam_enabled")?0:Wu.settings.get("muc_history_max_stanzas");e=e||this.get("password");const{profile:r}=Ao.state,i=r.get("show"),s=r.get("status_message"),o=Oy`
            <presence xmlns="jabber:client"
                      id="${Lp()}"
                      from="${Wu.connection.get().jid}"
                      to="${this.getRoomJIDAndNick()}">
                <x xmlns="${Bs.NS.MUC}">
                    <history maxstanzas="${n}"/>
                    ${e?Oy`<password>${e}</password>`:""}
                </x>
                ${Gs.includes(i)?Oy`<show>${i}</show>`:""}
                ${s?Oy`<status>${s}</status>`:""}
            </presence>`;return yield Wu.hook("constructedMUCPresence",this,o)})).call(this)}clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()}sendMarkerForMessage(e,t="displayed",n=!1){if(e&&Wu.settings.get("send_chat_markers").includes(t)&&"groupchat"===(null==e?void 0:e.get("type"))){if((null==e?void 0:e.get("is_markable"))||n){const n=`stanza_id ${this.get("jid")}`,r=e.get(n);if(!r)return Q.error(`Can't send marker for message without stanza ID: ${n}`),Promise.resolve();Jp(Bs.getBareJidFromJid(e.get("from")),r,t,e.get("type"))}return Promise.resolve()}}sendMarkerForLastMessage(e="displayed",t=!1){const n=Array.from(this.messages.models);n.reverse();const r=n.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));r&&this.sendMarkerForMessage(r,e,t)}enableRAI(){if(Wu.settings.get("muc_subscribe_to_rai")){const e=Bs.getDomainFromJid(this.get("jid"));Wu.user.presence.send({to:e},rs("rai",{xmlns:Bs.NS.RAI}))}}onHiddenChange(){return xy((function*(){const e=_v,t=this.session.get("connection_status");this.get("hidden")?t===e.ENTERED&&(this.setChatState(io),this.isRAICandidate()&&(this.sendMarkerForLastMessage("received",!0),yield this.leave(),this.enableRAI())):(yield this.initialized,t===e.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())})).call(this)}onOccupantAdded(e){py(Hp.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===_v.ENTERED&&"online"===e.get("presence")&&this.updateNotifications(e.get("nick"),Hp.MUC_TRAFFIC_STATES.ENTERED)}onOccupantRemoved(e){py(Hp.MUC_TRAFFIC_STATES.EXITED)&&this.isEntered()&&"online"===e.get("presence")&&this.updateNotifications(e.get("nick"),Hp.MUC_TRAFFIC_STATES.EXITED)}onOccupantPresenceChanged(e){e.get("states").includes("303")||("offline"===e.get("presence")&&py(Hp.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),Hp.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("presence")&&py(Hp.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),Hp.MUC_TRAFFIC_STATES.ENTERED))}onRoomEntered(){return xy((function*(){yield this.occupants.fetchMembers(),Wu.settings.get("clear_messages_on_reconnection")?yield this.clearMessages():yield this.fetchMessages(),Wu.trigger("enteredNewRoom",this),Wu.settings.get("auto_register_muc_nickname")&&(yield Wu.disco.supports(Bs.NS.MUC_REGISTER,this.get("jid")))&&this.registerNickname()})).call(this)}onConnectionStatusChanged(){return xy((function*(){if(this.isEntered())if(this.isRAICandidate()){try{yield this.leave()}catch(e){Q.error(e)}this.enableRAI()}else yield this.onRoomEntered()})).call(this)}onReconnection(){return xy((function*(){yield this.rejoin(),this.announceReconnection()})).call(this)}getMessagesCollection(){return new Ao.exports.MUCMessages}restoreSession(){const e=`muc.session-${Ao.session.get("bare_jid")}-${this.get("jid")}`;return this.session=new wy({id:e}),nl(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))}initDiscoModels(){const e=Ao.session.get("bare_jid");let t=`converse.muc-features-${e}-${this.get("jid")}`;this.features=new ae.Model(Object.assign({id:t},Hp.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{}))),this.features.browserStorage=tl(t,"session"),this.features.listenTo(Ao,"beforeLogout",(()=>this.features.browserStorage.flush())),t=`converse.muc-config-${e}-${this.get("jid")}`,this.config=new ae.Model({id:t}),this.config.browserStorage=tl(t,"session"),this.config.listenTo(Ao,"beforeLogout",(()=>this.config.browserStorage.flush()))}initOccupants(){this.occupants=new Ao.exports.MUCOccupants;const e=`converse.occupants-${Ao.session.get("bare_jid")}${this.get("jid")}`;this.occupants.browserStorage=tl(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(Ao,"beforeLogout",(()=>this.occupants.browserStorage.flush()))}fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched}handleAffiliationChangedMessage(e){if(e.querySelector("body"))return;const t=ee()(`x[xmlns="${Bs.NS.MUC_USER}"] item`,e).pop();if(t){const n=e.getAttribute("from"),r=t.getAttribute("jid"),i={from:n,states:[],jid:Bs.getBareJidFromJid(r),resource:Bs.getResourceFromJid(r)},s=t.getAttribute("affiliation");s&&(i.affiliation=s);const o=t.getAttribute("role");o&&(i.role=o);const a=this.occupants.findOccupant({jid:i.jid});a?a.save(i):this.occupants.create(i)}}handleErrorMessageStanza(e){return xy((function*(){const{__:t}=Ao,n=yield Rv(e,this);if(Ey.isErrorObject(n)){const{stanza:e,message:t}=n;return e&&Q.error(e),Q.error(t)}const r=n;if(!(yield this.shouldShowErrorMessage(r)))return;const i=Bs.getResourceFromJid(r.from),s=i?this.getOccupant(i):null,o=s||this,a=o.getMessageReferencedByError(r);if(a){const e={error:r.error,error_condition:r.error_condition,error_text:r.error_text,error_type:r.error_type,editable:!1};r.msgid===a.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,r.error||("forbidden"===r.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===r.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):r.error||("forbidden"===r.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===r.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),a.save(e)}else o.createMessage(r)})).call(this)}handleMessageFromMUCHost(e){if(this.isEntered())return;const t=ee()(`rai[xmlns="${Bs.NS.RAI}"]`,e).pop(),n=Array.from((null==t?void 0:t.querySelectorAll("activity"))||[]).map((e=>e.textContent));n.includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})}handleForwardedMentions(e){if(this.isEntered())return;const t=ee()(`mentions[xmlns="${Bs.NS.MENTIONS}"] forwarded[xmlns="${Bs.NS.FORWARD}"] message[type="groupchat"]`,e),n=this.get("jid"),r=t.filter((e=>Bs.getBareJidFromJid(e.getAttribute("from"))===n));r.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+r.length}),r.forEach((e=>xy((function*(){const t=yield Rv(e,this),n={stanza:e,attrs:t,chatbox:this};Wu.trigger("message",n)})).call(this))))}handleMessageStanza(e){return xy((function*(){var t,n;const r=(e=null!==(n=null===(t=e.tree)||void 0===t?void 0:t.call(e))&&void 0!==n?n:e).getAttribute("type");if("error"===r)return this.handleErrorMessageStanza(e);if("groupchat"===r){if(_m(e))return Q.warn('Received a MAM message with type "groupchat"')}else if(!r)return this.handleForwardedMentions(e);let i;try{i=yield Rv(e,this)}catch(e){return Q.error(e)}if(Ey.isErrorObject(i)){const{stanza:e,message:t}=i;return e&&Q.error(e),Q.error(t)}const s=i;"groupchat"===s.type&&(s.codes.forEach((e=>this.createInfoMessage(e))),this.fetchFeaturesIfConfigurationChanged(s));const o={stanza:e,attrs:s,chatbox:this};return Wu.trigger("message",o),s&&this.queueMessage(s)})).call(this)}registerHandlers(){const e=this.get("jid"),t=Bs.getDomainFromJid(e);this.removeHandlers();const n=Wu.connection.get();this.presence_handler=n.addHandler((e=>(this.onPresence(e),!0)),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=n.addHandler((e=>(this.onPresenceFromMUCHost(e),!0)),null,"presence",null,null,t),this.message_handler=n.addHandler((e=>(this.handleMessageStanza(e),!0)),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=n.addHandler((e=>(this.handleMessageFromMUCHost(e),!0)),null,"message",null,null,t),this.affiliation_message_handler=n.addHandler((e=>(this.handleAffiliationChangedMessage(e),!0)),Bs.NS.MUC_USER,"message",null,null,e)}removeHandlers(){const e=Wu.connection.get();return this.message_handler&&(null==e||e.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(null==e||e.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(null==e||e.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(null==e||e.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(null==e||e.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this}invitesAllowed(){return Wu.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())}getDisplayName(){const e=this.get("name");return e?e.trim():"hidden"===Wu.settings.get("locked_muc_domain")?Bs.getNodeFromJid(this.get("jid")):this.get("jid")}sendTimedMessage(e){const t=e instanceof Element?e:e.tree();let n=t.getAttribute("id");n||(n=Lp("sendIQ"),t.setAttribute("id",n));const r=ue(),i=Wu.settings.get("stanza_timeout"),s=Wu.connection.get(),o=s.addTimedHandler(i,(()=>{s.deleteHandler(a);const e=new Ll("Timeout Error: No response from server");return r.resolve(e),!1})),a=s.addHandler((e=>{o&&s.deleteTimedHandler(o),r.resolve(e)}),null,"message",["error","groupchat"],n);return Wu.send(t),r}retractOwnMessage(e){return xy((function*(){const t=Ao.__,n=e.get("editable"),r=Lp(),i=e.get("id"),s=Oy`
            <message id="${r}"
                     to="${this.get("jid")}"
                     type="groupchat"
                     xmlns="jabber:client">
                <retract id="${i}" xmlns="${Bs.NS.RETRACT}"/>
                <body>/me retracted a message</body>
                <store xmlns="${Bs.NS.HINTS}"/>
                <fallback xmlns="${Bs.NS.FALLBACK}" for="${Bs.NS.RETRACT}" />
            </message>`;e.set({retracted:(new Date).toISOString(),retracted_id:i,retraction_id:r,editable:!1});const o=yield this.sendTimedMessage(s);Ey.isErrorStanza(o)?Q.error(o):o instanceof Ll&&(Q.error(o),e.save({editable:n,error_type:"timeout",error:t("A timeout happened while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))})).call(this)}retractOtherMessage(e,t){return xy((function*(){const n=e.get("editable"),r=Ao.session.get("bare_jid");e.save({moderated:"retracted",moderated_by:r,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const i=yield this.sendRetractionIQ(e,t);return(null===i||Ey.isErrorStanza(i))&&e.save({editable:n,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),i})).call(this)}sendRetractionIQ(e,t){const n=Oy`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <moderate id="${e.get(`stanza_id ${this.get("jid")}`)}" xmlns="${Bs.NS.MODERATE}">
                    <retract xmlns="${Bs.NS.RETRACT}"/>
                    ${t?Oy`<reason>${t}</reason>`:""}
                </moderate>
            </iq>`;return Wu.sendIQ(n,null,!1)}sendDestroyIQ(e,t){const n=Oy`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Bs.NS.MUC_OWNER}">
                    <destroy ${t?Ls.unsafeXML(`jid="${Bs.xmlescape(t)}"`):""}>
                        ${e?Oy`<reason>${e}</reason>`:""}
                    </destroy>
                </query>
            </iq>`;return Wu.sendIQ(n)}leave(e){return xy((function*(){var t;Wu.user.presence.send({type:"unavailable",to:this.getRoomJIDAndNick(),status:e}),jl(this.session,{connection_status:_v.DISCONNECTED}),this.features&&(yield new Promise((e=>this.features.destroy({success:e,error:(t,n)=>{Q.error(n),e()}}))));const n=null===(t=Ao.state.disco_entities)||void 0===t?void 0:t.get(this.get("jid"));n&&(yield new Promise((e=>n.destroy({success:e,error:(t,n)=>{Q.error(n),e()}}))))})).call(this)}close(e){var t=this,n=()=>super.close;return xy((function*(){const{ENTERED:r,CLOSING:i}=_v,s=this.session.get("connection_status")===r;jl(this.session,{connection_status:i}),s&&this.sendMarkerForLastMessage("received",!0),yield this.leave(),this.occupants.clearStore();return"closeAllChatBoxes"!==(null==e?void 0:e.name)&&(yield this.unregisterNickname(),Wu.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),Wu.trigger("leaveRoom",this)),yield new Promise((e=>this.session.destroy({success:e,error:(t,n)=>{Q.error(n),e()}}))),n().call(t)})).call(this)}canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&Wu.disco.supports(Bs.NS.MODERATE,this.get("jid"))}canPostMessages(){return this.isEntered()&&!(this.features.get("moderated")&&"visitor"===this.getOwnRole())}isChatMessage(e){return e.get("type")===this.get("message_type")}getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))}getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>tv.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")}getOccupantByJID(e){return this.occupants.findOccupant({jid:e})}getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})}getReferenceURIFromNickname(e){const t=this.get("jid"),n=this.getOccupant(e),r=this.features.get("nonanonymous")&&(null==n?void 0:n.get("jid"))||`${t}/${e}`;return encodeURI(`xmpp:${r}`)}parseTextForReferences(e){const t=RegExp("(\\p{P}|\\p{Z}|^)([@][\\w_-]+(?:\\.\\w+)*)","giu");if(!e||!t.test(e))return[e,[]];const n=tv.findFirstMatchInArray(this.getAllKnownNicknames()),r=this.getAllKnownNicknamesRegex(),i=[...e.matchAll(r)].filter((e=>!e[0].startsWith("/"))),s=i.map((e=>{let t=e[0].indexOf("@");"@"===e[0][t+1]&&(t+=1);const r=e.index+t,i=r+e[0].length-t,s=n(e[1]);return{begin:r,end:i,value:s,type:"mention",uri:this.getReferenceURIFromNickname(s)}})),[o,a]=tv.reduceTextFromReferences(e,s);return[o,a]}getOutgoingMessageAttributes(e){return xy((function*(){const t=this.get("composing_spoiler");let n,r="";(null==e?void 0:e.body)&&([r,n]=this.parseTextForReferences(e.body));const i=Lp(),s=r?Ey.shortnamesToUnicode(r):void 0;return e=Object.assign({},e,{body:s,is_spoiler:t,origin_id:i,references:n,id:i,msgid:i,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),message:s,nick:this.get("nick"),sender:"me",type:"groupchat",original_text:r},yield Ey.getMediaURLsMetadata(r)),e=yield Wu.hook("getOutgoingMessageAttributes",this,e)})).call(this)}getRoomJIDAndNick(){const e=this.get("nick");return Bs.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")}sendChatState(){if(!Wu.settings.get("send_chat_state_notifications")||!this.get("chat_state")||!this.isEntered()||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=Wu.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==co&&Wu.send(Oy`
            <message to="${this.get("jid")}" type="groupchat" xmlns="jabber:client">
                ${t===io?Oy`<inactive xmlns="${Bs.NS.CHATSTATES}"/>`:""}
                ${t===so?Oy`<active xmlns="${Bs.NS.CHATSTATES}"/>`:""}
                ${t===oo?Oy`<composing xmlns="${Bs.NS.CHATSTATES}"/>`:""}
                ${t===ao?Oy`<paused xmlns="${Bs.NS.CHATSTATES}"/>`:""}
                <no-store xmlns="${Bs.NS.HINTS}"/>
                <no-permanent-store xmlns="${Bs.NS.HINTS}"/>
            </message>`)}directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const n=Oy`
            <message xmlns="jabber:client" to="${e}" id="${Lp()}">
                <x xmlns="jabber:x:conference"
                    jid="${this.get("jid")}"
                    ${this.get("password")?Ls.unsafeXML(`password="${Bs.xmlescape(this.get("password"))}"`):""}
                    ${t?Ls.unsafeXML(`reason="${Bs.xmlescape(t)}"`):""} />
            </message>`;Wu.send(n),Wu.trigger("roomInviteSent",{room:this,recipient:e,reason:t})}refreshDiscoInfo(){return xy((function*(){const e=yield Wu.disco.refresh(this.get("jid"));return e instanceof Ul?e:this.getDiscoInfo().catch((e=>Q.error(e)))})).call(this)}getDiscoInfo(){return xy((function*(){const e=yield Wu.disco.getIdentity("conference","text",this.get("jid"));(null==e?void 0:e.get("name"))?this.save({name:e.get("name")}):Q.error(`No identity or name found for ${this.get("jid")}`),yield this.getDiscoInfoFields(),yield this.getDiscoInfoFeatures()})).call(this)}getDiscoInfoFields(){return xy((function*(){const e=(yield Wu.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const n=t.get("var");return"muc#roomconfig_roomname"===n&&(e.roomname=t.get("value")),(null==n?void 0:n.startsWith("muc#roominfo_"))&&(e[n.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e),e.roomname&&this.save({name:e.roomname})})).call(this)}getDiscoInfoFeatures(){return xy((function*(){const e=yield Wu.disco.getFeatures(this.get("jid")),t=Hp.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{fetched:(new Date).toISOString()});e.each((e=>{const n=e.get("var");n.startsWith("muc_")?t[n.replace("muc_","")]=!0:n===Bs.NS.MAM?t.mam_enabled=!0:t[n]=!0})),this.features.save(t)})).call(this)}addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const n=e.getAttribute("var").replace("muc#roomconfig_",""),r=this.get("roomconfig");if(n in r){let i;switch(t){case"boolean":i=[r[n]?1:0];break;case"list-multi":i=r[n];break;default:i=[r[n]]}e.innerHTML=i.map((e=>rs("value").t(e))).join("")}return e}autoConfigureChatRoom(){return xy((function*(){const e=yield this.fetchRoomConfiguration(),t=ee()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)})).call(this)}fetchRoomConfiguration(){return Wu.sendIQ(Oy`
            <iq to="${this.get("jid")}" type="get" xmlns="jabber:client">
                <query xmlns="${Bs.NS.MUC_OWNER}"/>
            </iq>`)}sendConfiguration(e=[]){const t=Oy`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Bs.NS.MUC_OWNER}">
                    <x xmlns="${Bs.NS.XFORM}" type="submit">
                        ${e.map((e=>Bs.Builder.fromString(e.outerHTML)))}
                    </x>
                </query>
            </iq>`;return Wu.sendIQ(t)}onCommandError(e){const{__:t}=Ao;Q.fatal(e);const n=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:n,type:"error"})}getNickOrJIDFromCommandArgs(e){const{__:t}=Ao;if(Ey.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const n=this.parseTextForReferences(e)[1];if(!n.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(n.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const r=n.pop().value,i=e.split(r,2)[1];if(!i||i.startsWith(" "))return r;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}}validateRoleOrAffiliationChangeArgs(e,t){const{__:n}=Ao;if(!t){const t=n('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0}getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=Ao.session.get("bare_jid"),n=this.occupants.findWhere({jid:t});return this.verifyAffiliations(["owner"],n,!1)?e=e.concat(cv).concat(iv):this.verifyAffiliations(["admin"],n,!1)&&(e=e.concat(iv)),this.verifyRoles(["moderator"],n,!1)?e=e.concat(av).concat(uv):this.verifyRoles(["visitor","participant","moderator"],n,!1)||(e=e.concat(uv)),e.sort(),Array.isArray(Wu.settings.get("muc_disable_slash_commands"))?e.filter((e=>!Wu.settings.get("muc_disable_slash_commands").includes(e))):e}verifyAffiliations(e,t,n=!0){const{__:r}=Ao;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;const i=Ao.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const n=t.get("affiliation");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1}verifyRoles(e,t,n=!0){const{__:r}=Ao;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;const i=Ao.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const n=t.get("role");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error",is_ephemeral:2e4})}return!1}getOwnRole(){var e;return null===(e=this.getOwnOccupant())||void 0===e?void 0:e.get("role")}getOwnAffiliation(){var e;return(null===(e=this.getOwnOccupant())||void 0===e?void 0:e.get("affiliation"))||"none"}getOwnOccupant(){return this.occupants.getOwnOccupant()}setNickname(e){return xy((function*(){const t=Bs.getBareJidFromJid(this.get("jid"));Wu.send(Oy`<presence xmlns="jabber:client"
                    id="${Lp()}"
                    from="${Wu.connection.get().jid}"
                    to="${t}/${e}"></presence>`)})).call(this)}setRole(e,t,n,r,i){const s=Oy`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Bs.NS.MUC_ADMIN}">
                    <item nick="${e.get("nick")}" role="${t}">
                        ${null!==n?Oy`<reason>${n}</reason>`:""}
                    </item>
                </query>
            </iq>`;return Wu.sendIQ(s).then(r).catch(i)}getOccupant(e){return Ey.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)}getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))}getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))}getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,n)=>t.get(e)<n.get(e)?-1:t.get(e)>n.get(e)?1:0))}updateMemberLists(e){return xy((function*(){const t=this.get("jid"),n=yield Promise.all(["member","admin","owner"].map((e=>Wv(e,t)))),r=n.reduce(((e,t)=>t instanceof Error?(Q.error(t),e):[...t,...e]),[]);yield Vv(t,Jv(!0,!1,e,r)),yield this.occupants.fetchMembers()})).call(this)}getNicknameFromHook(){return xy((function*(){return yield Wu.hook("getNicknameForMUC",this,null)})).call(this)}getAndPersistNickname(e){return xy((function*(){return(e=e||this.get("nick")||(yield this.getReservedNick())||(yield this.getNicknameFromHook())||Ao.exports.getDefaultMUCNickname())&&jl(this,{nick:e},{silent:!0}),e})).call(this)}getReservedNick(){return xy((function*(){const e=Oy`
            <iq to="${this.get("jid")}" type="get" xmlns="jabber:client">
                <query xmlns="${Bs.NS.DISCO_INFO}" node="x-roomuser-item"/>
            </iq>`,t=yield Wu.sendIQ(e,null,!1);if(Ey.isErrorObject(t))throw t;const n=null==t?void 0:t.querySelector('query[node="x-roomuser-item"] identity');return n?n.getAttribute("name"):null})).call(this)}registerNickname(){return xy((function*(){const{__:e}=Ao,t=this.get("nick"),n=this.get("jid");let r,i;try{r=yield Wu.sendIQ(Oy`<iq to="${n}" type="get" xmlns="jabber:client">
                    <query xmlns="${Bs.NS.MUC_REGISTER}"/>
                </iq>`)}catch(t){return ee()(`not-allowed[xmlns="${Bs.NS.STANZAS}"]`,t).length?i=e("You're not allowed to register yourself in this groupchat."):ee()(`registration-required[xmlns="${Bs.NS.STANZAS}"]`,t).length&&(i=e("You're not allowed to register in this groupchat because it's members-only.")),Q.error(t),i}const s=ee()("field required",r).map((e=>e.parentElement));if(s.length>1&&"muc#register_roomnick"!==s[0].getAttribute("var"))return Q.error(`Can't register the user register in the groupchat ${n} due to the required fields`);try{yield Wu.sendIQ(Oy`<iq to="${n}" type="set" xmlns="jabber:client">
                    <query xmlns="${Bs.NS.MUC_REGISTER}">
                        <x xmlns="${Bs.NS.XFORM}" type="submit">
                            <field var="FORM_TYPE">
                                <value>http://jabber.org/protocol/muc#register</value>
                            </field>
                            <field var="muc#register_roomnick">
                                <value>${t}</value>
                            </field>
                        </x>
                    </query>
                </iq>`)}catch(e){const t=yield rm(e);throw"service-unavailable"===(null==t?void 0:t.name)?Q.error("Can't register your nickname in this groupchat, it doesn't support registration."):"bad-request"===(null==t?void 0:t.name)?Q.error("Can't register your nickname in this groupchat, invalid data form supplied."):Q.error(e),t}})).call(this)}unregisterNickname(){return xy((function*(){if("unregister"===Wu.settings.get("auto_register_muc_nickname"))try{(yield Wu.disco.supports(Bs.NS.MUC_REGISTER,this.get("jid")))&&(yield this.sendUnregistrationIQ())}catch(e){Q.error(e)}})).call(this)}sendUnregistrationIQ(){const e=Oy`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Bs.NS.MUC_REGISTER}">
                    <remove/>
                </query>
            </iq>`;return Wu.sendIQ(e).catch((e=>Q.error(e)))}updateOccupantsOnPresence(e){var t,n;if("error"===e.type||!e.jid&&!e.nick&&!e.occupant_id)return!0;const r=this.occupants.findOccupant(e);if("unavailable"===e.type&&r&&!e.codes.includes(Hp.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(e.affiliation))return r.set($y(jy({},e),{presence:"offline"})),void r.destroy();const i="unavailable"!==e.type?"online":"offline",s=e.jid||"",o=$y(jy({},e),{presence:i,jid:Bs.getBareJidFromJid(s)||(null==r||null===(t=r.attributes)||void 0===t?void 0:t.jid),resource:Bs.getResourceFromJid(s)||(null==r||null===(n=r.attributes)||void 0===n?void 0:n.resource)});if(e.is_self){let t=!1;e.codes.includes(Hp.MUC_NICK_CHANGED_CODE)&&(t=!0,this.set("nick",e.nick)),this.features.get(Bs.NS.OCCUPANTID)&&this.get("occupant-id")!==e.occupant_id&&(t=!0,this.set("occupant_id",e.occupant_id)),t&&this.save()}r?r.save(o):this.occupants.create(o)}fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];e.codes.filter((e=>t.includes(e))).length&&this.refreshDiscoInfo()}isSameUser(e,t){const n=Bs.getBareJidFromJid(e),r=Bs.getBareJidFromJid(t),i=Bs.getResourceFromJid(e),s=Bs.getResourceFromJid(t);if(Ey.isSameBareJID(e,t))return n!==this.get("jid")||i===s;return(n===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:n}))===(r===this.get("jid")?this.occupants.findOccupant({nick:s}):this.occupants.findOccupant({jid:r}))}isSubjectHidden(){return xy((function*(){return(yield Wu.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))})).call(this)}toggleSubjectHiddenState(){return xy((function*(){const e=this.get("jid"),t=yield Wu.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?Wu.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):Wu.user.settings.set("mucs_with_hidden_subject",[...t,e])})).call(this)}handleSubjectChange(e){return xy((function*(){const t=Ao.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const n=e.subject,r=e.nick;if(jl(this,{subject:{author:r,text:e.subject||""}}),!e.is_delayed&&r){const i=t(n?"Topic set by %1$s":"Topic cleared by %1$s",r),s=this.messages.last();(null==s?void 0:s.get("nick"))===e.nick&&"info"===(null==s?void 0:s.get("type"))&&(null==s?void 0:s.get("message"))===i||this.createMessage({message:i,nick:e.nick,type:"info",is_ephemeral:!0}),(yield this.isSubjectHidden())&&this.toggleSubjectHiddenState()}return!0}return!1})).call(this)}setSubject(e=""){Wu.send(Oy`
            <message to="${this.get("jid")}" type="groupchat" xmlns="jabber:client">
                <subject>${e}</subject>
            </message>`)}ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))}isOwnMessage(e){let t;return t=e instanceof Element?e.getAttribute("from"):e instanceof Ao.exports.MUCMessage?e.get("from"):e.from,Bs.getResourceFromJid(t)==this.get("nick")}getUpdatedMessageAttributes(e,t){const n=jy({},super.getUpdatedMessageAttributes(e,t),Fr(t,["from_muc","occupant_id"]));if(this.isOwnMessage(t)){const r=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(n,jy({},Fr(t,r)),{body:t.body}),e.get("received")||(n.received=(new Date).toISOString())}return n}isJoined(){return xy((function*(){return this.isEntered()?(Wu.connection.connected()||(yield new Promise((e=>Wu.listen.once("reconnected",e)))),Wu.ping(`${this.get("jid")}/${this.get("nick")}`)):(Q.info(`isJoined: not pinging MUC ${this.get("jid")} since we're not entered`),!1)})).call(this)}sendStatusPresence(e,t){return xy((function*(){if(this.session.get("connection_status")===_v.ENTERED){const n=yield Ao.state.profile.constructPresence($y(jy({},e),{to:`${this.get("jid")}/${this.get("nick")}`}),null==t?void 0:t.map((e=>{var t;return null!==(t=null==e?void 0:e.tree())&&void 0!==t?t:e})));Wu.send(n)}})).call(this)}rejoinIfNecessary(){return xy((function*(){return this.isRAICandidate()?(Q.debug(`rejoinIfNecessary: not rejoining hidden MUC "${this.get("jid")}" since we're using RAI`),!0):(yield this.isJoined())?void 0:(this.rejoin(),!0)})).call(this)}shouldShowErrorMessage(e){var t=this,n=()=>super.shouldShowErrorMessage;return xy((function*(){if("Decryption"===e.error_type){if("Message key not found. The counter was repeated or the key was not filled."===e.error_message)return!1;if("not-encrypted-for-this-device"===e.error_condition)return!1}else if("not-acceptable"===e.error_condition&&(yield this.rejoinIfNecessary()))return!1;return n().call(t,e)})).call(this)}findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),n=e[`stanza_id ${this.get("jid")}`];return n?(t.reverse(),t.find((({attributes:e})=>"retracted"===e.moderated&&e.moderated_id===n&&e.moderated_by))):null}}handleModeration(e){return xy((function*(){const t=["editable","moderated","moderated_by","moderated_by_id","moderated_id","moderation_reason"];if("retracted"===e.moderated){const n={};n[`stanza_id ${this.get("jid")}`]=e.moderated_id;const r=this.messages.findWhere(n);return r?(r.save(Fr(e,t)),!0):(e.dangling_moderation=!0,yield this.createMessage(e),!0)}{const n=this.findDanglingModeration(e);if(n){const r=Fr(n.attributes,t),i=Object.assign({dangling_moderation:!1},e,r);return delete i.id,n.save(i),!0}}return!1})).call(this)}getNotificationsText(){const{__:e}=Ao,t=this.notifications.toJSON(),n=Wu.settings.get("muc_show_info_messages").filter((e=>Hp.MUC_ROLE_CHANGES_LIST.includes(e))),r=Wu.settings.get("muc_show_info_messages").filter((e=>Hp.MUC_TRAFFIC_STATES_LIST.includes(e)));return[...Hp.CHAT_STATES,...r,...n].reduce(((n,r)=>{const i=t[r];if(!(null==i?void 0:i.length))return n;const s=i.map((e=>{var t;return(null===(t=this.getOccupant(e))||void 0===t?void 0:t.getDisplayName())||e}));if(1===s.length){if("composing"===r)return`${n}${e("%1$s is typing",s[0])}\n`;if("paused"===r)return`${n}${e("%1$s has stopped typing",s[0])}\n`;if(r===co)return`${n}${e("%1$s has gone away",s[0])}\n`;if("entered"===r)return`${n}${e("%1$s has entered the groupchat",s[0])}\n`;if("exited"===r)return`${n}${e("%1$s has left the groupchat",s[0])}\n`;if("op"===r)return`${n}${e("%1$s is now a moderator",s[0])}\n`;if("deop"===r)return`${n}${e("%1$s is no longer a moderator",s[0])}\n`;if("voice"===r)return`${n}${e("%1$s has been given a voice",s[0])}\n`;if("mute"===r)return`${n}${e("%1$s has been muted",s[0])}\n`}else if(s.length>1){let t;if(s.length>3)t=`${Array.from(s).slice(0,2).join(", ")} and others`;else{const n=s.pop();t=e("%1$s and %2$s",s.join(", "),n)}if("composing"===r)return`${n}${e("%1$s are typing",t)}\n`;if("paused"===r)return`${n}${e("%1$s have stopped typing",t)}\n`;if(r===co)return`${n}${e("%1$s have gone away",t)}\n`;if("entered"===r)return`${n}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===r)return`${n}${e("%1$s have left the groupchat",t)}\n`;if("op"===r)return`${n}${e("%1$s are now moderators",s[0])}\n`;if("deop"===r)return`${n}${e("%1$s are no longer moderators",s[0])}\n`;if("voice"===r)return`${n}${e("%1$s have been given voices",s[0])}\n`;if("mute"===r)return`${n}${e("%1$s have been muted",s[0])}\n`}return n}),"")}removeNotification(e,t){const n=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const r=Array.from(n[t]||[]);if(r.includes(e)){const n=r.indexOf(e);r.splice(n,1),this.notifications.set(t,Array.from(r))}}))}updateNotifications(e,t){const n=this.notifications.toJSON(),r=n[t]||[];if(r.includes(e))return;const i=(i,s)=>(i[s]=s===t?[...r,e]:(n[s]||[]).filter((t=>t!==e)),i),s=Hp.CHAT_STATES.reduce(i,{}),o=Hp.MUC_TRAFFIC_STATES_LIST.reduce(i,{}),a=Hp.MUC_ROLE_CHANGES_LIST.reduce(i,{});this.notifications.set(Object.assign(s,o,a)),setTimeout((()=>this.removeNotification(e,t)),1e4)}handleMUCPrivateMessage(e){if("chat"===e.type||null===e.type){const t=this.occupants.findOccupant(e);if(t)return t.queueMessage(e)}return!1}handleMetadataFastening(e){if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const n=t.get("ogp_metadata")||[];if(n.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const r=[...n,Fr(e,Ks)];return t.save("ogp_metadata",r),!0}}return!1}handleMEPNotification(e){var t;return!(e.from!==this.get("jid")||!e.activities)&&(null===(t=e.activities)||void 0===t||t.forEach((t=>{const n=Object.assign(e,t);this.createMessage(n),Wu.trigger("message",{attrs:n,chatbox:this})})),!!e.activities.length)}getDuplicateMessage(e){var t;return(null===(t=e.activities)||void 0===t?void 0:t.length)?this.messages.findWhere({type:"mep",msgid:e.msgid}):super.getDuplicateMessage(e)}onMessage(e){return xy((function*(){if(Ey.isErrorObject(e))return Q.error(e.message);const t=e;if("error"===t.type&&!(yield this.shouldShowErrorMessage(t)))return;const n=this.getDuplicateMessage(t);if(n)"groupchat"===n.get("type")&&this.updateMessage(n,t);else if(!(t.receipt_id||t.is_marker||this.ignorableCSN(t)))if(this.handleMUCPrivateMessage(t)||this.handleMetadataFastening(t)||this.handleMEPNotification(t)||(yield this.handleModeration(t))||(yield this.handleRetraction(t))||(yield this.handleSubjectChange(t)))t.nick&&this.removeNotification(t.nick,["composing","paused"]);else if(this.setEditable(t,t.time),t.chat_state&&this.updateNotifications(t.nick,t.chat_state),oy(t)){const e=(yield this.handleCorrection(t))||(yield this.createMessage(t));this.removeNotification(t.nick,["composing","paused"]),this.handleUnreadMessage(e)}})).call(this)}handleModifyError(e){var t;const n=null===(t=e.querySelector("error text"))||void 0===t?void 0:t.textContent;if(n)if(this.session.get("connection_status")===_v.CONNECTING)this.setDisconnectionState(n);else{const e={type:"error",message:n,is_ephemeral:!0};this.createMessage(e)}}handleDisconnection(e){const{is_self:t,reason:n,actor:r}=e,i=e.codes.filter((e=>ov.includes(e)));if(!(t&&i.length>0))return;const{STATUS_CODE_MESSAGES:s}=Ao.labels.muc,o=s[i[0]],a=i.includes("301")?_v.BANNED:_v.DISCONNECTED;this.setDisconnectionState(o,n,null==r?void 0:r.nick,a)}getActionInfoMessage(e,t){const{nick:n,actor:r}=t,i=Ao.__;return"301"===e?(null==r?void 0:r.nick)?i("%1$s has been banned by %2$s",n,r.nick):i("%1$s has been banned",n):"303"===e?i("%1$s's nickname has changed",n):"307"===e?(null==r?void 0:r.nick)?i("%1$s has been kicked out by %2$s",n,r.nick):i("%1$s has been kicked out",n):"321"===e?i("%1$s has been removed because of an affiliation change",n):"322"===e?i("%1$s has been removed for not being a member",n):void 0}createAffiliationChangeMessage(e){const t=Ao.__,n=e._previousAttributes.affiliation;if(!n)return;const r=e.get("affiliation");"admin"===n&&py(Hp.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===n&&py(Hp.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===n&&py(Hp.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===r&&"member"===n&&py(Hp.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===r&&py(Hp.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===r&&py(Hp.AFFILIATION_CHANGES.ADMIN)||"owner"==r&&py(Hp.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),r)})}createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const n=e._previousAttributes.role;"moderator"===n&&py(Hp.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),Hp.MUC_ROLE_CHANGES.DEOP):"visitor"===n&&py(Hp.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),Hp.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&py(Hp.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),Hp.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&py(Hp.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),Hp.MUC_ROLE_CHANGES.OP)}createInfoMessageFromPresence(e,t){const n=Ao.__;var r;const i=null!==(r=t.is_self)&&void 0!==r&&r;if(!py||"110"===e||"100"===e&&!i)return;const{STATUS_CODE_MESSAGES:s}=Ao.labels.muc,o=s[e],a={type:"info",is_ephemeral:!0,message:o,code:e};if(!i&&nv.includes(e)?(a.message=this.getActionInfoMessage(e,t),a.reason=t.reason):i&&rv.includes(e)&&(a.message=t.nick?n(o,t.nick):void 0),a.message){if("201"===e&&this.messages.findWhere(a))return;this.createMessage(a)}}createInfoMessage(e){if(!py(e)||"110"===e)return;const{STATUS_CODE_MESSAGES:t}=Ao.labels.muc,n=t[e];n&&this.createMessage({type:"info",is_ephemeral:!0,message:n,code:e})}setDisconnectionState(e,t,n,r=_v.DISCONNECTED){this.session.save({connection_status:r,disconnection_actor:n,disconnection_message:e,disconnection_reason:t})}onNicknameClash(e){const t=Ao.__;if(Wu.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===Ao.exports.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),n=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(n)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:_v.NICKNAME_REQUIRED})}onErrorPresence(e){var t;const n=Ao.__,r=e.querySelector("error"),i=r.getAttribute("type"),s=null===(t=ee()(`text[xmlns="${Bs.NS.STANZAS}"]`,r).pop())||void 0===t?void 0:t.textContent;if("modify"===i)this.handleModifyError(e);else if("auth"===i){if(ee()(`not-authorized[xmlns="${Bs.NS.STANZAS}"]`,r).length&&(this.save({password_validation_message:s||n("Password incorrect")}),this.session.save({connection_status:_v.PASSWORD_REQUIRED})),r.querySelector("registration-required")){const e=n("You are not on the member list of this groupchat.");this.setDisconnectionState(e,s)}else if(r.querySelector("forbidden")){const{STATUS_CODE_MESSAGES:e}=Ao.labels.muc;this.setDisconnectionState(e[301],s,null,_v.BANNED)}}else if("cancel"===i)if(r.querySelector("not-allowed")){const e=n("You are not allowed to create new groupchats.");this.setDisconnectionState(e,s)}else if(r.querySelector("not-acceptable")){const e=n("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,s)}else if(ee()(`gone[xmlns="${Bs.NS.STANZAS}"]`,r).length){var o;const e=null===(o=ee()(`gone[xmlns="${Bs.NS.STANZAS}"]`,r).pop())||void 0===o?void 0:o.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:s}),this.session.save({connection_status:_v.DESTROYED})}else if(r.querySelector("conflict"))this.onNicknameClash(e);else if(r.querySelector("item-not-found")){const e=n("This groupchat does not (yet) exist.");this.setDisconnectionState(e,s)}else if(r.querySelector("service-unavailable")){const e=n("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,s)}else if(r.querySelector("remote-server-not-found")){const e=n("Remote server not found");this.setDisconnectionState(e,s)}else if(r.querySelector("forbidden")){const e=n("You're not allowed to enter this groupchat");this.setDisconnectionState(e,s)}else{const e=n("An error happened while trying to enter this groupchat");this.setDisconnectionState(e,s)}}onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===(null==t?void 0:t.getAttribute("type"))&&(null==t?void 0:t.querySelector("resource-constraint"))&&this.session.get("connection_status")===_v.DISCONNECTED&&this.rejoin()}}onPresence(e){return xy((function*(){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);const t=yield zv(e,this);t.codes.forEach((e=>xy((function*(){if(this.createInfoMessageFromPresence(e,t),t.is_self&&rv.includes(e)&&(this.save("nick",t.nick),"303"===e&&Wu.settings.get("auto_register_muc_nickname")&&(yield Wu.disco.supports(Bs.NS.MUC_REGISTER,this.get("jid")))))try{yield this.registerNickname()}catch(e){Q.error(e),Q.error("Error: could not register new nickname")}})).call(this))),t.is_self?(this.onOwnPresence(t),"none"!==this.getOwnRole()&&this.session.get("connection_status")===_v.CONNECTING&&this.session.save("connection_status",_v.CONNECTED)):this.updateOccupantsOnPresence(t)})).call(this)}onOwnPresence(e){return xy((function*(){if(yield this.occupants.fetched,"unavailable"===e.type)return void this.handleDisconnection(e);const t=this.session.get("connection_status");t!==_v.ENTERED&&t!==_v.CLOSING?(this.session.save("connection_status",_v.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e);e.codes.includes("201")&&(this.get("auto_configure")?yield this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):Wu.settings.get("muc_instant_rooms")?yield this.sendConfiguration().then((()=>this.refreshDiscoInfo())):Wu.modal.show("converse-muc-config-modal",{model:this}))})).call(this)}isUserMentioned(e){const t=this.get("nick");if(e.get("references").length){return e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t)}return new RegExp(`\\b${t}\\b`).test(e.get("body"))}incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)}clearUnreadMsgCounter(){return xy((function*(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&(yield this.sendMarkerForMessage(this.messages.last())),jl(this,{has_activity:!1,num_unread:0,num_unread_general:0})})).call(this)}}const ky=Cy;function Ty(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Ny(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Ty(s,r,i,o,a,"next",e)}function a(e){Ty(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:My,stx:Iy}=Hp.env;class Py extends(Wm(gg(Om(ae.Model)))){initialize(){var e=this,t=()=>super.initialize;return Ny((function*(){this.lazy_load_vcard=!0,t().call(e),yield this.fetchMessages(),this.on("change:nick",(()=>this.setColor())),this.on("change:jid",(()=>this.setColor())),this.on("change:chat_state",(()=>Yp(this.get("jid"),this.get("chat_state"))))})).call(this)}defaults(){return{hats:[],presence:"offline",show:void 0,states:[],hidden:!0,num_unread:0,message_type:"chat"}}save(e,t,n){let r;return null==e?super.save(e,t,n):("object"==typeof e?(r=e,n=t):(r={})[e]=t,r.occupant_id&&(r.id=r.occupant_id),super.save(r,n))}getMessagesCacheKey(){return`converse.muc-private-msgs-${this.get("occupant_id")||this.get("jid")||this.get("nick")}-${Ao.session.get("bare_jid")}`}getMessagesCollection(){return new Kg}onMessage(e){return Ny((function*(){if(Up.isErrorObject(e)){const{stanza:t,message:n}=e;return t&&Q.error(t),Q.error(n)}const t=e;if("error"===t.type&&!(yield this.shouldShowErrorMessage(t)))return;const n=this.getDuplicateMessage(t);if(n)this.updateMessage(n,t);else if(!(yield this.handleRetraction(t))&&(this.setEditable(t,t.time),oy(t))){const e=(yield this.handleCorrection(t))||(yield this.createMessage(t));this.handleUnreadMessage(e)}})).call(this)}getDisplayName(){return this.get("nick")||this.get("jid")||""}getAssignableRoles(){let e=Wu.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?lv:[]),"moderator"===this.get("role")?lv.filter((t=>!e.includes(t))):[]}getAssignableAffiliations(){let e=Wu.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?sv:[]),"owner"===this.get("affiliation")?sv.filter((t=>!e.includes(t))):"admin"===this.get("affiliation")?sv.filter((t=>!["owner","admin",...e].includes(t))):[]}isMember(){return["admin","owner","member"].includes(this.get("affiliation"))}isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")}isSelf(){return this.get("states").includes("110")}getOutgoingMessageAttributes(e){return Ny((function*(){const t=Up.getUniqueId(),n=null==e?void 0:e.body,r=n?Up.shortnamesToUnicode(n):void 0,i=this.collection.chatroom,s=i.getOwnOccupant();var o;return e=Object.assign({},e,{body:r,from:s.get("from"),fullname:Ao.state.profile.get("fullname"),id:t,jid:this.get("jid"),message:r,msgid:t,nick:s.get("nickname"),origin_id:t,sender:"me",time:(new Date).toISOString(),to:null!==(o=this.get("from"))&&void 0!==o?o:`${i.get("jid")}/${this.get("nick")}`,type:"chat"},yield Up.getMediaURLsMetadata(n)),e=yield Wu.hook("getOutgoingMessageAttributes",this,e)})).call(this)}createMessageStanza(e){var t=this,n=()=>super.createMessageStanza;return Ny((function*(){const r=yield n().call(t,e);return r.cnode(Iy`<x xmlns="${My.NS.MUC}#user"/>`).root(),r}))()}isChatMessage(e){return e.get("type")===this.get("message_type")}}const Dy=Py;function Ry(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{u:zy}=Hp.env;class Ly extends ae.Collection{get model(){return Dy}initialize(){this.on("change:nick",(()=>this.sort())),this.on("change:role",(()=>this.sort()))}static getAutoFetchedAffiliationLists(){const e=Wu.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]}create(e,t){return e.id||e instanceof ae.Model||(e.id=e.occupant_id||Lp()),super.create(e,t)}fetchMembers(){return(e=function*(){var e;if(!["member","admin","owner"].includes(null===(e=this.getOwnOccupant())||void 0===e?void 0:e.get("affiliation")))return;const t=Ly.getAutoFetchedAffiliationLists();if(0===t.length)return;const n=this.chatroom.get("jid"),r=yield Promise.all(t.map((e=>Wv(e,n)))),i=r.reduce(((e,t)=>t instanceof Error?e:[...t,...e]),[]),s=t.filter((e=>!zy.isErrorObject(r[t.indexOf(e)]))),o=i.map((e=>e.jid)).filter((e=>void 0!==e)),a=i.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e)),c=this.filter((e=>s.includes(e.get("affiliation"))&&!a.includes(e.get("nick"))&&!o.includes(e.get("jid")))),l=Ao.session.get("bare_jid");c.forEach((e=>{e.get("jid")!==l&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),i.forEach((e=>{const t=this.findOccupant(e);t?t.save(e):this.create(e)})),Wu.trigger("membersFetched")},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Ry(s,r,i,o,a,"next",e)}function a(e){Ry(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}findOccupant(e){if(e.occupant_id)return this.get(e.occupant_id);const t=e.jid&&Bs.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||e.nick&&this.findWhere({nick:e.nick})}getOwnOccupant(){return this.findOccupant({jid:Ao.session.get("bare_jid"),occupant_id:this.chatroom.get("occupant_id")})}constructor(e,t){super(e,Object.assign({comparator:ay},t)),this.chatroom=null}}const Uy=Ly;function By(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Fy(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){By(s,r,i,o,a,"next",e)}function a(e){By(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:qy,u:Hy}=Hp.env;class Gy extends(Wm(gg(km(Om(Zv))))){defaults(){return{bookmarked:!1,hidden:ni()&&!Wu.settings.get("singleton"),message_type:"chat",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:lo}}initialize(){var e=this,t=()=>super.initialize;return Fy((function*(){t().call(e),this.initialized=ue();const n=this.get("jid");this.setPresence(n),yield this.setModelContact(n),this.on("change:chat_state",(()=>Yp(this.get("jid"),this.get("chat_state")))),this.on("change:hidden",(()=>this.get("hidden")&&this.setChatState(io))),yield this.fetchMessages(),yield Wu.trigger("chatBoxInitialized",this,{synchronous:!0}),this.initialized.resolve()})).call(this)}setPresence(e){return Fy((function*(){yield Wu.waitUntil("presencesInitialized");const{presences:t}=Ao.state;this.presence=t.get(e)||t.create({jid:e}),this.presence.on("change:show",(e=>this.onPresenceChanged(e)))})).call(this)}onMessage(e){return Fy((function*(){if(Hy.isErrorObject(e)){const{stanza:t,message:n}=e;return t&&Q.error(t),Q.error(n)}const t=e,n=this.getDuplicateMessage(t);if(n)this.updateMessage(n,t);else if(!this.handleReceipt(t)&&!this.handleChatMarker(t)&&!(yield this.handleRetraction(t))&&(this.setEditable(t,t.time),t.chat_state&&"them"===t.sender&&this.notifications.set("chat_state",t.chat_state),Hy.shouldCreateMessage(t))){const e=(yield this.handleCorrection(t))||(yield this.createMessage(t));this.notifications.set({chat_state:null}),this.handleUnreadMessage(e)}})).call(this)}onPresenceChanged(e){const{__:t}=Ao,n=e.get("show"),r=this.getDisplayName();let i;"offline"===n?i=t("%1$s has gone offline",r):"away"===n?i=t("%1$s has gone away",r):"dnd"===n?i=t("%1$s is busy",r):"online"===n&&(i=t("%1$s is online",r)),i&&this.createMessage({message:i,type:"info",is_ephemeral:!0})}close(){var e=this,t=()=>super.close;return Fy((function*(){Wu.connection.connected()&&(this.setChatState(io),Yp(this.get("jid"),this.get("chat_state"))),yield t().call(e)})).call(this)}getDisplayName(){if(this.contact){const e=this.contact.getDisplayName({no_jid:!0});if(e)return e}return this.vcard?this.vcard.getDisplayName():this.get("jid")}isSameUser(e,t){return Hy.isSameBareJID(e,t)}handleChatMarker(e){if(qy.getBareJidFromJid(e.to)!==Ao.session.get("bare_jid"))return!1;if(e.is_markable)return!this.contact||["none","to",void 0].includes(this.contact.get("subscription"))||e.is_archived||e.is_carbon||Jp(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),n=`marker_${e.marker}`;return t&&!t.get(n)&&t.save({field_name:(new Date).toISOString()}),!0}}getOutgoingMessageAttributes(e){return Fy((function*(){const t=!!this.get("composing_spoiler"),n=Hy.getUniqueId(),r=null==e?void 0:e.body,i=r?Hy.shortnamesToUnicode(r):void 0;return e=Object.assign({},e,{body:i,from:Ao.session.get("jid"),fullname:Ao.state.profile.get("fullname"),id:n,is_spoiler:t,jid:this.get("jid"),message:i,msgid:n,nick:this.get("nickname"),origin_id:n,sender:"me",time:(new Date).toISOString(),type:this.get("message_type")},yield Hy.getMediaURLsMetadata(r)),e=yield Wu.hook("getOutgoingMessageAttributes",this,e)})).call(this)}canPostMessages(){return!0}isChatMessage(e){const t=e.get("type");return t===this.get("message_type")||"normal"===t}constructor(e,t){super(e,t),this.disable_mam=!1}}const Wy=Gy;function Vy(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const Ky=class extends Ym{initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){n().call(t),this.initialized=ue(),this.on("change:type",(()=>this.setContact())),yield this.setContact(),yield Wu.trigger("messageInitialized",this,{synchronous:!0}),this.initialized.resolve()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Vy(s,r,i,o,a,"next",e)}function a(e){Vy(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}setContact(){if(["chat","normal"].includes(this.get("type")))return this.setModelContact(Bs.getBareJidFromJid(this.get("from")))}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")}};class Jy extends ae.Collection{constructor(){super(),this.comparator="time",this.model=Ky,this.fetched=null,this.chatbox=null}}const Yy=Jy;function Xy(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Qy(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Xy(s,r,i,o,a,"next",e)}function a(e){Xy(s,r,i,o,a,"throw",e)}o(void 0)}))}}const Zy={chats:{create:(e,t)=>Qy((function*(){if("string"==typeof e){if(t&&!(null==t?void 0:t.fullname)){var n;const r=yield Wu.contacts.get(e);t.fullname=null==r||null===(n=r.attributes)||void 0===n?void 0:n.fullname}const r=Wu.chats.get(e,t,!0);return r||void Q.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.map((n=>Qy((function*(){var r;const i=yield Wu.contacts.get(e);return t.fullname=null==i||null===(r=i.attributes)||void 0===r?void 0:r.fullname,Wu.chats.get(n,t,!0).maybeShow()}))()))):(Q.error("chats.create: You need to provide at least one JID"),null)}))(),open:(e,t,n)=>Qy((function*(){if("string"==typeof e){const r=yield Wu.chats.get(e,t,!0);return r?r.maybeShow(n):r}if(Array.isArray(e))return Promise.all(e.map((e=>Wu.chats.get(e,t,!0).then((e=>e&&e.maybeShow(n))))).filter((e=>e)));const r="chats.open: You need to provide at least one JID";throw Q.error(r),new Error(r)}))(),get(e){return Qy((function*(e,t={},n=!1){function r(e){return Qy((function*(){let r=yield Wu.chatboxes.get(e);return!r&&n?r=yield Wu.chatboxes.create(e,t,Ao.exports.ChatBox):(r=r&&r.get("type")===lo?r:null,r&&Object.keys(t).length&&r.save(t)),r}))()}if(yield Wu.waitUntil("chatBoxesFetched"),void 0===e){return(yield Wu.chatboxes.get()).filter((e=>e.get("type")===lo))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))})).apply(this,arguments)}}};function eb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function tb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){eb(s,r,i,o,a,"next",e)}function a(e){eb(s,r,i,o,a,"throw",e)}o(void 0)}))}}Hp.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){Wu.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0});const e={ChatBox:Wy,Message:Ky,Messages:Yy,handleMessageStanza:cg};Object.assign(Ao,e),Object.assign(Ao.exports,e),Object.assign(Wu,Zy),bu.registry.add(lo,Wy),sg(),addEventListener("hashchange",sg),Wu.listen.on("chatBoxesFetched",og),Wu.listen.on("presencesInitialized",ag),Wu.listen.on("connected",(()=>lg())),Wu.listen.on("reconnected",(()=>lg()))}});const{Strophe:nb,u:rb}=Hp.env;class ib extends ae.Model{get idAttribute(){return"jid"}initialize(e,t){super.initialize(),this.waitUntilFeaturesDiscovered=ue(),this.waitUntilItemsFetched=ue(),this.dataforms=new ae.Collection;let n=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=tl(n,"session"),this.features=new ae.Collection,n=`converse.features-${this.get("jid")}`,this.features.browserStorage=tl(n,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new ae.Collection,n=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=tl(n,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.items=new ae.Collection,n=`converse.items-${this.get("jid")}`,this.items.browserStorage=tl(n,"session"),this.identities=new ae.Collection,n=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=tl(n,"session"),this.fetchFeatures(t)}getIdentity(e,t){return tb((function*(){return yield this.waitUntilItemsFetched,this.identities.findWhere({category:e,type:t})})).call(this)}getFeature(e){return tb((function*(){if(yield this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this})).call(this)}onFeatureAdded(e){e.entity=this,Wu.trigger("serviceDiscovered",e)}onFieldAdded(e){e.entity=this,Wu.trigger("discoExtensionFieldDiscovered",e)}fetchFeatures(e){return tb((function*(){if(e.ignore_cache)yield this.queryInfo();else{const e=this.features.browserStorage.name,t=yield this.features.browserStorage.store.getItem(e);if(t&&0===t.length||null===t)yield this.queryInfo();else{yield new Promise((e=>this.fetch({success:e,error:e}))),yield new Promise((e=>this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered"),e()},error:e}))),yield new Promise((e=>this.identities.fetch({add:!0,success:e,error:e})));const e=this.get("items");Array.isArray(e)?yield Promise.all(e.map((e=>tb((function*(){return yield Wu.disco.entities.get(e,!0)}))()))):yield this.queryForItems(),this.waitUntilItemsFetched.resolve()}}})).call(this)}queryInfo(){return tb((function*(){let e;try{e=yield Wu.disco.info(this.get("jid"),null)}catch(e){if(rb.isElement(e)){const t=yield rm(e);"item-not-found"!==t.message&&Q.error(`Error querying disco#info for ${this.get("jid")}: ${t.message}`),this.save({error:t.message}),this.waitUntilFeaturesDiscovered.resolve(t),this.waitUntilItemsFetched.resolve(t)}else null===e?Q.error(`Timeout for disco#info query for ${this.get("jid")}`):Q.error(`Error querying disco#info for ${this.get("jid")}: ${e}`),this.waitUntilFeaturesDiscovered.resolve(e),this.waitUntilItemsFetched.resolve(e);return}this.onInfo(e)})).call(this)}onDiscoItems(e){const t=ee()(`query[xmlns="${nb.NS.DISCO_ITEMS}"] item`,e),n=[];t.forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid");let r=Ao.state.disco_entities.get(t);if(r){const e=r.get("parent_jids");r.set({parent_jids:[...e,this.get("jid")]})}else r=Wu.disco.entities.create({jid:t,parent_jids:[this.get("jid")],name:e.getAttribute("name")});n.push(r.get("jid"))})),this.save({items:n})}queryForItems(){return tb((function*(){if(0===this.identities.where({category:"server"}).length)return;const e=yield Wu.disco.items(this.get("jid"));this.onDiscoItems(e)})).call(this)}onInfo(e){return tb((function*(){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),ee()(`x[type="result"][xmlns="${nb.NS.XFORM}"]`,e).forEach((e=>{const t={};ee()("field",e).forEach((e=>{var n;t[e.getAttribute("var")]={value:null===(n=e.querySelector("value"))||void 0===n?void 0:n.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${nb.NS.DISCO_ITEMS}"]`)&&(yield this.queryForItems()),this.waitUntilItemsFetched.resolve(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),ee()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{var n;this.fields.create({var:t.getAttribute("var"),value:null===(n=t.querySelector("value"))||void 0===n?void 0:n.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")})).call(this)}}const sb=ib;class ob extends ae.Collection{fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,n){Q.error(n),t(new Error("Could not fetch disco entities"))}})}))}constructor(){super(),this.model=sb}}const ab=ob;function cb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function lb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){cb(s,r,i,o,a,"next",e)}function a(e){cb(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:ub,$iq:db}=Hp.env,hb={disco:{stream:{getFeature:(e,t)=>lb((function*(){yield Wu.waitUntil("streamFeaturesAdded");const n=Ao.state.stream_features;if(!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==n||Wu.connection.connected())return n.findWhere({name:e,xmlns:t});{const n=`Tried to get feature ${e} ${t} but stream_features has been torn down`;Q.warn(n)}}))()},own:{identities:{add(e,t,n,r){const i=Ao.state.disco;for(var s=0;s<i._identities.length;s++)if(i._identities[s].category==e&&i._identities[s].type==t&&i._identities[s].name==n&&i._identities[s].lang==r)return!1;i._identities.push({category:e,type:t,name:n,lang:r})},clear(){Ao.state.disco._identities=[]},get:()=>Ao.state.disco._identities},features:{add(e){const t=Ao.state.disco;for(let n=0;n<t._features.length;n++)if(t._features[n]==e)return!1;t._features.push(e)},clear(){Ao.state.disco._features=[]},get:()=>Ao.state.disco._features}},info(e,t){const n={xmlns:ub.NS.DISCO_INFO};t&&(n.node=t);const r=db({from:Wu.connection.get().jid,to:e,type:"get"}).c("query",n);return Wu.sendIQ(r)},items(e,t){const n={xmlns:ub.NS.DISCO_ITEMS};return t&&(n.node=t),Wu.sendIQ(db({from:Wu.connection.get().jid,to:e,type:"get"}).c("query",n))},entities:{get:(e,t=!1)=>lb((function*(){yield Wu.waitUntil("discoInitialized");const n=Ao.state.disco_entities;if(!e)return n;if(void 0===n)return void Q.warn(`Tried to look up entity ${e} but disco_entities has been torn down`);const r=n.get(e);return r||!t?r:Wu.disco.entities.create({jid:e})}))(),items:e=>lb((function*(){const t=yield Wu.disco.entities.get(e);yield t.waitUntilItemsFetched;return Ao.state.disco_entities.filter((t=>{var n;return null===(n=t.get("parent_jids"))||void 0===n?void 0:n.includes(e)}))}))(),create:(e,t)=>Ao.state.disco_entities.create(e,t)},features:{get:(e,t)=>lb((function*(){if(!t)throw new TypeError("api.disco.features.get: You need to provide an entity JID");const n=yield Wu.disco.entities.get(t,!0);if(void 0===Ao.state.disco_entities&&!Wu.connection.connected())return Q.warn(`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`),[];const r=yield Wu.disco.entities.items(t),i=[n.getFeature(e),...r.map((t=>t.getFeature(e)))];return(yield Promise.all(i)).filter((e=>e instanceof Object))}))(),has:(e,t)=>lb((function*(){if(!t)throw new TypeError("api.disco.feature.has: You need to provide an entity JID");const n=yield Wu.disco.entities.get(t,!0);if(!n)return Q.warn(`api.disco.has: could not get entity for ${t}`),!1;if(void 0===Ao.state.disco_entities&&!Wu.connection.connected())return Q.warn(`Tried to check if ${t} supports feature ${e}`),!1;if(yield n.getFeature(e))return!0;const r=yield Wu.disco.entities.items(t),i=yield Promise.all(r.map((t=>t.getFeature(e))));return i.map((e=>e instanceof Object)).includes(!0)}))()},supports(e,t){try{return Wu.disco.features.has(e,t)}catch(e){return Q.error(e),!1}},refresh:e=>lb((function*(){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");yield Wu.waitUntil("discoInitialized");let t=yield Wu.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=ue()),t.waitUntilItemsFetched.isPending||(t.waitUntilItemsFetched=ue()),t.queryInfo()):t=yield Wu.disco.entities.create({jid:e},{ignore_cache:!0}),t.waitUntilItemsFetched}))(),getFeatures:e=>lb((function*(){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");yield Wu.waitUntil("discoInitialized");let t=yield Wu.disco.entities.get(e,!0);return t=yield t.waitUntilFeaturesDiscovered,t.features}))(),getFields:e=>lb((function*(){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");yield Wu.waitUntil("discoInitialized");let t=yield Wu.disco.entities.get(e,!0);return t=yield t.waitUntilFeaturesDiscovered,t.fields}))(),getIdentity:(e,t,n)=>lb((function*(){const r=yield Wu.disco.entities.get(n,!0);if(void 0!==r||Wu.connection.connected())return r.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${n} but _converse.disco_entities has been torn down`;Q.warn(t)}}))()}};function fb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:pb,$iq:mb}=Hp.env;function gb(){return(e=function*(){Wu.disco.own.identities.add("client","web","Converse"),Wu.disco.own.features.add(pb.NS.CHATSTATES),Wu.disco.own.features.add(pb.NS.DISCO_INFO),Wu.disco.own.features.add(pb.NS.ROSTERX),Wu.disco.own.features.add(pb.NS.CARBONS),Wu.trigger("addClientFeatures"),Wu.connection.get().addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:pb.NS.DISCO_INFO};t&&(n.node=t);const r=mb({type:"result",id:e.getAttribute("id")}),i=e.getAttribute("from");return null!==i&&r.attrs({to:i}),r.c("query",n),Ao.state.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),r.c("identity",t).up()})),Ao.state.disco._features.forEach((e=>r.c("feature",{var:e}).up())),Wu.send(r.tree()),!0}(e)),pb.NS.DISCO_INFO,"iq","get",null,null);const e=new Ao.exports.DiscoEntities;Object.assign(Ao,{disco_entities:e}),Object.assign(Ao.state,{disco_entities:e});const t=`converse.disco-entities-${Ao.session.get("bare_jid")}`;e.browserStorage=tl(t,"session");const n=yield e.fetchEntities(),r=Ao.session.get("domain");0!==n.length&&n.get(r)||Wu.disco.entities.create({jid:r},{ignore_cache:!0}),Wu.trigger("discoInitialized")},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){fb(s,r,i,o,a,"next",e)}function a(e){fb(s,r,i,o,a,"throw",e)}o(void 0)}))})();var e}function vb(){if(!Ao.state.stream_features){const e=`converse.stream-features-${Ao.session.get("bare_jid")}`;Wu.promises.add("streamFeaturesAdded");const t=new ae.Collection;t.browserStorage=tl(e,"session"),Object.assign(Ao,{stream_features:t}),Object.assign(Ao.state,{stream_features:t})}}function yb(){Wu.trigger("streamFeaturesAdded")}function bb(){vb(),Array.from(Wu.connection.get().features.childNodes).forEach((e=>{Ao.state.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),yb()}function _b(){const{disco_entities:e}=Ao.state;null==e||e.forEach((e=>e.features.clearStore())),null==e||e.forEach((e=>e.identities.clearStore())),null==e||e.forEach((e=>e.dataforms.clearStore())),null==e||e.forEach((e=>e.fields.clearStore())),null==e||e.clearStore(),delete Ao.state.disco_entities,Object.assign(Ao,{disco_entities:void 0})}function wb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Sb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){wb(s,r,i,o,a,"next",e)}function a(e){wb(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:xb}=Hp.env;Hp.plugins.add("converse-disco",{initialize(){Object.assign(Wu,hb),Wu.promises.add("discoInitialized"),Wu.promises.add("streamFeaturesAdded");const e={DiscoEntity:sb,DiscoEntities:ab};Object.assign(Ao,e),Object.assign(Ao.exports,e);const t={_identities:[],_features:[]};Object.assign(Ao,{disco:t}),Object.assign(Ao.state,{disco:t}),Wu.listen.on("userSessionInitialized",(()=>Sb((function*(){vb(),Ao.state.connfeedback.get("connection_status")===xb.Status.ATTACHED&&(yield new Promise(((e,t)=>Ao.state.stream_features.fetch({success:e,error:t}))),yb())}))())),Wu.listen.on("beforeResourceBinding",bb),Wu.listen.on("reconnected",gb),Wu.listen.on("connected",gb),Wu.listen.on("beforeTearDown",(()=>Sb((function*(){Wu.promises.add("streamFeaturesAdded");const{stream_features:e}=Ao.state;e&&(yield e.clearStore(),delete Ao.state.stream_features,Object.assign(Ao,{stream_features:void 0}))}))())),Wu.listen.on("will-reconnect",_b),Wu.listen.on("clearSession",_b)}});const Ab={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],Vv(e=Array.isArray(e)?e:[e],t)),get:(e,t)=>Wv(e,t)}};Hp.AFFILIATION_CHANGES=fv,Hp.AFFILIATION_CHANGES_LIST=pv,Hp.MUC_TRAFFIC_STATES=mv,Hp.MUC_TRAFFIC_STATES_LIST=gv,Hp.MUC_ROLE_CHANGES=vv,Hp.MUC_ROLE_CHANGES_LIST=yv,Hp.MUC={INFO_CODES:bv},Hp.MUC_NICK_CHANGED_CODE=Sv,Hp.ROOM_FEATURES=wv,Hp.ROOMSTATUS=_v;const{Strophe:jb}=Hp.env;function $b(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Eb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){$b(s,r,i,o,a,"next",e)}function a(e){$b(s,r,i,o,a,"throw",e)}o(void 0)}))}}jb.addNamespace("MUC_ADMIN",jb.NS.MUC+"#admin"),jb.addNamespace("MUC_OWNER",jb.NS.MUC+"#owner"),jb.addNamespace("MUC_REGISTER","jabber:iq:register"),jb.addNamespace("MUC_ROOMCONF",jb.NS.MUC+"#roomconfig"),jb.addNamespace("MUC_USER",jb.NS.MUC+"#user"),jb.addNamespace("MUC_HATS","urn:xmpp:hats:0"),jb.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),Hp.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco"],initialize(){const{__:e,___:t}=Ao;if(Wu.settings.extend({allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!0,colorize_username:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[...Hp.MUC.INFO_CODES.visibility_changes,...Hp.MUC.INFO_CODES.self,...Hp.MUC.INFO_CODES.non_privacy_changes,...Hp.MUC.INFO_CODES.muc_logging_changes,...Hp.MUC.INFO_CODES.nickname_changes,...Hp.MUC.INFO_CODES.disconnected,...Hp.MUC.INFO_CODES.affiliation_changes,...Hp.MUC.INFO_CODES.join_leave_events,...Hp.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_subscribe_to_rai:!1}),Wu.promises.add(["roomsAutoJoined"]),Wu.settings.get("locked_muc_domain")&&"string"!=typeof Wu.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");Hp.env.muc_utils={computeAffiliationsDelta:Jv},Object.assign(Wu,Au),Object.assign(Wu.rooms,Ab);const n={muc:{STATUS_CODE_MESSAGES:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created"),210:t("Your nickname has been automatically set to %1$s"),301:e("You have been banned from this groupchat"),303:t("Your nickname has been changed to %1$s"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because it has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down"),333:e("You have exited this groupchat due to a technical problem")}}};Object.assign(Ao.labels,n),Object.assign(Ao,n),dy(),addEventListener("hashchange",dy);const r={ChatRoom:ky,ChatRoomMessage:Wg,ChatRoomMessages:Kg,ChatRoomOccupant:Dy,ChatRoomOccupants:Uy};Object.assign(Ao,r);const i={MUC:ky,MUCMessage:Wg,MUCMessages:Kg,MUCOccupant:Dy,MUCOccupants:Uy,getDefaultMUCNickname:fy,isInfoVisible:py,onDirectMUCInvitation:hy};Object.assign(Ao.exports,i),Object.assign(Ao,i),Wu.chatboxes.registry.add(uo,ky),Wu.settings.get("allow_muc_invitations")&&(Wu.listen.on("connected",cy),Wu.listen.on("reconnected",cy)),Wu.listen.on("addClientFeatures",(()=>Wu.disco.own.features.add(`${jb.NS.CONFINFO}+notify`))),Wu.listen.on("addClientFeatures",gy),Wu.listen.on("beforeResourceBinding",by),Wu.listen.on("beforeTearDown",vy),Wu.listen.on("chatBoxesFetched",my),Wu.listen.on("disconnected",ly),Wu.listen.on("statusInitialized",yy),document.addEventListener("visibilitychange",uy)}}),Object.assign(Up,{muc:{isChatRoom:function(e){return"chatroom"===(null==e?void 0:e.get("type"))},setAffiliation:Kv,getDefaultMUCService:function(){return ty((function*(){let e=Wu.settings.get("muc_domain")||Ao.session.get("default_muc_service");if(!e){const t=Ao.session.get("domain"),n=yield Wu.disco.entities.items(t);for(const t of n)if(yield Wu.disco.features.has(ry.NS.MUC,t.get("jid"))){e=t.get("jid"),Ao.session.save({default_muc_service:e});break}}return e}))()}}});const{Strophe:Ob,stx:Cb}=Hp.env;class kb extends ae.Collection{get idAttribute(){return"jid"}initialize(){return Eb((function*(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>Q.fatal(e))))),this.on("remove",this.leaveRoom,this),this.on("change:autojoin",this.onAutoJoinChanged,this),this.on("remove",((e,t)=>this.sendBookmarkStanza(t)),this);const{session:e}=Ao,t=`converse.room-bookmarks${e.get("bare_jid")}`;this.fetched_flag=t+"fetched",nl(this,t),yield this.fetchBookmarks(),Wu.trigger("bookmarksInitialized",this)})).call(this)}static checkBookmarksSupport(){return Eb((function*(){const e=Ao.session.get("bare_jid");if(!e)return!1;const t=yield Wu.disco.getIdentity("pubsub","pep",e);return Wu.settings.get("allow_public_bookmarks")?!!t:Wu.disco.supports(Ob.NS.PUBSUB+"#publish-options",e)}))()}openBookmarkedRoom(e){return Eb((function*(){if(Wu.settings.get("muc_respect_autojoin")&&e.get("autojoin")){(yield Wu.rooms.create(e.get("jid"),{nick:e.get("nick"),password:e.get("password")})).maybeShow()}return e}))()}fetchBookmarks(){const e=ue();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e}setBookmark(e,t=!0,n={}){if(!e.jid)return Q.warn("No JID provided for setBookmark");let r=!1,i=this.get(e.jid);if(i){const t=Object.keys(e).reduce(((t,n)=>{var r,s;return t||(null!==(r=e[n])&&void 0!==r?r:"")!==(null!==(s=i.attributes[n])&&void 0!==s?s:"")}),!1);t&&(i.save(e,n),r=!0)}else t&&(i=this.create(e,n),r=!0);r&&this.sendBookmarkStanza(i).catch((e=>this.onBookmarkError(e)))}getPublishedItems(e,t){if(e===Ob.NS.BOOKMARKS2){var n;const e=null!==(n=t.get("extensions"))&&void 0!==n?n:[];return Cb`<item id="${t.get("jid")}">
                        <conference xmlns="${Ob.NS.BOOKMARKS2}"
                                name="${t.get("name")||yf}"
                                autojoin="${t.get("autojoin")}">
                            ${t.get("nick")?Cb`<nick>${t.get("nick")}</nick>`:""}
                            ${t.get("password")?Cb`<password>${t.get("password")}</password>`:""}
                        ${e.length?Cb`<extensions>${e.map((e=>Ls.fromString(e)))}</extensions>`:""}
                        </conference>
                    </item>`}return Cb`<item id="current">
                <storage xmlns="${Ob.NS.BOOKMARKS}">
                ${this.map((e=>Cb`<conference name="${e.get("name")}" autojoin="${e.get("autojoin")}"
                        jid="${e.get("jid")}">
                        ${e.get("nick")?Cb`<nick>${e.get("nick")}</nick>`:""}
                        ${e.get("password")?Cb`<password>${e.get("password")}</password>`:""}
                    </conference>`))}
                </storage>
            </item>`}sendBookmarkStanza(e){return Eb((function*(){const t=Ao.session.get("bare_jid"),n=(yield Wu.disco.supports(`${Ob.NS.BOOKMARKS2}#compat`,t))?Ob.NS.BOOKMARKS2:Ob.NS.BOOKMARKS,r=yield Wu.disco.supports(`${Ob.NS.PUBSUB}#config-node-max`,t);return Wu.pubsub.publish(null,n,this.getPublishedItems(n,e),{persist_items:!0,max_items:r?"max":9999,send_last_published_item:"never",access_model:"whitelist"})})).call(this)}onBookmarkError(e){Q.error("Error while trying to add bookmark"),Q.error(e)}fetchBookmarksFromServer(e){return Eb((function*(){const t=Ao.session.get("bare_jid"),n=(yield Wu.disco.supports(`${Ob.NS.BOOKMARKS2}#compat`,t))?Ob.NS.BOOKMARKS2:Ob.NS.BOOKMARKS,r=Cb`
            <iq type="get" from="${Wu.connection.get().jid}" xmlns="jabber:client">
                <pubsub xmlns="${Ob.NS.PUBSUB}">
                    <items node="${n}"/>
                </pubsub>
            </iq>`;Wu.sendIQ(r).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))})).call(this)}markRoomAsBookmarked(e){const{chatboxes:t}=Ao.state,n=t.get(e.get("jid"));null==n||n.save("bookmarked",!0)}onAutoJoinChanged(e){e.get("autojoin")?this.openBookmarkedRoom(e):this.leaveRoom(e)}leaveRoom(e){return Eb((function*(){const t=yield Wu.rooms.get(e.get("jid"));null==t||t.close()}))()}setBookmarksFromStanza(e){return Eb((function*(){(yield Hg(e)).forEach((e=>{const t=this.get(e.jid);t?t.save(e):this.create(e)}))})).call(this)}onBookmarksReceived(e,t){return Eb((function*(){if(yield this.setBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,"true"),void 0!==e)return e.resolve()})).call(this)}onBookmarksReceivedError(e,t){return Eb((function*(){if(null===t){const{__:t}=Ao;Q.error("Error: timeout while fetching bookmarks"),Wu.alert("error",t("Timeout Error"),[t("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]),null==e||e.reject(new Error("Could not fetch bookmarks"))}else{const{errors:n}=Hp.env;(yield rm(t))instanceof n.ItemNotFoundError?(window.sessionStorage.setItem(this.fetched_flag,"true"),null==e||e.resolve()):(Q.error("Error while fetching bookmarks"),t&&Q.error(t),null==e||e.reject(new Error("Could not fetch bookmarks")))}})).call(this)}getUnopenedBookmarks(){return Eb((function*(){yield Wu.waitUntil("bookmarksInitialized"),yield Wu.waitUntil("chatBoxesFetched");const{chatboxes:e}=Ao.state;return this.filter((t=>!e.get(t.get("jid"))))})).call(this)}constructor(){super([],{comparator:e=>e.get("name").toLowerCase()}),this.model=Ug}}const Tb=kb;function Nb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Mb(){return(e=function*(){Wu.settings.get("allow_bookmarks")&&(yield Tb.checkBookmarksSupport())&&(Ao.state.bookmarks=new Ao.exports.Bookmarks,Object.assign(Ao,{bookmarks:Ao.state.bookmarks}))},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Nb(s,r,i,o,a,"next",e)}function a(e){Nb(s,r,i,o,a,"throw",e)}o(void 0)}))})();var e}function Ib(e){return Wu.waitUntil("bookmarksInitialized").then((()=>Ao.state.bookmarks.setBookmarksFromStanza(e))).catch((e=>Q.fatal(e))),!0}function Pb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Db(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Pb(s,r,i,o,a,"next",e)}function a(e){Pb(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{waitUntil:Rb}=Rl,zb={set(e){return Db((function*(e,t=!0,n={}){return(yield Rb("bookmarksInitialized")).setBookmark(e,t,n)})).apply(this,arguments)},get:e=>Db((function*(){return(yield Rb("bookmarksInitialized")).get(e)}))()},Lb={bookmarks:zb};function Ub(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Bb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Ub(s,r,i,o,a,"next",e)}function a(e){Ub(s,r,i,o,a,"throw",e)}o(void 0)}))}}function Fb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Strophe:qb}=Hp.env;qb.addNamespace("BOOKMARKS","storage:bookmarks"),qb.addNamespace("BOOKMARKS2","urn:xmpp:bookmarks:1"),Hp.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],initialize(){Wu.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),Wu.promises.add("bookmarksInitialized"),Object.assign(Wu,Lb);const e={Bookmark:Ug,Bookmarks:Tb};Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.listen.on("getNicknameForMUC",((e,t)=>{return t||(n=e.get("jid"),Wu.settings.get("allow_bookmarks")?null===(i=Ao.state.bookmarks)||void 0===i||null===(r=i.get(n))||void 0===r?void 0:r.get("nick"):null);var n,r,i})),Wu.listen.on("parseMUCPresence",((e,t)=>(t.is_self&&t.codes.includes("303")&&Wu.bookmarks.get(t.muc_jid).then((e=>{e||Q.warn("parseMUCPresence: no bookmark returned");const{nick:n,muc_jid:r}=t;var i,s,o,a;Wu.bookmarks.set({jid:r,nick:n,autojoin:null===(i=null==e?void 0:e.get("autojoin"))||void 0===i||i,password:null!==(s=null==e?void 0:e.get("password"))&&void 0!==s?s:"",name:null!==(o=null==e?void 0:e.get("name"))&&void 0!==o?o:"",extensions:null!==(a=null==e?void 0:e.get("extensions"))&&void 0!==a?a:[]})})),t))),Wu.listen.on("enteredNewRoom",(({attributes:e})=>Bb((function*(){const{jid:t,nick:n,password:r,name:i}=e;yield Wu.bookmarks.set(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Fb(e,t,n[t])}))}return e}({jid:t,autojoin:!0,nick:n},r?{password:r}:{},i?{name:i}:{}))}))())),Wu.listen.on("leaveRoom",(({attributes:e})=>Bb((function*(){const{jid:t}=e;yield Wu.bookmarks.set({jid:t,autojoin:!1},!1,{silent:!0})}))())),Wu.listen.on("addClientFeatures",(()=>{Wu.settings.get("allow_bookmarks")&&Wu.disco.own.features.add(qb.NS.BOOKMARKS+"+notify")})),Wu.listen.on("clearSession",(()=>{const{state:e}=Ao;e.bookmarks&&(e.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(e.bookmarks.fetched_flag),delete e.bookmarks)})),Wu.listen.on("connected",(()=>Bb((function*(){const e=Ao.session.get("bare_jid"),t=Wu.connection.get();t.addHandler(Ib,qb.NS.BOOKMARKS,"message","headline",null,e),t.addHandler(Ib,qb.NS.BOOKMARKS2,"message","headline",null,e),yield Promise.all([Wu.waitUntil("chatBoxesFetched")]),Mb()}))()))}});const{Strophe:Hb}=Hp.env;class Gb extends ae.Model{get idAttribute(){return"jid"}getDisplayName(){return Hb.xmlunescape(this.get("name"))}}const Wb=Gb;function Vb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Kb(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Vb(s,r,i,o,a,"next",e)}function a(e){Vb(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{stx:Jb,u:Yb}=Hp.env;class Xb extends ae.Collection{get idAttribute(){return"jid"}initialize(){return Kb((function*(){const{session:e}=Ao,t=`converse.blocklist-${e.get("bare_jid")}`;this.fetched_flag=`${t}-fetched`,nl(this,t),this.on("add",this.rejectContactRequest),yield this.fetchBlocklist(),Wu.trigger("blocklistInitialized",this)})).call(this)}rejectContactRequest(e){return Kb((function*(){const t=(yield Wu.waitUntil("rosterContactsFetched")).get(e.get("jid"));if(null==t?void 0:t.get("requesting")){const e=yield Wu.chats.get(t.get("jid"));null==e||e.close(),t.unauthorize().destroy()}}))()}fetchBlocklist(){const e=ue();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBlocklistFromServer(e),e}fetchBlocklistFromServer(e){return Kb((function*(){const t=Jb`<iq xmlns="jabber:client"
            type="get"
            id="${Yb.getUniqueId()}"><blocklist xmlns="urn:xmpp:blocking"/></iq>`;try{this.onBlocklistReceived(e,yield Wu.sendIQ(t))}catch(t){return Q.error(t),void e.resolve()}})).call(this)}onBlocklistReceived(e,t){return Kb((function*(){if(Array.from(t.querySelectorAll("blocklist item")).forEach((e=>{const t=e.getAttribute("jid"),n=this.get(t);n?n.save({jid:t}):this.create({jid:t})})),window.sessionStorage.setItem(this.fetched_flag,"true"),void 0!==e)return e.resolve()})).call(this)}constructor(){super(),this.model=Wb}}const Qb=Xb;function Zb(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function e_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Zb(s,r,i,o,a,"next",e)}function a(e){Zb(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:t_,stx:n_,u:r_}=Hp.env;function i_(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function s_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){i_(s,r,i,o,a,"next",e)}function a(e){i_(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{waitUntil:o_}=Rl,a_={blocklist:{get:()=>s_((function*(){return yield o_("blocklistInitialized")}))(),add:(e,t=!0)=>s_((function*(){const n=yield o_("blocklistInitialized"),r=Array.isArray(e)?e:[e];return t&&(yield function(e){return e_((function*(){const t=Array.isArray(e)?e:[e],n=n_`
        <iq xmlns="jabber:client" type="set" id="${r_.getUniqueId()}">
            <block xmlns="${t_.NS.BLOCKING}">
                ${t.map((e=>n_`<item jid="${e}"/>`))}
            </block>
        </iq>`;yield uu.sendIQ(n)}))()}(r)),r.forEach((e=>n.create({jid:e}))),n}))(),remove:(e,t=!0)=>s_((function*(){const n=yield o_("blocklistInitialized"),r=Array.isArray(e)?e:[e];return t&&(yield function(e){return e_((function*(){const t=Array.isArray(e)?e:[e],n=n_`
        <iq xmlns="jabber:client" type="set" id="${r_.getUniqueId()}">
            <unblock xmlns="${t_.NS.BLOCKING}">
                ${t.map((e=>n_`<item jid="${e}"/>`))}
            </unblock>
        </iq>`;yield uu.sendIQ(n)}))()}(r)),r.forEach((e=>{var t;return null===(t=n.get(e))||void 0===t?void 0:t.destroy()})),n.remove(r),n}))()}};class c_ extends ae.Model{initialize(){super.initialize(),this.set({text:"",type:"items",state:"online"})}}function l_(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function u_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){l_(s,r,i,o,a,"next",e)}function a(e){l_(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{$pres:d_}=Hp.env;function h_(e){const t=Ao.state.roster,n=null==t?void 0:t.get(e.get("jid"));null==n||n.save({num_unread:e.get("num_unread")})}let f_;function p_(){if(f_){Wu.connection.get().deleteHandler(f_),f_=null}}function m_(){return u_((function*(){var e;yield null===(e=Ao.state.presences)||void 0===e?void 0:e.clearStore()}))()}function g_(){return u_((function*(){if(yield m_(),oi(Ao)){const t=Ao.state.roster;var e;if(t)null===(e=t.data)||void 0===e||e.destroy(),yield t.clearStore(),delete Ao.state.roster,Object.assign(Ao,{roster:void 0})}}))()}function v_(e){e?Wu.trigger("rosterReadyAfterReconnection"):function(){const e=new Ao.exports.RosterContacts;Object.assign(Ao,{roster:e}),Object.assign(Ao.state,{roster:e});const t=Ao.session.get("bare_jid");let n=`converse.contacts-${t}`;nl(e,n);const r=new c_;Object.assign(Ao,{roster_filter:r}),Object.assign(Ao.state,{roster_filter:r}),r.id=`_converse.rosterfilter-${t}`,nl(r,r.id),r.fetch(),n=`converse-roster-model-${t}`,e.data=new ae.Model,e.data.id=n,nl(e.data,n),e.data.fetch(),Wu.trigger("rosterInitialized",e)}();Ao.state.roster.onConnected(),function(){p_();const e=Wu.connection.get();f_=e.addHandler((e=>(Ao.state.roster.presenceHandler(e),!0)),null,"presence",null)}(),function(e=!1){u_((function*(){const t=Wu.connection.get();e&&(t.send_initial_presence=!0);const n=Ao.state.roster;try{yield n.fetchRosterContacts(),Wu.trigger("rosterContactsFetched",n)}catch(e){Q.error(e)}finally{t.send_initial_presence&&(Wu.user.presence.send(),Ao.state.profile.save({presence:"online"}))}}))()}(!Wu.connection.get().restored)}function y_(e){return u_((function*(){if(e)!Wu.connection.get().hasResumed()&&(yield m_());else{const e=new Ao.exports.Presences;Object.assign(Ao,{presences:e}),Object.assign(Ao.state,{presences:e});const t=Ao.session.get("bare_jid");nl(e,`converse.presences-${t}`,"session"),yield new Promise((t=>e.fetch({success:t,error:t})))}Wu.trigger("presencesInitialized",e)}))()}function b_(){const{chatboxes:e}=Ao.state;e.on("change:num_unread",h_),e.on("add",(e=>{e.get("type")===lo&&e.setModelContact(e.get("jid"))}))}function __(){Ao.state.roster.on("add",(e=>{const t=Ao.state.chatboxes.findWhere({jid:e.get("jid")});null==t||t.setModelContact(e.get("jid"))}))}function w_(e,t){const n=d_({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),Wu.send(n)}function S_(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function x_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){S_(s,r,i,o,a,"next",e)}function a(e){S_(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:A_,sizzle:j_}=Hp.env;A_.addNamespace("BLOCKING","urn:xmpp:blocking"),Hp.plugins.add("converse-blocklist",{dependencies:["converse-disco"],initialize(){const e={Blocklist:Qb,BlockedEntity:Wb};Object.assign(Ao.exports,e),Object.assign(Wu,a_),Wu.promises.add(["blocklistInitialized"]),Wu.listen.on("cachedRoster",(e=>x_((function*(){const t=Ao.session.get("domain");if(yield Wu.disco.supports(A_.NS.BLOCKING,t)){const t=yield Wu.blocklist.get(),n=e.filter((e=>e.get("requesting")));n.forEach((e=>x_((function*(){t.get(e.get("jid"))&&(w_(e.get("jid")),e.destroy())}))()))}}))())),Wu.listen.on("getErrorAttributesForMessage",((e,t)=>{if(e.errors.find((e=>"blocked"===e.name&&e.xmlns===`${A_.NS.BLOCKING}:errors`))){const{__:e}=Ao;t.error=e("You are blocked from sending messages.")}return t})),Wu.listen.on("connected",(()=>{Wu.connection.get().addHandler((e=>{const t=Ao.session.get("bare_jid"),n=e.getAttribute("from");if(A_.getBareJidFromJid(null!=n?n:t)!=t)return Q.warn(`Received a blocklist push stanza from a suspicious JID ${n}`),!0;const r=j_(`block[xmlns="${A_.NS.BLOCKING}"] item`,e).map((e=>e.getAttribute("jid")));r.length&&Wu.blocklist.add(r,!1);const i=j_(`unblock[xmlns="${A_.NS.BLOCKING}"] item`,e).map((e=>e.getAttribute("jid")));return i.length&&Wu.blocklist.remove(i,!1),!0}),A_.NS.BLOCKING,"iq","set")})),Wu.listen.on("clearSession",(()=>{const{state:e}=Ao;e.blocklist&&(e.blocklist.clearStore({silent:!0}),window.sessionStorage.removeItem(e.blocklist.fetched_flag),delete e.blocklist)})),Wu.listen.on("discoInitialized",(()=>x_((function*(){const e=Ao.session.get("domain");(yield Wu.disco.supports(A_.NS.BLOCKING,e))&&(Ao.state.blocklist=new Ao.exports.Blocklist)}))()))}});const $_={tokens:{get(e){const t=Wu.connection.get();return t?"rid"===e.toLowerCase()?t.rid||t._proto.rid:"sid"===e.toLowerCase()?t.sid||t._proto.sid:void 0:null}}};function E_(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function O_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){E_(s,r,i,o,a,"next",e)}function a(e){E_(s,r,i,o,a,"throw",e)}o(void 0)}))}}function C_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C_(e,t,n[t])}))}return e}function T_(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const N_="converse.bosh-session";let M_;function I_(e,t){return O_((function*(){if(t.success)return t;const{automatic:e}=t;return(yield O_((function*(){const e=(yield O_((function*(){const e=N_;M_||(M_=new ae.Model({id:e}),M_.browserStorage=tl(e,"session"),yield new Promise((e=>M_.fetch({success:e,error:e}))));let t=Ao.session.get("jid");if(t)M_.get("jid")!==t&&(t=yield vl(t),M_.clear({silent:!0}),M_.save({jid:t}));else{const e=M_.get("jid");e&&(yield vl(e))}return M_}))()).get("jid"),t=Wu.connection.get();if(e&&t._proto instanceof Bs.Bosh)try{return t.restore(e,t.onConnectStatusChanged),!0}catch(t){return!ri()&&Q.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1}))())?T_(k_({},t),{success:!0}):Wu.settings.get("authentication")!==to||e&&!Wu.settings.get("auto_login")?t:(function(){if(!Wu.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=Wu.connection.get(),t=new XMLHttpRequest;t.open("GET",Wu.settings.get("prebind_url"),!0),t.setRequestHeader("Accept","application/json, text/javascript"),t.onload=function(n){return O_((function*(){if(t.status>=200&&t.status<400){const n=JSON.parse(t.responseText),r=yield vl(n.jid);e.attach(r,n.sid,n.rid,e.onConnectStatusChanged,qs)}else t.onerror(n)}))()},t.onerror=function(){Wu.connection.destroy(),Wu.trigger("noResumeableBOSHSession",Ao)},t.send()}(),T_(k_({},t),{success:!0}))}))()}function P_(){void 0!==M_&&M_.save({jid:Ao.session.get("jid")})}function D_(){if(void 0===M_){const e=N_;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else M_.destroy(),M_=void 0}function R_(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function z_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){R_(s,r,i,o,a,"next",e)}function a(e){R_(s,r,i,o,a,"throw",e)}o(void 0)}))}}Hp.plugins.add("converse-bosh",{enabled:()=>!Ao.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){Wu.settings.extend({bosh_service_url:void 0,prebind_url:null}),Object.assign(Wu,$_),Wu.listen.on("clearSession",D_),Wu.listen.on("setUserJID",P_),Wu.listen.on("login",I_),Wu.listen.on("addClientFeatures",(()=>Wu.disco.own.features.add(Bs.NS.BOSH)))}});const{Strophe:L_,stx:U_}=Hp.env;function B_(e,t){return e.sort(((e,n)=>e[t]>n[t]?-1:1))}function F_(e){return z_((function*(){const t=U_`<c
        xmlns="${L_.NS.CAPS}"
        hash="sha-1"
        node="https://conversejs.org"
        ver="${yield z_((function*(){const e=Ao.api.disco.own.identities.get(),t=Ao.api.disco.own.features.get();e.length>1&&(B_(e,"category"),B_(e,"type"),B_(e,"lang"));let n=e.reduce(((e,t)=>{var n;return`${e}${t.category}/${t.type}/${null!==(n=null==t?void 0:t.lang)&&void 0!==n?n:""}/${t.name}<`}),"");return t.sort(),n=t.reduce(((e,t)=>`${e}${t}<`),n),Jf(yield crypto.subtle.digest("SHA-1",Kf(n)))}))()}"></c>`;return e.root().cnode(t).up(),e}))()}const{Strophe:q_}=Hp.env;q_.addNamespace("CAPS","http://jabber.org/protocol/caps"),Hp.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){Wu.listen.on("constructedPresence",((e,t)=>F_(t))),Wu.listen.on("constructedMUCPresence",((e,t)=>F_(t)))}});class H_ extends ae.Collection{onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),Wu.trigger("chatBoxesFetched")}onConnected(e){if(e)return;nl(this,`converse.chatboxes-${Ao.session.get("bare_jid")}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)})}createModel(e,t){if(!e.type)throw new Error("You need to specify a type of chatbox to be created");return new(Wu.chatboxes.registry.get(e.type))(e,t)}constructor(e,t){super(e,Object.assign({comparator:"time_opened"},t))}}const G_=H_,{Strophe:W_}=Hp.env;function V_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K_(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}Hp.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){let e;Wu.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(Wu,{chatboxes:bu}),Object.assign(Ao,{ChatBoxes:G_}),Object.assign(Ao.exports,{ChatBoxes:G_}),Wu.listen.on("addClientFeatures",(()=>{Wu.disco.own.features.add(W_.NS.MESSAGE_CORRECT),Wu.disco.own.features.add(W_.NS.HTTPUPLOAD),Wu.disco.own.features.add(W_.NS.OUTOFBAND)})),Wu.listen.on("pluginsInitialized",(()=>{e=new Ao.exports.ChatBoxes,Object.assign(Ao,{chatboxes:e}),Object.assign(Ao.state,{chatboxes:e}),Wu.trigger("chatBoxesInitialized")})),Wu.listen.on("presencesInitialized",(t=>e.onConnected(t))),Wu.listen.on("reconnected",(()=>e.forEach((e=>e.onReconnection())))),Wu.listen.on("clearSession",fu),Wu.listen.on("chatBoxClosed",(()=>{var e;ni()&&(null===(e=Ao.state.chatboxes.find((e=>e.get("jid"))))||void 0===e||e.maybeShow())}))}});const{Strophe:J_,u:Y_}=Hp.env;function X_(e){var t;const n=ee()(`command[xmlns="${J_.NS.ADHOC}"]`,e).pop(),r=n.querySelector("note");var i;return K_(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){V_(e,t,n[t])}))}return e}({},xm(e)),{sessionid:n.getAttribute("sessionid"),note:r?{text:r.textContent,type:r.getAttribute("type")}:null,actions:Array.from(null!==(i=null===(t=n.querySelector("actions"))||void 0===t?void 0:t.children)&&void 0!==i?i:[]).map((e=>e.nodeName.toLowerCase()))})}function Q_(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Z_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Q_(s,r,i,o,a,"next",e)}function a(e){Q_(s,r,i,o,a,"throw",e)}o(void 0)}))}}function ew(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tw(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{Strophe:nw,$iq:rw,u:iw,stx:sw}=Hp.env,ow={adhoc:{getCommands:e=>Z_((function*(){try{return t=yield Wu.disco.items(e,nw.NS.ADHOC),ee()(`query[xmlns="${J_.NS.DISCO_ITEMS}"][node="${J_.NS.ADHOC}"] item`,t).map(Y_.getAttributes)}catch(t){return null===t?Q.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(Q.error(`Error while fetching ad-hoc commands for ${e}`),Q.error(t)),[]}var t}))(),fetchCommandForm:(e,t)=>Z_((function*(){const n=rw({type:"set",to:e}).c("command",{xmlns:nw.NS.ADHOC,action:"execute",node:t});return X_(yield Wu.sendIQ(n))}))(),runCommand:(e,t,n,r,i)=>Z_((function*(){var s;const o=sw`<iq type="set" to="${e}" xmlns="jabber:client">
                    <command sessionid="${t}" node="${n}" action="${r}" xmlns="${nw.NS.ADHOC}">
                        ${["cancel","prev"].includes(r)?"":sw`
                            <x xmlns="${nw.NS.XFORM}" type="submit">
                                ${i.map((({name:e,value:t})=>sw`<field var="${e}"><value>${t}</value></field>`))}
                            </x>`}
                    </command>
                </iq>`,a=yield Wu.sendIQ(o,null,!1);if(null===a){Q.warn("A timeout occurred while trying to run an ad-hoc command");const{__:e}=Ao;return{status:"error",note:e("A timeout occurred")}}iw.isErrorStanza(a)&&(Q.error("Error while trying to execute an ad-hoc command"),Q.error(a));const c=a.querySelector("command"),l=null==c?void 0:c.getAttribute("status");return tw(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ew(e,t,n[t])}))}return e}({status:l},"executing"===l?X_(a):{}),{note:null===(s=a.querySelector("note"))||void 0===s?void 0:s.textContent})}))()}},{Strophe:aw}=Hp.env;function cw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}aw.addNamespace("ADHOC","http://jabber.org/protocol/commands"),Hp.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){Object.assign(this._converse.api,ow)}});class lw extends Zv{defaults(){return{bookmarked:!1,hidden:ni()&&!Wu.settings.get("singleton"),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:void 0,type:ho}}initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){yield n().call(t),yield this.fetchMessages(),Wu.trigger("headlinesFeedInitialized",this)},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){cw(s,r,i,o,a,"next",e)}function a(e){cw(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}canPostMessages(){return!1}isChatMessage(e){const t=e.get("type");return t===this.get("message_type")||"normal"===t}constructor(e,t){super(e,t),this.disable_mam=!0}}function uw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function dw(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){uw(s,r,i,o,a,"next",e)}function a(e){uw(s,r,i,o,a,"throw",e)}o(void 0)}))}}const hw={headlines:{get(e){return dw((function*(e,t={},n=!1){function r(e){return dw((function*(){let r=yield Wu.chatboxes.get(e);if(!r&&n){const{HeadlinesFeed:n}=Ao.exports;r=yield Wu.chatboxes.create(e,t,n)}else r=r&&r.get("type")===ho?r:null,r&&Object.keys(t).length&&r.save(t);return r}))()}if(void 0===e){return(yield Wu.chatboxes.get()).filter((e=>e.get("type")===ho))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))})).apply(this,arguments)}}};function fw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function pw(e){return(t=function*(){if(ym(e)||bm(e)){const t=e.getAttribute("from");if(yield Wu.waitUntil("rosterInitialized"),t.includes("@")&&!Ao.state.roster.get(t)&&!Wu.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const n=yield Wu.chatboxes.create(t,{id:t,jid:t,type:ho,from:t},lw),r=yield eg(e);yield n.createMessage(r),Wu.trigger("message",{chatbox:n,stanza:e,attrs:r})}},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){fw(s,r,i,o,a,"next",e)}function a(e){fw(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function mw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Hp.plugins.add("converse-headlines",{dependencies:["converse-chat"],initialize(){const e={HeadlinesFeed:lw};function t(){var e;null===(e=Wu.connection.get())||void 0===e||e.addHandler((e=>(pw(e),!0)),null,"message")}Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.listen.on("connected",t),Wu.listen.on("reconnected",t),Object.assign(Wu,hw),Wu.chatboxes.registry.add(ho,lw)}});class gw extends ae.Model{defaults(){return{msgid:Lp(),is_ephemeral:!1}}fetchMissingMessages(){return(e=function*(){var e;this.set("fetching",!0);const t={rsm:{before:null!==(e=this.get("before"))&&void 0!==e?e:""},mam:{start:this.get("start")}};yield Up.mam.fetchArchivedMessages(this.collection.chatbox,t),this.destroy()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){mw(s,r,i,o,a,"next",e)}function a(e){mw(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}}function vw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function yw(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){vw(s,r,i,o,a,"next",e)}function a(e){vw(s,r,i,o,a,"throw",e)}o(void 0)}))}}function bw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){bw(e,t,n[t])}))}return e}const{NS:ww}=Bs,Sw=Hp.env.utils;function xw(e,t){return yw((function*(){if(Sw.isElement(e)){const n=yield rm(e);if("feature-not-implemented"===(null==n?void 0:n.name))return void Q.warn(`Message Archive Management (XEP-0313) not supported by ${t.getAttribute("to")}`)}Q.error(`Error while trying to set archiving preferences for ${t.getAttribute("to")}.`),Q.error(t)}))()}function Aw(e,t){const n=ee()(`prefs[xmlns="${ww.MAM}"]`,e).pop();if(n.getAttribute("default")!==Wu.settings.get("message_archiving")){const e=ss({type:"set"}).c("prefs",{xmlns:ww.MAM,default:Wu.settings.get("message_archiving")});Array.from(n.children).forEach((t=>e.cnode(t).up())),Wu.sendIQ(e).then((()=>t.save({preferences:{default:Wu.settings.get("message_archiving")}}))).catch((t=>Ao.exports.onMAMError(t,e.tree())))}else t.save({preferences:{default:Wu.settings.get("message_archiving")}})}function jw(e){const t=e.get("preferences")||{};if(e.get("var")===ww.MAM&&void 0!==Wu.settings.get("message_archiving")&&t.default!==Wu.settings.get("message_archiving")){const t=ss({type:"get"}).c("prefs",{xmlns:ww.MAM});Wu.sendIQ(t).then((t=>Ao.exports.onMAMPreferences(t,e))).catch((e=>Ao.exports.onMAMError(e,t.tree())))}}function $w(e){Wu.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(Cw(e),e.save({prejoin_mam_fetched:!0}))}function Ew(e,t,n,r,i=!1){return yw((function*(){const s=e.get("type")===uo,o=yield Promise.all(t.messages.map((t=>s?Rv(t,e):eg(t))));t.messages=o;const a={query:n,chatbox:e,messages:o};if(yield Wu.trigger("MAMResult",a,{synchronous:!0}),o.forEach((t=>e.queueMessage(t))),t.error){const n=t.error.retry_event_id=Sw.getUniqueId();Wu.listen.once(n,(()=>Ow(e,r,i))),function(e,t){yw((function*(){t instanceof Ll&&((yield e.createMessage({type:"error",message:t.message,retry_event_id:t.retry_event_id,is_ephemeral:2e4})).error=t)}))()}(e,t.error)}}))()}function Ow(e){return yw((function*(e,t={},n=!1){if(e.disable_mam)return;const r=e.get("type")===uo,i=Ao.session.get("bare_jid"),s=r?e.get("jid"):i;if(!(yield Wu.disco.supports(ww.MAM,s)))return;const o=Wu.settings.get("archived_messages_page_size"),a={is_groupchat:r,rsm:_w({max:o},t.rsm),mam:_w({with:e.get("jid")},t.mam)},c=yield Wu.archive.query(a);if(yield Ew(e,c,a,t,n),c.rsm&&!c.complete){if(n)return"forwards"===n?t=c.rsm.next(o,t.rsm.before).query:"backwards"===n&&(t=c.rsm.previous(o,t.rsm.after).query),Ow(e,t,n);!function(e,t,n){yw((function*(){var r;const i=yield Promise.all(n.messages),s=e.get("type")===uo?e.get("jid"):Ao.session.get("bare_jid"),{rsm:o}=n,a=`stanza_id ${s}`,c=i.find((e=>e[a]===o.result.first)),l=new Date(c.time),u={before:o.result.first,start:null===(r=t.mam)||void 0===r?void 0:r.start,template_hook:"getMessageTemplate",time:new Date(l.getTime()-1).toISOString()};e.messages.findWhere(u)?Q.debug("Gap placeholder already exists, not recreating."):e.messages.add(new gw(u))}))()}(e,t,c)}})).apply(this,arguments)}function Cw(e){if(e.disable_mam)return;const t=e.getMostRecentMessage(),n=!!Wu.settings.get("mam_request_all_pages")&&"backwards";return Ow(e,t?{mam:{start:t.get("time")},rsm:{before:""}}:{rsm:{before:""}},n)}const{Strophe:kw,$build:Tw}=Hp.env;kw.addNamespace("RSM","http://jabber.org/protocol/rsm");const Nw=["after","before","index","max"],Mw=e=>Number(e),Iw=e=>e.toString(),Pw={after:Iw,before:Iw,count:Mw,first:Iw,index:Mw,last:Iw,max:Mw},Dw=Object.keys(Pw);class Rw{static getQueryParameters(e={}){return Nw.reduce(((t,n)=>(void 0!==e[n]&&(t[n]=e[n]),t)),{})}static parseXMLResult(e){const t={};for(var n=0;n<Dw.length;n++){const r=Dw[n],i=e.getElementsByTagName(r)[0];Vr(i)||null===i||(t[r]=Pw[r](kw.getText(i)),"first"==r&&(t.index=Pw.index(i.getAttribute("index"))))}return t}toXML(){const e=Tw("set",{xmlns:kw.NS.RSM});return Nw.reduce(((e,t)=>Vr(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}toString(){return kw.serialize(this.toXML())}next(e,t){const n=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new Rw(n)}previous(e,t){const n=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new Rw(n)}constructor(e={}){this.query=Rw.getQueryParameters(e),this.result=e.xml?Rw.parseXMLResult(e.xml):{}}}function zw(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Lw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Uw(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{NS:Bw}=Bs,{stx:Fw,u:qw}=Hp.env,Hw={archive:{query(){return(e=function*(e={}){var t;if(!Wu.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");let n;if(e&&e.is_groupchat){var r;if(!(null===(r=e.mam)||void 0===r?void 0:r.with))throw new Error('You need to specify a "with" value containing the groupchat JID, when querying groupchat messages.');n=e.mam.with}const i=!e.is_groupchat&&(null===(t=e.mam)||void 0===t?void 0:t.with)||null,s=Ao.session.get("bare_jid"),o=n||s;if(!(yield Wu.disco.supports(Bw.MAM,o)))return Q.warn(`Did not fetch MAM archive for ${o} because it doesn't support ${Bw.MAM}`),{messages:[]};const{start:a,end:c}=["start","end"].reduce(((t,n)=>{var r;if(null===(r=e.mam)||void 0===r?void 0:r[n]){const r=W()(e.mam[n]);if(!r.isValid())throw new TypeError(`archive.query: invalid date provided for: ${n}`);t[n]=r.toISOString()}return t}),{start:null,end:null}),l=Wu.connection.get(),u=e.rsm?new Rw(e.rsm):{},d=qw.getUniqueId();var h;const f=Fw`
                <iq id="${qw.getUniqueId()}"
                        ${n?Ls.unsafeXML(`to="${Bs.xmlescape(n)}"`):""}
                        type="set"
                        xmlns="jabber:client">
                    <query queryid="${d}" xmlns="${Bw.MAM}">
                        ${i||a||c?Fw`
                            <x type="submit" xmlns="${Bw.XFORM}">
                                <field type="hidden" var="FORM_TYPE"><value>${Bw.MAM}</value></field>
                                ${i?Fw`<field var="with"><value>${i}</value></field>`:""}
                                ${a?Fw`<field var="start"><value>${a}</value></field>`:""}
                                ${c?Fw`<field var="end"><value>${c}</value></field>`:""}
                            </x>`:""}
                        ${Object.keys(null!==(h=u.query)&&void 0!==h?h:{}).length?Ls.fromString(u.toString()):""}
                    </query>
                </iq>`,p=[],m=l.addHandler((t=>{const n=ee()(`message > result[xmlns="${Bw.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==d)return!0;const r=t.getAttribute("from")||s;var i;if(e.is_groupchat){if(r!==(null===(i=e.mam)||void 0===i?void 0:i.with))return Q.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(r!==s)return Q.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return p.push(t),!0}),Bw.MAM);let g;const v=Wu.settings.get("message_archiving_timeout"),y=yield Wu.sendIQ(f,v,!1);if(null===y){const{__:e}=Ao,t=e("Timeout while trying to fetch archived messages.");return Q.error(t),g=new Ll(t),{messages:p,error:g}}if(qw.isErrorStanza(y)){const{__:e}=Ao,t=e("An error occurred while querying for archived messages.");return Q.error(t),Q.error(y),g=new Error(t),{messages:p,error:g}}let b;l.deleteHandler(m);const _=y&&ee()(`fin[xmlns="${Bw.MAM}"]`,y).pop(),w="true"===(null==_?void 0:_.getAttribute("complete")),S=ee()(`set[xmlns="${Bw.RSM}"]`,_).pop();return S&&(b=new Rw(Uw(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Lw(e,t,n[t])}))}return e}({},e.rsm),{xml:S}))),{messages:p,rsm:b,complete:w}},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){zw(s,r,i,o,a,"next",e)}function a(e){zw(s,r,i,o,a,"throw",e)}o(void 0)}))}).apply(this,arguments);var e}}},{NS:Gw}=Bs;Hp.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){Wu.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!1,message_archiving:void 0,message_archiving_timeout:6e4}),Object.assign(Wu,Hw);const e={onMAMError:xw,onMAMPreferences:Aw,handleMAMResult:Ew,MAMPlaceholderMessage:gw};Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.listen.on("addClientFeatures",(()=>Wu.disco.own.features.add(Gw.MAM))),Wu.listen.on("serviceDiscovered",jw),Wu.listen.on("chatRoomViewInitialized",(({model:e})=>{Wu.settings.get("muc_show_logs_before_join")&&($w(e),e.features.on("change:mam_enabled",(()=>$w(e))))})),Wu.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&Cw(e))),Wu.listen.on("chatReconnected",(e=>{[uo,lo].includes(e.get("type"))&&Cw(e)})),Wu.listen.on("afterMessagesFetched",(e=>{e.get("type")===lo&&Cw(e),function(e){if(e.messages.length){const t=`stanza_id ${e.get("type")===uo?e.get("jid"):Ao.session.get("bare_jid")}`,n=e.getOldestMessage();if(!n)return;const r={before:n.get(t),template_hook:"getMessageTemplate",time:new Date(new Date(n.get("time")).getTime()-1).toISOString()};if(e.messages.findWhere(r))return void Q.debug("Gap placeholder already exists, not recreating.");e.messages.add(new gw(r))}}(e)}))}}),Object.assign(Up,{mam:{fetchArchivedMessages:Ow}});const{Strophe:Ww,$iq:Vw}=Hp.env;let Kw,Jw;function Yw(){document.hidden||Wu.ping(null,5e3)}function Xw(e){Kw=new Date;const t=e.getAttribute("from"),n=e.getAttribute("id"),r=Vw({type:"result",to:t,id:n});return Wu.sendIQ(r),!0}function Qw(){var e;!function(){const e=Wu.connection.get();e.disco&&Wu.disco.own.features.add(Ww.NS.PING),e.addHandler(Xw,Ww.NS.PING,"iq","get")}(),null===(e=Wu.connection.get())||void 0===e||e.addHandler((()=>{if(Wu.settings.get("ping_interval")>0)return Kw=new Date,!0})),clearInterval(Jw),Jw=setInterval(eS,1e3)}function Zw(){clearInterval(Jw)}function eS(){if(ri()||!Wu.connection.authenticated())return;const e=Wu.settings.get("ping_interval");if(e>0){const t=new Date;Kw=null!=Kw?Kw:t,(t.valueOf()-Kw.valueOf())/1e3>e&&Wu.ping()}}function tS(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:nS,$iq:rS,u:iS}=Hp.env,sS={ping(e,t){return(n=function*(){if(!Wu.connection.authenticated())return Q.debug("Not pinging when we know we're not authenticated"),null;var n;n=new Date,Kw=n;const r=Ao.session.get("bare_jid");e=e||nS.getDomainFromJid(r);const i=rS({type:"get",to:e,id:iS.getUniqueId("ping")}).c("ping",{xmlns:nS.NS.PING}),s=yield Wu.sendIQ(i,t||1e4,!1);return null===s?(Q.warn(`Timeout while pinging ${e}`),e===nS.getDomainFromJid(r)&&Wu.connection.reconnect(),!1):!iS.isErrorStanza(s)||(Q.error(`Error while pinging ${e}`),Q.error(s),!1)},function(){var e=this,t=arguments;return new Promise((function(r,i){var s=n.apply(e,t);function o(e){tS(s,r,i,o,a,"next",e)}function a(e){tS(s,r,i,o,a,"throw",e)}o(void 0)}))})();var n}},{Strophe:oS}=Hp.env;function aS(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function cS(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){aS(s,r,i,o,a,"next",e)}function a(e){aS(s,r,i,o,a,"throw",e)}o(void 0)}))}}function lS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}oS.addNamespace("PING","urn:xmpp:ping"),Hp.plugins.add("converse-ping",{initialize(){Wu.settings.extend({ping_interval:60}),Object.assign(Wu,sS),Wu.listen.on("connected",Qw),Wu.listen.on("reconnected",Qw),Wu.listen.on("disconnected",Zw),document.addEventListener("visibilitychange",Yw)}});const{Strophe:uS,stx:dS}=Hp.env,hS={pubsub:{config:{get:(e,t)=>cS((function*(){if(!t)throw new Error("api.pubsub.config.get: Node value required");const n=Ao.session.get("bare_jid"),r=Ao.session.get("jid"),i=dS`
                    <iq xmlns="jabber:client"
                        from="${r}"
                        type="get"
                        to="${e||n}">
                    <pubsub xmlns="${uS.NS.PUBSUB}"><configure node="${t}"/></pubsub>
                    </iq>`;let s;try{s=yield Wu.sendIQ(i)}catch(e){throw yield rm(e)}return xm(s).fields.reduce(((e,t)=>{if(t.var.startsWith("pubsub#")){const r=t.var.replace(/^pubsub#/,"");var n;const i="boolean"===t.type?t.checked:null!==(n=t.value)&&void 0!==n?n:null;e[r]=i}return e}),{})}))(),set:(e,t,n)=>cS((function*(){if(!t)throw new Error("api.pubsub.config.set: Node value required");const r=Ao.session.get("bare_jid"),i=e||r,s=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){lS(e,t,n[t])}))}return e}({},yield Wu.pubsub.config.get(i,t),n),o=dS`
                    <iq xmlns="jabber:client"
                        from="${r}"
                        type="set"
                        to="${i}">
                    <pubsub xmlns="${uS.NS.PUBSUB}#owner">
                        <configure node="${t}">
                            <x xmlns="${uS.NS.XFORM}" type="submit">
                                <field var="FORM_TYPE" type="hidden">
                                    <value>${uS.NS.PUBSUB}#nodeconfig</value>
                                </field>
                                ${Object.entries(s).map((([e,t])=>dS`<field var="${e}"><value>${t}</value></field>`))}
                            </x>
                        </configure>
                    </pubsub>
                    </iq>`;try{yield Wu.sendIQ(o)}catch(e){throw yield rm(e)}return s}))()},publish:(e,t,n,r,i=!0)=>cS((function*(){if(!t)throw new Error("api.pubsub.publish: node value required");if(!n)throw new Error("api.pubsub.publish: item value required");const s=Ao.session.get("bare_jid"),o=e||s,a=dS`
                <iq xmlns="jabber:client"
                    from="${s}"
                    type="set"
                    to="${o}">
                <pubsub xmlns="${uS.NS.PUBSUB}">
                    <publish node="${t}">${n}</publish>
                    ${r?dS`<publish-options>
                    <x xmlns="${uS.NS.XFORM}" type="submit">
                        <field var="FORM_TYPE" type="hidden">
                            <value>${uS.NS.PUBSUB}#publish-options</value>
                        </field>
                        ${Object.entries(r).map((([e,t])=>dS`<field var="pubsub#${e}"><value>${t}</value></field>`))}
                    </x></publish-options>`:""}
                </pubsub>
                </iq>`;if(o===s){if(!((yield Wu.disco.getIdentity("pubsub","pep",s))||(yield Wu.disco.getIdentity("pubsub","pep",uS.getDomainFromJid(s)))))return Q.warn("api.pubsub.publish: Not publishing via PEP because it's not supported!"),void Q.warn(a)}if(!((yield Wu.disco.supports(uS.NS.PUBSUB+"#publish-options",o))||o===s&&(yield Wu.disco.supports(uS.NS.PUBSUB+"#publish-options",uS.getDomainFromJid(o))))&&i)return Q.warn("api.pubsub.publish: #publish-options not supported, refusing to publish item."),void Q.warn(a);try{yield Wu.sendIQ(a)}catch(e){const n=yield rm(e);if("conflict"!==n.name||"precondition-not-met"!==n.extra[uS.NS.PUBSUB_ERROR])throw e;yield Wu.pubsub.config.set(o,t,r);try{yield Wu.sendIQ(a)}catch(e){if(Q.error(e),!i){const e=a.tree();e.querySelector("publish-options").outerHTML="",Q.warn("api.pubsub.publish: #publish-options precondition-not-met, publishing anyway."),yield Wu.sendIQ(e)}}}}))()}};function fS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pS(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{Strophe:mS,sizzle:gS}=Hp.env;function vS(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function yS(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){vS(s,r,i,o,a,"next",e)}function a(e){vS(s,r,i,o,a,"throw",e)}o(void 0)}))}}mS.addNamespace("PUBSUB_ERROR",mS.NS.PUBSUB+"#errors"),Hp.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){const{api:e}=Ao;Object.assign(Ao.api,hS),e.listen.on("parseErrorStanza",((e,t)=>{const n=gS(`error [xmlns="${mS.NS.PUBSUB_ERROR}"]`,e).pop();return n?pS(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fS(e,t,n[t])}))}return e}({},t),{[mS.NS.PUBSUB_ERROR]:n.nodeName}):t}))}});const bS={status:{get:()=>yS((function*(){yield Wu.waitUntil("statusInitialized");const e=Ao.state.profile.get("show");if(e)return e;const t=Ao.state.profile.get("status");return t||"online"}))(),set:(e,t)=>yS((function*(){if(!Object.keys(Vs).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");let n=Gs.includes(e)?e:void 0;"away"===e&&(n="dnd");const r={show:n,type:Ws.includes(e)?e:void 0};"string"==typeof t&&(r.status_message=t),yield Wu.waitUntil("statusInitialized"),Ao.state.profile.save(r)}))(),message:{get:()=>yS((function*(){return yield Wu.waitUntil("statusInitialized"),Ao.state.profile.get("status_message")}))(),set:e=>yS((function*(){yield Wu.waitUntil("statusInitialized"),Ao.state.profile.save({status_message:e})}))()}}};function _S(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function wS(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){_S(s,r,i,o,a,"next",e)}function a(e){_S(s,r,i,o,a,"throw",e)}o(void 0)}))}}function SS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Strophe:xS,$pres:AS,stx:jS}=Hp.env;class $S extends(Wm(Om(ae.Model))){get idAttribute(){return"jid"}defaults(){return{groups:[],num_unread:0}}initialize(e){var t=this,n=()=>super.initialize;return wS((function*(){this.lazy_load_vcard=!0,n().call(t),this.initialized=ue(),yield this.setPresence();const{jid:r}=e;this.set(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){SS(e,t,n[t])}))}return e}({},e,{jid:xS.getBareJidFromJid(r).toLowerCase(),user_id:xS.getNodeFromJid(r)})),this.listenTo(this.presence,"change:show",(()=>Wu.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presence:change"))),this.listenTo(this.presence,"change:presence",(()=>Wu.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:presence",(()=>this.trigger("presence:change"))),yield Wu.trigger("rosterContactInitialized",this,{synchronous:!0}),this.initialized.resolve()})).call(this)}setPresence(){return wS((function*(){const e=this.get("jid");yield Wu.waitUntil("presencesInitialized");const{presences:t}=Ao.state;this.presence=t.get(e)||t.create({jid:e})})).call(this)}getStatus(){var e;return(null===(e=this.presence)||void 0===e?void 0:e.getStatus())||"offline"}openChat(){Wu.chats.open(this.get("jid"),{},!0)}getDisplayName(e){var t;return this.get("nickname")||(null===(t=this.vcard)||void 0===t?void 0:t.getDisplayName())||((null==e?void 0:e.no_jid)?null:this.get("jid"))}subscribe(e){return Wu.user.presence.send({type:"subscribe",to:this.get("jid"),status:e}),this.save("ask","subscribe"),this}ackSubscribe(){Wu.send(AS({type:"subscribe",to:this.get("jid")}))}ackUnsubscribe(){Wu.send(AS({type:"unsubscribe",to:this.get("jid")})),this.sendRosterRemoveStanza(),this.destroy()}unauthorize(e){return w_(this.get("jid"),e),this}authorize(e){return Wu.send(jS`
            <presence
                to="${this.get("jid")}"
                type="subscribed"
                xmlns="jabber:client">
                    ${e&&""!==e?jS`<status>${e}</status>`:""}
            </presence>`),this.save({requesting:!1,subscription:"from"}),this}remove(e){const t=this.get("subscription");if("none"===t&&"subscribe"!==this.get("ask"))return void this.destroy();"subscribe"!==this.get("ask")&&"to"!==t||Wu.send(AS({type:"unsubscribe",to:this.get("jid")})),e&&["from","both"].includes(t)&&this.unauthorize();const n=this.sendRosterRemoveStanza();return this.collection&&this.destroy(),n}update(e){return wS((function*(){var t;return this.save(e),yield Wu.sendIQ(jS`<iq xmlns="jabber:client" type="set">
                <query xmlns="${xS.NS.ROSTER}">
                    <item jid="${this.get("jid")}" name="${this.get("nickname")}">
                        ${null===(t=this.get("groups"))||void 0===t?void 0:t.map((e=>jS`<group>${e}</group>`))}
                    </item>
                </query>
            </iq>`)})).call(this)}sendRosterRemoveStanza(){return wS((function*(){const e=jS`<iq type="set" xmlns="jabber:client">
            <query xmlns="${xS.NS.ROSTER}">
                <item jid="${this.get("jid")}" subscription="remove"/>
            </query>
        </iq>`;return yield Wu.sendIQ(e)})).call(this)}isUnsaved(){return void 0===this.get("subscription")}}const ES=$S;function OS(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function CS(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){OS(s,r,i,o,a,"next",e)}function a(e){OS(s,r,i,o,a,"throw",e)}o(void 0)}))}}function kS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Strophe:TS,sizzle:NS,stx:MS,u:IS,Stanza:PS}=Hp.env;class DS extends ae.Collection{initialize(){const e=`roster.state-${Ao.session.get("bare_jid")}-${this.get("jid")}`;this.state=new ae.Model({id:e,collapsed_groups:[]}),nl(this.state,e),this.state.fetch(),Wu.listen.on("chatBoxClosed",(e=>this.removeUnsavedContact(e)))}removeUnsavedContact(e){const t=this.get(e.get("jid"));t&&void 0===t.get("subscription")&&t.destroy()}onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()}registerRosterHandler(){Wu.connection.get().addHandler((e=>(Ao.state.roster.onRosterPush(e),!0)),TS.NS.ROSTER,"iq","set")}registerRosterXHandler(){let e=0;Wu.connection.get().addHandler((t=>(setTimeout((()=>{const{roster:e}=Ao.state;Wu.connection.get().flush(),e.subscribeToSuggestedItems(t)}),e),e+=250*t.querySelectorAll("item").length,!0)),TS.NS.ROSTERX,"message",null)}fetchRosterContacts(){return CS((function*(){const e=yield new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,n)=>t(n)})}));if(IS.isErrorObject(e)&&(Q.error(e),Ao.session.save("roster_cached",!1),this.data.save("version",void 0)),!Ao.session.get("roster_cached"))return Wu.connection.get().send_initial_presence=!0,Ao.state.roster.fetchFromServer();Wu.trigger("cachedRoster",e)})).call(this)}subscribeToSuggestedItems(e){return Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&this.addContact({jid:e.getAttribute("jid"),name:e.getAttribute("name"),subscription:"to"})})),!0}isSelf(e){return IS.isSameBareJID(e,Wu.connection.get().jid)}sendContactAddIQ(e){const{jid:t,groups:n}=e,r=e.name?e.name:null,i=MS`
            <iq type="set" xmlns="jabber:client">
                <query xmlns="${TS.NS.ROSTER}">
                    <item jid="${t}" ${r?PS.unsafeXML(`name="${TS.xmlescape(r)}"`):""}>
                        ${null==n?void 0:n.map((e=>MS`<group>${e}</group>`))}
                    </item>
                </query>
            </iq>`;return Wu.sendIQ(i)}addContact(e,t=!0,n=!0,r=""){return CS((function*(){const{jid:i,name:s}=null!=e?e:{};if(!i||!IS.isValidJID(i))throw new Error("Invalid JID provided to addContact");if(yield Wu.waitUntil("rosterContactsFetched"),t)try{yield this.sendContactAddIQ(e)}catch(e){Q.error(e);const{__:t}=Ao;throw alert(t("Sorry, an error occurred while trying to add %1$s as a contact.",s||i)),e}const o=yield this.create(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){kS(e,t,n[t])}))}return e}({},{ask:void 0,nickname:s,groups:[],requesting:!1,subscription:t?"none":void 0},e),{sort:!1});return n&&o.subscribe(r),o})).call(this)}subscribeBack(e,t,n="",r=""){return CS((function*(){const i=this.get(e),{RosterContact:s}=Ao.exports;if(i instanceof s)i.authorize().subscribe();else{var o;const i=(null===(o=NS(`nick[xmlns="${TS.NS.NICK}"]`,t).pop())||void 0===o?void 0:o.textContent)||void 0,a=yield this.addContact({jid:e,name:i,groups:[],subscription:"from"});a instanceof s&&a.authorize(n).subscribe(r)}})).call(this)}onRosterPush(e){const t=e.getAttribute("id"),n=e.getAttribute("from"),r=Ao.session.get("bare_jid");if(n&&n!==r)return void Q.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);Wu.send(MS`<iq type="result" id="${t}" from="${Wu.connection.get().jid}" xmlns="jabber:client" />`);const i=NS(`query[xmlns="${TS.NS.ROSTER}"]`,e).pop();this.data.save("version",i.getAttribute("ver"));const s=NS("item",i);if(s.length>1)throw Q.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===s.length)return Q.warn(e),void Q.warn('Received a roster push stanza without an "item" element.');this.updateContact(s.pop()),Wu.trigger("rosterPush",e)}shouldUseRosterVersioning(){return Wu.settings.get("enable_roster_versioning")&&this.data.get("version")&&Wu.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")}fetchFromServer(){return CS((function*(){const e=MS`
            <iq type="get" id="${IS.getUniqueId("roster")}" xmlns="jabber:client">
                <query xmlns="${TS.NS.ROSTER}"
                    ${this.shouldUseRosterVersioning()?PS.unsafeXML(`ver="${this.data.get("version")}"`):""}>
                </query>
            </iq>`,t=yield Wu.sendIQ(e,null,!1);if("result"===t.getAttribute("type")){const e=NS(`query[xmlns="${TS.NS.ROSTER}"]`,t).pop();if(e){const t=NS("item",e);if(!this.data.get("version")&&this.models.length){const e=t.map((e=>e.getAttribute("jid")));this.forEach((t=>!t.get("requesting")&&!e.includes(t.get("jid"))&&t.destroy()))}t.forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver"))}}else if(!IS.isServiceUnavailableError(t))return Q.error(t),void Q.error("Error while trying to fetch roster from the server");Ao.session.save("roster_cached",!0),Wu.trigger("roster",t)})).call(this)}updateContact(e){const t=e.getAttribute("jid"),n=this.get(t),r=e.getAttribute("subscription");if("remove"===r)return null==n?void 0:n.destroy();const i=e.getAttribute("ask"),s=e.getAttribute("name"),o=[...new Set(NS("group",e).map((e=>e.textContent)))];n?n.save({subscription:r,ask:i,nickname:s,groups:o,requesting:null}):this.create({nickname:s,ask:i,groups:o,jid:t,subscription:r},{sort:!1})}createRequestingContact(e){var t;const n={jid:TS.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:(null===(t=NS(`nick[xmlns="${TS.NS.NICK}"]`,e).pop())||void 0===t?void 0:t.textContent)||null};Wu.trigger("contactRequest",this.create(n))}handleIncomingSubscription(e){const t=e.getAttribute("from"),n=TS.getBareJidFromJid(t),r=this.get(n);if(!Wu.settings.get("allow_contact_requests")){const{__:e}=Ao;w_(t,e("This client does not allow presence subscriptions"))}Wu.settings.get("auto_subscribe")?r&&"to"===r.get("subscription")?r.authorize():this.subscribeBack(n,e):r?("none"!==r.get("subscription")||"subscribe"===r.get("ask"))&&r.authorize():this.createRequestingContact(e)}handleOwnPresence(e){const t=e.getAttribute("from"),n=TS.getResourceFromJid(t),r=e.getAttribute("type"),{profile:i}=Ao.state;if(Wu.connection.get().jid!==t&&"unavailable"!==r&&(!0===Wu.settings.get("synchronize_availability")||Wu.settings.get("synchronize_availability")===n)){var s,o;const t=null===(s=e.querySelector("show"))||void 0===s?void 0:s.textContent;i.save({show:t,presence:"online"},{silent:!0});const n=null===(o=e.querySelector("status"))||void 0===o?void 0:o.textContent;n&&i.save({status_message:n})}Ao.session.get("jid")===t&&"unavailable"===r&&Wu.user.presence.send()}presenceHandler(e){const t=e.getAttribute("type");if("error"===t)return!0;const n=e.getAttribute("from"),r=TS.getBareJidFromJid(n);if(this.isSelf(r))return this.handleOwnPresence(e);if(NS(`query[xmlns="${TS.NS.MUC}"]`,e).length)return;const i=this.get(r);if(i){var s;const t=null===(s=e.querySelector("status"))||void 0===s?void 0:s.textContent;i.get("status")!==t&&i.save({status:t})}if("subscribed"===t&&i)i.ackSubscribe();else if("unsubscribed"===t&&i)i.ackUnsubscribe();else{if("unsubscribe"===t)return;if("subscribe"===t)this.handleIncomingSubscription(e);else if("unavailable"===t&&i){const e=TS.getResourceFromJid(n);i.presence.removeResource(e)}else i&&i.presence.addResource(e)}}constructor(){super(),this.model=ES,this.data=null}}const RS=DS;class zS extends ae.Model{get idAttribute(){return"name"}}const LS=zS;class US extends ae.Collection{constructor(){super(),this.model=LS}}const BS=US,{Strophe:FS,sizzle:qS,dayjs:HS}=Hp.env;class GS extends ae.Model{get idAttribute(){return"jid"}defaults(){return{presence:"offline",show:null}}initialize(){super.initialize(),this.resources=new BS;const e=`converse.identities-${this.get("jid")}`;nl(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)}onResourcesChanged(){const e=this.getHighestPriorityResource();var t;const{presence:n,show:r}=null!==(t=null==e?void 0:e.attributes)&&void 0!==t?t:{};this.save({presence:n,show:r})}getStatus(){const e=this.get("presence");return"offline"===e?"offline":this.get("show")||e||"offline"}getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]}addResource(e){const t=function(e){var t,n;const r=e.getAttribute("from"),i=e.getAttribute("type"),s=FS.getResourceFromJid(r),o=qS(`delay[xmlns="${FS.NS.DELAY}"]`,e).pop(),a=null===(t=e.querySelector("priority"))||void 0===t?void 0:t.textContent;return{resource:s,show:null===(n=e.querySelector("show"))||void 0===n?void 0:n.textContent,timestamp:o?HS(o.getAttribute("stamp")).toISOString():(new Date).toISOString(),type:i,priority:Number.isNaN(parseInt(a,10))?0:parseInt(a,10)}}(e),n={name:t.resource,presence:"unavailable"===t.type?"offline":"online",priority:t.priority,show:t.show,timestamp:t.timestamp},r=this.resources.get(n.name);r?r.save(n):this.resources.create(n)}removeResource(e){const t=this.resources.get(e);null==t||t.destroy()}}const WS=GS;class VS extends ae.Collection{constructor(){super(),this.model=WS}}const KS=VS,{Strophe:JS,$build:YS}=Hp.env;function XS(e){Wu.trigger("statusInitialized",e)}function QS(e){if(e=void 0!==Ao.state.profile&&e)XS(e);else{const t=`converse.xmppstatus-${Ao.session.get("bare_jid")}`;Ao.state.profile=new Ao.exports.Profile({id:t}),Ao.state.xmppstatus=Ao.state.profile,Object.assign(Ao,{xmppstatus:Ao.state.profile}),nl(Ao.state.profile,t,"session"),Ao.state.profile.fetch({success:()=>XS(e),error:()=>XS(e),silent:!0})}}let ZS,ex=0,tx=!1,nx=!1,rx=!1;function ix(){var e;ex>0&&(ex=0),(null===(e=Wu.connection.get())||void 0===e?void 0:e.authenticated)&&(rx&&ox(so),tx&&(tx=!1,Wu.user.presence.send()),!0===nx&&(nx=!1,Ao.state.profile.set("show",void 0)))}function sx(){var e;if(!(null===(e=Wu.connection.get())||void 0===e?void 0:e.authenticated))return;const{profile:t}=Ao.state,n=t.get("show");ex++,Wu.settings.get("csi_waiting_time")>0&&ex>Wu.settings.get("csi_waiting_time")&&!rx&&ox(io),Wu.settings.get("idle_presence_timeout")>0&&ex>Wu.settings.get("idle_presence_timeout")&&!tx&&(tx=!0,Wu.user.presence.send()),Wu.settings.get("auto_away")>0&&ex>Wu.settings.get("auto_away")&&"away"!==n&&"xa"!==n&&"dnd"!==n?(nx=!0,t.set("show","away")):Wu.settings.get("auto_xa")>0&&ex>Wu.settings.get("auto_xa")&&"xa"!==n&&"dnd"!==n&&(nx=!0,t.set("show","xa"))}function ox(e){Wu.send(YS(e,{xmlns:JS.NS.CSI})),rx=e===io}function ax(){if(Wu.settings.get("auto_away")<1&&Wu.settings.get("auto_xa")<1&&Wu.settings.get("csi_waiting_time")<1&&Wu.settings.get("idle_presence_timeout")<1)return;ex=0,nx=!1;const{onUserActivity:e,onEverySecond:t}=Ao.exports;window.addEventListener("click",e),window.addEventListener("focus",e),window.addEventListener("keypress",e),window.addEventListener("mousemove",e),window.addEventListener(ii(),e,{once:!0,passive:!0}),ZS=setInterval(t,1e3)}function cx(){const{onUserActivity:e}=Ao.exports;window.removeEventListener("click",e),window.removeEventListener("focus",e),window.removeEventListener("keypress",e),window.removeEventListener("mousemove",e),window.removeEventListener(ii(),e),ZS&&(clearInterval(ZS),ZS=null)}function lx(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Stanza:ux,Strophe:dx,stx:hx}=Hp.env;class fx extends(Wm(Om(ae.Model))){defaults(){return{presence:"online",status:null,show:null,groups:[]}}getStatus(){const e=this.get("presence");return"offline"===e||"unavailable"===e?"offline":this.get("show")||e||"offline"}get(e){return"jid"===e?Ao.session.get("bare_jid"):"nickname"===e?Wu.settings.get("nickname"):super.get(e)}set(e,t,n){if("jid"===e||"nickname"===e)throw new Error("Readonly property");return super.set(e,t,n)}initialize(){super.initialize(),this.on("change",(e=>{var t,n,r;((null===(t=e.changed)||void 0===t?void 0:t.status)||(null===(n=e.changed)||void 0===n?void 0:n.status_message)||(null===(r=e.changed)||void 0===r?void 0:r.show))&&Wu.user.presence.send({show:this.get("show"),status:this.get("status_message")})}))}getDisplayName(e){var t;const{__:n}=Ao,r=(null===(t=this.vcard)||void 0===t?void 0:t.get("fullname"))||this.getNickname()||this.get("jid");return"roster"===(null==e?void 0:e.context)?`${r} (${n("me")})`:r}getNickname(){var e;return(null===(e=this.vcard)||void 0===e?void 0:e.get("nickname"))||Wu.settings.get("nickname")}constructPresence(){return(e=function*(e={}){const{type:t,to:n}=e,{profile:r}=Ao.state,i="string"==typeof e.status?e.status:this.get("status_message"),s=e.show||this.get("status"),o="subscribe"===t?r.getNickname():null,a=Wu.settings.get("priority");let c;tx&&(c=new Date,c.setSeconds(c.getSeconds()-ex));const l=hx`
            <presence ${n?ux.unsafeXML(`to="${dx.xmlescape(n)}"`):""}
                    ${t?ux.unsafeXML(`type="${dx.xmlescape(t)}"`):""}
                    xmlns="jabber:client">
                ${o?hx`<nick xmlns="${dx.NS.NICK}">${o}</nick>`:""}
                ${s?hx`<show>${s}</show>`:""}
                ${i?hx`<status>${i}</status>`:""}
                <priority>${Number.isNaN(Number(a))?0:a}</priority>
                ${c?hx`<idle xmlns="${dx.NS.IDLE}" since="${c.toISOString()}"></idle>`:""}
            </presence>`;return yield Wu.hook("constructedPresence",null,l)},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){lx(s,r,i,o,a,"next",e)}function a(e){lx(s,r,i,o,a,"throw",e)}o(void 0)}))}).apply(this,arguments);var e}}const{Strophe:px}=Hp.env;function mx(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function gx(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){mx(s,r,i,o,a,"next",e)}function a(e){mx(s,r,i,o,a,"throw",e)}o(void 0)}))}}px.addNamespace("IDLE","urn:xmpp:idle:1"),Hp.plugins.add("converse-status",{initialize(){Wu.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,idle_presence_timeout:300,priority:0}),Wu.promises.add(["statusInitialized"]);const e={XMPPStatus:fx,Profile:fx,onUserActivity:ix,onEverySecond:sx,sendCSI:ox,registerIntervalHandler:ax};Object.assign(Ao,e),Object.assign(Ao.exports,e),Object.assign(Ao.api.user,bS),Wu.settings.get("idle_presence_timeout")>0&&Wu.listen.on("addClientFeatures",(()=>Wu.disco.own.features.add(px.NS.IDLE))),Wu.listen.on("presencesInitialized",(e=>!e&&ax())),Wu.listen.on("beforeTearDown",cx),Wu.listen.on("clearSession",(()=>{oi(Ao)&&Ao.state.profile&&(Ao.state.profile.destroy(),delete Ao.state.profile,Object.assign(Ao,{profile:void 0}),Wu.promises.add(["statusInitialized"]))})),Wu.listen.on("connected",(()=>QS(!1))),Wu.listen.on("reconnected",(()=>QS(!0)))}});const{Strophe:vx}=Hp.env,yx={contacts:{get:e=>gx((function*(){yield Wu.waitUntil("rosterContactsFetched");const{roster:t}=Ao.state,n=e=>t.get(vx.getBareJidFromJid(e));if(void 0===e)e=t.pluck("jid");else if("string"==typeof e)return n(e);return e.map(n)}))(),remove:(e,t)=>gx((function*(){yield Wu.waitUntil("rosterContactsFetched");(yield Wu.contacts.get(e)).remove(t)}))(),add:(e,t=!0,n=!0,r="")=>gx((function*(){if(!il(null==e?void 0:e.jid))throw new Error("api.contacts.add: Valid JID required");const{roster:i}=Ao.state;return i.addContact(e,t,n,r)}))()}};function bx(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function _x(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){bx(s,r,i,o,a,"next",e)}function a(e){bx(s,r,i,o,a,"throw",e)}o(void 0)}))}}Hp.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){Wu.settings.extend({allow_contact_requests:!0,auto_subscribe:!1,enable_roster_versioning:!0,show_self_in_roster:!0,synchronize_availability:!0}),Wu.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized","presencesInitialized"]),Object.assign(Ao.api,yx);const{__:e}=Ao,t={HEADER_UNSAVED_CONTACTS:e("Unsaved contacts"),HEADER_CURRENT_CONTACTS:e("My contacts"),HEADER_PENDING_CONTACTS:e("Pending contacts"),HEADER_REQUESTING_CONTACTS:e("Contact requests"),HEADER_UNGROUPED:e("Ungrouped"),HEADER_UNREAD:e("New messages")};Object.assign(Ao,t),Object.assign(Ao.labels,t);const n={Presence:WS,Presences:KS,RosterContact:ES,RosterContacts:RS};Object.assign(Ao,n),Object.assign(Ao.exports,n),Wu.listen.on("beforeTearDown",(()=>p_())),Wu.listen.on("chatBoxesInitialized",b_),Wu.listen.on("clearSession",g_),Wu.listen.on("presencesInitialized",v_),Wu.listen.on("statusInitialized",y_),Wu.listen.on("streamResumptionFailed",(()=>Ao.session.set("roster_cached",!1))),Wu.waitUntil("rosterContactsFetched").then(__)}});const{Strophe:wx,u:Sx,stx:xx}=Hp.env;function Ax(){return!(Wu.connection.isType("bosh")&&!ri())&&Wu.disco.stream.getFeature("sm",wx.NS.SM)}function jx(e){if(!Ao.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),n=Ao.session.get("num_stanzas_handled_by_server"),r=t-n;if(r<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${n}`;Q.error(e)}const i=Ao.session.get("unacked_stanzas");if(r>i.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${r} -Unacknowledged Stanza Count: ${i.length} -New: ${t} - Previous: ${n}`;Q.error(e)}return Ao.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:i.slice(r)}),!0}function $x(){if(Ao.session.get("smacks_enabled")){const e=Ao.session.get("num_stanzas_handled"),t=xx`<a xmlns="${wx.NS.SM}" h="${e}"/>`;Wu.send(t)}return!0}function Ex(e){if(Ao.session.get("smacks_enabled")&&(Sx.isTagEqual(e,"iq")||Sx.isTagEqual(e,"presence")||Sx.isTagEqual(e,"message"))){const e=Ao.session.get("num_stanzas_handled");Ao.session.save("num_stanzas_handled",e+1)}return!0}function Ox(){const{session:e}=Ao;e.save({smacks_enabled:Ao.session.get("smacks_enabled")||!1,num_stanzas_handled:Ao.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:Ao.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:Ao.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:Ao.session.get("unacked_stanzas")||[]})}function Cx(){const{session:e}=Ao;Sx.safeSave(e,{smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function kx(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),Ao.session.save(t),!0}function Tx(e){if(Cx(),Wu.trigger("streamResumptionFailed"),e.querySelector("item-not-found"))Q.warn("Could not resume previous SMACKS session, session id not found. A new session will be established.");else{Q.error("Failed to enable stream management"),Q.error(e.outerHTML);Wu.connection.get()._changeConnectStatus(wx.Status.DISCONNECTED,null)}return!0}function Nx(e){kx(e),jx(e),function(){const e=Ao.session.get("unacked_stanzas");Ao.session.save("unacked_stanzas",[]),e.forEach((e=>Wu.send(Sx.toStanza(e))))}();const t=Wu.connection.get();t.do_bind=!1,t.authenticated=!0,t.restored=!0,t._changeConnectStatus(wx.Status.CONNECTED,null)}function Mx(){return _x((function*(){if(Wu.settings.get("enable_smacks")&&!Ao.session.get("smacks_enabled")&&(yield Ax())){const e=ue(),t=Wu.connection.get();t._addSysHandler((t=>e.resolve(kx(t))),wx.NS.SM,"enabled"),t._addSysHandler((t=>e.resolve(Tx(t))),wx.NS.SM,"failed");const n=Wu.connection.isType("websocket")||ri(),r=xx`<enable xmlns="${wx.NS.SM}" resume="${n}"/>`;Wu.send(r),t.flush(),yield e}}))()}const Ix=[];function Px(){return _x((function*(){if(!Wu.settings.get("enable_smacks"))return;if(!(yield Ax()))return;const e=Wu.connection.get();for(;Ix.length;)e.deleteHandler(Ix.pop());Ix.push(e.addHandler(Ex)),Ix.push(e.addHandler($x,wx.NS.SM,"r")),Ix.push(e.addHandler(jx,wx.NS.SM,"a"));const{session:t}=Ao;(null==t?void 0:t.get("smacks_stream_id"))?yield _x((function*(){const e=ue(),t=Wu.connection.get();t._addSysHandler((t=>e.resolve(Nx(t))),wx.NS.SM,"resumed"),t._addSysHandler((t=>e.resolve(Tx(t))),wx.NS.SM,"failed");const n=Ao.session.get("smacks_stream_id"),r=Ao.session.get("num_stanzas_handled"),i=xx`<resume xmlns="${wx.NS.SM}" h="${r}" previd="${n}"/>`;Wu.send(i),t.flush(),yield e}))():Cx()}))()}function Dx(e){if(Ao.session){if(Ao.session.get("smacks_enabled")&&(Sx.isTagEqual(e,"iq")||Sx.isTagEqual(e,"presence")||Sx.isTagEqual(e,"message"))){const t=wx.serialize(e);Ao.session.save("unacked_stanzas",(Ao.session.get("unacked_stanzas")||[]).concat([t]));const n=Wu.settings.get("smacks_max_unacked_stanzas");if(n>0){const e=Ao.session.get("num_stanzas_since_last_ack")+1;e%n===0&&Wu.send(xx`<r xmlns="${wx.NS.SM}"/>`),Ao.session.save({num_stanzas_since_last_ack:e})}}}else Q.warn("No _converse.session!")}const{Strophe:Rx}=Hp.env;Rx.addNamespace("SM","urn:xmpp:sm:3"),Hp.plugins.add("converse-smacks",{initialize(){Wu.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),Wu.listen.on("afterResourceBinding",Mx),Wu.listen.on("beforeResourceBinding",Px),Wu.listen.on("send",Dx),Wu.listen.on("userSessionInitialized",Ox)}});class zx extends ae.Model{initialize(e,t){this.lazy_load=Wu.settings.get("lazy_load_vcards")&&!!(null==t?void 0:t.lazy_load),this.lazy_load?this.once("visibilityChanged",(()=>Wu.vcard.update(this))):Wu.vcard.update(this)}get idAttribute(){return"jid"}getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}constructor(e,t){super(e,t),this._vcard=null}}const Lx=zx;function Ux(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}class Bx extends ae.Collection{initialize(){return(e=function*(){const{session:e}=Ao;nl(this,`${e.get("bare_jid")}-converse.vcards`),yield this.fetchVCards(),Wu.trigger("VCardsInitialized")},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Ux(s,r,i,o,a,"next",e)}function a(e){Ux(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}fetchVCards(){const e=ue();return this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}),e}constructor(){super(),this.model=Lx}}const Fx=Bx;function qx(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Hx(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){qx(s,r,i,o,a,"next",e)}function a(e){qx(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:Gx,dayjs:Wx,u:Vx,stx:Kx}=Hp.env,Jx={vcard:{set:(e,t)=>Hx((function*(){if(!e)throw Error("No jid provided for the VCard data");Wu.waitUntil("VCardsInitialized");let n=Ao.state.vcards.get(e);var r;const i=null!==(r=null==n?void 0:n.attributes)&&void 0!==r?r:null;if(n&&i.image!==t.image){const e=Vx.base64ToArrayBuffer(t.image),r=yield crypto.subtle.digest("SHA-1",e);n.save({image:t.image,image_type:t.image_type,image_hash:Vx.arrayBufferToHex(r)})}let s;var o,a,c,l,u,d,h;const f=Kx`
                <vCard xmlns="vcard-temp">
                    <FN>${null!==(o=t.fn)&&void 0!==o?o:""}</FN>
                    <NICKNAME>${null!==(a=t.nickname)&&void 0!==a?a:""}</NICKNAME>
                    <URL>${null!==(c=t.url)&&void 0!==c?c:""}</URL>
                    <ROLE>${null!==(l=t.role)&&void 0!==l?l:""}</ROLE>
                    <EMAIL><INTERNET/><PREF/><USERID>${null!==(u=t.email)&&void 0!==u?u:""}</USERID></EMAIL>
                    <PHOTO>
                        <TYPE>${null!==(d=t.image_type)&&void 0!==d?d:""}</TYPE>
                        <BINVAL>${null!==(h=t.image)&&void 0!==h?h:""}</BINVAL>
                    </PHOTO>
                </vCard>`;try{s=yield Wu.sendIQ(Um("set",e,f))}catch(e){throw i&&n.save(i),e}if(n=yield Wu.vcard.update(e,!0),Vx.isOwnJID(e)){var p;const e=Kx`<x xmlns="${Gx.NS.VCARD_UPDATE}">
                    <photo>${null!==(p=n.get("image_hash"))&&void 0!==p?p:""}</photo>
                </x>`;Wu.user.presence.send({},e)}return s}))(),get:(e,t)=>Hx((function*(){if(Wu.waitUntil("VCardsInitialized"),"string"==typeof e)return Fm(e);const n=e.get("vcard_error");if(n){const{random:e,round:r}=Math,i=r(e()),s=Wx().subtract(21,"days").subtract(r(24*e())*i,"hours").add(r(24*e())*(i?0:1),"hours"),o=Wx(n).isAfter(s);if(!t&&o)return null}const r=e.get("vcard_updated");if(r){const{random:e,round:n}=Math,i=n(e()),s=Wx().subtract(7,"days").subtract(n(24*e())*i,"hours").add(n(24*e())*(i?0:1),"hours"),o=Wx(r).isAfter(s);if(!t&&o)return null}const i=e.get("jid");return i?Fm(i):(Q.error("No JID to get vcard for"),null)}))(),update(e,t){return Hx((function*(){Wu.waitUntil("VCardsInitialized");const n=yield this.get(e,t);if(null!==n){if(e="string"==typeof e?Ao.state.vcards.get(e):e)return Object.keys(n).length&&(delete n.stanza,Vx.safeSave(e,n)),e;Q.error(`Could not find a VCard model for ${e}`)}else Q.debug("api.vcard.update: null data returned, not updating the vcard")})).call(this)}}},{Strophe:Yx}=Hp.env;Hp.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],enabled(){var e;return!(null===(e=Wu.settings.get("blacklisted_plugins"))||void 0===e?void 0:e.includes("converse-vcard"))},initialize(){Wu.settings.extend({lazy_load_vcards:!0}),Wu.promises.add("VCardsInitialized"),Object.assign(Ao.api,Jx);const e={VCard:Lx,VCards:Fx};Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.listen.on("chatRoomInitialized",(e=>{e.listenTo(e.occupants,"change:image_hash",(e=>function(e){const t=e.get("image_hash"),n=[];e.get("jid")&&n.push(Ao.state.vcards.get(e.get("jid"))),n.push(Ao.state.vcards.get(e.get("from"))),n.forEach((e=>t&&e&&(null==e?void 0:e.get("image_hash"))!==t&&Wu.vcard.update(e,!0)))}(e)))})),Wu.listen.on("addClientFeatures",(()=>{Wu.disco.own.features.add(Yx.NS.VCARD),Wu.disco.own.features.add(Yx.NS.VCARD_UPDATE)})),Wu.listen.on("clearSession",(()=>{oi(Ao)&&(Wu.promises.add("VCardsInitialized"),Ao.state.vcards&&(Ao.state.vcards.clearStore(),Object.assign(Ao,{vcards:void 0}),delete Ao.state.vcards))})),Wu.listen.on("visibilityChanged",(({el:e})=>{const{model:t}=e;(null==t?void 0:t.vcard)&&t.vcard.trigger("visibilityChanged")})),Wu.listen.on("connected",(()=>{const e=new Ao.exports.VCards;Ao.state.vcards=e,Object.assign(Ao,{vcards:e})})),Wu.listen.on("presencesInitialized",(()=>Hm())),Wu.listen.on("beforeTearDown",(()=>{qm&&(Wu.connection.get().deleteHandler(qm),qm=null)})),Wu.listen.on("constructedPresence",((e,t)=>function(e){if(0===zm(`x[xmlns=${Dm.NS.VCARD_UPDATE}"]`,e.root()).length){const t=Lm`<x xmlns="${Dm.NS.VCARD_UPDATE}"></x>`;e.root().cnode(t).up()}return e}(t)))}}),W().extend(K());const Xx=Object.assign({},s,b);Object.assign(Ao.constants,Xx);function Qx(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Zx(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Qx(s,r,i,o,a,"next",e)}function a(e){Qx(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{dayjs:eA}=Hp.env;let tA,nA="en";function rA(e,t){return t.includes(e)}function iA(e,t){if("en"===e||t(e))return e;const{languages:n}=window.navigator;let r;for(let e=0;e<n.length&&!r;e++)r=sA(n[e],t);return r||"en"}function sA(e,t){if(t(e))return e;var n=e.split("-")[0];return n!==e&&t(n)?n:void 0}const oA=Object.assign(re,{getLocale:()=>nA,translate(e,t){if(!tA)return H().sprintf.apply(H(),arguments);const n=tA.translate(e);return arguments.length>1?n.fetch.apply(n,t):n.fetch()},initialize:()=>Zx((function*(){if(Up.isTestEnv())nA="en";else try{const e=Wu.settings.get("i18n"),t=Wu.settings.get("locales");nA=iA(e,(e=>rA(e,t))),tA=yield Zx((function*(){const e=function(e){const t=e.toLowerCase().replace("_","-");return"ug"===t?"ug-cn":t}(nA);if(!rA(nA,Wu.settings.get("locales"))||"en"===nA)return;const{default:t}=yield n(1472)(`./${nA}/LC_MESSAGES/converse.po`);return yield n(6669)(`./${e}.js`),eA.locale(iA(e,(e=>eA.locale(e)))),new(H())(t)}))()}catch(e){Q.fatal(e.message),nA="en"}}))(),__:(e,...t)=>oA.translate(e,t)}),aA=oA.__,cA={},lA={registry:cA,define(e,t){this.registry[e]=t},register(){Object.keys(cA).forEach((e=>{customElements.get(e)||customElements.define(e,cA[e])}))}};Object.assign(Wu,{elements:lA});class uA extends((0,ae.EventEmitter)(Lf)){createRenderRoot(){return this}initialize(){return null}connectedCallback(){return super.connectedCallback(),this.initialize()}disconnectedCallback(){super.disconnectedCallback(),this.stopListening()}constructor(){super()}}Wu.elements.define("converse-logo",class extends uA{render(){return"overlayed"===Wu.settings.get("view_mode")?mf`<svg class="converse-svg-logo" version="1.1" viewBox="0 0 364 364" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><title>Converse Logo</title><g class="cls-1" id="g904"><g data-name="Layer 2"><g data-name="Layer 7"><path class="cls-3" d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z"/><path class="cls-4" d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z"/></g></g></g></svg>`:mf`<svg class="converse-svg-logo" version="1.1" viewBox="0 0 364 364" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><title>Converse Logo</title><defs><linearGradient id="gradient" x1="92.14" y1="27.64" x2="267.65" y2="331.62" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff1d1"/><stop offset="0.05" stop-color="#fae8c1"/><stop offset="0.15" stop-color="#f0d5a1"/><stop offset="0.27" stop-color="#e7c687"/><stop offset="0.4" stop-color="#e1bb72"/><stop offset="0.54" stop-color="#dcb264"/><stop offset="0.71" stop-color="#daad5c"/><stop offset="1" stop-color="#d9ac59"/></linearGradient><filter id="shadow"><feGaussianBlur in="SourceAlpha" stdDeviation="2.3" result="blur1"/><feOffset in="blur1" dx="3" dy="3" result="blur2"/><feColorMatrix in="blur2" type="matrix" result="blur3" values="1 0 0 0 0.1                            0 1 0 0 0.1                            0 0 1 0 0.1                            0 0 0 1 0"/><feMerge><feMergeNode in="blur3"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><g filter="url(#shadow)"><path d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" fill="#d9ac59"/><path d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" fill="url(#gradient)"/></g></svg>`}});Wu.elements.define("converse-brand-logo",class extends uA{static get properties(){return{hide_byline:{type:Boolean}}}render(){const e="fullscreen"===Wu.settings.get("view_mode");return mf`<a class="brand-heading" href="https://conversejs.org" target="_blank" rel="noopener"><span class="brand-name-wrapper ${e?"brand-name-wrapper--fullscreen":""}"><converse-logo class="converse-svg-logo"></converse-logo><span class="brand-name"><span class="brand-name__text">converse<span class="subdued">.js</span></span> ${e&&!this.hide_byline?mf`<p class="byline">messaging freedom</p>`:""}</span></span></a>`}constructor(){super(),this.hide_byline=!1}});Wu.elements.define("converse-brand-heading",class extends uA{render(){return mf`<converse-brand-logo></converse-brand-logo>`}});const{I:dA}=Nf,hA=()=>document.createComment(""),fA=(e,t,n)=>{const r=e._$AA.parentNode,i=void 0===t?e._$AB:t._$AA;if(void 0===n){const t=r.insertBefore(hA(),i),s=r.insertBefore(hA(),i);n=new dA(t,s,e,e.options)}else{const t=n._$AB.nextSibling,o=n._$AM,a=o!==e;if(a){var s;let t;null===(s=n._$AQ)||void 0===s||s.call(n,e),n._$AM=e,void 0!==n._$AP&&(t=e._$AU)!==o._$AU&&n._$AP(t)}if(t!==i||a){let e=n._$AA;for(;e!==t;){const t=e.nextSibling;r.insertBefore(e,i),e=t}}}return n},pA=(e,t,n=e)=>(e._$AI(t,n),e),mA={},gA=e=>{var t;null===(t=e._$AP)||void 0===t||t.call(e,!1,!0);let n=e._$AA;const r=e._$AB.nextSibling;for(;n!==r;){const e=n.nextSibling;n.remove(),n=e}},vA=2,yA=e=>(...t)=>({_$litDirective$:e,values:t});class bA{get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}constructor(e){}}const _A=(e,t)=>{var n;const r=e._$AN;if(void 0===r)return!1;for(const e of r)null===(n=e._$AO)||void 0===n||n.call(e,t,!1),_A(e,t);return!0},wA=e=>{let t,n;do{if(void 0===(t=e._$AM))break;n=t._$AN,n.delete(e),e=t}while(0===(null==n?void 0:n.size))},SA=e=>{for(let t;t=e._$AM;e=t){let n=t._$AN;if(void 0===n)t._$AN=n=new Set;else if(n.has(e))break;n.add(e),jA(t)}};function xA(e){void 0!==this._$AN?(wA(this),this._$AM=e,SA(this)):this._$AM=e}function AA(e,t=!1,n=0){const r=this._$AH,i=this._$AN;if(void 0!==i&&0!==i.size)if(t)if(Array.isArray(r))for(let e=n;e<r.length;e++)_A(r[e],!1),wA(r[e]);else null!=r&&(_A(r,!1),wA(r));else _A(this,e)}const jA=e=>{var t,n,r,i;e.type==vA&&(null!==(r=(t=e)._$AP)&&void 0!==r||(t._$AP=AA),null!==(i=(n=e)._$AQ)&&void 0!==i||(n._$AQ=xA))};class $A extends bA{_$AT(e,t,n){super._$AT(e,t,n),SA(this),this.isConnected=e._$AU}_$AO(e,t=!0){var n,r;e!==this.isConnected&&(this.isConnected=e,e?null===(n=this.reconnected)||void 0===n||n.call(this):null===(r=this.disconnected)||void 0===r||r.call(this)),t&&(_A(this,e),wA(this))}setValue(e){if((e=>void 0===e.strings)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}constructor(){super(...arguments),this._$AN=void 0}}class EA{disconnect(){this.G=void 0}reconnect(e){this.G=e}deref(){return this.G}constructor(e){this.G=e}}class OA{get(){return this.Y}pause(){var e;null!==(e=this.Y)&&void 0!==e||(this.Y=new Promise((e=>this.Z=e)))}resume(){var e;null===(e=this.Z)||void 0===e||e.call(this),this.Y=this.Z=void 0}constructor(){this.Y=void 0,this.Z=void 0}}function CA(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const kA=e=>!(e=>null===e||"object"!=typeof e&&"function"!=typeof e)(e)&&"function"==typeof e.then,TA=1073741823;const NA=yA(class extends $A{render(...e){var t;return null!==(t=e.find((e=>!kA(e))))&&void 0!==t?t:vf}update(e,t){const n=this._$Cbt;let r=n.length;this._$Cbt=t;const i=this._$CK,s=this._$CX;this.isConnected||this.disconnected();for(let e=0;e<t.length&&!(e>this._$Cwt);e++){const o=t[e];if(!kA(o))return this._$Cwt=e,o;e<r&&o===n[e]||(this._$Cwt=TA,r=0,Promise.resolve(o).then((e=>{return(t=function*(){for(;s.get();)yield s.get();const t=i.deref();if(void 0!==t){const n=t._$Cbt.indexOf(o);n>-1&&n<t._$Cwt&&(t._$Cwt=n,t.setValue(e))}},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){CA(s,r,i,o,a,"next",e)}function a(e){CA(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t})))}return vf}disconnected(){this._$CK.disconnect(),this._$CX.pause()}reconnected(){this._$CK.reconnect(this),this._$CX.resume()}constructor(){super(...arguments),this._$Cwt=TA,this._$Cbt=[],this._$CK=new EA(this),this._$CX=new OA}}),MA=e=>mf`<div class="mb-3"><label for="${e.id}" class="form-label">${e.label} ${e.desc?mf`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <input class="form-control" id="${e.id}" name="${e.name}" type="datetime-local" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`,IA=e=>mf`<fieldset class="mb-3">${e.label?mf`<label class="form-label">${e.label}</label>`:""} <img src="data:${e.type};base64,${e.data}"> <input name="${e.name}" type="text" ?required="${e.required}"></fieldset>`,PA=e=>mf`<fieldset class="mb-3 form-check"><input id="${e.id}" name="${e.name}" type="checkbox" class="form-check-input" ?readonly="${e.readonly}" ?checked="${e.checked}" ?required="${e.required}"> <label class="form-check-label" for="${e.id}">${e.label} ${e.desc?mf`<small class="form-text text-muted">${e.desc}</small>`:""}</label></fieldset>`,DA=e=>mf`<p>${e.text}</p>`,RA=e=>mf`<div class="mb-3">${"hidden"!==e.type?mf`<label for="${e.id}" class="form-label">${e.label} ${e.desc?mf`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""} ${"password"===e.type&&e.fixed_username?mf`<input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.fixed_username}">`:""} <input autocomplete="${e.autocomplete||""}" class="form-control" id="${e.id}" name="${e.name}" placeholder="${e.placeholder||""}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`,zA=e=>{var t;return mf`<div class="mb-3"><label for="${e.id}" class="form-label">${e.label}</label> <select class="form-control" id="${e.id}" name="${e.name}" ?multiple="${e.multiple}">${null===(t=e.options)||void 0===t?void 0:t.map((e=>(e=>mf`<option value="${e.value}" ?selected="${e.selected}">${e.label}</option>`)(e)))}</select></div>`},LA=e=>{const t=Up.getUniqueId();return mf`<div class="mb-3"><label class="form-label label-ta" for="${e.id}">${e.label} ${e.desc?mf`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <textarea name="${e.name}" id="${t}" ?readonly="${e.readonly}" ?required="${e.required}" class="form-control">${e.value}</textarea></div>`},UA=e=>mf`<div class="mb-3"><label for="${e.id}" class="form-label">${e.label} ${e.desc?mf`<small id="o.id" class="form-text text-muted">${e.desc}</small>`:""}</label><div><a class="form-url" target="_blank" rel="noopener" id="${e.id}" href="${e.value}">${e.value}</a></div></div>`,BA=e=>mf`<div class="mb-3">${"hidden"!==e.type?mf`<label for="${e.id}" class="form-label">${e.label} ${e.desc?mf`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""}<div class="input-group"><input name="${e.name}" class="form-control" id="${e.id}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"> ${e.domain?mf`<div class="input-group-append"><div class="input-group-text" title="${e.domain}">${e.domain}</div></div>`:""}</div></div>`;function FA(e){e.preventDefault(),Wu.rooms.open(e.target.href)}const qA=(e,t)=>"xmpp:"===e.protocol&&null!=e.searchParams.get("join")?mf`<a target="_blank" rel="noopener" @click="${FA}" href="${e.href}">${t}</a>`:mf`<a target="_blank" rel="noopener" href="${e.href}">${t}</a>`;function HA(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function GA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){HA(e,t,n[t])}))}return e}function WA(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{sizzle:VA,Strophe:KA,dayjs:JA}=Hp.env,{isValidURL:YA}=Up,XA=["http:","https:","xmpp:","mailto:"],QA=/\s*\n\s*/;function ZA(e){let t;(e instanceof ds||e instanceof Ls)&&(e=e.tree());const n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,(e=>"body"===e.parentElement.nodeName.toLowerCase()?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT));for(;t=r.nextNode();)n.push(t);return n.forEach((e=>QA.test(e.data)&&e.parentElement.removeChild(e))),e}function ej(e,t){return{"muc#roomconfig_lang":"language","muc#roomconfig_roomsecret":(null==t?void 0:t.new_password)?"new-password":"current-password"}[e]}function tj(e){const t=e.getAttribute("name");if(!t)return null;let n;return n="checkbox"===e.getAttribute("type")?e.checked?1:0:"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?Up.getSelectValues(e):e.value,{name:t,value:n}}function nj(e){try{const t=Up.getURL(e);return decodeURI(t.pathname.split("/").pop())}catch(t){return Q.debug(t),e}}function rj(e){return Array.from(e.children).reduce(((e,t)=>t instanceof HTMLElement?e+t.offsetHeight:e),0)}function ij(e,t){return t instanceof Element&&t.classList.contains(e)}function sj(e,t){return t instanceof Element&&t.classList.add(e),t}function oj(e,t){return t instanceof Element&&t.classList.remove(e),t}function aj(e){return e instanceof Element&&e.parentNode&&e.parentNode.removeChild(e),e}function cj(e,t){let n=e;for(;null!==n&&!VA.matchesSelector(n,t);)n=n.parentElement;return n}function lj(e){const t=RegExp("^w{3}.","ig").test(e)?`http://${e}`:e;try{const n=Up.getURL(t);return function(e,t=XA){return!!t.includes(e)}(n.protocol)?qA(n,e):e}catch(e){Q.debug(e)}}function uj(e,t=200){return new Promise(((n,r)=>{if(!e){const e="An element needs to be passed in to slideOut";return Q.warn(e),void r(new Error(e))}const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const s=rj(e);if(Wu.settings.get("disable_effects"))return e.style.height=s+"px",function(e){e.removeAttribute("data-slider-marker"),e.classList.remove("collapsed"),e.style.overflow="",e.style.height=""}(e),void n();if(!ij("collapsed",e)&&!ij("hidden",e))return void n();const o=t/17;let a=0;e.style.height="0",e.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("collapsed"),e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a+=s/o,a<s?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.style.height=rj(e)+"px",e.style.overflow="",e.style.height="",n())})).toString())}))}function dj(e,t=200){return new Promise(((n,r)=>{if(!e){const e="An element needs to be passed in to slideIn";return Q.warn(e),r(new Error(e))}if(ij("collapsed",e))return n(e);if(Wu.settings.get("disable_effects"))return e.classList.add("collapsed"),e.style.height="",n(e);const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const s=e.offsetHeight,o=t/17;let a=s;e.style.overflow="hidden",e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a-=s/o,a>0?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.classList.add("collapsed"),e.style.height="",n(e))})).toString())}))}function hj(e,t={}){const n={id:Up.getUniqueId(),name:e.var};if("list-single"===e.type||"list-multi"===e.type)return zA(WA(GA({},n,e),{multiple:"list-multi"===e.type}));if("fixed"===e.type)return DA(e);if("jid-multi"===e.type)return LA(GA({},n,e));if("boolean"===e.type)return PA(GA({},n,e));if("username"===e.var)return BA(GA(WA(GA({},n),{domain:t.domain?" @"+t.domain:""}),e));if("password"===e.var)return RA(WA(GA({},n,e),{autocomplete:ej(e.var,t),fixed_username:null==t?void 0:t.fixed_username,type:"password"}));if("ocr"===e.var)return IA(WA(GA({},n,e),{data:e.uri.data,type:e.uri.type}));if("hidden"===e.type||"url"!==e.var&&"uri"!==e.var&&!YA(e.value)){if("datetime"===e.type||"date"===e.type){const t=e.value?JA(e.value):null,r=(null==t?void 0:t.isValid())?"datetime"===e.type?t.format("YYYY-MM-DDTHH:mm:ss"):t.format("YYYY-MM-DD"):null;return MA(WA(GA({},n,e),{value:r}))}return RA(WA(GA({},n,e),{autocomplete:ej(e.var,t),placeholder:null}))}return UA(e)}function fj(e,t=!1){let n=e.offsetWidth;if(!t)return n;const r=window.getComputedStyle(e);return n+=parseInt(r.marginLeft?r.marginLeft:"0",10)+parseInt(r.marginRight?r.marginRight:"0",10),n}let pj;function mj(){return pj||(pj=document.querySelector("converse-root")||document.createElement("converse-root")),pj}Object.assign(Up,{addClass:sj,ancestor:cj,calculateElementHeight:rj,escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getElementFromTemplateResult:function(e){const t=document.createElement("div");return Pf(e,t),t.firstElementChild},getNextElement:function(e,t="*"){let n=e.nextElementSibling;for(;null!==n&&!VA.matchesSelector(n,t);)n=n.nextElementSibling;return n},getOuterWidth:fj,getRootElement:mj,hasClass:ij,hideElement:function(e){return e instanceof Element&&e.classList.add("hidden"),e},isEqualNode:function(e,t){if(!Up.isElement(e))throw new Error("Element being compared must be an Element!");e=ZA(e),t=ZA(t);let n=e.isEqualNode(t);if(!n){const{xmlHtmlNode:r}=KA,i=KA.serialize(e),s=KA.serialize(t);n=i===s||r(i).isEqualNode(r(s))}return n},isInDOM:function(e){return document.querySelector("body").contains(e)},isVisible:function(e){return null!==e&&(!ij("hidden",e)&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0))},nextUntil:function(e,t){const n=[];let r=e.nextElementSibling;for(;null!==r&&!r.matches(t);)n.push(r),r=r.nextElementSibling;return n},removeClass:oj,removeElement:aj,showElement:function(e){oj("collapsed",e),oj("hidden",e)},slideIn:dj,slideOut:uj,unescapeHTML:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText},xFormField2TemplateResult:hj});const gj=Up;function vj(e){let t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}function yj(e){let t=0;do{isNaN(e.offsetLeft)||(t+=e.offsetLeft)}while(e=e.offsetParent);return t}const{keycodes:bj}=Hp;class _j{static get DIRECTION(){return{down:"down",end:"end",home:"home",left:"left",right:"right",up:"up"}}static get DEFAULTS(){return{home:[`${bj.SHIFT}${bj.UP_ARROW}`],end:[`${bj.SHIFT}${bj.DOWN_ARROW}`],up:[bj.UP_ARROW],down:[bj.DOWN_ARROW],left:[bj.LEFT_ARROW,`${bj.SHIFT}${bj.TAB}`],right:[bj.RIGHT_ARROW,bj.TAB],getSelector:null,jump_to_picked:null,jump_to_picked_direction:null,jump_to_picked_selector:"picked",onSelected:null,selected:"selected",selector:"li"}}static getClosestElement(e,t){return e.reduce(((e,n)=>{const r=t(n);return r<e.distance?{distance:r,element:n}:e}),{distance:1/0,element:null}).element}init(){this.selected=null,this.keydownHandler=null,this.elements={},this.keys={},this.options.down.forEach((e=>this.keys[e]=_j.DIRECTION.down)),this.options.end.forEach((e=>this.keys[e]=_j.DIRECTION.end)),this.options.home.forEach((e=>this.keys[e]=_j.DIRECTION.home)),this.options.left.forEach((e=>this.keys[e]=_j.DIRECTION.left)),this.options.right.forEach((e=>this.keys[e]=_j.DIRECTION.right)),this.options.up.forEach((e=>this.keys[e]=_j.DIRECTION.up))}enable(){this.getElements(),this.keydownHandler=e=>this.handleKeydown(e);gj.getRootElement().addEventListener("keydown",this.keydownHandler),this.enabled=!0}disable(){if(this.keydownHandler){gj.getRootElement().removeEventListener("keydown",this.keydownHandler)}this.unselect(),this.elements={},this.enabled=!1}destroy(){this.disable()}getNextElement(e){let t;if(e===_j.DIRECTION.home)t=this.getElements(e)[0];else if(e===_j.DIRECTION.end)t=Array.from(this.getElements(e)).pop();else if(this.selected)if(e===_j.DIRECTION.right){const n=this.getElements(e);t=n.slice(n.indexOf(this.selected))[1]}else if(e==_j.DIRECTION.left){const n=this.getElements(e);t=n.slice(0,n.indexOf(this.selected)).pop()||this.selected}else if(e==_j.DIRECTION.down){const e=this.selected.offsetLeft,n=this.selected.offsetTop+this.selected.offsetHeight,r=this.elementsAfter(0,n),i=t=>Math.abs(t.offsetLeft-e)+Math.abs(t.offsetTop-n);t=_j.getClosestElement(r,i)}else{if(e!=_j.DIRECTION.up)throw new Error("getNextElement: invalid direction value");{const e=this.selected.offsetLeft,n=this.selected.offsetTop-1,r=this.elementsBefore(1/0,n),i=t=>Math.abs(e-t.offsetLeft)+Math.abs(n-t.offsetTop);t=_j.getClosestElement(r,i)}}else t=e===_j.DIRECTION.right||e===_j.DIRECTION.down?this.getElements(e)[1]:this.getElements(e)[0];return this.options.jump_to_picked&&t&&t.matches(this.options.jump_to_picked)&&e===this.options.jump_to_picked_direction&&(t=this.container.querySelector(this.options.jump_to_picked_selector)||t),t}select(e,t){e&&e!==this.selected&&(this.unselect(),t&&this.scrollTo(e,t),e.matches("input")?e.focus():gj.addClass(this.options.selected,e),this.selected=e,this.options.onSelected&&this.options.onSelected(e))}unselect(){this.selected&&(gj.removeClass(this.options.selected,this.selected),delete this.selected)}scrollTo(e,t){if(this.inScrollContainerViewport(e)){if(!function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(e))switch(t){case _j.DIRECTION.left:document.body.scrollLeft=yj(e)-document.body.offsetLeft;break;case _j.DIRECTION.up:document.body.scrollTop=vj(e)-document.body.offsetTop;break;case _j.DIRECTION.right:document.body.scrollLeft=yj(e)-document.body.offsetLeft-(document.documentElement.clientWidth-e.offsetWidth);break;case _j.DIRECTION.down:document.body.scrollTop=vj(e)-document.body.offsetTop-(document.documentElement.clientHeight-e.offsetHeight)}}else{const n=this.scroll_container;if(!n.contains(e))return;switch(t){case _j.DIRECTION.left:n.scrollLeft=e.offsetLeft-n.offsetLeft,n.scrollTop=e.offsetTop-n.offsetTop;break;case _j.DIRECTION.up:n.scrollTop=e.offsetTop-n.offsetTop;break;case _j.DIRECTION.right:n.scrollLeft=e.offsetLeft-n.offsetLeft-(n.offsetWidth-e.offsetWidth),n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight);break;case _j.DIRECTION.down:n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight)}}}inScrollContainerViewport(e){const t=this.scroll_container;return!(e.offsetLeft-t.scrollLeft<t.offsetLeft)&&(!(e.offsetTop-t.scrollTop<t.offsetTop)&&(!(e.offsetLeft+e.offsetWidth-t.scrollLeft>t.offsetLeft+t.offsetWidth)&&!(e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetTop+t.offsetHeight)))}getElements(e){const t=this.options.getSelector?this.options.getSelector(e):this.options.selector;return this.elements[t]||(this.elements[t]=Array.from(this.container.querySelectorAll(t))),this.elements[t]}elementsAfter(e,t){return this.getElements(_j.DIRECTION.down).filter((n=>n.offsetLeft>=e&&n.offsetTop>=t))}elementsBefore(e,t){return this.getElements(_j.DIRECTION.up).filter((n=>n.offsetLeft<=e&&n.offsetTop<=t))}handleKeydown(e){const t=bj,n=e.shiftKey?this.keys[`${t.SHIFT}${e.key}`]:this.keys[e.key];if(n){e.preventDefault(),e.stopPropagation();const t=this.getNextElement(n);this.select(t,n)}}constructor(e,t){this.container=e,this.scroll_container=t.scroll_container||e,this.options=Object.assign({},_j.DEFAULTS,t),this.init()}}const wj=_j;var Sj="top",xj="bottom",Aj="right",jj="left",$j="auto",Ej=[Sj,xj,Aj,jj],Oj="start",Cj="end",kj="clippingParents",Tj="viewport",Nj="popper",Mj="reference",Ij=Ej.reduce((function(e,t){return e.concat([t+"-"+Oj,t+"-"+Cj])}),[]),Pj=[].concat(Ej,[$j]).reduce((function(e,t){return e.concat([t,t+"-"+Oj,t+"-"+Cj])}),[]),Dj="beforeRead",Rj="read",zj="afterRead",Lj="beforeMain",Uj="main",Bj="afterMain",Fj="beforeWrite",qj="write",Hj="afterWrite",Gj=[Dj,Rj,zj,Lj,Uj,Bj,Fj,qj,Hj];function Wj(e){return e?(e.nodeName||"").toLowerCase():null}function Vj(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Kj(e){return e instanceof Vj(e).Element||e instanceof Element}function Jj(e){return e instanceof Vj(e).HTMLElement||e instanceof HTMLElement}function Yj(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Vj(e).ShadowRoot||e instanceof ShadowRoot)}const Xj={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];Jj(i)&&Wj(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});Jj(r)&&Wj(r)&&(Object.assign(r.style,s),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]};function Qj(e){return e.split("-")[0]}var Zj=Math.max,e$=Math.min,t$=Math.round;function n$(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function r$(){return!/^((?!chrome|android).)*safari/i.test(n$())}function i$(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=e.getBoundingClientRect(),i=1,s=1;t&&Jj(e)&&(i=e.offsetWidth>0&&t$(r.width)/e.offsetWidth||1,s=e.offsetHeight>0&&t$(r.height)/e.offsetHeight||1);var o=(Kj(e)?Vj(e):window).visualViewport,a=!r$()&&n,c=(r.left+(a&&o?o.offsetLeft:0))/i,l=(r.top+(a&&o?o.offsetTop:0))/s,u=r.width/i,d=r.height/s;return{width:u,height:d,top:l,right:c+u,bottom:l+d,left:c,x:c,y:l}}function s$(e){var t=i$(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function o$(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&Yj(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function a$(e){return Vj(e).getComputedStyle(e)}function c$(e){return["table","td","th"].indexOf(Wj(e))>=0}function l$(e){return((Kj(e)?e.ownerDocument:e.document)||window.document).documentElement}function u$(e){return"html"===Wj(e)?e:e.assignedSlot||e.parentNode||(Yj(e)?e.host:null)||l$(e)}function d$(e){return Jj(e)&&"fixed"!==a$(e).position?e.offsetParent:null}function h$(e){for(var t=Vj(e),n=d$(e);n&&c$(n)&&"static"===a$(n).position;)n=d$(n);return n&&("html"===Wj(n)||"body"===Wj(n)&&"static"===a$(n).position)?t:n||function(e){var t=/firefox/i.test(n$());if(/Trident/i.test(n$())&&Jj(e)&&"fixed"===a$(e).position)return null;var n=u$(e);for(Yj(n)&&(n=n.host);Jj(n)&&["html","body"].indexOf(Wj(n))<0;){var r=a$(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(e)||t}function f$(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function p$(e,t,n){return Zj(e,e$(t,n))}function m$(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function g$(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}const v$={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,i=e.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=Qj(n.placement),c=f$(a),l=[jj,Aj].indexOf(a)>=0?"height":"width";if(s&&o){var u=function(e,t){return m$("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:g$(e,Ej))}(i.padding,n),d=s$(s),h="y"===c?Sj:jj,f="y"===c?xj:Aj,p=n.rects.reference[l]+n.rects.reference[c]-o[c]-n.rects.popper[l],m=o[c]-n.rects.reference[c],g=h$(s),v=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,y=p/2-m/2,b=u[h],_=v-d[l]-u[f],w=v/2-d[l]/2+y,S=p$(b,w,_),x=c;n.modifiersData[r]=((t={})[x]=S,t.centerOffset=S-w,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&o$(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function y$(e){return e.split("-")[1]}var b$={top:"auto",right:"auto",bottom:"auto",left:"auto"};function _$(e){var t,n=e.popper,r=e.popperRect,i=e.placement,s=e.variation,o=e.offsets,a=e.position,c=e.gpuAcceleration,l=e.adaptive,u=e.roundOffsets,d=e.isFixed,h=o.x,f=void 0===h?0:h,p=o.y,m=void 0===p?0:p,g="function"==typeof u?u({x:f,y:m}):{x:f,y:m};f=g.x,m=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),b=jj,_=Sj,w=window;if(l){var S=h$(n),x="clientHeight",A="clientWidth";if(S===Vj(n)&&"static"!==a$(S=l$(n)).position&&"absolute"===a&&(x="scrollHeight",A="scrollWidth"),i===Sj||(i===jj||i===Aj)&&s===Cj)_=xj,m-=(d&&S===w&&w.visualViewport?w.visualViewport.height:S[x])-r.height,m*=c?1:-1;if(i===jj||(i===Sj||i===xj)&&s===Cj)b=Aj,f-=(d&&S===w&&w.visualViewport?w.visualViewport.width:S[A])-r.width,f*=c?1:-1}var j,$=Object.assign({position:a},l&&b$),E=!0===u?function(e,t){var n=e.x,r=e.y,i=t.devicePixelRatio||1;return{x:t$(n*i)/i||0,y:t$(r*i)/i||0}}({x:f,y:m},Vj(n)):{x:f,y:m};return f=E.x,m=E.y,c?Object.assign({},$,((j={})[_]=y?"0":"",j[b]=v?"0":"",j.transform=(w.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",j)):Object.assign({},$,((t={})[_]=y?m+"px":"",t[b]=v?f+"px":"",t.transform="",t))}const w$={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,s=n.adaptive,o=void 0===s||s,a=n.roundOffsets,c=void 0===a||a,l={placement:Qj(t.placement),variation:y$(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,_$(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,_$(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var S$={passive:!0};const x$={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,s=void 0===i||i,o=r.resize,a=void 0===o||o,c=Vj(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&l.forEach((function(e){e.addEventListener("scroll",n.update,S$)})),a&&c.addEventListener("resize",n.update,S$),function(){s&&l.forEach((function(e){e.removeEventListener("scroll",n.update,S$)})),a&&c.removeEventListener("resize",n.update,S$)}},data:{}};var A$={left:"right",right:"left",bottom:"top",top:"bottom"};function j$(e){return e.replace(/left|right|bottom|top/g,(function(e){return A$[e]}))}var $$={start:"end",end:"start"};function E$(e){return e.replace(/start|end/g,(function(e){return $$[e]}))}function O$(e){var t=Vj(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function C$(e){return i$(l$(e)).left+O$(e).scrollLeft}function k$(e){var t=a$(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function T$(e){return["html","body","#document"].indexOf(Wj(e))>=0?e.ownerDocument.body:Jj(e)&&k$(e)?e:T$(u$(e))}function N$(e,t){var n;void 0===t&&(t=[]);var r=T$(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),s=Vj(r),o=i?[s].concat(s.visualViewport||[],k$(r)?r:[]):r,a=t.concat(o);return i?a:a.concat(N$(u$(o)))}function M$(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function I$(e,t,n){return t===Tj?M$(function(e,t){var n=Vj(e),r=l$(e),i=n.visualViewport,s=r.clientWidth,o=r.clientHeight,a=0,c=0;if(i){s=i.width,o=i.height;var l=r$();(l||!l&&"fixed"===t)&&(a=i.offsetLeft,c=i.offsetTop)}return{width:s,height:o,x:a+C$(e),y:c}}(e,n)):Kj(t)?function(e,t){var n=i$(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):M$(function(e){var t,n=l$(e),r=O$(e),i=null==(t=e.ownerDocument)?void 0:t.body,s=Zj(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=Zj(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+C$(e),c=-r.scrollTop;return"rtl"===a$(i||n).direction&&(a+=Zj(n.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:c}}(l$(e)))}function P$(e,t,n,r){var i="clippingParents"===t?function(e){var t=N$(u$(e)),n=["absolute","fixed"].indexOf(a$(e).position)>=0&&Jj(e)?h$(e):e;return Kj(n)?t.filter((function(e){return Kj(e)&&o$(e,n)&&"body"!==Wj(e)})):[]}(e):[].concat(t),s=[].concat(i,[n]),o=s[0],a=s.reduce((function(t,n){var i=I$(e,n,r);return t.top=Zj(i.top,t.top),t.right=e$(i.right,t.right),t.bottom=e$(i.bottom,t.bottom),t.left=Zj(i.left,t.left),t}),I$(e,o,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function D$(e){var t,n=e.reference,r=e.element,i=e.placement,s=i?Qj(i):null,o=i?y$(i):null,a=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(s){case Sj:t={x:a,y:n.y-r.height};break;case xj:t={x:a,y:n.y+n.height};break;case Aj:t={x:n.x+n.width,y:c};break;case jj:t={x:n.x-r.width,y:c};break;default:t={x:n.x,y:n.y}}var l=s?f$(s):null;if(null!=l){var u="y"===l?"height":"width";switch(o){case Oj:t[l]=t[l]-(n[u]/2-r[u]/2);break;case Cj:t[l]=t[l]+(n[u]/2-r[u]/2)}}return t}function R$(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=void 0===r?e.placement:r,s=n.strategy,o=void 0===s?e.strategy:s,a=n.boundary,c=void 0===a?kj:a,l=n.rootBoundary,u=void 0===l?Tj:l,d=n.elementContext,h=void 0===d?Nj:d,f=n.altBoundary,p=void 0!==f&&f,m=n.padding,g=void 0===m?0:m,v=m$("number"!=typeof g?g:g$(g,Ej)),y=h===Nj?Mj:Nj,b=e.rects.popper,_=e.elements[p?y:h],w=P$(Kj(_)?_:_.contextElement||l$(e.elements.popper),c,u,o),S=i$(e.elements.reference),x=D$({reference:S,element:b,strategy:"absolute",placement:i}),A=M$(Object.assign({},b,x)),j=h===Nj?A:S,$={top:w.top-j.top+v.top,bottom:j.bottom-w.bottom+v.bottom,left:w.left-j.left+v.left,right:j.right-w.right+v.right},E=e.modifiersData.offset;if(h===Nj&&E){var O=E[i];Object.keys($).forEach((function(e){var t=[Aj,xj].indexOf(e)>=0?1:-1,n=[Sj,xj].indexOf(e)>=0?"y":"x";$[e]+=O[n]*t}))}return $}const z$={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0===o||o,c=n.fallbackPlacements,l=n.padding,u=n.boundary,d=n.rootBoundary,h=n.altBoundary,f=n.flipVariations,p=void 0===f||f,m=n.allowedAutoPlacements,g=t.options.placement,v=Qj(g),y=c||(v===g||!p?[j$(g)]:function(e){if(Qj(e)===$j)return[];var t=j$(e);return[E$(e),t,E$(t)]}(g)),b=[g].concat(y).reduce((function(e,n){return e.concat(Qj(n)===$j?function(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?Pj:c,u=y$(r),d=u?a?Ij:Ij.filter((function(e){return y$(e)===u})):Ej,h=d.filter((function(e){return l.indexOf(e)>=0}));0===h.length&&(h=d);var f=h.reduce((function(t,n){return t[n]=R$(e,{placement:n,boundary:i,rootBoundary:s,padding:o})[Qj(n)],t}),{});return Object.keys(f).sort((function(e,t){return f[e]-f[t]}))}(t,{placement:n,boundary:u,rootBoundary:d,padding:l,flipVariations:p,allowedAutoPlacements:m}):n)}),[]),_=t.rects.reference,w=t.rects.popper,S=new Map,x=!0,A=b[0],j=0;j<b.length;j++){var $=b[j],E=Qj($),O=y$($)===Oj,C=[Sj,xj].indexOf(E)>=0,k=C?"width":"height",T=R$(t,{placement:$,boundary:u,rootBoundary:d,altBoundary:h,padding:l}),N=C?O?Aj:jj:O?xj:Sj;_[k]>w[k]&&(N=j$(N));var M=j$(N),I=[];if(s&&I.push(T[E]<=0),a&&I.push(T[N]<=0,T[M]<=0),I.every((function(e){return e}))){A=$,x=!1;break}S.set($,I)}if(x)for(var P=function(e){var t=b.find((function(t){var n=S.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return A=t,"break"},D=p?3:1;D>0;D--){if("break"===P(D))break}t.placement!==A&&(t.modifiersData[r]._skip=!0,t.placement=A,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function L$(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function U$(e){return[Sj,Aj,xj,jj].some((function(t){return e[t]>=0}))}const B$={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,s=t.modifiersData.preventOverflow,o=R$(t,{elementContext:"reference"}),a=R$(t,{altBoundary:!0}),c=L$(o,r),l=L$(a,i,s),u=U$(c),d=U$(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}};const F$={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.offset,s=void 0===i?[0,0]:i,o=Pj.reduce((function(e,n){return e[n]=function(e,t,n){var r=Qj(e),i=[jj,Sj].indexOf(r)>=0?-1:1,s="function"==typeof n?n(Object.assign({},t,{placement:e})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[jj,Aj].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}(n,t.rects,s),e}),{}),a=o[t.placement],c=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[r]=o}};const q$={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=D$({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};const H$={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0!==o&&o,c=n.boundary,l=n.rootBoundary,u=n.altBoundary,d=n.padding,h=n.tether,f=void 0===h||h,p=n.tetherOffset,m=void 0===p?0:p,g=R$(t,{boundary:c,rootBoundary:l,padding:d,altBoundary:u}),v=Qj(t.placement),y=y$(t.placement),b=!y,_=f$(v),w="x"===_?"y":"x",S=t.modifiersData.popperOffsets,x=t.rects.reference,A=t.rects.popper,j="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,$="number"==typeof j?{mainAxis:j,altAxis:j}:Object.assign({mainAxis:0,altAxis:0},j),E=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,O={x:0,y:0};if(S){if(s){var C,k="y"===_?Sj:jj,T="y"===_?xj:Aj,N="y"===_?"height":"width",M=S[_],I=M+g[k],P=M-g[T],D=f?-A[N]/2:0,R=y===Oj?x[N]:A[N],z=y===Oj?-A[N]:-x[N],L=t.elements.arrow,U=f&&L?s$(L):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},F=B[k],q=B[T],H=p$(0,x[N],U[N]),G=b?x[N]/2-D-H-F-$.mainAxis:R-H-F-$.mainAxis,W=b?-x[N]/2+D+H+q+$.mainAxis:z+H+q+$.mainAxis,V=t.elements.arrow&&h$(t.elements.arrow),K=V?"y"===_?V.clientTop||0:V.clientLeft||0:0,J=null!=(C=null==E?void 0:E[_])?C:0,Y=M+W-J,X=p$(f?e$(I,M+G-J-K):I,M,f?Zj(P,Y):P);S[_]=X,O[_]=X-M}if(a){var Q,Z="x"===_?Sj:jj,ee="x"===_?xj:Aj,te=S[w],ne="y"===w?"height":"width",re=te+g[Z],ie=te-g[ee],se=-1!==[Sj,jj].indexOf(v),oe=null!=(Q=null==E?void 0:E[w])?Q:0,ae=se?re:te-x[ne]-A[ne]-oe+$.altAxis,ce=se?te+x[ne]+A[ne]-oe-$.altAxis:ie,le=f&&se?function(e,t,n){var r=p$(e,t,n);return r>n?n:r}(ae,te,ce):p$(f?ae:re,te,f?ce:ie);S[w]=le,O[w]=le-te}t.modifiersData[r]=O}},requiresIfExists:["offset"]};function G$(e,t,n){void 0===n&&(n=!1);var r,i,s=Jj(t),o=Jj(t)&&function(e){var t=e.getBoundingClientRect(),n=t$(t.width)/e.offsetWidth||1,r=t$(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(t),a=l$(t),c=i$(e,o,n),l={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(s||!s&&!n)&&(("body"!==Wj(t)||k$(a))&&(l=(r=t)!==Vj(r)&&Jj(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:O$(r)),Jj(t)?((u=i$(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):a&&(u.x=C$(a))),{x:c.left+l.scrollLeft-u.x,y:c.top+l.scrollTop-u.y,width:c.width,height:c.height}}function W$(e){var t=new Map,n=new Set,r=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),r}var V$={placement:"bottom",modifiers:[],strategy:"absolute"};function K$(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function J$(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,s=void 0===i?V$:i;return function(e,t,n){void 0===n&&(n=s);var i,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},V$,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,u={state:a,setOptions:function(n){var i="function"==typeof n?n(a.options):n;d(),a.options=Object.assign({},s,a.options,i),a.scrollParents={reference:Kj(e)?N$(e):e.contextElement?N$(e.contextElement):[],popper:N$(t)};var o,l,h=function(e){var t=W$(e);return Gj.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((o=[].concat(r,a.options.modifiers),l=o.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(l).map((function(e){return l[e]}))));return a.orderedModifiers=h.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,i=e.effect;if("function"==typeof i){var s=i({state:a,name:t,instance:u,options:r}),o=function(){};c.push(s||o)}})),u.update()},forceUpdate:function(){if(!l){var e=a.elements,t=e.reference,n=e.popper;if(K$(t,n)){a.rects={reference:G$(t,h$(n),"fixed"===a.options.strategy),popper:s$(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<a.orderedModifiers.length;r++)if(!0!==a.reset){var i=a.orderedModifiers[r],s=i.fn,o=i.options,c=void 0===o?{}:o,d=i.name;"function"==typeof s&&(a=s({state:a,options:c,name:d,instance:u})||a)}else a.reset=!1,r=-1}}},update:(i=function(){return new Promise((function(e){u.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(i())}))}))),o}),destroy:function(){d(),l=!0}};if(!K$(e,t))return u;function d(){c.forEach((function(e){return e()})),c=[]}return u.setOptions(n).then((function(e){!l&&n.onFirstUpdate&&n.onFirstUpdate(e)})),u}}var Y$=J$(),X$=J$({defaultModifiers:[x$,q$,w$,Xj,F$,z$,H$,v$,B$]}),Q$=J$({defaultModifiers:[x$,q$,w$,Xj]});const Z$=new Map,eE={set(e,t,n){Z$.has(e)||Z$.set(e,new Map);const r=Z$.get(e);r.has(t)||0===r.size?r.set(t,n):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`)},get:(e,t)=>Z$.has(e)&&Z$.get(e).get(t)||null,remove(e,t){if(!Z$.has(e))return;const n=Z$.get(e);n.delete(t),0===n.size&&Z$.delete(e)}},tE="transitionend",nE=e=>(e&&window.CSS&&window.CSS.escape&&(e=e.replace(/#([^\s"#']+)/g,((e,t)=>`#${CSS.escape(t)}`))),e),rE=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),iE=e=>rE(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(nE(e)):null,sE=e=>{if(!rE(e)||0===e.getClientRects().length)return!1;const t="visible"===getComputedStyle(e).getPropertyValue("visibility"),n=e.closest("details:not([open])");if(!n)return t;if(n!==e){const t=e.closest("summary");if(t&&t.parentNode!==n)return!1;if(null===t)return!1}return t},oE=e=>!e||e.nodeType!==Node.ELEMENT_NODE||(!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled"))),aE=e=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof e.getRootNode){const t=e.getRootNode();return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?aE(e.parentNode):null},cE=()=>{},lE=e=>{e.offsetHeight},uE=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,dE=[],hE=()=>"rtl"===document.documentElement.dir,fE=e=>{var t;t=()=>{const t=uE();if(t){const n=e.NAME,r=t.fn[n];t.fn[n]=e.jQueryInterface,t.fn[n].Constructor=e,t.fn[n].noConflict=()=>(t.fn[n]=r,e.jQueryInterface)}},"loading"===document.readyState?(dE.length||document.addEventListener("DOMContentLoaded",(()=>{for(const e of dE)e()})),dE.push(t)):t()},pE=(e,t=[],n=e)=>"function"==typeof e?e.call(...t):n,mE=(e,t,n=!0)=>{if(!n)return void pE(e);const r=(e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:n}=window.getComputedStyle(e);const r=Number.parseFloat(t),i=Number.parseFloat(n);return r||i?(t=t.split(",")[0],n=n.split(",")[0],1e3*(Number.parseFloat(t)+Number.parseFloat(n))):0})(t)+5;let i=!1;const s=({target:n})=>{n===t&&(i=!0,t.removeEventListener(tE,s),pE(e))};t.addEventListener(tE,s),setTimeout((()=>{i||t.dispatchEvent(new Event(tE))}),r)},gE=/[^.]*(?=\..*)\.|.*/,vE=/\..*/,yE=/::\d+$/,bE={};let _E=1;const wE={mouseenter:"mouseover",mouseleave:"mouseout"},SE=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function xE(e,t){return t&&`${t}::${_E++}`||e.uidEvent||_E++}function AE(e){const t=xE(e);return e.uidEvent=t,bE[t]=bE[t]||{},bE[t]}function jE(e,t,n=null){return Object.values(e).find((e=>e.callable===t&&e.delegationSelector===n))}function $E(e,t,n){const r="string"==typeof t,i=r?n:t||n;let s=kE(e);return SE.has(s)||(s=e),[r,i,s]}function EE(e,t,n,r,i){if("string"!=typeof t||!e)return;let[s,o,a]=$E(t,n,r);if(t in wE){const e=e=>function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)};o=e(o)}const c=AE(e),l=c[a]||(c[a]={}),u=jE(l,o,s?n:null);if(u)return void(u.oneOff=u.oneOff&&i);const d=xE(o,t.replace(gE,"")),h=s?function(e,t,n){return function r(i){const s=e.querySelectorAll(t);for(let{target:o}=i;o&&o!==this;o=o.parentNode)for(const a of s)if(a===o)return NE(i,{delegateTarget:o}),r.oneOff&&TE.off(e,i.type,t,n),n.apply(o,[i])}}(e,n,o):function(e,t){return function n(r){return NE(r,{delegateTarget:e}),n.oneOff&&TE.off(e,r.type,t),t.apply(e,[r])}}(e,o);h.delegationSelector=s?n:null,h.callable=o,h.oneOff=i,h.uidEvent=d,l[d]=h,e.addEventListener(a,h,s)}function OE(e,t,n,r,i){const s=jE(t[n],r,i);s&&(e.removeEventListener(n,s,Boolean(i)),delete t[n][s.uidEvent])}function CE(e,t,n,r){const i=t[n]||{};for(const[s,o]of Object.entries(i))s.includes(r)&&OE(e,t,n,o.callable,o.delegationSelector)}function kE(e){return e=e.replace(vE,""),wE[e]||e}const TE={on(e,t,n,r){EE(e,t,n,r,!1)},one(e,t,n,r){EE(e,t,n,r,!0)},off(e,t,n,r){if("string"!=typeof t||!e)return;const[i,s,o]=$E(t,n,r),a=o!==t,c=AE(e),l=c[o]||{},u=t.startsWith(".");if(void 0===s){if(u)for(const n of Object.keys(c))CE(e,c,n,t.slice(1));for(const[n,r]of Object.entries(l)){const i=n.replace(yE,"");a&&!t.includes(i)||OE(e,c,o,r.callable,r.delegationSelector)}}else{if(!Object.keys(l).length)return;OE(e,c,o,s,i?n:null)}},trigger(e,t,n){if("string"!=typeof t||!e)return null;const r=uE();let i=null,s=!0,o=!0,a=!1;t!==kE(t)&&r&&(i=r.Event(t,n),r(e).trigger(i),s=!i.isPropagationStopped(),o=!i.isImmediatePropagationStopped(),a=i.isDefaultPrevented());const c=NE(new Event(t,{bubbles:s,cancelable:!0}),n);return a&&c.preventDefault(),o&&e.dispatchEvent(c),c.defaultPrevented&&i&&i.preventDefault(),c}};function NE(e,t={}){for(const[n,r]of Object.entries(t))try{e[n]=r}catch(t){Object.defineProperty(e,n,{configurable:!0,get:()=>r})}return e}const ME=TE;function IE(e){if("true"===e)return!0;if("false"===e)return!1;if(e===Number(e).toString())return Number(e);if(""===e||"null"===e)return null;if("string"!=typeof e)return e;try{return JSON.parse(decodeURIComponent(e))}catch(t){return e}}function PE(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}const DE={setDataAttribute(e,t,n){e.setAttribute(`data-bs-${PE(t)}`,n)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${PE(t)}`)},getDataAttributes(e){if(!e)return{};const t={},n=Object.keys(e.dataset).filter((e=>e.startsWith("bs")&&!e.startsWith("bsConfig")));for(const r of n){let n=r.replace(/^bs/,"");n=n.charAt(0).toLowerCase()+n.slice(1),t[n]=IE(e.dataset[r])}return t},getDataAttribute:(e,t)=>IE(e.getAttribute(`data-bs-${PE(t)}`))},RE=DE;function zE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const LE=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const n=rE(t)?RE.getDataAttribute(t,"config"):{};return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){zE(e,t,n[t])}))}return e}({},this.constructor.Default,"object"==typeof n?n:{},rE(t)?RE.getDataAttributes(t):{},"object"==typeof e?e:{})}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[r,i]of Object.entries(t)){const t=e[r],s=rE(t)?"element":null==(n=t)?`${n}`:Object.prototype.toString.call(n).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(i).test(s))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${r}" provided type "${s}" but expected type "${i}".`)}var n}};const UE=class extends LE{dispose(){eE.remove(this._element,this.constructor.DATA_KEY),ME.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,n=!0){mE(e,t,n)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return eE.get(iE(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,"object"==typeof t?t:null)}static get VERSION(){return"5.3.6"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}constructor(e,t){super(),(e=iE(e))&&(this._element=e,this._config=this._getConfig(t),eE.set(this._element,this.constructor.DATA_KEY,this))}},BE=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let n=e.getAttribute("href");if(!n||!n.includes("#")&&!n.startsWith("."))return null;n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),t=n&&"#"!==n?n.trim():null}return t?t.split(",").map((e=>nE(e))).join(","):null},FE={find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter((e=>e.matches(t))),parents(e,t){const n=[];let r=e.parentNode.closest(t);for(;r;)n.push(r),r=r.parentNode.closest(t);return n},prev(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return[n];n=n.previousElementSibling}return[]},next(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return[n];n=n.nextElementSibling}return[]},focusableChildren(e){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((e=>`${e}:not([tabindex^="-"])`)).join(",");return this.find(t,e).filter((e=>!oE(e)&&sE(e)))},getSelectorFromElement(e){const t=BE(e);return t&&FE.findOne(t)?t:null},getElementFromSelector(e){const t=BE(e);return t?FE.findOne(t):null},getMultipleElementsFromSelector(e){const t=BE(e);return t?FE.find(t):[]}},qE=FE;function HE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const GE="dropdown",WE=".bs.dropdown",VE=".data-api",KE="ArrowUp",JE="ArrowDown",YE=`hide${WE}`,XE=`hidden${WE}`,QE=`show${WE}`,ZE=`shown${WE}`,eO=`click${WE}${VE}`,tO=`keydown${WE}${VE}`,nO=`keyup${WE}${VE}`,rO="show",iO='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',sO=`${iO}.${rO}`,oO=".dropdown-menu",aO=hE()?"top-end":"top-start",cO=hE()?"top-start":"top-end",lO=hE()?"bottom-end":"bottom-start",uO=hE()?"bottom-start":"bottom-end",dO=hE()?"left-start":"right-start",hO=hE()?"right-start":"left-start",fO={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},pO={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class mO extends UE{static get Default(){return fO}static get DefaultType(){return pO}static get NAME(){return GE}toggle(){return this._isShown()?this.hide():this.show()}show(){if(oE(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!ME.trigger(this._element,QE,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const e of[].concat(...document.body.children))ME.on(e,"mouseover",cE);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(rO),this._element.classList.add(rO),ME.trigger(this._element,ZE,e)}}hide(){if(oE(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!ME.trigger(this._element,YE,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))ME.off(e,"mouseover",cE);this._popper&&this._popper.destroy(),this._menu.classList.remove(rO),this._element.classList.remove(rO),this._element.setAttribute("aria-expanded","false"),RE.removeDataAttribute(this._menu,"popper"),ME.trigger(this._element,XE,e),this._element.focus()}}_getConfig(e){if("object"==typeof(e=super._getConfig(e)).reference&&!rE(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${GE.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){let e=this._element;"parent"===this._config.reference?e=this._parent:rE(this._config.reference)?e=iE(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference);const t=this._getPopperConfig();this._popper=X$(e,this._menu,t)}_isShown(){return this._menu.classList.contains(rO)}_getPlacement(){const e=this._parent;if(e.classList.contains("dropend"))return dO;if(e.classList.contains("dropstart"))return hO;if(e.classList.contains("dropup-center"))return"top";if(e.classList.contains("dropdown-center"))return"bottom";const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return e.classList.contains("dropup")?t?cO:aO:t?uO:lO}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(RE.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){HE(e,t,n[t])}))}return e}({},e,pE(this._config.popperConfig,[void 0,e]))}_selectMenuItem({key:e,target:t}){const n=qE.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((e=>sE(e)));n.length&&((e,t,n,r)=>{const i=e.length;let s=e.indexOf(t);return-1===s?!n&&r?e[i-1]:e[0]:(s+=n?1:-1,r&&(s=(s+i)%i),e[Math.max(0,Math.min(s,i-1))])})(n,t,e===JE,!n.includes(t)).focus()}static jQueryInterface(e){return this.each((function(){const t=mO.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}static clearMenus(e){if(2===e.button||"keyup"===e.type&&"Tab"!==e.key)return;const t=qE.find(sO);for(const n of t){const t=mO.getInstance(n);if(!t||!1===t._config.autoClose)continue;const r=e.composedPath(),i=r.includes(t._menu);if(r.includes(t._element)||"inside"===t._config.autoClose&&!i||"outside"===t._config.autoClose&&i)continue;if(t._menu.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const s={relatedTarget:t._element};"click"===e.type&&(s.clickEvent=e),t._completeHide(s)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),n="Escape"===e.key,r=[KE,JE].includes(e.key);if(!r&&!n)return;if(t&&!n)return;e.preventDefault();const i=this.matches(iO)?this:qE.prev(this,iO)[0]||qE.next(this,iO)[0]||qE.findOne(iO,e.delegateTarget.parentNode),s=mO.getOrCreateInstance(i);if(r)return e.stopPropagation(),s.show(),void s._selectMenuItem(e);s._isShown()&&(e.stopPropagation(),s.hide(),i.focus())}constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=qE.next(this._element,oO)[0]||qE.prev(this._element,oO)[0]||qE.findOne(oO,this._parent),this._inNavbar=this._detectNavbar()}}ME.on(document,tO,iO,mO.dataApiKeydownHandler),ME.on(document,tO,oO,mO.dataApiKeydownHandler),ME.on(document,eO,mO.clearMenus),ME.on(document,nO,mO.clearMenus),ME.on(document,eO,iO,(function(e){e.preventDefault(),mO.getOrCreateInstance(this).toggle()})),fE(mO);const gO=mO;class vO extends uA{firstUpdated(e){super.firstUpdated(e),this.menu=this.querySelector(".dropdown-menu"),this.button=this.querySelector("button"),this.dropdown=new gO(this.button)}}ME.off(document,"keydown.bs.dropdown.data-api");var yO=n(1353),bO={};bO.styleTagTransform=D(),bO.setAttributes=N(),bO.insert=k().bind(null,"head"),bO.domAPI=O(),bO.insertStyleElement=I();$()(yO.A,bO);yO.A&&yO.A.locals&&yO.A.locals;Wu.elements.define("converse-icon",class extends uA{static get properties(){return{color:{type:String},class_name:{attribute:"class"},css:{type:String},size:{type:String}}}getSource(){return`#icon-${this.class_name.trim().split(" ")[1].replace("fa-","")}`}getStyles(){var e;const t=null===(e=this.color.match(/var\((--.*)\)/))||void 0===e?void 0:e[1],n=t?getComputedStyle(this).getPropertyValue(t):this.color;return`\n            ${this.size?`width: ${this.size};`:""}\n            ${this.size?`height: ${this.size};`:""}\n            ${n?`fill: ${n};`:""}\n            ${this.css}\n        `}render(){return mf`<svg .style="${this.getStyles()}"><use href="${this.getSource()}"></use></svg>`}constructor(){super(),this.class_name="",this.css="",this.size="",this.color=""}});var _O=n(3557),wO={};wO.styleTagTransform=D(),wO.setAttributes=N(),wO.insert=k().bind(null,"head"),wO.domAPI=O(),wO.insertStyleElement=I();$()(_O.A,wO);_O.A&&_O.A.locals&&_O.A.locals;function SO(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}const{KEYCODES:xO}=Xx;var AO=new WeakSet;class jO extends vO{static get properties(){return{icon_classes:{type:String},items:{type:Array}}}render(){return mf`<button class="btn btn--transparent btn--standalone dropdown-toggle dropdown-toggle--no-caret" id="${this.id}" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="${aA("Menu")}"><converse-icon aria-hidden="true" size="1em" class="${this.icon_classes}"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}">${this.items.map((e=>mf`<li>${NA(e,"")}</li>`))}</ul>`}firstUpdated(){super.firstUpdated(),this.initArrowNavigation()}connectedCallback(){super.connectedCallback(),this.registerEvents()}disconnectedCallback(){this.removeEventListener("keydown",this.onKeyDown),this.disableArrowNavigation(),super.disconnectedCallback()}registerEvents(){this.onKeyDown=e=>function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(this,AO,$O).call(this,e),this.addEventListener("hide.bs.dropdown",(()=>this.onDropdownHide())),this.addEventListener("keydown",this.onKeyDown)}onDropdownHide(){this.disableArrowNavigation()}initArrowNavigation(){if(!this.navigator){const e={selector:".dropdown-menu li",onSelected:e=>e.focus()};this.navigator=new wj(this.menu,e)}}disableArrowNavigation(){var e;null===(e=this.navigator)||void 0===e||e.disable()}enableArrowNavigation(e){null==e||e.preventDefault(),null==e||e.stopPropagation(),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.select(this.menu.firstElementChild)}onEnterPressed(e){var t,n;e.preventDefault(),e.stopPropagation(),null===(n=this.navigator.selected)||void 0===n||null===(t=n.querySelector("a"))||void 0===t||t.click(),this.dropdown.hide()}constructor(){super(),SO(this,AO),this.icon_classes="fa fa-bars",this.items=[],this.id=Up.getUniqueId()}}function $O(e){this.navigator&&Up.isVisible(this)&&(e.key===xO.ENTER?this.onEnterPressed(e):e.key!==xO.DOWN_ARROW||this.navigator.enabled?e.key===xO.ESCAPE&&this.dropdown.hide():this.enableArrowNavigation(e))}Wu.elements.define("converse-dropdown",jO);Wu.elements.define("converse-fontawesome",class extends uA{render(){return mf`<?xml version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" style="display:none"><symbol id="icon-filter" viewBox="0 0 512 512"><path d="M3.9 54.9C10.5 40.9 24.5 32 40 32H472c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9V448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6V320.9L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/></symbol><symbol id="icon-address-book" viewBox="0 0 448 512"><path d="M436 160c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20zm-228-32c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H118.4C106 384 96 375.4 96 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z"></path></symbol><symbol id="icon-angle-double-down" viewBox="0 0 320 512"><path d="M143 256.3L7 120.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0L313 86.3c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.4 9.5-24.6 9.5-34 .1zm34 192l136-136c9.4-9.4 9.4-24.6 0-33.9l-22.6-22.6c-9.4-9.4-24.6-9.4-33.9 0L160 352.1l-96.4-96.4c-9.4-9.4-24.6-9.4-33.9 0L7 278.3c-9.4 9.4-9.4 24.6 0 33.9l136 136c9.4 9.5 24.6 9.5 34 .1z"></path></symbol><symbol id="icon-angle-double-left" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"></path></symbol><symbol id="icon-angle-double-right" viewBox="0 0 448 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"></path></symbol><symbol id="icon-angle-double-up" viewBox="0 0 320 512"><path d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"></path></symbol><symbol id="icon-angle-down" viewBox="0 0 320 512"><path d="M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"></path></symbol><symbol id="icon-angle-left" viewBox="0 0 256 512"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path></symbol><symbol id="icon-angle-right" viewBox="0 0 256 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></symbol><symbol id="icon-angle-up" viewBox="0 0 320 512"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"></path></symbol><symbol id="icon-arrow-alt-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm116-292H256v-70.9c0-10.7-13-16.1-20.5-8.5L121.2 247.5c-4.7 4.7-4.7 12.2 0 16.9l114.3 114.9c7.6 7.6 20.5 2.2 20.5-8.5V300h116c6.6 0 12-5.4 12-12v-64c0-6.6-5.4-12-12-12z"></path></symbol><symbol id="icon-arrow-alt-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zM140 300h116v70.9c0 10.7 13 16.1 20.5 8.5l114.3-114.9c4.7-4.7 4.7-12.2 0-16.9l-114.3-115c-7.6-7.6-20.5-2.2-20.5 8.5V212H140c-6.6 0-12 5.4-12 12v64c0 6.6 5.4 12 12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-arrow-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-143.6-28.9L288 302.6V120c0-13.3-10.7-24-24-24h-16c-13.3 0-24 10.7-24 24v182.6l-72.4-75.5c-9.3-9.7-24.8-9.9-34.3-.4l-10.9 11c-9.4 9.4-9.4 24.6 0 33.9L239 404.3c9.4 9.4 24.6 9.4 33.9 0l132.7-132.7c9.4-9.4 9.4-24.6 0-33.9l-10.9-11c-9.5-9.5-25-9.3-34.3.4z"></path></symbol><symbol id="icon-arrow-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm28.9-143.6L209.4 288H392c13.3 0 24-10.7 24-24v-16c0-13.3-10.7-24-24-24H209.4l75.5-72.4c9.7-9.3 9.9-24.8.4-34.3l-11-10.9c-9.4-9.4-24.6-9.4-33.9 0L107.7 239c-9.4 9.4-9.4 24.6 0 33.9l132.7 132.7c9.4 9.4 24.6 9.4 33.9 0l11-10.9c9.5-9.5 9.3-25-.4-34.3z"></path></symbol><symbol id="icon-arrow-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></symbol><symbol id="icon-arrow-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm143.6 28.9l72.4-75.5V392c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V209.4l72.4 75.5c9.3 9.7 24.8 9.9 34.3.4l10.9-11c9.4-9.4 9.4-24.6 0-33.9L273 107.7c-9.4-9.4-24.6-9.4-33.9 0L106.3 240.4c-9.4 9.4-9.4 24.6 0 33.9l10.9 11c9.6 9.5 25.1 9.3 34.4-.4z"></path></symbol><symbol id="icon-arrow-down" viewBox="0 0 448 512"><path d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"></path></symbol><symbol id="icon-arrow-left" viewBox="0 0 448 512"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 448 512"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></symbol><symbol id="icon-arrow-up" viewBox="0 0 448 512"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></symbol><symbol id="icon-arrows-alt" viewBox="0 0 512 512"><path d="M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"></path></symbol><symbol id="icon-arrows-alt-h" viewBox="0 0 512 512"><path d="M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z"></path></symbol><symbol id="icon-arrows-alt-v" viewBox="0 0 256 512"><path d="M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"></path></symbol><symbol id="icon-bars" viewBox="0 0 448 512"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></symbol><symbol id="icon-bookmark" viewBox="0 0 384 512"><path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"></path></symbol><symbol id="icon-bookmark-empty" viewBox="0 0 384 512"><path d="M0 48C0 21.5 21.5 0 48 0l0 48V441.4l130.1-92.9c8.3-6 19.6-6 27.9 0L336 441.4V48H48V0H336c26.5 0 48 21.5 48 48V488c0 9-5 17.2-13 21.3s-17.6 3.4-24.9-1.8L192 397.5 37.9 507.5c-7.3 5.2-16.9 5.9-24.9 1.8S0 497 0 488V48z"/></symbol><symbol id="icon-caret-down" viewBox="0 0 320 512"><path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></symbol><symbol id="icon-caret-right" viewBox="0 0 192 512"><path d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></symbol><symbol id="icon-check" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path></symbol><symbol id="icon-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></symbol><symbol id="icon-cog" viewBox="0 0 512 512"><path d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path></symbol><symbol id="icon-database" viewBox="0 0 448 512"><path d="M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"></path></symbol><symbol id="icon-edit" viewBox="0 0 576 512"><path d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"></path></symbol><symbol id="icon-eye" viewBox="0 0 576 512"><path d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></symbol><symbol id="icon-eye-slash" viewBox="0 0 640 512"><path d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"></path></symbol><symbol id="icon-gavel" viewBox="0 0 512 512"><path d="M504.971 199.362l-22.627-22.627c-9.373-9.373-24.569-9.373-33.941 0l-5.657 5.657L329.608 69.255l5.657-5.657c9.373-9.373 9.373-24.569 0-33.941L312.638 7.029c-9.373-9.373-24.569-9.373-33.941 0L154.246 131.48c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l5.657-5.657 39.598 39.598-81.04 81.04-5.657-5.657c-12.497-12.497-32.758-12.497-45.255 0L9.373 412.118c-12.497 12.497-12.497 32.758 0 45.255l45.255 45.255c12.497 12.497 32.758 12.497 45.255 0l114.745-114.745c12.497-12.497 12.497-32.758 0-45.255l-5.657-5.657 81.04-81.04 39.598 39.598-5.657 5.657c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l124.451-124.451c9.372-9.372 9.372-24.568 0-33.941z"></path></symbol><symbol id="icon-globe" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></symbol><symbol id="icon-id-card" viewBox="0 0 576 512"><path d="M528 32H48C21.5 32 0 53.5 0 80v16h576V80c0-26.5-21.5-48-48-48zM0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V128H0v304zm352-232c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zM176 192c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zM67.1 396.2C75.5 370.5 99.6 352 128 352h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.9-5.2 19.8-15.6 19.8H82.7c-10.4 0-18.8-10-15.6-19.8z"></path></symbol><symbol id="icon-id-card-alt" viewBox="0 0 576 512"><path d="M528 64H384v96H192V64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM288 224c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm93.3 224H194.7c-10.4 0-18.8-10-15.6-19.8 8.3-25.6 32.4-44.2 60.9-44.2h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.8-5.2 19.8-15.6 19.8zM352 32c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v96h128V32z"></path></symbol><symbol id="icon-info" viewBox="0 0 192 512"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></symbol><symbol id="icon-info-circle" viewBox="0 0 512 512"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></symbol><symbol id="icon-list-ul" viewBox="0 0 512 512"><path d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-lock" viewBox="0 0 448 512"><path d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"></path></symbol><symbol id="icon-lock-open" viewBox="0 0 576 512"><path d="M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"></path></symbol><symbol id="icon-minus" viewBox="0 0 448 512"><path d="M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-minus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"></path></symbol><symbol id="icon-minus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"></path></symbol><symbol id="icon-paper-plane" viewBox="0 0 512 512"><path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"></path></symbol><symbol id="icon-paperclip" viewBox="0 0 448 512"><path d="M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"></path></symbol><symbol id="icon-pencil-alt" viewBox="0 0 512 512"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"></path></symbol><symbol id="icon-phone" viewBox="0 0 512 512"><path d="M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"></path></symbol><symbol id="icon-plus" viewBox="0 0 448 512"><path d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-plus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-plus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-save" viewBox="0 0 448 512"><path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"></path></symbol><symbol id="icon-sign-out-alt" viewBox="0 0 512 512"><path d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-smile" viewBox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"></path></symbol><symbol id="icon-snowflake" viewBox="0 0 448 512"><path d="M440.3 345.2l-33.8-19.5 26-7c8.2-2.2 13.1-10.7 10.9-18.9l-4-14.9c-2.2-8.2-10.7-13.1-18.9-10.9l-70.8 19-63.9-37 63.8-36.9 70.8 19c8.2 2.2 16.7-2.7 18.9-10.9l4-14.9c2.2-8.2-2.7-16.7-10.9-18.9l-26-7 33.8-19.5c7.4-4.3 9.9-13.7 5.7-21.1L430.4 119c-4.3-7.4-13.7-9.9-21.1-5.7l-33.8 19.5 7-26c2.2-8.2-2.7-16.7-10.9-18.9l-14.9-4c-8.2-2.2-16.7 2.7-18.9 10.9l-19 70.8-62.8 36.2v-77.5l53.7-53.7c6.2-6.2 6.2-16.4 0-22.6l-11.3-11.3c-6.2-6.2-16.4-6.2-22.6 0L256 56.4V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v40.4l-19.7-19.7c-6.2-6.2-16.4-6.2-22.6 0L138.3 48c-6.3 6.2-6.3 16.4 0 22.6l53.7 53.7v77.5l-62.8-36.2-19-70.8c-2.2-8.2-10.7-13.1-18.9-10.9l-14.9 4c-8.2 2.2-13.1 10.7-10.9 18.9l7 26-33.8-19.5c-7.4-4.3-16.8-1.7-21.1 5.7L2.1 145.7c-4.3 7.4-1.7 16.8 5.7 21.1l33.8 19.5-26 7c-8.3 2.2-13.2 10.7-11 19l4 14.9c2.2 8.2 10.7 13.1 18.9 10.9l70.8-19 63.8 36.9-63.8 36.9-70.8-19c-8.2-2.2-16.7 2.7-18.9 10.9l-4 14.9c-2.2 8.2 2.7 16.7 10.9 18.9l26 7-33.8 19.6c-7.4 4.3-9.9 13.7-5.7 21.1l15.5 26.8c4.3 7.4 13.7 9.9 21.1 5.7l33.8-19.5-7 26c-2.2 8.2 2.7 16.7 10.9 18.9l14.9 4c8.2 2.2 16.7-2.7 18.9-10.9l19-70.8 62.8-36.2v77.5l-53.7 53.7c-6.3 6.2-6.3 16.4 0 22.6l11.3 11.3c6.2 6.2 16.4 6.2 22.6 0l19.7-19.7V496c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-40.4l19.7 19.7c6.2 6.2 16.4 6.2 22.6 0l11.3-11.3c6.2-6.2 6.2-16.4 0-22.6L256 387.7v-77.5l62.8 36.2 19 70.8c2.2 8.2 10.7 13.1 18.9 10.9l14.9-4c8.2-2.2 13.1-10.7 10.9-18.9l-7-26 33.8 19.5c7.4 4.3 16.8 1.7 21.1-5.7l15.5-26.8c4.3-7.3 1.8-16.8-5.6-21z"></path></symbol><symbol id="icon-spinner" viewBox="0 0 512 512"><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"></path></symbol><symbol id="icon-sync" viewBox="0 0 512 512"><path d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"></path></symbol><symbol id="icon-times" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></symbol><symbol id="icon-times-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path></symbol><symbol id="icon-trash" viewBox="0 0 448 512"><path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"></path></symbol><symbol id="icon-trash-alt" viewBox="0 0 448 512"><path d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-unlock" viewBox="0 0 448 512"><path d="M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"></path></symbol><symbol id="icon-user" viewBox="0 0 448 512"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-cog" viewBox="0 0 640 512"><path d="M610.5 373.3c2.6-14.1 2.6-28.5 0-42.6l25.8-14.9c3-1.7 4.3-5.2 3.3-8.5-6.7-21.6-18.2-41.2-33.2-57.4-2.3-2.5-6-3.1-9-1.4l-25.8 14.9c-10.9-9.3-23.4-16.5-36.9-21.3v-29.8c0-3.4-2.4-6.4-5.7-7.1-22.3-5-45-4.8-66.2 0-3.3.7-5.7 3.7-5.7 7.1v29.8c-13.5 4.8-26 12-36.9 21.3l-25.8-14.9c-2.9-1.7-6.7-1.1-9 1.4-15 16.2-26.5 35.8-33.2 57.4-1 3.3.4 6.8 3.3 8.5l25.8 14.9c-2.6 14.1-2.6 28.5 0 42.6l-25.8 14.9c-3 1.7-4.3 5.2-3.3 8.5 6.7 21.6 18.2 41.1 33.2 57.4 2.3 2.5 6 3.1 9 1.4l25.8-14.9c10.9 9.3 23.4 16.5 36.9 21.3v29.8c0 3.4 2.4 6.4 5.7 7.1 22.3 5 45 4.8 66.2 0 3.3-.7 5.7-3.7 5.7-7.1v-29.8c13.5-4.8 26-12 36.9-21.3l25.8 14.9c2.9 1.7 6.7 1.1 9-1.4 15-16.2 26.5-35.8 33.2-57.4 1-3.3-.4-6.8-3.3-8.5l-25.8-14.9zM496 400.5c-26.8 0-48.5-21.8-48.5-48.5s21.8-48.5 48.5-48.5 48.5 21.8 48.5 48.5-21.7 48.5-48.5 48.5zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm201.2 226.5c-2.3-1.2-4.6-2.6-6.8-3.9l-7.9 4.6c-6 3.4-12.8 5.3-19.6 5.3-10.9 0-21.4-4.6-28.9-12.6-18.3-19.8-32.3-43.9-40.2-69.6-5.5-17.7 1.9-36.4 17.9-45.7l7.9-4.6c-.1-2.6-.1-5.2 0-7.8l-7.9-4.6c-16-9.2-23.4-28-17.9-45.7.9-2.9 2.2-5.8 3.2-8.7-3.8-.3-7.5-1.2-11.4-1.2h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c10.1 0 19.5-3.2 27.2-8.5-1.2-3.8-2-7.7-2-11.8v-9.2z"></path></symbol><symbol id="icon-user-plus" viewBox="0 0 640 512"><path d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-secret" viewBox="0 0 448 512"><path d="M383.9 308.3l23.9-62.6c4-10.5-3.7-21.7-15-21.7h-58.5c11-18.9 17.8-40.6 17.8-64v-.3c39.2-7.8 64-19.1 64-31.7 0-13.3-27.3-25.1-70.1-33-9.2-32.8-27-65.8-40.6-82.8-9.5-11.9-25.9-15.6-39.5-8.8l-27.6 13.8c-9 4.5-19.6 4.5-28.6 0L182.1 3.4c-13.6-6.8-30-3.1-39.5 8.8-13.5 17-31.4 50-40.6 82.8-42.7 7.9-70 19.7-70 33 0 12.6 24.8 23.9 64 31.7v.3c0 23.4 6.8 45.1 17.8 64H56.3c-11.5 0-19.2 11.7-14.7 22.3l25.8 60.2C27.3 329.8 0 372.7 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-48.4-25.8-90.4-64.1-114.1zM176 480l-41.6-192 49.6 32 24 40-32 120zm96 0l-32-120 24-40 49.6-32L272 480zm41.7-298.5c-3.9 11.9-7 24.6-16.5 33.4-10.1 9.3-48 22.4-64-25-2.8-8.4-15.4-8.4-18.3 0-17 50.2-56 32.4-64 25-9.5-8.8-12.7-21.5-16.5-33.4-.8-2.5-6.3-5.7-6.3-5.8v-10.8c28.3 3.6 61 5.8 96 5.8s67.7-2.1 96-5.8v10.8c-.1.1-5.6 3.2-6.4 5.8z"></path></symbol><symbol id="icon-users" viewBox="0 0 640 512"><path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path></symbol><symbol id="icon-wrench" viewBox="0 0 512 512"><path d="M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"></path></symbol><symbol id="icon-refresh" viewBox="0 0 512 512"><path d="M464 16c-17.67 0-32 14.31-32 32v74.09C392.1 66.52 327.4 32 256 32C161.5 32 78.59 92.34 49.58 182.2c-5.438 16.81 3.797 34.88 20.61 40.28c16.89 5.5 34.88-3.812 40.3-20.59C130.9 138.5 189.4 96 256 96c50.5 0 96.26 24.55 124.4 64H336c-17.67 0-32 14.31-32 32s14.33 32 32 32h128c17.67 0 32-14.31 32-32V48C496 30.31 481.7 16 464 16zM441.8 289.6c-16.92-5.438-34.88 3.812-40.3 20.59C381.1 373.5 322.6 416 256 416c-50.5 0-96.25-24.55-124.4-64H176c17.67 0 32-14.31 32-32s-14.33-32-32-32h-128c-17.67 0-32 14.31-32 32v144c0 17.69 14.33 32 32 32s32-14.31 32-32v-74.09C119.9 445.5 184.6 480 255.1 480c94.45 0 177.4-60.34 206.4-150.2C467.9 313 458.6 294.1 441.8 289.6z"></path></symbol><symbol id="icon-copy" viewBox="0 0 448 512"><path d="M320 448v40c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V120c0-13.3 10.7-24 24-24h72v296c0 30.9 25.1 56 56 56h168zm0-344V0H152c-13.3 0-24 10.7-24 24v368c0 13.3 10.7 24 24 24h272c13.3 0 24-10.7 24-24V128H344c-13.2 0-24-10.8-24-24zm121-31L375 7A24 24 0 0 0 358.1 0H352v96h96v-6.1a24 24 0 0 0 -7-17z"></path></symbol><symbol id="icon-quote-right" viewBox="0 0 512 512"><path d="M464 32H336c-26.5 0-48 21.5-48 48v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48zm-288 0H48C21.5 32 0 53.5 0 80v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48z"></path></symbol><symbol id="icon-bell" viewBox="0 0 512 512"><path d="M224 0c-17.7 0-32 14.3-32 32l0 19.2C119 66 64 130.6 64 208l0 18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416l384 0c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3C401.3 319.2 384 273.9 384 226.8l0-18.8c0-77.4-55-142-128-156.8L256 32c0-17.7-14.3-32-32-32zm45.3 493.3c12-12 18.7-28.3 18.7-45.3l-64 0-64 0c0 17 6.7 33.3 18.7 45.3s28.3 18.7 45.3 18.7s33.3-6.7 45.3-18.7z"></path></symbol><symbol id="icon-bell-alt" viewBox="0 0 512 512"><path d="M224 0c-17.7 0-32 14.3-32 32l0 19.2C119 66 64 130.6 64 208l0 25.4c0 45.4-15.5 89.5-43.8 124.9L5.3 377c-5.8 7.2-6.9 17.1-2.9 25.4S14.8 416 24 416l400 0c9.2 0 17.6-5.3 21.6-13.6s2.9-18.2-2.9-25.4l-14.9-18.6C399.5 322.9 384 278.8 384 233.4l0-25.4c0-77.4-55-142-128-156.8L256 32c0-17.7-14.3-32-32-32zm0 96c61.9 0 112 50.1 112 112l0 25.4c0 47.9 13.9 94.6 39.7 134.6L72.3 368C98.1 328 112 281.3 112 233.4l0-25.4c0-61.9 50.1-112 112-112zm64 352l-64 0-64 0c0 17 6.7 33.3 18.7 45.3s28.3 18.7 45.3 18.7s33.3-6.7 45.3-18.7s18.7-28.3 18.7-45.3z"></path></symbol></svg>`}});var EO=n(2778),OO={};OO.styleTagTransform=D(),OO.setAttributes=N(),OO.insert=k().bind(null,"head"),OO.domAPI=O(),OO.insertStyleElement=I();$()(EO.A,OO);EO.A&&EO.A.locals&&EO.A.locals;const CO=aA("Click to set a new picture"),kO=aA("Clear picture");Wu.elements.define("converse-image-picker",class extends uA{static get properties(){return{height:{type:Number},model:{type:Object},width:{type:Number}}}render(){var e,t,n,r;return mf`<div class="image-picker"><a class="change-avatar" @click="${this.openFileSelection}" title="${CO}"><converse-avatar .model="${this.model}" .pickerdata="${this.data}" class="avatar" name="${this.model.getDisplayName()}" height="${this.height}" nonce="${this.nonce||(null===(e=this.model.vcard)||void 0===e?void 0:e.get("vcard_updated"))}" width="${this.width}"></converse-avatar></a>${(null===(t=this.data)||void 0===t?void 0:t.data_uri)||(null===(r=this.model)||void 0===r||null===(n=r.vcard)||void 0===n?void 0:n.get("image"))?mf`<button class="clear-image" @click="${this.clearImage}" title="${kO}"><converse-icon class="fa fa-trash-alt" size="1.5em"></converse-icon></button>`:""} <input @change="${this.updateFilePreview}" class="hidden" name="avatar_image" type="file"></div>`}clearImage(e){e.preventDefault();this.querySelector('input[name="avatar_image').value="",this.model.vcard.set({image:null,image_type:null}),this.data={data_uri:null,image_type:null},this.nonce=(new Date).toISOString(),this.requestUpdate()}openFileSelection(e){e.preventDefault(),this.querySelector('input[type="file"]').click()}updateFilePreview(e){const t=e.target.files[0],n=new FileReader;n.onloadend=()=>{this.data={data_uri:n.result,image_type:t.type},this.nonce=(new Date).toISOString(),this.requestUpdate()},n.readAsDataURL(t)}constructor(){super(),this.model=null,this.width=null,this.height=null,this.nonce=null}});var TO=n(1709),NO={};NO.styleTagTransform=D(),NO.setAttributes=N(),NO.insert=k().bind(null,"head"),NO.domAPI=O(),NO.insertStyleElement=I();$()(TO.A,NO);TO.A&&TO.A.locals&&TO.A.locals;Wu.elements.define("converse-list-filter",class extends uA{static get properties(){return{items:{type:Array},model:{type:Object},promise:{type:Promise},template:{type:Object}}}initialize(){this.liveFilter=Lo((e=>this.model.save({text:e.target.value})),250),this.listenTo(this.items,"add",(()=>this.requestUpdate())),this.listenTo(this.items,"destroy",(()=>this.requestUpdate())),this.listenTo(this.items,"remove",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>{this.dispatchUpdateEvent(),this.requestUpdate()})),this.promise.then((()=>this.requestUpdate())),this.requestUpdate()}render(){return this.shouldBeVisible()?this.template(this):""}dispatchUpdateEvent(){this.dispatchEvent(new CustomEvent("update",{detail:this.model.changed}))}changeChatStateFilter(e){e&&e.preventDefault();const t=this.querySelector(".state-type").value;this.model.save({state:t})}changeTypeFilter(e){var t;e&&e.preventDefault();const n=(null===(t=e.target.closest("converse-icon"))||void 0===t?void 0:t.dataset.type)||"items";if("state"===n){const e=this.querySelector(".state-type").value;this.model.save({type:n,state:e})}else{const e=this.querySelector(".items-filter").value;this.model.save({type:n,text:e})}}submitFilter(e){null==e||e.preventDefault(),this.liveFilter()}isActive(){return"state"===this.model.get("type")||this.model.get("text")}shouldBeVisible(){var e;return(null===(e=this.items)||void 0===e?void 0:e.length)>=5||this.isActive()}clearFilter(e){e&&e.preventDefault(),this.model.save({text:""})}constructor(){super(),this.items=null,this.model=null,this.template=null,this.promise=Promise.resolve()}});var MO=n(9495),IO={};IO.styleTagTransform=D(),IO.setAttributes=N(),IO.insert=k().bind(null,"head"),IO.domAPI=O(),IO.insertStyleElement=I();$()(MO.A,IO);MO.A&&MO.A.locals&&MO.A.locals;const{dayjs:PO}=Hp.env;function DO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}Wu.elements.define("converse-message-versions",class extends uA{static get properties(){return{model:{type:Object}}}render(){const e=this.model.get("older_versions"),t=Object.keys(e);return mf`${t.length?mf`<h4>${aA("Older versions")}</h4>${t.map((t=>((e,t)=>mf`<p class="older-msg"><time>${PO(e).format("MMM D, YYYY, HH:mm:ss")}</time>: ${t[e]}</p>`)(t,e)))}`:mf`<h4>${aA("No older versions found")}</h4>`}<hr><h4>${aA("Current version")}</h4><p><time>${PO(this.model.get("time")).format("MMM D, YYYY, HH:mm:ss")}</time>: ${this.model.getMessageText()}</p>`}constructor(){super(),this.model=null}});class zO extends uA{static get properties(){return RO(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){DO(e,t,n[t])}))}return e}({},super.properties),{observable:{type:String},intersectionRatio:{type:Number}})}firstUpdated(e){super.firstUpdated(e),this.initIntersectionObserver()}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.intersectionObserver)||void 0===e||e.disconnect()}initIntersectionObserver(){this.observable&&!this.isVisible&&(this.intersectionObserver=new IntersectionObserver((e=>this.handleIntersectionCallback(e)),{rootMargin:this.observableMargin,threshold:this.observableThresholds,delay:this.observableDelay}),this.intersectionObserver.observe(this))}alreadyHandled(){return"once"===this.observable&&this.isVisible}handleIntersectionCallback(e){if(!this.alreadyHandled())for(const t of e){Number(t.intersectionRatio.toFixed(2))>=this.intersectionRatio&&!this.alreadyHandled()&&("once"===this.observable&&this.intersectionObserver.disconnect(),this.isVisible=!0,Wu.trigger("visibilityChanged",{el:this,entry:t}),this.onVisibilityChanged(t))}}onVisibilityChanged(e){}constructor(){super(),this.model=null,this.observable=null,this.isVisible=!1,this.observableThresholds=[0,.25,.5,.75,1],this.observableMargin="0px",this.intersectionRatio=.5,this.observableDelay=100}}var LO=n(2470),UO={};UO.styleTagTransform=D(),UO.setAttributes=N(),UO.insert=k().bind(null,"head"),UO.domAPI=O(),UO.insertStyleElement=I();$()(LO.A,UO);LO.A&&LO.A.locals&&LO.A.locals;const BO=(e={})=>mf`<div class="d-flex justify-content-center ${e.class}"><div class="spinner-grow" role="status"><span class="visually-hidden">Loading...</span></div></div>`;Wu.elements.define("converse-spinner",class extends uA{render(){return BO()}});var FO=n(4647),qO={};qO.styleTagTransform=D(),qO.setAttributes=N(),qO.insert=k().bind(null,"head"),qO.domAPI=O(),qO.insertStyleElement=I();$()(FO.A,qO);FO.A&&FO.A.locals&&FO.A.locals;const HO="_a",GO="_b",WO="_c",VO="horizontal",KO=()=>!1,JO="undefined"!=typeof window?window:null;Wu.elements.define("converse-split-resize",class extends uA{initialize(){super.initialize()}render(){return mf`<div class="gutter gutter-horizontal"></div>`}disconnectedCallback(){super.disconnectedCallback(),this.pair.gutter.removeEventListener("mousedown",this.pair[HO]),this.pair.gutter.removeEventListener("touchstart",this.pair[HO])}updated(e){super.updated(e),this.pair||this.setupSplit([this.previousElementSibling,this.nextElementSibling])}getOption(e,t,n){const r=e[t];return void 0!==r?r:n}getElementStyle(e,t,n){const r={};return Up.isString(t)?r[e]=t:r[e]=`calc(${t}% - ${n}px)`,r}defaultGutterStyleFn(e,t){return{[e]:`${t}px`}}getGutterSize(e,t,n,r){if(t){if("end"===r)return 0;if("center"===r)return e/2}else if(n){if("start"===r)return 0;if("center"===r)return e/2}return e}setElementSize(e,t,n){const r=this.getElementStyle(this.dimension,t,n);Object.keys(r).forEach((t=>{e.style[t]=r[t]}))}getSizes(){return this.elements.map((e=>e.size))}getMousePosition(e){return"touches"in e?e.touches[0][this.clientAxis]:e[this.clientAxis]}adjust(e){const t=this.elements[this.pair.a],n=this.elements[this.pair.b],r=t.size+n.size;t.size=e/this.pair.size*r,n.size=r-e/this.pair.size*r,this.setElementSize(t.element,t.size,this.pair[GO]),this.setElementSize(n.element,n.size,this.pair[WO])}drag(e,t){let n;const r=this.elements[this.pair.a],i=this.elements[this.pair.b];this.pair.dragging&&(n=this.getMousePosition(e)-this.pair.start+(this.pair[GO]-this.pair.dragOffset),this.dragInterval>1&&(n=Math.round(n/this.dragInterval)*this.dragInterval),n<=r.minSize+r.snapOffset+this.pair[GO]?n=r.minSize+this.pair[GO]:n>=this.pair.size-(i.minSize+i.snapOffset+this.pair[WO])&&(n=this.pair.size-(i.minSize+this.pair[WO])),n>=r.maxSize-r.snapOffset+this.pair[GO]?n=r.maxSize+this.pair[GO]:n<=this.pair.size-(i.maxSize-i.snapOffset+this.pair[WO])&&(n=this.pair.size-(i.maxSize+this.pair[WO])),this.adjust(n),this.getOption(t,"onDrag",KO)(this.getSizes()))}calculateSizes(e){const t=this.elements[e.a].element,n=this.elements[e.b].element,r=t.getBoundingClientRect(),i=n.getBoundingClientRect();e.size=r[this.dimension]+i[this.dimension]+e[GO]+e[WO],e.start=r[this.position],e.end=r[this.positionEnd]}innerSize(e){if(!getComputedStyle)return null;const t=getComputedStyle(e);if(!t)return null;let n=e[this.clientSize];return 0===n?null:(this.direction===VO?n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight):n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n)}trimToMin(e){const t=this.innerSize(this.parent);if(null===t)return e;if(this.minSizes.reduce(((e,t)=>e+t),0)>t)return e;let n=0;const r=[],i=e.map(((i,s)=>{const o=t*i/100,a=this.getGutterSize(this.gutterSize,0===s,s===e.length-1,this.gutterAlign),c=this.minSizes[s]+a;return o<c?(n+=c-o,r.push(0),c):(r.push(o-c),o)}));return 0===n?e:i.map(((e,i)=>{let s=e;if(n>0&&r[i]-n>0){const t=Math.min(n,r[i]-n);n-=t,s=e-t}return s/t*100}))}stopDragging(e){const t=this.elements[this.pair.a].element,n=this.elements[this.pair.b].element;this.pair.dragging&&this.getOption(e,"onDragEnd",KO)(this.getSizes()),this.pair.dragging=!1,JO.removeEventListener("mouseup",this.pair.stop),JO.removeEventListener("touchend",this.pair.stop),JO.removeEventListener("touchcancel",this.pair.stop),JO.removeEventListener("mousemove",this.pair.move),JO.removeEventListener("touchmove",this.pair.move),this.pair.stop=null,this.pair.move=null,t.removeEventListener("selectstart",KO),t.removeEventListener("dragstart",KO),n.removeEventListener("selectstart",KO),n.removeEventListener("dragstart",KO),t.style.userSelect="",t.style.pointerEvents="",n.style.userSelect="",n.style.pointerEvents="",this.pair.gutter.style.cursor="",this.pair.parent.style.cursor="",document.body.style.cursor=""}startDragging(e,t){if("button"in e&&0!==e.button)return;const n=this.elements[this.pair.a].element,r=this.elements[this.pair.b].element;this.pair.dragging||this.getOption(t,"onDragStart",KO)(this.getSizes()),e.preventDefault(),this.pair.dragging=!0,this.pair.stop=()=>this.stopDragging(t),this.pair.move=e=>this.drag(e,t),JO.addEventListener("mouseup",this.pair.stop),JO.addEventListener("touchend",this.pair.stop),JO.addEventListener("touchcancel",this.pair.stop),JO.addEventListener("mousemove",this.pair.move),JO.addEventListener("touchmove",this.pair.move),n.addEventListener("selectstart",KO),n.addEventListener("dragstart",KO),r.addEventListener("selectstart",KO),r.addEventListener("dragstart",KO),n.style.userSelect="none",n.style.pointerEvents="none",r.style.userSelect="none",r.style.pointerEvents="none",this.pair.gutter.style.cursor=this.cursor,this.pair.parent.style.cursor=this.cursor,document.body.style.cursor=this.cursor,this.calculateSizes(this.pair),this.pair.dragOffset=this.getMousePosition(e)-this.pair.end}adjustToMin(e){this.calculateSizes(this.pair),this.adjust(this.pair.size-e.minSize-this.pair[WO])}setSizes(e){const t=this.trimToMin(e);t.forEach(((e,n)=>{if(n>0){const r=this.elements[this.pair.a],i=this.elements[this.pair.b];r.size=t[n-1],i.size=e,this.setElementSize(r.element,r.size,this.pair[GO]),this.setElementSize(i.element,i.size,this.pair[WO])}}))}setupSplit(e,t={}){const n=(e=Array.from(e))[0];this.parent=n.parentElement;const r=this.getOption(t,"minSize",100);this.minSizes=Array.isArray(r)?r:e.map((()=>r));const i=this.getOption(t,"expandToMin",!1);this.gutterSize=this.getOption(t,"gutterSize",5),this.gutterAlign=this.getOption(t,"gutterAlign","center"),this.dragInterval=this.getOption(t,"dragInterval",1),this.direction=this.getOption(t,"direction",VO),this.cursor=this.getOption(t,"cursor",this.direction===VO?"col-resize":"row-resize"),this.direction===VO?(this.dimension="width",this.clientAxis="clientX",this.position="left",this.positionEnd="right",this.clientSize="clientWidth"):"vertical"===this.direction&&(this.dimension="height",this.clientAxis="clientY",this.position="top",this.positionEnd="bottom",this.clientSize="clientHeight"),this.elements=e.map(((n,r)=>this.createElement(e,n,r,t))),this.elements.forEach((e=>{const t=e.element.getBoundingClientRect()[this.dimension];t<e.minSize&&(i?this.adjustToMin(e):e.minSize=t)})),this.createPair(t)}createElement(e,t,n,r){let i=this.getOption(r,"sizes")||e.map((()=>100/e.length));i=this.trimToMin(i);const s=this.getOption(r,"maxSize",1/0),o=Array.isArray(s)?s:e.map((()=>s)),a=this.getOption(r,"snapOffset",30),c=Array.isArray(a)?a:e.map((()=>a));return{element:t,size:i[n],minSize:this.minSizes[n],maxSize:o[n],snapOffset:c[n],i:n}}createPair(e){const t=getComputedStyle?getComputedStyle(this.parent):null,n=t?t.flexDirection:null;if(this.pair={a:0,b:1,dragging:!1,direction:this.direction,parent:this.parent},this.pair[GO]=this.getGutterSize(this.gutterSize,!0,!1,this.gutterAlign),this.pair[WO]=this.getGutterSize(this.gutterSize,!1,!0,this.gutterAlign),"row-reverse"===n||"column-reverse"===n){const e=this.pair.a;this.pair.a=this.pair.b,this.pair.b=e}const r=this.firstElementChild;this.pair[HO]=t=>this.startDragging(t,e),this.addEventListener("mousedown",this.pair[HO]),this.addEventListener("touchstart",this.pair[HO]),this.pair.gutter=r}constructor(){super(),this.pair=null}});const YO=["converse-adhoc-views","converse-bookmark-views","converse-chatboxviews","converse-chatview","converse-controlbox","converse-disco-views","converse-dragresize","converse-fullscreen","converse-headlines-view","converse-mam-views","converse-minimize","converse-modal","converse-muc-views","converse-notification","converse-omemo","converse-profile","converse-push","converse-register","converse-roomslist","converse-rootview","converse-rosterview","converse-singleton"],XO={offline:aA("Offline"),unavailable:aA("Unavailable"),xa:aA("Extended Away"),away:aA("Away"),dnd:aA("Do not disturb"),chat:aA("Chatty"),online:aA("Online")},QO=768;function ZO(e,t=""){return`color: ${e}!important;${t}`}function eC(e){if(Wu.settings.get("colorize_username")){const t=null==e?void 0:e.get("color");return t?ZO(t):e?mf`${NA(null==e?void 0:e.getColor().then(ZO),"")}`:""}}var tC=n(3411),nC=n.n(tC);function rC(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function iC(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){rC(s,r,i,o,a,"next",e)}function a(e){rC(s,r,i,o,a,"throw",e)}o(void 0)}))}}const sC={aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",cda:"application/x-cdf",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",m4a:"audio/mp4",mid:"audio/midi",midi:"audio/midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"text/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};function oC(e){return iC((function*(){if(e.type===sC.png){const t=new FileReader;return yield new Promise((n=>{t.onloadend=e=>{const t=new DataView(e.target.result);if(2303741511===t.getUint32(0)&&218765834===t.getUint32(4)){const e=t.getUint8(25);n(e===4||e===6)}n(!1)},t.readAsArrayBuffer(e)}))}return!1}))()}function aC(e){return iC((function*(e,t={targetSize:.1,quality:.75,maxWidth:256,maxHeight:256,maxUncompressedSize:100}){if(t.maxUncompressedSize&&e.size>1024*t.maxUncompressedSize){delete t.maxUncompressedSize;const n=new(nC())(t),r=yield n.compress([e]),{photo:i}=r[0];return i.data}return e})).apply(this,arguments)}function cC(e,t){const n=Up.getURL(t).hostname.split("."),r=n.slice(-2).join("."),i=n.slice(0,-2).join("."),s=`${i?`${i}.`:""}${r}`;return e.includes(r)||e.includes(s)}function lC(e,t){const n=Wu.settings.get(t);if(!Array.isArray(n))return!0;try{return cC(n,e)}catch(e){return Q.debug(e),!1}}function uC(e){return e.is_audio&&lC(e.url,"allowed_audio_domains")||e.is_video&&lC(e.url,"allowed_video_domains")||e.is_image&&lC(e.url,"allowed_image_domains")}function dC(e,t){if(!function(e){const{protocol:t}=window.location;if(["chrome-extension:","file:"].includes(t))return!0;const n=Up.getURL(e);return"http:"===t||"https:"===t&&["https:","aesgcm:"].includes(n.protocol.toLowerCase())}(e))return!1;const n=Wu.settings.get("render_media"),r=lC(e,`allowed_${t}_domains`);return Array.isArray(n)?r&&cC(n,e):r&&n}function hC(e){const t=Wu.settings.get("filter_url_query_params");if(!t)return e;const n=Array.isArray(t)?t:[t],r=Up.getURL(e);return n.forEach((e=>r.searchParams.delete(e))),r.toString()}function fC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.assign(Up,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fC(e,t,n[t])}))}return e}({},S,x,_,A));const pC="backdrop",mC="show",gC=`mousedown.bs.${pC}`,vC={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},yC={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};const bC=class extends LE{static get Default(){return vC}static get DefaultType(){return yC}static get NAME(){return pC}show(e){if(!this._config.isVisible)return void pE(e);this._append();const t=this._getElement();this._config.isAnimated&&lE(t),t.classList.add(mC),this._emulateAnimation((()=>{pE(e)}))}hide(e){this._config.isVisible?(this._getElement().classList.remove(mC),this._emulateAnimation((()=>{this.dispose(),pE(e)}))):pE(e)}dispose(){this._isAppended&&(ME.off(this._element,gC),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add("fade"),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=iE(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),ME.on(e,gC,(()=>{pE(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(e){mE(e,this._getElement(),this._config.isAnimated)}constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}},_C=".bs.focustrap",wC=`focusin${_C}`,SC=`keydown.tab${_C}`,xC="backward",AC={autofocus:!0,trapElement:null},jC={autofocus:"boolean",trapElement:"element"};const $C=class extends LE{static get Default(){return AC}static get DefaultType(){return jC}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),ME.off(document,_C),ME.on(document,wC,(e=>this._handleFocusin(e))),ME.on(document,SC,(e=>this._handleKeydown(e))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,ME.off(document,_C))}_handleFocusin(e){const{trapElement:t}=this._config;if(e.target===document||e.target===t||t.contains(e.target))return;const n=qE.focusableChildren(t);0===n.length?t.focus():this._lastTabNavDirection===xC?n[n.length-1].focus():n[0].focus()}_handleKeydown(e){"Tab"===e.key&&(this._lastTabNavDirection=e.shiftKey?xC:"forward")}constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}},EC=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",OC=".sticky-top",CC="padding-right",kC="margin-right";const TC=class{getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,CC,(t=>t+e)),this._setElementAttributes(EC,CC,(t=>t+e)),this._setElementAttributes(OC,kC,(t=>t-e))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,CC),this._resetElementAttributes(EC,CC),this._resetElementAttributes(OC,kC)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,n){const r=this.getWidth();this._applyManipulationCallback(e,(e=>{if(e!==this._element&&window.innerWidth>e.clientWidth+r)return;this._saveInitialAttribute(e,t);const i=window.getComputedStyle(e).getPropertyValue(t);e.style.setProperty(t,`${n(Number.parseFloat(i))}px`)}))}_saveInitialAttribute(e,t){const n=e.style.getPropertyValue(t);n&&RE.setDataAttribute(e,t,n)}_resetElementAttributes(e,t){this._applyManipulationCallback(e,(e=>{const n=RE.getDataAttribute(e,t);null!==n?(RE.removeDataAttribute(e,t),e.style.setProperty(t,n)):e.style.removeProperty(t)}))}_applyManipulationCallback(e,t){if(rE(e))t(e);else for(const n of qE.find(e,this._element))t(n)}constructor(){this._element=document.body}},NC=".bs.modal",MC=`hide${NC}`,IC=`hidePrevented${NC}`,PC=`hidden${NC}`,DC=`show${NC}`,RC=`shown${NC}`,zC=`resize${NC}`,LC=`click.dismiss${NC}`,UC=`mousedown.dismiss${NC}`,BC=`keydown.dismiss${NC}`,FC=`click${NC}.data-api`,qC="modal-open",HC="show",GC="modal-static",WC={backdrop:!0,focus:!0,keyboard:!0},VC={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class KC extends UE{static get Default(){return WC}static get DefaultType(){return VC}static get NAME(){return"modal"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||this._isTransitioning)return;ME.trigger(this._element,DC,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(qC),this._adjustDialog(),this._backdrop.show((()=>this._showElement(e))))}hide(){if(!this._isShown||this._isTransitioning)return;ME.trigger(this._element,MC).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(HC),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated()))}dispose(){ME.off(window,NC),ME.off(this._dialog,NC),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new bC({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new $C({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=qE.findOne(".modal-body",this._dialog);t&&(t.scrollTop=0),lE(this._element),this._element.classList.add(HC);this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,ME.trigger(this._element,RC,{relatedTarget:e})}),this._dialog,this._isAnimated())}_addEventListeners(){ME.on(this._element,BC,(e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),ME.on(window,zC,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),ME.on(this._element,UC,(e=>{ME.one(this._element,LC,(t=>{this._element===e.target&&this._element===t.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(qC),this._resetAdjustments(),this._scrollBar.reset(),ME.trigger(this._element,PC)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(ME.trigger(this._element,IC).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._element.style.overflowY;"hidden"===t||this._element.classList.contains(GC)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(GC),this._queueCallback((()=>{this._element.classList.remove(GC),this._queueCallback((()=>{this._element.style.overflowY=t}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),n=t>0;if(n&&!e){const e=hE()?"paddingLeft":"paddingRight";this._element.style[e]=`${t}px`}if(!n&&e){const e=hE()?"paddingRight":"paddingLeft";this._element.style[e]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each((function(){const n=KC.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`);n[e](t)}}))}constructor(e,t){super(e,t),this._dialog=qE.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new TC,this._addEventListeners()}}ME.on(document,FC,'[data-bs-toggle="modal"]',(function(e){const t=qE.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),ME.one(t,DC,(e=>{e.defaultPrevented||ME.one(t,PC,(()=>{sE(this)&&this.focus()}))}));const n=qE.findOne(".modal.show");n&&KC.getInstance(n).hide();KC.getOrCreateInstance(t).toggle(this)})),((e,t="hide")=>{const n=`click.dismiss${e.EVENT_KEY}`,r=e.NAME;ME.on(document,n,`[data-bs-dismiss="${r}"]`,(function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),oE(this))return;const i=qE.getElementFromSelector(this)||this.closest(`.${r}`);e.getOrCreateInstance(i)[t]()}))})(KC),fE(KC);const JC=KC,YC=mf`<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">${aA("Close")}</button>`,XC=mf`<button type="button" class="btn d-flex align-items-center justify-content-center" data-bs-dismiss="modal" aria-label="${aA("Close")}"><converse-icon size="1.25em" class="fa fa-times"></converse-icon></button>`;const QC=e=>{var t,n;const r=null===(t=e.state)||void 0===t?void 0:t.get("alert");var i;const s=null!==(i=null===(n=e.state)||void 0===n?void 0:n.get("level"))&&void 0!==i?i:"";return mf`<div class="modal-dialog" role="document" role="dialog"><div class="modal-content"><div class="modal-header ${s}"><h5 class="modal-title">${e.getModalTitle()}</h5>${XC}</div><div class="modal-body">${r?function(e,t){return mf`<div class="alert alert-${e}" role="alert">${t}</div>`}(r.type,r.message):""} ${e.renderModal()}</div>${e.renderModalFooter()}</div></div>`};var ZC=n(8610),ek={};ek.styleTagTransform=D(),ek.setAttributes=N(),ek.insert=k().bind(null,"head"),ek.domAPI=O(),ek.insertStyleElement=I();$()(ZC.A,ek);ZC.A&&ZC.A.locals&&ZC.A.locals;function tk(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function nk(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function rk(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,nk(e,t,"get"))}function ik(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function sk(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,nk(e,t,"set"),n),n}var ok=new WeakMap;const ak=class extends uA{static get properties(){return{model:{type:ae.Model}}}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.onKeyDown)}disconnectedCallback(){window.removeEventListener("resize",this.onKeyDown),super.disconnectedCallback()}get modal(){return rk(this,ok)||sk(this,ok,new JC(this,{backdrop:!Up.isTestEnv(),keyboard:!0})),rk(this,ok)}initialize(){this.requestUpdate(),this.initialized.resolve()}renderModal(){return""}renderModalFooter(){return mf`<div class="modal-footer">${YC}</div>`}render(){return QC(this)}getModalTitle(){return""}switchTab(e){null==e||e.stopPropagation(),null==e||e.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.requestUpdate()}close(){this.modal.hide()}insertIntoDOM(){document.querySelector("#converse-modals").insertAdjacentElement("beforeend",this)}alert(e,t="primary",n=!0){this.state.set("alert",{message:e,type:t}),n&&(this.alertTimeout&&clearTimeout(this.alertTimeout),this.alertTimeout=setTimeout((()=>{this.state.set("alert",void 0)}),5e3))}show(){return(e=function*(){yield this.initialized,this.modal.show(),this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){tk(s,r,i,o,a,"next",e)}function a(e){tk(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}constructor(e){super(),ik(this,ok,{writable:!0,value:void 0}),this.model=null,this.state=new ae.Model,this.listenTo(this.state,"change",(()=>this.requestUpdate())),this.className=Up.isTestEnv()?"modal":"modal fade",this.tabIndex=-1,this.ariaHidden="true",this.onKeyDown=e=>{"Escape"===e.key&&"false"===this.ariaHidden&&this.close()},this.initialized=ue(),Object.assign(this,e),setTimeout((()=>this.insertIntoDOM())),this.addEventListener("shown.bs.modal",(()=>{this.ariaHidden="false"})),this.addEventListener("hidden.bs.modal",(()=>{this.ariaHidden="true",Wu.modal.remove(this.nodeName.toLowerCase())}))}};Wu.elements.define("converse-alert-modal",class extends ak{initialize(){super.initialize(),this.addEventListener("hide.bs.modal",(()=>this.remove()),!1)}renderModal(){return(e=>mf`<div class="modal-body"><span class="modal-alert"></span> ${e.messages.map((e=>mf`<p>${e}</p>`))}</div>`)(this.state.toJSON())}getModalTitle(){return this.state.get("title")}});const ck=e=>{var t,n,r;const i=null===(t=e.state.get("messages"))||void 0===t?void 0:t[0],s=(null===(n=e.state.get("messages"))||void 0===n?void 0:n.slice(1))||[];return mf`<form class="converse-form converse-form--modal confirm" action="#" @submit="${t=>e.onConfimation(t)}"><div class="mb-3 lh-base"><strong>${i}</strong></div><div class="mb-3">${null==s?void 0:s.map((e=>mf`<p>${e}</p>`))}</div>${null===(r=e.state.get("fields"))||void 0===r?void 0:r.map((e=>function(e){return"checkbox"===e.type?mf`<div class="form-check"><input name="${e.name}" class="form-check-input" type="checkbox" id="${e.name}"> <label class="form-check-label" for="${e.name}">${e.label}</label></div>`:mf`<div class="mb-3"><label class="form-label" for="${e.name}">${e.label||""}</label> <input type="text" name="${e.name}" class="${e.challenge_failed?"is-invalid":""} form-control" ?required="${e.required}" placeholder="${e.placeholder}" id="${e.name}"> ${e.challenge_failed?mf`<div class="invalid-feedback">Please provide a valid input.</div>`:""}</div>`}(e)))}<div class="d-flex justify-content-end"><button type="submit" class="btn btn-primary me-2">${aA("Confirm")}</button> <input type="button" class="btn btn-secondary" data-bs-dismiss="modal" value="${aA("Cancel")}"></div></form>`};class lk extends ak{initialize(){super.initialize(),this.listenTo(this.state,"change",(()=>this.requestUpdate())),this.addEventListener("hide.bs.modal",(()=>{this.confirmation.isResolved||this.confirmation.reject()}),!1),this.onKeyDown=e=>{if(e.key===Xx.KEYCODES.ENTER){e.preventDefault(),e.stopPropagation();this.querySelector("form.confirm button[type=submit]").click()}}}connectedCallback(){super.connectedCallback(),this.addEventListener("keydown",this.onKeyDown)}disconnectedCallback(){this.removeEventListener("keydown",this.onKeyDown),super.disconnectedCallback()}renderModal(){return ck(this)}getModalTitle(){return this.state.get("title")}renderModalFooter(){return""}onConfimation(e){e.preventDefault();const t=e.target,n=new FormData(t),r=(this.state.get("fields")||[]).map((e=>{const t=n.get(e.name);return e.value=t,e.challenge&&(e.challenge_failed=t!==e.challenge),e}));if(r.filter((e=>e.challenge_failed)).length)return this.state.set("fields",r),void this.state.trigger("change");this.confirmation.resolve(r),this.modal.hide()}constructor(e){super(e),this.confirmation=ue()}}function uk(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function dk(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){uk(s,r,i,o,a,"next",e)}function a(e){uk(s,r,i,o,a,"throw",e)}o(void 0)}))}}function hk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Wu.elements.define("converse-confirm-modal",lk);let fk=[],pk={},mk={};const gk={modal:{show(e,t,n){let r;if("string"==typeof e){var i;r=null!==(i=this.get(e))&&void 0!==i?i:this.create(e,t),Object.assign(r,t)}else{const n=e;var s;const i=null!==(s=n.id)&&void 0!==s?s:t.id;var o;r=null!==(o=this.get(i))&&void 0!==o?o:this.create(n,t)}return r.show(n),r},get(e){var t;return null!==(t=pk[e])&&void 0!==t?t:fk.filter((t=>t.id==e)).pop()},create(e,t){const n=customElements.get(e);return pk[e]=new n(t)},remove(e){let t;"string"==typeof e?(t=pk[e],delete pk[e]):(t=e,fk=fk.filter((e=>e!==t))),null==t||t.remove()},removeAll(){fk.forEach((e=>e.remove())),fk=[],pk={}}},confirm(e){return dk((function*(e,t=[],n=[]){"string"==typeof t&&(t=[t]);const r=new ae.Model({title:e,messages:t,fields:n,type:"confirm"}),i=new lk({state:r});let s;i.show();try{s=yield i.confirmation}catch(e){s=!1}return i.remove(),s})).apply(this,arguments)},prompt(e){return dk((function*(e,t=[],n=""){"string"==typeof t&&(t=[t]);const r=new ae.Model({title:e,messages:t,fields:[{name:"reason",placeholder:n}],type:"prompt"}),i=new lk({state:r});let s;i.show();try{var o;s=null===(o=(yield i.confirmation).pop())||void 0===o?void 0:o.value}catch(e){s=!1}return i.remove(),s})).apply(this,arguments)},alert(e,t,n){let r;"string"==typeof n&&(n=[n]),"error"===e?r="alert-danger":"info"===e?r="alert-info":"warn"===e&&(r="alert-warning");const i=new ae.Model({title:t,messages:n,level:r,type:"alert"});gk.modal.show("converse-alert-modal",{state:i})},toast:{show(e,t){mk[e]=t,Wu.trigger("showToast",t)},get:e=>e?mk[e]:Object.keys(mk).map((e=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){hk(e,t,n[t])}))}return e}({name:e},mk[e]))),remove(e){delete mk[e],Wu.trigger("hideToast")}}},vk=gk,yk={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},bk=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),_k=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,wk=(e,t)=>{const n=e.nodeName.toLowerCase();return t.includes(n)?!bk.has(n)||Boolean(_k.test(e.nodeValue)):t.filter((e=>e instanceof RegExp)).some((e=>e.test(n)))};function Sk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const xk={allowList:yk,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Ak={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},jk={entry:"(string|element|function|null)",selector:"(string|element)"};const $k=class extends LE{static get Default(){return xk}static get DefaultType(){return Ak}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((e=>this._resolvePossibleFunction(e))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Sk(e,t,n[t])}))}return e}({},this._config.content,e),this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[t,n]of Object.entries(this._config.content))this._setContent(e,n,t);const t=e.children[0],n=this._resolvePossibleFunction(this._config.extraClass);return n&&t.classList.add(...n.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,n]of Object.entries(e))super._typeCheckConfig({selector:t,entry:n},jk)}_setContent(e,t,n){const r=qE.findOne(n,e);r&&((t=this._resolvePossibleFunction(t))?rE(t)?this._putElementInTemplate(iE(t),r):this._config.html?r.innerHTML=this._maybeSanitize(t):r.textContent=t:r.remove())}_maybeSanitize(e){return this._config.sanitize?function(e,t,n){if(!e.length)return e;if(n&&"function"==typeof n)return n(e);const r=(new window.DOMParser).parseFromString(e,"text/html"),i=[].concat(...r.body.querySelectorAll("*"));for(const e of i){const n=e.nodeName.toLowerCase();if(!Object.keys(t).includes(n)){e.remove();continue}const r=[].concat(...e.attributes),i=[].concat(t["*"]||[],t[n]||[]);for(const t of r)wk(t,i)||e.removeAttribute(t.nodeName)}return r.body.innerHTML}(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return pE(e,[void 0,this])}_putElementInTemplate(e,t){if(this._config.html)return t.innerHTML="",void t.append(e);t.textContent=e.textContent}constructor(e){super(),this._config=this._getConfig(e)}};function Ek(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ok(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ek(e,t,n[t])}))}return e}function Ck(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const kk=new Set(["sanitize","allowList","sanitizeFn"]),Tk="fade",Nk="show",Mk=".tooltip-inner",Ik=".modal",Pk="hide.bs.modal",Dk="hover",Rk="focus",zk={AUTO:"auto",TOP:"top",RIGHT:hE()?"left":"right",BOTTOM:"bottom",LEFT:hE()?"right":"left"},Lk={allowList:yk,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Uk={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Bk extends UE{static get Default(){return Lk}static get DefaultType(){return Uk}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),ME.off(this._element.closest(Ik),Pk,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const e=ME.trigger(this._element,this.constructor.eventName("show")),t=(aE(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!t)return;this._disposePopper();const n=this._getTipElement();this._element.setAttribute("aria-describedby",n.getAttribute("id"));const{container:r}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(r.append(n),ME.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(n),n.classList.add(Nk),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))ME.on(e,"mouseover",cE);this._queueCallback((()=>{ME.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(ME.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented)return;if(this._getTipElement().classList.remove(Nk),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))ME.off(e,"mouseover",cE);this._activeTrigger.click=!1,this._activeTrigger[Rk]=!1,this._activeTrigger[Dk]=!1,this._isHovered=null;this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),ME.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml();if(!t)return null;t.classList.remove(Tk,Nk),t.classList.add(`bs-${this.constructor.NAME}-auto`);const n=(e=>{do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e})(this.constructor.NAME).toString();return t.setAttribute("id",n),this._isAnimated()&&t.classList.add(Tk),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new $k(Ck(Ok({},this._config),{content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)})),this._templateFactory}_getContentForTemplate(){return{[Mk]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Tk)}_isShown(){return this.tip&&this.tip.classList.contains(Nk)}_createPopper(e){const t=pE(this._config.placement,[this,e,this._element]),n=zk[t.toUpperCase()];return X$(this._element,e,this._getPopperConfig(n))}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_resolvePossibleFunction(e){return pE(e,[this._element,this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:e=>{this._getTipElement().setAttribute("data-popper-placement",e.state.placement)}}]};return Ok({},t,pE(this._config.popperConfig,[void 0,t]))}_setListeners(){const e=this._config.trigger.split(" ");for(const t of e)if("click"===t)ME.on(this._element,this.constructor.eventName("click"),this._config.selector,(e=>{this._initializeOnDelegatedTarget(e).toggle()}));else if("manual"!==t){const e=t===Dk?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),n=t===Dk?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");ME.on(this._element,e,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusin"===e.type?Rk:Dk]=!0,t._enter()})),ME.on(this._element,n,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusout"===e.type?Rk:Dk]=t._element.contains(e.relatedTarget),t._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},ME.on(this._element.closest(Ik),Pk,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=RE.getDataAttributes(this._element);for(const e of Object.keys(t))kk.has(e)&&delete t[e];return e=Ok({},t,"object"==typeof e&&e?e:{}),e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=!1===e.container?document.body:iE(e.container),"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),"number"==typeof e.title&&(e.title=e.title.toString()),"number"==typeof e.content&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[t,n]of Object.entries(this._config))this.constructor.Default[t]!==n&&(e[t]=n);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each((function(){const t=Bk.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}constructor(e,t){super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}}fE(Bk);const Fk=Bk;function qk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qk(e,t,n[t])}))}return e}function Gk(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Wk=".popover-header",Vk=".popover-body",Kk=Gk(Hk({},Fk.Default),{content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"}),Jk=Gk(Hk({},Fk.DefaultType),{content:"(null|string|element|function)"});class Yk extends Fk{static get Default(){return Kk}static get DefaultType(){return Jk}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Wk]:this._getTitle(),[Vk]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each((function(){const t=Yk.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}}fE(Yk);const Xk=Yk;var Qk=n(6865),Zk={};Zk.styleTagTransform=D(),Zk.setAttributes=N(),Zk.insert=k().bind(null,"head"),Zk.domAPI=O(),Zk.insertStyleElement=I();$()(Qk.A,Zk);Qk.A&&Qk.A.locals&&Qk.A.locals;class eT extends uA{static get properties(){return{title:{type:String},text:{type:String}}}firstUpdated(e){super.firstUpdated(e),new Xk(this.firstElementChild,{container:"converse-root",trigger:"focus"})}render(){return mf`<button type="button" class="btn p-0" data-toggle="popover" data-bs-title="${this.title}" data-bs-content="${this.text}"><converse-icon class="fa fa-info-circle" size="1.2em"></converse-icon></button>`}constructor(){super(),this.title=null,this.text=null}}Wu.elements.define("converse-popover",eT);const tT=eT;var nT=n(4399),rT={};rT.styleTagTransform=D(),rT.setAttributes=N(),rT.insert=k().bind(null,"head"),rT.domAPI=O(),rT.insertStyleElement=I();$()(nT.A,rT);nT.A&&nT.A.locals&&nT.A.locals;class iT extends uA{static get properties(){return{type:{type:String},name:{type:String},title:{type:String},body:{type:String}}}updated(e){"danger"!==e.get("type")?this.timeoutId=setTimeout((()=>this.hide()),5e3):clearTimeout(this.timeoutId)}render(){var e,t,n;return mf`<div class="toast show text-bg-${null!==(e=this.type)&&void 0!==e?e:"info"}" role="alert" aria-live="assertive" aria-atomic="true">${this.title?mf`<div class="toast-header"><img src="/logo/conversejs-filled.svg" class="rounded me-2" alt="${aA("Converse logo")}"> <strong class="me-auto">${null!==(t=this.title)&&void 0!==t?t:""}</strong> <button @click="${this.hide}" type="button" class="btn-close" aria-label="${aA("Close")}"></button></div>`:""} ${this.body?mf`<div class="d-flex justify-content-between toast-body__container"><div class="toast-body w-100">${null!==(n=this.body)&&void 0!==n?n:""}</div>${this.title?"":mf`<button @click="${this.hide}" type="button" class="btn centered" aria-label="${aA("Close")}"><converse-icon size="1em" class="fa fa-times"></converse-icon></button>`}</div>`:""}</div>`}hide(e){null==e||e.preventDefault(),Wu.toast.remove(this.name)}constructor(){super(),this.name="",this.body="",this.header="",this.type="info"}}Wu.elements.define("converse-toast",iT);class sT extends uA{render(){return mf`<converse-about-modal></converse-about-modal>`}}Wu.elements.define("converse-modals",sT);class oT extends uA{initialize(){super.initialize(),Wu.listen.on("showToast",(()=>this.requestUpdate())),Wu.listen.on("hideToast",(()=>this.requestUpdate()))}render(){const e=Wu.toast.get();return mf`${e.map((e=>{var t,n,r;return mf`<converse-toast name="${e.name}" title="${null!==(t=e.title)&&void 0!==t?t:""}" body="${null!==(n=e.body)&&void 0!==n?n:""}" type="${null!==(r=e.type)&&void 0!==r?r:""}"></converse-toast>`}))}`}}Wu.elements.define("converse-toasts",oT);Hp.plugins.add("converse-modal",{initialize(){Wu.listen.on("disconnect",(()=>{const e=document.querySelector("#converse-modals");e&&(e.innerHTML="")})),Wu.listen.on("clearSession",(()=>Wu.modal.removeAll())),Object.assign(Ao.exports,{BaseModal:ak,Popover:tT,Toast:iT}),Object.assign(Ao.api,vk)}});const aT=class extends String{get lenth(){return this.label.length}toString(){return`${this.label}`}valueOf(){return this.toString()}constructor(e,t){super();const n=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=n.label||n.value,this.value=n.value,this.query=t,this.data=e}},cT=Hp.env.utils,lT={getElement:(e,t)=>"string"==typeof e?(t||document).querySelector(e):e||null,bind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const r=t[n];n.split(/\s+/).forEach((t=>e.addEventListener(t,r)))}},unbind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const r=t[n];n.split(/\s+/).forEach((t=>e.removeEventListener(t,r)))}},isMention:(e,t)=>t.includes(e[0])||cT.isMentionBoundary(e[0])&&t.includes(e[1])};function uT(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}function dT(e,t){return RegExp(uT(t.trim()),"i").test(e)}function hT(e,t){return RegExp("^"+uT(t.trim()),"i").test(e)}const fT=function(e,t){const n=e.query.toLowerCase(),r=e.label.toLowerCase().indexOf(n),i=t.label.toLowerCase().indexOf(n);return r===i?function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1}(e,t):(-1===r?1/0:r)<(-1===i?1/0:i)?-1:1};function pT(e,t){t=t.trim();const n=new RegExp("("+uT(t)+")","ig"),r=t?e.split(n):[e];return mf`<li aria-selected="false">${r.map((e=>t&&e.match(n)?mf`<mark>${e}</mark>`:e))}</li>`}function mT(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Object.assign(cT,{autocomplete:{regExpEscape:uT,getAutoCompleteItem:pT}});const{siblingIndex:gT}=Up;class vT extends((0,ae.EventEmitter)(Object)){bindEvents(){this._events={input:{blur:()=>this.close({reason:"blur"})},form:{submit:()=>this.close({reason:"submit"})},ul:{mousedown:e=>this.onMouseDown(e),mouseover:e=>this.onMouseOver(e)}},lT.bind(this.input,this._events.input),lT.bind(this.input.form,this._events.form),lT.bind(this.ul,this._events.ul)}set list(e){if(Array.isArray(e)||"function"==typeof e)this._list=e;else if("string"==typeof e&&e.includes(","))this._list=e.split(/\s*,\s*/);else{var t;const n=(null===(t=lT.getElement(e))||void 0===t?void 0:t.children)||[];this._list=Array.from(n).filter((e=>!e.disabled)).map((e=>{const t=e.textContent.trim(),n=e.value||t,r=e.label||t;return""!==n?{label:r,value:n}:null})).filter((e=>e))}document.activeElement===this.input&&this.evaluate()}get list(){return this._list}get selected(){return this.index>-1}get opened(){return this.is_opened}close(e){this.opened&&(this.ul.setAttribute("hidden",""),this.is_opened=!1,this.index=-1,this.trigger("suggestion-box-close",e||{}))}insertValue(e){this.match_current_word?Up.replaceCurrentWord(this.input,e.value):this.input.value=e.value}open(){this.ul.removeAttribute("hidden"),this.is_opened=!0,this.auto_first&&-1===this.index&&this.goto(0),this.trigger("suggestion-box-open")}destroy(){lT.unbind(this.input,this._events.input),lT.unbind(this.input.form,this._events.form),this.input.removeAttribute("aria-autocomplete")}next(){const e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)}previous(){const e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)}goto(e,t=!0){const n=Array.from(this.ul.children).filter((e=>e instanceof HTMLElement));this.selected&&n[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&n.length>0&&(n[e].setAttribute("aria-selected","true"),n[e].focus(),this.status.textContent=n[e].textContent,t&&(this.ul.scrollTop=n[e].offsetTop-this.ul.clientHeight+n[e].clientHeight),this.trigger("suggestion-box-highlight",{text:this.suggestions[this.index]}))}select(e){if(e?this.index=gT(e):e=this.ul.children[this.index],e){const e=this.suggestions[this.index];this.insertValue(e),this.close({reason:"select"}),this.auto_completing=!1,this.trigger("suggestion-box-selectcomplete",{text:e,suggestion:e})}}onMouseOver(e){const t=Up.ancestor(e.target,"li");if(t){const e=Array.prototype.slice.call(this.ul.children).indexOf(t);this.goto(e,!1)}}onMouseDown(e){if(0!==e.button)return;const t=Up.ancestor(e.target,"li");t&&(e.preventDefault(),this.select(t))}onKeyDown(e){if(this.opened){if([Hp.keycodes.ENTER,Hp.keycodes.TAB].includes(e.key)&&this.selected)return e.preventDefault(),e.stopPropagation(),this.select(),!0;if(e.key===Hp.keycodes.ESCAPE)return this.close({reason:"esc"}),!0;if([Hp.keycodes.UP_ARROW,Hp.keycodes.DOWN_ARROW].includes(e.key))return e.preventDefault(),e.stopPropagation(),this[e.key===Hp.keycodes.UP_ARROW?"previous":"next"](),!0}if(![Hp.keycodes.SHIFT,Hp.keycodes.META,Hp.keycodes.ESCAPE,Hp.keycodes.ALT].includes(e.key))if(this.ac_triggers.includes(e.key)){if("Tab"===e.key){if(e.shiftKey)return;if(this.min_chars>0&&""===this.input.value)return;e.preventDefault()}this.auto_completing=!0}else if("Backspace"===e.key){const t=e.target,n=Up.getCurrentWord(t,t.selectionEnd-1);lT.isMention(n,this.ac_triggers)&&(this.auto_completing=!0)}}evaluate(e){return(t=function*(){if(this.selected&&e&&(e.key===Hp.keycodes.UP_ARROW||e.key===Hp.keycodes.DOWN_ARROW))return;let t=this.match_current_word?Up.getCurrentWord(this.input):this.input.value;const n=lT.isMention(t,this.ac_triggers);n&&!this.include_triggers.includes(e.key)&&(t=Up.isMentionBoundary(t[0])?t.slice(2):t.slice(1));const r=t.length&&t.length>=this.min_chars;if(n||r){this.auto_completing=!0;const e="function"==typeof this._list?yield this._list(t):this._list;if(0===e.length||!this.auto_completing)return void this.close({reason:"nomatches"});this.index=-1,this.suggestions=e.map((e=>new aT(this.data(e,t),t))).filter((({value:e})=>this.filter(e,t))),this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.max_items),Pf(mf`${this.suggestions.map((e=>this.item(e,t)))}`,this.ul),0===this.suggestions.length?this.close({reason:"nomatches"}):this.open()}else this.close({reason:"nomatches"}),n||(this.auto_completing=!1)},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){mT(s,r,i,o,a,"next",e)}function a(e){mT(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}constructor(e,t={}){super(),this.suggestions=[],this.is_opened=!1,this.match_current_word=!1,this.sort=!1===t.sort?null:fT,this.filter=dT,this.ac_triggers=[],this.include_triggers=[],this.min_chars=2,this.max_items=10,this.auto_first=!1,this.data=(e,t)=>e,this.item=pT,Up.hasClass("suggestion-box",e)?this.container=e:this.container=e.querySelector(".suggestion-box"),this.input=this.container.querySelector(".suggestion-box__input"),this.input.setAttribute("aria-autocomplete","list"),this.ul=this.container.querySelector(".suggestion-box__results"),this.status=this.container.querySelector(".suggestion-box__additions"),Object.assign(this,t),this.index=-1,this.bindEvents(),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||t.list||[]}}const yT=vT;function bT(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-autocomplete",class extends uA{static get properties(){return{auto_evaluate:{type:Boolean},auto_first:{type:Boolean},autofocus:{type:Boolean},data:{type:Function},error_message:{type:String},filter:{type:String},getAutoCompleteList:{type:Function},include_triggers:{type:String},list:{type:Array},min_chars:{type:Number},name:{type:String},placeholder:{type:String},position:{type:String},renderItem:{type:Function},required:{type:Boolean},triggers:{type:String},validate:{type:Function},value:{type:String}}}render(){const e=`suggestion-box__results--${this.position}`;return mf`<div class="suggestion-box suggestion-box__name"><ul class="suggestion-box__results ${e}" hidden=""></ul><input .validate="${this.validate}" ?autofocus="${this.autofocus}" ?required="${this.required}" @change="${this.onChange}" @keydown="${this.onKeyDown}" @input="${this.evaluate}" autocomplete="off" class="form-control suggestion-box__input ${this.error_message?"is-invalid error":""}" name="${this.name}" placeholder="${this.placeholder}" type="text" value="${this.value}"> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div>${this.error_message?mf`<div class="invalid-feedback">${this.error_message}</div>`:""}`}firstUpdated(){var e;this.auto_complete=new yT(this.firstElementChild,{ac_triggers:this.triggers.split(" "),auto_first:this.auto_first,filter:"contains"==this.filter?dT:hT,include_triggers:[],list:null!==(e=this.list)&&void 0!==e?e:e=>this.getAutoCompleteList(e),data:this.data,match_current_word:!0,max_items:this.max_items,min_chars:this.min_chars,item:this.renderItem}),this.auto_complete.on("suggestion-box-selectcomplete",(({suggestion:e})=>{this.auto_completing=!1,this.dispatchEvent(new CustomEvent("autocomplete-select",{detail:{suggestion:e},bubbles:!0,composed:!0}))}))}onKeyDown(e){this.auto_complete.onKeyDown(e)}onChange(){return(e=function*(){var e;const t=this.querySelector("input");return this.error_message=yield null===(e=this.validate)||void 0===e?void 0:e.call(this,t.value),this.error_message&&this.requestUpdate(),this},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){bT(s,r,i,o,a,"next",e)}function a(e){bT(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}constructor(){super(),this.auto_evaluate=!0,this.auto_first=!1,this.data=e=>e,this.error_message="",this.filter="contains",this.getAutoCompleteList=null,this.include_triggers="",this.list=null,this.match_current_word=!1,this.max_items=10,this.min_chars=1,this.name="",this.placeholder="",this.position="above",this.renderItem=pT,this.required=!1,this.triggers="",this.validate=null,this.value="",this.evaluate=Up.debounce((e=>{this.auto_evaluate&&this.auto_complete.evaluate(e)}),250)}});var _T=n(593),wT={};wT.styleTagTransform=D(),wT.setAttributes=N(),wT.insert=k().bind(null,"head"),wT.domAPI=O(),wT.insertStyleElement=I();$()(_T.A,wT);_T.A&&_T.A.locals&&_T.A.locals;const ST={AutoComplete:yT};Object.assign(Ao,ST),Object.assign(Ao.exports,ST);const xT={execute:aA("Execute"),prev:aA("Previous"),next:aA("Next"),complete:aA("Complete")},AT={info:"primary",warn:"secondary",error:"danger"};const jT=(e,t)=>{var n,r,i;const s=aA("Cancel");var o;return mf`<span><form class="converse-form">${t.alert?mf`<div class="alert alert-${t.alert_type}" role="alert">${t.alert}</div>`:""} ${t.note?mf`<div class="alert alert-${AT[t.note.type||"info"]}" role="alert">${t.note.text}</div>`:""} ${"result"===t.type&&t.title?mf`<div class="alert alert-info">${t.title}</div>`:""} ${"form"===t.type&&t.title?mf`<h6>${t.title}</h6>`:""}<fieldset><input type="hidden" name="command_node" value="${t.node}"> <input type="hidden" name="command_jid" value="${t.jid}"> ${t.instructions?mf`<p class="form-instructions">${t.instructions}</p>`:""} ${"result"===t.type?function(e){var t,n;return mf`<table class="table"><thead class="thead-light">${null===(t=e.reported)||void 0===t?void 0:t.map((e=>mf`<th scope="col" data-var="${e.var}">${e.label}</th>`))}</thead><tbody>${null===(n=e.items)||void 0===n?void 0:n.map((e=>mf`<tr>${e.map((e=>mf`<td data-var="${e.var}">${e.value}</td>`))}</tr>`))}</tbody></table>`}(t):""} ${null!==(o=null===(n=t.fields)||void 0===n?void 0:n.map((e=>hj(e)),{domain:t.jid}))&&void 0!==o?o:""}</fieldset>${(null===(r=t.actions)||void 0===r?void 0:r.length)?mf`<fieldset>${null===(i=t.actions)||void 0===i?void 0:i.map((t=>mf`<input data-action="${t}" @click="${t=>e.executeAction(t)}" type="button" class="btn btn-primary" value="${xT[t]}">`))} <input type="button" class="btn btn-secondary button-cancel" value="${s}" @click="${t=>e.cancel(t)}"></fieldset>`:""}</form></span>`};var $T=n(364),ET={};ET.styleTagTransform=D(),ET.setAttributes=N(),ET.insert=k().bind(null,"head"),ET.domAPI=O(),ET.insertStyleElement=I();$()($T.A,ET);$T.A&&$T.A.locals&&$T.A.locals;Wu.elements.define("converse-avatar",class extends uA{static get properties(){return{model:{type:Object},pickerdata:{type:Object},name:{type:String},width:{type:String},height:{type:String},nonce:{type:String}}}render(){let e,t,n;var r,i,s,o;this.pickerdata?(e=this.pickerdata.image_type,n=this.pickerdata.data_uri):(e=null===(i=this.model)||void 0===i||null===(r=i.vcard)||void 0===r?void 0:r.get("image_type"),t=null===(o=this.model)||void 0===o||null===(s=o.vcard)||void 0===s?void 0:s.get("image"));if(e&&(t||n))return(e=>{return e.image?mf`<svg xmlns="http://www.w3.org/2000/svg" class="avatar ${e.classes}" width="${e.width}" height="${e.height}" aria-label="${e.alt_text}" role="${e.alt_text?yf:"presentation"}"><image width="${e.width}" height="${e.height}" preserveAspectRatio="xMidYMid meet" href="${t=e.image,n=e.image_type,t.startsWith("data:")?t:`data:${n};base64,${t}`}"/></svg>`:"";var t,n})({classes:this.getAttribute("class"),height:this.height,width:this.width,image:n||`data:${e};base64,${t}`,image_type:e,alt_text:aA("The profile picture of %1$s",this.name)});const a=`\n            width: ${this.width}px;\n            height: ${this.height}px;\n            font: ${this.width/2}px Arial;\n            line-height: ${this.height}px;`,c=this.model.getAvatarStyle(a);return mf`<div class="avatar-initials" style="${NA(c,"background-color: gray;"+a)}" aria-label="${this.name}">${this.getInitials(this.name)}</div>`}getInitials(e){const t=null==e?void 0:e.split(" ");return(null==t?void 0:t.length)>1?t[0].charAt(0).toUpperCase()+t[t.length-1].charAt(0).toUpperCase():1===(null==t?void 0:t.length)?t[0].charAt(0).toUpperCase():""}constructor(){super(),this.model=null,this.pickerdata=null,this.width=36,this.height=36,this.name=""}});var OT=n(8083),CT={};CT.styleTagTransform=D(),CT.setAttributes=N(),CT.insert=k().bind(null,"head"),CT.domAPI=O(),CT.insertStyleElement=I();$()(OT.A,CT);OT.A&&OT.A.locals&&OT.A.locals;const{u:kT}=Hp.env;function TT(e){return"moderator"===e?aA("Moderators are privileged users who can change the roles of other users (except those with admin or owner affiliations."):"participant"===e?aA("The default role, implies that you can read and write messages."):"visitor"==e?aA("Visitors aren't allowed to write messages in a moderated multi-user chat."):void 0}function NT(e){return"owner"===e?aA("Owner is the highest affiliation. Owners can modify roles and affiliations of all other users."):"admin"===e?aA("Admin is the 2nd highest affiliation. Admins can modify roles and affiliations of all other users except owners."):"outcast"===e?aA('To ban a user, you give them the affiliation of "outcast".'):void 0}Wu.elements.define("converse-muc-occupant-modal",class extends ak{initialize(){var e;super.initialize();const t=null!==(e=this.model)&&void 0!==e?e:this.message;this.listenTo(t,"change",(()=>this.requestUpdate())),Wu.trigger("occupantModalInitialized",{model:this.model,message:this.message})}renderModal(){return(e=>{var t,n,r,i,s;const o=null!==(s=e.model)&&void 0!==s?s:e.message,a=null==o?void 0:o.get("jid"),c=e.getVcard(),l=o.get("nick"),u=o.get("occupant_id"),d=null===(t=e.model)||void 0===t?void 0:t.get("role"),h=null===(n=e.model)||void 0===n?void 0:n.get("affiliation"),f=(null===(i=e.model)||void 0===i||null===(r=i.get("hats"))||void 0===r?void 0:r.length)?e.model.get("hats"):null,p=e.model.collection.chatroom,m=aA("Add to Contacts"),g=p.getAllowedCommands().includes("modtools"),v=p.features.get("nonanonymous")||"moderator"===p.getOwnRole(),y=a!=Ao.session.get("bare_jid"),b=Wu.settings.get("singleton")?"":Wu.contacts.get(a).then((e=>!e&&y&&v)).then((t=>t?mf`<li><button class="btn btn-primary" type="button" @click="${()=>e.addToContacts()}">${m}</button></li>`:""));return mf`<div class="row"><div class="col-auto"><converse-avatar .model="${e.model}" class="avatar modal-avatar" name="${e.model.getDisplayName()}" nonce="${null==c?void 0:c.get("vcard_updated")}" height="120" width="120"></converse-avatar></div><div class="col"><ul class="occupant-details list-unstyled"><li class="row mb-2"><div class="col text-start"><strong>${aA("Nickname")}:</strong></div><div class="col text-end">${l}</div></li><li class="row mb-2"><div class="col text-start"><strong>${aA("XMPP Address")}:</strong></div><div class="col text-end">${a?mf`<a href="#" @click="${e.openChat}">${a}</a>`:""}</div></li><li class="row mb-2"><div class="col text-start"><strong>${aA("Affiliation")}:</strong></div><div class="col text-end">${h}  ${g?mf`<a href="#" data-form="affiliation-form" class="toggle-form" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`:""}</div>${e.show_affiliation_form?mf`<div class="row mt-2"><converse-muc-affiliation-form jid="${a}" .muc="${p}" affiliation="${h}"></converse-muc-affiliation-form></div>`:""}</li><li class="row mb-2"><div class="col text-start"><strong>${aA("Role")}:</strong></div><div class="col text-end">${d}  ${g&&d?mf`<a href="#" data-form="row-form" class="toggle-form" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`:""}</div>${e.show_role_form?mf`<div class="row mt-2"><converse-muc-role-form jid="${a}" .muc="${p}" role="${d}"></converse-muc-role-form></div>`:""}</li><li class="row mb-2"><div class="col text-start"><strong>${aA("Hats")}:</strong></div><div class="col text-end">${f}</div></li><li class="row mb-2"><div class="col text-start"><strong>${aA("Occupant Id")}:</strong></div><div class="col text-end text-occupant-id">${u}</div></li>${NA(b,"")}</ul></div></div>`})(this)}openChat(e){e.preventDefault(),Wu.chats.open(this.model.get("jid"),{},!0),this.close()}getVcard(){var e;const t=null!==(e=this.model)&&void 0!==e?e:this.message;if(t.vcard)return t.vcard;const n=(null==t?void 0:t.get("jid"))||(null==t?void 0:t.get("from"));return n?Ao.state.vcards.get(n):null}getModalTitle(){var e;const t=null!==(e=this.model)&&void 0!==e?e:this.message;return null==t?void 0:t.getDisplayName()}addToContacts(){var e;const t=(null!==(e=this.model)&&void 0!==e?e:this.message).get("jid");t&&Wu.modal.show("converse-add-contact-modal",{state:new ae.Model({jid:t})})}toggleForm(e){"row-form"===kT.ancestor(e.target,".toggle-form").getAttribute("data-form")?this.show_role_form=!this.show_role_form:this.show_affiliation_form=!this.show_affiliation_form,this.requestUpdate()}constructor(e){super(),this.message=e.message,this.addEventListener("affiliationChanged",(()=>this.alert(aA("Affiliation changed")))),this.addEventListener("roleChanged",(()=>this.alert(aA("role changed"))))}});const MT=(e,t)=>mf`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Role:</strong> ${t.item.role} ${t.assignable_roles.length?(e=>mf`<a href="#" data-form="converse-muc-role-form" class="toggle-form right" color="var(--secondary-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_roles.length?mf`<converse-muc-role-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" role="${t.item.role}"></converse-muc-role-form>`:""}</li></ul></li>`,IT=(e,t)=>mf`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Affiliation:</strong> ${t.item.affiliation} ${t.assignable_affiliations.length?(e=>mf`<a href="#" data-form="converse-muc-affiliation-form" class="toggle-form right" color="var(--secondary-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_affiliations.length?mf`<converse-muc-affiliation-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" affiliation="${t.item.affiliation}"></converse-muc-affiliation-form>`:""}</li></ul></li>`,PT=(e,t)=>{const n=aA("Affiliation"),r=aA("No users with that affiliation found."),i=aA("No users with that role found."),s=aA("Type here to filter the search results"),o=aA("Role"),a=aA("Show users"),c=aA("Roles are assigned to users to grant or deny them certain abilities in a multi-user chat. They're assigned either explicitly or implicitly as part of an affiliation. A role that's not due to an affiliation, is only valid for the duration of the user's session."),l=aA("An affiliation is a long-lived entitlement which typically implies a certain role and which grants privileges and responsibilities. For example admins and owners automatically have the moderator role."),u=t.queryable_roles.length&&t.queryable_affiliations.length;return mf`${t.alert_message?mf`<div class="alert alert-${t.alert_type}" role="alert">${t.alert_message}</div>`:""} ${u?(e=>mf`<ul class="nav nav-pills justify-content-center"><li role="presentation" class="nav-item"><a class="nav-link ${"affiliations"===e.tab?"active":""}" id="affiliations-tab" href="#affiliations-tabpanel" aria-controls="affiliations-tabpanel" role="tab" data-name="affiliations" @click="${e.switchTab}">Affiliations</a></li><li role="presentation" class="nav-item"><a class="nav-link ${"roles"===e.tab?"active":""}" id="roles-tab" href="#roles-tabpanel" aria-controls="roles-tabpanel" role="tab" data-name="roles" @click="${e.switchTab}">Roles</a></li></ul>`)(t):""}<div class="tab-content">${t.queryable_affiliations.length?mf`<div class="tab-pane tab-pane--columns ${"affiliations"===t.tab?"active":""}" id="affiliations-tabpanel" role="tabpanel" aria-labelledby="affiliations-tab"><form class="converse-form query-affiliation" @submit="${t.queryAffiliation}"><p class="helptext pb-3">${l}</p><div><label class="form-label" for="affiliation"><strong>${n}:</strong></label><div class="row"><div class="col"><select class="form-select select-affiliation" name="affiliation">${t.queryable_affiliations.map((e=>(e=>mf`<option value="${e.item||""}" ?selected="${e.item===e.affiliation}" title="${NT(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_affiliation" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_affiliation)&&t.users_with_affiliation.length>5?mf`<input class="form-control" .value="${t.affiliations_filter}" @keyup="${t.filterAffiliationResults}" type="text" name="filter" placeholder="${s}">`:""}</div></div>${NT(t.affiliation)?mf`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${NT(t.affiliation)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_affiliation?mf`<li class="list-group-item">${BO()}</li>`:""} ${Array.isArray(t.users_with_affiliation)&&0===t.users_with_affiliation.length?mf`<li class="list-group-item">${r}</li>`:""} ${t.users_with_affiliation instanceof Error?mf`<li class="list-group-item">${t.users_with_affiliation.message}</li>`:(t.users_with_affiliation||[]).map((n=>(n.nick||n.jid).match(new RegExp(t.affiliations_filter,"i"))?IT(e,Object.assign({item:n},t)):""))}</ul></div></div>`:""} ${t.queryable_roles.length?mf`<div class="tab-pane tab-pane--columns ${"roles"===t.tab?"active":""}" id="roles-tabpanel" role="tabpanel" aria-labelledby="roles-tab"><form class="converse-form query-role" @submit="${t.queryRole}"><p class="helptext pb-3">${c}</p><div><label class="form-label" for="role"><strong>${o}:</strong></label><div class="row"><div class="col"><select class="form-select select-role" name="role">${t.queryable_roles.map((e=>(e=>mf`<option value="${e.item||""}" ?selected="${e.item===e.role}" title="${TT(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_role" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_role)&&t.users_with_role.length>5?mf`<input class="form-control" .value="${t.roles_filter}" @keyup="${t.filterRoleResults}" type="text" name="filter" placeholder="${s}">`:""}</div></div>${TT(t.role)?mf`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${TT(t.role)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_role?mf`<li class="list-group-item">${BO()}</li>`:""} ${t.users_with_role&&0===t.users_with_role.length?mf`<li class="list-group-item">${i}</li>`:""} ${(t.users_with_role||[]).map((n=>n.nick.match(t.roles_filter)?MT(e,Object.assign({item:n},t)):""))}</ul></div></div>`:""}</div>`};var DT=n(1946),RT={};RT.styleTagTransform=D(),RT.setAttributes=N(),RT.insert=k().bind(null,"head"),RT.domAPI=O(),RT.insertStyleElement=I();$()(DT.A,RT);DT.A&&DT.A.locals&&DT.A.locals;function zT(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function LT(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){zT(s,r,i,o,a,"next",e)}function a(e){zT(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{u:UT}=Hp.env,{AFFILIATIONS:BT,ROLES:FT}=Xx;Wu.elements.define("converse-modtools",class extends uA{static get properties(){return{affiliation:{type:String},affiliations_filter:{type:String,attribute:!1},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1},jid:{type:String},muc:{type:Object,attribute:!1},role:{type:String},roles_filter:{type:String,attribute:!1},tab:{type:String},users_with_affiliation:{type:Array,attribute:!1},users_with_role:{type:Array,attribute:!1}}}updated(e){e.has("role")&&this.onSearchRoleChange(),e.has("affiliation")&&this.onSearchAffiliationChange(),e.has("jid")&&e.get("jid")&&this.initialize()}initialize(){return LT((function*(){this.initialized=ue();const e=yield Wu.rooms.get(this.jid);yield e.initialized,this.muc=e,this.initialized.resolve()})).call(this)}render(){var e;if(null===(e=this.muc)||void 0===e?void 0:e.occupants){const e=this.muc.occupants.getOwnOccupant();return PT(this,{affiliations_filter:this.affiliations_filter,alert_message:this.alert_message,alert_type:this.alert_type,assignable_affiliations:e.getAssignableAffiliations(),assignable_roles:e.getAssignableRoles(),filterAffiliationResults:e=>this.filterAffiliationResults(e),filterRoleResults:e=>this.filterRoleResults(e),loading_users_with_affiliation:this.loading_users_with_affiliation,queryAffiliation:e=>this.queryAffiliation(e),queryRole:e=>this.queryRole(e),queryable_affiliations:BT.filter((e=>!Wu.settings.get("modtools_disable_query").includes(e))),queryable_roles:FT.filter((e=>!Wu.settings.get("modtools_disable_query").includes(e))),roles_filter:this.roles_filter,switchTab:e=>this.switchTab(e),tab:this.tab,toggleForm:e=>this.toggleForm(e),users_with_affiliation:this.users_with_affiliation,users_with_role:this.users_with_role})}return""}switchTab(e){e.stopPropagation(),e.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.requestUpdate()}onSearchAffiliationChange(){return LT((function*(){if(this.affiliation){if(yield this.initialized,this.clearAlert(),this.loading_users_with_affiliation=!0,this.users_with_affiliation=null,this.shouldFetchAffiliationsList()){const e=yield Wu.rooms.affiliations.get(this.affiliation,this.jid);e instanceof Error?(this.alert(e.message,"danger"),this.users_with_affiliation=[]):this.users_with_affiliation=e}else this.users_with_affiliation=this.muc.getOccupantsWithAffiliation(this.affiliation);this.loading_users_with_affiliation=!1}})).call(this)}onSearchRoleChange(){return LT((function*(){this.role&&(yield this.initialized,this.clearAlert(),this.users_with_role=this.muc.getOccupantsWithRole(this.role))})).call(this)}shouldFetchAffiliationsList(){const e=this.affiliation;if("none"===e)return!1;return!Uy.getAutoFetchedAffiliationLists().includes(e)}toggleForm(e){e.stopPropagation(),e.preventDefault();const t=UT.ancestor(e.target,".toggle-form"),n=t.getAttribute("data-form"),r=UT.ancestor(t,".list-group-item").querySelector(n);UT.hasClass("hidden",r)?UT.removeClass("hidden",r):UT.addClass("hidden",r)}filterRoleResults(e){this.roles_filter=e.target.value,this.requestUpdate()}filterAffiliationResults(e){this.affiliations_filter=e.target.value}queryRole(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("role");this.role=null,this.role=t}queryAffiliation(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("affiliation");this.affiliation=null,this.affiliation=t}alert(e,t){this.alert_message=e,this.alert_type=t}clearAlert(){this.alert_message=void 0,this.alert_type=void 0}constructor(){super(),this.jid=null,this.tab="affiliations",this.affiliation=null,this.affiliations_filter="",this.role="",this.roles_filter="",this.addEventListener("affiliationChanged",(()=>{this.alert(aA("Affiliation changed"),"primary"),this.onSearchAffiliationChange(),this.requestUpdate()})),this.addEventListener("roleChanged",(()=>{this.alert(aA("Role changed"),"primary"),this.requestUpdate()}))}});function qT(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function HT(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){qT(s,r,i,o,a,"next",e)}function a(e){qT(s,r,i,o,a,"throw",e)}o(void 0)}))}}Wu.elements.define("converse-modtools-modal",class extends ak{renderModal(){return mf`<converse-modtools jid="${this.jid}" affiliation="${this.affiliation}"></converse-modtools>`}getModalTitle(){return aA("Moderator Tools")}constructor(e){super(e),this.id="converse-modtools-modal",this.affiliation=e.affiliation,this.jid=e.jid}});const{Strophe:GT,u:WT}=Hp.env,{CHATROOMS_TYPE:VT}=Xx,KT={admin:"admin",ban:"outcast",member:"member",owner:"owner",revoke:"none"},JT={deop:"participant",kick:"none",mute:"visitor",op:"moderator",voice:"participant"};function YT({contact:e,jid:t,reason:n}){return n?Wu.confirm(aA("Invitation to a groupchat"),aA('%1$s has invited you to join the groupchat "%2$s", and left the following reason: "%3$s"',e,t,n)):Wu.confirm(aA("Invitation to a groupchat"),aA('%1$s has invited you to join the groupchat "%2$s"',e,t))}function XT(e){return HT((function*(){const t=[aA("Are you sure you want to destroy this groupchat?")];let n=[{name:"challenge",label:aA("Please enter the XMPP address of this groupchat to confirm"),challenge:e.get("jid"),placeholder:aA("name@example.org"),required:!0},{name:"reason",label:aA("Optional reason for destroying this groupchat"),placeholder:aA("Reason")},{name:"newjid",label:aA("Optional XMPP address for a new groupchat that replaces this one"),placeholder:aA("replacement@example.org")}];try{var r,i;n=yield Wu.confirm(aA("Confirm"),t,n);const s=null===(r=n.filter((e=>"reason"===e.name)).pop())||void 0===r?void 0:r.value,o=null===(i=n.filter((e=>"newjid"===e.name)).pop())||void 0===i?void 0:i.value;return e.sendDestroyIQ(s,o).then((()=>e.close()))}catch(e){Q.error(e)}}))()}function QT(e){const t=e.session.get("view"),n=e.get("jid"),r=Hp.ROOMSTATUS,i=e.session.get("connection_status");return t===Hp.MUC.VIEWS.CONFIG?mf`<converse-muc-config-form class="muc-form-container" jid="${n}"></converse-muc-config-form>`:mf`${i==r.PASSWORD_REQUIRED?mf`<converse-muc-password-form class="muc-form-container" jid="${n}"></converse-muc-password-form>`:""} ${i==r.ENTERED?mf`<converse-muc-chatarea class="row g-0" jid="${n}"></converse-muc-chatarea>`:""} ${i==r.CONNECTING?BO({class:"vertically-centered"}):""} ${i==r.NICKNAME_REQUIRED?function(e){const t=e.get("jid");return Wu.settings.get("muc_show_logs_before_join")?mf`<converse-muc-chatarea class="row g-0" jid="${t}"></converse-muc-chatarea>`:mf`<converse-muc-nickname-form jid="${t}"></converse-muc-nickname-form>`}(e):""} ${i==r.DISCONNECTED?mf`<converse-muc-disconnected jid="${n}"></converse-muc-disconnected>`:""} ${i==r.BANNED?mf`<converse-muc-disconnected jid="${n}"></converse-muc-disconnected>`:""} ${i==r.DESTROYED?mf`<converse-muc-destroyed jid="${n}"></converse-muc-destroyed>`:""}`}function ZT(){return HT((function*(){const e=[...yield Wu.rooms.get(),...yield Wu.contacts.get()],t=[...new Set(e.map((e=>GT.getDomainFromJid(e.get("jid")))))];return t}))()}function eN(e,t,n,r=[],i=[]){const s=JT[t];if(!s)throw Error(`ChatRoomView#setRole called with invalid command: ${t}`);if(!e.verifyAffiliations(r)||!e.verifyRoles(i))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,n))return!1;const o=e.getNickOrJIDFromCommandArgs(n);if(!o)return!1;const a=n.split(o,2)[1].trim(),c=e.getOccupant(o);return e.setRole(c,s,a,void 0,(t=>e.onCommandError(t))),!0}function tN(e,t,n,r){const i=KT[t];if(!i)throw Error(`verifyAffiliations called with invalid command: ${t}`);if(!e.verifyAffiliations(r))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,n))return!1;const s=e.getNickOrJIDFromCommandArgs(n);if(!s)return!1;let o;const a=n.split(s,2)[1].trim(),c=e.getOccupant(s);if(c)o=c.get("jid");else{if(!WT.isValidJID(s)){const t=aA("Couldn't find a participant with that nickname. They might have left the groupchat.");return void e.createMessage({message:t,type:"error"})}o=s}const l={jid:o,reason:a};c&&Wu.settings.get("auto_register_muc_nickname")&&(l.nick=c.get("nick")),WT.muc.setAffiliation(i,e.get("jid"),[l]).then((()=>e.occupants.fetchMembers())).catch((t=>e.onCommandError(t)))}function nN(e,t){if(!e.verifyRoles(["moderator"]))return;let n=Wu.modal.get("converse-modtools-modal");n?(n.affiliation=t,n.render()):n=Wu.modal.create("converse-modtools-modal",{affiliation:t,jid:e.get("jid")}),n.show()}function rN(e,t){const n=e.model;if(t||n.get("type")!==VT||Wu.settings.get("muc_disable_slash_commands")&&!Array.isArray(Wu.settings.get("muc_disable_slash_commands")))return t;let r=e.text;r=r.replace(/^\s*/,"");const i=(r.match(/^\/([a-zA-Z]*) ?/)||[""]).pop().toLowerCase();if(!i)return!1;const s=r.slice(("/"+i).length+1).trim();var o;const a=null!==(o=n.getAllowedCommands())&&void 0!==o?o:[];if("admin"===i&&a.includes(i))return tN(n,i,s,["owner"]),!0;if("ban"===i&&a.includes(i))return tN(n,i,s,["admin","owner"]),!0;if("modtools"===i&&a.includes(i))return nN(n,s),!0;if("deop"===i&&a.includes(i))return eN(n,i,s,["admin","owner"]),!0;if("destroy"===i&&a.includes(i))return!n.verifyAffiliations(["owner"])||(XT(n).catch((e=>n.onCommandError(e))),!0);if("help"===i&&a.includes(i))return n.set({show_help_messages:!1},{silent:!0}),n.set({show_help_messages:!0}),!0;if("kick"===i&&a.includes(i))return eN(n,i,s,[],["moderator"]),!0;if("mute"===i&&a.includes(i))return eN(n,i,s,[],["moderator"]),!0;if("member"===i&&a.includes(i))return tN(n,i,s,["admin","owner"]),!0;if("nick"===i&&a.includes(i)){if(!n.verifyRoles(["visitor","participant","moderator"]))return!0;if(0===s.length){const e=aA('Your nickname is "%1$s"',n.get("nick"));n.createMessage({message:e,type:"error"})}else n.setNickname(s);return!0}return"owner"===i&&a.includes(i)?(tN(n,i,s,["owner"]),!0):"op"===i&&a.includes(i)?(eN(n,i,s,["admin","owner"]),!0):"register"===i&&a.includes(i)?(s.length>1?n.createMessage({message:aA("Error: invalid number of arguments"),type:"error"}):n.registerNickname().then((e=>{e&&n.createMessage({message:e,type:"error"})})),!0):"revoke"===i&&a.includes(i)?(tN(n,i,s,["admin","owner"]),!0):"topic"===i&&a.includes(i)||"subject"===i&&a.includes(i)?(n.setSubject(s),!0):!("voice"!==i||!a.includes(i))&&(eN(n,i,s,[],["moderator"]),!0)}const iN=e=>{const t=aA("On which entity do you want to run commands?"),n=aA("Certain XMPP services and entities allow privileged users to execute ad-hoc commands on them."),r=aA("Commands found"),i=aA("List available commands"),s=aA("XMPP Address"),o=aA("No commands found");return mf`${e.alert?mf`<div class="alert alert-${e.alert_type}" role="alert">${e.alert}</div>`:""} ${e.note?mf`<p class="form-help">${e.note}</p>`:""}<form class="converse-form" @submit="${e.fetchCommands}"><fieldset><label class="form-label">${t}<p class="form-help">${n}</p><converse-autocomplete .getAutoCompleteList="${ZT}" required placeholder="${s}" name="jid"></converse-autocomplete></label></fieldset><fieldset>${e.fetching?mf`<converse-spinner></converse-spinner>`:mf`<input type="submit" class="btn btn-primary" value="${i}">`}</fieldset>${"list-commands"===e.view?mf`<fieldset><ul class="list-group"><li class="list-group-item active">${e.commands.length?r:o}:</li>${e.commands.map((t=>((e,t)=>mf`<li class="room-item list-group-item"><div class="available-chatroom d-flex flex-row"><a class="open-room available-room w-100" @click="${t=>e.toggleCommandForm(t)}" data-command-node="${t.node}" data-command-jid="${t.jid}" data-command-name="${t.name}" title="${t.name}" href="#">${t.name||t.jid}</a></div>${t.node===e.showform?jT(e,t):""}</li>`)(e,t)))}</ul></fieldset>`:""}</form>`};function sN(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function oN(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){sN(s,r,i,o,a,"next",e)}function a(e){sN(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:aN,sizzle:cN}=Hp.env;function lN(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function uN(e){return(t=function*(){e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-bookmark-name"),r=t.getAttribute("data-room-jid");(yield Wu.confirm(aA('Are you sure you want to remove the bookmark "%1$s"?',n)))&&Ao.state.bookmarks.where({jid:r}).forEach((e=>e.destroy()))},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){lN(s,r,i,o,a,"next",e)}function a(e){lN(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function dN(e){e.preventDefault();const{Strophe:t}=Hp.env,n=e.currentTarget,r=n.textContent,i=n.getAttribute("data-room-jid"),s={name:r||t.unescapeNode(t.getNodeFromJid(i))||i};Wu.rooms.open(i,s,!0)}Wu.elements.define("converse-adhoc-commands",class extends uA{static get properties(){return{alert:{type:String},alert_type:{type:String},commands:{type:Array},fetching:{type:Boolean},showform:{type:String},view:{type:String}}}render(){return iN(this)}fetchCommands(e){return oN((function*(){if(e.preventDefault(),!(e.target instanceof HTMLFormElement))return this.alert_type="danger",void(this.alert="Form could not be submitted");this.fetching=!0,delete this.alert_type,delete this.alert;const t=new FormData(e.target).get("jid").trim();let n;try{n=yield Wu.disco.supports(aN.NS.ADHOC,t)}catch(e){Q.error(e)}finally{this.fetching=!1}if(n)try{this.commands=yield Wu.adhoc.getCommands(t),this.view="list-commands"}catch(e){return Q.error(e),this.alert_type="danger",this.alert=aA("Sorry, an error occurred while looking for commands on that entity."),this.commands=[],void Q.error(e)}else this.commands=[],this.alert_type="danger",this.alert=aA("The specified entity doesn't support ad-hoc commands")})).call(this)}toggleCommandForm(e){return oN((function*(){e.preventDefault();const t=e.target.getAttribute("data-command-node"),n=this.commands.filter((e=>e.node===t))[0],{jid:r}=n;if(this.showform===t)this.showform="",this.requestUpdate();else{try{const e=yield Wu.adhoc.fetchCommandForm(r,t);Object.assign(n,e)}catch(e){null===e?Q.error(`Error: timeout while trying to execute command for ${r}`):(Q.error(`Error while trying to execute command for ${r}`),Q.error(e)),n.alert=aA("An error occurred while trying to fetch the command form"),n.alert_type="danger"}this.showform=t}})).call(this)}executeAction(e){e.preventDefault();const t=e.target,n=t.getAttribute("data-action");["execute","next","prev","complete"].includes(n)?this.runCommand(t.form,n):Q.error(`Unknown action: ${n}`)}clearCommand(e){delete e.alert,delete e.instructions,delete e.sessionid,delete e.alert_type,delete e.status,e.fields=[],e.actions=[],this.showform=""}runCommand(e,t){return oN((function*(){const n=new FormData(e),r=n.get("command_jid").trim(),i=n.get("command_node").trim(),s=this.commands.filter((e=>e.node===i))[0];delete s.alert,this.requestUpdate();const o="prev"===t?[]:cN(":input:not([type=button]):not([type=submit])",e).filter((e=>!["command_jid","command_node"].includes(e.getAttribute("name")))).map(tj).filter((e=>e)),a=yield Wu.adhoc.runCommand(r,s.sessionid,s.node,t,o),{fields:c,status:l,note:u,instructions:d,actions:h}=a;if("error"===l)return s.status=l,s.alert_type="danger",s.alert=aA("Sorry, an error occurred while trying to execute the command. See the developer console for details"),this.requestUpdate();"executing"===l?(Object.assign(s,{fields:c,instructions:d,actions:h,status:l}),s.alert=aA("Executing"),s.alert_type="primary"):"completed"===l?(this.alert_type="primary",this.alert=aA("Completed"),this.note=u,this.clearCommand(s)):(Q.error(`Unexpected status for ad-hoc command: ${l}`),s.alert=aA("Completed"),s.alert_type="primary"),this.requestUpdate()})).call(this)}cancel(e){return oN((function*(){e.preventDefault(),this.showform="",this.requestUpdate();const t=new FormData(e.target.form),n=t.get("command_jid").trim(),r=t.get("command_node").trim(),i=this.commands.filter((e=>e.node===r))[0];delete i.alert,this.requestUpdate();const{status:s}=yield Wu.adhoc.runCommand(n,i.sessionid,i.node,"cancel",[]);"error"===s?(i.alert_type="danger",i.alert=aA("An error occurred while trying to cancel the command. See the developer console for details")):"canceled"===s?(this.alert_type="",this.alert="",this.clearCommand(i)):(Q.error(`Unexpected status for ad-hoc command: ${s}`),i.alert=aA("Error: unexpected result"),i.alert_type="danger"),this.requestUpdate()})).call(this)}constructor(){super(),this.view="choose-service",this.fetching=!1,this.showform="",this.commands=[]}}),Hp.plugins.add("converse-adhoc-views",{dependencies:["converse-controlbox","converse-muc"],initialize(){Wu.settings.extend({allow_adhoc_commands:!0})}});const hN=e=>{const t=e.get("jid"),n=aA("Unbookmark this groupchat"),r=aA("Click to open this groupchat");return mf`<div class="list-item room-item available-chatroom d-flex flex-row" data-room-jid="${t}"><a class="list-item-link open-room w-100" data-room-jid="${t}" title="${r}" @click="${dN}">${e.getDisplayName()}</a> <a class="list-item-action remove-bookmark align-self-center ${e.get("bookmarked")?"button-on":""}" tabindex="0" data-room-jid="${t}" data-bookmark-name="${e.getDisplayName()}" title="${n}" @click="${uN}"><converse-icon class="fa fa-times" size="1em"></converse-icon></a></div>`};var fN=n(1205),pN={};pN.styleTagTransform=D(),pN.setAttributes=N(),pN.insert=k().bind(null,"head"),pN.domAPI=O(),pN.insertStyleElement=I();$()(fN.A,pN);fN.A&&fN.A.locals&&fN.A.locals;function mN(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{initStorage:gN}=Up;class vN extends uA{initialize(){return(e=function*(){yield Wu.waitUntil("bookmarksInitialized");const{bookmarks:e,chatboxes:t}=Ao.state;this.liveFilter=Lo((e=>this.model.set({text:e.target.value})),100),this.listenTo(e,"add",(()=>this.requestUpdate())),this.listenTo(e,"remove",(()=>this.requestUpdate())),this.listenTo(t,"add",(()=>this.requestUpdate())),this.listenTo(t,"remove",(()=>this.requestUpdate()));const n=`converse.bookmarks-list-model-${Ao.session.get("bare_jid")}`;this.model=new ae.Model({id:n}),gN(this.model,n),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.model.fetch({success:()=>this.requestUpdate(),error:()=>this.requestUpdate()})},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){mN(s,r,i,o,a,"next",e)}function a(e){mN(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){return Ao.state.bookmarks&&this.model?(e=>{const t=aA("Filter"),n=e.model.get("text"),{bookmarks:r}=Ao.state,i=n?r.filter((e=>((e,t)=>{var n,r;return(null===(n=e.get("name"))||void 0===n?void 0:n.includes(t))||(null===(r=e.get("jid"))||void 0===r?void 0:r.includes(t))})(e,n))):r;return mf`<form class="converse-form bookmarks-filter"><div class="btn-group w-100"><input .value="${null!=n?n:""}" @keydown="${t=>e.liveFilter(t)}" class="form-control" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${n?"":"hidden"}" @click="${e.clearFilter}"></converse-icon></div></form><div class="list-container list-container--bookmarks"><div class="items-list bookmarks rooms-list">${i.map((e=>hN(e)))}</div></div>`})(this):BO()}clearFilter(e){var t;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),this.model.set("text","")}}Wu.elements.define("converse-bookmarks",vN);Wu.elements.define("converse-bookmark-list-modal",class extends ak{renderModal(){return mf`<converse-bookmarks></converse-bookmarks>`}getModalTitle(){return aA("Bookmarks")}});class yN extends uA{static get properties(){return{jid:{type:String}}}willUpdate(e){const{chatboxes:t,bookmarks:n}=Ao.state;e.has("jid")&&(this.model=t.get(this.jid),this.bookmark=n.get(this.jid))}render(){return(e=>{var t,n;const r=e.model.getDisplayName();var i;const s=null!==(i=null===(t=e.bookmark)||void 0===t?void 0:t.get("nick"))&&void 0!==i?i:e.model.get("nick"),o=aA('Bookmark for "%1$s"',r),a=aA("Would you like this groupchat to be automatically joined upon startup?"),c=aA("Remove"),l=aA("Name"),u=aA("What should your nickname for this groupchat be?"),d=aA("Password (for a protected groupchat)"),h=aA("If the groupchat requires a password to enter, you can save it here. Note this is not intended to be a secure storage."),f=e.bookmark?aA("Update"):aA("Save");return mf`<form class="converse-form chatroom-form" @submit="${t=>e.onBookmarkFormSubmitted(t)}"><legend>${o}</legend><fieldset><label class="form-label" for="converse_muc_bookmark_name">${l}</label> <input class="form-control" type="text" value="${r}" name="name" required="required" id="converse_muc_bookmark_name"></fieldset><fieldset><label class="form-label" for="converse_muc_bookmark_nick">${u}</label> <input class="form-control" type="text" name="nick" value="${s||""}" id="converse_muc_bookmark_nick"></fieldset><fieldset><label for="muc-password" class="form-label">${d}</label><p class="form-help">${h}</p><input type="password" name="password" class="form-control" id="muc-password"></fieldset><fieldset class="form-group form-check"><input class="form-check-input" id="converse_muc_bookmark_autojoin" type="checkbox" ?checked="${null===(n=e.bookmark)||void 0===n?void 0:n.get("autojoin")}" name="autojoin"> <label class="form-check-label" for="converse_muc_bookmark_autojoin">${a}</label></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${f}"> ${e.bookmark?mf`<input class="btn btn-secondary button-remove" type="button" value="${c}" @click="${t=>e.removeBookmark(t)}">`:""}</fieldset></form>`})(this)}onBookmarkFormSubmitted(e){var t,n,r,i;e.preventDefault();const{bookmarks:s}=Ao.state,o=e.target;s.setBookmark({jid:this.jid,autojoin:(null===(t=o.querySelector('input[name="autojoin"]'))||void 0===t?void 0:t.checked)||!1,name:null===(n=o.querySelector("input[name=name]"))||void 0===n?void 0:n.value,nick:null===(r=o.querySelector("input[name=nick]"))||void 0===r?void 0:r.value,password:null===(i=o.querySelector("input[name=password]"))||void 0===i?void 0:i.value}),this.closeBookmarkForm(e)}removeBookmark(e){var t;null===(t=this.bookmark)||void 0===t||t.destroy(),this.closeBookmarkForm(e)}closeBookmarkForm(e){e.preventDefault(),this.dispatchEvent(new Event("hide.bs.modal",{bubbles:!0,cancelable:!0}))}constructor(){super(),this.jid=null}}Wu.elements.define("converse-muc-bookmark-form",yN);const bN=yN;Wu.elements.define("converse-bookmark-form-modal",class extends ak{renderModal(){return mf`<converse-muc-bookmark-form class="muc-form-container" jid="${this.jid}"></converse-muc-bookmark-form>`}getModalTitle(){return aA("Bookmark")}constructor(e){super(e),this.jid=null}});const{u:_N}=Hp.env,wN={setBookmarkState(){const{bookmarks:e}=Ao.state;if(e){e.where({jid:this.model.get("jid")}).length?this.model.save("bookmarked",!0):this.model.save("bookmarked",!1)}},renderBookmarkForm(){if(!this.bookmark_form){this.bookmark_form=new Ao.state.MUCBookmarkForm({model:this.model,chatroomview:this});this.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.bookmark_form.el)}_N.showElement(this.bookmark_form.el)},showBookmarkModal(e){null==e||e.preventDefault();const t=this.model.get("jid");Wu.modal.show("converse-bookmark-form-modal",{jid:t},e)}};Hp.plugins.add("converse-bookmark-views",{dependencies:["converse-chatboxes","converse-muc","converse-muc-views"],initialize(){Wu.settings.extend({hide_open_bookmarks:!0});const e={removeBookmarkViaEvent:uN,MUCBookmarkForm:bN,BookmarksView:vN};Object.assign(Ao,e),Object.assign(Ao.exports,e),Object.assign(Ao.exports.ChatRoomView.prototype,wN),Wu.listen.on("chatRoomViewInitialized",(e=>e.setBookmarkState()))}});const SN=(e,t,n)=>{const r=new Map;for(let i=t;i<=n;i++)r.set(e[i],i);return r},xN=yA(class extends bA{dt(e,t,n){let r;void 0===n?n=t:void 0!==t&&(r=t);const i=[],s=[];let o=0;for(const t of e)i[o]=r?r(t,o):o,s[o]=n(t,o),o++;return{values:s,keys:i}}render(e,t,n){return this.dt(e,t,n).values}update(e,[t,n,r]){const i=(e=>e._$AH)(e),{values:s,keys:o}=this.dt(t,n,r);if(!Array.isArray(i))return this.ut=o,s;var a;const c=null!==(a=this.ut)&&void 0!==a?a:this.ut=[],l=[];let u,d,h=0,f=i.length-1,p=0,m=s.length-1;for(;h<=f&&p<=m;)if(null===i[h])h++;else if(null===i[f])f--;else if(c[h]===o[p])l[p]=pA(i[h],s[p]),h++,p++;else if(c[f]===o[m])l[m]=pA(i[f],s[m]),f--,m--;else if(c[h]===o[m])l[m]=pA(i[h],s[m]),fA(e,l[m+1],i[h]),h++,m--;else if(c[f]===o[p])l[p]=pA(i[f],s[p]),fA(e,i[h],i[f]),f--,p++;else if(void 0===u&&(u=SN(o,p,m),d=SN(c,h,f)),u.has(c[h]))if(u.has(c[f])){const t=d.get(o[p]),n=void 0!==t?i[t]:null;if(null===n){const t=fA(e,i[h]);pA(t,s[p]),l[p]=t}else l[p]=pA(n,s[p]),fA(e,i[h],n),i[t]=null;p++}else gA(i[f]),f--;else gA(i[h]),h++;for(;p<=m;){const t=fA(e,l[m+1]);pA(t,s[p]),l[p++]=t}for(;h<=f;){const e=i[h++];null!==e&&gA(e)}return this.ut=o,((e,t=mA)=>{e._$AH=t})(e,l),vf}constructor(e){if(super(e),e.type!==vA)throw Error("repeat() can only be used in text expressions")}});function AN(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function jN(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){AN(s,r,i,o,a,"next",e)}function a(e){AN(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{dayjs:$N,u:EN}=Hp.env,{convertASCII2Emoji:ON,getShortnameReferences:CN,getCodePointReferences:kN}=EN;function TN(){return window.innerWidth<=QO}function NN(e){if(TN())return"";const{height:t,width:n}=e.toJSON();return"overlayed"===Wu.settings.get("view_mode")?`${n?`width: ${n}px;`:""}${t?`height: ${t}px;`:""}`:""}function MN(e){const t=e.get("num_unread")||0;return t<100?t:"99+"}function IN(e){return jN((function*(){return(yield e).filter((e=>e.standalone)).map((e=>{return t=e,jN((function*(){const e=yield t;return mf`<button type="button" class="btn chatbox-btn ${e.a_class}" @click="${e.handler}" title="${e.i18n_title}"><converse-icon size="1em" class="fa ${e.icon_class}"></converse-icon></button>`}))();var t})).reverse().map((e=>NA(e,"")))}))()}function PN(e){return jN((function*(){const t=(yield e).filter((e=>!e.standalone)).map((e=>{return t=e,jN((function*(){const e=yield t;return e?mf`<a href="#" role="button" class="dropdown-item ${e.a_class}" @click="${e.handler}" title="${e.i18n_title}"><converse-icon size="1em" class="fa ${e.icon_class}"></converse-icon>${e.i18n_text}</a>`:""}))();var t}));return t.length?mf`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${t}"></converse-dropdown>`:""}))()}function DN(e){if(!e.isHidden()&&Wu.settings.get("allow_url_history_change")){const t=window.location.hash;t&&e.messages.get(t.slice(1))&&history.pushState(null,"",window.location.pathname)}}function RN(e){var t;const n=null===(t=e.collection)||void 0===t?void 0:t.models;if(!n)return;const r=n.indexOf(e),i=n[r-1];if(!i||$N(e.get("time")).isAfter($N(i.get("time")),"day")){const t=$N(e.get("time")).startOf("day");return(e=>mf`<div class="message date-separator" data-isodate="${e.time}"><hr class="separator"><time class="separator-text" datetime="${e.time}"><span>${e.datestring}</span></time></div>`)({type:"date",time:t.toISOString(),datestring:t.format("dddd MMM Do YYYY")})}}function zN(){return Hp.emojis.toned||(Hp.emojis.toned=EN.unique(Object.values(Hp.emojis.json.people).filter((e=>e.sn.includes("_tone"))).map((e=>e.sn.replace(/_tone[1-5]/,""))))),Hp.emojis.toned}function LN(e,t={unicode_only:!1,add_title_wrapper:!1}){const n=e.emoji,r=e.shortname;if(n){if(t.unicode_only)return n;if(Wu.settings.get("use_system_emojis"))return t.add_title_wrapper&&r?mf`<span title="${r}">${n}</span>`:n;{const t=Wu.settings.get("emoji_image_path");return mf`<img class="emoji" loading="lazy" draggable="false" title="${r}" alt="${n}" src="${t}/72x72/${e.cp}.png">`}}if(t.unicode_only)return r;{const{url:e}=Hp.emojis.by_sn[r];return mf`<img class="emoji" loading="lazy" draggable="false" title="${r}" alt="${r}" src="${e.startsWith(".")?`${Wu.settings.get("assets_path")}/${e}`:e}">`}}Object.assign(EN,{shortnamesToEmojis:function(e,t={unicode_only:!1,add_title_wrapper:!1}){return function(e,t){let n=[e];return[...CN(e),...kN(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const r=n.shift(),i=LN(e,t);n="string"==typeof i?[r.slice(0,e.begin)+i+r.slice(e.end),...n]:[r.slice(0,e.begin),i,r.slice(e.end),...n]})),n}(e=ON(e),t)}});const{CONTROLBOX_TYPE:UN,CHATROOMS_TYPE:BN,HEADLINES_TYPE:FN,CONNECTION_STATUS:qN}=Xx;function HN(e){const t="overlayed"===Wu.settings.get("view_mode")&&e.get("hidden");return e.get("type")===UN||!e.get("hidden")&&!e.get("closed")&&!t}Wu.elements.define("converse-chats",class extends uA{initialize(){this.model=Ao.state.chatboxes,this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>this.requestUpdate())),this.listenTo(this.model,"change:jid",(()=>this.requestUpdate())),this.listenTo(this.model,"destroy",(()=>this.requestUpdate())),this.listenTo(Ao,"connected",(()=>this.requestUpdate())),this.listenTo(Ao,"reconnected",(()=>this.requestUpdate())),this.listenTo(Ao,"disconnected",(()=>this.requestUpdate()));const e=Wu.settings.get();this.listenTo(e,"change:view_mode",(()=>this.requestUpdate())),this.listenTo(e,"change:singleton",(()=>this.requestUpdate()));document.querySelector("body").classList.add(`converse-${Wu.settings.get("view_mode")}`),Wu.trigger("chatBoxViewsInitialized")}render(){return(()=>{const{chatboxes:e,connfeedback:t}=Ao.state,n="overlayed"===Wu.settings.get("view_mode"),r=TN(),i=Wu.connection.get(),s=!(null==i?void 0:i.connected)||!(null==i?void 0:i.authenticated)||(null==i?void 0:i.disconnecting),o=t.get("connection_status"),a=["CONNECTED","CONNECTING","AUTHENTICATING","RECONNECTING"].includes(qN[o]);return mf`${!s&&n?mf`<converse-minimized-chats class="col-auto"></converse-minimized-chats>`:""} ${xN(e.filter(HN),(e=>e.get("jid")),(e=>{const t=e.get("width"),i=!r&&n&&t?`width: ${t}px`:yf;return e.get("type")===UN?n&&e.get("closed")?mf`<converse-controlbox-toggle class="col-auto"></converse-controlbox-toggle>`:mf`<converse-controlbox id="controlbox" class="col-auto chatbox ${s&&!a?"logged-out":""}" style="${i}"></converse-controlbox>`:e.get("type")===BN?mf`<converse-muc jid="${e.get("jid")}" class="col-auto chatbox chatroom" style="${i}"></converse-muc>`:e.get("type")===FN?mf`<converse-headlines jid="${e.get("jid")}" class="col-auto chatbox headlines" style="${i}"></converse-headlines>`:mf`<converse-chat jid="${e.get("jid")}" class="col-auto chatbox" style="${i}"></converse-chat>`}))}`})()}});const GN=class{add(e,t){this.views[e]=t}get(e){return this.views[e]}xget(e){return this.keys().filter((t=>t!==e)).reduce(((e,t)=>(e[t]=this.views[t],e)),{})}getAll(){return Object.values(this.views)}keys(){return Object.keys(this.views)}remove(e){delete this.views[e]}map(e){return Object.values(this.views).map(e)}forEach(e){return Object.values(this.views).forEach(e)}filter(e){return Object.values(this.views).filter(e)}closeAllChatBoxes(){return Promise.all(Object.values(this.views).map((e=>e.close({name:"closeAllChatBoxes"}))))}constructor(){this.views={},this.el=null}};function WN(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}var VN=n(3403),KN={};KN.styleTagTransform=D(),KN.setAttributes=N(),KN.insert=k().bind(null,"head"),KN.domAPI=O(),KN.insertStyleElement=I();$()(VN.A,KN);VN.A&&VN.A.locals&&VN.A.locals;Hp.plugins.add("converse-chatboxviews",{dependencies:["converse-chatboxes","converse-vcard"],initialize(){Wu.promises.add(["chatBoxViewsInitialized"]),Wu.settings.extend({animate:!0});const e=new GN;Object.assign(Ao,{chatboxviews:e}),Object.assign(Ao.state,{chatboxviews:e}),Wu.listen.on("chatBoxesInitialized",(()=>{Ao.state.chatboxes.on("destroy",(t=>e.remove(t.get("jid"))))})),Wu.listen.on("cleanup",(()=>Object.assign(Ao,{chatboxviews:null}))),Wu.listen.on("cleanup",(()=>delete Ao.state.chatboxviews)),Wu.listen.on("clearSession",(()=>e.closeAllChatBoxes())),Wu.listen.on("chatBoxViewsInitialized",WN),window.addEventListener("resize",WN),Object.assign(Hp,{insertInto(t){const n=e.el;if(n&&!t.contains(n))t.insertAdjacentElement("afterbegin",n);else if(!n)throw new Error("Cannot insert non-existing #conversejs element into the DOM")}})}});var JN=n(7187),YN={};YN.styleTagTransform=D(),YN.setAttributes=N(),YN.insert=k().bind(null,"head"),YN.domAPI=O(),YN.insertStyleElement=I();$()(JN.A,YN);JN.A&&JN.A.locals&&JN.A.locals;function XN(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function QN(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){XN(s,r,i,o,a,"next",e)}function a(e){XN(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{getMediaURLs:ZN}=Up,{CHATROOMS_TYPE:eM}=Xx;class tM extends uA{static get properties(){return{is_retracted:{type:Boolean},model:{type:Object}}}initialize(){const e=Wu.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.chatbox.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.chatbox.occupants,"add",this.updateIfOwnOccupant),this.listenTo(this.model.chatbox.occupants,"change:role",this.updateIfOwnOccupant),this.listenTo(this.model.chatbox.session,"change:connection_status",(()=>this.requestUpdate()))}updateIfOwnOccupant(e){const t=Ao.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}render(){return mf`${NA(this.renderActions(),"")}`}renderActions(){return QN((function*(){if(!this.model.collection)return"";const e=(yield this.getActionButtons()).map((e=>tM.getActionsDropdownItem(e)));return e.length?mf`<converse-dropdown class="chat-msg__actions btn-group dropstart" .items="${e}"></converse-dropdown>`:""})).call(this)}static getActionsDropdownItem(e){return mf`<button type="button" class="dropdown-item chat-msg__action ${e.button_class}" @click="${e.handler}"><converse-icon class="${e.icon_class}" color="var(--foreground-color)" size="1em"></converse-icon> ${e.i18n_text}</button>`}onMessageEditButtonClicked(e){return QN((function*(){var t,n;e.preventDefault();const r=this.model.collection.findWhere("correcting"),i=null===(n=Up.ancestor(this,".chatbox"))||void 0===n||null===(t=n.querySelector(".chat-textarea"))||void 0===t?void 0:t.value;if(i&&(!r||r.getMessageText()!==i)){if(!(yield Wu.confirm(aA("Confirm"),aA("You have an unsent message which will be lost if you continue. Are you sure?"))))return}r!==this.model?(null==r||r.save("correcting",!1),this.model.save("correcting",!0)):this.model.save("correcting",!1)})).call(this)}onDirectMessageRetractButtonClicked(){return QN((function*(){if("me"!==this.model.get("sender"))return Q.error("onMessageRetractButtonClicked called for someone else's message!");const e=aA("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere."),t=[aA("Are you sure you want to retract this message?")];Wu.settings.get("show_retraction_warning")&&(t[1]=e);if(yield Wu.confirm(aA("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}})).call(this)}retractOtherMessage(e){return QN((function*(){const t=this.model.collection.chatbox,n=yield t.retractOtherMessage(this.model,e);if(null===n){const e=aA("A timeout occurred while trying to retract the message");Wu.alert("error",aA("Error"),e),Q.warn(e)}else if(Up.isErrorStanza(n)){const e=aA("Sorry, you're not allowed to retract this message.");Wu.alert("error",aA("Error"),e),Q.warn(e),Q.error(n)}})).call(this)}onMUCMessageRetractButtonClicked(){return QN((function*(){const e=aA("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere.");if(this.model.mayBeRetracted()){const t=[aA("Are you sure you want to retract this message?")];if(Wu.settings.get("show_retraction_warning")&&(t[1]=e),yield Wu.confirm(aA("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}}else if(yield this.model.mayBeModerated())if("me"===this.model.get("sender")){let t=[aA("Are you sure you want to retract this message?")];Wu.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]),(yield Wu.confirm(aA("Confirm"),t))&&this.retractOtherMessage()}else{let t=[aA("You are about to retract this message."),aA("You may optionally include a message, explaining the reason for the retraction.")];Wu.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]);const n=yield Wu.prompt(aA("Message Retraction"),t,aA("Optional reason"));!1!==n&&this.retractOtherMessage(n)}else{const e=aA("Sorry, you're not allowed to retract this message");Wu.alert("error",aA("Error"),e)}})).call(this)}onMessageRetractButtonClicked(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);this.model.collection.chatbox.get("type")===eM?this.onMUCMessageRetractButtonClicked():this.onDirectMessageRetractButtonClicked()}onMediaToggleClicked(e){var t;if(null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.hasHiddenMedia(this.getMediaURLs()))this.model.save({hide_url_previews:!1,url_preview_transition:"fade-in"});else{(this.model.get("ogp_metadata")||[]).length?this.model.set("url_preview_transition","fade-out"):this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}}hasHiddenMedia(e){if("boolean"==typeof this.model.get("hide_url_previews"))return this.model.get("hide_url_previews");const t=Wu.settings.get("render_media");return Array.isArray(t)?e.reduce(((e,n)=>e||!cC(t,n)),!1):!t}getMediaURLs(){const e=(this.model.get("ogp_metadata")||[]).map((e=>({url:e["og:image"],is_image:!0}))).filter((e=>uC(e))),t=ZN(this.model.get("media_urls")||[],this.model.get("body")).filter((e=>uC(e)));return[...new Set([...t.map((e=>e.url)),...e.map((e=>e.url))])]}addMediaRenderingToggle(e){const t=this.getMediaURLs();if(t.length){const n=this.hasHiddenMedia(t);e.push({i18n_text:aA(n?"Show media":"Hide media"),handler:e=>this.onMediaToggleClicked(e),button_class:"chat-msg__action-hide-previews",icon_class:n?"fas fa-eye":"fas fa-eye-slash",name:"hide"})}}onMessageCopyButtonClicked(e){return QN((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),yield navigator.clipboard.writeText(this.model.getMessageText())})).call(this)}onMessageQuoteButtonClicked(e){var t,n,r;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const i=this.model.collection.chatbox,s=null===(r=Up.ancestor(this,".chatbox"))||void 0===r||null===(n=r.querySelector(".chat-textarea"))||void 0===n?void 0:n.selectionEnd,o=this.model.getMessageText().replaceAll(/^/gm,"> ");var a;let c=null!==(a=i.get("draft"))&&void 0!==a?a:"";s?c=`${c.slice(0,s)}\n${o}\n${c.slice(s)}`:c+=o,i.save({draft:c})}getActionButtons(){return QN((function*(){const e=[];this.model.get("editable")&&e.push({i18n_text:this.model.get("correcting")?aA("Cancel Editing"):aA("Edit"),handler:e=>this.onMessageEditButtonClicked(e),button_class:"chat-msg__action-edit",icon_class:"fa fa-pencil-alt",name:"edit"});const t=["groupchat","mep"].includes(this.model.get("type"))&&(yield this.model.mayBeModerated());return!this.is_retracted&&(this.model.mayBeRetracted()||t)&&e.push({i18n_text:aA("Retract"),handler:e=>this.onMessageRetractButtonClicked(e),button_class:"chat-msg__action-retract",icon_class:"fas fa-trash-alt",name:"retract"}),this.model.collection?(this.addMediaRenderingToggle(e),e.push({i18n_text:aA("Copy"),handler:e=>this.onMessageCopyButtonClicked(e),button_class:"chat-msg__action-copy",icon_class:"fas fa-copy",name:"copy"}),this.model.collection.chatbox.canPostMessages()&&e.push({i18n_text:aA("Quote"),handler:e=>this.onMessageQuoteButtonClicked(e),button_class:"chat-msg__action-quote",icon_class:"fas fa-quote-right",name:"quote"}),Wu.hook("getMessageActionButtons",this,e)):[]})).call(this)}constructor(){super(),this.model=null,this.is_retracted=null}}Wu.elements.define("converse-message-actions",tM);var nM=n(719),rM={};rM.styleTagTransform=D(),rM.setAttributes=N(),rM.insert=k().bind(null,"head"),rM.domAPI=O(),rM.insertStyleElement=I();$()(nM.A,rM);nM.A&&nM.A.locals&&nM.A.locals;Wu.elements.define("converse-image-modal",class extends ak{renderModal(){return(e=>mf`<img class="chat-image chat-image--modal" src="${e.src}">`)({src:this.src})}getModalTitle(){return mf`${aA("Image: ")}<a target="_blank" rel="noopener" href="${this.src}">${nj(this.src)}</a>`}constructor(e){super(e),this.src=e.src}});var iM=n(8555),sM={};sM.styleTagTransform=D(),sM.setAttributes=N(),sM.insert=k().bind(null,"head"),sM.domAPI=O(),sM.insertStyleElement=I();$()(iM.A,sM);iM.A&&iM.A.locals&&iM.A.locals;const oM=(e,t,n)=>{const{hostname:r}=Up.getURL(e);return mf`<figure class="audio-element">${n||!t?mf`<figcaption>${n?mf`${n}<br>`:""} ${t?"":mf`<a target="_blank" rel="noopener" title="${e}" href="${e}">${r}</a>`}</figcaption>`:""}<audio controls src="${e}"></audio></figure>`};var aM=n(5434);function cM(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}class lM{initialize(){return(e=function*(){this.options.width&&this.options.height&&this.setSizes(this.options.width,this.options.height);const e=yield this.fetchGIF(this.gif_el.src);requestAnimationFrame((()=>this.handleGIFResponse(e)))},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){cM(s,r,i,o,a,"next",e)}function a(e){cM(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}initPlayer(){if(!this.load_error&&(this.options.width&&this.options.height||this.ctx.scale(this.getCanvasScale(),this.getCanvasScale()),this.frame_idx=0,this.renderImage(),this.options.autoplay)){var e,t;const n=null!==(t=null===(e=this.frames[this.frame_idx])||void 0===e?void 0:e.delay)&&void 0!==t?t:0;setTimeout((()=>this.play()),n)}}getNextFrameNo(){return 0===this.frames.length?0:(this.frame_idx+1+this.frames.length)%this.frames.length}onIterationEnd(){var e,t;return this.iteration_count++,null===(e=(t=this.options).onIterationEnd)||void 0===e||e.call(t,this.el),!this.options.loop&&(this.pause(),!0)}onAnimationFrame(e,t,n){var r;if(!this.playing)return;if(e-t<n)return this.hovering?this.drawPauseIcon():this.renderImage(),void requestAnimationFrame((e=>this.onAnimationFrame(e,t,n)));const i=this.getNextFrameNo();if(0===i&&this.onIterationEnd())return;this.frame_idx=i,this.renderImage();const s=(null===(r=this.frames[this.frame_idx])||void 0===r?void 0:r.delay)||8;requestAnimationFrame((t=>this.onAnimationFrame(t,e,s)))}setSizes(e,t){this.canvas.width=e*this.getCanvasScale(),this.canvas.height=t*this.getCanvasScale(),this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,this.offscreenCanvas.style.width=e+"px",this.offscreenCanvas.style.height=t+"px",this.offscreenCanvas.getContext("2d").setTransform(1,0,0,1,0,0)}doShowProgress(e,t,n){if(n&&this.options.show_progress_bar){let n=this.options.progress_bar_height;const r=(this.canvas.height-n)/(this.ctx_scaled?this.getCanvasScale():1),i=e/t*this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1),s=this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1);n/=this.ctx_scaled?this.getCanvasScale():1,this.ctx.fillStyle=this.options.progress_bg_color,this.ctx.fillRect(i,r,s-i,n),this.ctx.fillStyle=this.options.progress_color,this.ctx.fillRect(0,r,i,n)}}handleGIFResponse(e){try{const r=(0,aM.O5)(e);var t,n;this.hdr=r.header,this.lsd=r.lsd,this.setSizes(null!==(t=this.options.width)&&void 0!==t?t:this.lsd.width,null!==(n=this.options.height)&&void 0!==n?n:this.lsd.height),this.frames=(0,aM.Ud)(r,!0)}catch(e){this.showError()}this.initPlayer(),!this.options.autoplay&&this.drawPlayIcon()}drawError(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.options.width,this.options.height),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(this.options.width,this.options.height),this.ctx.moveTo(0,this.options.height),this.ctx.lineTo(this.options.width,0),this.ctx.stroke()}showError(){this.load_error=!0,this.hdr={width:this.gif_el.width,height:this.gif_el.height},this.frames=[],this.drawError(),this.el.requestUpdate()}manageDisposal(e){if(e<=0)return;const t=this.offscreenCanvas.getContext("2d"),n=this.frames[e-1].disposalType;e>1&&(3===n?null!=this.disposal_restore_from_idx&&t.putImageData(this.frames[this.disposal_restore_from_idx].data,0,0):this.disposal_restore_from_idx=e-1),2===n&&t.clearRect(this.last_frame.dims.left,this.last_frame.dims.top,this.last_frame.dims.width,this.last_frame.dims.height)}renderImage(e=!0){if(!this.frames.length)return;let t=this.frame_idx;t=parseInt(t.toString(),10),(t>this.frames.length-1||t<0)&&(t=0),this.manageDisposal(t);const n=this.frames[t],r=this.patchCanvas.getContext("2d"),i=this.offscreenCanvas.getContext("2d"),s=n.dims;this.frameImageData&&s.width==this.frameImageData.width&&s.height==this.frameImageData.height||(this.patchCanvas.width=s.width,this.patchCanvas.height=s.height,this.frameImageData=r.createImageData(s.width,s.height)),this.frameImageData.data.set(n.patch),r.putImageData(this.frameImageData,0,0),i.drawImage(this.patchCanvas,s.left,s.top);const o=i.getImageData(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height);this.ctx.putImageData(o,0,0),this.ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height),e&&this.hovering&&this.drawPauseIcon(),this.last_frame=n}play(){this.playing=!0,requestAnimationFrame((e=>this.onAnimationFrame(e,0,0)))}pause(){this.playing=!1,requestAnimationFrame((()=>this.drawPlayIcon()))}drawPauseIcon(){if(!this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height;this.ctx.lineWidth=.04*this.canvas.height,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2-e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2+e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2+e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,1.5*e,0,2*Math.PI),this.ctx.stroke()}drawPlayIcon(){if(this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height,t=new Path2D;t.moveTo(this.canvas.width/2+e,this.canvas.height/2),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2-e),t.closePath(),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.fill(t);const n=1.5*e;this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,n,0,2*Math.PI),this.ctx.stroke()}getCanvasScale(){let e;return e=this.options.max_width&&this.hdr&&this.lsd.width>this.options.max_width?this.options.max_width/this.lsd.width:1,e}fetchGIF(e){const t=ue(),n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",null==n||n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=()=>{if(200!=n.status)return this.showError(),t.reject();t.resolve(n.response)},n.onprogress=e=>e.lengthComputable&&this.doShowProgress(e.loaded,e.total,!0),n.onerror=e=>{Q.error(e),this.showError()},n.send(),t}constructor(e,t){this.options=Object.assign({width:null,height:null,autoplay:!0,loop:!0,show_progress_bar:!0,progress_bg_color:"rgba(0,0,0,0.4)",progress_color:"rgba(255,0,22,.8)",progress_bar_height:5},t),this.el=e,this.gif_el=e.querySelector("img"),this.canvas=e.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.offscreenCanvas=document.createElement("canvas"),this.patchCanvas=document.createElement("canvas"),this.ctx_scaled=!1,this.frames=[],this.load_error=null,this.playing=this.options.autoplay,this.frame_idx=0,this.iteration_count=0,this.start=null,this.hovering=null,this.frameImageData=null,this.disposal_restore_from_idx=null,this.initialize()}}var uM=n(8609),dM={};dM.styleTagTransform=D(),dM.setAttributes=N(),dM.insert=k().bind(null,"head"),dM.domAPI=O(),dM.insertStyleElement=I();$()(uM.A,dM);uM.A&&uM.A.locals&&uM.A.locals;Wu.elements.define("converse-gif",class extends uA{static get properties(){return{autoplay:{type:Boolean},noloop:{type:Boolean},progress_color:{type:String},fallback:{type:String},src:{type:String}}}initGIF(){const e={autoplay:this.autoplay,loop:!this.noloop};this.progress_color&&(e.progress_color=this.progress_color),this.supergif=new lM(this,e)}updated(e){this.supergif&&!e.has("src")?(e.has("autoplay")&&(this.supergif.options.autoplay=this.autoplay),e.has("noloop")&&(this.supergif.options.loop=!this.noloop),e.has("progress_color")&&(this.supergif.options.progress_color=this.progress_color)):this.initGIF()}render(){var e;return(null===(e=this.supergif)||void 0===e?void 0:e.load_error)&&["url","empty"].includes(this.fallback)?this.renderErrorFallback():mf`<canvas class="gif-canvas" @mouseover="${()=>this.setHover()}" @mouseleave="${()=>this.unsetHover()}" @click="${e=>this.onControlsClicked(e)}"><img class="gif" src="${this.src}"></canvas>`}renderErrorFallback(){return"url"===this.fallback?lj(this.src):"empty"===this.fallback?"":void 0}setHover(){this.supergif&&(this.supergif.hovering=!0,this.hover_timeout&&clearTimeout(this.hover_timeout),this.hover_timeout=setTimeout((()=>this.unsetHover()),2e3))}unsetHover(){this.supergif&&(this.supergif.hovering=!1)}onControlsClicked(e){e.preventDefault(),this.supergif.playing?this.supergif.pause():this.supergif.frames.length>0&&(this.supergif.options.loop=!0,this.supergif.play())}constructor(){super(),this.src=null,this.autoplay=!1,this.noloop=!1,this.fallback="url",this.progress_color=null}});const hM=(e,t)=>mf`<converse-gif autoplay noloop fallback="empty" src="${e}"></converse-gif>${t?"":mf`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,{isURLWithImageExtension:fM}=Up;const pM=yA(class extends $A{render(e,t,n,r){return t?mf`<a href="${t}" class="chat-image__link" target="_blank" rel="noopener">${this.renderImage(e,t,n,r)}</a>`:this.renderImage(e,t,n,r)}renderImage(e,t,n,r){return mf`<img class="chat-image img-thumbnail" loading="lazy" src="${e}" @click="${r}" @error="${()=>this.onError(e,t,n,r)}" @load="${n}">`}onError(e,t,n,r){if(fM(e))t&&this.setValue(lj(t));else try{const i=new URL(e),s=i.pathname.split("/").pop();if(s){const e=`${s}.png`;i.pathname=i.pathname.replace(s,e),this.setValue(pM(i.toString(),t,n,r))}}catch(t){console.error("Invalid URL:",e)}}}),mM=e=>mf`${pM(e.src||e.url,e.href,e.onLoad,e.onClick)}`,gM=(e,t)=>{const{hostname:n}=Up.getURL(e);return mf`<figure><video controls preload="metadata" src="${e}"></video>${t||!n?"":mf`<a target="_blank" rel="noopener" title="${e}" href="${e}">${n}</a>`}</figure>`},vM=["*","_","~","`"],yM=[...vM,"```",">"],bM={"*":{name:"strong",type:"span"},_:{name:"emphasis",type:"span"},"~":{name:"strike",type:"span"},"`":{name:"preformatted",type:"span"},"```":{name:"preformatted_block",type:"block"},">":{name:"quote",type:"block"}},_M=["_",">","`","~"];function wM(e){return"string"==typeof e}function SM(e,t,n=!0){let r;if(/(^```[\s,\u200B]*\n)|(^```[\s,\u200B]*$)/.test(e.slice(t))&&(0===t||">"===e[t-1]||/\n\u200B{0,2}$/.test(e.slice(0,t))))r=e.slice(t,t+3);else{if(!yM.includes(e.slice(t,t+1)))return null;if(r=e.slice(t,t+1),!function(e,t,n,r){if(r){const r=RegExp(_M.includes(e)?`^(\\p{L}|\\p{N})${e}`:`^(\\p{L}|\\p{N})\\${e}`,"u");if(n>1&&r.test(t.slice(n-1)))return!1;if(AM(e)&&n>0&&"\n"!==t[n-1])return!1;if(vM.includes(e)&&t[n+1]===e)return!1}else{const r=RegExp(_M.includes(e)?`^${e}(\\p{L}|\\p{N})`:`^\\${e}(\\p{L}|\\p{N})`,"u");if(n<t.length-1&&r.test(t.slice(n)))return!1;if(vM.includes(e)&&t[n-1]===e)return!1}return!0}(r,e,t,n))return null}return r}function xM(e,t){const n=SM(e,t),r=n?function(e,t,n){if(!e)return 0;const r=n;if(n+=e.length,AM(e))return(n+=t.slice(n).split(/\n\u200B*[^>\u200B]/).shift().length)-r;if("span"===bM[e].type){const r=t.slice(n).split("\n").shift();let i=0,s=r.indexOf(e);for(;-1!==s;){if(SM(t,n+s,!1)===e)return s+2*e.length;s=r.indexOf(e,i++)}return 0}{const r=t.slice(n+1);let i=0,s=r.indexOf(e);for(;-1!==s;){if(SM(t,n+1+s,!1)===e)return s+1+2*e.length;s=r.indexOf(e,i++)}return 0}}(n,e,t):0;return r>0?{d:n,length:r}:{}}function AM(e){return[">","&gt;"].includes(e)}function jM(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function $M(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){jM(s,r,i,o,a,"next",e)}function a(e){jM(s,r,i,o,a,"throw",e)}o(void 0)}))}}function EM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function OM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){EM(e,t,n[t])}))}return e}function CM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{addMediaURLsOffset:kM,convertASCII2Emoji:TM,getCodePointReferences:NM,getMediaURLsMetadata:MM,getShortnameReferences:IM}=Up;class PM extends String{shouldRenderMedia(e,t){let n;return"image"===t?n=this.show_images:"audio"===t?n=this.embed_audio:"video"===t&&(n=this.embed_videos),"boolean"==typeof n?n:dC(e,t)}addHyperlinkTemplate(e){return $M((function*(){const{url:t}=e,n=hC(t);let r;if(e.is_gif&&this.shouldRenderMedia(t,"image"))r=hM(n,this.hide_media_urls);else if(e.is_image&&this.shouldRenderMedia(t,"image"))r=mM({src:n,href:this.hide_media_urls?null:n,onClick:this.onImgClick,onLoad:this.onImgLoad});else if(e.is_video&&this.shouldRenderMedia(t,"video"))r=gM(n,this.hide_media_urls);else if(e.is_audio&&this.shouldRenderMedia(t,"audio"))r=oM(n,this.hide_media_urls);else if(Wu.settings.get("embed_3rd_party_media_players")&&function(e){try{const{hostname:t,pathname:n}=Up.getURL(e);return"open.spotify.com"===t&&n.startsWith("/track/")}catch(t){return console.debug(`Could not create URL object from ${e}`),!1}}(t)){r=((e,t,n)=>{const{hostname:r}=Up.getURL(t);return mf`<figure><iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${e}" width="100%" height="352" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>${n?"":mf`<a target="_blank" rel="noopener" title="${t}" href="${t}">${r}</a>`}</figure>`})(t.split("/track/")[1],t,this.hide_media_urls)}return r||lj(n)})).call(this)}addHyperlinks(e,t){return $M((function*(){const n=t+this.offset,r=this.media_urls||(yield MM(e,t)).media_urls||[],i=kM(r,e,n);yield Promise.all(i.filter((e=>!e.is_encrypted)).map((e=>$M((function*(){const n=yield this.addHyperlinkTemplate(e);this.addTemplateResult(e.start+t,e.end+t,n)})).call(this))))})).call(this)}addMapURLs(e,t){const n=/geo:([\-0-9.]+),([\-0-9.]+)(?:,([\-0-9.]+))?(?:\?(.*))?/g,r=e.matchAll(n);for(const e of r)this.addTemplateResult(e.index+t,e.index+e[0].length+t,lj(e[0].replace(n,Wu.settings.get("geouri_replacement"))))}addEmojis(e,t){[...IM(e.toString()),...NM(e.toString())].forEach((e=>{this.addTemplateResult(e.begin+t,e.end+t,LN(e,{add_title_wrapper:!0}))}))}addMentions(e,t){var n;const r=t+this.offset;null===(n=this.mentions)||void 0===n||n.forEach((n=>{const i=Number(n.begin)-r;if(i<0||i>=r+e.length)return;const s=Number(n.end)-r,o=e.slice(i,s);o===this.nick?this.addTemplateResult(i+t,s+t,(e=>mf`<span class="mention mention--self badge badge-info" data-uri="${e.uri}">${e.mention}</span>`)(CM(OM({},n),{mention:o}))):this.addTemplateResult(i+t,s+t,function(e){return mf`<span class="mention" data-uri="${e.uri}">${e.mention}</span>`}(CM(OM({},n),{mention:o})))}))}addStyling(){if(!function(e){for(let t=0;t<yM.length;t++)if(e.includes(yM[t]))return!0;return!1}(this))return;const e=[],t=this.mentions.map((e=>Array.from({length:Number(e.end)},((t,n)=>Number(e.begin)+n))));let n=0;for(;n<this.length;){if(t.filter((e=>e.includes(n))).length){n++;continue}const{d:r,length:i}=xM(this,n);if(r&&i){const t=AM(r),s=n+i,o=t?s:s-r.length;let a="```"===r?n+r.length+1:n+r.length;t&&" "===this[a]&&(a+=1);const c=a,l=this.slice(a,o);e.push({begin:n,template:LM(r,l,c,this.options),end:s}),n=s}n++}e.forEach((e=>this.addTemplateResult(e.begin,e.end,e.template)))}trimMeMessage(){0===this.offset&&this.isMeCommand()&&(this.payload[0]=this.payload[0].substring(4))}addAnnotations(e){return $M((function*(){const t=this.marshall();let n=0;for(const r of t)r&&(wM(r)?(yield e.call(this,r,n),n+=r.length):n=r.end)})).call(this)}addTemplates(){return $M((function*(){yield Wu.trigger("beforeMessageBodyTransformed",this,{synchronous:!0}),this.render_styling&&this.addStyling(),yield this.addAnnotations(this.addMentions),yield this.addAnnotations(this.addHyperlinks),yield this.addAnnotations(this.addMapURLs),yield Wu.emojis.initialize(),yield this.addAnnotations(this.addEmojis),yield Wu.trigger("afterMessageBodyTransformed",this,{synchronous:!0}),this.payload=this.marshall(),this.options.show_me_message&&this.trimMeMessage(),this.payload=this.payload.map((e=>wM(e)?e:e.template))})).call(this)}addTemplateResult(e,t,n){this.references.push({begin:e,end:t,template:n})}isMeCommand(){const e=this.toString();return!!e&&e.startsWith("/me ")}marshall(){let e=[this.toString()];return this.references.sort(((e,t)=>t.begin-e.begin)).forEach((t=>{const n=e.shift();e=[n.slice(0,t.begin),t,n.slice(t.end),...e]})),e.reduce(((e,t)=>{return wM(t)?[...e,TM((n=t,n.replace(/\n(\u200B*\n)+/g,(e=>e.length>2?`\n${"​".repeat(e.length-2)}\n`:2===e.length?"\n​":1===e.length?"​":void 0))))]:[...e,t];var n}),[])}constructor(e,t=0,n={}){super(e),this.embed_audio=null==n?void 0:n.embed_audio,this.embed_videos=null==n?void 0:n.embed_videos,this.mentions=(null==n?void 0:n.mentions)||[],this.media_urls=null==n?void 0:n.media_urls,this.nick=null==n?void 0:n.nick,this.offset=t,this.onImgClick=null==n?void 0:n.onImgClick,this.onImgLoad=null==n?void 0:n.onImgLoad,this.options=n,this.payload=[],this.references=[],this.render_styling=null==n?void 0:n.render_styling,this.show_images=null==n?void 0:n.show_images,this.hide_media_urls=null==n?void 0:n.hide_media_urls}}class DM extends bA{static transform(e){return $M((function*(){try{yield e.addTemplates()}catch(e){console.error(e)}return e.payload}))()}render(e,t,n){const r=new PM(e,t,Object.assign(n,{show_images:!1,embed_videos:!1,embed_audio:!1}));return mf`${NA(DM.transform(r),mf`${r}`)}`}}const RM=yA(DM),zM={emphasis:(e,t,n)=>mf`<span class="styling-directive">_</span><i>${RM(e,t,n)}</i><span class="styling-directive">_</span>`,preformatted:e=>mf`<span class="styling-directive">\`</span><code>${e}</code><span class="styling-directive">\`</span>`,preformatted_block:e=>mf`<div class="styling-directive">\`\`\`</div><pre><code class="block">${e}</code></pre><div class="styling-directive">\`\`\`</div>`,quote:(e,t,n)=>mf`<blockquote>${RM(e,t,n)}</blockquote>`,strike:(e,t,n)=>mf`<span class="styling-directive">~</span><del>${RM(e,t,n)}</del><span class="styling-directive">~</span>`,strong:(e,t,n)=>mf`<span class="styling-directive">*</span><b>${RM(e,t,n)}</b><span class="styling-directive">*</span>`};function LM(e,t,n,r){const i=zM[bM[e].name];if(AM(e)){const e=t.replace(/\n\u200B*>[ \f\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]?/g,(e=>`\n${"​".repeat(e.length-1)}`)).replace(/\n$/,"");return i(e,n,r)}return i(t,n,r)}function UM(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}class BM{transform(){return(e=function*(){const e=new PM(this.text,this.offset,this.options);try{yield e.addTemplates()}catch(e){console.error(e)}return e.payload},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){UM(s,r,i,o,a,"next",e)}function a(e){UM(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){return mf`${NA(this.transform(),mf`${this.text}`)}`}constructor(e,t,n={}){this.offset=t,this.options=n,this.text=e}}const FM=yA(class extends bA{render(e,t,n,r){const i=new BM(e,t,n).render();return null==r||r(),i}}),qM=FM;var HM=n(3796),GM={};GM.styleTagTransform=D(),GM.setAttributes=N(),GM.insert=k().bind(null,"head"),GM.domAPI=O(),GM.insertStyleElement=I();$()(HM.A,GM);HM.A&&HM.A.locals&&HM.A.locals;Wu.elements.define("converse-chat-message-body",class extends uA{static get properties(){return{hide_url_previews:{type:String},is_me_message:{type:Boolean},model:{type:Object},text:{type:String}}}initialize(){const e=Wu.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}onImgClick(e){e.preventDefault(),Wu.modal.show("converse-image-modal",{src:e.target.src},e)}onImgLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}render(){const e={media_urls:this.model.get("media_urls"),mentions:this.model.get("references"),nick:this.model.chatbox.get("nick"),onImgClick:e=>this.onImgClick(e),onImgLoad:()=>this.onImgLoad(),render_styling:!this.model.get("is_unstyled")&&Wu.settings.get("allow_message_styling"),show_me_message:!0};return"false"===this.hide_url_previews?(e.embed_audio=!0,e.embed_videos=!0,e.show_images=!0):"true"===this.hide_url_previews&&(e.embed_audio=!1,e.embed_videos=!1,e.show_images=!1),qM(this.text,0,e,(()=>{var e;return null===(e=this.model.collection)||void 0===e?void 0:e.trigger("rendered",this.model)}))}constructor(){super(),this.text=null,this.model=null,this.hide_url_previews=null}});function WM(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function VM(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){WM(s,r,i,o,a,"next",e)}function a(e){WM(s,r,i,o,a,"throw",e)}o(void 0)}))}}function KM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Wu.elements.define("converse-message-versions-modal",class extends ak{renderModal(){return mf`<converse-message-versions .model="${this.model}"></converse-message-versions>`}getModalTitle(){return aA("Message versions")}});const{Strophe:JM}=Hp.env,{STATUS_WEIGHTS:YM}=Xx;function XM(e,t=!1){return VM((function*(){if(!Wu.settings.get("allow_contact_removal"))return;if(!(yield Wu.confirm(aA("Confirm"),aA("Are you sure you want to remove this contact?"))))return!1;const n=yield Wu.chats.get(e.get("jid"));null==n||n.close();try{yield e.remove(t)}catch(t){Q.error(t),Wu.alert("error",aA("Error"),[aA("Sorry, an error occurred while trying to remove %1$s as a contact",e.getDisplayName())])}return!0}))()}function QM(e){return VM((function*(){const t=Ao.session.get("domain"),n=yield Wu.disco.supports(JM.NS.BLOCKING,t),r=yield Wu.confirm(aA("Remove and decline contact request"),[aA("Are you sure you want to decline the contact request from %1$s?",e.getDisplayName())],n?[{label:aA("Also block this user from sending you further messages"),name:"block",type:"checkbox"}]:[]);if(r){var i;const t=yield Wu.chats.get(e.get("jid"));null==t||t.close(),e.unauthorize(),n&&Array.isArray(r)&&"on"===(null===(i=r.find((e=>"block"===e.name)))||void 0===i?void 0:i.value)?(Wu.blocklist.add(e.get("jid")),Wu.toast.show("declined-and-blocked",{type:"success",body:aA("Contact request declined and user blocked")})):Wu.toast.show("request-declined",{type:"success",body:aA("Contact request declined")}),e.destroy()}return this})).call(this)}function ZM(e){return VM((function*(){var t;const n=Ao.session.get("domain");if(!(yield Wu.disco.supports(JM.NS.BLOCKING,n)))return!1;const r=aA("Do you want to block this contact, so they cannot send you messages?");if(!(yield Wu.confirm(aA("Confirm"),r)))return!1;null===(t=yield Wu.chats.get(e.get("jid")))||void 0===t||t.close();try{yield Promise.all([Wu.blocklist.add(e.get("jid")),e.remove(!0)])}catch(t){Q.error(t),Wu.alert("error",aA("Error"),[aA("Sorry, an error occurred while trying to block %1$s",e.getDisplayName())])}}))()}function eI(e){return VM((function*(){const t=Ao.session.get("domain");if(!(yield Wu.disco.supports(JM.NS.BLOCKING,t)))return!1;const n=aA("Do you want to unblock this contact, so they can send you messages?");if(!(yield Wu.confirm(n)))return!1;try{yield Wu.blocklist.remove(e.get("jid"))}catch(t){Q.error(t),Wu.alert("error",aA("Error"),[aA("Sorry, an error occurred while trying to unblock %1$s",e.getDisplayName())])}}))()}function tI(e){var t,n;null===(n=Ao.state.roster)||void 0===n||null===(t=n.get(e))||void 0===t||t.trigger("highlight")}function nI(e,t){var n;null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{roster:r}=Ao.state,i=r.state.get("collapsed_groups");i.includes(t)?r.state.save("collapsed_groups",i.filter((e=>e!==t))):r.state.save("collapsed_groups",[...i,t])}function rI(e){const t=e instanceof fx?e.getNickname():e.get("nickname"),n=e.get("jid");let r=e.getDisplayName({context:"roster"});return r=r.includes(n)?r:r.concat(`   ${n}`),r=r.includes(t)?r:r.concat(`   ${t}`),r.toLowerCase()}function iI(e,t){const n=Ao.state.roster_filter,r=n.get("type"),i="state"===r?n.get("state").toLowerCase():n.get("text").toLowerCase();if(!i)return!1;if("state"===r){return![Ao.labels.HEADER_REQUESTING_CONTACTS,Ao.labels.HEADER_UNREAD].includes(t)&&("unread_messages"===i?0===e.get("num_unread"):"online"===i?["offline","unavailable","dnd","away","xa"].includes(e.getStatus()):!e.getStatus().includes(i))}return"items"===r?!rI(e).includes(i):void 0}function sI(e,t,n){if(!n.get("filter_visible"))return!0;const r=e.getStatus();return Wu.settings.get("hide_offline_users")&&"offline"===r?("subscribe"===e.get("ask")||"from"===e.get("subscription")||!0===e.get("requesting"))&&!iI(e,t):!iI(e,t)}function oI(e,t){if(!t.get("filter_visible"))return!0;const n=Ao.state.roster_filter;if("groups"===n.get("type")){var r;const t=null===(r=n.get("text"))||void 0===r?void 0:r.toLowerCase();if(!t)return!0;if(!e.toLowerCase().includes(t))return!1}return!0}function aI(e,t){const{labels:n}=Ao;var r;const i=Up.unique(null!==(r=t.get("groups"))&&void 0!==r?r:[]);Up.isOwnJID(t.get("jid"))&&!i.length?i.push(n.HEADER_UNGROUPED):t.get("requesting")?i.push(n.HEADER_REQUESTING_CONTACTS):"subscribe"===t.get("ask")?i.push(n.HEADER_PENDING_CONTACTS):void 0===t.get("subscription")?i.push(n.HEADER_UNSAVED_CONTACTS):Wu.settings.get("roster_groups")?i.length||i.push(n.HEADER_UNGROUPED):i.push(n.HEADER_CURRENT_CONTACTS);for(const n of i){var s;(null===(s=e[n])||void 0===s?void 0:s.includes(t))||(e[n]?e[n].push(t):e[n]=[t])}if(t.get("num_unread")){const r=n.HEADER_UNREAD;e[r]?e[r].push(t):e[r]=[t]}return e}function cI(e,t){const n=e.getStatus(),r=t.getStatus();if(YM[n]===YM[r]){const n=e.getDisplayName().toLowerCase(),r=t.getDisplayName().toLowerCase();return n<r?-1:n>r?1:0}return YM[n]<YM[r]?-1:1}function lI(e,t){const n={},{HEADER_CURRENT_CONTACTS:r,HEADER_REQUESTING_CONTACTS:i,HEADER_UNGROUPED:s,HEADER_UNREAD:o,HEADER_PENDING_CONTACTS:a,HEADER_UNSAVED_CONTACTS:c}=Ao.labels;n[o]=0,n[c]=1,n[i]=2,n[r]=3,n[s]=4,n[a]=5;const l=n,u=Object.keys(n),d=u.includes(e),h=u.includes(t);if(!d&&!h)return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0;if(d&&h)return l[e]<l[t]?-1:l[e]>l[t]?1:0;if(!d&&h){const e=r;return l[e]<l[t]?-1:l[e]>l[t]?1:0}if(d&&!h){const t=r;return l[e]<l[t]?-1:l[e]>l[t]?1:0}}function uI(){const e=Ao.state.roster.reduce(((e,t)=>e.concat(t.get("groups"))),[]);return[...new Set(e.filter((e=>e)))]}function dI(){const e=Ao.state.roster;return[...new Set([...e.map((e=>JM.getDomainFromJid(e.get("jid")))),Ao.session.get("domain")])]}function hI(e){return VM((function*(){const t={mode:"cors",headers:{Accept:"text/json"}},n=`${Wu.settings.get("xhr_user_search_url")}q=${encodeURIComponent(e)}`;let r;try{r=yield fetch(n,t)}catch(t){return Q.error(`Failed to fetch names for query "${e}"`),Q.error(t),[]}const i=yield r.json();return Array.isArray(i)?i.map((e=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){KM(e,t,n[t])}))}return e}({label:`${e.fullname} <${e.jid}>`,value:`${e.fullname} <${e.jid}>`},e))):(Q.error('Invalid JSON returned"'),[])}))()}function fI(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function pI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.assign(Up,{rosterview:{removeContact:XM,declineContactRequest:QM,blockContact:ZM,unblockContact:eI,highlightRosterItem:tI,toggleGroup:nI,getFilterCriteria:rI,isContactFiltered:iI,shouldShowContact:sI,shouldShowGroup:oI,populateContactsMap:aI,contactsComparator:cI,groupsComparator:lI,getGroupsAutoCompleteList:uI,getJIDsAutoCompleteList:dI,getNamesAutoCompleteList:hI}});const{Strophe:mI}=Hp.env;function gI(e){const t=aA("Add to blocklist");return mf`<button type="button" @click="${t=>e.blockContact(t)}" class="btn btn-danger"><converse-icon class="fas fa-list-ul" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}function vI(e){var t,n,r,i;const s=null===(t=e.model)||void 0===t?void 0:t.vcard,o=s?s.toJSON():{},a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){pI(e,t,n[t])}))}return e}({},e.model.toJSON(),o),c=e.getContact(),l=c&&!c.isUnsaved(),u=Wu.settings.get("allow_contact_removal"),d=Ao.session.get("domain"),h=Wu.disco.supports(mI.NS.BLOCKING,d).then((t=>{return(n=function*(){const n=yield Wu.blocklist.get();t&&(n.get(e.model.get("jid"))?function(e){const t=aA("Remove from blocklist");mf`<button type="button" @click="${t=>e.unblockContact(t)}" class="btn btn-danger"><converse-icon class="fas fa-times" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}(e):gI(e))},function(){var e=this,t=arguments;return new Promise((function(r,i){var s=n.apply(e,t);function o(e){fI(s,r,i,o,a,"next",e)}function a(e){fI(s,r,i,o,a,"throw",e)}o(void 0)}))})();var n})),f=aA("XMPP Address"),p=aA("Email"),m=aA("Full Name"),g=aA("Nickname"),v=aA("Role"),y=aA("URL"),b=aA("Groups"),_=aA("Use commas to separate multiple values"),w=aA("OMEMO"),S=aA("Profile"),x=aA("Edit"),A=[mf`<li role="presentation" class="nav-item"><a class="nav-link ${"profile"===e.tab?"active":""}" id="profile-tab" href="#profile-tabpanel" aria-controls="profile-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="profile" data-toggle="tab">${S}</a></li>`];l&&A.push(mf`<li role="presentation" class="nav-item"><a class="nav-link ${"edit"===e.tab?"active":""}" id="edit-tab" href="#edit-tabpanel" aria-controls="edit-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="edit" data-toggle="tab">${x}</a></li>`),(null===(n=Ao.pluggable.plugins["converse-omemo"])||void 0===n?void 0:n.enabled(Ao))&&A.push(mf`<li role="presentation" class="nav-item"><a class="nav-link ${"omemo"===e.tab?"active":""}" id="omemo-tab" href="#omemo-tabpanel" aria-controls="omemo-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="omemo" data-toggle="tab">${w}</a></li>`);const j=(null==c?void 0:c.get("nickname"))||(null==c||null===(r=c.vcard)||void 0===r?void 0:r.get("fullname")),$=(null==c?void 0:c.get("groups"))||[];return mf`<ul class="nav nav-pills justify-content-center">${A}</ul><div class="tab-content"><div class="tab-pane ${"profile"===e.tab?"active":""}" id="profile-tabpanel" role="tabpanel" aria-labelledby="profile-tab"><div class="mb-4 centered"><converse-avatar .model="${e.model}" name="${e.model.getDisplayName()}" height="140" width="140"></converse-avatar></div>${a.fullname?mf`<div class="row mb-2"><div class="col-sm-4"><label>${m}:</label></div><div class="col-sm-8">${a.fullname}</div></div>`:""}<div class="row mb-2"><div class="col-sm-4"><label>${f}:</label></div><div class="col-sm-8"><a href="xmpp:${a.jid}">${a.jid}</a></div></div>${c?mf`<div class="row mb-2"><div class="col-sm-4"><label>${aA("Presence")}:</label></div><div class="col-sm-8">${function(e){const t=null==e?void 0:e.get("subscription");return"none"===t?aA("Neither of you receive presence updates"):"to"===t?aA("Only you receive presence updates"):"from"===t?aA("Only they receive presence updates"):"both"===t?aA("Both of you receive presence updates"):""}(c)}</div></div>`:""} ${a.nickname?mf`<div class="row mb-2"><div class="col-sm-4"><label>${g}:</label></div><div class="col-sm-8">${a.nickname}</div></div>`:""} ${a.url?mf`<div class="row mb-2"><div class="col-sm-4"><label>${y}:</label></div><div class="col-sm-8"><a target="_blank" rel="noopener" href="${a.url}">${a.url}</a></div></div>`:""} ${a.email?mf`<div class="row mb-2"><div class="col-sm-4"><label>${p}:</label></div><div class="col-sm-8"><a href="mailto:${a.email}">${a.email}</a></div></div>`:""} ${a.role?mf`<div class="row mb-2"><div class="col-sm-4"><label>${v}:</label></div><div class="col-sm-8">${a.role}</div></div>`:""} ${$.length?mf`<div class="row mb-2"><div class="col-sm-4"><label>${b}:</label></div><div class="col-sm-8">${$.map((e=>mf`<span class="badge badge-roster-group me-1">${e}</span>`))}</div></div>`:""} ${!(null==c?void 0:c.get("requesting"))&&l&&c?"":mf`<hr>`} ${(null==c?void 0:c.get("requesting"))?mf`<div class="row mb-2"><div class="col-sm-4"><label>${aA("Contact Request")}:</label></div><div class="col-sm-8">${function(e){const t=aA("Accept");return mf`<button type="button" @click="${t=>e.acceptContactRequest(t)}" class="btn btn-success accept-contact-request"><converse-icon class="fas fa-user-plus" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}(e)} ${function(e){const t=aA("Decline");return mf`<button type="button" @click="${t=>e.declineContactRequest(t)}" class="btn btn-danger decline-contact-request"><converse-icon class="fas fa-user-plus" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}(e)}</div></div>`:""} ${l?"":function(e){const t=aA("Add as contact");return mf`<button type="button" @click="${t=>e.addContact(t)}" class="btn btn-success add-contact"><converse-icon class="fas fa-user-plus" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}(e)} ${c?"":NA(h.then((()=>gI(e))),"")}</div>${l?mf`<div class="tab-pane ${"edit"===e.tab?"active":""}" id="edit-tabpanel" role="tabpanel" aria-labelledby="edit-tab">${"edit"===e.tab?mf`<form class="converse-form" @submit="${t=>e.updateContact(t)}"><div class="mb-3"><label class="form-label clearfix" for="name">${aA("Name")}:</label> <input type="text" name="name" value="${j}" class="form-control"></div><div class="mb-3"><label class="form-label clearfix" for="name">${b}:</label><div class="mb-1"><small class="form-text text-muted">${_}</small></div><converse-autocomplete .list="${uI()}" name="groups" value="${$}"></converse-autocomplete></div><button type="submit" class="btn btn-primary">${aA("Update")}</button></form><hr>${u&&l?function(e){const t=aA("Remove as contact");return mf`<button type="button" @click="${t=>e.removeContact(t)}" class="btn btn-danger remove-contact"><converse-icon class="fas fa-trash-alt" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}(e):""} ${NA(h.then((()=>gI(e))),"")}`:""}</div>`:""} ${(null===(i=Ao.pluggable.plugins["converse-omemo"])||void 0===i?void 0:i.enabled(Ao))?mf`<div class="tab-pane ${"omemo"===e.tab?"active":""}" id="omemo-tabpanel" role="tabpanel" aria-labelledby="omemo-tab">${"omemo"===e.tab?mf`<converse-omemo-fingerprints jid="${a.jid}"></converse-omemo-fingerprints>`:""}</div>`:""}</div>`}var yI=n(8850),bI={};bI.styleTagTransform=D(),bI.setAttributes=N(),bI.insert=k().bind(null,"head"),bI.domAPI=O(),bI.insertStyleElement=I();$()(yI.A,bI);yI.A&&yI.A.locals&&yI.A.locals;function _I(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function wI(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){_I(s,r,i,o,a,"next",e)}function a(e){_I(s,r,i,o,a,"throw",e)}o(void 0)}))}}Wu.elements.define("converse-user-details-modal",class extends ak{initialize(){super.initialize(),this.addListeners(),Wu.trigger("userDetailsModalInitialized",this.model)}addListeners(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.model instanceof Ao.exports.ChatBox?(this.model.rosterContactAdded.then((()=>this.registerContactEventHandlers(this.model.contact))),this.registerContactEventHandlers(this.model.contact)):this.registerContactEventHandlers(this.model)}getContact(){return this.model instanceof Ao.exports.ChatBox?this.model.contact:this.model}shouldUpdate(e){return e.has("model")&&this.model&&(this.stopListening(),this.addListeners(),this.tab="profile",this.requestUpdate()),!0}renderModal(){return vI(this)}getModalTitle(){return this.model.getDisplayName()}registerContactEventHandlers(e){e&&(this.listenTo(e,"change",(()=>this.requestUpdate())),this.listenTo(e,"destroy",(()=>this.close())),this.listenTo(e.vcard,"change",(()=>this.requestUpdate())),e.vcard&&Wu.vcard.update(e.vcard,!0))}addContact(e){return wI((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.modal.hide(),Wu.modal.show("converse-add-contact-modal",{contact:this.model},e)})).call(this)}updateContact(e){return wI((function*(){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const r=e.target,i=new FormData(r),s=(i.get("name")||"").trim(),o=(null===(n=i.get("groups"))||void 0===n?void 0:n.split(",").map((e=>e.trim())))||[];this.getContact().update({nickname:s,groups:o}),this.modal.hide()})).call(this)}removeContact(e){return wI((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),setTimeout((()=>XM(this.getContact())),1),this.modal.hide()})).call(this)}blockContact(e){return wI((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),setTimeout((()=>ZM(this.getContact())),1),this.modal.hide()})).call(this)}unblockContact(e){return wI((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),setTimeout((()=>eI(this.getContact())),1),this.modal.hide()})).call(this)}acceptContactRequest(e){return wI((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),setTimeout((()=>{Wu.modal.show("converse-accept-contact-request-modal",{contact:this.getContact()},e)})),this.modal.hide()})).call(this)}declineContactRequest(e){return wI((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),setTimeout((()=>QM(this.getContact()))),this.modal.hide()})).call(this)}constructor(e){super(e),this.tab="profile"}});const{filesize:SI}=Hp.env,{dayjs:xI}=Hp.env,{dayjs:AI}=Hp.env,{isGIFURL:jI}=Up;Wu.elements.define("converse-image",class extends uA{static get properties(){return{src:{type:String},onImgLoad:{type:Function},href:{type:String}}}render(){return jI(this.src)&&dC(this.src,"image")?hM(hC(this.src),!0):mM({src:hC(this.src),href:this.href,onClick:this.onImgClick,onLoad:this.onImgLoad})}constructor(){super(),this.src=null,this.href=null,this.onImgClick=null,this.onImgLoad=null}});const $I=e=>{const t=e.description||"",n=e.image||"",r=e.title||"",i=e.url||"",s=function(e){return e&&lC(e,"allowed_image_domains")&&Up.isValidURL(e)}(n),o=r||t||i;return s||o?mf`<div class="card card--unfurl">${s?function(e){const t=e.image||"",n=e.url||"";return mf`<converse-image class="card-img-top hor_centered" href="${n}" src="${t}" .onImgLoad="${()=>e.onImageLoad()}"></converse-image>`}(e):""} ${o?mf`<div class="card-body">${r?function(e,t){const n=e.image||"",r=e.url||"",i=e.title||"";return r&&Up.isValidURL(r)&&!Up.isGIFURL(n)?mf`<a href="${r}" target="_blank" rel="noopener">${t(i)}</a>`:t(null!=i?i:"")}(e,(e=>mf`<h5 class="card-title">${e}</h5>`)):""} ${t?mf`<p class="card-text"><converse-texture text="${t}"></converse-texture></p>`:""} ${i&&Up.isValidURL(i)?mf`<p class="card-text"><a href="${i}" target="_blank" rel="noopener">${new URL(i).hostname}</a></p>`:""}</div>`:""}</div>`:""};var EI=n(1070),OI={};OI.styleTagTransform=D(),OI.setAttributes=N(),OI.insert=k().bind(null,"head"),OI.domAPI=O(),OI.insertStyleElement=I();$()(EI.A,OI);EI.A&&EI.A.locals&&EI.A.locals;Wu.elements.define("converse-message-unfurl",class extends uA{static get properties(){return{description:{type:String},image:{type:String},jid:{type:String},title:{type:String},url:{type:String},site_name:{type:String}}}initialize(){const e=Wu.settings.get();this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}render(){return $I(this)}onImageLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}constructor(){super(),this.jid=null,this.url=null,this.title=null,this.image=null,this.description=null,this.site_name=null}});const{dayjs:CI}=Hp.env,kI=e=>{var t,n;const r=aA("New messages"),i=e.model.get("edited"),s=e.model_with_messages.get("first_unread_id")===e.model.get("id"),o=e.model.isFollowup(),a=e.model.isMeCommand(),c=e.model.isRetracted(),l=e.model.get("msgid"),u=e.model.get("sender"),d=e.model.get("time"),h=e.model.occupant||e.model.contact,f=eC(h),p=Wu.settings.get("time_format"),m=CI(i||d).format(p),g=function(e){if("groupchat"===e.get("type")){var t;const n=Wu.settings.get("muc_hats").filter((e=>e)).map((e=>e.toLowerCase()));let r=[];n.includes("vcard_roles")&&(r=e.vcard?e.vcard.get("role"):null,r=r?r.split(",").filter((e=>e)).map((e=>({title:e}))):[]);const i=[...e.occupant?[e.occupant.get("role")]:[],...e.occupant?[e.occupant.get("affiliation")]:[]].filter((e=>e)).filter((e=>n.includes(e.toLowerCase()))).map((e=>({title:e})));return[...n.includes("xep317")&&(null===(t=e.occupant)||void 0===t?void 0:t.get("hats"))||[],...r,...i]}return[]}(e.model),v=e.model.getDisplayName(),y=a||c,b=!y&&!o,_=e.shouldShowAvatar()&&b,w=(null==h?void 0:h.vcard)?h:e.model;return mf`${s?mf`<div class="message separator"><hr class="separator"><span class="separator-text">${r}</span></div>`:""}<div class="message chat-msg ${e.getExtraMessageClasses()}" data-isodate="${d}" data-msgid="${l}" data-from="${e.model.get("from")}" data-encrypted="${e.model.get("is_encrypted")}"><a id="${l}"></a> ${_?mf`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${w}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${null===(t=w.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content chat-msg__content--${u} ${y?"chat-msg__content--action":""}">${b?mf`<span class="chat-msg__heading"><span class="chat-msg__author"><a class="show-msg-author-modal" @click="${e.showUserModal}" style="${f}">${v}</a> </span>${g.map((e=>mf`<span class="badge badge-secondary">${e.title}</span>`))} <time timestamp="${i||d}" class="chat-msg__time">${m}</time> ${e.model.get("is_encrypted")?mf`<converse-icon class="fa fa-lock" size="1.1em"></converse-icon>`:""}</span>`:""}<div class="chat-msg__body chat-msg__body--${e.model.get("message_type")} ${e.model.get("received")?"chat-msg__body--received":""} ${e.model.get("is_delayed")?"chat-msg__body--delayed":""}"><div class="chat-msg__message">${y?mf`<time timestamp="${i||d}" class="chat-msg__time">${m}</time> ${a?mf`<span class="chat-msg__author" style="${f}">${a?"**":""}${v}</span> `:""}`:""} ${c?e.renderRetraction():e.renderMessageText()}</div><converse-message-actions .model="${e.model}" ?is_retracted="${c}"></converse-message-actions></div>${null===(n=e.model.get("ogp_metadata"))||void 0===n?void 0:n.map((t=>{var n;return!0===e.model.get("hide_url_previews")?"":mf`<converse-message-unfurl @animationend="${e.onUnfurlAnimationEnd}" class="${e.model.get("url_preview_transition")}" jid="${null===(n=e.model_with_messages)||void 0===n?void 0:n.get("jid")}" description="${t["og:description"]||""}" title="${t["og:title"]||""}" image="${t["og:image"]&&dC(t["og:image"],"image")?t["og:image"]:yf}" site_name="${t["og:site_name"]||""}" url="${t["og:url"]||""}"></converse-message-unfurl>`}))}</div></div>`};const TI=e=>{const t=aA("Show more"),n="groupchat"===e.model.get("type"),r=aA("Show less"),i=e.model.get("error_text")||e.model.get("error"),s=`${aA("Message delivery failed.")}\n${i}`,o=mf`<div class="chat-msg__spoiler-hint"><span class="spoiler-hint">${e.model.get("spoiler_hint")}</span> <a class="badge badge-info spoiler-toggle" href="#" @click="${e.toggleSpoilerMessage}"><converse-icon size="1em" color="var(--background-color)" class="fa ${e.model.get("is_spoiler_visible")?"fa-eye-slash":"fa-eye"}"></converse-icon>${e.model.get("is_spoiler_visible")?r:t}</a></div>`,a=e.model.get("is_spoiler")?"spoiler "+(e.model.get("is_spoiler_visible")?"":"hidden"):"",c=e.model.getMessageText(),l=e.model.get("oob_url")&&c!==e.model.get("oob_url"),u=Wu.settings.get("render_media");return mf`${e.model.get("is_spoiler")?o:""} ${e.model.get("subject")?mf`<div class="chat-msg__subject">${e.model.get("subject")}</div>`:""} <span class="chat-msg__body--wrapper ${i?"error":""}"><converse-chat-message-body class="chat-msg__text ${e.model.get("is_only_emojis")?"chat-msg__text--larger":""} ${a}" .model="${e.model}" hide_url_previews="${e.model.get("hide_url_previews")}" ?is_me_message="${e.model.isMeCommand()}" text="${c}"></converse-chat-message-body>${!e.model.get("received")||e.model.isMeCommand()||n?"":mf`<converse-icon size="0.75em" color="var(--chat-color)" class="fa fa-check chat-msg__receipt"></converse-icon>`} ${e.model.get("edited")?function(e){const t=aA("This message has been edited");return mf`<converse-icon title="${t}" class="fa fa-edit chat-msg__edit-modal" @click="${e.showMessageVersionsModal}" size="1em"></converse-icon>`}(e):""} </span>${l?mf`<div class="chat-msg__media"><converse-texture text="${e.model.get("oob_url")}" .onImgClick="${t=>e.onImgClick(t)}" ?embed_audio="${u}" ?embed_videos="${u}" ?show_images="${u}"></div>`:""} ${i?mf`<div class="chat-msg__error">${s}</div>`:""}`};var NI=n(4563),MI={};MI.styleTagTransform=D(),MI.setAttributes=N(),MI.insert=k().bind(null,"head"),MI.domAPI=O(),MI.insertStyleElement=I();$()(NI.A,MI);NI.A&&NI.A.locals&&NI.A.locals;function II(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function PI(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){II(s,r,i,o,a,"next",e)}function a(e){II(s,r,i,o,a,"throw",e)}o(void 0)}))}}function DI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{Strophe:zI}=Hp.env,{SUCCESS:LI}=Xx;Wu.elements.define("converse-chat-message",class extends zO{static get properties(){return RI(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){DI(e,t,n[t])}))}return e}({},super.properties),{model_with_messages:{type:Object},model:{type:Object}})}initialize(){var e=this,t=()=>super.initialize;return PI((function*(){t().call(e),yield this.model_with_messages.initialized,yield this.model_with_messages.messages.fetched;const n=Wu.settings.get();this.listenTo(n,"change:render_media",(()=>{this.model.save("hide_url_previews",void 0),this.requestUpdate()})),this.listenTo(this.model_with_messages,"change:first_unread_id",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"contact:change",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:add",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.requestUpdate()})).call(this)}render(){return this.model?this.show_spinner?BO():this.model.get("file")&&this.model.get("upload")!==LI?this.renderFileProgress():["mep"].includes(this.model.get("type"))?this.renderMEPMessage():["error","info"].includes(this.model.get("type"))?this.renderInfoMessage():this.renderChatMessage():""}renderRetraction(){return(e=>{const t=e.model.isRetracted()?e.getRetractionText():null;return mf`<span class="retraction"><span>${t}</span> ${e.model.get("moderation_reason")?mf`<q class="chat-msg--retracted__reason">${e.model.get("moderation_reason")}</q>`:""}</span>`})(this)}renderMessageText(){return TI(this)}renderMEPMessage(){return(e=>{const t=AI(e.model.get("time")).toISOString();return mf`<div class="message chat-info message--mep ${e.getExtraMessageClasses()}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-msg__content"><div class="chat-msg__body chat-msg__body--${e.model.get("type")} ${e.model.get("is_delayed")?"chat-msg__body--delayed":""}"><div class="chat-info__message">${e.model.isRetracted()?e.renderRetraction():mf`<converse-texture .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-texture>${e.model.get("reason")?mf`<q class="reason"><converse-texture text="${e.model.get("reason")}"></converse-texture></q>`:""}`}</div><converse-message-actions ?is_retracted="${e.model.isRetracted()}" .model="${e.model}"></converse-message-actions></div></div></div>`})(this)}renderInfoMessage(){return(e=>{const t=xI(e.model.get("time")).toISOString(),n=aA("Retry");return mf`<div class="message chat-info chat-${e.model.get("type")}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-info__message"><converse-texture .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-texture></div>${e.model.get("reason")?mf`<q class="reason">${e.model.get("reason")}</q>`:""} ${e.model.get("error_text")?mf`<q class="reason">${e.model.get("error_text")}</q>`:""} ${e.model.get("retry_event_id")?mf`<a class="retry" @click="${e.onRetryClicked}">${n}</a>`:""}</div>`})(this)}renderFileProgress(){return this.model.file?(e=>{var t;const n=aA("Uploading file:"),r=e.model.file.name,i=SI(e.model.file.size),s=e.model.occupant||e.model.contact;return mf`<div class="message chat-msg">${e.shouldShowAvatar()?mf`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${s||e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${null===(t=e.model.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content"><span class="chat-msg__text">${n} <strong>${r}</strong>, ${i}</span><progress value="${e.model.get("progress")}"></div></div>`})(this):""}renderChatMessage(){return kI(this)}shouldShowAvatar(){return Wu.settings.get("show_message_avatar")&&!this.model.isMeCommand()&&["chat","groupchat","normal"].includes(this.model.get("type"))}onImgClick(e){e.preventDefault(),Wu.modal.show("converse-image-modal",{src:e.target.src},e)}onUnfurlAnimationEnd(){"fade-out"===this.model.get("url_preview_transition")&&this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}onRetryClicked(){return PI((function*(){this.show_spinner=!0,this.requestUpdate(),yield Wu.trigger(this.model.get("retry_event_id"),{synchronous:!0}),this.model.destroy(),this.parentElement.removeChild(this)})).call(this)}hasMentions(){return"groupchat"===this.model.get("type")&&"them"===this.model.get("sender")&&this.model_with_messages.isUserMentioned(this.model)}getOccupantAffiliation(){var e;return null===(e=this.model.occupant)||void 0===e?void 0:e.get("affiliation")}getOccupantRole(){var e;return null===(e=this.model.occupant)||void 0===e?void 0:e.get("role")}getExtraMessageClasses(){const e=this.model.isMeCommand()||this.model.isRetracted(),t=[this.model.isFollowup()?"chat-msg--followup":null,this.model.get("is_delayed")?"delayed":null,e?"chat-msg--action":null,this.model.isRetracted()?"chat-msg--retracted":null,this.model.get("type"),this.shouldShowAvatar()?"chat-msg--with-avatar":null].map((e=>e));var n,r;"groupchat"===this.model.get("type")&&(t.push(null!==(n=this.getOccupantRole())&&void 0!==n?n:""),t.push(null!==(r=this.getOccupantAffiliation())&&void 0!==r?r:""),"them"===this.model.get("sender")&&this.hasMentions()&&t.push("mentioned"));return this.model.get("correcting")&&t.push("correcting"),t.filter((e=>e)).join(" ")}getRetractionText(){if(["groupchat","mep"].includes(this.model.get("type"))&&this.model.get("moderated_by")){const e=this.model.get("moderated_by");if(!this.model.mod){const{occupants:t}=this.model_with_messages;this.model.mod=t.findOccupant({jid:e})||t.findOccupant({nick:zI.getResourceFromJid(e)})}const t=this.model.mod?this.model.mod.getDisplayName():aA("A moderator");return aA("%1$s has removed a message",t)}return"me"===this.model.get("sender")?aA("You have removed a message"):aA("%1$s has removed a message",this.model.getDisplayName())}showUserModal(e){"me"===this.model.get("sender")?Wu.modal.show("converse-profile-modal",{model:Ao.state.xmppstatus},e):"groupchat"===this.model.get("type")?(e.preventDefault(),Wu.modal.show("converse-muc-occupant-modal",{model:this.model.getOccupant(),message:this.model},e)):(e.preventDefault(),Wu.modal.show("converse-user-details-modal",{model:this.model_with_messages},e))}showMessageVersionsModal(e){e.preventDefault(),Wu.modal.show("converse-message-versions-modal",{model:this.model},e)}toggleSpoilerMessage(e){null==e||e.preventDefault(),this.model.save({is_spoiler_visible:!this.model.get("is_spoiler_visible")})}constructor(){super(),this.model_with_messages=null,this.model=null,this.observable="once"}});Wu.elements.define("converse-message-history",class extends uA{static get properties(){return{model:{type:Object},messages:{type:Array}}}render(){const e=this.messages;return e.length?xN(e,(e=>e.get("id")),(e=>mf`${this.renderMessage(e)}`)):""}renderMessage(e){if(e.get("dangling_retraction")||e.get("dangling_moderation")||e.get("is_only_key"))return"";const t=e.get("template_hook");if("string"==typeof t){const n=Wu.hook(t,e,"");return NA(n,"")}{const t=mf`<converse-chat-message .model_with_messages="${this.model}" .model="${e}"></converse-chat-message>`,n=RN(e);return n?[n,t]:t}}constructor(){super(),this.model=null,this.messages=[]}});var UI=n(6120),BI={};BI.styleTagTransform=D(),BI.setAttributes=N(),BI.insert=k().bind(null,"head"),BI.domAPI=O(),BI.insertStyleElement=I();$()(UI.A,BI);UI.A&&UI.A.locals&&UI.A.locals;function FI(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function qI(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function HI(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}const GI=100;var WI=new WeakSet,VI=new WeakSet,KI=new WeakSet;class JI extends uA{static get properties(){return{model:{type:Object},window_top:{state:!0},window_bottom:{state:!0}}}initialize(){return(e=function*(){yield this.model.initialized,this.listenTo(this.model.messages,"add",(()=>qI(this,WI,YI).call(this))),this.listenTo(this.model.messages,"remove",(()=>qI(this,WI,YI).call(this))),this.listenTo(this.model.messages,"reset",(()=>qI(this,WI,YI).call(this))),this.listenTo(this.model.messages,"change",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"rendered",(()=>this.requestUpdate())),this.listenTo(this.model,"historyPruned",(()=>qI(this,KI,QI).call(this))),this.listenTo(this.model.notifications,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change:scrolled",(()=>this.scrollDown())),this.window_bottom=this.model.messages.length-1,this.window_top=Math.max(0,this.window_bottom-GI),this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){FI(s,r,i,o,a,"next",e)}function a(e){FI(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){var e;return this.model?mf`<div class="chat-content__messages" @scroll="${e=>this.scrollHandler(e)}"><div class="chat-content__notifications">${this.model.getNotificationsText()}</div><converse-message-history .model="${this.model}" .messages="${this.model.messages.slice(this.window_top,this.window_bottom+1)}"></converse-message-history></div>${(null===(e=this.model.ui)||void 0===e?void 0:e.get("chat-content-spinner-top"))?BO():""}`:""}scrollDown(){if(!this.model.ui.get("scrolled")){if(this.scrollTo){const e=this.scrollTop?"smooth":"auto";this.scrollTo({top:0,behavior:e})}else this.scrollTop=0;Wu.trigger("chatBoxScrolledDown",{chatbox:this.model})}}constructor(){super(),HI(this,WI),HI(this,VI),HI(this,KI),this.model=null,this.scrollTop=0,this.scroll_debounce=null,this.window_top=0,this.window_bottom=0,this.scrollHandler=e=>{this.mark_scrolled_debounce&&clearTimeout(this.scroll_debounce),this.mark_scrolled_debounce=setTimeout((()=>{qI(this,VI,XI).call(this,e)}),250),requestAnimationFrame((()=>qI(this,KI,QI).call(this)))}}}function YI(){qI(this,KI,QI).call(this),this.requestUpdate()}function XI(e){let t=!0;const n=e.target,r=0===Math.floor(n.scrollTop),i=Math.ceil(n.clientHeight-n.scrollTop)>=n.scrollHeight-Math.ceil(n.scrollHeight/20);r?(t=!1,DN(this.model)):i&&Wu.trigger("chatBoxScrolledUp",n),this.model.get("scolled")!==t&&this.model.ui.set({scrolled:t})}function QI(){const e=this.model.messages.length,t=this.querySelector(".chat-content__messages"),n=Math.ceil(t.scrollHeight/5);if(Math.ceil(t.clientHeight-t.scrollTop)>=t.scrollHeight-n)return this.window_top=Math.max(0,this.window_top-5),void(this.window_bottom=this.window_top+GI);if(0===Math.floor(t.scrollTop))return this.window_bottom=e-1,void(this.window_top=Math.max(0,this.window_bottom-GI));return Math.floor(Math.abs(t.scrollTop))<n?(this.window_bottom=Math.min(e-1,this.window_bottom+5),void(this.window_top=Math.max(0,this.window_bottom-GI))):void 0}Wu.elements.define("converse-chat-content",JI);class ZI extends bA{render(e){if(e===yf||null==e)return this._t=void 0,this.it=e;if(e===vf)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}constructor(e){if(super(e),this.it=yf,e.type!==vA)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}}ZI.directiveName="unsafeHTML",ZI.resultType=1;const eP=yA(ZI);Wu.elements.define("converse-chat-help",class extends uA{static get properties(){return{chat_type:{type:String},messages:{type:Array},model:{type:Object},type:{type:String}}}render(){const e=(new Date).toISOString();return[mf`<converse-icon class="fas fa-times close-chat-help" @click="${this.close}" path-prefix="${Wu.settings.get("assets_path")}" size="1em"></converse-icon>`,...this.messages.map((t=>this.renderHelpMessage({isodate:e,markup:Xd.sanitize(t,{ALLOWED_TAGS:["strong"]})})))]}close(){this.model.set({show_help_messages:!1})}renderHelpMessage(e){return mf`<div class="message chat-${this.type}" data-isodate="${e.isodate}">${eP(e.markup)}</div>`}constructor(){super(),this.messages=[],this.model=null,this.type=null}});const tP=Hp.env.utils,nP=e=>{const t=Wu.settings.get("emoji_categories");return mf`<ul>${Object.keys(t).map((n=>t[n]?(e=>mf`<li data-category="${e.category}" class="emoji-category ${e.category} ${e.current_category===e.category?"picked":""}" title="${aA(Wu.settings.get("emoji_category_labels")[e.category])}"><a class="btn pick-category" @click="${e.onCategoryPicked}" href="#emoji-picker-${e.category}" data-category="${e.category}">${e.emoji}</a></li>`)(Object.assign({category:n,emoji:e.sn2Emoji(t[n])},e)):""))}</ul>`},rP=e=>mf`<li class="emoji insert-emoji ${e.shouldBeHidden(e.emoji.sn)?"hidden":""}" data-emoji="${e.emoji.sn}" title="${e.emoji.sn}"><a href="#" @click="${e.insertEmoji}" data-emoji="${e.emoji.sn}">${tP.shortnamesToEmojis(e.emoji.sn)}</a></li>`;function iP(e){const t=Wu.settings.get("emoji_categories");return mf`<span ?hidden="${e.query}" class="emoji-lists__container emoji-lists__container--browse">${Object.keys(t).map((n=>t[n]?function(e){return mf`<a id="emoji-picker-${e.category}" class="emoji-category__heading" data-category="${e.category}">${aA(Wu.settings.get("emoji_category_labels")[e.category])}</a><ul class="emoji-picker" data-category="${e.category}">${Object.values(Hp.emojis.json[e.category]).map((t=>rP(Object.assign({emoji:t},e))))}</ul>`}(Object.assign({category:n},e)):""))}</span>`}function sP(e,t){const n=aA("Search"),r={tone1:":raised_hand_tone1:",tone2:":raised_hand_tone2:",tone3:":raised_hand_tone3:",tone4:":raised_hand_tone4:",tone5:":raised_hand_tone5:"};return mf`<div class="emoji-picker__header"><input class="form-control emoji-search" name="emoji-search" placeholder="${n}" .value="${t.query||""}" @keydown="${t.onSearchInputKeyDown}" @blur="${t.onSearchInputBlurred}" @focus="${t.onSearchInputFocus}"> ${t.query?"":nP(t)}</div>${t.render_emojis?mf`<converse-emoji-picker-content .model="${e.state}" .search_results="${t.search_results}" current_skintone="${t.current_skintone}" query="${t.query}"></converse-emoji-picker-content>`:""}<div class="emoji-skintone-picker">Skin tone:<ul>${Object.keys(r).map((e=>function(e,t,n){return mf`<li data-skintone="${n}" class="emoji-skintone ${e.current_skintone===t?"picked":""}"><a class="pick-skintone" href="#" data-skintone="${t}" @click="${e.onSkintonePicked}">${tP.shortnamesToEmojis(n)}</a></li>`}(t,e,r[e])))}</ul></div>`}const{sizzle:oP}=Hp.env;function aP(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function cP(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){aP(s,r,i,o,a,"next",e)}function a(e){aP(s,r,i,o,a,"throw",e)}o(void 0)}))}}Wu.elements.define("converse-emoji-picker-content",class extends uA{static get properties(){return{search_results:{type:Array},current_skintone:{type:String},model:{type:Object},query:{type:String}}}render(){const e={current_skintone:this.current_skintone,insertEmoji:e=>this.insertEmoji(e),query:this.query,search_results:this.search_results,shouldBeHidden:e=>this.shouldBeHidden(e)};return mf`<div class="emoji-picker__lists">${function(e){const t=aA("Search results");return mf`<span ?hidden="${!e.query}" class="emoji-lists__container emojis-lists__container--search"><a id="emoji-picker-search-results" class="emoji-category__heading">${t}</a><ul class="emoji-picker">${e.search_results.map((t=>rP(Object.assign({emoji:t},e))))}</ul></span>`}(e)} ${iP(e)}</div>`}firstUpdated(){this.initIntersectionObserver()}initIntersectionObserver(){if(window.IntersectionObserver){if(this.observer)this.observer.disconnect();else{const e={root:this.querySelector(".emoji-picker__lists"),threshold:[.1]},t=e=>this.setCategoryOnVisibilityChange(e);this.observer=new IntersectionObserver(t,e)}oP(".emoji-picker",this).forEach((e=>this.observer.observe(e)))}}setCategoryOnVisibilityChange(e){const t=this.parentElement.navigator.selected,n=e.filter((e=>e.target.contains(t))).pop();let r;if(r=n||e.reduce(((e,t)=>t.intersectionRatio>=((null==e?void 0:e.intersectionRatio)||0)?t:e),null),r&&r.isIntersecting){const e=r.target.getAttribute("data-category");e!==this.model.get("current_category")&&(this.parentElement.preserve_scroll=!0,Up.safeSave(this.model,{current_category:e}))}}insertEmoji(e){e.preventDefault(),e.stopPropagation();const t=e.target,n="IMG"===t.nodeName?t.parentElement:t;this.parentElement.selectEmoji(n.getAttribute("data-emoji"))}shouldBeHidden(e){if(e.includes("_tone")){if(!this.current_skintone||!e.includes(this.current_skintone))return!0}else if(this.current_skintone&&zN().includes(e))return!0;return!(!this.query||dT(e,this.query))}constructor(){super(),this.model=null,this.current_skintone=null,this.query=null,this.search_results=null}});const{CHATROOMS_TYPE:lP}=Xx,{initStorage:uP}=Up;Wu.elements.define("converse-emoji-dropdown",class extends jO{static get properties(){return{icon_classes:{type:String},items:{type:Array},model:{type:Object}}}initModel(){return this.init_promise||(this.init_promise=(()=>cP((function*(){yield Wu.emojis.initialize();const e=`converse.emoji-${Ao.session.get("bare_jid")}-${this.model.get("jid")}`;this.state=new yg({id:e}),uP(this.state,e),yield new Promise((e=>this.state.fetch({success:e,error:e}))),this.state.set({autocompleting:null,ac_position:null})})).call(this))()),this.init_promise}render(){const e=this.model.get("type")===lP?"--muc-color":"--chat-color";return mf`<button class="btn dropdown-toggle dropdown-toggle--no-caret toggle-emojis" type="button" id="${this.id}" title="${aA("Insert emojis")}" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><converse-icon color="var(${e})" class="fa fa-smile" path-prefix="${Wu.settings.get("assets_path")}" size="1em"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}"><li>${NA(this.initModel().then((()=>mf`<converse-emoji-picker .state="${this.state}" .model="${this.model}" @emojiSelected="${()=>this.dropdown.hide()}" ?render_emojis="${this.render_emojis}" current_category="${this.state.get("current_category")||""}" current_skintone="${this.state.get("current_skintone")||""}" query="${this.state.get("query")||""}"></converse-emoji-picker>`)),"")}</li></ul>`}connectedCallback(){super.connectedCallback(),this.render_emojis=!1}onShown(){return cP((function*(){yield this.initModel(),this.render_emojis||(this.render_emojis=!0,this.requestUpdate(),yield this.updateComplete),setTimeout((()=>{var e;return null===(e=this.querySelector(".emoji-search"))||void 0===e?void 0:e.focus()}))})).call(this)}constructor(){super(),this.id=Up.getUniqueId(),this.render_emojis=!1,this.state=null,this.model=null,this.addEventListener("shown.bs.dropdown",(()=>this.onShown()))}});var dP=n(9440),hP={};hP.styleTagTransform=D(),hP.setAttributes=N(),hP.insert=k().bind(null,"head"),hP.domAPI=O(),hP.insertStyleElement=I();$()(dP.A,hP);dP.A&&dP.A.locals&&dP.A.locals;function fP(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}const{KEYCODES:pP}=Xx;var mP=new WeakSet;function gP(e){this.navigator&&Up.isVisible(this)&&(e.key===pP.ENTER?this.onEnterPressed(e):e.key!==pP.DOWN_ARROW||this.navigator.enabled||this.enableArrowNavigation(e))}Wu.elements.define("converse-emoji-picker",class extends uA{static get properties(){return{current_category:{type:String,reflect:!0},current_skintone:{type:String,reflect:!0},model:{type:Object},query:{type:String,reflect:!0},state:{type:Object},render_emojis:{type:Boolean}}}initialize(){super.initialize(),this.dropdown=this.closest("converse-emoji-dropdown")}firstUpdated(e){super.firstUpdated(e),this.listenTo(this.state,"change",(e=>this.onModelChanged(e.changed))),this.initArrowNavigation()}get search_results(){return this._search_results}set search_results(e){this._search_results=e,this.requestUpdate()}render(){return sP(this,{current_category:this.current_category,current_skintone:this.current_skintone,onCategoryPicked:e=>this.chooseCategory(e),onSearchInputFocus:()=>this.disableArrowNavigation(),onSearchInputKeyDown:e=>this.onSearchInputKeyDown(e),onSkintonePicked:e=>this.chooseSkinTone(e),query:this.query,search_results:this.search_results,render_emojis:this.render_emojis,sn2Emoji:e=>Up.shortnamesToEmojis(this.getTonedShortname(e))})}updated(e){e.has("query")&&this.updateSearchResults(e),e.has("current_category")&&this.setScrollPosition()}onModelChanged(e){"current_category"in e&&(this.current_category=e.current_category),"current_skintone"in e&&(this.current_skintone=e.current_skintone),"query"in e&&(this.query=e.query)}setScrollPosition(){if(this.preserve_scroll)return void(this.preserve_scroll=!1);const e=this.querySelector(".emoji-lists__container--browse"),t=this.querySelector(`#emoji-picker-${this.current_category}`);t instanceof HTMLElement&&(e.scrollTop=t.offsetTop-3*t.offsetHeight+4)}updateSearchResults(e){const t=e.get("query"),n=dT;if(this.query){if(this.query===t)return this.search_results;t&&this.query.includes(t)?this.search_results=this.search_results.filter((e=>n(e.sn,this.query))):this.search_results=Hp.emojis.list.filter((e=>n(e.sn,this.query)))}else this.search_results.length&&(this.search_results=[])}registerEvents(){this.onKeyDown=e=>function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(this,mP,gP).call(this,e),this.dropdown.addEventListener("hide.bs.dropdown",(()=>this.onDropdownHide())),this.addEventListener("keydown",this.onKeyDown)}connectedCallback(){super.connectedCallback(),this.registerEvents()}disconnectedCallback(){this.removeEventListener("keydown",this.onKeyDown),this.disableArrowNavigation(),super.disconnectedCallback()}onDropdownHide(){this.disableArrowNavigation(),this.dispatchEvent(new CustomEvent("emojipickerblur",{bubbles:!0}))}setCategoryForElement(e){const t=this.current_category,n=(null==e?void 0:e.getAttribute("data-category"))||t;t!==n&&this.state.save({current_category:n})}selectEmoji(e){const t=this.state.get("autocompleting"),n=this.state.get("ac_position");this.state.set({autocompleting:null,query:"",ac_position:null}),this.disableArrowNavigation();const r={bubbles:!0,detail:{value:e,autocompleting:t,ac_position:n,jid:this.model.get("jid")}};this.dispatchEvent(new CustomEvent("emojiSelected",r))}chooseSkinTone(e){e.preventDefault(),e.stopPropagation();const t=e.target,n=("IMG"===t.nodeName?t.parentElement:t).getAttribute("data-skintone").trim();this.current_skintone===n?this.state.save({current_skintone:""}):this.state.save({current_skintone:n})}chooseCategory(e){var t;e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();const n=null!==(t=e.target)&&void 0!==t?t:e.relatedTarget,r=n.matches("li")?n:Up.ancestor(n,"li");this.setCategoryForElement(r),this.navigator.select(r),!this.navigator.enabled&&this.navigator.enable()}onSearchInputKeyDown(e){const t=e.target;if(e.key===pP.TAB)if(t.value){e.preventDefault();const n=Hp.emojis.shortnames.find((e=>dT(e,t.value)));n&&this.state.set({query:n})}else this.navigator.enabled||this.enableArrowNavigation(e);else e.key!==pP.DOWN_ARROW||this.navigator.enabled?e.key!==pP.ENTER&&e.key!==pP.DOWN_ARROW&&this.debouncedFilter(t):this.enableArrowNavigation(e)}onEnterPressed(e){e.preventDefault(),e.stopPropagation();const t=e.target;Hp.emojis.shortnames.includes(t.value)?this.selectEmoji(t.value):1===this.search_results.length?this.selectEmoji(this.search_results[0].sn):this.navigator.selected&&this.navigator.selected.matches(".insert-emoji")?this.selectEmoji(this.navigator.selected.getAttribute("data-emoji")):this.navigator.selected&&this.navigator.selected.matches(".emoji-category")&&this.chooseCategory(new MouseEvent("click",{relatedTarget:this.navigator.selected}))}getTonedShortname(e){return zN().includes(e)&&this.current_skintone?`${e.slice(0,e.length-1)}_${this.current_skintone}:`:e}initArrowNavigation(){if(!this.navigator){const e="li:not(.hidden):not(.emoji-skintone), .emoji-search",t={jump_to_picked:".emoji-category",jump_to_picked_selector:".emoji-category.picked",jump_to_picked_direction:wj.DIRECTION.down,picked_selector:".picked",scroll_container:this.querySelector(".emoji-picker__lists"),getSelector:t=>{if(t===wj.DIRECTION.down){const t=this.navigator.selected&&this.navigator.selected.getAttribute("data-category");return t?`ul[data-category="${t}"] li:not(.hidden):not(.emoji-skintone), .emoji-search`:e}return e},onSelected:e=>{e.matches(".insert-emoji")&&this.setCategoryForElement(e.parentElement),e.matches(".insert-emoji, .emoji-category")&&e.firstElementChild.focus(),e.matches(".emoji-search")&&e.focus()}};this.navigator=new wj(this,t)}}disableArrowNavigation(){var e;null===(e=this.navigator)||void 0===e||e.disable()}enableArrowNavigation(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.handleKeydown(e)}constructor(){super(),fP(this,mP),this.state=null,this.model=null,this.query="",this.render_emojis=null,this._search_results=[],this.debouncedFilter=Lo((e=>this.state.set({query:e.value})),250)}});Wu.elements.define("converse-message-limit-indicator",class extends uA{static get properties(){return{model:{type:Object},_draft_length:{state:!0}}}connectedCallback(){var e,t;super.connectedCallback(),this._draft_length=null!==(t=null===(e=this.model.get("draft"))||void 0===e?void 0:e.length)&&void 0!==t?t:0,this.listenTo(this.model,"change:draft",(()=>{var e,t;this._draft_length=null!==(t=null===(e=this.model.get("draft"))||void 0===e?void 0:e.length)&&void 0!==t?t:0})),this.listenTo(this.model,"event:keyup",(({ev:e})=>{const t=e.target;this._draft_length=t.value.length}))}render(){const e=Wu.settings.get("message_limit");return e?(e=>{const t=aA("Message characters remaining");return mf`<span class="message-limit ${e<1?"error":""}" title="${t}">${e}</span>`})(e-this._draft_length):""}constructor(){super(),this.model=null,this._draft_length=0}});const vP=e=>{const t=Wu.settings.get("message_limit");return mf`<span class="btn-group toolbar-buttons">${NA(e.getButtons(),"")}</span> <span>${t?mf`<converse-message-limit-indicator .model="${e.model}">`:""} ${e.show_send_button?function(){const e=aA("Send the message");return mf`<button type="submit" class="btn send-button" data-action="sendMessage" title="${e}"><converse-icon color="var(--background-color)" class="fa fa-paper-plane" size="1em"></converse-icon></button>`}():""}</span>`};var yP=n(5501),bP={};bP.styleTagTransform=D(),bP.setAttributes=N(),bP.insert=k().bind(null,"head"),bP.domAPI=O(),bP.insertStyleElement=I();$()(yP.A,bP);yP.A&&yP.A.locals&&yP.A.locals;const _P=Hp.env.Strophe;Wu.elements.define("converse-chat-toolbar",class extends uA{static get properties(){return{hidden_occupants:{type:Boolean},is_groupchat:{type:Boolean},message_limit:{type:Number},model:{type:Object},show_call_button:{type:Boolean},show_emoji_button:{type:Boolean},show_send_button:{type:Boolean},show_spoiler_button:{type:Boolean}}}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate()))}render(){return vP(this)}firstUpdated(){Wu.trigger("renderToolbar",this)}getButtons(){const e=[];if(this.show_emoji_button&&e.push(mf`<converse-emoji-dropdown .model="${this.model}"></converse-emoji-dropdown>`),this.show_call_button){const t=this.is_groupchat?"--muc-color":"--chat-color",n=aA("Start a call");e.push(mf`<button type="button" class="btn toggle-call" @click="${this.toggleCall}" title="${n}"><converse-icon color="var(${t})" class="fa fa-phone" size="1em"></converse-icon></button>`)}this.show_spoiler_button&&e.push(this.getSpoilerButton());const t=Ao.session.get("domain"),n=Wu.disco.supports(_P.NS.HTTPUPLOAD,t);return e.push(mf`${NA(n.then((e=>this.getHTTPUploadButton(!!e))),"")}`),Ao.api.hook("getToolbarButtons",this,e)}getHTTPUploadButton(e){if(e){const e=aA("Choose a file to send");return mf`<button type="button" class="btn" title="${e}" @click="${this.toggleFileUpload}"><converse-icon class="fa fa-paperclip" size="1em"></converse-icon></button> <input type="file" @change="${this.onFileSelection}" class="fileupload" multiple="" style="display:none">`}return""}getSpoilerButton(){var e;const t=this.model;if(!this.is_groupchat&&!(null===(e=t.presence)||void 0===e?void 0:e.resources.length))return;let n;n=t.get("composing_spoiler")?aA("Click to write as a normal (non-spoiler) message"):aA("Click to write your message as a spoiler");const r=this.is_groupchat?"--muc-color":"--chat-color",i=mf`<button type="button" class="btn toggle-compose-spoiler" title="${n}" @click="${this.toggleComposeSpoilerMessage}"><converse-icon color="var(${r})" class="fa ${t.get("composing_spoiler")?"fa-eye-slash":"fa-eye"}" size="1em"></converse-icon></button>`;if(this.is_groupchat)return i;{const e=t.get("jid"),n=Promise.all(t.presence.resources.map((t=>Wu.disco.supports(_P.NS.SPOILER,`${e}/${t.get("name")}`)))).then((e=>e.reduce(((e,t)=>e&&t),!0)));return mf`${NA(n.then((()=>i)),"")}`}}toggleFileUpload(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.querySelector(".fileupload").click()}onFileSelection(e){this.model.sendFiles(e.target.files)}toggleComposeSpoilerMessage(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.model.set("composing_spoiler",!this.model.get("composing_spoiler"))}toggleCall(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),Wu.trigger("callButtonClicked",{connection:Wu.connection.get(),model:this.model})}constructor(){super(),this.model=null,this.is_groupchat=null,this.hidden_occupants=!1,this.show_send_button=!1,this.show_spoiler_button=!1,this.show_call_button=!1,this.show_emoji_button=!1}});const{HEADLINES_TYPE:wP}=Xx;var SP=n(2995),xP={};xP.styleTagTransform=D(),xP.setAttributes=N(),xP.insert=k().bind(null,"head"),xP.domAPI=O(),xP.insertStyleElement=I();$()(SP.A,xP);SP.A&&SP.A.locals&&SP.A.locals;function AP(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function jP(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){AP(s,r,i,o,a,"next",e)}function a(e){AP(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:$P}=Hp.env;Wu.elements.define("converse-chat-heading",class extends uA{static get properties(){return{jid:{type:String}}}initialize(){var e;const{chatboxes:t}=Ao.state;this.model=t.get(this.jid),this.listenTo(this.model,"change:status",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.model.contact&&this.listenTo(this.model.contact,"destroy",(()=>this.requestUpdate())),null===(e=this.model.rosterContactAdded)||void 0===e||e.then((()=>{this.listenTo(this.model.contact,"change:nickname",(()=>this.requestUpdate())),this.requestUpdate()})),this.requestUpdate()}render(){return(e=>{var t,n;const{jid:r,status:i,type:s}=e.model.attributes,o=e.getHeadingButtons(),a=t=>e.showUserDetailsModal(t),c=aA("The User's Profile Image"),l=e.model.getDisplayName(),u=mf`<span title="${c}"><converse-avatar .model="${e.model.contact||e.model}" class="avatar chat-msg__avatar" name="${l}" nonce="${null===(n=e.model.contact)||void 0===n||null===(t=n.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="40" width="40"></converse-avatar></span>`;return mf`<div class="chatbox-title ${i?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${Ao.api.settings.get("singleton")?"":mf`<converse-controlbox-navback jid="${r}"></converse-controlbox-navback>`} ${s!==wP?mf`<a class="show-msg-author-modal" @click="${a}">${u}</a>`:""}<div class="chatbox-title__text" title="${r}" role="heading" aria-level="2">${s!==wP?mf`<a class="user show-msg-author-modal" @click="${a}">${l}</a>`:l}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${NA(IN(o),"")} ${NA(PN(o),"")}</div></div>${i?mf`<p class="chat-head__desc">${i}</p>`:""}`})(this)}showUserDetailsModal(e){var t;e.preventDefault(),(null===(t=this.model)||void 0===t?void 0:t.contact)instanceof Ao.exports.Profile?Wu.modal.show("converse-profile-modal",{model:this.model},e):Wu.modal.show("converse-user-details-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}getHeadingButtons(){return jP((function*(){const e=[{a_class:"show-user-details-modal",handler:e=>this.showUserDetailsModal(e),i18n_text:aA("Details"),i18n_title:aA("See more information about this person"),icon_class:"fa-id-card",name:"details",standalone:!1}],t=Ao.session.get("domain");if(t&&(yield Wu.disco.supports($P.NS.BLOCKING,t))){(yield Wu.blocklist.get()).get(this.model.get("jid"))?e.push({a_class:"unblock-user",handler:e=>jP((function*(){e.preventDefault();(yield Wu.confirm(aA("Unblock user"),[aA("Are you sure you want to unblock this user?")]))&&Wu.blocklist.remove(this.model.get("jid"))})).call(this),i18n_text:aA("Unblock this user"),i18n_title:aA("Allow this user to send you messages"),icon_class:"fa-check",name:"unblock",standalone:!1}):e.push({a_class:"block-user",handler:e=>jP((function*(){e.preventDefault();if(yield Wu.confirm(aA("Block user"),[aA("Are you sure you want to prevent %1$s from contacting you further?",this.model.getDisplayName())])){const e=this.model.get("jid");Wu.blocklist.add(e),Wu.contacts.remove(e,!0),this.model.close()}})).call(this),i18n_text:aA("Block this user"),i18n_title:aA("Prevent this user from sending you any further messages"),icon_class:"fa-trash",name:"block",standalone:!1})}Wu.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:aA("Close"),i18n_title:aA("Close and end this conversation"),icon_class:"fa-times",name:"close",standalone:"overlayed"===Wu.settings.get("view_mode")});const{chatboxviews:n}=Ao.state,r=n.get(this.getAttribute("jid"));return r?Ao.api.hook("getHeadingButtons",r,e):e})).call(this)}constructor(){super(),this.jid=null}});function EP(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function OP(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){EP(s,r,i,o,a,"next",e)}function a(e){EP(s,r,i,o,a,"throw",e)}o(void 0)}))}}function CP(e){return OP((function*(){(yield Wu.confirm(aA("Confirm"),aA("Are you sure you want to clear the messages from this conversation?")))&&(yield e.clearMessages())}))()}function kP(e){var t;if(!(null===(t=window.CSS)||void 0===t?void 0:t.supports("field-sizing","content")))if(e.target.value){const t=e.target.scrollHeight+"px";e.target.style.height!=t&&(e.target.style.height="auto",e.target.style.height=t)}else e.target.style=""}function TP(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function NP(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){TP(s,r,i,o,a,"next",e)}function a(e){TP(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{ACTIVE:MP,COMPOSING:IP}=Xx;class PP extends uA{static get properties(){return{model:{type:Object}}}initialize(){return NP((function*(){yield this.model.initialized,this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate())),this.listenTo(this.model,"change:draft",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>{if(this.model.get("hidden")){var e,t;const n=null===(e=this.querySelector(".spoiler-hint"))||void 0===e?void 0:e.value,r=null===(t=this.querySelector(".chat-textarea"))||void 0===t?void 0:t.value;Up.safeSave(this.model,{draft:r,draft_hint:n})}})),this.handleEmojiSelection=({detail:e})=>{this.model.get("jid")===e.jid&&this.insertIntoTextArea(e.value,e.autocompleting,e.ac_position)},document.addEventListener("emojiSelected",this.handleEmojiSelection),this.requestUpdate()})).call(this)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("emojiSelected",this.handleEmojiSelection)}render(){return(e=>{const t=e.model.get("composing_spoiler"),n=aA(t?"Hidden message":"Message"),r=aA("Optional hint"),i=Wu.settings.get("message_limit"),s=Wu.settings.get("visible_toolbar_buttons").call,o=Wu.settings.get("visible_toolbar_buttons").emoji,a=Wu.settings.get("show_send_button"),c=Wu.settings.get("visible_toolbar_buttons").spoiler,l=Wu.settings.get("show_toolbar");var u,d;return mf`<form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?mf`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?composing_spoiler="${t}" ?show_call_button="${s}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" enterkeyhint="send" placeholder="${r||""}" .value="${null!==(u=e.model.get("draft_hint"))&&void 0!==u?u:""}" @change="${t=>Up.safeSave(e.model,{draft_hint:t.target.value})}" class="${t?"":"hidden"} spoiler-hint"> <textarea autofocus type="text" enterkeyhint="send" .value="${null!==(d=e.model.get("draft"))&&void 0!==d?d:""}" @drop="${t=>e.onDrop(t)}" @input="${kP}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>Up.safeSave(e.model,{draft:t.target.value})}" class="chat-textarea ${e.model.get("correcting")?"correcting":""} ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${n}"></textarea></form>`})(this)}insertIntoTextArea(e,t=!1,n,r=" "){const i=this.querySelector(".chat-textarea");if(t)i.value=n&&"string"==typeof t?i.value.replace(new RegExp(t,"g"),((i,s)=>s==n-t.length?e+r:i)):e;else{let t=i.value;t&&t[t.length-1]!==r&&(t+=r),i.value=t+e+r}const s=new Event("change",{bubbles:!1,cancelable:!0});i.dispatchEvent(s),Up.placeCaretAtEnd(i)}onEscapePressed(e){const t=this.model.messages.findLastIndex("correcting"),n=t>=0?this.model.messages.at(t):null;n&&(e.preventDefault(),n.save("correcting",!1))}onPaste(e){if(0!==e.clipboardData.files.length)return e.stopPropagation(),e.preventDefault(),void this.model.sendFiles(Array.from(e.clipboardData.files));const t=this.querySelector(".chat-textarea");if(!t)return void Q.error("onPaste: could not find textarea to paste in to!");var n;e.preventDefault(),e.stopPropagation();const r=null!==(n=t.value)&&void 0!==n?n:"",i=e.clipboardData.getData("text/plain"),s=t.selectionStart,o=r.substring(0,s),a=r.substring(t.selectionEnd),c=o.endsWith(" ")||0===o.length?"":" ",l=a.startsWith(" ")||0===a.length?"":" ";this.model.save({draft:`${o}${c}${i}${l}${a}`});const u=o.length+c.length+i.length+l.length;setTimeout((()=>t.setSelectionRange(u,u)),0)}onDrop(e){0!=e.dataTransfer.files.length&&(e.preventDefault(),this.model.sendFiles(e.dataTransfer.files))}onKeyUp(e){this.model.trigger("event:keyup",{ev:e})}onKeyDown(e){const{keycodes:t}=Hp;if(!(e.ctrlKey||e.shiftKey&&e.key===t.ENTER||[t.SHIFT,t.META,t.ESCAPE,t.ALT].includes(e.key))){if(!e.shiftKey&&!e.altKey&&!e.metaKey){const t=e.target;if(e.key===Hp.keycodes.TAB){const n=Up.getCurrentWord(t,null,/(:.*?:)/g);n.startsWith(":")&&(e.preventDefault(),e.stopPropagation(),this.model.trigger("emoji-picker-autocomplete",{target:t,value:n}))}else{if(e.key===Hp.keycodes.FORWARD_SLASH)return;if(e.key===Hp.keycodes.ESCAPE)return this.onEscapePressed(e);if(e.key===Hp.keycodes.ENTER)return this.onFormSubmitted(e);if(e.key!==Hp.keycodes.UP_ARROW||t.selectionEnd){if(e.key===Hp.keycodes.DOWN_ARROW&&t.selectionEnd===t.value.length&&this.model.get("correcting"))return this.model.editLaterMessage()}else{if(!this.querySelector(".chat-textarea").value||this.model.get("correcting"))return this.model.editEarlierMessage()}}}this.model.get("chat_state")!==IP&&this.model.setChatState(IP)}}onFormSubmitted(e){return NP((function*(){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const{chatboxviews:r}=Ao.state,i=this.querySelector(".chat-textarea"),s=i.value.trim();if(Wu.settings.get("message_limit")&&s.length>Wu.settings.get("message_limit")||!s.replace(/\s/g,"").length)return;if(!Wu.connection.get().authenticated){const e=aA("Sorry, the connection has been lost, and your message could not be sent");return Wu.alert("error",aA("Error"),e),void Wu.connection.reconnect()}let o,a={};this.model.get("composing_spoiler")&&(a=this.querySelector("form.chat-message-form input.spoiler-hint"),o=a.value),Up.addClass("disabled",i),i.setAttribute("disabled","disabled"),null===(n=this.querySelector("converse-emoji-dropdown"))||void 0===n||n.dropdown.hide();const c=yield function(e,t){return OP((function*(){const n=t.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(n){let i=!1;if(i=yield Wu.hook("parseMessageForCommands",{model:e,text:t},i),i)return!0;if("clear"===n[1])return CP(e),!0;if("close"===n[1]){var r;const{chatboxviews:t}=Ao.state;return null===(r=t.get(e.get("jid")))||void 0===r||r.close(),!0}if("help"===n[1])return e.set({show_help_messages:!1},{silent:!0}),e.set({show_help_messages:!0}),!0}return!1}))()}(this.model,s),l=c?null:yield this.model.sendMessage({body:s,spoiler_hint:o});if((c||l)&&(a.value="",i.value="",i.style.height="auto",this.model.save({draft:""})),"overlayed"===Wu.settings.get("view_mode")){r.get(this.model.get("jid")).querySelector(".chat-content__messages").parentElement.style.display="none"}if(i.removeAttribute("disabled"),Up.removeClass("disabled",i),"overlayed"===Wu.settings.get("view_mode")){r.get(this.model.get("jid")).querySelector(".chat-content__messages").parentElement.style.display=""}this.model.setChatState(MP,{silent:!0}),i.focus()})).call(this)}constructor(){super(),this.model=null}}Wu.elements.define("converse-message-form",PP);var DP=n(1089),RP={};RP.styleTagTransform=D(),RP.setAttributes=N(),RP.insert=k().bind(null,"head"),RP.domAPI=O(),RP.insertStyleElement=I();$()(DP.A,RP);DP.A&&DP.A.locals&&DP.A.locals;function zP(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function LP(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){zP(s,r,i,o,a,"next",e)}function a(e){zP(s,r,i,o,a,"throw",e)}o(void 0)}))}}class UP extends uA{static get properties(){return{model:{type:Object}}}connectedCallback(){var e=this,t=()=>super.connectedCallback;return LP((function*(){t().call(e),yield this.initialize(),this.requestUpdate()})).call(this)}initialize(){return LP((function*(){yield this.model.initialized,this.listenTo(this.model,"change:num_unread",(()=>this.requestUpdate())),this.listenTo(this.model,"emoji-picker-autocomplete",this.autocompleteInPicker),this.addEventListener("emojipickerblur",(()=>this.querySelector(".chat-textarea").focus()))})).call(this)}render(){return this.model?(e=>{const t=aA("You have unread messages");return mf`${e.model.ui.get("scrolled")&&e.model.get("num_unread")?mf`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""}<converse-message-form .model="${e.model}"></converse-message-form>`})({model:this.model,viewUnreadMessages:e=>this.viewUnreadMessages(e)}):""}viewUnreadMessages(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.ui.set({scrolled:!1})}onDragOver(e){e.preventDefault()}clearMessages(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),CP(this.model)}autocompleteInPicker(e){return LP((function*(){const{target:t,value:n}=e;yield Wu.emojis.initialize();const r=this.querySelector("converse-emoji-picker");if(r){r.state.set({ac_position:t.selectionStart,autocompleting:n,query:n});const e=this.querySelector("converse-emoji-dropdown");null==e||e.dropdown.show()}})).call(this)}constructor(){super(),this.model=null}}Wu.elements.define("converse-chat-bottom-panel",UP);const{CHATROOMS_TYPE:BP,INACTIVE:FP}=Xx;class qP extends uA{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.viewportMediaQuery.addEventListener("change",this.renderOnViewportChange)}disconnectedCallback(){super.disconnectedCallback(),Ao.state.chatboxviews.remove(this.jid,this),this.viewportMediaQuery.removeEventListener("change",this.renderOnViewportChange)}updated(){this.model&&this.jid!==this.model.get("jid")&&(this.stopListening(),Ao.state.chatboxviews.remove(this.model.get("jid"),this),delete this.model,this.requestUpdate(),this.initialize())}close(e){var t,n;return null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null===(n=this.model)||void 0===n?void 0:n.close(e)}maybeFocus(){Wu.settings.get("auto_focus")&&this.focus()}focus(){const e=this.getElementsByClassName("chat-textarea")[0];return e&&document.activeElement!==e&&e.focus(),this}getBottomPanel(){return this.model.get("type")===BP?this.querySelector("converse-muc-bottom-panel"):this.querySelector("converse-chat-bottom-panel")}getMessageForm(){return this.model.get("type")===BP?this.querySelector("converse-muc-message-form"):this.querySelector("converse-message-form")}scrollDown(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.model.ui.get("scrolled")&&this.model.ui.set({scrolled:!1}),DN(this.model)}onWindowStateChanged(){document.hidden?this.model.setChatState(FP,{silent:!0}):this.model.isHidden()||this.model.clearUnreadMsgCounter()}constructor(){super(),this.jid=null,this.model=null,this.viewportMediaQuery=window.matchMedia("(max-width: 768px)"),this.renderOnViewportChange=()=>this.requestUpdate()}}const{CHATROOMS_TYPE:HP}=Xx;function GP(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{ACTIVE:WP}=Xx;class VP extends qP{initialize(){return(e=function*(){const{chatboxviews:e,chatboxes:t}=Ao.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>!this.model.get("hidden")&&this.afterShown())),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),yield this.model.messages.fetched,!this.model.get("hidden")&&this.afterShown(),Wu.trigger("chatBoxViewInitialized",this)},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){GP(s,r,i,o,a,"next",e)}function a(e){GP(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){return(e=>{const t=e.getHelpMessages(),n=e.model.get("show_help_messages"),r="overlayed"===Wu.settings.get("view_mode"),i=NN(e.model);return mf`<div class="flyout box-flyout" style="${i||yf}">${r?mf`<converse-dragresize></converse-dragresize>`:""} ${e.model?mf`<converse-chat-heading jid="${e.model.get("jid")}" class="chat-head chat-head-chatbox row g-0"></converse-chat-heading><div class="chat-body"><div class="chat-content ${e.model.get("show_send_button")?"chat-content-sendbutton":""}" aria-live="polite"><converse-chat-content .model="${e.model}"></converse-chat-content>${n?mf`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${t}" ?hidden="${!n}" type="info" chat_type="${HP}"></converse-chat-help></div>`:""}</div><converse-chat-bottom-panel .model="${e.model}" class="bottom-panel"></converse-chat-bottom-panel></div>`:""}</div>`})(this)}getHelpMessages(){return[`<strong>/clear</strong>: ${aA("Remove messages")}`,`<strong>/close</strong>: ${aA("Close this chat")}`,`<strong>/me</strong>: ${aA("Write in the third person")}`,`<strong>/help</strong>: ${aA("Show this menu")}`]}afterShown(){this.model.setChatState(WP),this.model.clearUnreadMsgCounter(),this.maybeFocus()}constructor(...e){super(...e),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"length",200)}}Wu.elements.define("converse-chat",VP);var KP=n(2852),JP={};JP.styleTagTransform=D(),JP.setAttributes=N(),JP.insert=k().bind(null,"head"),JP.domAPI=O(),JP.insertStyleElement=I();$()(KP.A,JP);KP.A&&KP.A.locals&&KP.A.locals;const{Strophe:YP}=Hp.env;Hp.plugins.add("converse-chatview",{dependencies:["converse-chatboxviews","converse-chat","converse-disco","converse-modal"],initialize(){Wu.settings.extend({fetch_url_headers:!1,allowed_audio_domains:null,allowed_image_domains:null,allowed_video_domains:null,auto_focus:!0,debounced_content_rendering:!0,filter_url_query_params:null,image_urls_regex:null,message_limit:0,muc_hats:["xep317"],render_media:!0,show_message_avatar:!0,show_retraction_warning:!0,show_send_button:!0,show_toolbar:!0,time_format:"HH:mm",use_system_emojis:!0,visible_toolbar_buttons:{call:!1,clear:!0,emoji:!0,spoiler:!1}});const e={ChatBoxView:VP,ChatView:VP};Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.listen.on("connected",(()=>Wu.disco.own.features.add(YP.NS.SPOILER))),Wu.listen.on("chatBoxClosed",(e=>{return t=e.get("jid"),void(location.hash===`converse/chat?jid=${t}`&&history.pushState(null,"",window.location.pathname));var t}))}});const{Strophe:XP,u:QP}=Hp.env;function ZP(){var e;const t=Ao.state.chatboxes.add(new Ao.exports.ControlBox({id:"controlbox"}));return null===(e=Ao.state.chatboxviews.get("controlbox"))||void 0===e||e.setModel(),t}function eD(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=Ao.state.chatboxes.get("controlbox")||ZP();QP.safeSave(n,{closed:!1})}function tD(){var e;const t=null===(e=Ao.state.chatboxes)||void 0===e?void 0:e.get("controlbox");t&&QP.safeSave(t,{connected:!1})}function nD(){const{chatboxviews:e}=Ao.state,t=null==e?void 0:e.get("controlbox");t&&(QP.safeSave(t.model,{connected:!1}),(null==t?void 0:t.controlbox_pane)&&(t.controlbox_pane.remove(),delete t.controlbox_pane))}function rD(){(Ao.state.chatboxes.get("controlbox")||ZP()).save({connected:!0})}const{Strophe:iD}=Hp.env,sD=Object.fromEntries([[iD.Status.ERROR,"danger"],[iD.Status.CONNECTING,"info"],[iD.Status.CONNFAIL,"danger"],[iD.Status.AUTHENTICATING,"info"],[iD.Status.AUTHFAIL,"danger"],[iD.Status.CONNECTED,"info"],[iD.Status.DISCONNECTED,"danger"],[iD.Status.DISCONNECTING,"warning"],[iD.Status.ATTACHED,"info"],[iD.Status.REDIRECT,"info"],[iD.Status.RECONNECTING,"warning"]]);Wu.elements.define("converse-footer",class extends uA{render(){const e="fullscreen"===Wu.settings.get("view_mode"),t=Wu.settings.get("theme"),n=["dracula","cyberpunk"].includes(t),r=aA("A big thank you to our sponsors 🙏");return mf`${e?mf`<footer class="footer mt-auto py-3 pb-3"><div class="container"><div class="row"><div class="col-12 text-center"><p class="brand-subtitle mb-2 subdued">Version: ${Ao.VERSION_NAME}</p><p class="brand-subtitle mb-4"><a target="_blank" rel="nofollow" href="https://github.com/conversejs/converse.js">Open Source</a> XMPP chat client brought to you by <a target="_blank" rel="nofollow" href="https://opkode.com/about">Opkode</a>.</p><div class="sponsors text-center"><p class="byline mb-1">${r}</p><div class="fs-6 d-flex flex-wrap justify-content-center align-items-center gap-4 mb-2"><div><a href="https://bairesdev.com/sponsoring-open-source-projects/?utm_source=conversejs" target="_blank" rel="noopener"><img style="width:13em" src="https://conversejs.org/media/logos/bairesdev-primary.png" alt="BairesDev"></a></div><div><a href="https://blokt.com?utm_source=conversejs" target="_blank" rel="noopener"><img style="width:12em" src="${n?"https://conversejs.org/media/logos/blokt-invert.png":"https://conversejs.org/media/logos/blokt.png"}" alt="Blokt Crypto & Privacy"></a></div><div><a href="https://www.keycdn.com?utm_source=conversejs" target="_blank" rel="noopener"><img style="height:3em" src="https://conversejs.org/logo/keycdn.png" alt="KeyCDN"></a></div></div></div><p class="brand-subtitle mb-3">If you'd like to sponsor this project, please visit: <a href="https://github.com/sponsors/jcbrand" target="_blank" rel="noopener">Github</a>, <a href="https://www.patreon.com/jcbrand" target="_blank" rel="noopener">Patreon</a>, <a href="https://liberapay.com/jcbrand" target="_blank" rel="noopener">Liberapay</a> or <a href="https://opkode.com/contact.html" target="_blank" rel="noopener">contact us</a>.</p></div></div></div></footer>`:""}`}});const{ANONYMOUS:oD,EXTERNAL:aD,LOGIN:cD,PREBIND:lD,CONNECTION_STATUS:uD}=Xx;function dD(){const e=aA("Connection URL"),t=aA("HTTP or websocket URL that is used to connect to your XMPP server"),n=aA("e.g. wss://example.org/xmpp-websocket");return mf`<div class="mb-3 fade-in"><label for="converse-conn-url" class="form-label">${e}</label><p class="form-help instructions">${t}</p><input required id="converse-conn-url" class="form-control" type="url" name="connection-url" placeholder="${n}"></div>`}function hD(){const e=Wu.settings.get("authentication"),t=aA("Log in"),n=aA("XMPP Address"),r=Wu.settings.get("locked_domain"),i=Wu.settings.get("default_domain"),s=(r||i)&&aA("Username")||aA("user@domain"),o=Wu.settings.get("allow_user_trust_override");var a,c;return mf`<div class="mb-3"><label for="converse-login-jid" class="form-label">${n}:</label><div class="${r?"input-group":""}"><input id="converse-login-jid" ?autofocus="${!!Wu.settings.get("auto_focus")}" value="${null!==(a=Wu.settings.get("jid"))&&void 0!==a?a:""}" required class="form-control" type="text" name="jid" placeholder="${s}"> ${r?(c=r,mf`<span class="input-group-text addon" id="basic-addon2">@${c}</span>`):""}</div></div>${e!==aD?function(){const e=aA("Password");var t;return mf`<div class="mb-3"><label for="converse-login-password" class="form-label">${e}</label> <input id="converse-login-password" class="form-control" required="required" value="${null!==(t=Wu.settings.get("password"))&&void 0!==t?t:""}" type="password" name="password" placeholder="${e}"></div>`}():""} ${Wu.settings.get("show_connection_url_input")?dD():""} ${o?function(e){const t=aA("To improve performance, we cache your data in this browser. Uncheck this box if this is a public computer or if you want your data to be deleted when you log out. It's important that you explicitly log out, otherwise not all cached data might be deleted. Please note, when using an untrusted device, OMEMO encryption is NOT available."),n=aA("This is a trusted device");return mf`<div class="form-check mb-2 login-trusted"><input id="converse-login-trusted" type="checkbox" class="form-check-input" name="trusted" ?checked="${e}"> <label for="converse-login-trusted" class="form-check-label login-trusted__desc">${n}</label><converse-popover title="${aA("Info")}" text="${t}"></converse-popover></div>`}("off"!==o):""}<div class="text-center mb-3"><button class="btn btn-primary px-5 mx-auto" type="submit">${t}</button></div><converse-register-link></converse-register-link>`}const fD=e=>{const{connfeedback:t}=Ao.state,n=t.get("connection_status");var r;const i=null!==(r=null==sD?void 0:sD[n])&&void 0!==r?r:"none",s=t.get("message");return mf`<form id="converse-login" class="converse-form" method="post" @submit="${e.onLoginFormSubmitted}"><div class="alert ${`alert-${i}`} conn-feedback mb-3 ${s?"":"d-none"}" role="alert"><span class="feedback-message">${s}</span></div>${["CONNECTED","CONNECTING","AUTHENTICATING","RECONNECTING"].includes(uD[n])?mf`<div class="text-center my-3">${BO()}</div>`:function(){const e=Wu.settings.get("authentication"),t=aA("Disconnected"),n=aA("Click here to log in anonymously");return mf`${e==cD||e==aD?hD():""} ${e==oD?mf`<div class="text-center mb-3"><button class="btn btn-primary login-anon px-5 mx-auto" type="submit">${n}</button></div>`:""} ${e==lD?mf`<p class="alert alert-warning">${t}</p>`:""}`}()}</form>`};var pD=n(5832),mD={};mD.styleTagTransform=D(),mD.setAttributes=N(),mD.insert=k().bind(null,"head"),mD.domAPI=O(),mD.insertStyleElement=I();$()(pD.A,mD);pD.A&&pD.A.locals&&pD.A.locals;function gD(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:vD}=Hp.env,{ANONYMOUS:yD}=Xx;class bD extends uA{initialize(){const e=Wu.settings.get();this.listenTo(e,"change:show_connection_url_input",(()=>this.requestUpdate())),this.listenTo(Ao.state.connfeedback,"change",(()=>this.requestUpdate())),this.handler=()=>this.requestUpdate()}connectedCallback(){super.connectedCallback(),Wu.settings.listen.on("change",this.handler)}disconnectedCallback(){super.disconnectedCallback(),Wu.settings.listen.not("change",this.handler)}render(){return fD(this)}onLoginFormSubmitted(e){return(t=function*(){if(null==e||e.preventDefault(),Wu.settings.get("authentication")===yD){const e=Ao.session.get("jid");return this.connect(e)}const t=e.target;(function(e){const t=e.querySelector("input[name=jid]");return!t.value||Wu.settings.get("locked_domain")||Wu.settings.get("default_domain")||QP.isValidJID(t.value)?(t.setCustomValidity(""),!0):(t.setCustomValidity(aA("Please enter a valid XMPP address")),!1)})(t)&&(function(e,t={}){const n=new FormData(e),r=n.get("connection-url");(null==r?void 0:r.startsWith("ws"))?t.websocket_url=r:(null==r?void 0:r.startsWith("http"))&&(t.bosh_service_url=r);let i=n.get("jid");if(Wu.settings.get("locked_domain")){const e="@"+Wu.settings.get("locked_domain");i.endsWith(e)&&(i=i.substr(0,i.length-e.length)),i=XP.escapeNode(i)+e}else Wu.settings.get("default_domain")&&!i.includes("@")&&(i=i+"@"+Wu.settings.get("default_domain"));t.jid=i,t.password=n.get("password"),Wu.settings.set(t),Ao.state.config.save({trusted:!!n.get("trusted")})}(t),Wu.settings.get("bosh_service_url")||Wu.settings.get("websocket_url")||(yield this.discoverConnectionMethods(t)),Wu.settings.get("bosh_service_url")||Wu.settings.get("websocket_url")?this.connect():Wu.settings.set("show_connection_url_input",!0))},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){gD(s,r,i,o,a,"next",e)}function a(e){gD(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}discoverConnectionMethods(e){if(!Wu.settings.get("discover_connection_methods"))return;const t=new FormData(e).get("jid");if(t instanceof File)throw new Error('Found file instead of string for "jid" field in form');const n=vD.getDomainFromJid(t);return Wu.connection.init(t),Wu.connection.get().discoverConnectionMethods(n)}connect(e){var t;["converse/login","converse/register"].includes(location.hash)&&history.pushState(null,"",window.location.pathname),null===(t=Wu.connection.get())||void 0===t||t.reset(),Wu.user.login(e)}}Wu.elements.define("converse-login-form",bD);const _D=bD,{dayjs:wD}=Hp.env,{CONTROLBOX_TYPE:SD}=Xx;class xD extends ae.Model{defaults(){return{bookmarked:!1,box_id:"controlbox",chat_state:void 0,closed:!Wu.settings.get("show_controlbox_by_default"),num_unread:0,time_opened:wD(0).valueOf(),type:SD,url:""}}validate(e){return e.type===SD?"embedded"===Wu.settings.get("view_mode")&&Wu.settings.get("singleton")?"Controlbox not relevant in embedded view mode":void 0:Ao.state.ChatBox.prototype.validate.call(this,e)}maybeShow(e){return e||"controlbox"!==this.get("id")?Ao.state.ChatBox.prototype.maybeShow.call(this,e):this}onReconnection(){this.save("connected",!0)}}const AD=xD;function jD(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}class $D extends uA{connectedCallback(){var e,t=this,n=()=>super.connectedCallback;return(e=function*(){n().call(t),yield Wu.waitUntil("initialized");const{chatboxes:e}=Ao.state;this.model=e.get("controlbox"),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){jD(s,r,i,o,a,"next",e)}function a(e){jD(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}render(){return mf`<button type="button" class="btn toggle-controlbox ${(null===(e=this.model)||void 0===e?void 0:e.get("closed"))?"":"hidden"}" @click="${e=>eD(e)}"><span class="toggle-feedback">${aA("Chat")}</span></button>`;var e}}Wu.elements.define("converse-controlbox-toggle",$D);const ED=$D,{Strophe:OD}=Hp.env,{ANONYMOUS:CD}=Xx;const kD=e=>{const t=NN(e.model);return mf`<div class="flyout box-flyout" style="${t||yf}"><converse-dragresize></converse-dragresize>${e.model.get("connected")?mf`<converse-user-profile></converse-user-profile><div class="controlbox-pane"><converse-headlines-feeds-list class="controlbox-section"></converse-headlines-feeds-list><div id="chatrooms" class="controlbox-section"><converse-rooms-list></converse-rooms-list></div>${Wu.settings.get("authentication")===CD?"":mf`<div id="converse-roster" class="controlbox-section"><converse-roster></div>`}</div>`:function(e){const t="fullscreen"===Wu.settings.get("view_mode"),n=Ao.state.connfeedback.get("connection_status"),r=[OD.Status.RECONNECTING,OD.Status.CONNECTING].includes(n),i=Wu.settings.get("view_mode"),s=Wu.settings.get("show_background");return mf`${s&&"fullscreen"===i?mf`<converse-bg></converse-bg>`:""}<converse-controlbox-buttons class="controlbox-padded"></converse-controlbox-buttons><div class="controlbox-pane d-flex flex-column justify-content-between">${t?mf`<converse-controlbox-navbar></converse-controlbox-navbar>`:""}<converse-brand-logo></converse-brand-logo>${r?mf`<converse-spinner class="vertically-centered fade-in"></converse-spinner>`:"register"===e.model.get("active-form")?mf`<converse-registration-form class="fade-in rounded"></converse-registration-form>`:mf`<converse-login-form class="fade-in rounded"></converse-login-form>`} ${t?mf`<converse-footer></converse-footer>`:""}</div>`}(e)}</div>`};Wu.elements.define("converse-about-modal",class extends ak{getModalTitle(){return aA("About Converse")}renderModal(){return mf`<p>Converse is an open-source <a href="https://xmpp.org" target="_blank" rel="noopener">XMPP</a> chat app written in JavaScript.</p><p>Just like the XMPP protocol, Converse is built with extensibility in mind.</p><p>Because it is open source, integrators and developers can use it to add chat functionality to their websites.</p><p>Converse is also <a href="https://conversejs.org/docs/html/configuration.html" target="_blank" rel="noopener">configurable</a>, built with modern web technologies and <a href="https://conversejs.org/docs/html/plugin_development.html" target="_blank" rel="noopener">extensible with plugins</a>. It has different modes, which means it can be a full page app, an embedded chat widget, or an overlayed chat box. For a list of supported features and XMPP extensions, please see the <a href="https://github.com/conversejs/converse.js?tab=readme-ov-file#features" target="_blank" rel="noopener">README</a>.</p><p>Converse is translated into over 30 languages. You can <a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">translate</a> it into your own language.</p><p>Converse was created by <a target="_blank" rel="nofollow" href="https://opkode.com">JC Brand</a>. You can <a target="_blank" rel="nofollow" href="https://opkode.com/contact.html">hire me</a> for customizations, support or to build your next project.</p><p>If you're interested in sponsoring Converse, please visit: <a href="https://github.com/sponsors/jcbrand" target="_blank" rel="noopener">Github</a>, <a href="https://www.patreon.com/jcbrand" target="_blank" rel="noopener">Patreon</a>, <a href="https://liberapay.com/jcbrand" target="_blank" rel="noopener">Liberapay</a> or <a href="https://opkode.com/contact.html" target="_blank" rel="noopener">contact us</a>.</p>`}});class TD extends uA{render(){return mf`<nav class="navbar navbar-expand-lg"><div class="container-fluid"><div class="collapse navbar-collapse"><ul class="navbar-nav ms-auto mb-2 mb-lg-0"><li class="nav-item"><a class="nav-link" href="#" @click="${this.openAboutDialog}">About</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://github.com/conversejs/converse.js">Github</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://conversejs.org/docs/html">Documentation</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://opkode.com/contact.html">Contact</a></li></ul></div></div></nav>`}openAboutDialog(e){e.preventDefault(),Wu.modal.show("converse-about-modal")}}Wu.elements.define("converse-controlbox-navbar",TD);const{LOGOUT:ND}=Xx;class MD extends uA{initialize(){this.setModel();const{chatboxviews:e}=Ao.state;e.add("controlbox",this),this.model.get("connected")&&void 0===this.model.get("closed")&&this.model.set("closed",!Wu.settings.get("show_controlbox_by_default")),this.viewportMediaQuery=window.matchMedia("(max-width: 768px)"),this.renderOnViewportChange=()=>this.requestUpdate(),Wu.trigger("controlBoxInitialized",this)}connectedCallback(){super.connectedCallback(),this.viewportMediaQuery.addEventListener("change",this.renderOnViewportChange)}disconnectedCallback(){super.disconnectedCallback(),Ao.state.chatboxviews.remove("controlbox",this),this.viewportMediaQuery.removeEventListener("change",this.renderOnViewportChange)}setModel(){this.model=Ao.state.chatboxes.get("controlbox"),this.listenTo(Ao.state.connfeedback,"change:connection_status",(()=>this.requestUpdate())),this.listenTo(this.model,"change:active-form",(()=>this.requestUpdate())),this.listenTo(this.model,"change:connected",(()=>this.requestUpdate())),this.requestUpdate()}render(){return"overlayed"===Wu.settings.get("view_mode")?this.model&&!this.model.get("closed")?kD(this):"":kD(this)}close(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=Wu.connection.get();if(("closeAllChatBoxes"!==(null==e?void 0:e.name)||n.disconnection_cause===ND&&!Wu.settings.get("show_controlbox_by_default"))&&!Wu.settings.get("sticky_controlbox")&&"overlayed"===Wu.settings.get("view_mode"))return Up.safeSave(this.model,{closed:!0}),Wu.trigger("controlBoxClosed",this),this}}Wu.elements.define("converse-controlbox",MD);const ID=MD;function PD(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{u:DD}=Hp.env,RD={controlbox:{open(){return(e=function*(){yield Wu.waitUntil("chatBoxesFetched");let e=yield Wu.chatboxes.get("controlbox");return e||(e=yield Wu.chatboxes.create("controlbox",{},AD)),DD.safeSave(e,{closed:!1}),e},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){PD(s,r,i,o,a,"next",e)}function a(e){PD(s,r,i,o,a,"throw",e)}o(void 0)}))})();var e},get:()=>Ao.state.chatboxviews.get("controlbox")}},zD=e=>mf`<converse-icon size="1em" class="fa fa-arrow-left" @click="${()=>function(e){eD();const t=Ao.state.chatboxes.get(e);QP.safeSave(t,{hidden:!0})}(e)}"></converse-icon>`;class LD extends uA{static get properties(){return{jid:{type:String}}}render(){return zD(this.jid)}constructor(){super(),this.jid=null}}Wu.elements.define("converse-controlbox-navback",LD);const UD=e=>{const t=e.model.get("connected"),n=Wu.settings.get("show_client_info")||Wu.settings.get("allow_adhoc_commands");return mf`<div class="btn-toolbar g-0" role="toolbar"><div class="btn-group" role="group">${t&&n?function(e){const t=aA("Show details about this chat client");return mf`<a class="controlbox-heading__btn show-client-info align-self-center" title="${t}" @click="${e.showUserSettingsModal}"><converse-icon class="fa fa-cog" size="1em"></converse-icon></a>`}(e):""} ${Wu.settings.get("sticky_controlbox")?"":function(e){return mf`<a class="controlbox-heading__btn close align-self-center" @click="${t=>e.closeControlBox(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></a>`}(e)}</div></div>`};var BD=n(7190),FD={};FD.styleTagTransform=D(),FD.setAttributes=N(),FD.insert=k().bind(null,"head"),FD.domAPI=O(),FD.insertStyleElement=I();$()(BD.A,FD);BD.A&&BD.A.locals&&BD.A.locals;class qD extends uA{initialize(){const{chatboxes:e}=Ao.state;this.model=e.get("controlbox")}render(){return UD(this)}showUserSettingsModal(e){null==e||e.preventDefault(),Wu.modal.show("converse-user-settings-modal",{model:Ao.state.xmppstatus,_converse:Ao},e)}closeControlBox(e){null==e||e.preventDefault();const t=Ao.state.chatboxviews.get("controlbox");null==t||t.close()}}Wu.elements.define("converse-controlbox-buttons",qD);var HD=n(6264),GD={};GD.styleTagTransform=D(),GD.setAttributes=N(),GD.insert=k().bind(null,"head"),GD.domAPI=O(),GD.insertStyleElement=I();$()(HD.A,GD);HD.A&&HD.A.locals&&HD.A.locals;const{CONTROLBOX_TYPE:WD}=Xx;Hp.plugins.add("converse-controlbox",{dependencies:["converse-modal","converse-chatboxes","converse-chat","converse-rosterview","converse-chatview"],enabled:e=>!e.api.settings.get("singleton"),initialize(){Wu.settings.extend({allow_logout:!0,allow_user_trust_override:!0,default_domain:void 0,locked_domain:void 0,show_connection_url_input:!1,show_controlbox_by_default:!1,sticky_controlbox:!1}),Wu.promises.add("controlBoxInitialized",!1),Object.assign(Wu,RD);const e={ControlBox:AD,ControlBoxView:ID,ControlBoxToggle:ED,LoginForm:_D};Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.chatboxes.registry.add(WD,AD),Wu.listen.on("chatBoxesFetched",rD),Wu.listen.on("clearSession",nD),Wu.listen.on("will-reconnect",tD),Wu.waitUntil("chatBoxViewsInitialized").then(ZP).catch((e=>Q.fatal(e)))}});var VD=n(5235),KD={};KD.styleTagTransform=D(),KD.setAttributes=N(),KD.insert=k().bind(null,"head"),KD.domAPI=O(),KD.insertStyleElement=I();$()(VD.A,KD);VD.A&&VD.A.locals&&VD.A.locals;function JD(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}class YD extends uA{static get properties(){return{_entity_jids:{type:Array,state:!0}}}render(){return(e=>{const t=e.getDiscoInfo(),n=e._entity_jids[e._entity_jids.length-1];return mf`<h4 class="mt-3 text-center">${aA("Discover Services")}</h4><form class="mt-2 mb-3" @submit="${t=>e.queryEntity(t)}"><div class="d-flex w-100"><converse-autocomplete .getAutoCompleteList="${dI}" class="w-100" min_chars="2" name="entity_jid" position="below" required value="${n}"></converse-autocomplete><button type="submit" class="btn btn-outline-secondary">${aA("Inspect")}</button></div></form><nav aria-label="breadcrumb"><ol class="breadcrumb"><li>${aA("Service")}: </li>${e._entity_jids.map(((t,n)=>mf`<li class="breadcrumb-item"><a href="#" @click="${t=>e.handleBreadcrumbClick(t,n)}">${t}</a></li>`))}</ol></nav>${NA(t.then((()=>"")),mf`<converse-spinner></converse-spinner>`)} ${NA(t.then((({error:e})=>e?mf`<div class="alert alert-danger" role="alert">${e}</div>`:"")),"")}<div class="container">${NA(t.then((({identities:e})=>(null==e?void 0:e.length)?mf`<h5 class="mt-3">${aA("Identities")}</h5><ul class="items-list identities">${e.map((e=>mf`<li class="list-item"><ul class="list-unstyled">${e.get("name")?mf`<li><strong>${aA("Name")}:</strong> ${e.get("name")}</li>`:""} ${e.get("type")?mf`<li><strong>${aA("Type")}:</strong> ${e.get("type")}</li>`:""} ${e.get("category")?mf`<li><strong>${aA("Category")}:</strong> ${e.get("category")}</li>`:""}</ul></li>`))}</ul>`:"")),"")} ${NA(t.then((({items:t})=>(null==t?void 0:t.length)?mf`<h5 class="mt-3">${aA("Items")}</h5><ul class="items-list disco-items">${t.map((t=>mf`<li class="list-item"><a @click="${n=>e.addEntityJID(n,t)}">${e.renderItem(t)}</a></li>`))}</ul>`:"")),"")} ${NA(t.then((({features:e})=>(null==e?void 0:e.length)?mf`<h5 class="mt-3">${aA("Features")}</h5><ul class="items-list features">${e.map((e=>mf`<li class="list-item">${e}</li>`))}</ul>`:"")),"")}</div>`})(this)}handleBreadcrumbClick(e,t){e.preventDefault(),this._entity_jids=[...this._entity_jids.slice(0,t+1)]}queryEntity(e){e.preventDefault();const t=e.target,n=new FormData(t);this._entity_jids=[n.get("entity_jid").trim()]}renderItem(e){return mf`${e.get("name")?`${e.get("name")} <${e.get("jid")}>`:`${e.get("jid")}`}`}addEntityJID(e,t){e.preventDefault(),this._entity_jids=[...this._entity_jids,t.get("jid")]}getDiscoInfo(){return(e=function*(){var e,t;const n=this._entity_jids[this._entity_jids.length-1],r=yield Wu.disco.entities.get(n,!0);yield r.waitUntilItemsFetched;const i=r.get("error");if(i)return["item-not-found","remote-server-not-found"].includes(i)?{error:aA("No service found with that XMPP address")}:{error:aA("Error: %1$s",i)};const s=(null===(e=r.features)||void 0===e?void 0:e.map((e=>e.get("var"))))||[],o=r.identities||[],a=r.get("items")||[],c=yield Promise.all(a.map((e=>Wu.disco.entities.get(e))));return{features:(null===(t=s.toSorted)||void 0===t?void 0:t.call(s))||s,identities:o,items:c}},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){JD(s,r,i,o,a,"next",e)}function a(e){JD(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}constructor(){super(),this._entity_jids=[Ao.session.get("domain")]}}Wu.elements.define("converse-disco-browser",YD);Hp.plugins.add("converse-disco-views",{dependencies:["converse-disco"],enabled:()=>!0,initialize(){}});function XD(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function QD(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Wu.elements.define("converse-headlines-heading",class extends uA{static get properties(){return{jid:{type:String}}}initialize(){return(e=function*(){this.model=Ao.state.chatboxes.get(this.jid),yield this.model.initialized,this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){XD(s,r,i,o,a,"next",e)}function a(e){XD(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){return(e=>mf`<div class="chatbox-title ${e.status?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${Ao.api.settings.get("singleton")?"":mf`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`}<div class="chatbox-title__text" title="${e.jid}">${e.display_name}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${NA(PN(e.heading_buttons_promise),"")} ${NA(IN(e.heading_buttons_promise),"")}</div></div>${e.status?mf`<p class="chat-head__desc">${e.status}</p>`:""}`)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){QD(e,t,n[t])}))}return e}({},this.model.toJSON(),{display_name:this.model.getDisplayName(),heading_buttons_promise:this.getHeadingButtons()}))}getHeadingButtons(){const e=[];return Wu.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:aA("Close"),i18n_title:aA("Close these announcements"),icon_class:"fa-times",name:"close",standalone:"overlayed"===Wu.settings.get("view_mode")}),Ao.api.hook("getHeadingButtons",this,e)}close(e){e.preventDefault(),this.model.close()}constructor(){super(),this.jid=null}});function ZD(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function eR(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){ZD(s,r,i,o,a,"next",e)}function a(e){ZD(s,r,i,o,a,"throw",e)}o(void 0)}))}}class tR extends qP{initialize(){return eR((function*(){const{chatboxviews:e,chatboxes:t}=Ao.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>this.afterShown())),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.messages,"add",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"remove",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"reset",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),yield this.model.messages.fetched,this.model.maybeShow(),Wu.trigger("headlinesBoxViewInitialized",this)})).call(this)}render(){return(e=>{const t=NN(e.model);return mf`<div class="flyout box-flyout" style="${t||yf}"><converse-dragresize></converse-dragresize>${e.model?mf`<converse-headlines-heading jid="${e.model.get("jid")}" class="chat-head chat-head-chatbox row g-0"></converse-headlines-heading><div class="chat-body"><div class="chat-content" aria-live="polite"><converse-chat-content .model="${e.model}"></converse-chat-content></div></div>`:""}</div>`})(this)}close(e){return eR((function*(){var t;return null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),location.hash==="converse/chat?jid="+this.model.get("jid")&&history.pushState(null,"",window.location.pathname),yield this.model.close(e),this})).call(this)}getNotifications(){return[]}afterShown(){this.model.clearUnreadMsgCounter()}}Wu.elements.define("converse-headlines",tR);const nR=tR,{HEADLINES_TYPE:rR}=Xx;const iR=e=>{const t=e.model.filter((e=>e.get("type")===rR)),n=aA("Announcements");return mf`<div class="controlbox-section" id="headline"><div class="d-flex controlbox-padded ${t.length?"":"hidden"}"><span class="w-100 controlbox-heading controlbox-heading--headline" role="heading" aria-level="3">${n}</span></div></div><div class="list-container list-container--headline ${t.length?"":"hidden"}"><div class="items-list rooms-list headline-list">${t.map((t=>function(e,t){const n=aA("Click to open this server message");return mf`<div class="list-item controlbox-padded d-flex flex-row" data-headline-jid="${t.get("jid")}"><a class="list-item-link open-headline available-room w-100" data-headline-jid="${t.get("jid")}" title="${n}" @click="${t=>e.openHeadline(t)}" href="#">${t.get("jid")}</a></div>`}(e,t)))}</div></div>`};function sR(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{HEADLINES_TYPE:oR}=Xx;class aR extends uA{initialize(){this.model=Ao.state.chatboxes,this.listenTo(this.model,"add",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"remove",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"destroy",(e=>this.renderIfHeadline(e))),this.requestUpdate()}render(){return iR(this)}renderIfHeadline(e){return(null==e?void 0:e.get("type"))===oR&&this.requestUpdate()}openHeadline(e){return(t=function*(){e.preventDefault();const t=e.target.getAttribute("data-headline-jid");(yield Wu.headlines.get(t)).maybeShow(!0)},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){sR(s,r,i,o,a,"next",e)}function a(e){sR(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}}Wu.elements.define("converse-headlines-feeds-list",aR);var cR=n(3363),lR={};lR.styleTagTransform=D(),lR.setAttributes=N(),lR.insert=k().bind(null,"head"),lR.domAPI=O(),lR.insertStyleElement=I();$()(cR.A,lR);cR.A&&cR.A.locals&&cR.A.locals;var uR=n(6524),dR={};dR.styleTagTransform=D(),dR.setAttributes=N(),dR.insert=k().bind(null,"head"),dR.domAPI=O(),dR.insertStyleElement=I();$()(uR.A,dR);uR.A&&uR.A.locals&&uR.A.locals;Hp.plugins.add("converse-headlines-view",{dependencies:["converse-headlines","converse-chatview"],initialize(){const e={HeadlinesFeedView:nR,HeadlinesFeedsList:aR,HeadlinesPanel:aR};Object.assign(Ao,e),Object.assign(Ao.exports,e)}});var hR=n(304),fR={};fR.styleTagTransform=D(),fR.setAttributes=N(),fR.insert=k().bind(null,"head"),fR.domAPI=O(),fR.insertStyleElement=I();$()(hR.A,fR);hR.A&&hR.A.locals&&hR.A.locals;function pR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mR(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class gR extends zO{static get properties(){return mR(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){pR(e,t,n[t])}))}return e}({},super.properties),{model:{type:Object}})}render(){return(e=this).model.get("fetching")?BO({classes:"hor_centered"}):mf`<a @click="${t=>e.fetchMissingMessages(t)}" title="${aA("Click to load missing messages")}"><div class="message mam-placeholder"></div></a>`;var e}fetchMissingMessages(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.fetchMissingMessages()}onVisibilityChanged(e){Wu.settings.get("auto_fill_history_gaps")&&this.isVisible&&!this.model.get("fetching")&&this.fetchMissingMessages()}constructor(){super(),this.model=null,this.observable="once",this.intersectionRatio=.1}}Wu.elements.define("converse-mam-placeholder",gR);const{CHATROOMS_TYPE:vR}=Xx;function yR(e,t){return e instanceof gw?mf`<converse-mam-placeholder .model="${e}"></converse-mam-placeholder>`:t}Hp.plugins.add("converse-mam-views",{dependencies:["converse-mam","converse-chatview","converse-muc-views"],initialize(){Wu.settings.extend({auto_fill_history_gaps:!0}),Wu.listen.on("getMessageTemplate",yR)}});class bR extends ae.Model{defaults(){return{collapsed:!1}}}const _R=bR,{ACTIVE:wR}=Xx;function SR(e){e.on("change:hidden",(()=>function(e){e.get("hidden")?function(e){Wu.trigger("chatBoxMinimized",e)}(e):function(e){e.isScrolledUp()||e.clearUnreadMsgCounter();e.setChatState(wR),Wu.trigger("chatBoxMaximized",e)}(e)}(e))),"controlbox"!==e.get("id")&&e.save({hidden:!!e.get("hidden"),time_minimized:e.get("time_minimized")})}function xR(e){if("controlbox"===e.model.get("id")){if(Up.isVisible(e))return Up.getOuterWidth(e,!0);{const e=document.querySelector("converse-controlbox-toggle");return e?Up.getOuterWidth(e,!0):0}}return!e.model.get("hidden")&&Up.isVisible(e)?Up.getOuterWidth(e,!0):0}function AR(){const e=document.querySelector("converse-minimized-chats");return Ao.state.chatboxes.pluck("hidden").includes(!0)?Up.getOuterWidth(e,!0):0}function jR(e){const t=e?e.model.get("id"):null,n=e?Up.getOuterWidth(e,!0):0;return Object.values(Ao.state.chatboxviews.xget(t)).reduce(((e,t)=>e+xR(t)),n)}function $R(e){if(Wu.settings.get("no_trimming")||"overlayed"!==Wu.settings.get("view_mode"))return;const t=Ao.state.chatboxviews.filter((e=>!e.model.get("hidden")&&!e.model.get("closed")&&Up.isVisible(e)));if(t.length<=1)return;const n=Up.getOuterWidth(document.querySelector("body"),!0);if(xR(t[0])===n)return;if(document.querySelector("converse-minimized-chats"))for(;AR()+jR(e)>n;){const t=ER([e?e.model.get("id"):null]);if(!t)break;{const e=Ao.state.chatboxes.get(t.get("id"));null==e||e.save("hidden",!0),CR(t)}}}function ER(e){e.push("controlbox");let t=0,n=Ao.state.chatboxes.sort().at(t);for(;e.includes(n.get("id"))||!0===n.get("hidden");)if(t++,n=Ao.state.chatboxes.at(t),!n)return null;return n}function OR(e,t){(null==e?void 0:e.preventDefault)?e.preventDefault():t=e,Up.safeSave(t,{hidden:!1,time_opened:(new Date).getTime()})}function CR(e,t){(null==e?void 0:e.preventDefault)?e.preventDefault():t=e,Up.safeSave(t,{hidden:!0,time_minimized:(new Date).toISOString()})}function kR(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function TR(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){kR(s,r,i,o,a,"next",e)}function a(e){kR(s,r,i,o,a,"throw",e)}o(void 0)}))}}Wu.elements.define("converse-minimized-chats",class extends uA{initialize(){return TR((function*(){this.model=Ao.state.chatboxes,yield this.initToggle(),this.listenTo(this.minchats,"change:collapsed",(()=>this.requestUpdate())),this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"change:fullname",(()=>this.requestUpdate())),this.listenTo(this.model,"change:jid",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>this.requestUpdate())),this.listenTo(this.model,"change:name",(()=>this.requestUpdate())),this.listenTo(this.model,"change:num_unread",(()=>this.requestUpdate())),this.listenTo(this.model,"remove",(()=>this.requestUpdate())),this.listenTo(Ao,"connected",(()=>this.requestUpdate())),this.listenTo(Ao,"reconnected",(()=>this.requestUpdate())),this.listenTo(Ao,"disconnected",(()=>this.requestUpdate()))})).call(this)}render(){return(e=>{const t=e.model.where({hidden:!0}),n=t.reduce(((e,t)=>e+t.get("num_unread")),0),r=t.reduce(((e,t)=>e+(t.get("hidden")?1:0)),0),i=e.minchats.get("collapsed");return mf`<div id="minimized-chats" class="${t.length?"":"hidden"}"><button type="button" class="btn btn-primary" @click="${t=>e.toggle(t)}">${r} ${aA("hidden")} <span class="badge bg-secondary unread-message-count ${n?"":"hidden"}">${n}</span></button><div class="flyout minimized-chats-flyout row g-0 ${i?"hidden":""}">${t.map((e=>mf`<converse-minimized-chat .model="${e}" title="${e.getDisplayName()}" type="${e.get("type")}" num_unread="${e.get("num_unread")}"></converse-minimized-chat>`))}</div></div>`})(this)}initToggle(){return TR((function*(){const e=`converse.minchatstoggle-${Ao.session.get("bare_jid")}`;this.minchats=new _R({id:e}),Up.initStorage(this.minchats,e,"session"),yield new Promise((e=>this.minchats.fetch({success:e,error:e})))})).call(this)}toggle(e){null==e||e.preventDefault(),this.minchats.save({collapsed:!this.minchats.get("collapsed")})}});Wu.elements.define("converse-minimized-chat",class extends uA{static get properties(){return{model:{type:Object},title:{type:String},type:{type:String},num_unread:{type:Number}}}render(){return(e=>{const t=aA("Click to restore this chat");let n;return n="chatroom"===e.type?"var(--muc-color)":"headline"===e.type?"var(--headlines-color)":"var(--chat-color)",mf`<div class="chat-head-${e.type} chat-head row g-0"><a class="col-10 restore-chat align-self-center" title="${t}" @click="${t=>e.restore(t)}">${e.num_unread?mf`<span class="message-count badge badge-light">${e.num_unread}</span>`:""} ${e.title} </a><a class="col-2 pl-1" @click="${t=>e.close(t)}"><converse-icon color="${n}" class="fas fa-times" @click="${t=>e.close(t)}" size="1em"></converse-icon></a></div>`})(this)}close(e){null==e||e.preventDefault(),this.model.close()}restore(e){null==e||e.preventDefault(),OR(this.model)}constructor(){super(),this.model=null,this.num_unread=null,this.type=null,this.title=null}});var NR=n(3195),MR={};MR.styleTagTransform=D(),MR.setAttributes=N(),MR.insert=k().bind(null,"head"),MR.domAPI=O(),MR.insertStyleElement=I();$()(NR.A,MR);NR.A&&NR.A.locals&&NR.A.locals;const{CHATROOMS_TYPE:IR}=Xx;Hp.plugins.add("converse-minimize",{dependencies:["converse-chatview","converse-controlbox","converse-muc-views","converse-headlines-view","converse-dragresize"],enabled:e=>"overlayed"===e.api.settings.get("view_mode"),initialize(){Wu.settings.extend({no_trimming:!1}),Wu.promises.add("minimizedChatsInitialized");const e={MinimizedChatsToggle:_R};Object.assign(Ao,e),Object.assign(Ao.exports,e),Object.assign(Ao,{minimize:{trimChats:$R,minimize:CR,maximize:OR}}),Object.assign(Ao.exports,{minimize:{trimChats:$R,minimize:CR,maximize:OR}}),Object.assign(Up,{trimChats:$R,minimize:CR,maximize:OR}),Wu.listen.on("chatBoxViewInitialized",(e=>$R(e))),Wu.listen.on("chatRoomViewInitialized",(e=>$R(e))),Wu.listen.on("controlBoxInitialized",(e=>$R(e))),Wu.listen.on("chatBoxInitialized",SR),Wu.listen.on("chatRoomInitialized",SR),Wu.listen.on("getHeadingButtons",((e,t)=>e.model.get("type")===IR?function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>CR(t,e.model),i18n_text:aA("Minimize"),i18n_title:aA("Minimize this groupchat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===Ao.api.settings.get("view_mode")},r=t.map((e=>e.name)),i=r.indexOf("signout");return i>-1?[...t.slice(0,i),n,...t.slice(i)]:[n,...t]}(e,t):function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>CR(t,e.model),i18n_text:aA("Minimize"),i18n_title:aA("Minimize this chat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===Ao.api.settings.get("view_mode")},r=t.map((e=>e.name)),i=r.indexOf("close");return i>-1?[...t.slice(0,i),n,...t.slice(i)]:[n,...t]}(e,t)));const t=Lo((()=>$R()),250);Wu.listen.on("registeredGlobalEventHandlers",(()=>window.addEventListener("resize",t))),Wu.listen.on("unregisteredGlobalEventHandlers",(()=>window.removeEventListener("resize",t)))}});var PR=n(7478),DR={};DR.styleTagTransform=D(),DR.setAttributes=N(),DR.insert=k().bind(null,"head"),DR.domAPI=O(),DR.insertStyleElement=I();$()(PR.A,DR);PR.A&&PR.A.locals&&PR.A.locals;function RR(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:zR,sizzle:LR}=Hp.env;class UR extends uA{static get properties(){return{muc:{type:Object},jid:{type:String},affiliation:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}render(){return(e=>{const t=aA("Change affiliation"),n=aA("New affiliation"),r=aA("Reason"),i=e.muc.getOwnOccupant().getAssignableAffiliations();return mf`<form class="affiliation-form" @submit="${t=>e.assignAffiliation(t)}">${e.alert_message?mf`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""}<div class="mb-3"><div class="row"><div class="col-md-6"><label class="form-label"><strong>${n}:</strong></label> <select class="form-select select-affiliation" name="affiliation">${i.map((t=>mf`<option value="${t}" ?selected="${t===e.affiliation}">${t}</option>`))}</select></div><div class="col-md-6"><label class="form-label"><strong>${r}:</strong></label> <input class="form-control" type="text" name="reason" placeholder="${r}"></div></div></div><div class="text-end"><button type="submit" class="btn btn-primary" name="change">${t}</button></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}assignAffiliation(e){return(t=function*(){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),n=t.get("affiliation"),r={jid:this.jid,reason:t.get("reason")},i=this.muc.get("jid");try{yield Up.muc.setAffiliation(n,i,[r])}catch(e){return null===e?this.alert(aA("Timeout error while trying to set the affiliation"),"danger"):LR(`not-allowed[xmlns="${zR.NS.STANZAS}"]`,e).length?this.alert(aA("Sorry, you're not allowed to make that change"),"danger"):this.alert(aA("Sorry, something went wrong while trying to set the affiliation"),"danger"),void Q.error(e)}yield this.muc.occupants.fetchMembers();const s=new CustomEvent("affiliationChanged",{bubbles:!0});this.dispatchEvent(s)},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){RR(s,r,i,o,a,"next",e)}function a(e){RR(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}constructor(){super(),this.jid=null,this.muc=null,this.affiliation=null}}Wu.elements.define("converse-muc-affiliation-form",UR);var BR=n(9442),FR={};FR.styleTagTransform=D(),FR.setAttributes=N(),FR.insert=k().bind(null,"head"),FR.domAPI=O(),FR.insertStyleElement=I();$()(BR.A,FR);BR.A&&BR.A.locals&&BR.A.locals;const{Strophe:qR,sizzle:HR}=Hp.env;class GR extends uA{static get properties(){return{muc:{type:Object},jid:{type:String},role:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}render(){return(e=>{const t=aA("Change role"),n=aA("New Role"),r=aA("Reason"),i=e.muc.getOwnOccupant().getAssignableRoles();return mf`<form class="role-form" @submit="${e.assignRole}"><input type="hidden" name="jid" value="${e.jid}"> <input type="hidden" name="nick" value="${e.nick}"><div class="mb-3"><div class="row"><div class="col-md-6"><label class="form-label"><strong>${n}:</strong></label> <select class="form-select select-role" name="role">${i.map((t=>mf`<option value="${t}" ?selected="${t===e.role}">${t}</option>`))}</select></div><div class="col-md-6"><label class="form-label"><strong>${r}:</strong></label> <input class="form-control" type="text" name="reason" placeholder="${r}"></div></div></div><div class="text-end"><button type="submit" class="btn btn-primary">${t}</button></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}assignRole(e){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),n=this.muc.getOccupant(t.get("jid")||t.get("nick")),r=t.get("role"),i=t.get("reason");this.muc.setRole(n,r,i,(()=>{const e=new CustomEvent("roleChanged",{bubbles:!0});this.dispatchEvent(e)}),(e=>{HR(`not-allowed[xmlns="${qR.NS.STANZAS}"]`,e).length?this.alert(aA("You're not allowed to make that change"),"danger"):(this.alert(aA("Sorry, something went wrong while trying to set the role"),"danger"),Up.isErrorObject(e)&&Q.error(e))}))}constructor(){super(),this.muc=null,this.nick=null,this.jid=null}}Wu.elements.define("converse-muc-role-form",GR);function WR(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-muc-message-form",class extends PP{initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){n().call(t),yield this.model.initialized,this.initMentionAutoComplete()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){WR(s,r,i,o,a,"next",e)}function a(e){WR(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}render(){return(e=>{const t=e.model.get("composing_spoiler"),n=aA(t?"Hidden message":"Message"),r=aA("Optional hint"),i=Wu.settings.get("message_limit"),s=Wu.settings.get("visible_toolbar_buttons").call,o=Wu.settings.get("visible_toolbar_buttons").emoji,a=Wu.settings.get("show_send_button"),c=Wu.settings.get("visible_toolbar_buttons").spoiler,l=Wu.settings.get("show_toolbar");var u,d;return mf`<form class="setNicknameButtonForm hidden"><input type="submit" class="btn btn-primary" name="join" value="Join"></form><form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?mf`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?hidden_occupants="${e.model.get("hidden_occupants")}" ?is_groupchat="${"groupchat"===e.model.get("message_type")}" ?show_call_button="${s}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" placeholder="${r||""}" .value="${null!==(u=e.model.get("draft_hint"))&&void 0!==u?u:""}" @change="${t=>Up.safeSave(e.model,{draft_hint:t.target.value})}" class="${t?"":"hidden"} spoiler-hint"><div class="suggestion-box"><ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul><textarea autofocus type="text" .value="${null!==(d=e.model.get("draft"))&&void 0!==d?d:""}" @drop="${t=>e.onDrop(t)}" @input="${kP}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>Up.safeSave(e.model,{draft:t.target.value})}" class="chat-textarea suggestion-box__input ${e.model.get("correcting")?"correcting":""} ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${n}"></textarea> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div></form>`})(this)}shouldAutoComplete(){const e=this.model instanceof Dy?this.model.collection.chatroom:this.model;if(e){return e.session.get("connection_status")===Hp.ROOMSTATUS.ENTERED&&!(e.features.get("moderated")&&"visitor"===e.getOwnRole())}return Q.debug("Could not determine MUC for MUCMessageForm element"),!1}initMentionAutoComplete(){this.auto_complete=new yT(this,{auto_first:!0,min_chars:Wu.settings.get("muc_mention_autocomplete_min_chars"),match_current_word:!0,list:()=>this.getAutoCompleteList(),filter:"contains"==Wu.settings.get("muc_mention_autocomplete_filter")?dT:hT,ac_triggers:["Tab","@"],include_triggers:[],item:(e,t)=>function(e,t,n){let r;n=n.trim();const i=Wu.settings.get("muc_mention_autocomplete_show_avatar");if(i){const n=t.label.toLowerCase();r=e.occupants.findWhere((e=>{var t,r,i,s,o,a;return(null===(r=e.getDisplayName())||void 0===r||null===(t=r.toLowerCase())||void 0===t?void 0:t.startsWith(n))||(null===(s=e.get("nickname"))||void 0===s||null===(i=s.toLowerCase())||void 0===i?void 0:i.startsWith(n))||(null===(a=e.get("jid"))||void 0===a||null===(o=a.toLowerCase())||void 0===o?void 0:o.startsWith(n))?e:void 0}))}const s=new RegExp("("+n+")","ig"),o=n?t.split(s):[t];return mf`<li aria-selected="false">${i?mf`<converse-avatar .model="${r}" name="${r.getDisplayName()}" height="22" width="22" class="avatar avatar-autocomplete"></converse-avatar>`:""} <span class="autocomplete-item">${o.map((e=>n&&e.match(s)?mf`<mark>${e}</mark>`:e))}</span></li>`}(this.model,e,t)}),this.auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}getAutoCompleteList(){return this.model.getAllKnownNicknames().map((e=>({label:e,value:`@${e}`})))}onKeyDown(e){this.shouldAutoComplete()&&this.auto_complete.onKeyDown(e)||super.onKeyDown(e)}onKeyUp(e){this.shouldAutoComplete()&&this.auto_complete.auto_completing&&this.auto_complete.evaluate(e),super.onKeyUp(e)}});var VR=n(4734),KR={};KR.styleTagTransform=D(),KR.setAttributes=N(),KR.insert=k().bind(null,"head"),KR.domAPI=O(),KR.insertStyleElement=I();$()(VR.A,KR);VR.A&&VR.A.locals&&VR.A.locals;class JR extends uA{static get properties(){return{jid:{type:String}}}shouldUpdate(e){if(e.has("jid")&&this.jid){const{chatboxes:e}=Ao.state;this.model=e.get(this.jid)}return!0}render(){return(e=>{var t,n,r;const i=aA("Nickname"),s=(null===(t=e.model)||void 0===t?void 0:t.isEntered())?aA("Change nickname"):aA("Enter groupchat"),o=Wu.settings.get("muc_show_logs_before_join")?aA("Choose a nickname to enter"):aA("Please choose your nickname"),a=null===(n=e.model)||void 0===n?void 0:n.get("nickname_validation_message");return mf`<div class="chatroom-form-container muc-nickname-form"><form class="converse-form chatroom-form converse-centered-form" @submit="${t=>e.submitNickname(t)}"><fieldset><label class="form-label">${o}</label><p class="validation-message">${a}</p><input type="text" required="required" name="nick" value="${(null===(r=e.model)||void 0===r?void 0:r.get("nick"))||""}" class="form-control ${a?"error":""}" placeholder="${i}"></fieldset><fieldset><input type="submit" class="btn btn-primary" name="join" value="${s}"></fieldset></form></div>`})(this)}submitNickname(e){e.preventDefault();const t=e.target.nick.value.trim();t&&(this.model.isEntered()?(this.model.setNickname(t),this.closeModal()):this.model.join(t))}closeModal(){document.querySelector("converse-muc-nickname-modal").close()}constructor(){super(),this.jid=null,this.model=null}}Wu.elements.define("converse-muc-nickname-form",JR);var YR=n(6215),XR={};XR.styleTagTransform=D(),XR.setAttributes=N(),XR.insert=k().bind(null,"head"),XR.domAPI=O(),XR.insertStyleElement=I();$()(YR.A,XR);YR.A&&YR.A.locals&&YR.A.locals;function QR(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-muc-bottom-panel",class extends UP{initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){yield n().call(t),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model,"change:num_unread_general",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",this.renderIfOwnOccupant),this.listenTo(this.model.occupants,"change:role",this.renderIfOwnOccupant),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate()))},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){QR(s,r,i,o,a,"next",e)}function a(e){QR(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}render(){return this.model?(e=>{const t=aA("You have unread messages"),n=e.model.session.get("connection_status"),r=aA("You're not allowed to send messages in this room");return n===Hp.ROOMSTATUS.ENTERED?mf`${e.model.ui.get("scrolled")&&e.model.get("num_unread_general")?mf`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""} ${e.model.canPostMessages()?mf`<converse-muc-message-form .model="${e.model}"></converse-muc-message-form>`:mf`<span class="muc-bottom-panel muc-bottom-panel--muted">${r}</span>`}`:n!=Hp.ROOMSTATUS.NICKNAME_REQUIRED?"":Wu.settings.get("muc_show_logs_before_join")?mf`<span class="muc-bottom-panel muc-bottom-panel--nickname"><converse-muc-nickname-form .model="${e.model}"></converse-muc-nickname-form></span>`:void 0})(this):""}renderIfOwnOccupant(e){const t=Ao.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}sendButtonClicked(e){var t;if("sendMessage"===(null===(t=e.delegateTarget)||void 0===t?void 0:t.dataset.action)){const t=this.querySelector("converse-muc-message-form");null==t||t.onFormSubmitted(e)}}});const ZR=Hp.env.utils;function ez(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-muc-invite-modal",class extends ak{renderModal(){return(e=>{const t=aA("Invite"),n=aA("user@example.org"),r=aA("Please enter a valid XMPP address"),i=aA("XMPP Address"),s=aA("Optional reason for the invitation");return mf`<form class="converse-form" @submit="${t=>e.submitInviteForm(t)}"><fieldset><label class="form-label clearfix" for="invitee_jids">${i}:</label> ${e.state.get("invalid_invite_jid")?mf`<div class="error error-feedback">${r}</div>`:""}<converse-autocomplete .getAutoCompleteList="${()=>e.getAutoCompleteList()}" ?autofocus="${!0}" min_chars="1" position="below" required="required" name="invitee_jids" id="invitee_jids" placeholder="${n}"></converse-autocomplete></fieldset><fieldset><label class="form-label">${s}:</label> <textarea class="form-control" name="reason"></textarea></fieldset><fieldset><input type="submit" class="btn btn-primary" value="${t}"></fieldset></form>`})(this)}getModalTitle(){return aA("Invite someone to this groupchat")}getAutoCompleteList(){return Ao.state.roster.map((e=>({label:e.getDisplayName(),value:e.get("jid")})))}submitInviteForm(e){var t;e.preventDefault();const n=new FormData(e.target),r=null===(t=n.get("invitee_jids"))||void 0===t?void 0:t.trim(),i=n.get("reason");ZR.isValidJID(r)?(this.muc.directInvite(r,i),this.modal.hide()):this.state.set({invalid_invite_jid:!0})}constructor(e){super(e),this.id="converse-muc-invite-modal",this.muc=e.muc}});let tz;function nz(e){tz||function(){let e;tz={},tz.owner={label:aA("Owner"),classname:"badge-groupchat"},tz.admin={label:aA("Admin"),classname:"badge-info"},tz.member={label:aA("Member"),classname:"badge-info"},tz.moderator={label:aA("Moderator"),classname:"badge-info"},tz.visitor={label:aA("Visitor"),classname:"badge-secondary"};for(let s=1;s<5&&(!e||Object.values(e).find((e=>e>1)));s++){const o={};for(const a of Object.values(tz)){var t,n,r,i;(!e||(null!==(t=e[a.shortlabel])&&void 0!==t?t:0)>=2)&&(a.shortlabel=a.label.substr(0,s).toLocaleUpperCase(),null!==(i=(n=o)[r=a.shortlabel])&&void 0!==i||(n[r]=0),o[a.shortlabel]++)}e=o}}();const t=tz[e];return t?mf`<span title="${t.label}" aria-label="${t.label}" class="badge ${null!==(n=t.classname)&&void 0!==n?n:"badge-info"}">${t.shortlabel}</span>`:"";var n}function rz(e){const t=e.get("role"),n=(e=>aA("Click to mention %1$s in your message.",e.get("nick")))(e),r=aA("This user is a moderator."),i=aA("This user can send messages in this groupchat."),s=aA("This user can NOT send messages in this groupchat."),o=e.get("jid")?`${e.get("jid")} `:"";return"moderator"===t?`${o}${r} ${n}`:"participant"===t?`${o}${i} ${n}`:"visitor"===t?`${o}${s} ${n}`:["visitor","participant","moderator"].includes(t)?void 0:`${o}${n}`}function iz(e){return(t=function*(){const t=yield Wu.hook("getOccupantActionButtons",e,[]);if(!(null==t?void 0:t.length))return"";const n=t.map((e=>mf`<button class="dropdown-item ${e.button_class}" @click="${e.handler}" type="button"><converse-icon class="${e.icon_class}" color="var(--foreground-color)" size="1em" aria-hidden="true"></converse-icon> ${e.i18n_text}</button>`));return mf`<converse-dropdown class="occupant-actions chatbox-btn" .items="${n}"></converse-dropdown>`},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){ez(s,r,i,o,a,"next",e)}function a(e){ez(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}var sz=n(9613),oz={};oz.styleTagTransform=D(),oz.setAttributes=N(),oz.insert=k().bind(null,"head"),oz.domAPI=O(),oz.insertStyleElement=I();$()(sz.A,oz);sz.A&&sz.A.locals&&sz.A.locals;function az(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function cz(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function lz(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uz(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}Wu.elements.define("converse-occupant-bottom-panel",class extends UP{static get properties(){return{model:{type:Object,noAccessor:!0},muc:{type:Object}}}initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){yield n().call(t),this.listenTo(this.muc.session,"change:connection_status",(()=>this.requestUpdate()))},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){az(s,r,i,o,a,"next",e)}function a(e){az(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}render(){return this.model?(e=>{const t=aA("You have unread messages"),n=e.muc.session.get("connection_status"),r=aA("This user is not currently in this groupchat and can't receive messages."),i=aA("Invite this user to join this groupchat"),s=aA("Open a one-on-one chat with this user"),o=aA("Open Chat"),a=aA("Invite");return n===Hp.ROOMSTATUS.ENTERED?mf`${e.muc.ui.get("scrolled")&&e.model.get("num_unread")?mf`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""} ${e.canPostMessages()?mf`<converse-muc-message-form .model="${e.model}"></converse-muc-message-form>`:mf`<div class="bottom-panel bottom-panel--muted"><p class="bottom-panel--muted__msg">${r}</p>${e.model.get("jid")?mf`<button @click="${e.openChat}" type="button" class="btn btn-primary" title="${s}">${o}</button> <button @click="${e.invite}" type="button" class="btn btn-secondary" title="${i}">${a}</button>`:""}</div>`}`:""})(this):""}canPostMessages(){return this.muc.isEntered()&&"offline"!==this.model.get("show")}openChat(){const e=this.model.get("jid");return e?Wu.chats.open(e,{},!0):Wu.alert("error",aA("Error"),"Could not find XMPP address")}invite(){const e=this.model.get("jid");return Wu.listen.once("roomInviteSent",(()=>Wu.alert("info",aA("Success"),aA("The user has been invited to join this groupchat")))),e?this.muc.directInvite(e):Wu.alert("error",aA("Error"),"Could not find XMPP address")}constructor(){super(),this.muc=null}});Wu.elements.define("converse-muc-occupant-list-item",class extends zO{static get properties(){return uz(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){lz(e,t,n[t])}))}return e}({},super.properties),{model:{type:ae.Model},muc:{type:ky}})}initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){n().call(t),yield this.muc.initialized,this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){cz(s,r,i,o,a,"next",e)}function a(e){cz(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}render(){return this.muc?(e=>{var t;const n=e.model,{show:r,presence:i,affiliation:s}=e.model.attributes,o=XO[r||i],a=n.get("role");let c,l;[c,l]="chat"===r||!r&&"online"===i?["fa fa-circle","chat-status-online"]:"dnd"===r?["fa fa-minus-circle","chat-status-busy"]:"away"===r||"xa"===r?["fa fa-circle","chat-status-away"]:["fa fa-circle","chat-status-offline"];const u=MN(n);return mf`<li class="list-item occupant" id="${n.id}"><a @click="${t=>e.onOccupantClicked(t,n)}"><div class="row g-0"><div class="col-auto"><converse-avatar .model="${n}" class="avatar chat-msg__avatar" name="${n.getDisplayName()}" nonce="${null===(t=n.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="30" width="30"></converse-avatar><converse-icon title="${o}" color="var(--${l})" size="0.82em" class="${c} chat-status chat-status--avatar"></converse-icon>${u?mf`<span class="msgs-indicator badge">${u}</span>`:""}</div><div class="col occupant-nick-badge"><span class="occupant-nick" title="${rz(n)}" style="${eC(n)}">${n.getDisplayName()}</span> <span class="occupant-badges">${"owner"===s?nz("owner"):""} ${"admin"===s?nz("admin"):""} ${"member"===s?nz("member"):""} ${"moderator"===a?nz("moderator"):""} ${"visitor"===a?nz("visitor"):""} </span>${NA(iz(n))}</div></div></a></li>`})(this):""}onOccupantClicked(e,t){e.preventDefault(),this.muc.getOwnOccupant()===t?Wu.modal.show("converse-profile-modal",{model:Ao.state.xmppstatus},e):this.muc.save({sidebar_view:`occupant:${t.id}`})}constructor(){super(),this.muc=null,this.observable="once"}});const dz=e=>{const t=aA("Filter"),n=aA("Filter by name"),r=aA("Filter by status"),i=aA("Any"),s=aA("Online"),o=aA("Chatty"),a=aA("Busy"),c=aA("Away"),l=aA("Extended Away"),u=aA("Offline"),d=e.model.get("state"),h=e.model.get("text"),f=e.model.get("type"),p="overlayed"===Wu.settings.get("view_mode");return mf`<form class="items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="${p?"":"flex-nowrap"}"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===f?"selected":""}" data-type="items" title="${n}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===f?"selected":""}" data-type="state" title="${r}"></converse-icon></div><div class="btn-group"><input .value="${h||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===f?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${h&&"state"!==f?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==f?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${i}</option><option ?selected="${"online"===d}" value="online">${s}</option><option ?selected="${"chat"===d}" value="chat">${o}</option><option ?selected="${"dnd"===d}" value="dnd">${a}</option><option ?selected="${"away"===d}" value="away">${c}</option><option ?selected="${"xa"===d}" value="xa">${l}</option><option ?selected="${"offline"===d}" value="offline">${u}</option></select></div></form>`};const hz=e=>{const t=1===e.model.occupants?aA("Participant"):aA("Participants"),n=aA("Hide"),r=aA("Show filter"),i=aA("Hide filter"),s=e.model.get("filter_visible"),o=aA("Invite someone"),a=aA("Invite someone to join this groupchat"),c=[];return e.model.invitesAllowed()&&c.push(mf`<a href="#" class="dropdown-item open-invite-modal" role="button" title="${a}" @click="${t=>e.showInviteModal(t)}"><converse-icon size="1em" class="fa fa-user-plus"></converse-icon>${o}</a>`),e.model.occupants.length>5&&c.push(mf`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${s?i:r}</a>`),c.length?c.push(mf`<a href="#" class="dropdown-item" role="button" @click="${t=>e.closeSidebar(t)}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${n}</a>`):c.push(mf`<i class="hide-occupants" @click="${t=>e.closeSidebar(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></i>`),mf`<div class="occupants"><div class="occupants-header"><div class="occupants-header--title"><span class="occupants-heading sidebar-heading">${e.model.occupants.length} ${t}</span> ${1===c.length?c[0]:mf`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${c}"></converse-dropdown>`}</div></div><ul class="items-list occupant-list">${s?mf`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${e.model.initialized}" .items="${e.model.occupants}" .template="${dz}" .model="${e.filter}"></converse-list-filter>`:""} ${xN(e.model.occupants.models,(e=>e.get("jid")),(t=>function(e,t){if(!e.model.get("filter_visible"))return!1;const n=e.filter.get("type"),r="state"===n?e.filter.get("state").toLowerCase():e.filter.get("text").toLowerCase();if(!r)return!1;if("state"===n){var i;const e=t.get("presence");return"online"===r?["offline","unavailable"].includes(e):"ofline"===r?"online"===e:!(null===(i=t.get("show"))||void 0===i?void 0:i.includes(r))}return"items"===n?!t.getDisplayName().toLowerCase().includes(r):void 0}(e,t)?"":mf`<converse-muc-occupant-list-item .muc="${e.model}" .model="${t}">`))}</ul></div>`};var fz=n(3952),pz={};pz.styleTagTransform=D(),pz.setAttributes=N(),pz.insert=k().bind(null,"head"),pz.domAPI=O(),pz.insertStyleElement=I();$()(fz.A,pz);fz.A&&fz.A.locals&&fz.A.locals;function mz(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{u:gz}=Hp.env;Wu.elements.define("converse-muc-occupant",class extends uA{static get properties(){return{muc_jid:{type:String},occupant_id:{type:String}}}initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){n().call(t);const{chatboxes:e}=Ao.state;this.muc=e.get(this.muc_jid),yield this.muc.initialized,this.model=this.muc.occupants.get(this.occupant_id),this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){mz(s,r,i,o,a,"next",e)}function a(e){mz(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}render(){return this.muc?(e=>{var t,n,r,i,s,o,a;const c=aA("Hide"),l=aA("No participant data found"),u=aA("Participants"),d=aA("Show details"),h=null===(t=e.model)||void 0===t?void 0:t.get("jid"),f=null===(n=e.model)||void 0===n?void 0:n.get("nick"),p=Up.firstCharToUpperCase(null===(r=e.model)||void 0===r?void 0:r.get("role")),m=Up.firstCharToUpperCase(null===(i=e.model)||void 0===i?void 0:i.get("affiliation")),g=(null===(o=e.model)||void 0===o||null===(s=o.get("hats"))||void 0===s?void 0:s.length)?e.model.get("hats").map((({title:e})=>e)):[];return mf`<span class="sidebar-occupant"><div class="sidebar-heading"><span><button type="button" class="btn btn--transparent back-button" @click="${()=>e.muc.save({sidebar_view:"occupants"})}"><converse-icon size="1em" class="fa fa-arrow-left"></converse-icon></button> <a @click="${t=>{t.preventDefault(),e.muc.save({sidebar_view:"occupants"})}}">${u}</a></span><converse-dropdown .items="${[mf`<a class="dropdown-item show-occupant-modal" role="button" title="${d}" @click="${()=>e.showOccupantModal()}"><converse-icon class="fa fa-id-card" size="1em"></converse-icon>${d}</a>`,mf`<a href="#" class="dropdown-item" role="button" @click="${()=>e.closeSidebar()}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${c}</a>`]}"></converse-dropdown></div>${e.model?mf`<div class="row"><div class="col"><a title="${d}" @click="${()=>e.showOccupantModal()}"><converse-avatar .model="${e.model}" class="avatar modal-avatar justify-content-center" name="${e.model.getDisplayName()}" nonce="${null===(a=e.getVcard())||void 0===a?void 0:a.get("vcard_updated")}" height="120" width="120"></converse-avatar></a></div></div>`:""}<ul class="occupant-details">${e.model?mf`${f?mf`<li class="occupant-details-nickname">${f}</li>`:""}<li class="occupant-details-jid">${h?mf`<a @click="${()=>e.openChat(h)}">${h}</a>`:""}</li><li>${m&&"None"!==m?mf`<span class="badge text-bg-primary">${m}</span>`:""} ${p?mf`<span class="badge text-bg-secondary">${p}</span>`:""} ${g.length?mf`${g.map((e=>mf`<span class="badge text-bg-info">${e}</span>`))}`:""}</li>`:mf`<li>${l}</li>`}</ul>${e.model?mf`<div class="chat-body"><div class="chat-content chat-content-sendbutton" aria-live="polite"><converse-chat-content .model="${e.model}"></converse-chat-content></div><converse-occupant-bottom-panel .model="${e.model}" .muc="${e.muc}" class="bottom-panel"></converse-occupant-bottom-panel></div>`:""}</span>`})(this):""}openChat(e){Wu.chats.open(e,{},!0)}closeSidebar(){gz.safeSave(this.muc,{hidden_occupants:!0})}showOccupantModal(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Wu.modal.show("converse-muc-occupant-modal",{model:this.model},e)}getVcard(){const e=this.model;if(e.vcard)return e.vcard;const t=(null==e?void 0:e.get("jid"))||(null==e?void 0:e.get("from"));return t?Ao.state.vcards.get(t):null}addToContacts(){const e=this.model.get("jid");e&&Wu.modal.show("converse-add-contact-modal",{state:new ae.Model({jid:e})})}toggleForm(e){"row-form"===gz.ancestor(e.target,".toggle-form").getAttribute("data-form")?this.show_role_form=!this.show_role_form:this.show_affiliation_form=!this.show_affiliation_form,this.requestUpdate()}constructor(){super(),this.muc_jid=null,this.occupant_id=null}});var vz=n(8945),yz={};yz.styleTagTransform=D(),yz.setAttributes=N(),yz.insert=k().bind(null,"head"),yz.domAPI=O(),yz.insertStyleElement=I();$()(vz.A,yz);vz.A&&vz.A.locals&&vz.A.locals;var bz=n(33),_z={};_z.styleTagTransform=D(),_z.setAttributes=N(),_z.insert=k().bind(null,"head"),_z.domAPI=O(),_z.insertStyleElement=I();$()(bz.A,_z);bz.A&&bz.A.locals&&bz.A.locals;const{initStorage:wz}=Up;Wu.elements.define("converse-muc-occupants",class extends uA{static get properties(){return{jid:{type:String}}}initialize(){const e=`_converse.occupants-filter-${this.jid}`;this.filter=new c_,this.filter.id=e,wz(this.filter,e),this.filter.fetch();const{chatboxes:t}=Ao.state;this.model=t.get(this.jid);const n=Lo((()=>this.requestUpdate()),200,{maxWait:1e3});this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",n),this.listenTo(this.model.occupants,"change",n),this.listenTo(this.model.occupants,"remove",n),this.listenTo(this.model.occupants,"sort",n),this.listenTo(this.model.features,"change:open",(()=>this.requestUpdate())),this.model.initialized.then((()=>this.requestUpdate()))}render(){return hz(this)}showInviteModal(e){e.preventDefault(),Wu.modal.show("converse-muc-invite-modal",{muc:this.model},e)}toggleFilter(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Up.safeSave(this.model,{filter_visible:!this.model.get("filter_visible")})}closeSidebar(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Up.safeSave(this.model,{hidden_occupants:!0})}constructor(){super(),this.jid=null}});var Sz=n(8853),xz={};xz.styleTagTransform=D(),xz.setAttributes=N(),xz.insert=k().bind(null,"head"),xz.domAPI=O(),xz.insertStyleElement=I();$()(Sz.A,xz);Sz.A&&Sz.A.locals&&Sz.A.locals;Wu.elements.define("converse-muc-sidebar",class extends uA{static get properties(){return{jid:{type:String}}}initialize(){const{chatboxes:e}=Ao.state;this.model=e.get(this.jid),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:open",(()=>this.requestUpdate())),this.model.initialized.then((()=>this.requestUpdate()))}render(){return(e=>{const t=e.model.get("sidebar_view")||"",n=t.split("occupant:").pop();return mf`${(null==t?void 0:t.startsWith("occupant:"))?mf`<converse-muc-occupant muc_jid="${e.jid}" occupant_id="${n}"></converse-muc-occupant>`:mf`<converse-muc-occupants jid="${e.jid}"></converse-muc-occupants>`}`})(this)}closeSidebar(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Up.safeSave(this.model,{hidden_occupants:!0})}constructor(){super(),this.jid=null}});var Az=n(4641),jz={};jz.styleTagTransform=D(),jz.setAttributes=N(),jz.insert=k().bind(null,"head"),jz.domAPI=O(),jz.insertStyleElement=I();$()(Az.A,jz);Az.A&&Az.A.locals&&Az.A.locals;function $z(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-muc-chat-content",class extends JI{initialize(){var e,t=this,n=()=>super.initialize;return(e=function*(){yield n().call(t),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"change",(()=>this.requestUpdate()))},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){$z(s,r,i,o,a,"next",e)}function a(e){$z(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this)}});const{CHATROOMS_TYPE:Ez}=Xx;function Oz(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Cz(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function kz(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}var Tz=new WeakSet;function Nz(e){var t,n;if(null===(t=this.model)||void 0===t?void 0:t.get("hidden_occupants"))return;(e?e.matches:this.viewportMediaQuery.matches)&&(null===(n=this.model)||void 0===n||n.save("hidden_occupants",!0))}Wu.elements.define("converse-muc-chatarea",class extends uA{static get properties(){return{jid:{type:String},show_help_messages:{type:Boolean},type:{type:String}}}initialize(){return(e=function*(){this.model=yield Wu.rooms.get(this.jid),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate())),Cz(this,Tz,Nz).call(this),this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Oz(s,r,i,o,a,"next",e)}function a(e){Oz(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){return this.model?(e=>{var t;const n=Wu.settings.get("show_send_button"),r=Wu.settings.get("view_mode");let i,s;return"overlayed"===r?(i="d-none d-md-flex col-s-10 col-md-8",s="col-xs-12 col-s-2 col-md-4"):"fullscreen"===r?(i="d-none d-md-flex col-md-8 col-xl-10",s="col-xs-12 col-md-4 col-xl-2"):"embedded"===r&&(i="d-flex col-8",s="col-4"),mf`<div class="chat-area ${e.shouldShowSidebar()?i:"col-xs-12"}"><div class="chat-content ${n?"chat-content-sendbutton":""}" aria-live="polite"><converse-muc-chat-content .model="${e.model}"></converse-muc-chat-content>${(null===(t=e.model)||void 0===t?void 0:t.get("show_help_messages"))?mf`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${e.getHelpMessages()}" type="info" chat_type="${Ez}"></converse-chat-help></div>`:""}</div><converse-muc-bottom-panel .model="${e.model}" class="bottom-panel"></converse-muc-bottom-panel></div>${e.model&&e.shouldShowSidebar()?mf`<converse-split-resize></converse-split-resize><converse-muc-sidebar class="${s}" jid="${e.jid}"></converse-muc-sidebar>`:""}`})(this):""}connectedCallback(){super.connectedCallback(),this.hideSidebarIfSmallViewport=Cz(this,Tz,Nz).bind(this),this.viewportMediaQuery.addEventListener("change",this.hideSidebarIfSmallViewport)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.viewportMediaQuery)||void 0===e||e.removeEventListener("change",this.hideSidebarIfSmallViewport)}shouldShowSidebar(){return!this.model.get("hidden_occupants")&&this.model.session.get("connection_status")===Hp.ROOMSTATUS.ENTERED}getHelpMessages(){const e=Wu.settings.get("muc_disable_slash_commands"),t=Array.isArray(e)?e:[];return[`<strong>/admin</strong>: ${aA("Change user's affiliation to admin")}`,`<strong>/ban</strong>: ${aA("Ban user by changing their affiliation to outcast")}`,`<strong>/clear</strong>: ${aA("Clear the chat area")}`,`<strong>/close</strong>: ${aA("Close this groupchat")}`,`<strong>/deop</strong>: ${aA("Change user role to participant")}`,`<strong>/destroy</strong>: ${aA("Remove this groupchat")}`,`<strong>/help</strong>: ${aA("Show this menu")}`,`<strong>/kick</strong>: ${aA("Kick user from groupchat")}`,`<strong>/me</strong>: ${aA("Write in 3rd person")}`,`<strong>/member</strong>: ${aA("Grant membership to a user")}`,`<strong>/modtools</strong>: ${aA("Opens up the moderator tools GUI")}`,`<strong>/mute</strong>: ${aA("Remove user's ability to post messages")}`,`<strong>/nick</strong>: ${aA("Change your nickname")}`,`<strong>/op</strong>: ${aA("Grant moderator role to user")}`,`<strong>/owner</strong>: ${aA("Grant ownership of this groupchat")}`,`<strong>/register</strong>: ${aA("Register your nickname")}`,`<strong>/revoke</strong>: ${aA("Revoke the user's current affiliation")}`,`<strong>/subject</strong>: ${aA("Set groupchat subject")}`,`<strong>/topic</strong>: ${aA("Set groupchat subject (alias for /subject)")}`,`<strong>/voice</strong>: ${aA("Allow muted user to post messages")}`].filter((e=>t.every((t=>!e.startsWith(t+"<",9))))).filter((e=>this.model.getAllowedCommands().some((t=>e.startsWith(t+"<",9)))))}constructor(){super(),kz(this,Tz),this.jid=null,this.type=null,this.split=null,this.viewportMediaQuery=window.matchMedia("(max-width: 768px)")}});const Mz=e=>{const t=aA("This groupchat no longer exists"),n=aA('The following reason was given: "%1$s"',e.reason||"");return mf`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${t}</h3></div>${e.reason?mf`<p class="destroyed-reason">${n}</p>`:""} ${e.moved_jid?(e=>{const t=aA("The conversation has moved to a new address. Click the link below to enter.");return mf`<p class="moved-label">${t}</p><p class="moved-link"><a class="switch-chat" @click="${t=>e.onSwitch(t)}">${e.moved_jid}</a></p>`})(e):""}`};function Iz(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-muc-destroyed",class extends uA{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=Ao.state.chatboxes.get(this.jid)}render(){const e=this.model.get("destroyed_reason"),t=this.model.get("moved_jid");return Mz({moved_jid:t,reason:e,onSwitch:e=>this.onSwitch(e)})}onSwitch(e){return(t=function*(){e.preventDefault();const t=this.model.get("moved_jid");(yield Wu.rooms.get(t,{},!0)).maybeShow(!0),this.model.destroy()},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){Iz(s,r,i,o,a,"next",e)}function a(e){Iz(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}constructor(){super(),this.jid=null}});Wu.elements.define("converse-muc-disconnected",class extends uA{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=Ao.state.chatboxes.get(this.jid)}render(){const e=this.model.session.get("disconnection_message");if(!e)return;const t=[e],n=this.model.session.get("disconnection_actor");n&&t.push(aA("This action was done by %1$s.",n));const r=this.model.session.get("disconnection_reason");return r&&t.push(aA('The reason given is: "%1$s".',r)),(e=>mf`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${e[0]}</h3>${e.slice(1).map((e=>mf`<p class="disconnect-msg">${e}</p>`))}</div>`)(t)}constructor(){super(),this.jid=null}});var Pz=n(998),Dz={};Dz.styleTagTransform=D(),Dz.setAttributes=N(),Dz.insert=k().bind(null,"head"),Dz.domAPI=O(),Dz.insertStyleElement=I();$()(Pz.A,Dz);Pz.A&&Pz.A.locals&&Pz.A.locals;const Rz=Hp.env.utils;function zz(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Lz(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){zz(s,r,i,o,a,"next",e)}function a(e){zz(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{sizzle:Uz,u:Bz}=Hp.env;Wu.elements.define("converse-muc-config-modal",class extends ak{initialize(){super.initialize(),this.addListeners()}addListeners(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:passwordprotected",(()=>this.requestUpdate())),this.listenTo(this.model.session,"change:config_stanza",(()=>this.requestUpdate()))}renderModal(){return(e=>{const t=Wu.settings.get("roomconfig_whitelist");let n=[],r="",i=aA("Loading configuration form");const s=e.model.session.get("config_stanza");if(s){var o,a;const c=Rz.toStanza(s);let{fields:l}=xm(c);t.length&&(l=l.filter((e=>t.includes(e.var))));const u={new_password:!e.model.features.get("passwordprotected"),fixed_username:e.model.get("jid")};n=l.map((e=>Rz.xFormField2TemplateResult(e,u))),r=null===(o=c.querySelector("instructions"))||void 0===o?void 0:o.textContent,i=null===(a=c.querySelector("title"))||void 0===a?void 0:a.textContent}const c=aA("Save");return mf`<form class="converse-form chatroom-form ${n.length?"":"converse-form--spinner"}" autocomplete="off" @submit="${t=>e.submitConfigForm(t)}"><fieldset><legend class="centered">${i}</legend>${i!==r?mf`<p class="form-help">${r}</p>`:""} ${n.length&&e.model.features.get("vcard-temp")?mf`<div class="row py-2"><converse-image-picker .model="${e.model}" width="96" height="96"></converse-image-picker></div>`:""} ${n.length?n:BO({classes:"hor_centered"})}</fieldset>${n.length?mf`<fieldset><input type="submit" class="btn btn-primary" value="${c}"></fieldset>`:""}</form>`})(this)}shouldUpdate(e){return e.has("model")&&this.model&&(this.stopListening(),this.addListeners(),this.getConfig()),!0}getModalTitle(){return aA("Configure %1$s",this.model.getDisplayName())}getConfig(){return Lz((function*(){const e=yield this.model.fetchRoomConfiguration();this.model.session.set("config_stanza",e.outerHTML)})).call(this)}setAvatar(e){return Lz((function*(){if(!this.model.features.get("vcard-temp"))return;const t=new FormData(e.target).get("avatar_image");if(null==t?void 0:t.size){const e=oC?t:yield aC(t),n=new FileReader;n.onloadend=()=>Lz((function*(){const e={image:btoa(n.result),image_type:t.type};yield Wu.vcard.set(this.model.get("jid"),e)})).call(this),n.readAsBinaryString(e)}})).call(this)}submitConfigForm(e){return Lz((function*(){e.preventDefault();const t=Uz(':input:not([type=button]):not([type=submit]):not([name="avatar_image"][type="file"])',e.target).map(Bz.webForm2xForm).filter((e=>e));try{yield this.model.sendConfiguration(t)}catch(e){Q.error(e);const t=aA("Sorry, an error occurred while trying to submit the config form.")+" "+aA("Check your browser's developer console for details.");Wu.alert("error",aA("Error"),t)}try{yield this.setAvatar(e)}catch(e){return Q.fatal(e),void this.alert([aA("Sorry, an error happened while trying to save the groupchat avatar."),aA("You can check your browser's developer console for any error output.")].join(" "))}yield this.model.refreshDiscoInfo(),this.modal.hide()})).call(this)}constructor(e){super(e),this.id="converse-muc-config-modal"}});const Fz=e=>{var t;const n=e.config.toJSON(),r=e.features.toJSON(),i=e.occupants.filter((e=>"offline"!==e.get("show"))).length,s=aA("XMPP address"),o=aA("Message archiving"),a=aA("Messages are archived on the server"),c=aA("Description"),l=aA("Features"),u=aA("Hidden"),d=aA("This groupchat is not publicly searchable"),h=aA("This groupchat is restricted to members only"),f=aA("Members only"),p=aA("Moderated"),m=aA("Participants entering this groupchat need to request permission to write"),g=aA("Name"),v=aA("This groupchat does not require a password upon entry"),y=aA("No password required"),b=aA("Not anonymous"),_=aA("All other groupchat participants can see your XMPP address"),w=aA("Not moderated"),S=aA("Participants entering this groupchat can write right away"),x=aA("Online users"),A=aA("Open"),j=aA("Anyone can join this groupchat"),$=aA("This groupchat requires a password before entry"),E=aA("Password protected"),O=aA("Persistent"),C=aA("This groupchat persists even if it's unoccupied"),k=aA("Public"),T=aA("This groupchat is publicly searchable"),N=aA("Semi-anonymous"),M=aA("Only moderators can see your XMPP address"),I=aA("Temporary"),P=aA("This groupchat will disappear once the last person leaves");return mf`<div class="room-info"><converse-avatar .model="${e}" class="avatar align-self-center" name="${e.getDisplayName()}" nonce="${null===(t=e.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="72" width="72"></converse-avatar><p class="room-info"><strong>${g}:</strong> ${e.get("name")}</p><p class="room-info"><strong>${s}:</strong><converse-texture text="xmpp:${e.get("jid")}?join"></converse-texture></p><br><p class="room-info"><strong>${c}:</strong><converse-texture text="${n.description}" render_styling></converse-texture></p>${e.get("subject")?(e=>{const t=e.get("subject"),n=aA("Topic"),r=aA("Topic author");return mf`<p class="room-info"><strong>${n}:</strong><converse-texture text="${t.text}" render_styling></converse-texture></p><p class="room-info"><strong>${r}:</strong> ${t&&t.author}</p>`})(e):""}<p class="room-info"><strong>${x}:</strong> ${i}</p><p class="room-info"><strong>${l}:</strong></p><div class="chatroom-features"><ul class="features-list">${r.passwordprotected?mf`<li class="feature"><converse-icon size="1em" class="fa fa-lock"></converse-icon>${E} - <em>${$}</em></li>`:""} ${r.unsecured?mf`<li class="feature"><converse-icon size="1em" class="fa fa-unlock"></converse-icon>${y} - <em>${v}</em></li>`:""} ${r.hidden?mf`<li class="feature"><converse-icon size="1em" class="fa fa-eye-slash"></converse-icon>${u} - <em>${d}</em></li>`:""} ${r.public_room?mf`<li class="feature"><converse-icon size="1em" class="fa fa-eye"></converse-icon>${k} - <em>${T}</em></li>`:""} ${r.membersonly?mf`<li class="feature"><converse-icon size="1em" class="fa fa-address-book"></converse-icon>${f} - <em>${h}</em></li>`:""} ${r.open?mf`<li class="feature"><converse-icon size="1em" class="fa fa-globe"></converse-icon>${A} - <em>${j}</em></li>`:""} ${r.persistent?mf`<li class="feature"><converse-icon size="1em" class="fa fa-save"></converse-icon>${O} - <em>${C}</em></li>`:""} ${r.temporary?mf`<li class="feature"><converse-icon size="1em" class="fa fa-snowflake"></converse-icon>${I} - <em>${P}</em></li>`:""} ${r.nonanonymous?mf`<li class="feature"><converse-icon size="1em" class="fa fa-id-card"></converse-icon>${b} - <em>${_}</em></li>`:""} ${r.semianonymous?mf`<li class="feature"><converse-icon size="1em" class="fa fa-user-secret"></converse-icon>${N} - <em>${M}</em></li>`:""} ${r.moderated?mf`<li class="feature"><converse-icon size="1em" class="fa fa-gavel"></converse-icon>${p} - <em>${m}</em></li>`:""} ${r.unmoderated?mf`<li class="feature"><converse-icon size="1em" class="fa fa-info-circle"></converse-icon>${w} - <em>${S}</em></li>`:""} ${r.mam_enabled?mf`<li class="feature"><converse-icon size="1em" class="fa fa-database"></converse-icon>${o} - <em>${a}</em></li>`:""}</ul></div><p></p></div>`};var qz=n(8011),Hz={};Hz.styleTagTransform=D(),Hz.setAttributes=N(),Hz.insert=k().bind(null,"head"),Hz.domAPI=O(),Hz.insertStyleElement=I();$()(qz.A,Hz);qz.A&&qz.A.locals&&qz.A.locals;Wu.elements.define("converse-muc-details-modal",class extends ak{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"change",(()=>this.requestUpdate()))}renderModal(){return Fz(this.model)}getModalTitle(){return aA("Groupchat info")}});Wu.elements.define("converse-muc-nickname-modal",class extends ak{renderModal(){return mf`<converse-muc-nickname-form jid="${this.model.get("jid")}"></converse-muc-nickname-form>`}getModalTitle(){return aA("Change your nickname")}});var Gz=n(1742),Wz={};Wz.styleTagTransform=D(),Wz.setAttributes=N(),Wz.insert=k().bind(null,"head"),Wz.domAPI=O(),Wz.insertStyleElement=I();$()(Gz.A,Wz);Gz.A&&Gz.A.locals&&Gz.A.locals;customElements.define("converse-texture",class extends Lf{static get properties(){return{embed_audio:{type:Boolean},embed_videos:{type:Boolean},mentions:{type:Array},nick:{type:String},offset:{type:Number},onImgClick:{type:Function},onImgLoad:{type:Function},render_styling:{type:Boolean},show_images:{type:Boolean},hide_media_urls:{type:Boolean},show_me_message:{type:Boolean},text:{type:String}}}createRenderRoot(){return this}render(){const e={embed_audio:this.embed_audio,embed_videos:this.embed_videos,hide_media_urls:this.hide_media_urls,mentions:this.mentions,nick:this.nick,onImgClick:this.onImgClick,onImgLoad:this.onImgLoad,render_styling:this.render_styling,show_images:this.show_images,show_me_message:this.show_me_message};return qM(this.text,this.offset,e)}constructor(){super(),this.nick=null,this.onImgClick=null,this.onImgLoad=null,this.text=null,this.embed_audio=!1,this.embed_videos=!1,this.hide_media_urls=!1,this.mentions=[],this.offset=0,this.render_styling=!1,this.show_image_urls=!0,this.show_images=!1,this.show_me_message=!1}});var Vz=n(8185),Kz={};Kz.styleTagTransform=D(),Kz.setAttributes=N(),Kz.insert=k().bind(null,"head"),Kz.domAPI=O(),Kz.insertStyleElement=I();$()(Vz.A,Kz);Vz.A&&Vz.A.locals&&Vz.A.locals;function Jz(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Yz(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Jz(s,r,i,o,a,"next",e)}function a(e){Jz(s,r,i,o,a,"throw",e)}o(void 0)}))}}Wu.elements.define("converse-muc-heading",class extends uA{initialize(){return Yz((function*(){const{chatboxes:e}=Ao.state;this.model=e.get(this.getAttribute("jid")),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.user_settings=yield Ao.api.user.settings.getModel(),this.listenTo(this.user_settings,"change:mucs_with_hidden_subject",(()=>this.requestUpdate())),yield this.model.initialized;const t=this.model.occupants.findOccupant({jid:Ao.session.get("bare_jid")});t&&this.updateIfOwnOccupant(t),this.listenTo(this.model.occupants,"add",this.updateIfOwnOccupant),this.listenTo(this.model.occupants,"change:affiliation",this.updateIfOwnOccupant),this.listenTo(this.model.occupants,"change:role",this.updateIfOwnOccupant),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate())),this.requestUpdate()})).call(this)}render(){return this.model?(e=>{var t,n,r;const i=e.model.toJSON(),s=null===(n=e.user_settings)||void 0===n||null===(t=n.get("mucs_with_hidden_subject",[]))||void 0===t?void 0:t.includes(e.model.get("jid")),o=e.getHeadingButtons(s),a=aA("Hide the groupchat topic"),c=i.subject?i.subject.text:"",l=c&&!s;return mf`<div class="chatbox-title ${l?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${Ao.api.settings.get("singleton")?"":mf`<converse-controlbox-navback jid="${i.jid}"></converse-controlbox-navback>`} <a data-room-jid="${e.model.get("jid")}" title="${aA("Show more information on this groupchat")}" @click="${t=>e.showRoomDetailsModal(t)}"><converse-avatar .model="${e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${null===(r=e.model.vcard)||void 0===r?void 0:r.get("vcard_updated")}" height="40" width="40"></converse-avatar></a><div class="chatbox-title__text" role="heading" aria-level="2" title="${"hidden"!==Wu.settings.get("locked_muc_domain")?i.jid:""}">${e.model.getDisplayName()}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${NA(IN(o),"")} ${NA(PN(o),"")}</div></div>${l?mf`<p class="chat-head__desc" title="${a}"><converse-texture text="${c}" render_styling embed_audio></converse-texture></p>`:""}`})(this):""}updateIfOwnOccupant(e){const t=Ao.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}showRoomDetailsModal(e){e.preventDefault(),Wu.modal.show("converse-muc-details-modal",{model:this.model},e)}showNicknameModal(e){e.preventDefault(),Wu.modal.show("converse-muc-nickname-modal",{model:this.model},e)}toggleTopic(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.toggleSubjectHiddenState()}toggleOccupants(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.model.save({hidden_occupants:!this.model.get("hidden_occupants")})}showConfigModal(e){e.preventDefault(),Wu.modal.show("converse-muc-config-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}destroy(e){e.preventDefault(),XT(this.model)}getHeadingButtons(e){const t=[];t.push({i18n_text:aA("Details"),i18n_title:aA("Show more information about this groupchat"),handler:e=>this.showRoomDetailsModal(e),a_class:"show-muc-details-modal",icon_class:"fa-info-circle",name:"details"}),"owner"===this.model.getOwnAffiliation()&&t.push({i18n_text:aA("Configure"),i18n_title:aA("Configure this groupchat"),handler:e=>this.showConfigModal(e),a_class:"configure-chatroom-button",icon_class:"fa-wrench",name:"configure"}),t.push({i18n_text:aA("Nickname"),i18n_title:aA("Change the nickname you're using in this groupchat"),handler:e=>this.showNicknameModal(e),a_class:"open-nickname-modal",icon_class:"fa-smile",name:"nickname"});const n=this.model.get("subject");n&&n.text&&t.push({i18n_text:aA(e?"Show topic":"Hide topic"),i18n_title:aA(e?"Show the topic message in the heading":"Hide the topic in the heading"),handler:e=>this.toggleTopic(e),a_class:"hide-topic",icon_class:"fa-minus-square",name:"toggle-topic"}),t.push({i18n_text:this.model.get("hidden_occupants")?aA("Show participants"):aA("Hide participants"),i18n_title:this.model.get("hidden_occupants")?aA("Show the groupchat participants"):aA("Hide the groupchat participants"),handler:e=>this.toggleOccupants(e),icon_class:"fa-users"});if(this.model.session.get("connection_status")===Hp.ROOMSTATUS.ENTERED){const e=this.model.getAllowedCommands();e.includes("modtools")&&t.push({i18n_text:aA("Moderate"),i18n_title:aA("Moderate this groupchat"),handler:()=>nN(this.model),a_class:"moderate-chatroom-button",icon_class:"fa-user-cog",name:"moderate"}),e.includes("destroy")&&t.push({i18n_text:aA("Destroy"),i18n_title:aA("Remove this groupchat"),handler:e=>this.destroy(e),a_class:"destroy-chatroom-button",icon_class:"fa-trash",name:"destroy"})}Wu.settings.get("singleton")||t.push({i18n_text:aA("Leave"),i18n_title:aA("Leave and close this groupchat"),handler:e=>Yz((function*(){e.stopPropagation();const t=[aA("Are you sure you want to leave this groupchat?")];(yield Wu.confirm(aA("Confirm"),t))&&this.close(e)})).call(this),a_class:"close-chatbox-button",standalone:"overlayed"===Wu.settings.get("view_mode"),icon_class:"fa-sign-out-alt",name:"signout"});const{chatboxviews:r}=Ao.state,i=r.get(this.getAttribute("jid"));return i?Ao.api.hook("getHeadingButtons",i,t):Promise.resolve(t)}});class Xz extends uA{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback();const{chatboxes:e}=Ao.state;this.model=e.get(this.jid),this.listenTo(this.model,"change:password_validation_message",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=aA("This groupchat requires a password"),n=aA("Password: "),r=aA("Submit");return mf`<form class="converse-form chatroom-form converse-centered-form" @submit="${e.submitPassword}"><fieldset><label class="form-label">${t}</label><p class="validation-message">${e.validation_message}</p><input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.jid}"><input type="password" name="password" required="required" class="form-control ${e.validation_message?"error":""}" placeholder="${n}"></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${r}"></fieldset></form>`})({jid:this.model.get("jid"),submitPassword:e=>this.submitPassword(e),validation_message:this.model.get("password_validation_message")})}submitPassword(e){e.preventDefault();const t=this.querySelector("input[type=password]").value;this.model.join(this.model.get("nick"),t),this.model.set("password_validation_message",null)}constructor(){super(),this.jid=null}}Wu.elements.define("converse-muc-password-form",Xz);function Qz(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Zz(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class eL extends qP{initialize(){return(e=function*(){this.model=yield Wu.rooms.get(this.jid),Ao.state.chatboxviews.add(this.jid,this),this.setAttribute("id",this.model.get("box_id")),this.listenTo(this.model.session,"change:connection_status",this.onConnectionStatusChanged),this.listenTo(this.model.session,"change:view",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),this.onConnectionStatusChanged(),this.model.maybeShow(),Wu.trigger("chatRoomViewInitialized",this)},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Qz(s,r,i,o,a,"next",e)}function a(e){Qz(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){return(e=>{const t=e.model?NN(e.model):"";return mf`<div class="flyout box-flyout" style="${t||yf}">${"overlayed"===Wu.settings.get("view_mode")?mf`<converse-dragresize></converse-dragresize>`:""} ${e.model?mf`<converse-muc-heading jid="${e.model.get("jid")}" class="chat-head chat-head-chatroom row g-0"></converse-muc-heading><div class="chat-body chatroom-body row g-0">${QT(e.model)}</div>`:""}</div>`})(this)}onConnectionStatusChanged(){this.model.session.get("connection_status")===Hp.ROOMSTATUS.CONNECTING&&(this.model.session.save({disconnection_actor:void 0,disconnection_message:void 0,disconnection_reason:void 0}),this.model.save({moved_jid:void 0,password_validation_message:void 0,reason:void 0})),this.requestUpdate()}constructor(...e){super(...e),Zz(this,"length",300),Zz(this,"is_chatroom",!0)}}Wu.elements.define("converse-muc",eL);var tL=n(4659),nL={};nL.styleTagTransform=D(),nL.setAttributes=N(),nL.insert=k().bind(null,"head"),nL.domAPI=O(),nL.insertStyleElement=I();$()(tL.A,nL);tL.A&&tL.A.locals&&tL.A.locals;function rL(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:iL}=Hp.env,{CHATROOMS_TYPE:sL}=Xx;Hp.MUC.VIEWS={CONFIG:"config-form"},Hp.plugins.add("converse-muc-views",{dependencies:["converse-modal","converse-controlbox","converse-chatview"],initialize(){const{_converse:e}=this;Wu.settings.extend({auto_list_rooms:!1,cache_muc_messages:!0,locked_muc_nickname:!1,modtools_disable_query:[],muc_disable_slash_commands:!1,muc_mention_autocomplete_filter:"contains",muc_mention_autocomplete_min_chars:0,muc_mention_autocomplete_show_avatar:!0,muc_roomid_policy:null,muc_roomid_policy_hint:null,muc_search_service:"api@search.jabber.network",roomconfig_whitelist:[],show_retraction_warning:!0});const t={ChatRoomView:eL,MUCView:eL};Object.assign(e,t),Object.assign(e.exports,t),Wu.settings.get("muc_domain")||Wu.listen.on("serviceDiscovered",(e=>{return(t=function*(){if((null==e?void 0:e.get("var"))===iL.NS.MUC){if(e.entity.get("jid").includes("@"))return;(yield e.entity.getIdentity("conference","text"))&&Wu.settings.set("muc_domain",iL.getDomainFromJid(e.get("from")))}},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){rL(s,r,i,o,a,"next",e)}function a(e){rL(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t})),Wu.listen.on("clearsession",(()=>{const t=e.chatboxviews.get("controlbox");t&&t.roomspanel&&(t.roomspanel.model.destroy(),t.roomspanel.remove(),delete t.roomspanel)})),Wu.listen.on("chatBoxClosed",(e=>{var t;e.get("type")===sL&&(t=e.get("jid"),location.hash===`converse/room?jid=${t}`&&history.pushState(null,"",window.location.pathname))})),Wu.listen.on("parseMessageForCommands",rN),Wu.listen.on("confirmDirectMUCInvitation",YT)}});var oL=n(1933),aL=n.n(oL);function cL(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function lL(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){cL(s,r,i,o,a,"next",e)}function a(e){cL(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:uL,u:dL}=Hp.env,{isEmptyMessage:hL,isTestEnv:fL}=dL,pL="Notification"in window;let mL;function gL(e){var t,n;return fL()||null!==(n=null===(t=Ao.state.chatboxes.get(e))||void 0===t?void 0:t.isHidden())&&void 0!==n&&n||document.hidden}function vL(){return fL()||pL&&Wu.settings.get("show_desktop_notifications")&&"granted"===Notification.permission}function yL(){var e,t;null==mL||mL.badge(0),mL=null,null===(e=(t=navigator).clearAppBadge)||void 0===e||e.call(t).catch((e=>Q.error("Could not clear unread count in app badge "+e)))}function bL(){if(Wu.settings.get("show_tab_notifications")){var e,t;mL=null!=mL?mL:new Hp.env.Favico({type:"circle",animation:"pop"});const n=Ao.state.chatboxes.models.reduce(((e,t)=>e+(t.get("num_unread")||0)),0);mL.badge(n),null===(e=(t=navigator).setAppBadge)||void 0===e||e.call(t,n).catch((e=>Q.error("Could set unread count in app badge - "+e)))}}function _L(e,t,n){const r=Ao.session.get("bare_jid");return e.reduce(((e,i)=>e||i.uri&&(e=>[r,`${t}/${n}`].includes(e.uri.replace(/^xmpp:/,"")))(i)),!1)}function wL(e){const{attrs:t}=e;if(!t||t.is_forwarded)return!1;if("groupchat"===t.type)return function(e){return lL((function*(){if(!(null==e?void 0:e.body)&&!(null==e?void 0:e.message))return!1;const t=e.from,n=e.from_muc,r=Wu.settings.get("notify_all_room_messages"),i=Ao.state.chatboxes.get(n),s=uL.getResourceFromJid(t),o=s&&uL.unescapeNode(s)||"";let a=!1;const c=i.get("nick");Wu.settings.get("notify_nicknames_without_references")&&(a=new RegExp(`\\b${c}\\b`).test(e.body));const l=o!==c,u=!0===r||Array.isArray(r)&&r.includes(n)||_L(e.references,n,c)||a;return!(!l||!u)&&(yield Wu.hook("shouldNotifyOfGroupMessage",e,!0))}))()}(t);if("info"===t.type)return function(e){return lL((function*(){if(!e.from_muc)return!1;const t=yield Wu.rooms.get(e.from_muc);if(!t)return!1;const n=t.get("nick"),r=e.from_muc,i=Wu.settings.get("notify_all_room_messages");return!0===i||Array.isArray(i)&&i.includes(r)||_L(e.references,r,n)}))()}(t);if(t.is_headline)return gL(t);const n=Ao.session.get("bare_jid"),r=uL.getBareJidFromJid(t.from)===n;return!hL(t)&&!r&&("all"===Wu.settings.get("show_desktop_notifications")||gL(t))}function SL(e){return lL((function*(){if(!(yield wL(e)))return!1;Wu.trigger("messageNotification",e);try{!function(){if(Wu.settings.get("play_sounds")&&void 0!==window.Audio){const e=new Audio(Wu.settings.get("sounds_path")+"msg_received.ogg"),t=e.canPlayType("audio/ogg");if("probably"===t)return e.play();const n=new Audio(Wu.settings.get("sounds_path")+"msg_received.mp3"),r=n.canPlayType("audio/mp3");"probably"===r?n.play():"maybe"===t?e.play():"maybe"===r&&n.play()}}()}catch(e){Q.error(e)}!function(e){const{attrs:t}=e;if(t.is_error)return;if(!vL())return;let n,r;const i=t.from,s=uL.getBareJidFromJid(i);if("info"==t.type)n=t.message;else if("headline"===t.type){if(s.includes("@")&&!Wu.settings.get("allow_non_roster_messaging"))return;n=aA("Notification from %1$s",s)}else if(s.includes("@"))if("groupchat"===t.type)n=aA("%1$s says",uL.getResourceFromJid(i));else{if(void 0===Ao.state.roster)return void Q.error("Could not send notification, because roster is undefined");if(r=Ao.state.roster.get(s),void 0!==r)n=aA("%1$s says",r.getDisplayName());else{if(!Wu.settings.get("allow_non_roster_messaging"))return;n=aA("%1$s says",s)}}else n=aA("Notification from %1$s",s);let o;if("info"==t.type)o=t.reason;else if(o=t.is_encrypted?t.plaintext:t.body,!o)return;const a=new Notification(n,{body:o,lang:oA.getLocale(),icon:Wu.settings.get("notification_icon"),requireInteraction:!Wu.settings.get("notification_delay")});Wu.settings.get("notification_delay")&&setTimeout((()=>a.close()),Wu.settings.get("notification_delay")),a.onclick=function(e){e.preventDefault(),window.focus(),Ao.state.chatboxes.get(s).maybeShow(!0)}}(e)}))()}function xL(e){vL()&&function(e){if("error"===e.klass||"warn"===e.klass){const t=new Notification(e.subject,{body:e.message,lang:oA.getLocale(),icon:Wu.settings.get("notification_icon")});setTimeout(t.close.bind(t),5e3)}}(e)}function AL(e){vL()&&Wu.settings.get("show_chat_state_notifications")&&function(e){var t;if(null===(t=Wu.settings.get("chatstate_notification_blacklist"))||void 0===t?void 0:t.includes(e.get("jid")))return;const n=e.presence.get("show");let r=null;if("offline"===n?r=aA("has gone offline"):"away"===n?r=aA("has gone away"):"dnd"===n?r=aA("is busy"):"online"===n&&(r=aA("has come online")),null===r)return;const i=new Notification(e.getDisplayName(),{body:r,lang:oA.getLocale(),icon:Wu.settings.get("notification_icon")});setTimeout((()=>i.close()),5e3)}(e)}function jL(e){vL()&&function(e){const t=new Notification(e.getDisplayName(),{body:aA("wants to be your contact"),lang:oA.getLocale(),icon:Wu.settings.get("notification_icon")});setTimeout((()=>t.close()),5e3)}(e)}function $L(){pL&&!["denied","granted"].includes(Notification.permission)&&Notification.requestPermission()}Hp.env.Favico=aL(),Hp.plugins.add("converse-notification",{dependencies:["converse-chatboxes"],initialize(){Wu.settings.extend({chatstate_notification_blacklist:[],notification_delay:5e3,notification_icon:"/images/logo/conversejs-filled.svg",notify_all_room_messages:!1,notify_nicknames_without_references:!1,play_sounds:!0,show_chat_state_notifications:!1,show_desktop_notifications:!0,show_tab_notifications:!0,sounds_path:Wu.settings.get("assets_path")+"/sounds/"}),Wu.listen.on("clearSession",yL),Wu.waitUntil("chatBoxesInitialized").then((()=>{const{chatboxes:e}=Ao.state;e.on("change:num_unread",bL)})),Wu.listen.on("pluginsInitialized",(function(){Wu.listen.on("contactRequest",jL),Wu.listen.on("contactPresenceChanged",AL),Wu.listen.on("message",SL),Wu.listen.on("feedback",xL),Wu.listen.on("connected",$L)}))}});function EL(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:OL,$iq:CL,sizzle:kL,u:TL}=Hp.env;Wu.elements.define("converse-change-password-form",class extends uA{static get properties(){return{passwords_mismatched:{type:Boolean},alert_message:{type:String}}}initialize(){this.passwords_mismatched=!1,this.alert_message=""}render(){return(e=>{const t=aA("Submit"),n=aA("The new passwords must match"),r=aA("New password"),i=aA("Confirm new password");return mf`<form class="converse-form passwordreset-form" method="POST" @submit="${t=>e.onSubmit(t)}">${e.alert_message?mf`<div class="alert alert-danger" role="alert">${e.alert_message}</div>`:""}<div class="py-2"><label for="converse_password_reset_new" class="form-label">${r}</label> <input class="form-control ${e.passwords_mismatched?"error":""}" type="password" name="password" required="required" id="converse_password_reset_new" autocomplete="new-password" minlength="8" ?disabled="${e.alert_message}"></div><div class="py-2"><label for="converse_password_reset_check" class="form-label">${i}</label> <input class="form-control ${e.passwords_mismatched?"error":""}" type="password" name="password_check" required="required" id="converse_password_reset_check" autocomplete="new-password" minlength="8" ?disabled="${e.alert_message}" @input="${t=>e.checkPasswordsMatch(t)}"> ${e.passwords_mismatched?mf`<span class="error">${n}</span>`:""}</div><input class="save-form btn btn-primary" type="submit" value="${t}" ?disabled="${e.alert_message}"></form>`})(this)}checkPasswordsMatch(e){var t;const n=new FormData(null!==(t=e.target.form)&&void 0!==t?t:e.target),r=n.get("password"),i=n.get("password_check");return this.passwords_mismatched=r&&r!==i,this.passwords_mismatched}onSubmit(e){return(t=function*(){if(e.preventDefault(),this.checkPasswordsMatch(e))return;const t=Ao.session.get("domain"),n=CL({type:"get",to:t}).c("query",{xmlns:OL.NS.REGISTER}),r=yield Wu.sendIQ(n);if(null===r)return void(this.alert_message=aA("Timeout error"));if(kL(`error service-unavailable[xmlns="${OL.NS.STANZAS}"]`,r).length)return void(this.alert_message=aA("Your server does not support password reset"));if(TL.isErrorStanza(r))return this.alert_message=aA("Your server responded with an unknown error, check the console for details"),Q.error("Could not set password"),void Q.error(r);const i=r.querySelector("username").textContent,s=new FormData(e.target).get("password"),o=CL({type:"set",to:t}).c("query",{xmlns:OL.NS.REGISTER}).c("username",{},i).c("password",{},s),a=yield Wu.sendIQ(o);null===a?this.alert_message=aA("Timeout error while trying to set your password"):kL(`error not-allowed[xmlns="${OL.NS.STANZAS}"]`,a).length?this.alert_message=aA("Your server does not allow password reset"):kL(`error forbidden[xmlns="${OL.NS.STANZAS}"]`,a).length||TL.isErrorStanza(a)?this.alert_message=aA("You are not allowed to change your password"):Wu.alert("info",aA("Success"),[aA("Your new password has been set")])},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){EL(s,r,i,o,a,"next",e)}function a(e){EL(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}});function NL(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ML=e=>{var t,n;const r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){NL(e,t,n[t])}))}return e}({},e.model.toJSON(),null===(t=e.model.vcard)||void 0===t?void 0:t.toJSON()),i=aA("Email"),s=aA("Full Name"),o=aA("XMPP Address"),a=aA("Nickname"),c=aA("Role"),l=aA("Save and close"),u=aA("Use commas to separate multiple roles. Your roles are shown next to your name on your chat messages."),d=aA("URL"),h=aA("Status"),f=aA("OMEMO"),p=aA("Profile"),m=aA("Reset Password"),g=new Map;return g.set("status",mf`<li role="presentation" class="nav-item"><a class="nav-link ${"status"===e.tab?"active":""}" id="status-tab" href="#status-tabpanel" aria-controls="status-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="status" data-toggle="tab">${h}</a></li>`),g.set("profile",mf`<li role="presentation" class="nav-item"><a class="nav-link ${"profile"===e.tab?"active":""}" id="profile-tab" href="#profile-tabpanel" aria-controls="profile-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="profile" data-toggle="tab">${p}</a></li>`),function(){const e=Ao.api.connection.get()._sasl_mechanism;return"EXTERNAL"!==e.mechname&&"ANONYMOUS"!==e.mechname&&"X-OAUTH2"!==e.mechname&&"OAUTHBEARER"!==e.mechname}()&&g.set("passwordreset",mf`<li role="presentation" class="nav-item"><a class="nav-link ${"passwordreset"===e.tab?"active":""}" id="passwordreset-tab" href="#passwordreset-tabpanel" aria-controls="passwordreset-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="passwordreset" data-toggle="tab">${m}</a></li>`),(null===(n=Ao.pluggable.plugins["converse-omemo"])||void 0===n?void 0:n.enabled(Ao))&&g.set("omemo",mf`<li role="presentation" class="nav-item"><a class="nav-link ${"omemo"===e.tab?"active":""}" id="omemo-tab" href="#omemo-tabpanel" aria-controls="omemo-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="omemo" data-toggle="tab">${f}</a></li>`),mf`${g.size?mf`<ul class="nav nav-pills justify-content-center">${Array.from(g.values())}</ul>`:""}<div class="tab-content">${g.get("passwordreset")?mf`<div class="tab-pane ${"status"===e.tab?"active":""}" id="status-tabpanel" role="tabpanel" aria-labelledby="status-tab">${"status"===e.tab?(e=>{const t=aA("Away"),n=aA("Busy"),r=aA("Online"),i=aA("Set status"),s=aA("Away for long"),o=aA("Personal status message"),a=e.model.get("show")||e.model.get("presence"),c=e.model.get("status_message");return mf`<form class="converse-form set-xmpp-status" id="set-xmpp-status" @submit="${t=>e.onStatusFormSubmitted(t)}"><div class="mb-3"><div class="form-check"><input ?checked="${"online"===a}" type="radio" id="radio-online" value="online" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-online"><converse-icon size="1em" class="fa fa-circle chat-status chat-status--online"></converse-icon> ${r}</label></div><div class="form-check"><input ?checked="${"busy"===a}" type="radio" id="radio-busy" value="dnd" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-busy"><converse-icon size="1em" class="fa fa-minus-circle chat-status chat-status--busy"></converse-icon> ${n}</label></div><div class="form-check"><input ?checked="${"away"===a}" type="radio" id="radio-away" value="away" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-away"><converse-icon size="1em" class="fa fa-circle chat-status chat-status--away"></converse-icon> ${t}</label></div><div class="form-check"><input ?checked="${"xa"===a}" type="radio" id="radio-xa" value="xa" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-xa"><converse-icon size="1em" class="far fa-circle chat-status chat-status--xa"></converse-icon> ${s}</label></div></div><div class="mb-3"><div class="${e._show_clear_button?"input-group":""}"><input name="status_message" type="text" class="form-control" autofocus value="${c||""}" placeholder="${o}" @input="${t=>e._show_clear_button=!!t.target.value}"> <button type="button" class="btn btn-outline-secondary" @click="${t=>e.clearStatusMessage(t)}" title="${aA("Clear status message")}" ?hidden="${!e._show_clear_button}"><converse-icon size="1em" class="fa fa-times"></converse-icon></button></div></div><button type="submit" class="btn btn-primary">${i}</button></form>`})(e):""}</div>`:""}<div class="tab-pane ${"profile"===e.tab?"active":""}" id="profile-tabpanel" role="tabpanel" aria-labelledby="profile-tab"><form class="converse-form converse-form--modal" action="#" @submit="${t=>e.onProfileFormSubmitted(t)}"><div class="row py-2"><div class="col-auto"><converse-image-picker .model="${e.model}" width="128" height="128"></converse-image-picker></div><div class="col"><div class="px-3"><label class="col-form-label">${o}:</label><div>${r.jid}</div></div></div></div><div><label for="vcard-fullname" class="col-form-label">${s}:</label> <input id="vcard-fullname" type="text" class="form-control" name="fn" value="${r.fullname||""}"></div><div><label for="vcard-nickname" class="col-form-label">${a}:</label> <input id="vcard-nickname" type="text" class="form-control" name="nickname" value="${r.nickname||""}"></div><div><label for="vcard-url" class="col-form-label">${d}:</label> <input id="vcard-url" type="url" class="form-control" name="url" value="${r.url||""}"></div><div><label for="vcard-email" class="col-form-label">${i}:</label> <input id="vcard-email" type="email" class="form-control" name="email" value="${r.email||""}"></div><div><label for="vcard-role" class="col-form-label pb-0">${c}:</label> <small id="vcard-role-help" class="d-block pb-1 form-text text-muted">${u}</small> <input id="vcard-role" type="text" class="form-control" name="role" value="${r.role||""}" aria-describedby="vcard-role-help"></div><div class="mt-3">${e._submitting?mf`<converse-spinner></converse-spinner>`:mf`<button type="submit" class="save-form btn btn-primary">${l}</button>`}</div></form></div>${g.get("passwordreset")?mf`<div class="tab-pane ${"passwordreset"===e.tab?"active":""}" id="passwordreset-tabpanel" role="tabpanel" aria-labelledby="passwordreset-tab">${"passwordreset"===e.tab?mf`<converse-change-password-form></converse-change-password-form>`:""}</div>`:""} ${g.get("omemo")?function(e){return mf`<div class="tab-pane ${"omemo"===e.tab?"active":""}" id="omemo-tabpanel" role="tabpanel" aria-labelledby="omemo-tab">${"omemo"===e.tab?mf`<converse-omemo-profile></converse-omemo-profile>`:""}</div>`}(e):""}</div>`};var IL=n(7808),PL={};PL.styleTagTransform=D(),PL.setAttributes=N(),PL.insert=k().bind(null,"head"),PL.domAPI=O(),PL.insertStyleElement=I();$()(IL.A,PL);IL.A&&IL.A.locals&&IL.A.locals;function DL(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function RL(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){DL(s,r,i,o,a,"next",e)}function a(e){DL(s,r,i,o,a,"throw",e)}o(void 0)}))}}class zL extends ak{initialize(){super.initialize(),this.listenTo(this.model,"change",this.render),this.addEventListener("shown.bs.modal",(()=>{var e;null===(e=this.querySelector('input[name="status_message"]'))||void 0===e||e.focus()}),!1),Wu.trigger("profileModalInitialized",this.model)}willUpdate(e){e.has("model")&&(this._show_clear_button=!!this.model.get("status_message"))}getModalTitle(){return aA("Your Profile")}renderModal(){return ML(this)}renderModalFooter(){return Wu.settings.get("allow_logout")?mf`<div class="modal-footer d-flex justify-content-between">${YC} ${(e=>{const t=aA("Log out");return mf`<button type="button" @click="${t=>e.logOut(t)}" class="btn btn-danger">${Wu.settings.get("allow_logout")?mf`<converse-icon class="fas fa-sign-out-alt" color="var(--background-color)" size="1em"></converse-icon> ${t}`:""}</button>`})(this)}</div>`:""}setVCard(e){return RL((function*(){const t=Ao.session.get("bare_jid");try{yield Wu.vcard.set(t,e)}catch(e){return Q.fatal(e),this.alert([aA("Sorry, an error happened while trying to save your profile data."),aA("You can check your browser's developer console for any error output.")].join(" ")),!1}return!0})).call(this)}onProfileFormSubmitted(e){return RL((function*(){e.preventDefault(),this._submitting=!0;const t=new FormData(e.target),n=t.get("avatar_image"),r={fn:t.get("fn"),nickname:t.get("nickname"),role:t.get("role"),email:t.get("email"),url:t.get("url")};if(null==n?void 0:n.size){const e=yield aC(n),t=new FileReader;t.onloadend=()=>RL((function*(){Object.assign(r,{image:btoa(t.result),image_type:n.type}),(yield this.setVCard(r))&&(this._submitting=!1,this.modal.hide())})).call(this),t.readAsBinaryString(e)}else Object.assign(r,{image:this.model.vcard.get("image"),image_type:this.model.vcard.get("image_type")}),(yield this.setVCard(r))&&(this.modal.hide(),Wu.toast.show("vcard-updated",{type:"success",body:aA("Profile updated successfully")})),this._submitting=!1})).call(this)}onStatusFormSubmitted(e){e.preventDefault();const t=new FormData(e.target);let n,r;const i=t.get("chat_status");"online"===i?r="online":n=i,this.model.save({status_message:t.get("status_message"),presence:r,show:n}),this.alert(aA("Status updated"),"info")}clearStatusMessage(e){e&&e.preventDefault&&e.preventDefault(),this._show_clear_button=!1;this.querySelector('input[name="status_message"]').value=""}logOut(e){return RL((function*(){null==e||e.preventDefault(),this.close();(yield Wu.confirm(aA("Confirm"),aA("Are you sure you want to log out?")))&&Wu.user.logout()})).call(this)}constructor(e){super(e),this.tab="status",this._show_clear_button=!1}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(zL,"properties",{_submitting:{state:!0},_show_clear_button:{type:Boolean,state:!0},model:{type:ae.Model},tab:{type:String}}),Wu.elements.define("converse-profile-modal",zL);const LL=e=>{var t;const n=aA("%1$s Open Source %2$s XMPP chat client brought to you by %3$s Opkode %2$s",'<a target="_blank" rel="nofollow" href="https://conversejs.org">',"</a>",'<a target="_blank" rel="nofollow" href="https://opkode.com">'),r=aA("%1$s Translate %2$s it into your own language",'<a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">',"</a>"),i=Wu.settings.get("show_client_info"),s=Wu.settings.get("allow_adhoc_commands");return mf`${i&&s?(e=>{var t;const n=aA("About"),r=aA("Commands"),i=aA("Services"),s=Wu.settings.get("show_client_info"),o=Wu.settings.get("allow_adhoc_commands"),a=null===(t=Ao.pluggable.plugins["converse-disco-views"])||void 0===t?void 0:t.enabled(Ao);return mf`${(s?1:0)+(o?1:0)+(a?1:0)>=2?mf`<ul class="nav nav-pills justify-content-center">${s?mf`<li role="presentation" class="nav-item"><a class="nav-link ${"about"===e.tab?"active":""}" id="about-tab" href="#about-tabpanel" aria-controls="about-tabpanel" role="tab" data-toggle="tab" data-name="about" @click="${t=>e.switchTab(t)}">${n}</a></li>`:""} ${o?mf`<li role="presentation" class="nav-item"><a class="nav-link ${"commands"===e.tab?"active":""}" id="commands-tab" href="#commands-tabpanel" aria-controls="commands-tabpanel" role="tab" data-toggle="tab" data-name="commands" @click="${t=>e.switchTab(t)}">${r}</a></li>`:""} ${a?mf`<li role="presentation" class="nav-item"><a class="nav-link ${"disco"===e.tab?"active":""}" id="server-tab" href="#server-tabpanel" aria-controls="server-tabpanel" role="tab" data-toggle="tab" data-name="disco" @click="${t=>e.switchTab(t)}">${i}</a></li>`:""}</ul>`:""}`})(e):""}<div class="tab-content">${i?mf`<div class="tab-pane tab-pane--columns ${"about"===e.tab?"active":""}" id="about-tabpanel" role="tabpanel" aria-labelledby="about-tab"><div class="container"><converse-brand-logo class="d-flex justify-content-center mt-3" hide_byline></converse-brand-logo><p class="text-center brand-subtitle">${Ao.VERSION_NAME}</p><p class="text-center brand-subtitle">${eP(Xd.sanitize(n))}</p><p class="text-center brand-subtitle">${eP(Xd.sanitize(r))}</p></div></div>`:""} ${s?mf`<div class="tab-pane tab-pane--columns ${"commands"===e.tab?"active":""}" id="commands-tabpanel" role="tabpanel" aria-labelledby="commands-tab"><converse-adhoc-commands></div>`:""} ${(null===(t=Ao.pluggable.plugins["converse-disco-views"])||void 0===t?void 0:t.enabled(Ao))?mf`<div class="tab-pane tab-pane--columns ${"disco"===e.tab?"active":""}" id="server-tabpanel" role="tabpanel" aria-labelledby="server-tab">${"disco"===e.tab?mf`<converse-disco-browser></converse-disco-browser>`:""}</div>`:""}</div>`};var UL=n(1950),BL={};BL.styleTagTransform=D(),BL.setAttributes=N(),BL.insert=k().bind(null,"head"),BL.domAPI=O(),BL.insertStyleElement=I();$()(UL.A,BL);UL.A&&UL.A.locals&&UL.A.locals;Wu.elements.define("converse-user-settings-modal",class extends ak{renderModal(){return LL(this)}getModalTitle(){return aA("Settings")}constructor(e){super(e);const t=Wu.settings.get("show_client_info"),n=Wu.settings.get("allow_adhoc_commands");t&&n||t?this.tab="about":n&&(this.tab="commands")}});const FL=e=>{var t;const n=e.model.get("show"),r=e.model.get("presence")||"online",i=n||r,s=e.model.get("status_message")||aA("I am %1$s","chat"===(o=i)?aA("online"):"dnd"===o?aA("busy"):"xa"===o?aA("away for long"):"away"===o?aA("away"):"offline"===o?aA("offline"):aA(o)||aA("online"));var o;const a=aA("Update your profile"),c=aA("Click to change your chat status");let l,u;return[l,u]="chat"===n||!n&&"online"===r?["fa fa-circle chat-status","chat-status-online"]:"dnd"===n?["fa fa-minus-circle chat-status","chat-status-busy"]:"away"===n||"xa"===n?["fa fa-circle chat-status","chat-status-away"]:["fa fa-circle chat-status","comment"],mf`<div class="userinfo"><div class="controlbox-section profile d-flex justify-content-between"><a class="show-profile" href="#" @click="${t=>e.showProfileModal(t,"profile")}" title="${a}"><converse-avatar class="avatar align-self-center" .model="${e.model}" name="${e.model.getDisplayName()}" nonce="${null===(t=e.model.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="40" width="40"></converse-avatar><span class="username align-self-center w-100" role="heading" aria-level="2">${e.model.getDisplayName()}</span></a><converse-controlbox-buttons></converse-controlbox-buttons></div><div class="d-flex xmpp-status"><a class="change-status" title="${c}" data-toggle="modal" data-target="#changeStatusModal" @click="${t=>e.showProfileModal(t)}"><span class="${i} w-100" data-value="${i}"><converse-icon color="var(--${u})" css="margin-top: -0.1em" size="0.82em" class="${l}"></converse-icon><span class="xmpp-status__msg">${s}</span></span></a></div></div>`};var qL=n(9845),HL={};HL.styleTagTransform=D(),HL.setAttributes=N(),HL.insert=k().bind(null,"head"),HL.domAPI=O(),HL.insertStyleElement=I();$()(qL.A,HL);qL.A&&qL.A.locals&&qL.A.locals;class GL extends uA{initialize(){this.model=Ao.state.profile,this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate()))}render(){return FL(this)}showProfileModal(e,t="status"){null==e||e.preventDefault(),Wu.modal.show("converse-profile-modal",{model:this.model,tab:t},e)}}Wu.elements.define("converse-user-profile",GL);Hp.plugins.add("converse-profile",{dependencies:["converse-status","converse-modal","converse-vcard","converse-chatboxviews","converse-adhoc-views"],initialize(){Wu.settings.extend({show_client_info:!0})}});const WL={name:"AES-GCM",length:128};class VL extends Error{constructor(e,t){super(e),this.name="IQError",this.iq=t}}class KL extends Error{constructor(e){super(e),this.name="UserFacingError",this.user_facing=!0}}function JL(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function YL(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){JL(s,r,i,o,a,"next",e)}function a(e){JL(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:XL,stx:QL,sizzle:ZL}=Hp.env;class eU extends ae.Model{get idAttribute(){return"jid"}initialize(){var e=this,t=()=>super.initialize;return YL((function*(){t().call(e),this.initialized=ue(),yield this.initDevices(),this.initialized.resolve()})).call(this)}initDevices(){this.devices=new Ao.exports.Devices;const e=`converse.devicelist-${Ao.session.get("bare_jid")}-${this.get("jid")}`;return Up.initStorage(this.devices,e),this.fetchDevices()}onDevicesFound(e){return YL((function*(){if(0===e.length){let e=[];try{e=yield this.fetchDevicesFromServer()}catch(e){null===e?(Q.error(`Timeout error while fetching OMEMO devices for ${this.get("jid")}`),this.destroy()):Up.isElement(e)&&(yield rm(e))instanceof Kl?Q.debug(`No OMEMO devices found for ${this.get("jid")}`):(Q.error(`Could not fetch OMEMO devices for ${this.get("jid")}`),Q.error(e),this.destroy())}const t=Ao.session.get("bare_jid");this.get("jid")===t&&this.publishCurrentDevice(e)}})).call(this)}fetchDevices(){return void 0===this._devices_promise&&(this._devices_promise=new Promise((e=>{this.devices.fetch({success:t=>e(this.onDevicesFound(t)),error:(t,n)=>{Q.error(n),e()}})}))),this._devices_promise}getOwnDeviceId(){return YL((function*(){const{omemo_store:e}=Ao.state;let t=e.get("device_id");return this.devices.get(t)||(yield e.generateBundle(),t=e.get("device_id")),t})).call(this)}publishCurrentDevice(e){return YL((function*(){const t=Ao.session.get("bare_jid");if(this.get("jid")===t){if(yield Wu.omemo.session.restore(),Ao.state.omemo_store)return e.includes(yield this.getOwnDeviceId())?void 0:this.publishDevices();Q.debug("publishCurrentDevice: omemo_store is not defined, likely a timing issue")}})).call(this)}fetchDevicesFromServer(){return YL((function*(){const e=Ao.session.get("bare_jid"),t=QL`
            <iq type='get' from='${e}' to='${this.get("jid")}' xmlns="jabber:client">
                <pubsub xmlns='${XL.NS.PUBSUB}'>
                    <items node='${XL.NS.OMEMO_DEVICELIST}'/>
                </pubsub>
            </iq>`,n=yield Wu.sendIQ(t),r=`list[xmlns="${XL.NS.OMEMO}"] device`,i=ZL(r,n).map((e=>e.getAttribute("id"))),s=this.get("jid");return Promise.all(i.map((e=>this.devices.create({id:e,jid:s},{promise:!0}))))})).call(this)}publishDevices(){const e=QL`
            <item id='current'>
                <list xmlns='${XL.NS.OMEMO}'>
                    ${this.devices.filter((e=>e.get("active"))).map((e=>QL`<device id='${e.get("id")}'/>`))}
                </list>
            </item>`;return Wu.pubsub.publish(null,XL.NS.OMEMO_DEVICELIST,e,{access_model:"open"},!1)}removeOwnDevices(e){return YL((function*(){const t=Ao.session.get("bare_jid");if(this.get("jid")!==t)throw new Error("Cannot remove devices from someone else's device list");return yield Promise.all(e.map((e=>this.devices.get(e))).map((e=>new Promise((t=>e.destroy({success:t,error:(e,n)=>{Q.error(n),t()}})))))),this.publishDevices()})).call(this)}}const tU=eU;class nU extends ae.Collection{constructor(){super(),this.model=tU}}const rU=nU;function iU(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function sU(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){iU(s,r,i,o,a,"next",e)}function a(e){iU(s,r,i,o,a,"throw",e)}o(void 0)}))}}function oU(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aU(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const{Strophe:cU,sizzle:lU,stx:uU}=Hp.env,{CHATROOMS_TYPE:dU,PRIVATE_CHAT_TYPE:hU}=Xx,{appendArrayBuffer:fU,arrayBufferToBase64:pU,arrayBufferToHex:mU,arrayBufferToString:gU,base64ToArrayBuffer:vU,hexToArrayBuffer:yU,initStorage:bU,isAudioURL:_U,isError:wU,isImageURL:SU,isVideoURL:xU,stringToArrayBuffer:AU}=Up;function jU(e){e=e.replace(/^05/,"");for(let t=1;t<8;t++){const n=8*t+t-1;e=e.slice(0,n)+" "+e.slice(n)}return e}function $U(e){return sU((function*(){return(yield BU(e)).length>0}))()}function EU(e,t){return e.get("omemo_active")&&t.body?aU(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){oU(e,t,n[t])}))}return e}({},t),{is_encrypted:!0,plaintext:t.body,body:aA("This is an OMEMO encrypted message which your client doesn’t seem to support. Find more information on https://conversations.im/omemo")}):t}function OU(e){return sU((function*(){const t=new URL(e),n="localhost"===window.location.hostname&&"localhost"===t.hostname?"http":"https",r=t.toString().replace(/^aesgcm/,n),i=yield function(e){return sU((function*(){let t;try{t=yield fetch(e)}catch(t){return Q.error(`${t.name}: Failed to download encrypted media: ${e}`),Q.error(t),null}if(t.status>=200&&t.status<400)return t.arrayBuffer()}))()}(r);if(null===i)return Q.error(`Could not decrypt a received encrypted file ${t.toString()} since it could not be downloaded`),new Error(aA("Error: could not decrypt a received encrypted file, because it could not be downloaded"));const s=t.hash.slice(1),o=s.substring(s.length-64),a=s.replace(o,"");let c;try{c=yield function(e,t,n){return sU((function*(){const r=yield crypto.subtle.importKey("raw",yU(t),"AES-GCM",!1,["decrypt"]),i={name:"AES-GCM",iv:yU(e)};return crypto.subtle.decrypt(i,r,n)}))()}(a,o,i)}catch(e){return Q.error(`Could not decrypt file ${t.toString()}`),Q.error(e),null}const[l,u]=t.pathname.split("/").pop().split("."),d=sC[u];try{const e=new File([c],l,{type:d});return URL.createObjectURL(e)}catch(e){return Q.error(`Could not decrypt file ${t.toString()}`),Q.error(e),null}}))()}function CU(e,t,n){return wU(t)?mf`<p class="error">${t.message}</p>`:SU(e)?mM({src:t,onClick:n.onImgClick,onLoad:n.onImgLoad}):_U(e)?oM(t):xU(e)?gM(t):((e,t)=>{const n=aA('Download file "%1$s"',t);return mf`<a target="_blank" rel="noopener" href="${e}">${n}</a>`})(t,nj(e))}function kU(e){Ao.state.config.get("trusted")&&e.addAnnotations(((t,n)=>function(e,t,n){const r=[];try{const t={start:/\b(aesgcm:\/\/)/gi};Up.withinString(e,((e,t,n)=>(r.push({url:e,start:t,end:n}),e)),t)}catch(e){return void Q.debug(e)}r.forEach((e=>{const r=OU(e.url).then((t=>CU(e.url,t,n))),i=mf`${NA(r,"")}`;n.addTemplateResult(e.start+t,e.end+t,i)}))}(t,n,e)))}function TU(e,t){return sU((function*(){var n;if(Wu.settings.get("clear_cache_on_logout")||!t.is_encrypted||t.encryption_namespace!==cU.NS.OMEMO)return t;const r=lU(`encrypted[xmlns="${cU.NS.OMEMO}"]`,e).pop(),i=r.querySelector("header");t.encrypted={device_id:i.getAttribute("sid")};const s=yield null===(n=Wu.omemo)||void 0===n?void 0:n.getDeviceID(),o=s&&lU(`key[rid="${s}"]`,r).pop();return o?(Object.assign(t.encrypted,{iv:i.querySelector("iv").textContent,key:o.textContent,payload:(null===(a=r.querySelector("payload"))||void 0===a?void 0:a.textContent)||null,prekey:["true","1"].includes(o.getAttribute("prekey"))}),!0===t.encrypted.prekey?function(e){return sU((function*(){const t=IU(PU(e),parseInt(e.encrypted.device_id,10)),n=vU(e.encrypted.key);let r;try{r=yield t.decryptPreKeyWhisperMessage(n,"binary")}catch(t){return Q.error(`${t.name} ${t.message}`),Object.assign(e,RU(t))}try{const t=yield DU(e,r),{omemo_store:n}=Ao.state;return yield n.generateMissingPreKeys(),yield n.publishBundle(),t?Object.assign(e,{plaintext:t}):Object.assign(e,{is_only_key:!0})}catch(t){return Q.error(`${t.name} ${t.message}`),Object.assign(e,RU(t))}}))()}(t):function(e){return sU((function*(){const t=IU(PU(e),parseInt(e.encrypted.device_id,10)),n=vU(e.encrypted.key);try{const r=yield t.decryptWhisperMessage(n,"binary"),i=yield DU(e,r);return Object.assign(e,{plaintext:i})}catch(t){return Q.error(`${t.name} ${t.message}`),Object.assign(e,RU(t))}}))()}(t)):Object.assign(t,{error_condition:"not-encrypted-for-this-device",error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"});var a}))()}function NU(){Ao.state.chatboxes.on("add",(e=>{WU(e),e.get("type")===dU&&(e.occupants.on("add",(t=>function(e,t){return sU((function*(){if(!t.isSelf()&&e.features.get("nonanonymous")&&e.features.get("membersonly")&&e.get("omemo_active")){(yield $U(t.get("jid")))||(e.createMessage({message:aA("%1$s doesn't appear to have a client that supports OMEMO. Encrypted chat will no longer be possible in this grouchat.",t.get("nick")),type:"error"}),e.save({omemo_active:!1,omemo_supported:!1}))}}))()}(e,t))),e.features.on("change",(()=>WU(e))))}))}function MU(e){e.listenTo(e.model.messages,"add",(t=>{t.get("is_encrypted")&&!t.get("is_error")&&e.model.save("omemo_supported",!0)})),e.listenTo(e.model,"change:omemo_supported",(()=>{var t;!e.model.get("omemo_supported")&&e.model.get("omemo_active")?e.model.set("omemo_active",!1):null===(t=e.querySelector("converse-chat-toolbar"))||void 0===t||t.requestUpdate()})),e.listenTo(e.model,"change:omemo_active",(()=>{e.querySelector("converse-chat-toolbar").requestUpdate()}))}function IU(e,t){const{libsignal:n}=window,r=new n.SignalProtocolAddress(e,t);return new n.SessionCipher(Ao.state.omemo_store,r)}function PU(e){let t;if(t="me"===e.sender?Ao.session.get("bare_jid"):e.contact_jid?e.contact_jid:"from_real_jid"in e?e.from_real_jid:e.from,!t)throw Object.assign(e,{error_text:aA("Sorry, could not decrypt a received OMEMO message because we don't have the XMPP address for that user."),error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}),new Error("Could not find JID to decrypt OMEMO message for");return t}function DU(e,t){return sU((function*(){const n=PU(e),r=yield Wu.omemo.devicelists.get(n,!0),i=e.encrypted;let s=r.devices.get(i.device_id);if(s||(s=yield r.devices.create({id:i.device_id,jid:n},{promise:!0})),i.payload){const e=t.slice(0,16),n=t.slice(16),r=yield YU.decryptMessage(Object.assign(i,{key:e,tag:n}));return s.save("active",!0),r}}))()}function RU(e){return{error_text:aA("Sorry, could not decrypt a received OMEMO message due to an error.")+` ${e.name} ${e.message}`,error_condition:e.name,error_message:e.message,error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}}function zU(e){const t=e.querySelector("signedPreKeyPublic"),n=e.querySelector("signedPreKeySignature"),r=lU("prekeys > preKeyPublic",e).map((e=>({id:parseInt(e.getAttribute("preKeyId"),10),key:e.textContent})));return{identity_key:e.querySelector("identityKey").textContent.trim(),signed_prekey:{id:parseInt(t.getAttribute("signedPreKeyId"),10),public_key:t.textContent,signature:n.textContent},prekeys:r}}function LU(e){return sU((function*(){const t=yield BU(e);return Promise.all(t.map((e=>UU(e))))}))()}function UU(e){return sU((function*(){var t;if(null===(t=e.get("bundle"))||void 0===t?void 0:t.fingerprint)return;const n=yield e.getBundle();n.fingerprint=mU(vU(n.identity_key)),e.save("bundle",n),e.trigger("change:bundle")}))()}function BU(e){return sU((function*(){yield Wu.waitUntil("OMEMOInitialized");const t=yield Wu.omemo.devicelists.get(e,!0);return yield t.fetchDevices(),t.devices}))()}function FU(e){return sU((function*(){if(!e.get("bundle"))return Q.error(`Could not build an OMEMO session for device ${e.get("id")} because we don't have its bundle`),null;const{libsignal:t}=window,n=new t.SignalProtocolAddress(e.get("jid"),e.get("id")),r=yield Ao.state.omemo_store.loadSession(n.toString());if(r)return r;try{return yield function(e){return sU((function*(){const{libsignal:t}=window,n=new t.SignalProtocolAddress(e.get("jid"),e.get("id")),r=new t.SessionBuilder(Ao.state.omemo_store,n),i=e.getRandomPreKey(),s=yield e.getBundle();return r.processPreKey({registrationId:parseInt(e.get("id"),10),identityKey:vU(s.identity_key),signedPreKey:{keyId:s.signed_prekey.id,publicKey:vU(s.signed_prekey.public_key),signature:vU(s.signed_prekey.signature)},preKey:{keyId:i.id,publicKey:vU(i.key)}})}))()}(e)}catch(t){return Q.error(`Could not build an OMEMO session for device ${e.get("id")}`),Q.error(t),null}}))()}function qU(e){return sU((function*(){try{lU(`event[xmlns="${cU.NS.PUBSUB}#event"]`,e).length&&(yield Wu.waitUntil("OMEMOInitialized"),yield(t=e,sU((function*(){const e=lU(`items[node="${cU.NS.OMEMO_DEVICELIST}"]`,t).pop();if(!e)return;const n=`item list[xmlns="${cU.NS.OMEMO}"] device`,r=lU(n,e).map((e=>e.getAttribute("id"))),i=t.getAttribute("from"),s=yield Wu.omemo.devicelists.get(i,!0),o=s.devices,a=o.pluck("id").filter((e=>!r.includes(e))),c=Ao.session.get("bare_jid");a.forEach((e=>{i===c&&e===Ao.state.omemo_store.get("device_id")||o.get(e).save("active",!1)})),r.forEach((e=>{const t=o.get(e);t?t.save("active",!0):o.create({id:e,jid:i})})),Up.isSameBareJID(c,i)&&s.publishCurrentDevice(r)}))()),yield function(e){return sU((function*(){const t=lU("items",e).pop();if(!t||!t.getAttribute("node").startsWith(cU.NS.OMEMO_BUNDLES))return;const n=t.getAttribute("node").split(":")[1],r=e.getAttribute("from"),i=lU("item > bundle",t).pop(),s=yield Wu.omemo.devicelists.get(r,!0);(s.devices.get(n)||s.devices.create({id:n,jid:r})).save({bundle:zU(i)})}))()}(e))}catch(e){Q.error(e)}var t}))()}function HU(){Wu.connection.get().addHandler((e=>(qU(e),!0)),null,"message","headline")}function GU(e){return sU((function*(){if(!e)if(Ao.state.config.get("trusted")&&!Wu.settings.get("clear_cache_on_logout")){try{yield sU((function*(){const e=Ao.session.get("bare_jid");Ao.state.devicelists=new rU;const t=`converse.devicelists-${e}`;bU(Ao.state.devicelists,t),yield new Promise((e=>{Ao.state.devicelists.fetch({success:e,error:(t,n)=>{Q.error(n),e()}})})),yield Wu.omemo.devicelists.get(e,!0)}))(),yield Wu.omemo.session.restore(),yield Ao.state.omemo_store.publishBundle()}catch(e){return Q.error("Could not initialize OMEMO support"),void Q.error(e)}Wu.trigger("OMEMOInitialized")}else Q.warn("Not initializing OMEMO, since this browser is not trusted or clear_cache_on_logout is set to true")}))()}function WU(e){return sU((function*(){let t;e.get("type")===dU?(yield Wu.waitUntil("OMEMOInitialized"),t=e.features.get("nonanonymous")&&e.features.get("membersonly")):e.get("type")===hU&&(t=yield $U(e.get("jid"))),e.set("omemo_supported",!!t),t&&Wu.settings.get("omemo_default")&&e.set("omemo_active",!0)}))()}function VU(e){e.stopPropagation(),e.preventDefault();const t=Up.ancestor(e.target,"converse-chat-toolbar");if(!t.model.get("omemo_supported")){let e;return e=t.model.get("type")===dU?[aA("Cannot use end-to-end encryption in this groupchat, either the groupchat has some anonymity or not all participants support OMEMO.")]:[aA("Cannot use end-to-end encryption because %1$s uses a client that doesn't support OMEMO.",t.model.contact.getDisplayName())],Wu.alert("error",aA("Error"),e)}t.model.save({omemo_active:!t.model.get("omemo_active")})}function KU(e,t){const n=e.model,r=n.get("type")===dU;let i,s;if(n.get("omemo_supported")){const e=aA("Messages are being sent in plaintext"),t=aA("Messages are sent encrypted");i=n.get("omemo_active")?t:e}else i=aA(r?"This groupchat needs to be members-only and non-anonymous in order to support OMEMO encrypted messages":"OMEMO encryption is not supported");return s=n.get("omemo_supported")?n.get("omemo_active")?r?"var(--muc-color)":"var(--chat-color)":"var(--error-color)":"var(--disabled-color)",t.push(mf`<button type="button" class="btn toggle-omemo" title="${i}" data-disabled="${!n.get("omemo_supported")}" @click="${VU}"><converse-icon class="fa ${n.get("omemo_active")?"fa-lock":"fa-unlock"}" path-prefix="${Wu.settings.get("assets_path")}" size="1em" color="${s}"></converse-icon></button>`),t}function JU(e,t){return sU((function*(){let{stanza:n}=t;const{message:r}=t;if(!r.get("is_encrypted"))return t;if(!r.get("body"))throw new Error("No message body to encrypt!");const i=yield(s=e,sU((function*(){const e=aA("Sorry, no devices found to which we can send an OMEMO encrypted message.");let t;if(s instanceof ky){const e=yield Promise.all(s.occupants.map((e=>BU(e.get("jid")))));t=e.reduce(((e,t)=>e.concat(t.models)),[])}else if(s.get("type")===hU){const n=yield BU(s.get("jid"));if(0===n.length)throw new KL(e);const r=Ao.session.get("bare_jid"),i=(yield Wu.omemo.devicelists.get(r)).devices;t=[...i.models,...n.models]}const n=Ao.state.omemo_store.get("device_id");t=t.filter((e=>e.get("id")!==n)),yield Promise.all(t.map((e=>e.getBundle())));const r=t.filter((e=>e)).map((e=>FU(e)));if(yield Promise.all(r),r.includes(null)&&(t=t.filter((e=>r[t.indexOf(e)])),0===t.length))throw new KL(e);return t}))());var s;const{key_and_tag:o,iv:a,payload:c}=yield YU.encryptMessage(r.get("plaintext")),l=yield Promise.all(i.filter((e=>-1!=e.get("trusted")&&e.get("active"))).map((e=>function(e,t){return IU(t.get("jid"),t.get("id")).encrypt(e).then((e=>({payload:e,device:t})))}(o,e))));return n.cnode(uU`
            <encrypted xmlns="${cU.NS.OMEMO}">
                <header sid="${Ao.state.omemo_store.get("device_id")}">
                    ${l.map((({payload:e,device:t})=>3==parseInt(e.type,10)?uU`<key rid="${t.get("id")}" prekey="true">${btoa(e.body)}</key>`:uU`<key rid="${t.get("id")}">${btoa(e.body)}</key>`))}
                    <iv>${a}</iv>
                </header>
                <payload>${c}</payload>
            </encrypted>`).root(),n.cnode(uU`<store xmlns="${cU.NS.HINTS}"/>`).root(),n.cnode(uU`<encryption xmlns="${cU.NS.EME}" namespace="${cU.NS.OMEMO}"/>`).root(),{message:r,stanza:n}}))()}const YU={decryptMessage:function(e){return sU((function*(){const t=yield crypto.subtle.importKey("raw",e.key,WL,!0,["encrypt","decrypt"]),n=fU(vU(e.payload),e.tag),r={name:"AES-GCM",iv:vU(e.iv),tagLength:128};return gU(yield crypto.subtle.decrypt(r,t,n))}))()},encryptMessage:function(e){return sU((function*(){const t=crypto.getRandomValues(new window.Uint8Array(12)),n=yield crypto.subtle.generateKey(WL,!0,["encrypt","decrypt"]),r={iv:t,name:"AES-GCM",tagLength:128},i=yield crypto.subtle.encrypt(r,n,AU(e)),s=i.byteLength-16,o=i.slice(0,s),a=i.slice(s),c=yield crypto.subtle.exportKey("raw",n);return{tag:a,key:c,key_and_tag:fU(c,a),payload:pU(o),iv:pU(t)}}))()},formatFingerprint:jU},{u:XU}=Hp.env,QU=e=>{const t=aA("OMEMO Fingerprints"),n=aA("No OMEMO-enabled devices found"),r=e.devicelist.devices;return mf`<ul class="list-group fingerprints"><li class="list-group-item active">${t}</li>${r.length?r.map((t=>((e,t)=>{const n=aA("Trusted"),r=aA("Untrusted"),i=aA("Choose which devices you trust for OMEMO encrypted communication"),s=XU.getUniqueId(),o=XU.getUniqueId(),a=-1!==t.get("trusted");return t.get("bundle")&&t.get("bundle").fingerprint?mf`<li class="list-group-item"><form class="fingerprint-trust"><div class="btn-group btn-group-toggle" role="group" aria-label="${i}"><input type="radio" class="btn-check" name="${t.get("id")}" id="${s}" autocomplete="off" value="1" @click="${e.toggleDeviceTrust}" ?checked="${a}"> <label class="btn ${a?"btn-primary active":"btn-outline-secondary"}" for="${s}">${n}</label> <input type="radio" class="btn-check" name="${t.get("id")}" id="${o}" autocomplete="off" value="-1" @click="${e.toggleDeviceTrust}" ?checked="${!a}"> <label class="btn ${a?"btn-outline-secondary":"btn-primary active"}" for="${o}">${r}</label></div><code class="fingerprint">${jU(t.get("bundle").fingerprint)}</code></form></li>`:""})(e,t))):mf`<li class="list-group-item">${n}</li>`}</ul>`};function ZU(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-omemo-fingerprints",class extends uA{static get properties(){return{jid:{type:String}}}initialize(){return(e=function*(){this.devicelist=yield Wu.omemo.devicelists.get(this.jid,!0),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"change:trusted",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.requestUpdate()},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){ZU(s,r,i,o,a,"next",e)}function a(e){ZU(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}render(){return this.devicelist?QU(this):""}toggleDeviceTrust(e){const t=e.target;this.devicelist.devices.get(t.getAttribute("name")).save("trusted",parseInt(t.value,10))}constructor(){super(),this.jid=null}});const eB=1,tB=0,nB=3,rB=2,iB=1,sB=2,oB=4,aB=8,cB=0,lB=1,uB=2,dB=3,hB=4,fB=5,pB=6,mB=7,gB=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],vB=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],yB=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];class bB{get(e){return this.num[e]}getLength(){return this.num.length}multiply(e){let t=new Array(this.getLength()+e.getLength()-1);for(let n=0;n<this.getLength();n++)for(let r=0;r<e.getLength();r++)t[n+r]^=wB.gexp(wB.glog(this.get(n))+wB.glog(e.get(r)));return new bB(t,0)}mod(e){if(this.getLength()-e.getLength()<0)return this;let t=wB.glog(this.get(0))-wB.glog(e.get(0)),n=new Array(this.getLength());for(let e=0;e<this.getLength();e++)n[e]=this.get(e);for(let r=0;r<e.getLength();r++)n[r]^=wB.gexp(wB.glog(e.get(r))+t);return new bB(n,0).mod(e)}constructor(e,t){if(null==e.length)throw new Error(e.length+"/"+t);let n=0;for(;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(let t=0;t<e.length-n;t++)this.num[t]=e[t+n]}}const _B=bB,wB={glog:function(e){if(e<1)throw new Error("glog("+e+")");return wB.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return wB.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(let e=0;e<8;e++)wB.EXP_TABLE[e]=1<<e;for(let e=8;e<256;e++)wB.EXP_TABLE[e]=wB.EXP_TABLE[e-4]^wB.EXP_TABLE[e-5]^wB.EXP_TABLE[e-6]^wB.EXP_TABLE[e-8];for(let e=0;e<255;e++)wB.LOG_TABLE[wB.EXP_TABLE[e]]=e;function SB(e,t){let n=1,r=function(e){let t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e);for(let e=0,i=gB.length;e<=i;e++){let i=0;switch(t){case eB:i=gB[e][0];break;case tB:i=gB[e][1];break;case nB:i=gB[e][2];break;case rB:i=gB[e][3]}if(r<=i)break;n++}if(n>gB.length)throw new Error("Too long data");return n}const xB={G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo(e){let t=e<<10;for(;xB.getBCHDigit(t)-xB.getBCHDigit(xB.G15)>=0;)t^=xB.G15<<xB.getBCHDigit(t)-xB.getBCHDigit(xB.G15);return(e<<10|t)^xB.G15_MASK},getBCHTypeNumber(e){let t=e<<12;for(;xB.getBCHDigit(t)-xB.getBCHDigit(xB.G18)>=0;)t^=xB.G18<<xB.getBCHDigit(t)-xB.getBCHDigit(xB.G18);return e<<12|t},getBCHDigit(e){let t=0;for(;0!=e;)t++,e>>>=1;return t},getPatternPosition:e=>vB[e-1],getMask(e,t,n){switch(e){case cB:return(t+n)%2==0;case lB:return t%2==0;case uB:return n%3==0;case dB:return(t+n)%3==0;case hB:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case fB:return t*n%2+t*n%3==0;case pB:return(t*n%2+t*n%3)%2==0;case mB:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial(e){let t=new _B([1],0);for(let n=0;n<e;n++)t=t.multiply(new _B([1,wB.gexp(n)],0));return t},getLengthInBits(e,t){if(1<=t&&t<10)switch(e){case iB:return 10;case sB:return 9;case oB:case aB:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case iB:return 12;case sB:return 11;case oB:return 16;case aB:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case iB:return 14;case sB:return 13;case oB:return 16;case aB:return 12;default:throw new Error("mode:"+e)}}},getLostPoint(e){let t=e.getModuleCount(),n=0;for(let r=0;r<t;r++)for(let i=0;i<t;i++){let s=0,o=e.isDark(r,i);for(let n=-1;n<=1;n++)if(!(r+n<0||t<=r+n))for(let a=-1;a<=1;a++)i+a<0||t<=i+a||0==n&&0==a||o==e.isDark(r+n,i+a)&&s++;s>5&&(n+=3+s-5)}for(let r=0;r<t-1;r++)for(let i=0;i<t-1;i++){let t=0;e.isDark(r,i)&&t++,e.isDark(r+1,i)&&t++,e.isDark(r,i+1)&&t++,e.isDark(r+1,i+1)&&t++,0!=t&&4!=t||(n+=3)}for(let r=0;r<t;r++)for(let i=0;i<t-6;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(let r=0;r<t;r++)for(let i=0;i<t-6;i++)e.isDark(i,r)&&!e.isDark(i+1,r)&&e.isDark(i+2,r)&&e.isDark(i+3,r)&&e.isDark(i+4,r)&&!e.isDark(i+5,r)&&e.isDark(i+6,r)&&(n+=40);let r=0;for(let n=0;n<t;n++)for(let i=0;i<t;i++)e.isDark(i,n)&&r++;return n+=10*(Math.abs(100*r/t/t-50)/5),n}};class AB{static get PAD0(){return 236}static get PAD1(){return 17}isDark(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}makeImpl(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(let e=0;e<this.moduleCount;e++){this.modules[e]=new Array(this.moduleCount);for(let t=0;t<this.moduleCount;t++)this.modules[e][t]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=AB.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)}setupPositionProbePattern(e,t){for(let n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(let r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[e+n][t+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)}getBestMaskPattern(){let e=0,t=0;for(let n=0;n<8;n++){this.makeImpl(!0,n);let r=xB.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t}setupTimingPattern(){for(let e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(let e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)}setupPositionAdjustPattern(){let e=xB.getPatternPosition(this.typeNumber);for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++){let r=e[t],i=e[n];if(null==this.modules[r][i])for(let e=-2;e<=2;e++)for(let t=-2;t<=2;t++)this.modules[r+e][i+t]=-2==e||2==e||-2==t||2==t||0==e&&0==t}}setupTypeNumber(e){let t=xB.getBCHTypeNumber(this.typeNumber);for(let n=0;n<18;n++){let r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(let n=0;n<18;n++){let r=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}}setupTypeInfo(e,t){const n=this.errorCorrectLevel<<3|t,r=xB.getBCHTypeInfo(n);for(let t=0;t<15;t++){let n=!e&&1==(r>>t&1);t<6?this.modules[t][8]=n:t<8?this.modules[t+1][8]=n:this.modules[this.moduleCount-15+t][8]=n}for(let t=0;t<15;t++){let n=!e&&1==(r>>t&1);t<8?this.modules[8][this.moduleCount-t-1]=n:t<9?this.modules[8][15-t-1+1]=n:this.modules[8][15-t-1]=n}this.modules[this.moduleCount-8][8]=!e}mapData(e,t){let n=-1,r=this.moduleCount-1,i=7,s=0;for(let o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(let n=0;n<2;n++)if(null==this.modules[r][o-n]){let a=!1;s<e.length&&(a=1==(e[s]>>>i&1)),xB.getMask(t,r,o-n)&&(a=!a),this.modules[r][o-n]=a,i--,-1==i&&(s++,i=7)}if(r+=n,r<0||this.moduleCount<=r){r-=n,n=-n;break}}}static createData(e,t,n){let r=$B.getRSBlocks(e,t);const i=new EB;for(let t=0;t<n.length;t++){let r=n[t];i.put(r.mode,4),i.put(r.getLength(),xB.getLengthInBits(r.mode,e)),r.write(i)}let s=0;for(let e=0;e<r.length;e++)s+=r[e].dataCount;if(i.getLengthInBits()>8*s)throw new Error("code length overflow. ("+i.getLengthInBits()+">"+8*s+")");for(i.getLengthInBits()+4<=8*s&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(!1);for(;!(i.getLengthInBits()>=8*s||(i.put(AB.PAD0,8),i.getLengthInBits()>=8*s));)i.put(AB.PAD1,8);return AB.createBytes(i,r)}static createBytes(e,t){let n=0,r=0,i=0,s=new Array(t.length),o=new Array(t.length);for(let a=0;a<t.length;a++){let c=t[a].dataCount,l=t[a].totalCount-c;r=Math.max(r,c),i=Math.max(i,l),s[a]=new Array(c);for(let t=0;t<s[a].length;t++)s[a][t]=255&e.buffer[t+n];n+=c;let u=xB.getErrorCorrectPolynomial(l),d=new _B(s[a],u.getLength()-1).mod(u);o[a]=new Array(u.getLength()-1);for(let e=0;e<o[a].length;e++){let t=e+d.getLength()-o[a].length;o[a][e]=t>=0?d.get(t):0}}let a=0;for(let e=0;e<t.length;e++)a+=t[e].totalCount;let c=new Array(a),l=0;for(let e=0;e<r;e++)for(let n=0;n<t.length;n++)e<s[n].length&&(c[l++]=s[n][e]);for(let e=0;e<i;e++)for(let n=0;n<t.length;n++)e<o[n].length&&(c[l++]=o[n][e]);return c}constructor(e,t){this.text=e,this.errorCorrectLevel=t,this.typeNumber=SB(this.text,this.errorCorrectLevel),this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[new jB(this.text)]}}class jB{getLength(){return this.parsedData.length}write(e){for(let t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}constructor(e){this.mode=oB,this.data=e,this.parsedData=[];for(let e=0,t=this.data.length;e<t;e++){let t=[],n=this.data.charCodeAt(e);n>65536?(t[0]=240|(1835008&n)>>>18,t[1]=128|(258048&n)>>>12,t[2]=128|(4032&n)>>>6,t[3]=128|63&n):n>2048?(t[0]=224|(61440&n)>>>12,t[1]=128|(4032&n)>>>6,t[2]=128|63&n):n>128?(t[0]=192|(1984&n)>>>6,t[1]=128|63&n):t[0]=n,this.parsedData.push(t)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}}class $B{static getRSBlocks(e,t){let n=$B.getRsBlockTable(e,t);if(null==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);let r=n.length/3,i=[];for(let e=0;e<r;e++){let t=n[3*e+0],r=n[3*e+1],s=n[3*e+2];for(let e=0;e<t;e++)i.push(new $B(r,s))}return i}static getRsBlockTable(e,t){switch(t){case eB:return yB[4*(e-1)+0];case tB:return yB[4*(e-1)+1];case nB:return yB[4*(e-1)+2];case rB:return yB[4*(e-1)+3];default:return}}constructor(e,t){this.totalCount=e,this.dataCount=t}}class EB{get(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)}put(e,t){for(let n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))}getLengthInBits(){return this.length}putBit(e){let t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}constructor(){this.buffer=[],this.length=0}}var OB=n(5909),CB={};CB.styleTagTransform=D(),CB.setAttributes=N(),CB.insert=k().bind(null,"head"),CB.domAPI=O(),CB.insertStyleElement=I();$()(OB.A,CB);OB.A&&OB.A.locals&&OB.A.locals;function kB(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function TB(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,kB(e,t,"get"))}function NB(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function MB(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,kB(e,t,"set"),n),n}var IB=new WeakMap;class PB extends uA{static get properties(){return{text:{type:String},width:{type:String},height:{type:String}}}render(){const e=TB(this,IB).getModuleCount(),t=[];for(let n=0;n<e;n++)for(let r=0;r<e;r++)TB(this,IB).isDark(n,r)&&t.push(gf`<use x="${n}" y="${r}" href="#template"></use>`);return gf`<svg viewBox="0 0 ${e} ${e}" width="${this.width}" height="${this.height}" fill="${this.colorLight}"><rect fill="${this.colorLight}" width="100%" height="100%"></rect><rect fill="${this.colorDark}" width="1" height="1" id="template"></rect>${t}</svg>`}shouldUpdate(e){return!TB(this,IB)||e.has("text")||e.has("correctLevel")?(this.title=this.text,MB(this,IB,new AB(this.text,this.correctLevel)),TB(this,IB).make(),super.shouldUpdate(e)||!0):super.shouldUpdate(e)}constructor(){super(),NB(this,IB,{writable:!0,value:void 0}),MB(this,IB,null),this.text=null,this.width="200px",this.height="200px",this.colorDark="#000000",this.colorLight="#ffffff",this.correctLevel=rB}}Wu.elements.define("converse-qr-code",PB);function DB(e){return mf`${e.get("bundle")&&e.get("bundle").fingerprint?function(e){const t=aA("Checkbox for selecting the following fingerprint");return mf`<li class="fingerprint-removal-item list-group-item"><label class="form-label"><input type="checkbox" value="${e.get("id")}" aria-label="${t}"> <span class="fingerprint">${jU(e.get("bundle").fingerprint)}</span></label></li>`}(e):function(e){const t=aA("Device without a fingerprint"),n=aA("Checkbox for selecting the following device");return mf`<li class="fingerprint-removal-item list-group-item"><label class="form-label"><input type="checkbox" value="${e.get("id")}" aria-label="${n}"> <span>${t}</span></label></li>`}(e)}`}const RB=e=>{var t,n;const r=aA("This device's OMEMO fingerprint"),i=aA("Generate new keys and fingerprint"),s=null==e||null===(t=e.current_device)||void 0===t?void 0:t.get("bundle").fingerprint;return mf`<form class="converse-form fingerprint-removal" @submit="${e.removeSelectedFingerprints}"><ul class="list-group fingerprints"><li class="list-group-item active">${r}</li><li class="list-group-item">${s?function(e){return mf`<span class="fingerprint">${jU(e.current_device.get("bundle").fingerprint)}</span>`}(e):BO()}</li><li class="list-group-item p-4">${s?mf`<converse-qr-code class="centered" text="${function(e){const t=Ao.state.omemo_store.get("device_id");return`xmpp:${Ao.session.get("bare_jid")}?omemo-sid-${t}=${e=e.replace(/^05/,"")}`}(s)}"></converse-qr-code>`:""}</li></ul><div class="pb-3"><button type="button" class="generate-bundle btn btn-danger" @click="${e.generateOMEMODeviceBundle}">${i}</button></div>${(null===(n=e.other_devices)||void 0===n?void 0:n.length)?function(e){var t;const n=aA("Other OMEMO-enabled devices"),r=aA("Checkbox to select fingerprints of all other OMEMO devices"),i=aA("Remove checked devices and close"),s=aA("Select all");return mf`<ul class="list-group fingerprints"><li class="list-group-item active"><label class="form-label"><input type="checkbox" class="select-all" @change="${e.selectAll}" title="${s}" aria-label="${r}"> ${n}</label></li>${null===(t=e.other_devices)||void 0===t?void 0:t.map((e=>DB(e)))}</ul><div><button type="submit" class="save-form btn btn-primary">${i}</button></div>`}(e):""}</form>`};function zB(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function LB(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){zB(s,r,i,o,a,"next",e)}function a(e){zB(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:UB,sizzle:BB,u:FB}=Hp.env;function qB(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}Wu.elements.define("converse-omemo-profile",class extends uA{initialize(){return LB((function*(){const e=Ao.session.get("bare_jid");this.devicelist=yield Wu.omemo.devicelists.get(e,!0),yield this.setAttributes(),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.requestUpdate()})).call(this)}setAttributes(){return LB((function*(){this.device_id=yield Wu.omemo.getDeviceID(),this.current_device=this.devicelist.devices.get(this.device_id),this.other_devices=this.devicelist.devices.filter((e=>e.get("id")!==this.device_id))})).call(this)}render(){return this.devicelist?RB(this):BO()}selectAll(e){let t=FB.ancestor(e.target,"li");for(;t;)t.querySelector('input[type="checkbox"]').checked=e.target.checked,t=t.nextElementSibling}removeSelectedFingerprints(e){return LB((function*(){e.preventDefault(),e.stopPropagation(),e.target.querySelector(".select-all").checked=!1;const t=BB('.fingerprint-removal-item input[type="checkbox"]:checked',e.target).map((e=>e.value));try{yield this.devicelist.removeOwnDevices(t)}catch(e){Q.error(e),Ao.api.alert(UB.LogLevel.ERROR,aA("Error"),[aA("Sorry, an error occurred while trying to remove the devices.")])}yield this.setAttributes(),this.requestUpdate()})).call(this)}generateOMEMODeviceBundle(e){return LB((function*(){e.preventDefault();(yield Wu.confirm(aA("Confirm"),aA("Are you sure you want to generate new OMEMO keys? This will remove your old keys and all previously encrypted messages will no longer be decryptable on this device.")))&&(yield Wu.omemo.bundle.generate(),yield this.setAttributes(),this.requestUpdate())})).call(this)}});const{Strophe:HB,sizzle:GB,stx:WB}=Hp.env;class VB extends ae.Model{defaults(){return{trusted:0,active:!0}}getRandomPreKey(){const e=this.get("bundle");return e.prekeys[Up.getRandomInt(e.prekeys.length)]}fetchBundleFromServer(){return(e=function*(){const e=Ao.session.get("bare_jid"),t=WB`
            <iq type="get" from="${e}" to="${this.get("jid")}" xmlns="jabber:client">
                <pubsub xmlns="${HB.NS.PUBSUB}">
                    <items node="${HB.NS.OMEMO_BUNDLES}:${this.get("id")}"/>
                </pubsub>
            </iq>`;let n;try{n=yield Wu.sendIQ(t)}catch(n){return Q.error(`Could not fetch bundle for device ${this.get("id")} from ${this.get("jid")}`),Q.error(n),null}if(n.querySelector("error"))throw new VL("Could not fetch bundle",n);const r=GB(`items[node="${HB.NS.OMEMO_BUNDLES}:${this.get("id")}"]`,n).pop(),i=zU(GB(`bundle[xmlns="${HB.NS.OMEMO}"]`,r).pop());return this.save("bundle",i),i},function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){qB(s,r,i,o,a,"next",e)}function a(e){qB(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var e}getBundle(){return this.get("bundle")?Promise.resolve(this.get("bundle")):this.fetchBundleFromServer()}}const KB=VB;class JB extends ae.Collection{constructor(){super(),this.model=KB}}const YB=JB;function XB(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function QB(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){XB(s,r,i,o,a,"next",e)}function a(e){XB(s,r,i,o,a,"throw",e)}o(void 0)}))}}function ZB(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Strophe:eF,stx:tF,u:nF}=Hp.env;class rF extends ae.Model{get Direction(){return{SENDING:1,RECEIVING:2}}getIdentityKeyPair(){const e=this.get("identity_keypair");return Promise.resolve({privKey:nF.base64ToArrayBuffer(e.privKey),pubKey:nF.base64ToArrayBuffer(e.pubKey)})}getLocalRegistrationId(){return Promise.resolve(parseInt(this.get("device_id"),10))}isTrustedIdentity(e,t,n){if(null==e)throw new Error("Can't check identity key for invalid key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identity_key to be an ArrayBuffer");const r=this.get("identity_key"+e);return void 0===r?Promise.resolve(!0):Promise.resolve(nF.arrayBufferToBase64(t)===r)}loadIdentityKey(e){if(null==e)throw new Error("Can't load identity_key for invalid identifier");return Promise.resolve(nF.base64ToArrayBuffer(this.get("identity_key"+e)))}saveIdentity(e,t){if(null==e)throw new Error("Can't save identity_key for invalid identifier");const{libsignal:n}=window,r=new n.SignalProtocolAddress.fromString(e),i=this.get("identity_key"+r.getName()),s=nF.arrayBufferToBase64(t);return this.save("identity_key"+r.getName(),s),i&&s!==i?Promise.resolve(!0):Promise.resolve(!1)}getPreKeys(){return this.get("prekeys")||{}}loadPreKey(e){const t=this.getPreKeys()[e];return t?Promise.resolve({privKey:nF.base64ToArrayBuffer(t.privKey),pubKey:nF.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storePreKey(e,t){const n={};return n[e]={pubKey:nF.arrayBufferToBase64(t.pubKey),privKey:nF.arrayBufferToBase64(t.privKey)},this.save("prekeys",Object.assign(this.getPreKeys(),n)),Promise.resolve()}removePreKey(e){const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ZB(e,t,n[t])}))}return e}({},this.getPreKeys());return delete t[e],this.save("prekeys",t),Promise.resolve()}loadSignedPreKey(e){const t=this.get("signed_prekey");return t?Promise.resolve({privKey:nF.base64ToArrayBuffer(t.privKey),pubKey:nF.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storeSignedPreKey(e){if("object"!=typeof e)throw new Error("storeSignedPreKey: expected an object");return this.save("signed_prekey",{id:e.keyId,privKey:nF.arrayBufferToBase64(e.keyPair.privKey),pubKey:nF.arrayBufferToBase64(e.keyPair.pubKey),signature:nF.arrayBufferToBase64(e.signature)}),Promise.resolve()}removeSignedPreKey(e){return this.get("signed_prekey").id===e&&(this.unset("signed_prekey"),this.save()),Promise.resolve()}loadSession(e){return Promise.resolve(this.get("session"+e))}storeSession(e,t){return Promise.resolve(this.save("session"+e,t))}removeSession(e){return Promise.resolve(this.unset("session"+e))}removeAllSessions(e){const t=Object.keys(this.attributes).filter((t=>!!t.startsWith("session"+e)&&t)),n={};return t.forEach((e=>{n[e]=void 0})),this.save(n),Promise.resolve()}publishBundle(){const e=this.get("signed_prekey"),t=`${eF.NS.OMEMO_BUNDLES}:${this.get("device_id")}`,n=tF`
            <item>
                <bundle xmlns="${eF.NS.OMEMO}">
                    <signedPreKeyPublic signedPreKeyId="${e.id}">${e.pubKey}</signedPreKeyPublic>
                    <signedPreKeySignature>${e.signature}</signedPreKeySignature>
                    <identityKey>${this.get("identity_keypair").pubKey}</identityKey>
                    <prekeys>${Object.values(this.get("prekeys")).map(((e,t)=>tF`<preKeyPublic preKeyId="${t}">${e.pubKey}</preKeyPublic>`))}
                    </prekeys>
                </bundle>
            </item>`;return Wu.pubsub.publish(null,t,n,{access_model:"open"},!1)}generateMissingPreKeys(){return QB((function*(){const{libsignal:e}=window,{KeyHelper:t}=e,n=Object.keys(this.getPreKeys()),r=Array.from({length:Ao.NUM_PREKEYS},((e,t)=>t.toString())).filter((e=>!n.includes(e)));if(r.length<1)return Q.debug("No missing prekeys to generate for our own device"),Promise.resolve();(yield Promise.all(r.map((e=>t.generatePreKey(parseInt(e,10)))))).forEach((e=>this.storePreKey(e.keyId,e.keyPair)));const i=this.getPreKeys(),s=Object.keys(i).map((e=>({id:e,key:i[e].pubKey}))),o=Ao.session.get("bare_jid"),a=(yield Wu.omemo.devicelists.get(o)).devices.get(this.get("device_id")),c=yield a.getBundle();a.save("bundle",Object.assign(c,{prekeys:s}))})).call(this)}generatePreKeys(){return QB((function*(){const e=Ao.NUM_PREKEYS,{libsignal:t}=window,{KeyHelper:n}=t,r=yield Promise.all([...Array(e).keys()].map((e=>n.generatePreKey(e))));return r.forEach((e=>this.storePreKey(e.keyId,e.keyPair))),r.map((e=>({id:e.keyId,key:nF.arrayBufferToBase64(e.keyPair.pubKey)})))})).call(this)}generateBundle(){return QB((function*(){const{libsignal:e}=window,t=yield e.KeyHelper.generateIdentityKeyPair(),n=nF.arrayBufferToBase64(t.pubKey),r=yield sU((function*(){const{libsignal:e}=window,t=Ao.session.get("bare_jid"),n=(yield Wu.omemo.devicelists.get(t,!0)).devices.pluck("id");let r=e.KeyHelper.generateRegistrationId(),i=0;for(;n.includes(r);)if(r=e.KeyHelper.generateRegistrationId(),i++,10===i)throw new Error("Unable to generate a unique device ID");return r.toString()}))();this.save({device_id:r,identity_key:n,identity_keypair:{privKey:nF.arrayBufferToBase64(t.privKey),pubKey:n}});const i=yield e.KeyHelper.generateSignedPreKey(t,0);this.storeSignedPreKey(i);const s={identity_key:n,device_id:r,prekeys:yield this.generatePreKeys()};s.signed_prekey={id:i.keyId,public_key:nF.arrayBufferToBase64(i.keyPair.pubKey),signature:nF.arrayBufferToBase64(i.signature)};const o=Ao.session.get("bare_jid"),a=yield Wu.omemo.devicelists.get(o);(yield a.devices.create({id:s.device_id,jid:o},{promise:!0})).save("bundle",s)})).call(this)}fetchSession(){return void 0===this._setup_promise&&(this._setup_promise=new Promise(((e,t)=>{this.fetch({success:()=>{this.get("device_id")?e():this.generateBundle().then(e).catch(t)},error:(n,r)=>{Q.warn(`Could restore OMEMO session, we'll generate a new one: ${r}`),this.generateBundle().then(e).catch(t)}})}))),this._setup_promise}}const iF=rF;function sF(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function oF(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){sF(s,r,i,o,a,"next",e)}function a(e){sF(s,r,i,o,a,"throw",e)}o(void 0)}))}}const aF={omemo:{getDeviceID:()=>oF((function*(){return yield Wu.waitUntil("OMEMOInitialized"),Ao.state.omemo_store.get("device_id")}))(),session:{restore:()=>oF((function*(){const{state:e}=Ao;if(void 0===e.omemo_store){const t=`converse.omemosession-${Ao.session.get("bare_jid")}`;e.omemo_store=new iF({id:t}),Up.initStorage(e.omemo_store,t)}yield e.omemo_store.fetchSession()}))()},devicelists:{get:(e,t=!1)=>oF((function*(){const{devicelists:n}=Ao.state,r=n.get(e)||(t?n.create({jid:e}):null);return yield null==r?void 0:r.initialized,r}))()},bundle:{generate:()=>oF((function*(){yield Wu.waitUntil("OMEMOInitialized");const e=Ao.session.get("bare_jid"),t=yield Wu.omemo.devicelists.get(e),{omemo_store:n}=Ao.state,r=n.get("device_id");if(r){const e=t.devices.get(r);n.unset(r),e&&(yield new Promise((t=>e.destroy({success:t,error:t})))),t.devices.trigger("remove")}yield n.generateBundle(),yield t.publishDevices();const i=UU(t.devices.get(n.get("device_id")));return yield n.publishBundle(),i}))()}}};var cF=n(9569),lF={};lF.styleTagTransform=D(),lF.setAttributes=N(),lF.insert=k().bind(null,"head"),lF.domAPI=O(),lF.insertStyleElement=I();$()(cF.A,lF);cF.A&&cF.A.locals&&cF.A.locals;function uF(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:dF}=Hp.env,{shouldClearCache:hF}=Up;function fF(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function pF(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){fF(s,r,i,o,a,"next",e)}function a(e){fF(s,r,i,o,a,"throw",e)}o(void 0)}))}}Hp.env.omemo=YU,dF.addNamespace("OMEMO_DEVICELIST",dF.NS.OMEMO+".devicelist"),dF.addNamespace("OMEMO_VERIFICATION",dF.NS.OMEMO+".verification"),dF.addNamespace("OMEMO_WHITELISTED",dF.NS.OMEMO+".whitelisted"),dF.addNamespace("OMEMO_BUNDLES",dF.NS.OMEMO+".bundles"),Hp.plugins.add("converse-omemo",{enabled:e=>window.libsignal&&e.config.get("trusted")&&!Wu.settings.get("clear_cache_on_logout")&&!e.api.settings.get("blacklisted_plugins").includes("converse-omemo"),dependencies:["converse-chatview","converse-pubsub","converse-profile"],initialize(){Wu.settings.extend({omemo_default:!1}),Wu.promises.add(["OMEMOInitialized"]),Object.assign(Ao.api,aF);const e={OMEMOStore:iF,Device:KB,Devices:YB,DeviceList:tU,DeviceLists:rU};Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.waitUntil("chatBoxesInitialized").then(NU),Wu.listen.on("getOutgoingMessageAttributes",EU),Wu.listen.on("createMessageStanza",((e,t)=>{return(n=function*(){try{t=yield JU(e,t)}catch(t){!function(e,t){if(e instanceof VL){t.save("omemo_supported",!1);const n=[];lU(`presence-subscription-required[xmlns="${cU.NS.PUBSUB_ERROR}"]`,e.iq).length?n.push(aA("Sorry, we're unable to send an encrypted message because %1$s requires you to be subscribed to their presence in order to see their OMEMO information",e.iq.getAttribute("from"))):lU('remote-server-not-found[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]',e.iq).length?n.push(aA("Sorry, we're unable to send an encrypted message because the remote server for %1$s could not be found",e.iq.getAttribute("from"))):(n.push(aA("Unable to send an encrypted message due to an unexpected error.")),n.push(e.iq.outerHTML)),Wu.alert("error",aA("Error"),n)}else e instanceof KL&&Wu.alert("error",aA("Error"),[e.message]);throw e}(t,e)}return t},function(){var e=this,t=arguments;return new Promise((function(r,i){var s=n.apply(e,t);function o(e){uF(s,r,i,o,a,"next",e)}function a(e){uF(s,r,i,o,a,"throw",e)}o(void 0)}))})();var n})),Wu.listen.on("afterFileUploaded",((e,t)=>e.file.xep454_ivkey?function(e,t){const n=t.oob_url.replace(/^https?:/,"aesgcm:")+"#"+e.file.xep454_ivkey;return Object.assign(t,{oob_url:null,message:n,body:n})}(e,t):t)),Wu.listen.on("beforeFileUpload",((e,t)=>e.get("omemo_active")?function(e){return sU((function*(){const t=crypto.getRandomValues(new Uint8Array(12)),n=yield crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),r=yield crypto.subtle.encrypt({name:"AES-GCM",iv:t},n,yield e.arrayBuffer()),i=yield window.crypto.subtle.exportKey("raw",n),s=new File([r],e.name,{type:e.type,lastModified:e.lastModified});return Object.assign(s,{xep454_ivkey:mU(t)+mU(i)}),s}))()}(t):t)),Wu.listen.on("parseMessage",TU),Wu.listen.on("parseMUCMessage",TU),Wu.listen.on("chatBoxViewInitialized",MU),Wu.listen.on("chatRoomViewInitialized",MU),Wu.listen.on("connected",HU),Wu.listen.on("getToolbarButtons",KU),Wu.listen.on("statusInitialized",GU),Wu.listen.on("addClientFeatures",(()=>Wu.disco.own.features.add(`${dF.NS.OMEMO_DEVICELIST}+notify`))),Wu.listen.on("afterMessageBodyTransformed",kU),Wu.listen.on("userDetailsModalInitialized",(e=>{LU(e.get("jid")).catch((e=>Q.error(e)))})),Wu.listen.on("profileModalInitialized",(()=>{LU(Ao.session.get("bare_jid")).catch((e=>Q.error(e)))})),Wu.listen.on("clearSession",(()=>{delete Ao.state.omemo_store,hF(Ao)&&Ao.state.devicelists&&(Ao.state.devicelists.clearStore(),delete Ao.state.devicelists)}))}});const{Strophe:mF,$iq:gF}=Hp.env,{CHATROOMS_TYPE:vF}=Xx;function yF(e){return pF((function*(){if(!e){const t=Ao.session.get("bare_jid");e=t}const t=Ao.session.get("push_enabled")||[];if(t.includes(e))return;const n=Wu.settings.get("push_app_servers").filter((e=>!e.disable)),r=Wu.settings.get("push_app_servers").filter((e=>e.disable)),i=n.map((t=>function(e,t){return pF((function*(){if(!t.jid||!t.node)return;if(!(yield Wu.disco.getIdentity("pubsub","push",t.jid)))return Q.warn(`Not enabling push the service "${t.jid}", it doesn't have the right disco identtiy.`);const n=yield Promise.all([Wu.disco.supports(mF.NS.PUSH,t.jid),Wu.disco.supports(mF.NS.PUSH,e)]);if(!n[0]&&!n[1])return void Q.warn(`Not enabling push app server "${t.jid}", no disco support from your server.`);const r=gF({type:"set"}),i=Ao.session.get("bare_jid");return e!==i&&r.attrs({to:e}),r.c("enable",{xmlns:mF.NS.PUSH,jid:t.jid,node:t.node}),t.secret&&r.c("x",{xmlns:mF.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t(`${mF.NS.PUBSUB}#publish-options`).up().up().c("field",{var:"secret"}).c("value").t(t.secret),Wu.sendIQ(r)}))()}(e,t))),s=r.map((t=>function(e,t){return pF((function*(){if(!t.jid)return;const n=Ao.session.get("bare_jid");if(!(yield Wu.disco.supports(mF.NS.PUSH,e||n)))return void Q.warn(`Not disabling push app server "${t.jid}", no disco support from your server.`);const r=gF({type:"set"});e!==n&&r.attrs({to:e}),r.c("disable",{xmlns:mF.NS.PUSH,jid:t.jid}),t.node&&r.attrs({node:t.node}),Wu.sendIQ(r).catch((e=>{Q.error(`Could not disable push app server for ${t.jid}`),Q.error(e)}))}))()}(e,t)));try{yield Promise.all(i.concat(s))}catch(e){Q.error("Could not enable or disable push App Server"),e&&Q.error(e)}finally{t.push(e)}Ao.session.save("push_enabled",t)}))()}function bF(e){e.get("type")==vF&&yF(mF.getDomainFromJid(e.get("jid")))}const{Strophe:_F}=Hp.env;function wF(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function SF(e){return(t=function*(){yield Wu.waitUntil("controlBoxInitialized");const{chatboxes:t}=Ao.state;t.get("controlbox").set({"active-form":e})},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){wF(s,r,i,o,a,"next",e)}function a(e){wF(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function xF(e){"#converse/login"===location.hash?(null==e||e.preventDefault(),SF("login")):"#converse/register"===location.hash&&(null==e||e.preventDefault(),SF("register"))}_F.addNamespace("PUSH","urn:xmpp:push:0"),Hp.plugins.add("converse-push",{initialize(){Wu.settings.extend({push_app_servers:[],enable_muc_push:!1}),Wu.listen.on("statusInitialized",(()=>yF())),Wu.settings.get("enable_muc_push")&&Wu.listen.on("chatBoxesInitialized",(()=>Ao.state.chatboxes.on("add",bF)))}});const AF=()=>{const e=aA("Already have a chat account?"),t=aA("Go back to login");return mf`<div class="switch-form"><p class="mb-1">${e}</p><a class="login-here toggle-register-login" href="#converse/login">${t}</a></div>`};function jF(e){const t=Wu.settings.get("registration_domain"),n=aA("Create your account"),r=aA("Please enter the XMPP provider to register with:"),i=!t&&e.status===$F;return mf`<form id="converse-register" class="converse-form" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${n}</legend><div class="pt-3"><label class="form-label">${r}</label> ${t||function(e){const t=Wu.settings.get("domain_placeholder"),n=aA("Tip: A list of public XMPP providers is available"),r=aA("here"),i=Wu.settings.get("providers_link");return mf`<input class="form-control" required="required" type="text" name="domain" placeholder="${t}" value="${e.domain}"><p class="form-text text-muted">${n} <a href="${i}" class="url" target="_blank" rel="noopener">${r}</a>.</p>${Wu.settings.get("show_connection_url_input")?dD():""}`}(e)}</div>${i?function(){const e=aA("Fetch registration form"),t=aA("Already have a chat account?"),n=aA("Go back to login");return mf`<fieldset class="form-group buttons"><input class="btn btn-primary" type="submit" value="${e}"></fieldset><div class="switch-form"><p class="mb-1">${t}</p><a class="login-here toggle-register-login" href="#converse/login">${n}</a></div>`}():""}</form>`}const $F=0,EF=e=>mf`${e.alert_message?mf`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""} ${e.status===$F?jF(e):""} ${1===e.status?function(e){const t=Wu.settings.get("registration_domain"),n=aA("Cancel");return mf`<form id="converse-register" class="converse-form no-scrolling" @submit="${t=>e.onFormSubmission(t)}">${BO({classes:"hor_centered"})} ${t?"":mf`<button class="btn btn-secondary button-cancel hor_centered" @click="${t=>e.renderProviderChoiceForm(t)}">${n}</button>`}</form>`}(e):""} ${2===e.status?(e=>{const t=aA("Choose a different provider"),n=aA("Account Registration:"),r=aA("Register"),i=Wu.settings.get("registration_domain");return mf`<form id="converse-register" class="converse-form rounded" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${n} ${e.domain}</legend><p class="title">${e.title}</p><p class="form-help instructions">${e.instructions}</p><div class="form-errors hidden"></div>${e.form_fields}<fieldset class="buttons form-group">${e.fields?mf`<input type="submit" class="btn btn-primary" value="${r}">`:""} ${i?"":mf`<input type="button" class="btn btn-secondary button-cancel" value="${t}" @click="${t=>e.renderProviderChoiceForm(t)}">`} ${AF()}</fieldset></form>`})(e):""} ${3===e.status?AF():""}`;var OF=n(9847),CF={};CF.styleTagTransform=D(),CF.setAttributes=N(),CF.insert=k().bind(null,"head"),CF.domAPI=O(),CF.insertStyleElement=I();$()(OF.A,CF);OF.A&&OF.A.locals&&OF.A.locals;function kF(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function TF(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}const{Strophe:NF,sizzle:MF,$iq:IF}=Hp.env,{CONNECTION_STATUS:PF}=Xx,DF=1,RF=2;var zF=new WeakSet;class LF extends uA{static get properties(){return{status:{type:String},domain:{type:String},service_url:{type:String},alert_message:{type:String},alert_type:{type:String}}}initialize(){this.reset(),this.listenTo(Ao,"connectionInitialized",(()=>this.registerHooks()));const e=Wu.settings.get();this.listenTo(e,"change:show_connection_url_input",(()=>this.requestUpdate()));const t=Wu.settings.get("registration_domain");t?this.fetchRegistrationForm(t):this.status=0}render(){return EF(this)}setMessage(e,t){this.alert_type=t,this.alert_message=e}registerHooks(){const e=Wu.connection.get(),t=e._connect_cb.bind(e);e._connect_cb=(e,n,r)=>{this._registering?this.getRegistrationFields(e,n)&&(this._registering=!1):t(e,n,r)}}getRegistrationFields(e,t){const n=Wu.connection.get();n.connected=!0;const r="_reqToData"in n._proto?n._proto._reqToData(e):e;if(!r)return;if(n._proto._connect_cb(r)===NF.Status.CONNFAIL)return this.status=0,this.setErrorMessage(aA("Sorry, we're unable to connect to your chosen provider.")),!1;const i=r.getElementsByTagName("register"),s=r.getElementsByTagName("mechanism");if(0===i.length&&0===s.length)return n._proto._no_auth_received(t),!1;if(0===i.length)return n._changeConnectStatus(NF.Status.REGIFAIL),this.alert_type="danger",this.setErrorMessage(aA("Sorry, the given provider does not support in band account registration. Please try with a different provider.")),!0;n._addSysHandler((e=>this.onRegistrationFields(e)),null,"iq",null,null);const o=IF({type:"get"}).c("query",{xmlns:NF.NS.REGISTER}).tree();return o.setAttribute("id",n.getUniqueId("sendIQ")),n.send(o),n.connected=!1,!0}onRegistrationFields(e){return"error"===e.getAttribute("type")?(this.reportErrors(e),Wu.settings.get("registration_domain")?this.status=3:this.status=0,!1):(this.setFields(e),this.status===DF&&this.renderRegistrationForm(e),!1)}reset(e){Object.assign(this,{fields:{},urls:[],title:"",instructions:"",registered:!1,_registering:!1,domain:null,form_type:null}),e&&Object.assign(this,e)}onFormSubmission(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=e.target;null===n.querySelector("input[name=domain]")?this.submitRegistrationForm(n):this.onProviderChosen(n)}onProviderChosen(e){var t;const n=null===(t=e.querySelector("input[name=domain]"))||void 0===t?void 0:t.value;if(n){const t=new FormData(e);let r=null;if(Wu.settings.get("show_connection_url_input"))if(r=t.get("connection-url"),r.startsWith("wss:"))Wu.settings.set("websocket_url",r);else{if(!r.startsWith("https:"))return this.alert_message=aA("Invalid connection URL, only HTTPS and WSS accepted"),this.alert_type="danger",this.status=0,void this.requestUpdate();Wu.settings.set("bosh_service_url",r)}this.fetchRegistrationForm(n.trim(),null==r?void 0:r.trim())}else this.status=0}fetchRegistrationForm(e,t){var n;return this.status=DF,this.reset({_registering:!0,domain:NF.getDomainFromJid(e),service_url:t}),Wu.connection.init(),null===(n=Wu.connection.get())||void 0===n||n.connect(this.domain,"",((e,t)=>this.onConnectStatusChanged(e,t))),!1}onConnectStatusChanged(e,t){if(Q.debug("converse-register: onConnectStatusChanged"),[NF.Status.DISCONNECTED,NF.Status.CONNFAIL,NF.Status.REGIFAIL,NF.Status.NOTACCEPTABLE,NF.Status.CONFLICT].includes(e))Q.warn(`Problem during registration: Strophe.Status is ${PF[e]}`),this.abortRegistration(t);else if(e===NF.Status.REGISTERED){if(Q.debug("Registered successfully."),Wu.connection.get().reset(),["converse/login","converse/register"].includes(window.location.hash)&&history.pushState(null,"",window.location.pathname),SF("login"),this.fields.password&&this.fields.username){const e=Wu.connection.get();e.connect(this.fields.username.toLowerCase()+"@"+this.domain.toLowerCase(),this.fields.password,e.onConnectStatusChanged),this.setFeedbackMessage(aA("Now logging you in"))}else this.setFeedbackMessage(aA("Registered successfully"));this.reset()}}getLegacyFormFields(){const e=Object.keys(this.fields).map((e=>"username"===e?BA({domain:` @${this.domain}`,name:e,type:"text",label:e,value:"",required:!0}):RA({label:e,name:e,placeholder:e,required:!0,type:"password"===e||"email"===e?e:"text",value:""})));return[...e,...this.urls.map((e=>UA({label:"",value:e})))]}getFormFields(e){if("xform"===this.form_type){const{fields:n}=xm(e);var t;return null!==(t=null==n?void 0:n.map((e=>Up.xFormField2TemplateResult(e,{domain:this.domain}))))&&void 0!==t?t:[]}return this.getLegacyFormFields()}renderRegistrationForm(e){this.form_fields=this.getFormFields(e),this.status=RF}reportErrors(e){return(t=function*(){if((yield rm(e))instanceof ql)return void this.setErrorMessage(`${aA("Registration failed.")} ${aA("Please try a different username.")}`);const t=Array.from(e.querySelectorAll("error"));t.length?this.setErrorMessage(`${aA("Registration failed.")}${t.reduce(((e,t)=>`${e}\n${t.textContent}`),"")}`):this.setErrorMessage(aA("The provider rejected your registration attempt. Please check the values you entered for correctness."))},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){kF(s,r,i,o,a,"next",e)}function a(e){kF(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}renderProviderChoiceForm(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=Wu.connection.get();n._proto._abortAllRequests(),n.reset(),this.status=0}abortRegistration(e){const t=Wu.connection.get();t._proto._abortAllRequests(),t.reset(),[DF,RF].includes(this.status)&&Wu.settings.get("registration_domain")?this.fetchRegistrationForm(Wu.settings.get("registration_domain")):(this.alert_message=e,this.alert_type="danger",this.status=0,this.requestUpdate())}submitRegistrationForm(e){const t=MF(":input:not([type=button]):not([type=submit])",e),n=IF({type:"set",id:Up.getUniqueId()}).c("query",{xmlns:NF.NS.REGISTER});if("xform"===this.form_type){n.c("x",{xmlns:NF.NS.XFORM,type:"submit"});const e=t.map((e=>Up.webForm2xForm(e))).filter((e=>e));e.forEach((e=>n.cnode(e).up()))}else t.forEach((e=>n.c(e.getAttribute("name"),{},e.value)));const r=Wu.connection.get();r._addSysHandler((e=>function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(this,zF,UF).call(this,e)),null,"iq",null,null),r.send(n),this.setFields(n.tree())}setFields(e){const t=e.querySelector("query"),n=MF(`x[xmlns="${NF.NS.XFORM}"]`,t);n.length>0?this.setFieldsFromXForm(n.pop()):this.setFieldsFromLegacy(t)}setFieldsFromLegacy(e){[].forEach.call(e.children,(e=>{"instructions"!==e.tagName.toLowerCase()?"x"!==e.tagName.toLowerCase()?this.fields[e.tagName.toLowerCase()]=NF.getText(e):"jabber:x:oob"===e.getAttribute("xmlns")&&this.urls.concat(MF("url",e).map((e=>e.textContent))):this.instructions=NF.getText(e)})),this.form_type="legacy"}setFieldsFromXForm(e){var t,n,r,i;this.title=null!==(r=null===(t=e.querySelector("title"))||void 0===t?void 0:t.textContent)&&void 0!==r?r:"",this.instructions=null!==(i=null===(n=e.querySelector("instructions"))||void 0===n?void 0:n.textContent)&&void 0!==i?i:"",e.querySelectorAll("field").forEach((e=>{const t=e.getAttribute("var");var n,r;t?this.fields[t.toLowerCase()]=null!==(r=null===(n=e.querySelector("value"))||void 0===n?void 0:n.textContent)&&void 0!==r?r:"":Q.warn("Found field we couldn't parse")})),this.form_type="xform"}constructor(){super(),TF(this,zF),this.urls=[],this.fields={},this.domain=null,this.alert_type="info",this.setErrorMessage=e=>this.setMessage(e,"danger"),this.setFeedbackMessage=e=>this.setMessage(e,"info")}}function UF(e){const t=Wu.connection.get();if("error"===e.getAttribute("type")){Q.info("Registration failed."),this.reportErrors(e);const n=e.getElementsByTagName("error");if(1!==n.length)return t._changeConnectStatus(NF.Status.REGIFAIL,"unknown"),!1;const r=n[0].firstElementChild.tagName.toLowerCase();"conflict"===r?t._changeConnectStatus(NF.Status.CONFLICT,r):"not-acceptable"===r?t._changeConnectStatus(NF.Status.NOTACCEPTABLE,r):t._changeConnectStatus(NF.Status.REGIFAIL,r)}else t._changeConnectStatus(NF.Status.REGISTERED,null);return!1}Wu.elements.define("converse-registration-form",LF);const BF=LF;class FF extends uA{render(){const e=aA("Create an account"),t=aA("Don't have a chat account?");return this.shouldShow()?mf`<div class="mt-3 text-center switch-form"><p class="mb-1">${t}</p><a class="register-account toggle-register-login" href="#converse/register">${e}</a></div>`:""}shouldShow(){return Wu.settings.get("allow_registration")&&!Wu.settings.get("auto_login")&&Ao.pluggable.plugins["converse-register"].enabled(Ao)}}Wu.elements.define("converse-register-link",FF);const qF=FF,{Strophe:HF}=Hp.env,{CONNECTION_STATUS:GF}=Xx;HF.addNamespace("REGISTER","jabber:iq:register");const WF=Object.keys(HF.Status).reduce(((e,t)=>Math.max(e,HF.Status[t])),0);HF.Status.REGIFAIL=WF+1,HF.Status.REGISTERED=WF+2,HF.Status.CONFLICT=WF+3,HF.Status.NOTACCEPTABLE=WF+5,Hp.plugins.add("converse-register",{dependencies:["converse-controlbox"],enabled:()=>!0,initialize(){GF[HF.Status.REGIFAIL]="REGIFAIL",GF[HF.Status.REGISTERED]="REGISTERED",GF[HF.Status.CONFLICT]="CONFLICT",GF[HF.Status.NOTACCEPTABLE]="NOTACCEPTABLE",Wu.settings.extend({allow_registration:!0,domain_placeholder:aA(" e.g. conversejs.org"),providers_link:"https://compliance.conversations.im/",registration_domain:""});const e={RegisterLink:qF,RegistrationForm:BF};Object.assign(Ao.exports,e),xF(),addEventListener("hashchange",xF)}});const{Strophe:VF}=Hp.env,{OPENED:KF}=Xx;class JF extends ae.Model{defaults(){return{muc_domain:Wu.settings.get("muc_domain"),toggle_state:KF,collapsed_domains:[]}}initialize(){super.initialize(),Wu.settings.listen.on("change:muc_domain",(e=>this.setDomain(e)))}setDomain(e){Wu.settings.get("locked_muc_domain")||this.save("muc_domain",VF.getDomainFromJid(e))}}const YF=JF;function XF(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}const{Strophe:QF,$iq:ZF,sizzle:eq}=Hp.env;QF.addNamespace("MUCSEARCH","https://xmlns.zombofant.net/muclumbus/search/1.0");const tq={};function nq(e){return(t=function*(){const t=Wu.settings.get("muc_search_service"),n=Ao.session.get("bare_jid"),r=ZF({type:"get",from:n,to:t}).c("search",{xmlns:QF.NS.MUCSEARCH}).c("set",{xmlns:QF.NS.RSM}).c("max").t(10).up().up().c("x",{xmlns:QF.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("https://xmlns.zombofant.net/muclumbus/search/1.0#params").up().up().c("field",{var:"q",type:"text-single"}).c("value").t(e).up().up().c("field",{var:"sinname",type:"boolean"}).c("value").t("true").up().up().c("field",{var:"sindescription",type:"boolean"}).c("value").t("false").up().up().c("field",{var:"sinaddr",type:"boolean"}).c("value").t("true").up().up().c("field",{var:"min_users",type:"text-single"}).c("value").t("1").up().up().c("field",{var:"key",type:"list-single"}).c("value").t("address").up().c("option").c("value").t("nusers").up().up().c("option").c("value").t("address");let i;try{i=yield Wu.sendIQ(r)}catch(e){return Q.error(e),[]}const s=`result[xmlns="${QF.NS.MUCSEARCH}"] item`;return eq(s,i).map((e=>{var t;const n=e.getAttribute("address");return{label:`${null===(t=e.querySelector("name"))||void 0===t?void 0:t.textContent} (${n})`,value:n}}))},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){XF(s,r,i,o,a,"next",e)}function a(e){XF(s,r,i,o,a,"throw",e)}o(void 0)}))})();var t}function rq(e){return tq[e]||(tq[e]=nq(e)),tq[e]}const iq=e=>{const t=aA("Join");let n;n=Wu.settings.get("locked_muc_domain")?aA("Groupchat name"):aA("Groupchat name or address");const r=Wu.settings.get("muc_roomid_policy_hint"),i=Wu.settings.get("muc_search_service");return mf`<form class="converse-form add-chatroom needs-validation" @submit="${t=>e.openChatRoom(t)}" novalidate><div class="mb-3"><label for="chatroom" class="form-label">${n}:</label><div class="input-group">${i?mf`<converse-autocomplete .getAutoCompleteList="${rq}" .validate="${t=>e.validateMUCJID(t)}" ?autofocus="${!0}" class="add-muc-autocomplete" min_chars="3" name="chatroom" position="below" required></converse-autocomplete>`:""}</div>${r?mf`<div class="mb-3">${eP(Xd.sanitize(r,{ALLOWED_TAGS:["b","br","em"]}))}</div>`:""}</div>${Wu.settings.get("locked_muc_nickname")?"":(()=>{const e=aA("Nickname"),t=aA("This field is required");return mf`<div class="mb-3"><label for="nickname" class="form-label">${e}:</label> <input type="text" title="${t}" required name="nickname" value="${Ao.exports.getDefaultMUCNickname()||""}" class="form-control"></div>`})()} <input type="submit" class="btn btn-primary mt-3" name="join" value="${t||""}"></form>`};var sq=n(3370),oq={};oq.styleTagTransform=D(),oq.setAttributes=N(),oq.insert=k().bind(null,"head"),oq.domAPI=O(),oq.insertStyleElement=I();$()(sq.A,oq);sq.A&&sq.A.locals&&sq.A.locals;function aq(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function cq(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){aq(s,r,i,o,a,"next",e)}function a(e){aq(s,r,i,o,a,"throw",e)}o(void 0)}))}}function lq(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uq(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const dq=Hp.env.utils,{Strophe:hq}=Hp.env;Wu.elements.define("converse-add-muc-modal",class extends ak{initialize(){super.initialize(),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>{var e;null===(e=this.querySelector('input[name="chatroom"]'))||void 0===e||e.focus()}),!1)}renderModal(){return iq(this)}getModalTitle(){return aA("Enter a new Groupchat")}parseRoomDataFromEvent(e){var t;const n=new FormData(e),r=null===(t=n.get("chatroom"))||void 0===t?void 0:t.trim();let i;if(Wu.settings.get("locked_muc_nickname")){if(i=Ao.exports.getDefaultMUCNickname(),!i)throw new Error("Using locked_muc_nickname but no nickname found!")}else i=n.get("nickname").trim();return{jid:r,nick:i}}normalizeNode(e){return e.trim().replace(/\s+/g,"-").replace(/\u0142/g,"l").replace(/[^\x00-\x7F]/g,(e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,""))).replace(/[^a-zA-Z0-9-]/g,"-").replace(/-+/g,"-").replace(/[^a-zA-Z0-9]$/g,"").toLowerCase()}openChatRoom(e){return cq((function*(){e.preventDefault();const t=this.querySelector("converse-autocomplete");if((yield t.onChange()).error_message)return;const{escapeNode:n,getNodeFromJid:r,getDomainFromJid:i}=hq,s=e.target,o=this.parseRoomDataFromEvent(s);var a;const c={nick:null!==(a=o.nick)&&void 0!==a?a:void 0};let l;if(Wu.settings.get("locked_muc_domain")||!dq.isValidJID(o.jid)){const e=yield dq.muc.getDefaultMUCService();e&&(c.name=o.jid,c.auto_configure=!0,c.roomconfig={roomname:o.jid},l=`${this.normalizeNode(o.jid)}@${e}`.toLowerCase())}l||(l=`${n(r(o.jid))}@${i(o.jid)}`.toLowerCase()),Wu.rooms.open(l,uq(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){lq(e,t,n[t])}))}return e}({},c),{jid:l}),!0),s.reset(),this.modal.hide()})).call(this)}validateMUCJID(e){return cq((function*(){if(0===e.length)return aA("Invalid groupchat address, it cannot be empty.");if(e.split("/").length-1>0)return aA("Invalid groupchat address, a forward slash is not allowed.");if(e.split("@").length-1>1)return aA("Invalid groupchat address, more than one @ sign is not allowed.");if(e.startsWith("@")||e.endsWith("@"))return aA("Invalid groupchat address, it cannot start or end with an @ sign.");if(!e.includes("@")){if(!(yield dq.muc.getDefaultMUCService()))return aA("No default groupchat service found. You'll need to specify the full address, for example room@conference.example.org")}const t=Wu.settings.get("muc_roomid_policy");if(t&&Wu.settings.get("muc_domain")){!Wu.settings.get("locked_muc_domain")&&dq.isValidJID(e)||(e=`${hq.escapeNode(e)}@${Wu.settings.get("muc_domain")}`);const n=hq.getNodeFromJid(e),r=hq.getDomainFromJid(e);if(Wu.settings.get("muc_domain")===r&&!t.test(n))return aA("Groupchat id is invalid.")}return""}))()}});const fq=e=>mf`${e.show_form?(e=>{const t=aA("Show groupchats"),n=aA("Server address");return mf`<form class="converse-form list-chatrooms" @submit="${e.submitForm}"><div><label class="form-label" for="chatroom">${n}:</label> <input type="text" autofocus @change="${e.setDomainFromEvent}" value="${e.muc_domain||""}" required="required" name="server" class="form-control" placeholder="${e.server_placeholder}"></div><input type="submit" class="btn btn-primary" name="list" value="${t}"></form>`})(e):""}<ul class="available-chatrooms list-group">${e.loading_items?mf`<li class="list-group-item">${BO()}</li>`:""} ${e.feedback_text?mf`<li class="list-group-item active">${e.feedback_text}</li>`:""} ${xN(e.items,(e=>e.jid),(t=>((e,t)=>{const n=aA("Show more information on this groupchat"),r=aA("Click to open this groupchat");return mf`<li class="room-item list-group-item"><div class="available-chatroom d-flex flex-row"><a class="open-room available-room w-100" @click="${e.openRoom}" data-room-jid="${t.jid}" data-room-name="${t.name}" title="${r}" href="#">${t.name||t.jid}</a> <a class="right room-info icon-room-info" @click="${e.toggleRoomInfo}" data-room-jid="${t.jid}" title="${n}" href="#"></a></div></li>`})(e,t)))}</ul>`,{Strophe:pq,$iq:mq,sizzle:gq}=Hp.env,{getAttributes:vq}=Up;function yq(e,t){var n,r;e.querySelector("span.spinner").remove(),e.querySelector("a.room-info").classList.add("selected"),e.insertAdjacentHTML("beforeend",Up.getElementFromTemplateResult((e=>{const t=aA("Description:"),n=aA("Groupchat XMPP Address:"),r=aA("Participants:"),i=aA("Features:"),s=aA("Requires authentication"),o=aA("Hidden"),a=aA("Requires an invitation"),c=aA("Moderated"),l=aA("Non-anonymous"),u=aA("Open"),d=aA("Permanent"),h=aA("Public"),f=aA("Semi-anonymous"),p=aA("Temporary"),m=aA("Unmoderated");return mf`<div class="room-info"><p class="room-info"><strong>${n}</strong> ${e.jid}</p><p class="room-info"><strong>${t}</strong> ${e.desc}</p><p class="room-info"><strong>${r}</strong> ${e.occ}</p><p class="room-info"><strong>${i}</strong></p><ul>${e.passwordprotected?mf`<li class="room-info locked">${s}</li>`:""} ${e.hidden?mf`<li class="room-info">${o}</li>`:""} ${e.membersonly?mf`<li class="room-info">${a}</li>`:""} ${e.moderated?mf`<li class="room-info">${c}</li>`:""} ${e.nonanonymous?mf`<li class="room-info">${l}</li>`:""} ${e.open?mf`<li class="room-info">${u}</li>`:""} ${e.persistent?mf`<li class="room-info">${d}</li>`:""} ${e.publicroom?mf`<li class="room-info">${h}</li>`:""} ${e.semianonymous?mf`<li class="room-info">${f}</li>`:""} ${e.temporary?mf`<li class="room-info">${p}</li>`:""} ${e.unmoderated?mf`<li class="room-info">${m}</li>`:""}</ul><p></p></div>`})({jid:t.getAttribute("from"),desc:null===(n=gq('field[var="muc#roominfo_description"] value',t).shift())||void 0===n?void 0:n.textContent,occ:null===(r=gq('field[var="muc#roominfo_occupants"] value',t).shift())||void 0===r?void 0:r.textContent,hidden:gq('feature[var="muc_hidden"]',t).length,membersonly:gq('feature[var="muc_membersonly"]',t).length,moderated:gq('feature[var="muc_moderated"]',t).length,nonanonymous:gq('feature[var="muc_nonanonymous"]',t).length,open:gq('feature[var="muc_open"]',t).length,passwordprotected:gq('feature[var="muc_passwordprotected"]',t).length,persistent:gq('feature[var="muc_persistent"]',t).length,publicroom:gq('feature[var="muc_publicroom"]',t).length,semianonymous:gq('feature[var="muc_semianonymous"]',t).length,temporary:gq('feature[var="muc_temporary"]',t).length,unmoderated:gq('feature[var="muc_unmoderated"]',t).length})))}Wu.elements.define("converse-muc-list-modal",class extends ak{initialize(){super.initialize(),this.listenTo(this.model,"change:muc_domain",this.onDomainChange),this.listenTo(this.model,"change:feedback_text",(()=>this.requestUpdate())),this.addEventListener("shown.bs.modal",(()=>Wu.settings.get("locked_muc_domain")&&this.updateRoomsList())),this.model.save("feedback_text","")}renderModal(){return fq(Object.assign(this.model.toJSON(),{show_form:!Wu.settings.get("locked_muc_domain"),server_placeholder:this.model.get("muc_domain")||aA("conference.example.org"),items:this.items,loading_items:this.loading_items,openRoom:e=>this.openRoom(e),setDomainFromEvent:e=>this.setDomainFromEvent(e),submitForm:e=>this.showRooms(e),toggleRoomInfo:e=>this.toggleRoomInfo(e)}))}getModalTitle(){return aA("Query for Groupchats")}openRoom(e){e.preventDefault();const t=e.target.getAttribute("data-room-jid"),n=e.target.getAttribute("data-room-name");this.modal.hide(),Wu.rooms.open(t,{name:n},!0)}toggleRoomInfo(e){e.preventDefault(),function(e){const t=Up.ancestor(e.target,".room-item"),n=t.querySelector("div.room-info");n?(Up.slideIn(n).then(Up.removeElement),t.querySelector("a.room-info").classList.remove("selected")):(t.insertAdjacentElement("beforeend",Up.getElementFromTemplateResult(BO())),Wu.disco.info(e.target.getAttribute("data-room-jid"),null).then((e=>yq(t,e))).catch((e=>Q.error(e))))}(e)}onDomainChange(){Wu.settings.get("auto_list_rooms")&&this.updateRoomsList()}onRoomsFound(e){this.loading_items=!1;const t=e?gq("query item",e):[];return t.length?(this.model.set({feedback_text:aA("Groupchats found")},{silent:!0}),this.items=t.map(vq)):(this.items=[],this.model.set({feedback_text:aA("No groupchats found")},{silent:!0})),this.requestUpdate(),!0}updateRoomsList(){const e=mq({to:this.model.get("muc_domain"),from:Wu.connection.get().jid,type:"get"}).c("query",{xmlns:pq.NS.DISCO_ITEMS});Wu.sendIQ(e).then((e=>this.onRoomsFound(e))).catch((()=>this.onRoomsFound()))}showRooms(e){e.preventDefault(),this.loading_items=!0,this.requestUpdate();const t=new FormData(e.target);this.model.setDomain(t.get("server")),this.updateRoomsList()}setDomainFromEvent(e){this.model.setDomain(e.target.value)}setNick(e){this.model.save({nick:e.target.value})}constructor(e){super(e),this.items=[],this.loading_items=!1}});var bq=n(2579),_q={};_q.styleTagTransform=D(),_q.setAttributes=N(),_q.insert=k().bind(null,"head"),_q.domAPI=O(),_q.insertStyleElement=I();$()(bq.A,_q);bq.A&&bq.A.locals&&bq.A.locals;const{CHATROOMS_TYPE:wq,CLOSED:Sq}=Xx,{isUniView:xq}=Up;function Aq(e){return xq()&&!e.get("hidden")}function jq(e,t){var n;const r=aA("Leave this groupchat"),i=t.get("num_unread_general")||t.get("has_activity");return mf`<li class="list-item controlbox-padded available-chatroom d-flex flex-row ${Aq(t)?"open":""} ${i?"unread-msgs":""}" data-room-jid="${t.get("jid")}"><a class="list-item-link open-room available-room w-100" data-room-jid="${t.get("jid")}" data-room-name="${t.getDisplayName()}" title="${aA("Click to open this groupchat")}" @click="${t=>e.openRoom(t)}"><converse-avatar .model="${t}" class="avatar avatar-muc" name="${t.getDisplayName()}" nonce="${null===(n=t.vcard)||void 0===n?void 0:n.get("vcard_updated")}" height="30" width="30"></converse-avatar><span>${t.get("num_unread")?function(e){return mf`<span class="list-item-badge badge badge--muc msgs-indicator">${MN(e)}</span>`}(t):t.get("has_activity")?mf`<span class="list-item-badge badge badge--muc msgs-indicator"></span>`:""} ${t.getDisplayName()}</span> </a><a class="list-item-action close-room" tabindex="0" data-room-jid="${t.get("jid")}" data-room-name="${t.getDisplayName()}" title="${r}" @click="${t=>e.closeRoom(t)}"><converse-icon class="fa fa-sign-out-alt" size="1.2em" color="${Aq(t)?"var(--foreground-color)":""}"></converse-icon></a></li>`}function $q(e,t){const n=new Map;for(const e of t){const t=e.get("jid").split("@").at(-1).toLowerCase();n.has(t)?n.get(t).push(e):n.set(t,[e])}const r=Array.from(n.keys());return r.sort(),r.map((t=>function(e,t,n){const r=aA("Click to hide these rooms"),i=e.model.get("collapsed_domains").includes(t);return mf`<div class="muc-domain-group" data-domain="${t}"><a href="#" class="list-toggle muc-domain-group-toggle controlbox-padded" title="${r}" @click="${n=>e.toggleDomainList(n,t)}"><converse-icon class="fa ${i?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--muc-color)"></converse-icon>${t}</a><ul class="items-list muc-domain-group-rooms ${i?"collapsed":""}" data-domain="${t}">${n.map((t=>jq(e,t)))}</ul></div>`}(e,t,n.get(t))))}function Eq(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Oq(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Eq(s,r,i,o,a,"next",e)}function a(e){Eq(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{Strophe:Cq}=Hp.env,{initStorage:kq}=Up,{CLOSED:Tq,OPENED:Nq}=Xx;Wu.elements.define("converse-rooms-list",class extends uA{initialize(){const e=`converse.roomspanel${Ao.session.get("bare_jid")}`;this.model=new YF({id:e}),Ao.state.roomslist=this.model,kq(this.model,e),this.model.fetch();const{chatboxes:t}=Ao.state;this.listenTo(t,"add",this.renderIfChatRoom),this.listenTo(t,"remove",this.renderIfChatRoom),this.listenTo(t,"destroy",this.renderIfChatRoom),this.listenTo(t,"change",this.renderIfRelevantChange),this.listenTo(t,"vcard:add",(()=>this.requestUpdate())),this.listenTo(t,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=Wu.settings.get("muc_grouped_by_domain"),{chatboxes:n}=Ao.state,r=n.filter((e=>e.get("type")===wq));r.sort(((e,t)=>e.getDisplayName().toLowerCase()<=t.getDisplayName().toLowerCase()?-1:1));const i=aA("Click to toggle the list of open groupchats"),s=aA("Groupchats"),o=aA("Query server"),a=aA("Add groupchat"),c=aA("Bookmarks"),l=e.model.get("toggle_state")===Sq,u=[mf`<a class="dropdown-item show-add-muc-modal" role="button" @click="${t=>Wu.modal.show("converse-add-muc-modal",{model:e.model},t)}" data-toggle="modal" data-target="#add-chatrooms-modal"><converse-icon class="fa fa-plus" size="1em"></converse-icon>${a}</a>`,mf`<a class="dropdown-item show-list-muc-modal" role="button" @click="${t=>Wu.modal.show("converse-muc-list-modal",{model:e.model},t)}" data-toggle="modal" data-target="#muc-list-modal"><converse-icon class="fa fa-list-ul" size="1em"></converse-icon>${o}</a>`,mf`<a class="dropdown-item show-bookmark-list-modal" role="button" @click="${t=>Wu.modal.show("converse-bookmark-list-modal",{model:e.model},t)}" data-toggle="modal"><converse-icon class="fa fa-bookmark" size="1em"></converse-icon>${c}</a>`];return mf`<div class="d-flex controlbox-padded"><span class="w-100 controlbox-heading controlbox-heading--groupchats"><a class="list-toggle open-rooms-toggle" role="heading" aria-level="3" title="${i}" @click="${t=>e.toggleRoomsList(t)}">${s} ${r.length?mf`<converse-icon class="fa ${l?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--muc-color)"></converse-icon>`:""}</a></span><converse-dropdown class="btn-group dropstart" .items="${u}"></converse-dropdown></div><div class="list-container list-container--openrooms ${r.length?"":"hidden"}"><ul class="items-list rooms-list open-rooms-list ${l?"collapsed":""}">${t?$q(e,r):r.map((t=>jq(e,t)))}</ul></div>`})(this)}renderIfChatRoom(e){Up.muc.isChatRoom(e)&&this.requestUpdate()}renderIfRelevantChange(e){const t=["bookmarked","hidden","name","num_unread","num_unread_general","has_activity"],n=e.changed||{};Up.muc.isChatRoom(e)&&Object.keys(n).filter((e=>t.includes(e))).length&&this.requestUpdate()}openRoom(e){return Oq((function*(){e.preventDefault();const t=Up.ancestor(e.target,".open-room"),n=t.getAttribute("data-room-name"),r=t.getAttribute("data-room-jid"),i={name:n||Cq.unescapeNode(Cq.getNodeFromJid(r))||r};yield Wu.rooms.open(r,i,!0)}))()}closeRoom(e){return Oq((function*(){e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-room-name"),r=t.getAttribute("data-room-jid");if(yield Wu.confirm(aA("Confirm"),aA("Are you sure you want to leave the groupchat %1$s?",n))){(yield Wu.rooms.get(r)).close()}}))()}toggleRoomsList(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=this.querySelector(".open-rooms-list");this.model.get("toggle_state")===Tq?Up.slideOut(n).then((()=>this.model.save({toggle_state:Nq}))):Up.slideIn(n).then((()=>this.model.save({toggle_state:Tq})))}toggleDomainList(e,t){var n;null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const r=this.model.get("collapsed_domains");r.includes(t)?this.model.save({collapsed_domains:r.filter((e=>e!==t))}):this.model.save({collapsed_domains:[...r,t]})}}),Hp.plugins.add("converse-roomslist",{dependencies:["converse-singleton","converse-controlbox","converse-muc","converse-bookmarks"],initialize(){Wu.settings.extend({muc_grouped_by_domain:!1}),Wu.listen.on("clearSession",(()=>{var e;Up.shouldClearCache(Ao)&&(null===(e=Ao.state.roomslist)||void 0===e||e.destroy())}))}});function Mq(){return window.matchMedia("(prefers-color-scheme: dark)").matches?Wu.settings.get("dark_theme"):Wu.settings.get("theme")}function Iq(){var e;if(!Wu.settings.get("auto_insert"))return;const t=Wu.settings.get("root");if(!t.querySelector("converse-root")&&!(null===(e=t.matches)||void 0===e?void 0:e.call(t,"converse-root"))){const e=document.createElement("converse-root"),n=t.querySelector("body");n?n.appendChild(e):t.appendChild(e)}}var Pq=n(5190),Dq={};Dq.styleTagTransform=D(),Dq.setAttributes=N(),Dq.insert=k().bind(null,"head"),Dq.domAPI=O(),Dq.insertStyleElement=I();$()(Pq.A,Dq);Pq.A&&Pq.A.locals&&Pq.A.locals;class Rq extends uA{render(){return(()=>{const e=Wu.settings.get("singleton")?["converse-singleton"]:[];return e.push(`converse-${Wu.settings.get("view_mode")}`),mf`${Wu.settings.get("show_background")?mf`<converse-bg logo></converse-bg>`:""}<converse-chats class="converse-chatboxes row justify-content-start g-0 ${e.join(" ")}"></converse-chats><converse-modals id="converse-modals" class="modals"></converse-modals><converse-toasts></converse-toasts><converse-fontawesome></converse-fontawesome>`})()}initialize(){this.setAttribute("id","conversejs"),this.setThemeAttributes();const e=Wu.settings.get();this.listenTo(e,"change:view_mode",(()=>this.setThemeAttributes())),this.listenTo(e,"change:singleton",(()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: light)").addListener((()=>this.setThemeAttributes()))}setThemeAttributes(){const e=Mq();this.className="",this.classList.add("container-fluid"),this.classList.add("g-0"),this.classList.add("conversejs"),this.classList.add(`converse-${Wu.settings.get("view_mode")}`),this.classList.add(`theme-${e}`),this.setAttribute("data-bs-theme",e),this.setAttribute("data-converse-theme",e);const t=oA.getLocale();this.setAttribute("lang",t);Wu.settings.get("rtl_langs").includes(t)?this.setAttribute("dir","rtl"):this.setAttribute("dir","ltr"),this.requestUpdate()}}var zq=n(4842),Lq={};Lq.styleTagTransform=D(),Lq.setAttributes=N(),Lq.insert=k().bind(null,"head"),Lq.domAPI=O(),Lq.insertStyleElement=I();$()(zq.A,Lq);zq.A&&zq.A.locals&&zq.A.locals;class Uq extends uA{static get properties(){return{logo:{type:Boolean}}}initialize(){this.setThemeAttributes();const e=Wu.settings.get();this.listenTo(e,"change:view_mode",(()=>this.setThemeAttributes())),this.listenTo(e,"change:singleton",(()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: light)").addListener((()=>this.setThemeAttributes()))}render(){return e=this,mf`${"cyberpunk"===Wu.settings.get("theme")?mf`<section class="moving-grid"><div class="container"><div class="static-lines">${[...Array(20).keys()].map((()=>mf`<div class="vert"></div>`))}</div><div class="moving-lines">${[...Array(60).keys()].map((()=>mf`<div class="horz"></div>`))}</div></div></section>`:""} ${e.hasAttribute("logo")?mf`<div class="inner-content converse-brand row"><div class="converse-brand__heading"><converse-logo></converse-logo><span class="converse-brand__text"><span>converse<span class="subdued">.js</span></span><p class="byline">messaging freedom</p></span></div>${"overlayed"===Wu.settings.get("view_mode")?mf`<div class="converse-brand__padding"></div>`:""}</div>`:""}`;var e}setThemeAttributes(){const e=Mq();this.classList.add(`theme-${e}`),this.setAttribute("data-converse-theme",e),this.setAttribute("data-bs-theme",e),this.requestUpdate()}}Wu.elements.define("converse-bg",Uq);Hp.plugins.add("converse-rootview",{initialize(){Wu.settings.extend({auto_insert:!0,dark_theme:"dracula",rtl_langs:["ar","fa","he","ug"],show_background:!1,theme:"classic"}),Wu.listen.on("chatBoxesInitialized",Iq),Wu.elements.define("converse-root",Rq)}});const Bq={dnd:aA("This contact is busy"),online:aA("This contact is online"),offline:aA("This contact is offline"),unavailable:aA("This contact is unavailable"),xa:aA("This contact is away for an extended period"),away:aA("This contact is away")};function Fq(e){const t=e.model.getDisplayName(),n=aA("Click to remove %1$s as a contact",t);return mf`<a class="dropdown-item remove-xmpp-contact" role="button" @click="${t=>e.removeContact(t)}" title="${n}" data-toggle="modal"><converse-icon class="fa fa-trash-alt" size="1em"></converse-icon>${aA("Remove")}</a>`}function qq(e){const t=e.model.getDisplayName(),n=aA("Click to show more details about %1$s",t);return mf`<a class="dropdown-item" role="button" @click="${t=>e.showUserDetailsModal(t)}" title="${n}" data-toggle="modal"><converse-icon class="fa fa-id-card" size="1em"></converse-icon>${aA("Details")}</a>`}function Hq(e){const t=e.model.getDisplayName(),n=aA("Click to add %1$s as a contact",t);return mf`<a class="dropdown-item add-contact" role="button" @click="${t=>e.addContact(t)}" title="${n}" data-toggle="modal"><converse-icon class="fa fa-user-plus" size="1.5em"></converse-icon>${aA("Save as contact")}</a>`}function Gq(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Wq(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Gq(s,r,i,o,a,"next",e)}function a(e){Gq(s,r,i,o,a,"throw",e)}o(void 0)}))}}function Vq(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kq(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class Jq extends zO{static get properties(){return Kq(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Vq(e,t,n[t])}))}return e}({},super.properties),{model:{type:Object}})}initialize(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"highlight",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"presence:change",(()=>this.requestUpdate()))}render(){if(this.model instanceof Ao.exports.RosterContact){if(!0===this.model.get("requesting"))return(e=>{var t;const n=MN(e.model),r=e.model.get("jid"),i=e.model.getDisplayName(),s=aA("Click to accept the contact request from %1$s (XMPP address: %2$s)",i,r),o=aA("Click to decline the contact request from %1$s (XMPP address: %2$s)",i,r),a=aA("Click to chat with %1$s (XMPP address: %2$s)",i,r),c=[mf`<a class="dropdown-item accept-xmpp-request" role="button" @click="${t=>e.acceptRequest(t)}" aria-label="${s}" title="${s}" href="#"><converse-icon class="fa fa-check" size="1em"></converse-icon>${aA("Accept as contact")}</a>`,qq(e),mf`<a class="dropdown-item decline-xmpp-request" role="button" @click="${t=>e.declineRequest(t)}" aria-label="${o}" title="${o}"><converse-icon class="fa fa-times" size="1em"></converse-icon>${aA("Remove")}</a>`];return mf`<a class="list-item-link cbox-list-item open-chat ${n?"unread-msgs":""}" title="${a}" href="#" data-jid="${r}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${null===(t=e.model.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="30" width="30"></converse-avatar></span>${n?mf`<span class="msgs-indicator badge">${n}</span>`:""} <span class="contact-name ${n?"unread-msgs":""}">${i}</span> </a><span class="contact-actions"><converse-dropdown class="btn-group dropstart list-item-action" .items="${c}"></converse-dropdown></span>`})(this);if(!this.model.get("subscription"))return(e=>{var t;const n=MN(e.model),r=e.model.getDisplayName(),i=e.model.get("jid"),s=aA("Click to chat with %1$s (XMPP address: %2$s)",r,i),o=[qq(e),Hq(e),...Wu.settings.get("allow_contact_removal")?[Fq(e)]:[]];return mf`<a class="list-item-link cbox-list-item open-chat ${n?"unread-msgs":""}" title="${s}" href="#" data-jid="${i}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${null===(t=e.model.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="30" width="30"></converse-avatar></span>${n?mf`<span class="msgs-indicator badge">${n}</span>`:""} <span class="contact-name ${n?"unread-msgs":""}">${r}</span> </a><span class="contact-actions"><converse-dropdown class="btn-group dropstart list-item-action" .items="${o}"></converse-dropdown></span>`})(this)}return(e=>{var t;const n=Ao.session.get("bare_jid"),r=e.model.getStatus()||"offline";let i,s;[i,s]="online"===r?["fa fa-circle","chat-status-online"]:"dnd"===r?["fa fa-minus-circle","chat-status-busy"]:"away"===r?["fa fa-circle","chat-status-away"]:["fa fa-circle","chat-status-offline"];const o=n===e.model.get("jid"),a=Bq[r],c=MN(e.model),l=e.model.getDisplayName({context:"roster"}),u=e.model.get("jid"),d=o?aA("Click to chat with yourself"):aA("Click to chat with %1$s (XMPP address: %2$s)",l,u),h=[qq(e),...Wu.settings.get("allow_contact_removal")&&!o?[Fq(e)]:[]];return mf`<a class="list-item-link cbox-list-item open-chat ${c?"unread-msgs":""}" title="${d}" href="#" data-jid="${u}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${null===(t=e.model.vcard)||void 0===t?void 0:t.get("vcard_updated")}" height="30" width="30"></converse-avatar>${["both","to"].includes(e.model.get("subscription"))?mf`<converse-icon title="${a}" color="var(--${s})" size="1em" class="${i} chat-status chat-status--avatar"></converse-icon>`:""} </span>${c?mf`<span class="msgs-indicator badge">${c}</span>`:""} <span class="contact-name contact-name--${r} ${c?"unread-msgs":""}">${l}</span> </a><span class="contact-actions"><converse-dropdown class="btn-group dropstart list-item-action" .items="${h}"></converse-dropdown></span>`})(this)}openChat(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Wu.chats.open(this.model.get("jid"),{},!0)}addContact(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Wu.modal.show("converse-add-contact-modal",{contact:this.model},e)}removeContact(e){return Wq((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),yield XM(this.model,!0)})).call(this)}showUserDetailsModal(e){return Wq((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),e.preventDefault(),this.model instanceof Ao.exports.Profile?Wu.modal.show("converse-profile-modal",{model:this.model},e):Wu.modal.show("converse-user-details-modal",{model:this.model},e)})).call(this)}blockContact(e){return Wq((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),yield ZM(this.model)})).call(this)}acceptRequest(e){return Wq((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Wu.modal.show("converse-accept-contact-request-modal",{contact:this.model},e)})).call(this)}declineRequest(e){return Wq((function*(){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),QM(this.model)})).call(this)}constructor(){super(),this.model=null,this.observable="once"}}Wu.elements.define("converse-roster-contact",Jq);var Yq=n(3414),Xq={};Xq.styleTagTransform=D(),Xq.setAttributes=N(),Xq.insert=k().bind(null,"head"),Xq.domAPI=O(),Xq.insertStyleElement=I();$()(Yq.A,Xq);Yq.A&&Yq.A.locals&&Yq.A.locals;function Qq(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function Zq(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Qq(s,r,i,o,a,"next",e)}function a(e){Qq(s,r,i,o,a,"throw",e)}o(void 0)}))}}class eH extends ak{initialize(){super.initialize(),this.listenTo(this.contact,"change",(()=>this.requestUpdate())),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>{var e;return null===(e=this.querySelector('input[name="jid"]'))||void 0===e?void 0:e.focus()}),!1)}renderModal(){return(e=>{const t=aA("Add"),n=aA("name@example.org"),r=aA("Groups"),i=aA("Use commas to separate multiple values"),s=aA("Name"),o=Wu.settings.get("xhr_user_search_url"),a=aA("XMPP Address"),c=o?aA("Search name or XMPP address"):a;return mf`<div class="modal-body"><form class="converse-form add-xmpp-contact" @submit="${t=>e.addContactFromForm(t)}">${e.contact?mf`<input type="hidden" name="jid" value="${e.contact.get("jid")}">`:mf`<div class="mb-3"><label class="form-label clearfix" for="jid">${c}:</label> ${o?mf`<converse-autocomplete .getAutoCompleteList="${hI}" position="below" min_chars="2" filter="contains" ?required="${!0}" value="${e.state.get("jid")||""}" placeholder="${n}" name="jid"></converse-autocomplete>`:mf`<converse-autocomplete .list="${dI()}" .data="${(e,t)=>`${t.slice(0,t.indexOf("@"))}@${e}`}" position="below" min_chars="2" filter="startswith" ?required="${!Wu.settings.get("xhr_user_search_url")}" value="${e.state.get("jid")||""}" placeholder="${n}" name="jid"></converse-autocomplete>`}</div>`} ${o?"":mf`<div class="mb-3"><label class="form-label clearfix" for="name">${s}:</label> <input type="text" name="name" value="${e.state.get("nickname")||""}" class="form-control"></div>`}<div class="mb-3"><label class="form-label clearfix" for="name">${r}:</label><div class="mb-1"><small class="form-text text-muted">${i}</small></div><converse-autocomplete .list="${uI()}" name="groups"></converse-autocomplete></div>${e.contact?mf`<div class="mb-3 d-flex justify-content-between"><label class="form-label clearfix w-100" for="jid-display">${a}:</label><p class="form-control-plaintext text-end" id="jid-display">${e.contact.get("jid")}</p></div>`:""} <button type="submit" class="btn btn-primary">${t}</button></form></div>`})(this)}getModalTitle(){return aA("Add a Contact")}validateSubmission(e){return!e||e.split("@").filter((e=>!!e)).length<2?(this.alert(aA("Please enter a valid XMPP address"),"danger",!1),!1):!this.contact&&Ao.state.roster.get(Bs.getBareJidFromJid(e))?(this.alert(aA("This contact has already been added"),"danger",!1),!1):(this.alert(null),!0)}afterSubmission(e,t,n){return Zq((function*(){Wu.contacts.add({jid:e,name:t,groups:n}).catch((e=>{Q.error(e),Wu.toast.show("contact-add-error",{type:"danger",body:aA("Sorry, something went wrong while adding the contact")})})),Wu.chats.open(e,{},!0),this.alert(null),Wu.toast.show("contact-added",{type:"success",body:aA("Contact added successfully")}),this.modal.hide()})).call(this)}addContactFromForm(e){return Zq((function*(){e.preventDefault();const t=e.target,n=new FormData(t);let r,i=(n.get("jid")||"").trim();if(Wu.settings.get("xhr_user_search_url")){const e=i.match(/^(.*) <(.*)>$/);if(!e)return void this.alert(aA('Invalid value for the name and XMPP address. Please use the format "Name <username@example.org>".'),"danger",!1);r=e[1].trim(),i=e[2].trim()}else r=(n.get("name")||"").trim();if(this.validateSubmission(i)){var s;const e=(null===(s=n.get("groups"))||void 0===s?void 0:s.split(",").map((e=>e.trim())).filter((e=>e)))||[];this.afterSubmission(i,r,e),t.reset()}})).call(this)}constructor(){super(),this.contact=null}}Wu.elements.define("converse-add-contact-modal",eH);function tH(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}class nH extends ak{initialize(){super.initialize(),this.listenTo(this.contact,"change",(()=>this.requestUpdate())),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>{var e;return null===(e=this.querySelector('input[name="name"]'))||void 0===e?void 0:e.focus()}),!1)}renderModal(){return(e=>{var t;const n=aA("Accept"),r=aA("Groups"),i=aA("Use commas to separate multiple values"),s=aA("Name"),o=aA("XMPP Address");return mf`<div class="modal-body"><form class="converse-form" @submit="${t=>e.acceptContactRequest(t)}"><div class="mb-3"><label class="form-label clearfix" for="name">${s}:</label> <input type="text" name="name" value="${(null===(t=e.contact.vcard)||void 0===t?void 0:t.get("fullname"))||""}" class="form-control"></div><div class="mb-3"><label class="form-label clearfix" for="name">${r}:</label><div class="mb-1"><small class="form-text text-muted">${i}</small></div><converse-autocomplete .list="${uI()}" name="groups"></converse-autocomplete></div><div class="mb-3 d-flex justify-content-between"><label class="form-label clearfix w-100" for="jid-display">${o}:</label><p class="form-control-plaintext text-end" id="jid-display">${e.contact.get("jid")}</p></div><button type="submit" class="btn btn-primary">${n}</button></form></div>`})(this)}getModalTitle(){return aA("Contact Request")}acceptContactRequest(e){return(t=function*(){var t;e.preventDefault();const n=e.target,r=new FormData(n),i=(r.get("name")||"").trim(),s=(null===(t=r.get("groups"))||void 0===t?void 0:t.split(",").map((e=>e.trim())).filter((e=>e)))||[];try{yield Ao.state.roster.sendContactAddIQ({jid:this.contact.get("jid"),name:i,groups:s}),this.contact.authorize().subscribe()}catch(e){return Q.error(e),void Wu.toast.show("accept-request-error",{type:"danger",body:aA("Sorry, something went wrong while accepting the contact request")})}this.contact.save({nickname:i,groups:s}),Wu.toast.show("accept-request-success",{type:"success",body:aA("Successfully accepted the contact request")}),this.modal.hide()},function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(e){tH(s,r,i,o,a,"next",e)}function a(e){tH(s,r,i,o,a,"throw",e)}o(void 0)}))}).call(this);var t}constructor(e){super(e),this.contact=null}}Wu.elements.define("converse-accept-contact-request-modal",nH);function rH(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function iH(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){rH(s,r,i,o,a,"next",e)}function a(e){rH(s,r,i,o,a,"throw",e)}o(void 0)}))}}class sH extends ak{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>{var e;return null===(e=this.querySelector('input[name="jid"]'))||void 0===e?void 0:e.focus()}),!1)}renderModal(){return(e=>{const t=aA("Start Chat"),n=aA("XMPP Address"),r=e.model.get("error");return mf`<div class="modal-body">${r?mf`<div class="alert alert-danger" role="alert">${r}</div>`:""}<form @submit="${t=>e.startChatFromForm(t)}"><div class="mb-3"><label class="form-label" for="jid">${n}</label> <input type="text" name="jid" class="form-control" required></div><button type="submit" class="btn btn-primary">${t}</button></form></div>`})(this)}getModalTitle(){return aA("Start a new chat")}validateSubmission(e){return!e||e.split("@").filter((e=>!!e)).length<2?(this.model.set("error",aA("Please enter a valid XMPP address")),!1):(this.model.set("error",null),!0)}afterSubmission(e,t){return iH((function*(){try{yield Wu.chats.open(t,{},!0)}catch(e){return Q.error(e),void this.model.set("error",aA("Sorry, something went wrong"))}this.model.clear(),this.modal.hide()})).call(this)}startChatFromForm(e){return iH((function*(){e.preventDefault();const t=e.target,n=(new FormData(t).get("jid")||"").trim();this.validateSubmission(n)&&this.afterSubmission(t,n)})).call(this)}}Wu.elements.define("converse-new-chat-modal",sH);function oH(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function aH(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){oH(s,r,i,o,a,"next",e)}function a(e){oH(s,r,i,o,a,"throw",e)}o(void 0)}))}}function cH(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lH(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class uH extends ak{static get properties(){return lH(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){cH(e,t,n[t])}))}return e}({},super.properties),{filter_text:{type:String}})}initialize(){var e=this,t=()=>super.initialize;return aH((function*(){t().call(e),this.blocklist=yield Wu.blocklist.get(),this.listenTo(this.blocklist,"add",(()=>this.requestUpdate())),this.listenTo(this.blocklist,"remove",(()=>this.requestUpdate())),this.listenTo(this.blocklist,"change",(()=>this.requestUpdate())),this.addEventListener("shown.bs.modal",(()=>{var e;null===(e=this.querySelector('input[name="blocklist_filter"]'))||void 0===e||e.focus()}),!1),this.requestUpdate()})).call(this)}renderModal(){return this.blocklist?(e=>{if(e.blocklist.length){const t=e.filter_text?e.blocklist.filter((t=>t.get("jid").toLowerCase().includes(e.filter_text.toLowerCase()))):e.blocklist;return mf`<form @submit="${t=>e.unblockUsers(t)}"><div class="d-flex justify-content-between">${e.blocklist.length>5?mf`<p style="line-height:3em">${aA("%1$s blocked users shown",t.length)}</p>`:""} ${t.length?mf`<div class="text-end"><button type="submit" class="btn btn-danger mt-2 mb-2">${aA("Unblock selected users")}</button></div>`:""}</div>${e.blocklist.length>5?mf`<div class="mb-3 ${e.filter_text?"input-group":""}"><input autofocus name="blocklist_filter" type="text" class="form-control" value="${e.filter_text}" placeholder="${aA("Filter blocked users")}" @input="${t=>e.filter_text=t.target.value}"> <button type="button" class="btn btn-outline-secondary ${e.filter_text?"":"hidden"}" @click="${()=>{e.filter_text="",e.querySelector('input[name="blocklist_filter"]').value=""}}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${aA("clear")}</button></div><div class="form-check mb-1"><input class="form-check-input" type="checkbox" id="select-all" @change="${t=>e.toggleSelectAll(t)}"> <label class="form-check-label" for="select-all"><strong>${aA("Select All")}</strong></label></div>`:""}<ul class="items-list">${xN(t,(e=>e.get("jid")),(e=>mf`<li class="list-item" @click="${t=>{if("checkbox"===t.target.type)return;t.preventDefault();const n=document.getElementById(`blocklist-${e.get("jid")}`);n.checked=!n.checked}}"><div class="form-check"><input class="form-check-input" type="checkbox" id="blocklist-${e.get("jid")}" name="${e.get("jid")}"> <label class="form-check-label w-100" for="blocklist-${e.get("jid")}">${e.get("jid")}</label></div></li>`))}</ul></form>`}return mf`<p>${aA("No blocked XMPP addresses")}</p>`})(this):mf`<converse-spinner></converse-spinner>`}getModalTitle(){return aA("Blocklist")}unblockUsers(e){return aH((function*(){e.preventDefault();const t=e.target,n=[...new FormData(t).entries()].filter((e=>"on"===e[1])).map((e=>e[0]));yield Wu.blocklist.remove(n);const r=n.length>1?aA("Successfully unblocked %1$s XMPP addresses",n.length):aA("Successfully unblocked one XMPP address");Wu.toast.show("blocked",{type:"success",body:r})}))()}toggleSelectAll(e){const t=e.target.checked;this.querySelectorAll('input[type="checkbox"]').forEach((e=>e.checked=t))}constructor(){super(),this.filter_text=""}}Wu.elements.define("converse-blocklist-modal",uH);const{isUniView:dH}=Up;function hH(e){const t=e.get("jid"),n=[];if(dH()){const e=Ao.state.chatboxes.get(t);e&&!e.get("hidden")&&n.push("open")}const r=e.get("ask"),i=e.get("requesting"),s=e.get("subscription");return"subscribe"===r||"from"===s?n.push("pending-xmpp-contact"):!0===i?n.push("requesting-xmpp-contact"):("both"===s||"to"===s||Up.isSameBareJID(t,Wu.connection.get().jid))&&(n.push("current-xmpp-contact"),n.push(s),n.push(e.getStatus())),mf`<li class="list-item d-flex controlbox-padded ${n.join(" ")}" data-status="${e.getStatus()}"><converse-roster-contact .model="${e}"></converse-roster-contact></li>`}const fH=e=>{const t=aA("Filter"),n=aA("Filter by contact name"),r=aA("Filter by group name"),i=aA("Filter by status"),s=aA("Any"),o=aA("Unread"),{offline:a,xa:c,away:l,dnd:u,chat:d,online:h}=XO,f=e.model.get("state"),p=e.model.get("text"),m=e.model.get("type");return mf`<form class="controlbox-padded items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="flex-nowrap"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===m?"selected":""}" data-type="items" title="${n}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-users clickable ${"groups"===m?"selected":""}" data-type="groups" title="${r}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===m?"selected":""}" data-type="state" title="${i}"></converse-icon></div><div class="btn-group"><input .value="${p||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===m?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${p&&"state"!==m?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==m?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${s}</option><option ?selected="${"unread_messages"===f}" value="unread_messages">${o}</option><option ?selected="${"online"===f}" value="online">${h}</option><option ?selected="${"chat"===f}" value="chat">${d}</option><option ?selected="${"dnd"===f}" value="dnd">${u}</option><option ?selected="${"away"===f}" value="away">${l}</option><option ?selected="${"xa"===f}" value="xa">${c}</option><option ?selected="${"offline"===f}" value="offline">${a}</option></select></div></form>`},{CLOSED:pH}=Xx,mH=e=>{const t=aA("Contacts"),n=aA("Click to toggle contacts"),r=aA("Add a contact"),i=aA("Start a new chat"),s=aA("Show block list"),{state:o}=Ao,a=[...o.roster||[],...Wu.settings.get("show_self_in_roster")?[o.xmppstatus]:[]],c=a.reduce(((e,t)=>aI(e,t)),{}),l=Object.keys(c).filter((t=>oI(t,e.model))),u=e.model.get("toggle_state")===pH;l.sort(lI);const d=aA("Show filter"),h=aA("Hide filter"),f=e.model.get("filter_visible"),p=[];if(Wu.settings.get("allow_contact_requests")&&p.push(mf`<a href="#" class="dropdown-item add-contact" role="button" @click="${t=>e.showAddContactModal(t)}" title="${r}" data-toggle="modal" data-target="#add-contact-modal"><converse-icon class="fa fa-user-plus" size="1em"></converse-icon>${r}</a>`),Wu.settings.get("allow_non_roster_messaging")&&p.push(mf`<a href="#" class="dropdown-item new-chat" role="button" @click="${t=>e.showNewChatModal(t)}" title="${i}" data-toggle="modal" data-target="#new-chat-modal"><converse-icon class="fa fa-user-plus" size="1em"></converse-icon>${i}</a>`),p.push(mf`<a href="#" class="dropdown-item" role="button" @click="${t=>e.showBlocklistModal(t)}" title="${s}"><converse-icon class="fa fa-list-ul" size="1em"></converse-icon>${s}</a>`),a.length>5&&p.push(mf`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${f?h:d}</a>`),"debug"===Wu.settings.get("loglevel")){const t=aA("Re-sync contacts");p.push(mf`<a href="#" class="dropdown-item" role="button" @click="${t=>e.syncContacts(t)}" title="${t}"><converse-icon class="fa fa-sync sync-contacts" size="1em"></converse-icon>${t}</a>`)}return mf`<div class="d-flex controlbox-padded"><span class="w-100 controlbox-heading controlbox-heading--contacts"><a class="list-toggle open-contacts-toggle" title="${n}" role="heading" aria-level="3" @click="${e.toggleRoster}">${t} ${a.length?mf`<converse-icon class="fa ${u?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--chat-color)"></converse-icon>`:""}</a></span><converse-dropdown class="chatbox-btn btn-group dropstart dropdown--contacts" .items="${p}"></converse-dropdown></div><div class="list-container roster-contacts ${u?"hidden":""}">${f?mf`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${Wu.waitUntil("rosterInitialized")}" .items="${Ao.state.roster}" .template="${fH}" .model="${Ao.state.roster_filter}"></converse-list-filter>`:""} ${xN(l,(e=>e),(t=>{const n=c[t].filter((n=>sI(n,t,e.model)));return n.sort(cI),n.length?(e=>{const t=aA("Click to hide these contacts"),n=Ao.state.roster.state.get("collapsed_groups");return mf`<div class="roster-group" data-group="${e.name}"><a href="#" class="list-toggle group-toggle controlbox-padded" title="${t}" @click="${t=>nI(t,e.name)}"><converse-icon color="var(--chat-color)" size="1em" class="fa ${n.includes(e.name)?"fa-caret-right":"fa-caret-down"}"></converse-icon>${e.name}  ${e.contacts[0].get("requesting")?mf`<converse-icon color="var(--chat-color)" size="1.2em" class="fa fa-bell-alt"></converse-icon>`:""}</a><ul class="items-list roster-group-contacts ${n.includes(e.name)?"collapsed":""}" data-group="${e.name}">${xN(e.contacts,(e=>e.get("jid")),hH)}</ul></div>`})({contacts:n,name:t}):""}))}</div>`};function gH(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function vH(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){gH(s,r,i,o,a,"next",e)}function a(e){gH(s,r,i,o,a,"throw",e)}o(void 0)}))}}const{initStorage:yH}=Up,{CLOSED:bH,OPENED:_H}=Xx;class wH extends uA{initialize(){return vH((function*(){const e=`converse.contacts-panel${Ao.session.get("bare_jid")}`;this.model=new ae.Model({id:e}),yH(this.model,e),this.model.fetch(),yield Wu.waitUntil("rosterInitialized");const{chatboxes:t,presences:n,roster:r}=Ao.state;this.listenTo(Ao,"rosterContactsFetched",(()=>this.requestUpdate())),this.listenTo(n,"change:show",(()=>this.requestUpdate())),this.listenTo(t,"change:hidden",(()=>this.requestUpdate())),this.listenTo(r,"add",(()=>this.requestUpdate())),this.listenTo(r,"destroy",(()=>this.requestUpdate())),this.listenTo(r,"remove",(()=>this.requestUpdate())),this.listenTo(r,"change",(()=>this.requestUpdate())),this.listenTo(r,"presence:change",(()=>this.requestUpdate())),this.listenTo(r.state,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),Wu.trigger("rosterViewInitialized")})).call(this)}render(){return mH(this)}showAddContactModal(e){Wu.modal.show("converse-add-contact-modal",{model:new ae.Model},e)}showNewChatModal(e){Wu.modal.show("converse-new-chat-modal",{model:new ae.Model},e)}showBlocklistModal(e){Wu.modal.show("converse-blocklist-modal",{},e)}syncContacts(e){return vH((function*(){null==e||e.preventDefault();const{roster:t}=Ao.state;this.syncing_contacts=!0,this.requestUpdate(),t.data.save("version",null),yield t.fetchFromServer(),Wu.user.presence.send(),this.syncing_contacts=!1,this.requestUpdate()})).call(this)}toggleRoster(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=this.querySelector(".list-container.roster-contacts");this.model.get("toggle_state")===bH?uj(n).then((()=>this.model.save({toggle_state:_H}))):dj(n).then((()=>this.model.save({toggle_state:bH})))}toggleFilter(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.save({filter_visible:!this.model.get("filter_visible")})}}Wu.elements.define("converse-roster",wH);var SH=n(7702),xH={};xH.styleTagTransform=D(),xH.setAttributes=N(),xH.insert=k().bind(null,"head"),xH.domAPI=O(),xH.insertStyleElement=I();$()(SH.A,xH);SH.A&&SH.A.locals&&SH.A.locals;Hp.plugins.add("converse-rosterview",{dependencies:["converse-roster","converse-modal","converse-chatboxviews","converse-blocklist"],initialize(){Wu.settings.extend({allow_contact_removal:!0,hide_offline_users:!1,roster_groups:!0,xhr_user_search_url:null}),Wu.promises.add("rosterViewInitialized");const e={AcceptContactRequestModal:nH,AddContactModal:eH,BlockListModal:uH,NewChatModal:sH,RosterContactView:Jq,RosterFilter:c_,RosterView:wH};Object.assign(Ao,e),Object.assign(Ao.exports,e),Wu.listen.on("chatBoxesInitialized",(()=>{Ao.state.chatboxes.on("destroy",(e=>tI(e.get("jid")))),Ao.state.chatboxes.on("change:hidden",(e=>tI(e.get("jid"))))}))}});var AH=n(8562),jH={};jH.styleTagTransform=D(),jH.setAttributes=N(),jH.insert=k().bind(null,"head"),jH.domAPI=O(),jH.insertStyleElement=I();$()(AH.A,jH);AH.A&&AH.A.locals&&AH.A.locals;Hp.plugins.add("converse-singleton",{enabled:e=>e.api.settings.get("singleton"),initialize(){Wu.settings.extend({allow_logout:!1,allow_muc_invitations:!1,hide_muc_server:!0});const e=Wu.settings.get("auto_join_rooms"),t=Wu.settings.get("auto_join_private_chats");if(!Array.isArray(e)&&!Array.isArray(t))throw new Error("converse-singleton: auto_join_rooms must be an Array");if(0===e.length&&0===t.length)throw new Error("If you set singleton set to true, you need to specify auto_join_rooms or auto_join_private_chats");if(e.length>0&&t.length>0)throw new Error("It doesn't make sense to have singleton set to true and auto_join_rooms or auto_join_private_chats set to more then one, since only one chat room may be open at any time.")}});const{u:$H}=Hp.env;function EH(){document.addEventListener("mousemove",DH),document.addEventListener("mouseup",RH)}function OH(){document.removeEventListener("mousemove",DH),document.removeEventListener("mouseup",RH)}function CH(e){const t=Array.from(document.getElementsByTagName("iframe"));for(const n of t)e.addEventListener("mousedown",(()=>{n.style.pointerEvents="none"}),{once:!0}),e.addEventListener("mouseup",(()=>{n.style.pointerEvents="initial"}),{once:!0})}function kH(e){const t=e.get("height"),n=e.get("width");$H.safeSave(e,{height:PH(t,e.get("default_height")),width:PH(n,e.get("default_width"))})}const TH={};function NH(e,t=!0){if(!Wu.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=$H.ancestor(e.target,".box-flyout"),r=window.getComputedStyle(n),i=n.parentElement;i.height=parseInt(r.height.replace(/px$/,""),10),TH.chatbox=i,TH.direction="top",i.prev_pageY=e.pageY,t&&Wu.trigger("startVerticalResize",i)}function MH(e,t=!0){if(!Wu.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=$H.ancestor(e.target,".box-flyout"),r=window.getComputedStyle(n),i=n.parentElement;i.width=parseInt(r.width.replace(/px$/,""),10),TH.chatbox=i,TH.direction="left",i.prev_pageX=e.pageX,t&&Wu.trigger("startHorizontalResize",i)}function IH(e){MH(e,!1),NH(e,!1),TH.direction="topleft",Wu.trigger("startDiagonalResize",this)}function PH(e,t){if(void 0===e)return;if(void 0===t)return e;return e!==t&&Math.abs(e-t)<10?t:e}function DH(e){if(!TH.chatbox||!Wu.settings.get("allow_dragresize"))return!0;e.preventDefault(),TH.chatbox.resizeChatBox(e)}function RH(e){if(!TH.chatbox||!Wu.settings.get("allow_dragresize"))return!0;e.preventDefault();const t=PH(TH.chatbox.height,TH.chatbox.model.get("default_height")),n=PH(TH.chatbox.width,TH.chatbox.model.get("default_width"));Wu.connection.connected()?(TH.chatbox.model.save({height:t}),TH.chatbox.model.save({width:n})):(TH.chatbox.model.set({height:t}),TH.chatbox.model.set({width:n})),delete TH.chatbox,delete TH.direction}function zH(e,t){return!e.get("height")&&!e.get("width")&&t}const LH=()=>mf`<div class="dragresize dragresize-top" @mousedown="${NH}"></div><div class="dragresize dragresize-topleft" @mousedown="${IH}"></div><div class="dragresize dragresize-left" @mousedown="${MH}"></div>`;Wu.elements.define("converse-dragresize",class extends uA{render(){return LH()}});const UH={initDragResize(){var e;const t=Lo((()=>this.setDimensions()));window.addEventListener("resize",t),this.listenTo(this.model,"destroy",(()=>window.removeEventListener("resize",t)));const n=this.querySelector(".box-flyout"),r=window.getComputedStyle(n);if(void 0===this.model.get("height")){const e=parseInt(r.height.replace(/px$/,""),10),t=parseInt(r.width.replace(/px$/,""),10);this.model.set("height",e),this.model.set("default_height",e),this.model.set("width",t),this.model.set("default_width",t)}const i=r["min-width"],s=r["min-height"];return this.model.set("min_width",i.endsWith("px")?Number(i.replace(/px$/,"")):0),this.model.set("min_height",s.endsWith("px")?Number(s.replace(/px$/,"")):0),this.prev_pageY=0,this.prev_pageX=0,(null===(e=Wu.connection.get())||void 0===e?void 0:e.connected)&&(this.height=this.model.get("height"),this.width=this.model.get("width")),this},resizeChatBox(e){let t;const n=TH.direction;if(0===n.indexOf("top")){var r;const n=null!==(r=Wu.settings.get("dragresize_top_margin"))&&void 0!==r?r:0,i=window.innerHeight-n;if(t=e.pageY-this.prev_pageY,t){const n=this.height-t;Q.debug("------------"),Q.debug(`window.innerHeight: ${window.innerHeight}`),Q.debug(`max_height: ${i}`),Q.debug(`new_height: ${n}`),Q.debug(`diff: ${t}`),this.height=this.height-t>(this.model.get("min_height")||0)?n<=i?n:i:this.model.get("min_height"),this.prev_pageY=e.pageY,this.setChatBoxHeight(this.height)}}n.includes("left")&&(t=this.prev_pageX-e.pageX,t&&(this.width=this.width+t>(this.model.get("min_width")||0)?this.width+t:this.model.get("min_width"),this.prev_pageX=e.pageX,this.setChatBoxWidth(this.width)))},setDimensions(){this.adjustToViewport(),this.setChatBoxWidth(this.model.get("width")),"overlayed"===Wu.settings.get("view_mode")&&this.setChatBoxHeight(this.model.get("height"))},setChatBoxHeight(e){const t=this.querySelector(".box-flyout");null!==t&&(t.style.height=e?PH(e,this.model.get("default_height"))+"px":"")},setChatBoxWidth(e){const t=e?PH(e,this.model.get("default_width"))+"px":"";this.style.width=t;const n=this.querySelector(".box-flyout");null!==n&&(n.style.width=t)},adjustToViewport(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e<=480?(this.model.set("height",void 0),this.model.set("width",void 0)):e<=this.model.get("width")?this.model.set("width",void 0):t<=this.model.get("height")&&this.model.set("height",void 0)}};Hp.plugins.add("converse-dragresize",{dependencies:["converse-chatview","converse-headlines-view","converse-muc-views"],enabled:()=>"overlayed"==Wu.settings.get("view_mode"),initialize(){var e,t,n,r,i,s,o,a;Wu.settings.extend({allow_dragresize:!0,dragresize_top_margin:0}),Object.assign(null!==(i=null===(e=Ao.exports.ChatView)||void 0===e?void 0:e.prototype)&&void 0!==i?i:{},UH),Object.assign(null!==(s=null===(t=Ao.exports.MUCView)||void 0===t?void 0:t.prototype)&&void 0!==s?s:{},UH),Object.assign(null!==(o=null===(n=Ao.exports.HeadlinesFeedView)||void 0===n?void 0:n.prototype)&&void 0!==o?o:{},UH),Object.assign(null!==(a=null===(r=Ao.exports.ControlBoxView)||void 0===r?void 0:r.prototype)&&void 0!==a?a:{},UH),Wu.listen.on("headlinesFeedInitialized",kH),Wu.listen.on("chatBoxInitialized",kH),Wu.listen.on("chatRoomInitialized",kH),Wu.listen.on("registeredGlobalEventHandlers",EH),Wu.listen.on("unregisteredGlobalEventHandlers",OH),Wu.listen.on("beforeShowingChatView",(e=>e.initDragResize().setDimensions())),Wu.listen.on("startDiagonalResize",CH),Wu.listen.on("startHorizontalResize",CH),Wu.listen.on("startVerticalResize",CH),Wu.listen.on("shouldDestroyOnClose",zH)}});var BH=n(5431),FH={};FH.styleTagTransform=D(),FH.setAttributes=N(),FH.insert=k().bind(null,"head"),FH.domAPI=O(),FH.insertStyleElement=I();$()(BH.A,FH);BH.A&&BH.A.locals&&BH.A.locals;const{isUniView:qH}=Up;Hp.plugins.add("converse-fullscreen",{enabled:()=>qH(),initialize(){Wu.settings.extend({chatview_avatar_height:50,chatview_avatar_width:50,hide_open_bookmarks:!0,show_controlbox_by_default:!0,sticky_controlbox:!0})}}),Ao.exports.CustomElement=uA;const HH=Hp.initialize;Hp.initialize=function(e,t){return Array.isArray(e.whitelisted_plugins)?e.whitelisted_plugins=e.whitelisted_plugins.concat(YO):e.whitelisted_plugins=YO,HH(e,t)};const GH=Hp},304:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},364:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},593:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},646:(e,t,n)=>{var r=n(134);e.exports=function(e,t,n,i,s){var o=r(e,t,n,i,s);return o.next().then((function(e){return e.done?e.value:o.next()}))},e.exports.__esModule=!0,e.exports.default=e.exports},719:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},845:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},998:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1070:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1089:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1205:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1263:function(e,t,n){function r(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,s){var o=e.apply(t,n);function a(e){r(o,i,s,a,c,"next",e)}function c(e){r(o,i,s,a,c,"throw",e)}a(void 0)}))}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}function a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}e=n.nmd(e),function(t){"use strict";var r,s="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,c="object"==typeof self&&self&&self.Object===Object&&self,l=s||c||Function("return this")(),u=l.Symbol;function d(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var h=Array.isArray,f=Object.prototype,p=f.hasOwnProperty,m=f.toString,g=u?u.toStringTag:void 0;function v(e){var t=p.call(e,g),n=e[g];try{e[g]=void 0;var r=!0}catch(e){}var i=m.call(e);return r&&(t?e[g]=n:delete e[g]),i}var y=Object.prototype.toString;function b(e){return y.call(e)}var _="[object Null]",w="[object Undefined]",S=u?u.toStringTag:void 0;function x(e){return null==e?void 0===e?w:_:S&&S in Object(e)?v(e):b(e)}function A(e){return null!=e&&"object"==typeof e}var j="[object Symbol]";function $(e){return"symbol"==typeof e||A(e)&&x(e)==j}var E=u?u.prototype:void 0,O=E?E.toString:void 0;function C(e){if("string"==typeof e)return e;if(h(e))return d(e,C)+"";if($(e))return O?O.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function k(e){return null==e?"":C(e)}var T=0;function N(e){var t=++T;return k(e)+t}const M=globalThis,I=M.trustedTypes,P=I?I.createPolicy("lit-html",{createHTML:e=>e}):void 0,D="$lit$",R=`lit$${Math.random().toFixed(9).slice(2)}$`,z="?"+R,L=`<${z}>`,U=document,B=()=>U.createComment(""),F=e=>null===e||"object"!=typeof e&&"function"!=typeof e,q=Array.isArray,H=e=>q(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),G="[ \t\n\f\r]",W=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,V=/-->/g,K=/>/g,J=RegExp(`>|${G}(?:([^\\s"'>=/]+)(${G}*=${G}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Y=/'/g,X=/"/g,Q=/^(?:script|style|textarea|title)$/i,Z=Symbol.for("lit-noChange"),ee=Symbol.for("lit-nothing"),te=new WeakMap,ne=U.createTreeWalker(U,129);function re(e,t){if(!q(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==P?P.createHTML(t):t}const ie=(e,t)=>{const n=e.length-1,r=[];let i,s=2===t?"<svg>":3===t?"<math>":"",o=W;for(let t=0;t<n;t++){const n=e[t];let c,l,u=-1,d=0;for(;d<n.length&&(o.lastIndex=d,l=o.exec(n),null!==l);){var a;d=o.lastIndex,o===W?"!--"===l[1]?o=V:void 0!==l[1]?o=K:void 0!==l[2]?(Q.test(l[2])&&(i=RegExp("</"+l[2],"g")),o=J):void 0!==l[3]&&(o=J):o===J?">"===l[0]?(o=null!==(a=i)&&void 0!==a?a:W,u=-1):void 0===l[1]?u=-2:(u=o.lastIndex-l[2].length,c=l[1],o=void 0===l[3]?J:'"'===l[3]?X:Y):o===X||o===Y?o=J:o===V||o===K?o=W:(o=J,i=void 0)}const h=o===J&&e[t+1].startsWith("/>")?" ":"";s+=o===W?n+L:u>=0?(r.push(c),n.slice(0,u)+D+n.slice(u)+R+h):n+R+(-2===u?t:h)}return[re(e,s+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),r]};class se{static createElement(e,t){const n=U.createElement("template");return n.innerHTML=e,n}constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let i=0,s=0;const o=e.length-1,a=this.parts,[c,l]=ie(e,t);if(this.el=se.createElement(c,n),ne.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(r=ne.nextNode())&&a.length<o;){if(1===r.nodeType){if(r.hasAttributes())for(const e of r.getAttributeNames())if(e.endsWith(D)){const t=l[s++],n=r.getAttribute(e).split(R),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:n,ctor:"."===o[1]?ue:"?"===o[1]?de:"@"===o[1]?he:le}),r.removeAttribute(e)}else e.startsWith(R)&&(a.push({type:6,index:i}),r.removeAttribute(e));if(Q.test(r.tagName)){const e=r.textContent.split(R),t=e.length-1;if(t>0){r.textContent=I?I.emptyScript:"";for(let n=0;n<t;n++)r.append(e[n],B()),ne.nextNode(),a.push({type:2,index:++i});r.append(e[t],B())}}}else if(8===r.nodeType)if(r.data===z)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=r.data.indexOf(R,e+1));)a.push({type:7,index:i}),e+=R.length-1}i++}}}function oe(e,t,n=e,r){var i,s,o,a,c;if(t===Z)return t;let l=void 0!==r?null===(s=n._$Co)||void 0===s?void 0:s[r]:n._$Cl;const u=F(t)?void 0:t._$litDirective$;var d;return(null===(o=l)||void 0===o?void 0:o.constructor)!==u&&(null!==(a=l)&&void 0!==a&&null!==(c=a._$AO)&&void 0!==c&&c.call(a,!1),void 0===u?l=void 0:(l=new u(e),l._$AT(e,n,r)),void 0!==r?(null!==(d=(i=n)._$Co)&&void 0!==d?d:i._$Co=[])[r]=l:n._$Cl=l),void 0!==l&&(t=oe(e,l._$AS(e,t.values),l,r)),t}class ae{get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:n},parts:r}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:U).importNode(n,!0);ne.currentNode=i;let s=ne.nextNode(),o=0,a=0,c=r[0];for(;void 0!==c;){var l;if(o===c.index){let t;2===c.type?t=new ce(s,s.nextSibling,this,e):1===c.type?t=new c.ctor(s,c.name,c.strings,this,e):6===c.type&&(t=new fe(s,this,e)),this._$AV.push(t),c=r[++a]}o!==(null===(l=c)||void 0===l?void 0:l.index)&&(s=ne.nextNode(),o++)}return ne.currentNode=U,i}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}}class ce{get _$AU(){var e,t;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cv}get parentNode(){var e;let t=this._$AA.parentNode;const n=this._$AM;return void 0!==n&&11===(null===(e=t)||void 0===e?void 0:e.nodeType)&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=oe(this,e,t),F(e)?e===ee||null==e||""===e?(this._$AH!==ee&&this._$AR(),this._$AH=ee):e!==this._$AH&&e!==Z&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):H(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==ee&&F(this._$AH)?this._$AA.nextSibling.data=e:this.T(U.createTextNode(e)),this._$AH=e}$(e){var t;const{values:n,_$litType$:r}=e,i="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=se.createElement(re(r.h,r.h[0]),this.options)),r);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.p(n);else{const e=new ae(i,this),t=e.u(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let t=te.get(e.strings);return void 0===t&&te.set(e.strings,t=new se(e)),t}k(e){q(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,r=0;for(const i of e)r===t.length?t.push(n=new ce(this.O(B()),this.O(B()),this,this.options)):n=t[r],n._$AI(i),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$AB;){var n;const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cv=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}constructor(e,t,n,r){var i;this.type=2,this._$AH=ee,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cv=null===(i=null==r?void 0:r.isConnected)||void 0===i||i}}class le{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,n,r){const i=this.strings;let s=!1;if(void 0===i)e=oe(this,e,t,0),s=!F(e)||e!==this._$AH&&e!==Z,s&&(this._$AH=e);else{const r=e;let a,c;for(e=i[0],a=0;a<i.length-1;a++){var o;c=oe(this,r[n+a],t,a),c===Z&&(c=this._$AH[a]),s||(s=!F(c)||c!==this._$AH[a]),c===ee?e=ee:e!==ee&&(e+=(null!==(o=c)&&void 0!==o?o:"")+i[a+1]),this._$AH[a]=c}}s&&!r&&this.j(e)}j(e){e===ee?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}constructor(e,t,n,r,i){this.type=1,this._$AH=ee,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=ee}}class ue extends le{j(e){this.element[this.name]=e===ee?void 0:e}constructor(){super(...arguments),this.type=3}}class de extends le{j(e){this.element.toggleAttribute(this.name,!!e&&e!==ee)}constructor(){super(...arguments),this.type=4}}class he extends le{_$AI(e,t=this){var n;if((e=null!==(n=oe(this,e,t,0))&&void 0!==n?n:ee)===Z)return;const r=this._$AH,i=e===ee&&r!==ee||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==ee&&(r===ee||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;"function"==typeof this._$AH?this._$AH.call(null!==(t=null===(n=this.options)||void 0===n?void 0:n.host)&&void 0!==t?t:this.element,e):this._$AH.handleEvent(e)}constructor(e,t,n,r,i){super(e,t,n,r,i),this.type=5}}class fe{get _$AU(){return this._$AM._$AU}_$AI(e){oe(this,e)}constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}}const pe=M.litHtmlPolyfillSupport;var me;null!=pe&&pe(se,ce),(null!==(me=(r=M).litHtmlVersions)&&void 0!==me?me:r.litHtmlVersions=[]).push("3.2.1");const ge=(e,t,n)=>{var r;const i=null!==(r=void 0)&&void 0!==r?r:t;let s=i._$litPart$;if(void 0===s){var o;const e=null!==(o=void 0)&&void 0!==o?o:null;i._$litPart$=s=new ce(t.insertBefore(B(),e),e,void 0,{})}return s._$AI(e),s};var ve=Object.prototype;function ye(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ve)}function be(e,t){return function(n){return e(t(n))}}var _e=be(Object.keys,Object),we=Object.prototype.hasOwnProperty;function Se(e){if(!ye(e))return _e(e);var t=[];for(var n in Object(e))we.call(e,n)&&"constructor"!=n&&t.push(n);return t}function xe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Ae="[object AsyncFunction]",je="[object Function]",$e="[object GeneratorFunction]",Ee="[object Proxy]";function Oe(e){if(!xe(e))return!1;var t=x(e);return t==je||t==$e||t==Ae||t==Ee}var Ce,ke=l["__core-js_shared__"],Te=(Ce=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||""))?"Symbol(src)_1."+Ce:"";function Ne(e){return!!Te&&Te in e}var Me=Function.prototype.toString;function Ie(e){if(null!=e){try{return Me.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var Pe=/[\\^$.*+?()[\]{}|]/g,De=/^\[object .+?Constructor\]$/,Re=Function.prototype,ze=Object.prototype,Le=Re.toString,Ue=ze.hasOwnProperty,Be=RegExp("^"+Le.call(Ue).replace(Pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Fe(e){return!(!xe(e)||Ne(e))&&(Oe(e)?Be:De).test(Ie(e))}function qe(e,t){return null==e?void 0:e[t]}function He(e,t){var n=qe(e,t);return Fe(n)?n:void 0}var Ge=He(l,"DataView"),We=He(l,"Map"),Ve=He(l,"Promise"),Ke=He(l,"Set"),Je=He(l,"WeakMap"),Ye="[object Map]",Xe="[object Object]",Qe="[object Promise]",Ze="[object Set]",et="[object WeakMap]",tt="[object DataView]",nt=Ie(Ge),rt=Ie(We),it=Ie(Ve),st=Ie(Ke),ot=Ie(Je),at=x;(Ge&&at(new Ge(new ArrayBuffer(1)))!=tt||We&&at(new We)!=Ye||Ve&&at(Ve.resolve())!=Qe||Ke&&at(new Ke)!=Ze||Je&&at(new Je)!=et)&&(at=function(e){var t=x(e),n=t==Xe?e.constructor:void 0,r=n?Ie(n):"";if(r)switch(r){case nt:return tt;case rt:return Ye;case it:return Qe;case st:return Ze;case ot:return et}return t});var ct="[object Arguments]";function lt(e){return A(e)&&x(e)==ct}var ut=Object.prototype,dt=ut.hasOwnProperty,ht=ut.propertyIsEnumerable,ft=lt(function(){return arguments}())?lt:function(e){return A(e)&&dt.call(e,"callee")&&!ht.call(e,"callee")},pt=9007199254740991;function mt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=pt}function gt(e){return null!=e&&mt(e.length)&&!Oe(e)}function vt(){return!1}var yt="object"==typeof t&&t&&!t.nodeType&&t,bt=yt&&e&&!e.nodeType&&e,_t=bt&&bt.exports===yt?l.Buffer:void 0,wt=(_t?_t.isBuffer:void 0)||vt,St="[object Arguments]",xt="[object Array]",At="[object Boolean]",jt="[object Date]",$t="[object Error]",Et="[object Function]",Ot="[object Map]",Ct="[object Number]",kt="[object Object]",Tt="[object RegExp]",Nt="[object Set]",Mt="[object String]",It="[object WeakMap]",Pt="[object ArrayBuffer]",Dt="[object DataView]",Rt="[object Float64Array]",zt="[object Int8Array]",Lt="[object Int16Array]",Ut="[object Int32Array]",Bt="[object Uint8Array]",Ft="[object Uint8ClampedArray]",qt="[object Uint16Array]",Ht="[object Uint32Array]",Gt={};function Wt(e){return A(e)&&mt(e.length)&&!!Gt[x(e)]}function Vt(e){return function(t){return e(t)}}Gt["[object Float32Array]"]=Gt[Rt]=Gt[zt]=Gt[Lt]=Gt[Ut]=Gt[Bt]=Gt[Ft]=Gt[qt]=Gt[Ht]=!0,Gt[St]=Gt[xt]=Gt[Pt]=Gt[At]=Gt[Dt]=Gt[jt]=Gt[$t]=Gt[Et]=Gt[Ot]=Gt[Ct]=Gt[kt]=Gt[Tt]=Gt[Nt]=Gt[Mt]=Gt[It]=!1;var Kt="object"==typeof t&&t&&!t.nodeType&&t,Jt=Kt&&e&&!e.nodeType&&e,Yt=Jt&&Jt.exports===Kt&&s.process,Xt=function(){try{var e=Jt&&Jt.require&&Jt.require("util").types;return e||Yt&&Yt.binding&&Yt.binding("util")}catch(e){}}(),Qt=Xt&&Xt.isTypedArray,Zt=Qt?Vt(Qt):Wt,en="[object Map]",tn="[object Set]",nn=Object.prototype.hasOwnProperty;function rn(e){if(null==e)return!0;if(gt(e)&&(h(e)||"string"==typeof e||"function"==typeof e.splice||wt(e)||Zt(e)||ft(e)))return!e.length;var t=at(e);if(t==en||t==tn)return!e.size;if(ye(e))return!Se(e).length;for(var n in e)if(nn.call(e,n))return!1;return!0}function sn(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var on=9007199254740991,an=/^(?:0|[1-9]\d*)$/;function cn(e,t){var n=typeof e;return!!(t=null==t?on:t)&&("number"==n||"symbol"!=n&&an.test(e))&&e>-1&&e%1==0&&e<t}var ln=Object.prototype.hasOwnProperty;function un(e,t){var n=h(e),r=!n&&ft(e),i=!n&&!r&&wt(e),s=!n&&!r&&!i&&Zt(e),o=n||r||i||s,a=o?sn(e.length,String):[],c=a.length;for(var l in e)!t&&!ln.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||cn(l,c))||a.push(l);return a}function dn(e){return gt(e)?un(e):Se(e)}var hn=/\s/;function fn(e){for(var t=e.length;t--&&hn.test(e.charAt(t)););return t}var pn=/^\s+/;function mn(e){return e?e.slice(0,fn(e)+1).replace(pn,""):e}var gn=NaN,vn=/^[-+]0x[0-9a-f]+$/i,yn=/^0b[01]+$/i,bn=/^0o[0-7]+$/i,_n=parseInt;function wn(e){if("number"==typeof e)return e;if($(e))return gn;if(xe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=xe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=mn(e);var n=yn.test(e);return n||bn.test(e)?_n(e.slice(2),n?2:8):vn.test(e)?gn:+e}var Sn=1/0,xn=17976931348623157e292;function An(e){return e?(e=wn(e))===Sn||e===-1/0?(e<0?-1:1)*xn:e==e?e:0:0===e?e:0}function jn(e){var t=An(e),n=t%1;return t==t?n?t-n:t:0}var $n="Expected a function";function En(e,t){var n;if("function"!=typeof t)throw new TypeError($n);return e=jn(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}function On(e){return En(2,e)}const Cn=/\s+/;function kn(e,t,n,r,i){let s,o=0;if(n&&"object"==typeof n){void 0!==r&&"context"in i&&void 0===i.context&&(i.context=r);for(s=dn(n);o<s.length;o++)t=kn(e,t,s[o],n[s[o]],i)}else if(n&&Cn.test(n))for(s=n.split(Cn);o<s.length;o++)t=e(t,s[o],r,i);else t=e(t,n,r,i);return t}function Tn(e,t,n,r){if(n){const i=e[t]||(e[t]=[]),s=r.context,o=r.ctx,a=r.listening;a&&a.count++,i.push({callback:n,context:s,ctx:s||o,listening:a})}return e}function Nn(e,t,n,r){try{e.on(t,n,r)}catch(e){return e}}function Mn(e,t,n,r){if(!e)return;const i=r.context,s=r.listeners;let o,a=0;if(t||i||n){for(o=t?[t]:dn(e);a<o.length;a++){const r=e[t=o[a]];if(!r)break;const s=[];for(let e=0;e<r.length;e++){const o=r[e];if(n&&n!==o.callback&&n!==o.callback._callback||i&&i!==o.context)s.push(o);else{const e=o.listening;e&&e.stop(t,n)}}s.length?e[t]=s:delete e[t]}return e}for(o=dn(s);a<o.length;a++)s[o[a]].cleanup()}function In(e,t,n,r){if(n){const i=e[t]=On((function(){r(t,i),n.apply(this,arguments)}));i._callback=n}return e}function Pn(e,t,n,r){if(e){const n=e[t];let i=e.all;n&&i&&(i=i.slice()),n&&Dn(n,r),i&&Dn(i,[t].concat(r))}return e}function Dn(e,t){let n,r=-1;const i=e.length,s=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s,o,a);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t);return}}class Rn{start(e,t,n,r){return this._events=kn(Tn,this._events||{},e,t,{context:this.obj,ctx:n,listening:r}),r&&((this.obj._listeners||(this.obj._listeners={}))[this.id]=this,this.interop=!1),this}stop(e,t){let n;this.interop?(this._events=kn(Mn,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()}cleanup(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]}constructor(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0}}let zn;function Ln(e){return class extends e{on(e,t,n){return this._events=kn(Tn,this._events||{},e,t,{context:n,ctx:this,listening:zn}),zn&&((this._listeners||(this._listeners={}))[zn.id]=zn,zn.interop=!1),this}listenTo(e,t,n){if(!e)return this;const r=e._listenId||(e._listenId=N("l")),i=this._listeningTo||(this._listeningTo={});let s=zn=i[r];s||(this._listenId||(this._listenId=N("l")),s=zn=i[r]=new Rn(this,e));const o=Nn(e,t,n,this);if(zn=void 0,o)throw o;return s.interop&&s.start(t,n,this,zn),this}off(e,t,n){return this._events?(this._events=kn(Mn,this._events,e,t,{context:n,listeners:this._listeners}),this):this}stopListening(e,t,n){const r=this._listeningTo;if(!r)return this;const i=e?[e._listenId]:dn(r);for(let e=0;e<i.length;e++){const s=r[i[e]];if(!s)break;s.obj.off(t,n,this),s.interop&&s.stop(t,n)}return rn(r)&&(this._listeningTo=void 0),this}once(e,t,n){const r=kn(In,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(r,t,n)}listenToOnce(e,t,n){const r=kn(In,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,r)}trigger(e,...t){return this._events?(kn(Pn,this._events,e,void 0,t),this):this}}}const Un=/^(\S+)\s*(.*)$/;class Bn extends(Ln(HTMLElement)){set events(e){this._declarativeEvents=e}get events(){return this._declarativeEvents}createRenderRoot(){return this}connectedCallback(){this._initialized||(this.preinitialize.apply(this,arguments),this.initialize.apply(this,arguments),this._initialized=!0),this.delegateEvents()}disconnectedCallback(){var e;this.undelegateEvents(),null===(e=this.stopListening)||void 0===e||e.call(this)}preinitialize(){}initialize(){}beforeRender(){}afterRender(){}render(){return this.beforeRender(),ge(this.toHTML(),this),this.afterRender(),this}toHTML(){return""}delegateEvents(){if(!this.events)return this;this.undelegateEvents();for(const e in this.events){let t=this.events[e];if("function"!=typeof t&&(t=this[t]),!t)continue;const n=e.match(Un);this.delegate(n[1],n[2],t.bind(this))}return this}delegate(e,t,n){const r=this;if(!r)return this;if("function"==typeof t&&(n=t,t=null),-1!==["focus","blur"].indexOf(e)){const r=this.querySelectorAll(t);for(let t=0,i=r.length;t<i;t++){const i=r[t];i.addEventListener(e,n,!1),this._domEvents.push({el:i,eventName:e,handler:n})}return n}const i=t?function(e){let i=e.target||e.srcElement;for(;i&&i!=r;i=i.parentNode)i.matches(t)&&(e.delegateTarget=i,n(e))}:n;return this.addEventListener(e,i,!1),this._domEvents.push({el:this,eventName:e,handler:i,listener:n,selector:t}),this}undelegateEvents(){if(this){for(let e=0,t=this._domEvents.length;e<t;e++){const t=this._domEvents[e];t.el.removeEventListener(t.eventName,t.handler,!1)}this._domEvents.length=0}return this}undelegate(e,t,n){if("function"==typeof t&&(n=t,t=null),this){const r=this._domEvents.slice();let i=r.length;for(;i--;){const s=r[i];!(s.eventName!==e||n&&s.listener!==n||t&&s.selector!==t)&&(s.el.removeEventListener(s.eventName,s.handler,!1),this._domEvents.splice(i,1))}}return this}constructor(e={}){super(),this.stopListening=null,this.cid=N("view"),this._declarativeEvents={},this._domEvents=[];const{model:t,collection:n,events:r}=e;Object.assign(this,{model:t,collection:n,events:r})}}function Fn(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function qn(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}var Hn=/^~~local_forage_type~([^~]+)~/,Gn=9,Wn=Gn+4,Vn=Object.prototype.toString;function Kn(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var r=new ArrayBuffer(t),i=new Uint8Array(r),s=0,o=0;s<n;s+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+2]),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|l>>2,i[o++]=(3&l)<<6|63&u}return r}function Jn(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[r]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[r])<<4|t[r+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[r+1])<<2|t[r+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function Yn(e,t){var n="";if(e&&(n=Vn.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===Vn.call(e.buffer))){var r=void 0,i="__lfsc__:";e instanceof ArrayBuffer?(r=e,i+="arbf"):(r=e.buffer,"[object Int8Array]"===n?i+="si08":"[object Uint8Array]"===n?i+="ui08":"[object Uint8ClampedArray]"===n?i+="uic8":"[object Int16Array]"===n?i+="si16":"[object Uint16Array]"===n?i+="ur16":"[object Int32Array]"===n?i+="si32":"[object Uint32Array]"===n?i+="ui32":"[object Float32Array]"===n?i+="fl32":"[object Float64Array]"===n?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+Jn(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+Jn(this.result);t("__lfsc__:blob"+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function Xn(e){if("__lfsc__:"!==e.substring(0,Gn))return JSON.parse(e);var t,n=e.substring(Wn),r=e.substring(Gn,Wn);if("blob"===r&&Hn.test(n)){var i=n.match(Hn);t=i[1],n=n.substring(i[0].length)}var s=Kn(n);switch(r){case"arbf":return s;case"blob":return qn([s],{type:t});case"si08":return new Int8Array(s);case"ui08":return new Uint8Array(s);case"uic8":return new Uint8ClampedArray(s);case"si16":return new Int16Array(s);case"ur16":return new Uint16Array(s);case"si32":return new Int32Array(s);case"ui32":return new Uint32Array(s);case"fl32":return new Float32Array(s);case"fl64":return new Float64Array(s);default:throw new Error("Unkown type: "+r)}}function Qn(e){var t,n;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var r=e instanceof Date?new Date(e):e.constructor();try{for(var i=Fn(Object.keys(e)),s=i.next();!s.done;s=i.next()){var o=s.value;Object.prototype.hasOwnProperty.call(e,o)&&(e.isActiveClone=null,r[o]=Qn(e[o]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Zn(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function er(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function tr(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function nr(e,t){var n=this;if(t=tr.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(Zn(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function rr(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var ir={bufferToString:Jn,deserialize:Xn,serialize:Yn,stringToBuffer:Kn},sr="localforage-driver-memory",or={},ar=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return or[t]||(or[t]=new e(t)),or[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete or[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function cr(e){var t=e?Qn(e):{},n=Zn(t,this._defaultConfig),r=ar.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=ir,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=r,Promise.resolve()}function lr(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return er(n,e),n}function ur(e,t){var n=nr.apply(this,arguments),r=n.promise,i=n.callback;return er(r.then((function(e){ar.resolve(e).drop()})),i),r}function dr(e,t){var n=this;e=rr(e);var r=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return er(r,t),r}function hr(e,t){var n=this,r=this.ready().then((function(){for(var t=n._dbInfo.mStore,r=t.keys(),i=0;i<r.length;i++){var s=t.get(r[i]);if(s&&(s=n._dbInfo.serializer.deserialize(s)),void 0!==(s=e(s,r[i],i+1)))return s}}));return er(r,t),r}function fr(e,t){var n=this,r=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return er(r,t),r}function pr(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return er(n,e),n}function mr(e){var t=this.keys().then((function(e){return e.length}));return er(t,e),t}function gr(e,t){var n=this;e=rr(e);var r=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return er(r,t),r}function vr(e,t,n){var r=this;e=rr(e);var i=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(i,s){r._dbInfo.serializer.serialize(t,(function(t,o){if(o)s(o);else try{r._dbInfo.mStore.set(e,t),i(n)}catch(e){s(e)}}))}))}));return er(i,n),i}var yr=!0,br=Object.freeze({__proto__:null,_driver:sr,_initStorage:cr,_support:yr,clear:lr,dropInstance:ur,getItem:dr,iterate:hr,key:fr,keys:pr,length:mr,removeItem:gr,setItem:vr});function _r(){this.__data__=[],this.size=0}function wr(e,t){return e===t||e!=e&&t!=t}function Sr(e,t){for(var n=e.length;n--;)if(wr(e[n][0],t))return n;return-1}var xr=Array.prototype.splice;function Ar(e){var t=this.__data__,n=Sr(t,e);return!(n<0||(n==t.length-1?t.pop():xr.call(t,n,1),--this.size,0))}function jr(e){var t=this.__data__,n=Sr(t,e);return n<0?void 0:t[n][1]}function $r(e){return Sr(this.__data__,e)>-1}function Er(e,t){var n=this.__data__,r=Sr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function Or(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Cr(){this.__data__=new Or,this.size=0}function kr(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Tr(e){return this.__data__.get(e)}function Nr(e){return this.__data__.has(e)}Or.prototype.clear=_r,Or.prototype.delete=Ar,Or.prototype.get=jr,Or.prototype.has=$r,Or.prototype.set=Er;var Mr=He(Object,"create");function Ir(){this.__data__=Mr?Mr(null):{},this.size=0}function Pr(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Dr="__lodash_hash_undefined__",Rr=Object.prototype.hasOwnProperty;function zr(e){var t=this.__data__;if(Mr){var n=t[e];return n===Dr?void 0:n}return Rr.call(t,e)?t[e]:void 0}var Lr=Object.prototype.hasOwnProperty;function Ur(e){var t=this.__data__;return Mr?void 0!==t[e]:Lr.call(t,e)}var Br="__lodash_hash_undefined__";function Fr(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Mr&&void 0===t?Br:t,this}function qr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Hr(){this.size=0,this.__data__={hash:new qr,map:new(We||Or),string:new qr}}function Gr(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function Wr(e,t){var n=e.__data__;return Gr(t)?n["string"==typeof t?"string":"hash"]:n.map}function Vr(e){var t=Wr(this,e).delete(e);return this.size-=t?1:0,t}function Kr(e){return Wr(this,e).get(e)}function Jr(e){return Wr(this,e).has(e)}function Yr(e,t){var n=Wr(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Xr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}qr.prototype.clear=Ir,qr.prototype.delete=Pr,qr.prototype.get=zr,qr.prototype.has=Ur,qr.prototype.set=Fr,Xr.prototype.clear=Hr,Xr.prototype.delete=Vr,Xr.prototype.get=Kr,Xr.prototype.has=Jr,Xr.prototype.set=Yr;var Qr=200;function Zr(e,t){var n=this.__data__;if(n instanceof Or){var r=n.__data__;if(!We||r.length<Qr-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Xr(r)}return n.set(e,t),this.size=n.size,this}function ei(e){var t=this.__data__=new Or(e);this.size=t.size}function ti(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}ei.prototype.clear=Cr,ei.prototype.delete=kr,ei.prototype.get=Tr,ei.prototype.has=Nr,ei.prototype.set=Zr;var ni=function(){try{var e=He(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();function ri(e,t,n){"__proto__"==t&&ni?ni(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var ii=Object.prototype.hasOwnProperty;function si(e,t,n){var r=e[t];ii.call(e,t)&&wr(r,n)&&(void 0!==n||t in e)||ri(e,t,n)}function oi(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;void 0===c&&(c=e[a]),i?ri(n,a,c):si(n,a,c)}return n}function ai(e,t){return e&&oi(t,dn(t),e)}function ci(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var li=Object.prototype.hasOwnProperty;function ui(e){if(!xe(e))return ci(e);var t=ye(e),n=[];for(var r in e)("constructor"!=r||!t&&li.call(e,r))&&n.push(r);return n}function di(e){return gt(e)?un(e,!0):ui(e)}function hi(e,t){return e&&oi(t,di(t),e)}var fi="object"==typeof t&&t&&!t.nodeType&&t,pi=fi&&e&&!e.nodeType&&e,mi=pi&&pi.exports===fi?l.Buffer:void 0,gi=mi?mi.allocUnsafe:void 0;function vi(e,t){if(t)return e.slice();var n=e.length,r=gi?gi(n):new e.constructor(n);return e.copy(r),r}function yi(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function bi(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function _i(){return[]}var wi=Object.prototype.propertyIsEnumerable,Si=Object.getOwnPropertySymbols,xi=Si?function(e){return null==e?[]:(e=Object(e),bi(Si(e),(function(t){return wi.call(e,t)})))}:_i;function Ai(e,t){return oi(e,xi(e),t)}function ji(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var $i=be(Object.getPrototypeOf,Object),Ei=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ji(t,xi(e)),e=$i(e);return t}:_i;function Oi(e,t){return oi(e,Ei(e),t)}function Ci(e,t,n){var r=t(e);return h(e)?r:ji(r,n(e))}function ki(e){return Ci(e,dn,xi)}function Ti(e){return Ci(e,di,Ei)}var Ni=Object.prototype.hasOwnProperty;function Mi(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Ni.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Ii=l.Uint8Array;function Pi(e){var t=new e.constructor(e.byteLength);return new Ii(t).set(new Ii(e)),t}function Di(e,t){var n=t?Pi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var Ri=/\w*$/;function zi(e){var t=new e.constructor(e.source,Ri.exec(e));return t.lastIndex=e.lastIndex,t}var Li=u?u.prototype:void 0,Ui=Li?Li.valueOf:void 0;function Bi(e){return Ui?Object(Ui.call(e)):{}}function Fi(e,t){var n=t?Pi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var qi="[object Boolean]",Hi="[object Date]",Gi="[object Map]",Wi="[object Number]",Vi="[object RegExp]",Ki="[object Set]",Ji="[object String]",Yi="[object Symbol]",Xi="[object ArrayBuffer]",Qi="[object DataView]",Zi="[object Float32Array]",es="[object Float64Array]",ts="[object Int8Array]",ns="[object Int16Array]",rs="[object Int32Array]",is="[object Uint8Array]",ss="[object Uint8ClampedArray]",os="[object Uint16Array]",as="[object Uint32Array]";function cs(e,t,n){var r=e.constructor;switch(t){case Xi:return Pi(e);case qi:case Hi:return new r(+e);case Qi:return Di(e,n);case Zi:case es:case ts:case ns:case rs:case is:case ss:case os:case as:return Fi(e,n);case Gi:return new r;case Wi:case Ji:return new r(e);case Vi:return zi(e);case Ki:return new r;case Yi:return Bi(e)}}var ls=Object.create,us=function(){function e(){}return function(t){if(!xe(t))return{};if(ls)return ls(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function ds(e){return"function"!=typeof e.constructor||ye(e)?{}:us($i(e))}var hs="[object Map]";function fs(e){return A(e)&&at(e)==hs}var ps=Xt&&Xt.isMap,ms=ps?Vt(ps):fs,gs="[object Set]";function vs(e){return A(e)&&at(e)==gs}var ys=Xt&&Xt.isSet,bs=ys?Vt(ys):vs,_s=1,ws=2,Ss=4,xs="[object Arguments]",As="[object Array]",js="[object Boolean]",$s="[object Date]",Es="[object Error]",Os="[object Function]",Cs="[object GeneratorFunction]",ks="[object Map]",Ts="[object Number]",Ns="[object Object]",Ms="[object RegExp]",Is="[object Set]",Ps="[object String]",Ds="[object Symbol]",Rs="[object WeakMap]",zs="[object ArrayBuffer]",Ls="[object DataView]",Us="[object Float32Array]",Bs="[object Float64Array]",Fs="[object Int8Array]",qs="[object Int16Array]",Hs="[object Int32Array]",Gs="[object Uint8Array]",Ws="[object Uint8ClampedArray]",Vs="[object Uint16Array]",Ks="[object Uint32Array]",Js={};function Ys(e,t,n,r,i,s){var o,a=t&_s,c=t&ws,l=t&Ss;if(n&&(o=i?n(e,r,i,s):n(e)),void 0!==o)return o;if(!xe(e))return e;var u=h(e);if(u){if(o=Mi(e),!a)return yi(e,o)}else{var d=at(e),f=d==Os||d==Cs;if(wt(e))return vi(e,a);if(d==Ns||d==xs||f&&!i){if(o=c||f?{}:ds(e),!a)return c?Oi(e,hi(o,e)):Ai(e,ai(o,e))}else{if(!Js[d])return i?e:{};o=cs(e,d,a)}}s||(s=new ei);var p=s.get(e);if(p)return p;s.set(e,o),bs(e)?e.forEach((function(r){o.add(Ys(r,t,n,r,e,s))})):ms(e)&&e.forEach((function(r,i){o.set(i,Ys(r,t,n,i,e,s))}));var m=u?void 0:(l?c?Ti:ki:c?di:dn)(e);return ti(m||e,(function(r,i){m&&(r=e[i=r]),si(o,i,Ys(r,t,n,i,e,s))})),o}Js[xs]=Js[As]=Js[zs]=Js[Ls]=Js[js]=Js[$s]=Js[Us]=Js[Bs]=Js[Fs]=Js[qs]=Js[Hs]=Js[ks]=Js[Ts]=Js[Ns]=Js[Ms]=Js[Is]=Js[Ps]=Js[Ds]=Js[Gs]=Js[Ws]=Js[Vs]=Js[Ks]=!0,Js[Es]=Js[Os]=Js[Rs]=!1;var Xs=1,Qs=4;function Zs(e){return Ys(e,Xs|Qs)}var eo="[object String]";function to(e){return"string"==typeof e||!h(e)&&A(e)&&x(e)==eo}var no="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function ro(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function io(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var so,oo={exports:{}};function ao(){return so||(so=1,e=oo,function(t){e.exports=t()}((function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof io&&io;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};t[o][0].call(u.exports,(function(e){var n=t[o][1][e];return i(n||e)}),u,u.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof io&&io,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){(function(e){var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,o=new i(u),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function d(e){1!==l.push(e)||r||n()}t.exports=d}).call(this,void 0!==no?no:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}function o(){t(i,r)}var a=p(o);"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function m(e){return e instanceof this?e:s.resolve(new this(i),e)}function g(e){var t=new this(i);return s.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,l=new this(i);++c<n;)u(e[c],c);return l;function u(e,i){function c(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(l,o))}t.resolve(e).then(c,(function(e){r||(r=!0,s.reject(l,e))}))}}function y(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(i);++o<n;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){r||(r=!0,s.resolve(a,e))}),(function(e){r||(r=!0,s.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?d(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=m,l.reject=g,l.all=v,l.race=y},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==no?no:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=s();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function d(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",m=void 0,g={},v=Object.prototype.toString,y="readonly",b="readwrite";function _(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function w(e){return new l((function(t){var n=e.transaction(p,b),r=c([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof m?l.resolve(m):w(e).then((function(e){return m=e}))}function x(e){var t=g[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function A(e){var t=g[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function j(e,t){var n=g[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function $(e,t){return new l((function(n,r){if(g[e.name]=g[e.name]||D(),e.db){if(!t)return n(e.db);x(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=o.open.apply(o,i);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),A(e)}}))}function E(e){return $(e,!1)}function O(e){return $(e,!0)}function C(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function k(e){return new l((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function T(e){return c([_(atob(e.data))],{type:e.type})}function N(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return d(n,e,e),n}function I(e){x(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,E(e).then((function(t){return e.db=t,C(e)?O(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw j(e,t),t}))}function P(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),O(e)})).then((function(){return I(e).then((function(){P(e,t,n,r-1)}))})).catch(n);n(i)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function R(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=g[n.name];i||(i=D(),g[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=M);var s=[];function o(){return l.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&s.push(c._initReady().catch(o))}var u=i.forages.slice(0);return l.all(s).then((function(){return n.db=i.db,E(n)})).then((function(e){return n.db=e,C(n,t._defaultConfig.version)?O(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var s=u[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))}function z(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){P(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),N(e)&&(e=T(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function L(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){P(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;N(r)&&(r=T(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function U(e,t,n){var r=this;e=h(e);var i=new l((function(n,i){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===v.call(t)?S(s.db).then((function(e){return e?t:k(t)})):t})).then((function(t){P(r._dbInfo,b,(function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return u(i,n),i}function B(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){P(n._dbInfo,b,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(o.error)},s.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function F(e){var t=this,n=new l((function(e,n){t.ready().then((function(){P(t._dbInfo,b,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function q(e){var t=this,n=new l((function(e,n){t.ready().then((function(){P(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function H(e,t){var n=this,r=new l((function(t,r){e<0?t(null):n.ready().then((function(){P(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function G(e){var t=this,n=new l((function(e,n){t.ready().then((function(){P(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var t=s.result;t?(o.push(t.key),t.continue()):e(o)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function W(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var s=e.name===n.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):E(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?s.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;x(e);var r=g[e.name],i=r.forages;t.close();for(var s=0;s<i.length;s++){var a=i[s];a._dbInfo.db=null,a._dbInfo.version=n}var c=new l((function(t,r){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,A(n._dbInfo)}})).catch((function(t){throw(j(e,t)||l.resolve()).catch((function(){})),t}))}})):s.then((function(t){x(e);var n=g[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var s=new l((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return s.then((function(e){n.db=e;for(var t=0;t<r.length;t++)A(r[t]._dbInfo)})).catch((function(t){throw(j(e,t)||l.resolve()).catch((function(){})),t}))}))}else r=l.reject("Invalid arguments");return u(r,t),r}var V={_driver:"asyncStorage",_initStorage:R,_support:a(),iterate:L,getItem:z,setItem:U,removeItem:B,clear:F,length:q,key:H,keys:G,dropInstance:W};function K(){return"function"==typeof openDatabase}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y="~~local_forage_type~",X=/^~~local_forage_type~([^~]+)~/,Q="__lfsc__:",Z=Q.length,ee="arbf",te="blob",ne="si08",re="ui08",ie="uic8",se="si16",oe="si32",ae="ur16",ce="ui32",le="fl32",ue="fl64",de=Z+ee.length,he=Object.prototype.toString;function fe(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=J.indexOf(e[t]),r=J.indexOf(e[t+1]),i=J.indexOf(e[t+2]),s=J.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&s;return l}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=J[n[t]>>2],r+=J[(3&n[t])<<4|n[t+1]>>4],r+=J[(15&n[t+1])<<2|n[t+2]>>6],r+=J[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function me(e,t){var n="";if(e&&(n=he.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var r,i=Q;e instanceof ArrayBuffer?(r=e,i+=ee):(r=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=re:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=se:"[object Uint16Array]"===n?i+=ae:"[object Int32Array]"===n?i+=oe:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=le:"[object Float64Array]"===n?i+=ue:t(new Error("Failed to get type for BinaryArray"))),t(i+pe(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=Y+e.type+"~"+pe(this.result);t(Q+te+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function ge(e){if(e.substring(0,Z)!==Q)return JSON.parse(e);var t,n=e.substring(de),r=e.substring(Z,de);if(r===te&&X.test(n)){var i=n.match(X);t=i[1],n=n.substring(i[0].length)}var s=fe(n);switch(r){case ee:return s;case te:return c([s],{type:t});case ne:return new Int8Array(s);case re:return new Uint8Array(s);case ie:return new Uint8ClampedArray(s);case se:return new Int16Array(s);case ae:return new Uint16Array(s);case oe:return new Int32Array(s);case ce:return new Uint32Array(s);case le:return new Float32Array(s);case ue:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}}var ve={serialize:me,deserialize:ge,stringToBuffer:fe,bufferToString:pe};function ye(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function be(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new l((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){ye(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=ve,i}function _e(e,t,n,r,i,s){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?s(e,o):ye(e,t,(function(){e.executeSql(n,r,i,s)}),s)}),s):s(e,o)}),s)}function we(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Se(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var c=s.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function xe(e,t,n,r){var i=this;e=h(e);var s=new l((function(s,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(n){_e(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){s(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(xe.apply(i,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return u(s,n),s}function Ae(e,t,n){return xe.apply(this,[e,t,n,1])}function je(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function $e(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){_e(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ee(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){_e(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Oe(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ce(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){_e(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function ke(e){return new l((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function Te(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return r=e.name?new l((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(ke(r))})).then((function(e){return new l((function(t,n){e.db.transaction((function(r){function i(e){return new l((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var s=[],o=0,a=e.storeNames.length;o<a;o++)s.push(i(e.storeNames[o]));l.all(s).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),u(r,t),r}var Ne={_driver:"webSQLStorage",_initStorage:be,_support:K(),iterate:Se,getItem:we,setItem:Ae,removeItem:je,clear:$e,length:Ee,key:Oe,keys:Ce,dropInstance:Te};function Me(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ie(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Pe(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function De(){return!Pe()||localStorage.length>0}function Re(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Ie(e,t._defaultConfig),De()?(t._dbInfo=n,n.serializer=ve,l.resolve()):l.reject()}function ze(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return u(n,e),n}function Le(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return u(r,t),r}function Ue(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return u(r,t),r}function Be(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return u(r,t),r}function Fe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r}));return u(n,e),n}function qe(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t}function He(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(r,t),r}function Ge(e,t,n){var r=this;e=h(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(i,s){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return u(i,n),i}function We(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new l((function(t){e.storeName?t(Ie(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),u(r,t),r}var Ve={_driver:"localStorageWrapper",_initStorage:Re,_support:Me(),iterate:Ue,getItem:Le,setItem:Ge,removeItem:He,clear:ze,length:qe,key:Be,keys:Fe,dropInstance:We},Ke=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Je=function(e,t){for(var n=e.length,r=0;r<n;){if(Ke(e[r],t))return!0;r++}return!1},Ye=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Qe={},Ze={INDEXEDDB:V,WEBSQL:Ne,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function st(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ye(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ot=function(){function e(t){for(var n in i(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],s=r._driver;this[n]=s,Xe[s]||this.defineDriver(r)}this._defaultConfig=st({},rt),this._config=st({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new l((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var s=nt.concat("_initStorage"),o=0,a=s.length;o<a;o++){var c=s[o];if((!Je(tt,c)||e[c])&&"function"!=typeof e[c])return void n(i)}var d=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=l.reject(t);return u(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var i=tt[n];e[i]||(e[i]=t(i))}};d();var h=function(n){Xe[r]&&console.info("Redefining LocalForage driver: "+r),Xe[r]=e,Qe[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return d(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Xe[e]?l.resolve(Xe[e]):l.reject(new Error("Driver not found."));return d(r,t,n),r},e.prototype.getSerializer=function(e){var t=l.resolve(ve);return d(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return d(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Ye(e)||(e=[e]);var i=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function o(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o).catch(n)}s();var a=new Error("No available storage method found.");return r._driverSet=l.reject(a),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=c.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(i)}))})).catch((function(){s();var e=new Error("No available storage method found.");return r._driverSet=l.reject(e),r._driverSet})),d(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Qe[e]},e.prototype._extend=function(e){st(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)}))),oo.exports;var e}var co=ro(ao());function lo(e,t,n){(void 0!==n&&!wr(e[t],n)||void 0===n&&!(t in e))&&ri(e,t,n)}function uo(e){return function(e,t,n){for(var r=-1,i=Object(e),s=n(e),o=s.length;o--;){var a=s[++r];if(!1===t(i[a],a,i))break}return e}}var ho=uo();function fo(e){return A(e)&&gt(e)}var po="[object Object]",mo=Function.prototype,go=Object.prototype,vo=mo.toString,yo=go.hasOwnProperty,bo=vo.call(Object);function _o(e){if(!A(e)||x(e)!=po)return!1;var t=$i(e);if(null===t)return!0;var n=yo.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&vo.call(n)==bo}function wo(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function So(e){return oi(e,di(e))}function xo(e,t,n,r,i,s,o){var a=wo(e,n),c=wo(t,n),l=o.get(c);if(l)lo(e,n,l);else{var u=s?s(a,c,n+"",e,t,o):void 0,d=void 0===u;if(d){var f=h(c),p=!f&&wt(c),m=!f&&!p&&Zt(c);u=c,f||p||m?h(a)?u=a:fo(a)?u=yi(a):p?(d=!1,u=vi(c,!0)):m?(d=!1,u=Fi(c,!0)):u=[]:_o(c)||ft(c)?(u=a,ft(a)?u=So(a):xe(a)&&!Oe(a)||(u=ds(c))):d=!1}d&&(o.set(c,u),i(u,c,r,s,o),o.delete(c)),lo(e,n,u)}}function Ao(e,t,n,r,i){e!==t&&ho(t,(function(s,o){if(i||(i=new ei),xe(s))xo(e,t,o,n,Ao,r,i);else{var a=r?r(wo(e,o),s,o+"",e,t,i):void 0;void 0===a&&(a=s),lo(e,o,a)}}),di)}function jo(e){return e}function $o(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var Eo=Math.max;function Oo(e,t,n){return t=Eo(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Eo(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),$o(e,this,a)}}function Co(e){return function(){return e}}var ko=ni?function(e,t){return ni(e,"toString",{configurable:!0,enumerable:!1,value:Co(t),writable:!0})}:jo,To=800,No=16,Mo=Date.now;function Io(e){var t=0,n=0;return function(){var r=Mo(),i=No-(r-n);if(n=r,i>0){if(++t>=To)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Po=Io(ko);function Do(e,t){return Po(Oo(e,t,jo),e+"")}function Ro(e,t,n){if(!xe(n))return!1;var r=typeof t;return!!("number"==r?gt(n)&&cn(t,n.length):"string"==r&&t in n)&&wr(n[t],e)}function zo(e){return Do((function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,o&&Ro(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t}))}var Lo=zo((function(e,t,n){Ao(e,t,n)})),Uo=zo((function(e,t,n,r){Ao(e,t,n,r)}));function Bo(){const e={isResolved:!1,isPending:!0,isRejected:!1};let t,n=()=>{},r=()=>{};if("function"==typeof Promise.withResolvers){const{promise:e,resolve:i,reject:s}=Promise.withResolvers();t=e,n=i,r=s}else t=new Promise(((e,t)=>{n=e,r=t}));return Object.assign(t,a(o({},e),{resolve:n,reject:r})),t.then((e=>(t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e)),(e=>{throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}const Fo="Expected a function",qo=Math.max,Ho=Math.min;function Go(e){if("number"==typeof e)return e;if("string"==typeof e){const t=parseFloat(e);return isNaN(t)?0:t}return 0}function Wo(e){const t=typeof e;return null!=e&&("object"===t||"function"===t)}function Vo(e,t,n={}){let r,i,s,o,a,c,l=0,u=!1,d=n.promise?Bo():null;if("function"!=typeof e)throw new TypeError(Fo);function h(t){const s=r,a=i,c=d;return r=i=void 0,l=t,o=e.apply(a,s),n.promise&&(c.resolve(o),d=Bo()),n.promise?c:o}function f(e){return l=e,a=setTimeout(g,t),n.promise?d:o}function p(e){const n=t-(e-c);return u?Ho(n,s-(e-l)):n}function m(e){const n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=s}function g(){const e=Date.now();if(m(e))return v(e);a=setTimeout(g,p(e))}function v(e){return a=void 0,r?h(e):(r=i=void 0,n.promise?d:o)}function y(){void 0!==a&&clearTimeout(a),l=0,r=c=i=a=void 0}function b(){return void 0===a?o:v(Date.now())}function _(e,t){if(Array.isArray(e)&&Array.isArray(t))return null!=n&&n.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function w(e){var t;return null!==(t=r)&&void 0!==t&&t.length?e.length?null!=n&&n.concatArrays||null!=n&&n.dedupeArrays?Uo(r,e,_):Lo(r,e):r:e||[]}function S(){const e=Date.now(),s=m(e);if(r=w(Array.from(arguments)),i=this,c=e,s){if(void 0===a)return f(c);if(u)return clearTimeout(a),a=setTimeout(g,t),h(c)}return void 0===a&&(a=setTimeout(g,t)),n.promise?d:o}return t=Go(t)||0,Wo(n)&&(u="maxWait"in n,s=u?qo(Go(n.maxWait)||0,t):s),S.cancel=y,S.flush=b,S}function Ko(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function Jo(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function Yo(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function Xo(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}var Qo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Zo="~~local_forage_type~",ea=/^~~local_forage_type~([^~]+)~/,ta="__lfsc__:",na=ta.length,ra="arbf",ia="blob",sa="si08",oa="ui08",aa="uic8",ca="si16",la="si32",ua="ur16",da="ui32",ha="fl32",fa="fl64",pa=na+ra.length,ma=Object.prototype.toString;function ga(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=Qo.indexOf(e[t]),r=Qo.indexOf(e[t+1]),i=Qo.indexOf(e[t+2]),s=Qo.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&s;return l}function va(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=Qo[n[t]>>2],r+=Qo[(3&n[t])<<4|n[t+1]>>4],r+=Qo[(15&n[t+1])<<2|n[t+2]>>6],r+=Qo[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function ya(e,t){var n="";if(e&&(n=ma.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===ma.call(e.buffer))){var r,i=ta;e instanceof ArrayBuffer?(r=e,i+=ra):(r=e.buffer,"[object Int8Array]"===n?i+=sa:"[object Uint8Array]"===n?i+=oa:"[object Uint8ClampedArray]"===n?i+=aa:"[object Int16Array]"===n?i+=ca:"[object Uint16Array]"===n?i+=ua:"[object Int32Array]"===n?i+=la:"[object Uint32Array]"===n?i+=da:"[object Float32Array]"===n?i+=ha:"[object Float64Array]"===n?i+=fa:t(new Error("Failed to get type for BinaryArray"))),t(i+va(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=Zo+e.type+"~"+va(this.result);t(ta+ia+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function ba(e){if(e.substring(0,na)!==ta)return JSON.parse(e);var t,n=e.substring(pa),r=e.substring(na,pa);if(r===ia&&ea.test(n)){var i=n.match(ea);t=i[1],n=n.substring(i[0].length)}var s=ga(n);switch(r){case ra:return s;case ia:return Xo([s],{type:t});case sa:return new Int8Array(s);case oa:return new Uint8Array(s);case aa:return new Uint8ClampedArray(s);case ca:return new Int16Array(s);case ua:return new Uint16Array(s);case la:return new Int32Array(s);case da:return new Uint32Array(s);case ha:return new Float32Array(s);case fa:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}}var _a={serialize:ya,deserialize:ba};const wa=_a.serialize,Sa=_a.deserialize;function xa(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}function Aa(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const ja={serializer:{serialize:wa,deserialize:Sa}};function $a(e){if(ja.keyPrefix=Aa(e,this._defaultConfig),e)for(const t in e)ja[t]=e[t]}function Ea(e){const t=this.ready().then((function(){const e=ja.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return Ko(t,e),t}function Oa(e,t){e=Yo(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(ja.keyPrefix+e);return t&&(t=ja.serializer.deserialize(t)),t}));return Ko(n,t),n}function Ca(e,t){const n=this.ready().then((function(){const t=ja.keyPrefix,n=t.length,r=sessionStorage.length;let i=1;for(let s=0;s<r;s++){const r=sessionStorage.key(s);if(0!==r.indexOf(t))continue;let o=sessionStorage.getItem(r);if(o&&(o=ja.serializer.deserialize(o)),o=e(o,r.substring(n),i++),void 0!==o)return o}}));return Ko(n,t),n}function ka(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(ja.keyPrefix.length)),t}));return Ko(n,t),n}function Ta(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(ja.keyPrefix)&&t.push(e.substring(ja.keyPrefix.length))}return t}));return Ko(t,e),t}function Na(e){const t=this.keys().then((function(e){return e.length}));return Ko(t,e),t}function Ma(e,t){e=Yo(e);const n=this.ready().then((function(){sessionStorage.removeItem(ja.keyPrefix+e)}));return Ko(n,t),n}function Ia(e,t,n){return i((function*(){var r;e=Yo(e),yield this.ready();const i=t=null!==(r=t)&&void 0!==r?r:null;return ja.serializer.serialize(t,((t,r)=>{if(r)throw r;try{sessionStorage.setItem(ja.keyPrefix+e,t),Ko(Promise.resolve(i),n)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}})),t})).call(this)}function Pa(e,t){if(t=Jo.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let r;return r=e.name?new Promise((function(t){e.storeName?t(Aa(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),Ko(r,t),r}const Da={_driver:"sessionStorageWrapper",_initStorage:$a,_support:xa(),iterate:Ca,getItem:Oa,setItem:Ia,removeItem:Ma,clear:Ea,length:Na,key:ka,keys:Ta,dropInstance:Pa};var Ra,za={exports:{}};function La(){return Ra||(Ra=1,function(e,t){!function(e,n){n(t,ao())}(0,(function(e,t){function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function r(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,n,r){function i(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var s=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),n=i(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];s.push(r(t(c),n(c)))}}else for(var l in e)e.hasOwnProperty(l)&&s.push(r(l,e[l]));return s}function s(e,t,n,s){var o=this,a=o.ready().then((function(){return new Promise((function(r,s){var a,c=o._dbInfo,l=c.db.transaction(c.storeName,"readwrite"),u=l.objectStore(c.storeName);function d(e){var t=e.target||this;a=t.error||t.transaction.error,s(a)}l.oncomplete=function(){r(e)},l.onabort=l.onerror=function(e){s(a||e.target)},i(e,t,n,(function(e,t){null===t&&(t=void 0),u.put(t,e).onerror=d}))}))}));return r(a,s),a}function o(e,t,s,o){var a=this,c=new Promise((function(r,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var l="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",u=i(e,t,s,(function(e,t){return new Promise((function(r,i){n.serialize(t,(function(t,n){n?i(n):a.executeSql(l,[e,t],(function(){r()}),(function(e,t){i(t)}))}))}))}));Promise.all(u).then((function(){r(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return r(c,o),c}function a(e,t,n,s){var o=this,a=i(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return r(c,s),c}function c(e,t,n,r){var i=this,c=i.driver();return c===i.INDEXEDDB?s.call(i,e,t,n,r):c===i.WEBSQL?o.call(i,e,t,n,r):a.call(i,e,t,n,r)}function l(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return s.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var u=l(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=l,e.extendPrototypeResult=u,Object.defineProperty(e,"__esModule",{value:!0})}))}(0,za.exports)),za.exports}za.exports;var Ua=La();function Ba(e){return Ba.result?Ba.result:e&&"function"==typeof e.getSerializer?(Ba.result=e.getSerializer(),Ba.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function Fa(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function qa(e,t){var n=this.getItem(e).then((function(t){return{key:e,value:t}}));return Fa(n,t),n}function Ha(e){var t=this,n=new Promise((function(n,r){for(var i=[],s=0,o=e.length;s<o;s++)i.push(qa.call(t,e[s]));Promise.all(i).then((function(e){for(var t={},r=0,i=e.length;r<i;r++){var s=e[r];t[s.key]=s.value}n(t)})).catch(r)}));return n}function Ga(){var e={};return this.iterate((function(t,n){e[n]=t})).then((function(){return e}))}function Wa(){return"undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0}var Va=Wa();function Ka(e){e=e.slice();var t=this;function n(e,t){return e<t?-1:e>t?1:0}var r=new Promise((function(r,i){t.ready().then((function(){var s,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),c=e.sort(n),l=Va.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(s=a.getAll(l)).onsuccess=function(){var e=s.result;void 0===e&&(e=null),r(e)};else{s=a.openCursor(l);var u={},d=0;s.onsuccess=function(){var e=s.result;if(e){for(var t=e.key;t>c[d];)if(++d===c.length)return void r(u);if(t===c[d]){var n=e.value;void 0===n&&(n=null),u[t]=n,e.continue()}else e.continue(c[d])}else r(u)}}s.onerror=function(){i(s.error)}})).catch(i)}));return r}function Ja(e){var t=this,n=new Promise((function(n,r){t.ready().then((function(){return Ba(t)})).then((function(i){var s=t._dbInfo;s.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+s.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var r={},s=t.rows,o=0,a=s.length;o<a;o++){var c=s.item(o),l=c.value;l&&(l=i.deserialize(l)),r[c.key]=l}n(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return n}function Ya(e,t){var n,r=this;if(arguments.length&&null!==e){var i=r.driver();n=i===r.INDEXEDDB?Ka.apply(r,arguments):i===r.WEBSQL?Ja.apply(r,arguments):Ha.apply(r,arguments)}else n=Ga.apply(r);return Fa(n,t),n}function Xa(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=Ya,t.getItems.indexedDB=function(){return Ka.apply(this,arguments)},t.getItems.websql=function(){return Ja.apply(this,arguments)},t.getItems.generic=function(){return Ha.apply(this,arguments)})}Xa(co);var Qa=Object.prototype.hasOwnProperty;function Za(e,t){return null!=e&&Qa.call(e,t)}var ec=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tc=/^\w*$/;function nc(e,t){if(h(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!$(e))||tc.test(e)||!ec.test(e)||null!=t&&e in Object(t)}var rc="Expected a function";function ic(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(rc);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(ic.Cache||Xr),n}ic.Cache=Xr;var sc=500;function oc(e){var t=ic(e,(function(e){return n.size===sc&&n.clear(),e})),n=t.cache;return t}var ac=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,cc=/\\(\\)?/g,lc=oc((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ac,(function(e,n,r,i){t.push(r?i.replace(cc,"$1"):n||e)})),t}));function uc(e,t){return h(e)?e:nc(e,t)?[e]:lc(k(e))}function dc(e){if("string"==typeof e||$(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function hc(e,t,n){for(var r=-1,i=(t=uc(t,e)).length,s=!1;++r<i;){var o=dc(t[r]);if(!(s=null!=e&&n(e,o)))break;e=e[o]}return s||++r!=i?s:!!(i=null==e?0:e.length)&&mt(i)&&cn(o,i)&&(h(e)||ft(e))}function fc(e,t){return null!=e&&hc(e,t,Za)}function pc(e,t,n){var r=-1,i=(t=uc(t,e)).length;for(i||(i=1,e=void 0);++r<i;){var s=null==e?void 0:e[dc(t[r])];void 0===s&&(r=i,s=n),e=Oe(s)?s.call(e):s}return e}function mc(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function gc(){return mc()+mc()+"-"+mc()+"-"+mc()+"-"+mc()+"-"+mc()+mc()+mc()}function vc(){const e={isResolved:!1,isPending:!0,isRejected:!1,resolve:null,reject:null},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function yc(){throw new Error('A "url" property or function must be specified')}function bc(e,t){const n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}}const _c={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function wc(e){const t=pc(e,"browserStorage")||pc(e.collection,"browserStorage");return t?t.sync():Sc}function Sc(e,t,n={}){let r=n.data;null!=r||!t||"create"!==e&&"update"!==e&&"patch"!==e||(r=n.attrs||t.toJSON());const i={method:_c[e],body:r?JSON.stringify(r):"",success:n.success,error:n.error},s=n.url||pc(t,"url")||yc(),c=n.xhr=fetch(s,i);return t.trigger("request",t,c,a(o({},i),{xhr:c})),c}const xc=sr;co.defineDriver(br),Ua.extendPrototype(co),Xa(co);class Ac{initStore(e,t){return i((function*(){if("session"===e)yield co.setDriver(Da._driver);else if("local"===e)yield co.config({driver:co.LOCALSTORAGE});else if("in_memory"===e)yield co.config({driver:xc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=co,t&&(this.store.debouncedSetItems=Vo((e=>this.store.setItems(e)),50,{promise:!0}))})).call(this)}flush(){var e;return null===(e=this.store.debouncedSetItems)||void 0===e?void 0:e.flush()}clear(){return i((function*(){yield this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(yield this.store.keys()).filter((t=>e.test(t)));yield Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))})).call(this)}sync(){const e=this;function t(t,n,r){return i((function*(){let i,s,o,a;const c=n.collection;["patch","update"].includes(t)&&(a=Zs(n.attributes)),yield e.storeInitialized;try{const s=n.attributes;switch(t){case"read":i=void 0!==n.id?yield e.find(n):yield e.findAll();break;case"create":i=yield e.create(n,r);break;case"patch":case"update":r.wait&&(n.attributes=a),o=e.update(n),r.wait&&(n.attributes=s),i=yield o;break;case"delete":i=yield e.destroy(n,c)}}catch(t){s=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(i){if(r&&r.success){const e="read"===t?i:null;r.success(e,r)}}else s=s||"Record Not Found",r&&r.error&&r.error(s)}))()}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),r=this.getItemName(e.id);return n.includes(r)||n.push(r),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const r={};return r[this.name]=t,r}save(e){return i((function*(){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=yield this.store.setItem(t,e.toJSON());return yield this.addCollectionReference(e,e.collection),n}})).call(this)}create(e,t){return e.id||(e.id=gc(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}findAll(){return i((function*(){const e=yield this.store.getItem(this.name);if(null!=e&&e.length){const t=yield this.store.getItems(e);return Object.values(t)}return[]})).call(this)}destroy(e,t){return i((function*(){return yield this.flush(),yield this.store.removeItem(this.getItemName(e.id)),yield this.removeCollectionReference(e,t),e})).call(this)}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}constructor(e,t,n=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");to(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=Vo((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}}Ac.sessionStorageInitialized=co.defineDriver(Da),Ac.localForage=co;var jc=4;function $c(e){return Ys(e,jc)}var Ec=Object.prototype,Oc=Ec.hasOwnProperty,Cc=Do((function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Ro(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=di(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(void 0===u||wr(u,Ec[l])&&!Oc.call(e,l))&&(e[l]=s[l])}return e})),kc="Expected a function";function Tc(e,t,n){if("function"!=typeof e)throw new TypeError(kc);return setTimeout((function(){e.apply(void 0,n)}),t)}var Nc=Do((function(e,t){return Tc(e,1,t)}));function Mc(e,t){return e&&ho(e,t,dn)}function Ic(e,t,n,r){return Mc(e,(function(e,i,s){t(r,n(e),i,s)})),r}function Pc(e,t){return function(n,r){return Ic(n,e,t(r),{})}}var Dc=Object.prototype.toString,Rc=Pc((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Dc.call(t)),e[t]=n}),Co(jo)),zc="__lodash_hash_undefined__";function Lc(e){return this.__data__.set(e,zc),this}function Uc(e){return this.__data__.has(e)}function Bc(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Xr;++t<n;)this.add(e[t])}function Fc(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function qc(e,t){return e.has(t)}Bc.prototype.add=Bc.prototype.push=Lc,Bc.prototype.has=Uc;var Hc=1,Gc=2;function Wc(e,t,n,r,i,s){var o=n&Hc,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var d=-1,h=!0,f=n&Gc?new Bc:void 0;for(s.set(e,t),s.set(t,e);++d<a;){var p=e[d],m=t[d];if(r)var g=o?r(m,p,d,t,e,s):r(p,m,d,e,t,s);if(void 0!==g){if(g)continue;h=!1;break}if(f){if(!Fc(t,(function(e,t){if(!qc(f,t)&&(p===e||i(p,e,n,r,s)))return f.push(t)}))){h=!1;break}}else if(p!==m&&!i(p,m,n,r,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function Vc(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Kc(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var Jc=1,Yc=2,Xc="[object Boolean]",Qc="[object Date]",Zc="[object Error]",el="[object Map]",tl="[object Number]",nl="[object RegExp]",rl="[object Set]",il="[object String]",sl="[object Symbol]",ol="[object ArrayBuffer]",al="[object DataView]",cl=u?u.prototype:void 0,ll=cl?cl.valueOf:void 0;function ul(e,t,n,r,i,s,o){switch(n){case al:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ol:return!(e.byteLength!=t.byteLength||!s(new Ii(e),new Ii(t)));case Xc:case Qc:case tl:return wr(+e,+t);case Zc:return e.name==t.name&&e.message==t.message;case nl:case il:return e==t+"";case el:var a=Vc;case rl:var c=r&Jc;if(a||(a=Kc),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=Yc,o.set(e,t);var u=Wc(a(e),a(t),r,i,s,o);return o.delete(e),u;case sl:if(ll)return ll.call(e)==ll.call(t)}return!1}var dl=1,hl=Object.prototype.hasOwnProperty;function fl(e,t,n,r,i,s){var o=n&dl,a=ki(e),c=a.length;if(c!=ki(t).length&&!o)return!1;for(var l=c;l--;){var u=a[l];if(!(o?u in t:hl.call(t,u)))return!1}var d=s.get(e),h=s.get(t);if(d&&h)return d==t&&h==e;var f=!0;s.set(e,t),s.set(t,e);for(var p=o;++l<c;){var m=e[u=a[l]],g=t[u];if(r)var v=o?r(g,m,u,t,e,s):r(m,g,u,e,t,s);if(!(void 0===v?m===g||i(m,g,n,r,s):v)){f=!1;break}p||(p="constructor"==u)}if(f&&!p){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(f=!1)}return s.delete(e),s.delete(t),f}var pl=1,ml="[object Arguments]",gl="[object Array]",vl="[object Object]",yl=Object.prototype.hasOwnProperty;function bl(e,t,n,r,i,s){var o=h(e),a=h(t),c=o?gl:at(e),l=a?gl:at(t),u=(c=c==ml?vl:c)==vl,d=(l=l==ml?vl:l)==vl,f=c==l;if(f&&wt(e)){if(!wt(t))return!1;o=!0,u=!1}if(f&&!u)return s||(s=new ei),o||Zt(e)?Wc(e,t,n,r,i,s):ul(e,t,c,n,r,i,s);if(!(n&pl)){var p=u&&yl.call(e,"__wrapped__"),m=d&&yl.call(t,"__wrapped__");if(p||m){var g=p?e.value():e,v=m?t.value():t;return s||(s=new ei),i(g,v,n,r,s)}}return!!f&&(s||(s=new ei),fl(e,t,n,r,i,s))}function _l(e,t,n,r,i){return e===t||(null==e||null==t||!A(e)&&!A(t)?e!=e&&t!=t:bl(e,t,n,r,_l,i))}function wl(e,t){return _l(e,t)}var Sl=1,xl=2;function Al(e,t,n,r){var i=n.length,s=i;if(null==e)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){var a=(o=n[i])[0],c=e[a],l=o[1];if(o[2]){if(void 0===c&&!(a in e))return!1}else{var u,d=new ei;if(!(void 0===u?_l(l,c,Sl|xl,r,d):u))return!1}}return!0}function jl(e){return e==e&&!xe(e)}function $l(e){for(var t=dn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,jl(i)]}return t}function El(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}function Ol(e){var t=$l(e);return 1==t.length&&t[0][2]?El(t[0][0],t[0][1]):function(n){return n===e||Al(n,e,t)}}function Cl(e,t){for(var n=0,r=(t=uc(t,e)).length;null!=e&&n<r;)e=e[dc(t[n++])];return n&&n==r?e:void 0}function kl(e,t,n){var r=null==e?void 0:Cl(e,t);return void 0===r?n:r}function Tl(e,t){return null!=e&&t in Object(e)}function Nl(e,t){return null!=e&&hc(e,t,Tl)}var Ml=1,Il=2;function Pl(e,t){return nc(e)&&jl(t)?El(dc(e),t):function(n){var r=kl(n,e);return void 0===r&&r===t?Nl(n,e):_l(t,r,Ml|Il)}}function Dl(e){return function(t){return null==t?void 0:t[e]}}function Rl(e){return function(t){return Cl(t,e)}}function zl(e){return nc(e)?Dl(dc(e)):Rl(e)}function Ll(e){return"function"==typeof e?e:null==e?jo:"object"==typeof e?h(e)?Pl(e[0],e[1]):Ol(e):zl(e)}var Ul=1;function Bl(e){return Ll("function"==typeof e?e:Ys(e,Ul))}function Fl(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function ql(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function Hl(e,t){return t.length<2?e:Cl(e,ql(t,0,-1))}function Gl(e,t){return null==(e=Hl(e,t=uc(t,e)))||delete e[dc(Fl(t))]}function Wl(e){return _o(e)?void 0:e}var Vl=u?u.isConcatSpreadable:void 0;function Kl(e){return h(e)||ft(e)||!!(Vl&&e&&e[Vl])}function Jl(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=Kl),i||(i=[]);++s<o;){var a=e[s];n(a)?ji(i,a):i[i.length]=a}return i}function Yl(e){return null!=e&&e.length?Jl(e):[]}function Xl(e){return Po(Oo(e,void 0,Yl),e+"")}var Ql=1,Zl=2,eu=4,tu=Xl((function(e,t){var n={};if(null==e)return n;var r=!1;t=d(t,(function(t){return t=uc(t,e),r||(r=t.length>1),t})),oi(e,Ti(e),n),r&&(n=Ys(n,Ql|Zl|eu,Wl));for(var i=t.length;i--;)Gl(n,t[i]);return n}));function nu(e,t,n,r){if(!xe(e))return e;for(var i=-1,s=(t=uc(t,e)).length,o=s-1,a=e;null!=a&&++i<s;){var c=dc(t[i]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var u=a[c];void 0===(l=void 0)&&(l=xe(u)?u:cn(t[i+1])?[]:{})}si(a,c,l),a=a[c]}return e}function ru(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Cl(e,o);n(a,o)&&nu(s,uc(o,e),a)}return s}function iu(e,t){return ru(e,t,(function(t,n){return Nl(e,n)}))}var su=Xl((function(e,t){return null==e?{}:iu(e,t)}));class ou extends(Ln(Object)){set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get idAttribute(){return"id"}get cidPrefix(){return"c"}preinitialize(){}initialize(e,t){}validate(e,t){return""}toJSON(){return $c(this.attributes)}sync(e,t,n){return wc(t)(e,t,n)}get(e){return this.attributes[e]}keys(){return Object.keys(this.attributes)}values(){return Object.values(this.attributes)}pairs(){return this.entries()}entries(){return Object.entries(this.attributes)}invert(){return Rc(this.attributes)}pick(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),su(this.attributes,e)}omit(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),tu(this.attributes,e)}isEmpty(){return rn(this.attributes)}has(e){return null!=this.get(e)}matches(e){return!!Bl(e)(this.attributes)}set(e,t,n){if(null==e)return this;let r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;const i=n.unset,s=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=$c(this.attributes),this.changed={});const c=this.attributes,l=this.changed,u=this._previousAttributes;for(const e in r)t=r[e],wl(c[e],t)||o.push(e),wl(u[e],t)?delete l[e]:l[e]=t,i?delete c[e]:c[e]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){o.length&&(this._pending=n);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],n)}if(a)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this}unset(e,t){return this.set(e,void 0,Object.assign({},t,{unset:!0}))}clear(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Object.assign({},e,{unset:!0}))}hasChanged(e){return null==e?!rn(this.changed):fc(this.changed,e)}changedAttributes(e){if(!e)return!!this.hasChanged()&&$c(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let r;for(const i in e){const s=e[i];wl(t[i],s)||(n[i]=s,r=!0)}return!!r&&n}previous(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null}previousAttributes(){return $c(this._previousAttributes)}fetch(e={}){const t=(e=Object.assign({parse:!0},e)).success;return e.success=n=>{const r=e.parse?this.parse(n,e):n;if(!this.set(r,e))return!1;t&&t.call(e.context,this,n,e),this.trigger("sync",this,n,e)},bc(this,e),this.sync("read",this,e)}save(e,t,n){let r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t;const i=(n=Object.assign({validate:!0,parse:!0},n)).wait,s=n.promise,o=s&&vc();if(r&&!i){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;const a=n.success,c=n.error,l=this.attributes;n.success=e=>{this.attributes=l;let t=n.parse?this.parse(e,n):e;if(i&&(t=Object.assign({},r,t)),t&&!this.set(t,n))return!1;a&&a.call(n.context,this,e,n),this.trigger("sync",this,e,n),s&&o.resolve()},n.error=(e,t,n)=>{c&&c.call(n.context,e,t,n),s&&o.reject(t)},bc(this,n),r&&i&&(this.attributes=Object.assign({},l,r));const u=this.isNew()?"create":n.patch?"patch":"update";"patch"!==u||n.attrs||(n.attrs=r);const d=this.sync(u,this,n);return this.attributes=l,s?o:d}destroy(e){const t=(e=e?$c(e):{}).success,n=e.wait,r=()=>{this.stopListening(),this.trigger("destroy",this,this.collection,e)};e.success=i=>{n&&r(),t&&t.call(e.context,this,i,e),this.isNew()||this.trigger("sync",this,i,e)};let i=!1;return this.isNew()?Nc(e.success):(bc(this,e),i=this.sync("delete",this,e)),n||r(),i}url(){const e=pc(this,"urlRoot")||pc(this.collection,"url")||yc();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)}parse(e,t){return e}isNew(){return!this.has(this.idAttribute)}isValid(e){return this._validate({},Object.assign({},e,{validate:!0}))}_validate(e,t){if(!t.validate||!this.validate)return!0;e=Object.assign({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,Object.assign(t,{validationError:n})),!1)}constructor(e,t){super();let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=N(this.cidPrefix),this.attributes={},this.validationError=null,t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const r=pc(this,"defaults");n=Cc(Object.assign({},r,n),r),this.set(n,t),this.initialize.apply(this,arguments),this.changed={}}}function au(e,t,n,r){for(var i=-1,s=null==e?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function cu(e,t){return function(t,n){if(null==t)return t;if(!gt(t))return e(t,n);for(var r=t.length,i=-1,s=Object(t);++i<r&&!1!==n(s[i],i,s););return t}}var lu=cu(Mc);function uu(e,t,n,r){return lu(e,(function(e,i,s){t(r,e,n(e),s)})),r}function du(e,t){return function(t,n){var r={};return(h(t)?au:uu)(t,e,Ll(n),r)}}var hu=Object.prototype.hasOwnProperty,fu=du((function(e,t,n){hu.call(e,n)?++e[n]:ri(e,n,1)})),pu=Object.prototype.hasOwnProperty,mu=du((function(e,t,n){pu.call(e,n)?e[n].push(t):ri(e,n,[t])})),gu=du((function(e,t,n){ri(e,n,t)}));function vu(e,t){var n=-1,r=gt(e)?Array(e.length):[];return lu(e,(function(e,i,s){r[++n]=t(e,i,s)})),r}function yu(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function bu(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e==e,s=$(e),o=void 0!==t,a=null===t,c=t==t,l=$(t);if(!a&&!l&&!s&&e>t||s&&o&&c&&!a&&!l||r&&o&&c||!n&&c||!i)return 1;if(!r&&!s&&!l&&e<t||l&&n&&i&&!r&&!s||a&&n&&i||!o&&i||!c)return-1}return 0}function _u(e,t,n){for(var r=-1,i=e.criteria,s=t.criteria,o=i.length,a=n.length;++r<o;){var c=bu(i[r],s[r]);if(c)return r>=a?c:c*("desc"==n[r]?-1:1)}return e.index-t.index}function wu(e,t,n){t=t.length?d(t,(function(e){return h(e)?function(t){return Cl(t,1===e.length?e[0]:e)}:e})):[jo];var r=-1;t=d(t,Vt(Ll));var i=vu(e,(function(e,n,i){var s=d(t,(function(t){return t(e)}));return{criteria:s,index:++r,value:e}}));return yu(i,(function(e,t){return _u(e,t,n)}))}var Su=Do((function(e,t){if(null==e)return[];var n=t.length;return n>1&&Ro(e,t[0],t[1])?t=[]:n>2&&Ro(t[0],t[1],t[2])&&(t=[t[0]]),wu(e,Jl(t),[])}));const xu=Array.prototype.slice,Au={add:!0,remove:!0,merge:!0},ju={add:!0,remove:!1};class $u extends(Ln(Object)){set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get model(){var e;return null!==(e=this._model)&&void 0!==e?e:ou}set model(e){this._model=e}get length(){return this.models.length}preinitialize(){}initialize(){}toJSON(e){return this.map((function(t){return t.toJSON(e)}))}sync(e,t,n){return wc(this)(e,t,n)}add(e,t){return this.set(e,Object.assign({merge:!1},t,ju))}remove(e,t){t=Object.assign({},t);const n=!Array.isArray(e),r=n?[e]:e.slice(),i=this._removeModels(r,t);return!t.silent&&i.length&&(t.changes={added:[],merged:[],removed:i},this.trigger("update",this,t)),n?i[0]:i}set(e,t){if(null==e)return;(t=Object.assign({},Au,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!Array.isArray(e);e=n?[e]:e.slice();let r=t.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);const i=[],s=[],o=[],a=[],c={},l=t.add,u=t.merge,d=t.remove;let h=!1;const f=this.comparator&&null==r&&!1!==t.sort,p=to(this.comparator)?this.comparator:null;let m,g;for(g=0;g<e.length;g++){m=e[g];const n=this.get(m);if(n){if(u&&m!==n){let e=this._isModel(m)?m.attributes:m;t.parse&&(e=n.parse(e,t)),n.set(e,t),o.push(n),f&&!h&&(h=n.hasChanged(p))}c[n.cid]||(c[n.cid]=!0,i.push(n)),e[g]=n}else l&&(m=e[g]=this._prepareModel(m,t),m&&(s.push(m),this._addReference(m,t),c[m.cid]=!0,i.push(m)))}if(d){for(g=0;g<this.length;g++)m=this.models[g],c[m.cid]||a.push(m);a.length&&this._removeModels(a,t)}let v=!1;const y=!f&&l&&d;if(i.length&&y)v=this.length!==i.length||this.models.some(((e,t)=>e!==i[t])),this.models.length=0,this.models.splice(0,0,...i);else if(s.length){f&&(h=!0);let e=null==r?this.length:r;e=Math.min(Math.max(e,0),this.models.length),this.models.splice(e,0,...s)}if(h&&this.sort({silent:!0}),!t.silent){for(g=0;g<s.length;g++)null!=r&&(t.index=r+g),m=s[g],m.trigger("add",m,this,t);(h||v)&&this.trigger("sort",this,t),(s.length||a.length||o.length)&&(t.changes={added:s,removed:a,merged:o},this.trigger("update",this,t))}return n?e[0]:e}clearStore(){return i((function*(e={},t=e=>e){yield Promise.all(this.models.filter(t).map((t=>new Promise((n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))))),yield this.browserStorage.clear(),this.reset()})).apply(this,arguments)}reset(e,t){t=t?$c(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,Object.assign({silent:!0},t)),t.silent||this.trigger("reset",this,t),e}push(e,t){return this.add(e,Object.assign({at:this.length},t))}pop(e){const t=this.at(this.length-1);return this.remove(t,e)}unshift(e,t){return this.add(e,Object.assign({at:0},t))}shift(e){const t=this.at(0);return this.remove(t,e)}slice(){return xu.apply(this.models,arguments)}filter(e,t){return this.models.filter(Oe(e)?e:t=>t.matches(e),t)}every(e){return Oe(e)?this.models.map((e=>e.attributes)).every(e):this.models.every((t=>t.matches(e)))}difference(e){return this.models.filter((t=>!e.includes(t)))}max(){return Math.max.apply(Math,this.models)}min(){return Math.min.apply(Math,this.models)}drop(e=1){return this.models.slice(e)}some(e){return Oe(e)?this.models.map((e=>e.attributes)).some(e):this.models.some((t=>t.matches(e)))}sortBy(e){return Su(this.models,Oe(e)?e:t=>to(e)?t.get(e):t.matches(e))}isEmpty(){return!this.models.length}keyBy(e){return gu(this.models,e)}each(e,t){return this.forEach(e,t)}forEach(e,t){return this.models.forEach(e,t)}includes(e){return this.models.includes(e)}size(){return this.models.length}countBy(e){return fu(this.models,Oe(e)?e:t=>to(e)?t.get(e):t.matches(e))}groupBy(e){return mu(this.models,Oe(e)?e:t=>to(e)?t.get(e):t.matches(e))}indexOf(e){return this.models.indexOf(e)}findLastIndex(e,t){return this.models.findLastIndex(Oe(e)?e:t=>to(e)?t.get(e):t.matches(e),t)}lastIndexOf(e){return this.models.lastIndexOf(e)}findIndex(e){return this.models.findIndex(Oe(e)?e:t=>to(e)?t.get(e):t.matches(e))}last(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0}head(){return this.models[0]}first(){return this.head()}map(e,t){return this.models.map(Oe(e)?e:t=>to(e)?t.get(e):t.matches(e),t)}reduce(e,t){return this.models.reduce(e,t||this.models[0])}reduceRight(e,t){return this.models.reduceRight(e,t||this.models[0])}toArray(){return Array.from(this.models)}get(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]}has(e){return null!=this.get(e)}at(e){return e<0&&(e+=this.length),this.models[e]}where(e,t){return this[t?"find":"filter"](e)}findWhere(e){return this.where(e,!0)}find(e,t){const n=Oe(e)?e:t=>t.matches(e);return this.models.find(n,t)}sort(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return Oe(t)&&(t=t.bind(this)),1===n||to(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this}pluck(e){return this.map(e+"")}fetch(e){const t=(e=Object.assign({parse:!0},e)).success,n=this,r=e.promise&&vc();return e.success=function(i){const s=e.reset?"reset":"set";n[s](i,e),t&&t.call(e.context,n,i,e),r&&r.resolve(),n.trigger("sync",n,i,e)},bc(this,e),r||this.sync("read",this,e)}create(e,t){const n=(t=t?$c(t):{}).wait,r=t.promise,i=r&&vc();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const s=this,o=t.success,a=t.error;return t.success=function(e,t,a){n&&s.add(e,a),o&&o.call(a.context,e,t,a),r&&i.resolve(e)},t.error=function(e,t,n){a&&a.call(n.context,e,t,n),r&&i.reject(t)},e.save(null,Object.assign(t,{promise:!1})),r?i:e}parse(e,t){return e}modelId(e){var t;return e[(null===(t=this.model.prototype)||void 0===t?void 0:t.idAttribute)||"id"]}values(){return new ku(this,Eu)}keys(){return new ku(this,Ou)}entries(){return new ku(this,Cu)}_reset(){this.models=[],this._byId={}}createModel(e,t){return new(0,this.model)(e,t)}_prepareModel(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?$c(t):{}).collection=this;const n=this.createModel(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),null):n}_removeModels(e,t){const n=[];for(let r=0;r<e.length;r++){const i=this.get(e[r]);if(!i)continue;const s=this.indexOf(i);this.models.splice(s,1),delete this._byId[i.cid];const o=this.modelId(i.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=s,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n}_isModel(e){return e instanceof ou}_addReference(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)}_removeReference(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)}_onModelEvent(e,t,n,r){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,r),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}constructor(e,t){super(),t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this._model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,Object.assign({silent:!0},t)),this[Symbol.iterator]=this.values}}const Eu=1,Ou=2,Cu=3;class ku{next(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===Eu)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===Ou?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}}[Symbol.iterator](){return this}constructor(e,t){this._collection=e,this._kind=t,this._index=0}}const Tu={Collection:$u,ElementView:Bn,EventEmitter:Ln,Model:ou,sync:Sc},Nu="object"==typeof self&&self.self===self&&self||"object"==typeof n.g&&n.g.global===n.g&&n.g;Tu.VERSION="0.0.1";const Mu=Nu.Skeletor;Tu.noConflict=function(){return Nu.Skeletor=Mu,this},Nu.Skeletor=Tu,t.Collection=$u,t.ElementView=Bn,t.EventEmitter=Ln,t.Model=ou,t.Storage=Ac,t.default=Tu,t.sync=Sc,Object.defineProperty(t,"__esModule",{value:!0})}(t)},1273:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function r(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,n,r){function i(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var s=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),n=i(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];s.push(r(t(c),n(c)))}}else for(var l in e)e.hasOwnProperty(l)&&s.push(r(l,e[l]));return s}function s(e,t,n,s){var o=this,a=o.ready().then((function(){return new Promise((function(r,s){var a,c=o._dbInfo,l=c.db.transaction(c.storeName,"readwrite"),u=l.objectStore(c.storeName);function d(e){var t=e.target||this;a=t.error||t.transaction.error,s(a)}l.oncomplete=function(){r(e)},l.onabort=l.onerror=function(e){s(a||e.target)},i(e,t,n,(function(e,t){null===t&&(t=void 0),u.put(t,e).onerror=d}))}))}));return r(a,s),a}function o(e,t,s,o){var a=this,c=new Promise((function(r,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var l="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",u=i(e,t,s,(function(e,t){return new Promise((function(r,i){n.serialize(t,(function(t,n){n?i(n):a.executeSql(l,[e,t],(function(){r()}),(function(e,t){i(t)}))}))}))}));Promise.all(u).then((function(){r(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return r(c,o),c}function a(e,t,n,s){var o=this,a=i(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return r(c,s),c}function c(e,t,n,r){var i=this,c=i.driver();return c===i.INDEXEDDB?s.call(i,e,t,n,r):c===i.WEBSQL?o.call(i,e,t,n,r):a.call(i,e,t,n,r)}function l(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return s.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var u=l(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=l,e.extendPrototypeResult=u,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(6691))},1318:(e,t,n)=>{var r=n(6557),i=n(4776),s=n(646),o=n(134),a=n(3884),c=n(152),l=n(6594);function u(){"use strict";var t=i(),n=t.m(u),d=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function h(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))}var f={throw:1,return:2,break:3,continue:3};function p(e){var t,n;return function(r){t||(t={stop:function(){return n(r.a,2)},catch:function(){return r.v},abrupt:function(e,t){return n(r.a,f[e],t)},delegateYield:function(e,i,s){return t.resultName=i,n(r.d,l(e),s)},finish:function(e){return n(r.f,e)}},n=function(e,n,i){r.p=t.prev,r.n=t.next;try{return e(n,i)}finally{t.next=r.n}}),t.resultName&&(t[t.resultName]=r.v,t.resultName=void 0),t.sent=r.v,t.next=r.n;try{return e.call(this,t)}finally{r.p=t.prev,r.n=t.next}}}return(e.exports=u=function(){return{wrap:function(e,n,r,i){return t.w(p(e),n,r,i&&i.reverse())},isGeneratorFunction:h,mark:t.m,awrap:function(e,t){return new r(e,t)},AsyncIterator:a,async:function(e,t,n,r,i){return(h(t)?o:s)(p(e),t,n,r,i)},keys:c,values:l}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=u,e.exports.__esModule=!0,e.exports.default=e.exports},1353:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1472:(e,t,n)=>{var r={"./af/LC_MESSAGES/converse.po":[5544,4267],"./ar/LC_MESSAGES/converse.po":[788,5743],"./be/LC_MESSAGES/converse.po":[9174,1437],"./bg/LC_MESSAGES/converse.po":[9088,6179],"./ca/LC_MESSAGES/converse.po":[6929,962],"./cs/LC_MESSAGES/converse.po":[4359,8252],"./da/LC_MESSAGES/converse.po":[1712,6963],"./de/LC_MESSAGES/converse.po":[7532,6311],"./el/LC_MESSAGES/converse.po":[6202,345],"./eo/LC_MESSAGES/converse.po":[7653,7494],"./es/LC_MESSAGES/converse.po":[8209,4202],"./eu/LC_MESSAGES/converse.po":[4147,2168],"./fa/LC_MESSAGES/converse.po":[4750,453],"./fi/LC_MESSAGES/converse.po":[6742,3613],"./fr/LC_MESSAGES/converse.po":[2889,3698],"./gl/LC_MESSAGES/converse.po":[2504,2787],"./he/LC_MESSAGES/converse.po":[5424,8227],"./hi/LC_MESSAGES/converse.po":[7140,799],"./hu/LC_MESSAGES/converse.po":[1520,9139],"./id/LC_MESSAGES/converse.po":[4326,4749],"./it/LC_MESSAGES/converse.po":[8854,6109],"./ja/LC_MESSAGES/converse.po":[762,3881],"./ko/LC_MESSAGES/converse.po":[6227,528],"./lt/LC_MESSAGES/converse.po":[8261,1462],"./mr/LC_MESSAGES/converse.po":[4632,507],"./nb/LC_MESSAGES/converse.po":[6529,9562],"./nl/LC_MESSAGES/converse.po":[347,4336],"./nl_BE/LC_MESSAGES/converse.po":[2361,290],"./oc/LC_MESSAGES/converse.po":[107,7576],"./pl/LC_MESSAGES/converse.po":[2993,7370],"./pt/LC_MESSAGES/converse.po":[3385,2546],"./pt_BR/LC_MESSAGES/converse.po":[3096,4315],"./ro/LC_MESSAGES/converse.po":[9576,1963],"./ru/LC_MESSAGES/converse.po":[6166,6733],"./si/LC_MESSAGES/converse.po":[8553,8714],"./sq/LC_MESSAGES/converse.po":[8785,4146],"./sv/LC_MESSAGES/converse.po":[6850,6345],"./ta/LC_MESSAGES/converse.po":[2608,5283],"./th/LC_MESSAGES/converse.po":[3161,3330],"./tr/LC_MESSAGES/converse.po":[9815,548],"./ug/LC_MESSAGES/converse.po":[1661,2894],"./uk/LC_MESSAGES/converse.po":[3689,8898],"./vi/LC_MESSAGES/converse.po":[358,221],"./zh_CN/LC_MESSAGES/converse.po":[5645,6550],"./zh_TW/LC_MESSAGES/converse.po":[5097,8986]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,19)))}i.keys=()=>Object.keys(r),i.id=1472,e.exports=i},1709:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1742:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1933:(e,t)=>{var n,r;r=function(e){"use strict";e=e||{};var t,n,r,i,s,o,a,c,l,u,d,h,f,p,m={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:!1,element:null,dataUrl:!1,win:window};(h={}).ff="undefined"!=typeof InstallTrigger,h.chrome=!!window.chrome,h.opera=!!window.opera||navigator.userAgent.indexOf("Opera")>=0,h.ie=!1,h.safari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,h.supported=h.chrome||h.ff||h.opera;var g=[];d=function(){},c=!1;var v={ready:function(){c=!0,v.reset(),d()},reset:function(){c&&(g=[],l=!1,u=!1,o.clearRect(0,0,i,r),o.drawImage(a,0,0,i,r),_.setIcon(s),window.clearTimeout(f),window.clearTimeout(void 0))},start:function(){if(c&&!u&&g.length>0){u=!0;var e=function(){["type","animation","bgColor","textColor","fontFamily","fontStyle"].forEach((function(e){e in g[0].options&&(t[e]=g[0].options[e])})),x.run(g[0].options,(function(){l=g[0],u=!1,g.length>0&&(g.shift(),v.start())}),!1)};l?x.run(l.options,(function(){e()}),!0):e()}}},y={},b=function(e){return e.n="number"==typeof e.n?Math.abs(0|e.n):e.n,e.x=i*e.x,e.y=r*e.y,e.w=i*e.w,e.h=r*e.h,e.len=(""+e.n).length,e};y.circle=function(e){var n=!1;2===(e=b(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w,n=!0):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w,n=!0),o.clearRect(0,0,i,r),o.drawImage(a,0,0,i,r),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.85:1))+"px "+t.fontFamily,o.textAlign="center",n?(o.moveTo(e.x+e.w/2,e.y),o.lineTo(e.x+e.w-e.h/2,e.y),o.quadraticCurveTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h/2),o.lineTo(e.x+e.w,e.y+e.h-e.h/2),o.quadraticCurveTo(e.x+e.w,e.y+e.h,e.x+e.w-e.h/2,e.y+e.h),o.lineTo(e.x+e.h/2,e.y+e.h),o.quadraticCurveTo(e.x,e.y+e.h,e.x,e.y+e.h-e.h/2),o.lineTo(e.x,e.y+e.h/2),o.quadraticCurveTo(e.x,e.y,e.x+e.h/2,e.y)):o.arc(e.x+e.w/2,e.y+e.h/2,e.h/2,0,2*Math.PI),o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fill(),o.closePath(),o.beginPath(),o.stroke(),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()},y.rectangle=function(e){2===(e=b(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w),o.clearRect(0,0,i,r),o.drawImage(a,0,0,i,r),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.9:1))+"px "+t.fontFamily,o.textAlign="center",o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fillRect(e.x,e.y,e.w,e.h),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()};var _={};function w(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,r){return t+t+n+n+r+r}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!!t&&{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}function S(e,t){var n,r={};for(n in e)r[n]=e[n];for(n in t)r[n]=t[n];return r}_.getIcons=function(){var e=[];return t.element?e=[t.element]:t.elementId?(e=[p.getElementById(t.elementId)])[0].setAttribute("href",e[0].getAttribute("src")):0===(e=function(){for(var e=[],t=p.getElementsByTagName("head")[0].getElementsByTagName("link"),n=0;n<t.length;n++)/(^|\s)icon(\s|$)/i.test(t[n].getAttribute("rel"))&&e.push(t[n]);return e}()).length&&((e=[p.createElement("link")])[0].setAttribute("rel","icon"),p.getElementsByTagName("head")[0].appendChild(e[0])),e.forEach((function(e){e.setAttribute("type","image/png")})),e},_.setIcon=function(e){var t=e.toDataURL("image/png");_.setIconSrc(t)},_.setIconSrc=function(e){if(t.dataUrl&&t.dataUrl(e),t.element)t.element.setAttribute("href",e),t.element.setAttribute("src",e);else if(t.elementId){var r=p.getElementById(t.elementId);r.setAttribute("href",e),r.setAttribute("src",e)}else if(h.ff||h.opera){var i=n[n.length-1],s=p.createElement("link");n=[s],h.opera&&s.setAttribute("rel","icon"),s.setAttribute("rel","icon"),s.setAttribute("type","image/png"),p.getElementsByTagName("head")[0].appendChild(s),s.setAttribute("href",e),i.parentNode&&i.parentNode.removeChild(i)}else n.forEach((function(t){t.setAttribute("href",e)}))};var x={duration:40,types:{}};return x.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],x.run=function(e,n,r,i){var o=x.types[p.hidden||p.msHidden||p.webkitHidden||p.mozHidden?"none":t.animation];i=!0===r?void 0!==i?i:o.length-1:void 0!==i?i:0,n=n||function(){},i<o.length&&i>=0?(y[t.type](S(e,o[i])),f=setTimeout((function(){r?i-=1:i+=1,x.run(e,n,r,i)}),x.duration),_.setIcon(s)):n()},function(){(t=S(m,e)).bgColor=w(t.bgColor),t.textColor=w(t.textColor),t.position=t.position.toLowerCase(),t.animation=x.types[""+t.animation]?t.animation:m.animation,p=t.win.document;var c=t.position.indexOf("up")>-1,l=t.position.indexOf("left")>-1;if(c||l)for(var u in x.types)for(var d=0;d<x.types[u].length;d++){var h=x.types[u][d];c&&(h.y<.6?h.y=h.y-.4:h.y=h.y-2*h.y+(1-h.w)),l&&(h.x<.6?h.x=h.x-.4:h.x=h.x-2*h.x+(1-h.h)),x.types[u][d]=h}t.type=y[""+t.type]?t.type:m.type,n=_.getIcons(),s=document.createElement("canvas"),a=document.createElement("img");var f=n[n.length-1];f.hasAttribute("href")?(a.setAttribute("crossOrigin","anonymous"),a.onload=function(){r=a.height>0?a.height:32,i=a.width>0?a.width:32,s.height=r,s.width=i,o=s.getContext("2d"),v.ready()},a.setAttribute("src",f.getAttribute("href"))):(r=32,i=32,a.height=r,a.width=i,s.height=r,s.width=i,o=s.getContext("2d"),v.ready())}(),{badge:function(e,t){t=("string"==typeof t?{animation:t}:t)||{},d=function(){try{if("number"==typeof e?e>0:""!==e){var n={type:"badge",options:{n:e}};if("animation"in t&&x.types[""+t.animation]&&(n.options.animation=""+t.animation),"type"in t&&y[""+t.type]&&(n.options.type=""+t.type),["bgColor","textColor"].forEach((function(e){e in t&&(n.options[e]=w(t[e]))})),["fontStyle","fontFamily"].forEach((function(e){e in t&&(n.options[e]=t[e])})),g.push(n),g.length>100)throw new Error("Too many badges requests in queue.");v.start()}else v.reset()}catch(e){throw new Error("Error setting badge. Message: "+e.message)}},c&&d()},setOpt:function(e,n){var r=e;null==n&&"[object Object]"==Object.prototype.toString.call(e)||((r={})[e]=n);for(var i=Object.keys(r),s=0;s<i.length;s++)"bgColor"==i[s]||"textColor"==i[s]?t[i[s]]=w(r[i[s]]):t[i[s]]=r[i[s]];g.push(l),v.start()},reset:v.reset,browser:{supported:h.supported}}},void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)},1946:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1950:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2470:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2579:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2778:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2852:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2978:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",i="second",s="minute",o="hour",a="day",c="week",l="month",u="quarter",d="year",h="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},y={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+v(r,2,"0")+":"+v(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,l),s=n-i<0,o=t.clone().add(r+(s?-1:1),l);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:d,w:c,d:a,D:h,h:o,m:s,s:i,ms:r,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",_={};_[b]=g;var w="$isDayjsObject",S=function(e){return e instanceof $||!(!e||!e[w])},x=function e(t,n,r){var i;if(!t)return b;if("string"==typeof t){var s=t.toLowerCase();_[s]&&(i=s),n&&(_[s]=n,i=s);var o=t.split("-");if(!i&&o.length>1)return e(o[0])}else{var a=t.name;_[a]=t,i=a}return!r&&i&&(b=i),i||!r&&b},A=function(e,t){if(S(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new $(n)},j=y;j.l=x,j.i=S,j.w=function(e,t){return A(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var $=function(){function g(e){this.$L=x(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var v=g.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(j.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(p);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return j},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(e,t){var n=A(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return A(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<A(e)},v.$g=function(e,t,n){return j.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,r=!!j.u(t)||t,u=j.p(e),f=function(e,t){var i=j.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?i:i.endOf(a)},p=function(e,t){return j.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},m=this.$W,g=this.$M,v=this.$D,y="set"+(this.$u?"UTC":"");switch(u){case d:return r?f(1,0):f(31,11);case l:return r?f(1,g):f(0,g+1);case c:var b=this.$locale().weekStart||0,_=(m<b?m+7:m)-b;return f(r?v-_:v+(6-_),g);case a:case h:return p(y+"Hours",0);case o:return p(y+"Minutes",1);case s:return p(y+"Seconds",2);case i:return p(y+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=j.p(e),u="set"+(this.$u?"UTC":""),f=(n={},n[a]=u+"Date",n[h]=u+"Date",n[l]=u+"Month",n[d]=u+"FullYear",n[o]=u+"Hours",n[s]=u+"Minutes",n[i]=u+"Seconds",n[r]=u+"Milliseconds",n)[c],p=c===a?this.$D+(t-this.$W):t;if(c===l||c===d){var m=this.clone().set(h,1);m.$d[f](p),m.init(),this.$d=m.set(h,Math.min(this.$D,m.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[j.p(e)]()},v.add=function(r,u){var h,f=this;r=Number(r);var p=j.p(u),m=function(e){var t=A(f);return j.w(t.date(t.date()+Math.round(e*r)),f)};if(p===l)return this.set(l,this.$M+r);if(p===d)return this.set(d,this.$y+r);if(p===a)return m(1);if(p===c)return m(7);var g=(h={},h[s]=t,h[o]=n,h[i]=e,h)[p]||1,v=this.$d.getTime()+r*g;return j.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=j.z(this),s=this.$H,o=this.$m,a=this.$M,c=n.weekdays,l=n.months,u=n.meridiem,d=function(e,n,i,s){return e&&(e[n]||e(t,r))||i[n].slice(0,s)},h=function(e){return j.s(s%12||12,e,"0")},p=u||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(m,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return j.s(t.$y,4,"0");case"M":return a+1;case"MM":return j.s(a+1,2,"0");case"MMM":return d(n.monthsShort,a,l,3);case"MMMM":return d(l,a);case"D":return t.$D;case"DD":return j.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(n.weekdaysMin,t.$W,c,2);case"ddd":return d(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(s);case"HH":return j.s(s,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return p(s,o,!0);case"A":return p(s,o,!1);case"m":return String(o);case"mm":return j.s(o,2,"0");case"s":return String(t.$s);case"ss":return j.s(t.$s,2,"0");case"SSS":return j.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,h,f){var p,m=this,g=j.p(h),v=A(r),y=(v.utcOffset()-this.utcOffset())*t,b=this-v,_=function(){return j.m(m,v)};switch(g){case d:p=_()/12;break;case l:p=_();break;case u:p=_()/3;break;case c:p=(b-y)/6048e5;break;case a:p=(b-y)/864e5;break;case o:p=b/n;break;case s:p=b/t;break;case i:p=b/e;break;default:p=b}return f?p:j.a(p)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return _[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=x(e,t,!0);return r&&(n.$L=r),n},v.clone=function(){return j.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),E=$.prototype;return A.prototype=E,[["$ms",r],["$s",i],["$m",s],["$H",o],["$W",a],["$M",l],["$y",d],["$D",h]].forEach((function(e){E[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),A.extend=function(e,t){return e.$i||(e(t,$,A),e.$i=!0),A},A.locale=x,A.isDayjs=S,A.unix=function(e){return A(1e3*e)},A.en=_[b],A.Ls=_,A.p={},A}()},2995:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3002:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t="localforage-driver-memory";function n(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}var i=/^~~local_forage_type~([^~]+)~/,s=9,o=s+4,a=Object.prototype.toString;function c(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var r=new ArrayBuffer(t),i=new Uint8Array(r),s=0,o=0;s<n;s+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+2]),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|l>>2,i[o++]=(3&l)<<6|63&u}return r}function l(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[r]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[r])<<4|t[r+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[r+1])<<2|t[r+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function u(e,t){var n="";if(e&&(n=a.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===a.call(e.buffer))){var r=void 0,i="__lfsc__:";e instanceof ArrayBuffer?(r=e,i+="arbf"):(r=e.buffer,"[object Int8Array]"===n?i+="si08":"[object Uint8Array]"===n?i+="ui08":"[object Uint8ClampedArray]"===n?i+="uic8":"[object Int16Array]"===n?i+="si16":"[object Uint16Array]"===n?i+="ur16":"[object Int32Array]"===n?i+="si32":"[object Uint32Array]"===n?i+="ui32":"[object Float32Array]"===n?i+="fl32":"[object Float64Array]"===n?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+l(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+l(this.result);t("__lfsc__:blob"+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function d(e){if("__lfsc__:"!==e.substring(0,s))return JSON.parse(e);var t,n=e.substring(o),a=e.substring(s,o);if("blob"===a&&i.test(n)){var l=n.match(i);t=l[1],n=n.substring(l[0].length)}var u=c(n);switch(a){case"arbf":return u;case"blob":return r([u],{type:t});case"si08":return new Int8Array(u);case"ui08":return new Uint8Array(u);case"uic8":return new Uint8ClampedArray(u);case"si16":return new Int16Array(u);case"ur16":return new Uint16Array(u);case"si32":return new Int32Array(u);case"ui32":return new Uint32Array(u);case"fl32":return new Float32Array(u);case"fl64":return new Float64Array(u);default:throw new Error("Unkown type: "+a)}}function h(e){var t,r;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var i=e instanceof Date?new Date(e):e.constructor();try{for(var s=n(Object.keys(e)),o=s.next();!o.done;o=s.next()){var a=o.value;Object.prototype.hasOwnProperty.call(e,a)&&(e.isActiveClone=null,i[a]=h(e[a]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i}function f(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function p(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function g(e,t){var n=this;if(t=m.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(f(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function v(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var y={bufferToString:l,deserialize:d,serialize:u,stringToBuffer:c},b={},_=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return b[t]||(b[t]=new e(t)),b[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete b[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function w(e){var t=e?h(e):{},n=f(t,this._defaultConfig),r=_.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=y,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=r,Promise.resolve()}function S(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return p(n,e),n}function x(e,t){var n=g.apply(this,arguments),r=n.promise,i=n.callback;return p(r.then((function(e){_.resolve(e).drop()})),i),r}function A(e,t){var n=this;e=v(e);var r=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return p(r,t),r}function j(e,t){var n=this,r=this.ready().then((function(){for(var t=n._dbInfo.mStore,r=t.keys(),i=0;i<r.length;i++){var s=t.get(r[i]);if(s&&(s=n._dbInfo.serializer.deserialize(s)),void 0!==(s=e(s,r[i],i+1)))return s}}));return p(r,t),r}function $(e,t){var n=this,r=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return p(r,t),r}function E(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return p(n,e),n}function O(e){var t=this.keys().then((function(e){return e.length}));return p(t,e),t}function C(e,t){var n=this;e=v(e);var r=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return p(r,t),r}function k(e,t,n){var r=this;e=v(e);var i=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(i,s){r._dbInfo.serializer.serialize(t,(function(t,o){if(o)s(o);else try{r._dbInfo.mStore.set(e,t),i(n)}catch(e){s(e)}}))}))}));return p(i,n),i}var T=!0;e._support=T,e._driver=t,e._initStorage=w,e.clear=S,e.dropInstance=x,e.getItem=A,e.iterate=j,e.key=$,e.keys=E,e.length=O,e.removeItem=C,e.setItem=k,Object.defineProperty(e,"__esModule",{value:!0})}(t)},3013:(e,t,n)=>{var r=n(1318)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},3028:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readBits=t.readArray=t.readUnsigned=t.readString=t.peekBytes=t.readBytes=t.peekByte=t.readByte=t.buildStream=void 0;t.buildStream=function(e){return{data:e,pos:0}};var n=function(){return function(e){return e.data[e.pos++]}};t.readByte=n;t.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){return t.data[t.pos+e]}};var r=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};t.readBytes=r;t.peekBytes=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}};t.readString=function(e){return function(t){return Array.from(r(e)(t)).map((function(e){return String.fromCharCode(e)})).join("")}};t.readUnsigned=function(e){return function(t){var n=r(2)(t);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};t.readArray=function(e,t){return function(n,i,s){for(var o="function"==typeof t?t(n,i,s):t,a=r(e),c=new Array(o),l=0;l<o;l++)c[l]=a(n);return c}};t.readBits=function(e){return function(t){for(var n=function(e){return e.data[e.pos++]}(t),r=new Array(8),i=0;i<8;i++)r[7-i]=!!(n&1<<i);return Object.keys(e).reduce((function(t,n){var i=e[n];return i.length?t[n]=function(e,t,n){for(var r=0,i=0;i<n;i++)r+=e[t+i]&&Math.pow(2,n-i-1);return r}(r,i.index,i.length):t[n]=r[i.index],t}),{})}}},3083:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loop=t.conditional=t.parse=void 0;t.parse=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;if(Array.isArray(n))n.forEach((function(n){return e(t,n,r,i)}));else if("function"==typeof n)n(t,r,i,e);else{var s=Object.keys(n)[0];Array.isArray(n[s])?(i[s]={},e(t,n[s],r,i[s])):i[s]=n[s](t,r,i,e)}return r};t.conditional=function(e,t){return function(n,r,i,s){t(n,r,i)&&s(n,e,r,i)}};t.loop=function(e,t){return function(n,r,i,s){for(var o=[],a=n.pos;t(n,r,i);){var c={};if(s(n,e,r,c),n.pos===a)break;a=n.pos,o.push(c)}return o}}},3195:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3241:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var u=[].concat(e[l]);r&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),t.push(u))}},t}},3363:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3370:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3403:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3411:e=>{window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImageElement=function(e,t){return new Promise((function(n,r){e.addEventListener("load",(function(){n(e)}),!1),e.addEventListener("error",(function(e){r(e)}),!1),e.src=t}))},t.resize=function(e,t,n,r){if(!n&&!r)return{currentWidth:e,currentHeight:t};var i=e/t,s=void 0,o=void 0;return i>n/r?o=(s=Math.min(e,n))/i:s=(o=Math.min(t,r))*i,{width:s,height:o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64ToFile=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=window.atob(e),r=[],i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return new window.Blob([new Uint8Array(r)],{type:t})},t.imageToCanvas=function(e,t,n,r){var i=document.createElement("canvas"),s=i.getContext("2d");if(i.width=t,i.height=n,!r||r>8)return s.drawImage(e,0,0,i.width,i.height),i;switch(r>4&&(i.width=n,i.height=t),r){case 2:s.translate(t,0),s.scale(-1,1);break;case 3:s.translate(t,n),s.rotate(Math.PI);break;case 4:s.translate(0,n),s.scale(1,-1);break;case 5:s.rotate(.5*Math.PI),s.scale(1,-1);break;case 6:s.rotate(.5*Math.PI),s.translate(0,-n);break;case 7:s.rotate(.5*Math.PI),s.translate(t,-n),s.scale(-1,1);break;case 8:s.rotate(-.5*Math.PI),s.translate(-t,0)}return r>4?s.drawImage(e,0,0,i.height,i.width):s.drawImage(e,0,0,i.width,i.height),i},t.canvasToBlob=function(e,t){return new Promise((function(n,r){e.toBlob((function(e){n(e)}),"image/jpeg",t)}))},t.size=function(e){return{kB:.001*e,MB:1e-6*e}},t.blobToBase64=function(e){return new Promise((function(t,n){var r=new window.FileReader;r.addEventListener("load",(function(e){t(e.target.result)}),!1),r.addEventListener("error",(function(e){n(e)}),!1),r.readAsDataURL(e)}))}},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractOrientation=function(e){return new Promise((function(t,n){var r=new window.FileReader;r.onload=function(e){var n=new DataView(e.target.result);65496!==n.getUint16(0,!1)&&t(-2);for(var r=n.byteLength,i=2;i<r;){var s=n.getUint16(i,!1);if(i+=2,65505===s){1165519206!==n.getUint32(i+=2,!1)&&t(-1);var o=18761===n.getUint16(i+=6,!1);i+=n.getUint32(i+4,o);var a=n.getUint16(i,o);i+=2;for(var c=0;c<a;c++)274===n.getUint16(i+12*c,o)&&t(n.getUint16(i+12*c+8,o))}else{if(65280&~s)break;i+=n.getUint16(i,!1)}}t(-1)},r.readAsArrayBuffer(e.slice(0,65536))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=(r=n(2))&&r.__esModule?r:{default:r},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),a=n(0),c=n(1);function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(i,s){try{var o=t[i](s),a=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(a).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(a)}("next")}))}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.name=t.name,this.type=t.type,this.size=t.size}return s(e,[{key:"setData",value:function(e){this.data=e,this.size=e.size,this.type=e.type}},{key:"_calculateOrientation",value:function(){var e=l(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.extractOrientation)(this.data);case 2:t=e.sent,this.orientation=t;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=l(i.default.mark((function e(){var t,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._calculateOrientation();case 2:return t=URL.createObjectURL(this.data),n=new window.Image,e.next=6,(0,a.loadImageElement)(n,t);case 6:URL.revokeObjectURL(t),this._img=n,this.width=n.naturalWidth,this.height=n.naturalHeight;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCanvas",value:function(e,t,n){return void 0!==n?(0,c.imageToCanvas)(this._img,e,t,n):(0,c.imageToCanvas)(this._img,e,t,this.orientation)}}]),e}();t.default=u,e.exports=t.default},function(e,t){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag",l="object"==typeof e,u=t.regeneratorRuntime;if(u)l&&(e.exports=u);else{(u=t.regeneratorRuntime=l?e.exports:{}).wrap=_;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",m={},g={};g[o]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(T([])));y&&y!==r&&i.call(y,o)&&(g=y);var b=A.prototype=S.prototype=Object.create(g);x.prototype=b.constructor=A,A.constructor=x,A[c]=x.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,A):(e.__proto__=A,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},u.awrap=function(e){return{__await:e}},j($.prototype),$.prototype[a]=function(){return this},u.AsyncIterator=$,u.async=function(e,t,n,r){var i=new $(_(e,t,n,r));return u.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j(b),b[c]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},u.values=T,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return a.type="throw",a.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function _(e,t,n,r){var i=t&&t.prototype instanceof S?t:S,s=Object.create(i.prototype),o=new k(r||[]);return s._invoke=function(e,t,n){var r=d;return function(i,s){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw s;return N()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=E(o,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=w(e,t,n);if("normal"===c.type){if(r=n.done?p:h,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,o),s}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function S(){}function x(){}function A(){}function j(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function $(e){var t;this._invoke=function(n,r){function s(){return new Promise((function(t,s){!function t(n,r,s,o){var a=w(e[n],e,r);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,s,o)}),(function(e){t("throw",e,s,o)})):Promise.resolve(l).then((function(e){c.value=e,s(c)}),o)}o(a.arg)}(n,r,t,s)}))}return t=t?t.then(s,s):s()}}function E(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,E(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=w(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return s.next=s}}return{next:N}}function N(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,s=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(5),i)r.regeneratorRuntime=s;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(2)),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)),o=n(0),a=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(i,s){try{var o=t[i](s),a=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(a).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(a)}("next")}))}}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setOptions(t)}return i(e,[{key:"setOptions",value:function(e){var t={targetSize:1/0,quality:.75,minQuality:.5,qualityStepSize:.1,maxWidth:1920,maxHeight:1920,resize:!0,throwIfSizeNotReached:!1,autoRotate:!0},n=new Proxy(e,{get:function(e,n){return n in e?e[n]:t[n]}});this.options=n}},{key:"_compressFile",value:function(){var e=l(r.default.mark((function e(t){var n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new a.default(t),(i={}).start=window.performance.now(),i.quality=this.options.quality,i.startType=n.type,e.next=7,n.load();case 7:return e.next=9,this._compressImage(n,i);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_compressImage",value:function(){var e=l(r.default.mark((function e(t,n){var i,a,c,l,u;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.startWidth=t.width,n.startHeight=t.height,i=void 0,a=void 0,this.options.resize?(c=(0,o.resize)(t.width,t.height,this.options.maxWidth,this.options.maxHeight),i=c.width,a=c.height):(i=t.width,a=t.height),n.endWidth=i,n.endHeight=a,l=this.doAutoRotation?void 0:1,u=t.getCanvas(i,a,l),n.iterations=0,n.startSizeMB=s.size(t.size).MB,e.next=12,this._loopCompression(u,t,n);case 12:return n.endSizeMB=s.size(t.size).MB,n.sizeReducedInPercent=(n.startSizeMB-n.endSizeMB)/n.startSizeMB*100,n.end=window.performance.now(),n.elapsedTimeInSeconds=(n.end-n.start)/1e3,n.endType=t.type,e.abrupt("return",{photo:t,info:n});case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_loopCompression",value:function(){var e=l(r.default.mark((function e(t,n,i){var o;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.iterations++,e.t0=n,e.next=4,s.canvasToBlob(t,i.quality);case 4:if(e.t1=e.sent,e.t0.setData.call(e.t0,e.t1),1==i.iterations&&(n.width=i.endWidth,n.height=i.endHeight),!(s.size(n.size).MB>this.options.targetSize)){e.next=24;break}if(!(i.quality.toFixed(10)-.1<this.options.minQuality)){e.next=18;break}if(o="Couldn't compress image to target size while maintaining quality.\n        Target size: "+this.options.targetSize+"\n        Actual size: "+s.size(n.size).MB,this.options.throwIfSizeNotReached){e.next=14;break}console.error(o),e.next=15;break;case 14:throw new Error(o);case 15:case 24:return e.abrupt("return");case 18:return i.quality-=this.options.qualityStepSize,e.next=21,this._loopCompression(t,n,i);case 21:return e.abrupt("return",e.sent);case 22:e.next=25;break;case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setAutoRotate",value:function(){var t=l(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.automaticRotationFeatureTest();case 2:n=t.sent,this.doAutoRotation=this.options.autoRotate&&!n;case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"compress",value:function(){var e=l(r.default.mark((function e(t){var n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setAutoRotate();case 2:return e.abrupt("return",Promise.all(t.map((function(e){return n._compressFile(e)}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"blobToBase64",value:function(){var e=l(r.default.mark((function e(){var t=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.blobToBase64.apply(s,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadImageElement",value:function(){var e=l(r.default.mark((function e(){var t=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.loadImageElement.apply(void 0,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"automaticRotationFeatureTest",value:function(){return new Promise((function(e){var t=new Image;t.onload=function(){var n=1===t.width&&2===t.height;e(n)},t.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="}))}}]),e}();t.default=u,e.exports=t.default}])},3414:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3486:e=>{function t(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,s){var o=e.apply(n,r);function a(e){t(o,i,s,a,c,"next",e)}function c(e){t(o,i,s,a,c,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},3557:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3796:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3884:(e,t,n)=>{var r=n(6557),i=n(7999);e.exports=function e(t,n){function s(e,i,o,a){try{var c=t[e](i),l=c.value;return l instanceof r?n.resolve(l.v).then((function(e){s("next",e,o,a)}),(function(e){s("throw",e,o,a)})):n.resolve(l).then((function(e){c.value=e,o(c)}),(function(e){return s("throw",e,o,a)}))}catch(e){a(e)}}var o;this.next||(i(e.prototype),i(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),i(this,"_invoke",(function(e,t,r){function i(){return new n((function(t,n){s(e,r,t,n)}))}return o=o?o.then(i,i):i()}),!0)},e.exports.__esModule=!0,e.exports.default=e.exports},3952:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3968:function(e,t){!function(n,r){var i=Array.prototype,s=Object.prototype,o=i.slice,a=s.hasOwnProperty,c=i.forEach,l={},u={forEach:function(e,t,n){var r,i,s;if(null!==e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e)===l)return}else for(s in e)if(a.call(e,s)&&t.call(n,e[s],s,e)===l)return},extend:function(e){return this.forEach(o.call(arguments,1),(function(t){for(var n in t)e[n]=t[n]})),e}},d=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=u.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return d.PF.compile(e||"nplurals=2; plural=(n != 1);")}function f(e,t){this._key=e,this._i18n=t}d.context_delimiter=String.fromCharCode(4),u.extend(f.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?d.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),u.extend(d.prototype,{translate:function(e){return new f(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,r,r,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,r,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,r,t)},ngettext:function(e,t,n){return this.dcnpgettext.call(this,r,r,e,t,n)},dngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,r,t,n,i)},dcngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,r,t,n,i)},pgettext:function(e,t){return this.dcnpgettext.call(this,r,e,t)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,t,n,i){return this.dcnpgettext.call(this,r,e,t,n,i)},dnpgettext:function(e,t,n,r,i){return this.dcnpgettext.call(this,e,t,n,r,i)},dcnpgettext:function(e,t,n,r,i){var s;if(r=r||n,e=e||this._textdomain,!this.options)return(s=new d).dcnpgettext.call(s,void 0,void 0,n,r,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");var o,a,c,l=t?t+d.context_delimiter+n:n,u=this.options.locale_data,f=u[e],p=(u.messages||this.defaults.locale_data.messages)[""],m=f[""].plural_forms||f[""]["Plural-Forms"]||f[""]["plural-forms"]||p.plural_forms||p["Plural-Forms"]||p["plural-forms"];if(void 0===i)c=0;else{if("number"!=typeof i&&(i=parseInt(i,10),isNaN(i)))throw new Error("The number that was passed in is not a number.");c=h(m)(i)}if(!f)throw new Error("No domain named `"+e+"` could be found.");return!(o=f[l])||c>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(l,e),a=[n,r],!0===this.options.debug&&console.log(a[h(m)(i)]),a[h()(i)]):(a=o[c])||(a=[n,r])[h()(i)]}});var p,m,g=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var i,s,o,a,c,l,u,d=1,h=n.length,f="",p=[];for(s=0;s<h;s++)if("string"===(f=e(n[s])))p.push(n[s]);else if("array"===f){if((a=n[s])[2])for(i=r[d],o=0;o<a[2].length;o++){if(!i.hasOwnProperty(a[2][o]))throw g('[sprintf] property "%s" does not exist',a[2][o]);i=i[a[2][o]]}else i=a[1]?r[a[1]]:r[d++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw g("[sprintf] expecting number but found %s",e(i));switch(null==i&&(i=""),a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,l=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(i).length,c=a[6]?t(l,u):"",p.push(a[5]?i+c:c+i)}return p.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){i|=1;var s=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(s.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))s.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";s.push(a[1])}n[2]=s}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}();d.parse_plural=function(e,t){return e=e.replace(/n/g,t),d.parse_expression(e)},d.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?function(e,t){return t.unshift(e),g.apply(null,t)}(e,[].slice.call(t)):g.apply(this,[].slice.call(arguments))},d.prototype.sprintf=function(){return d.sprintf.apply(this,arguments)},(d.PF={}).parse=function(e){var t=d.PF.extractPluralExpr(e);return d.PF.parser.parse.call(d.PF.parser,t)},d.PF.compile=function(e){var t=d.PF.parse(e);return function(e){return!0===(n=d.PF.interpreter(t)(e))?1:n||0;var n}},d.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return d.PF.interpreter(e.expr)(t);case"TERNARY":return d.PF.interpreter(e.expr)(t)?d.PF.interpreter(e.truthy)(t):d.PF.interpreter(e.falsey)(t);case"OR":return d.PF.interpreter(e.left)(t)||d.PF.interpreter(e.right)(t);case"AND":return d.PF.interpreter(e.left)(t)&&d.PF.interpreter(e.right)(t);case"LT":return d.PF.interpreter(e.left)(t)<d.PF.interpreter(e.right)(t);case"GT":return d.PF.interpreter(e.left)(t)>d.PF.interpreter(e.right)(t);case"LTE":return d.PF.interpreter(e.left)(t)<=d.PF.interpreter(e.right)(t);case"GTE":return d.PF.interpreter(e.left)(t)>=d.PF.interpreter(e.right)(t);case"EQ":return d.PF.interpreter(e.left)(t)==d.PF.interpreter(e.right)(t);case"NEQ":return d.PF.interpreter(e.left)(t)!=d.PF.interpreter(e.right)(t);case"MOD":return d.PF.interpreter(e.left)(t)%d.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},d.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,n=/nplurals\=(\d+);/,r=e.match(n);if(!(r.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(r[1],!((t=(e=e.replace(n,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},d.PF.parser=(p={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,n,r,i,s,o){var a=s.length-1;switch(i){case 1:return{type:"GROUP",expr:s[a-1]};case 2:this.$={type:"TERNARY",expr:s[a-4],truthy:s[a-2],falsey:s[a]};break;case 3:this.$={type:"OR",left:s[a-2],right:s[a]};break;case 4:this.$={type:"AND",left:s[a-2],right:s[a]};break;case 5:this.$={type:"LT",left:s[a-2],right:s[a]};break;case 6:this.$={type:"LTE",left:s[a-2],right:s[a]};break;case 7:this.$={type:"GT",left:s[a-2],right:s[a]};break;case 8:this.$={type:"GTE",left:s[a-2],right:s[a]};break;case 9:this.$={type:"NEQ",left:s[a-2],right:s[a]};break;case 10:this.$={type:"EQ",left:s[a-2],right:s[a]};break;case 11:this.$={type:"MOD",left:s[a-2],right:s[a]};break;case 12:this.$={type:"GROUP",expr:s[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],r=[null],i=[],s=this.table,o="",a=0,c=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;function d(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}i.push(u),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,f,p,m,g,v,y,b,_,w,S={};;){if(p=n[n.length-1],this.defaultActions[p]?m=this.defaultActions[p]:(null==h&&(h=d()),m=s[p]&&s[p][h]),void 0===m||!m.length||!m[0]){if(!l){for(v in _=[],s[p])this.terminals_[v]&&v>2&&_.push("'"+this.terminals_[v]+"'");var x="";x=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:_})}if(3==l){if(1==h)throw new Error(x||"Parsing halted.");c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,u=this.lexer.yylloc,h=d()}for(;!(2..toString()in s[p]);){if(0==p)throw new Error(x||"Parsing halted.");w=1,n.length=n.length-2*w,r.length=r.length-w,i.length=i.length-w,p=n[n.length-1]}f=h,h=2,m=s[p=n[n.length-1]]&&s[p][2],l=3}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+h);switch(m[0]){case 1:n.push(h),r.push(this.lexer.yytext),i.push(this.lexer.yylloc),n.push(m[1]),h=null,f?(h=f,f=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,u=this.lexer.yylloc,l>0&&l--);break;case 2:if(y=this.productions_[m[1]][1],S.$=r[r.length-y],S._$={first_line:i[i.length-(y||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(y||1)].first_column,last_column:i[i.length-1].last_column},void 0!==(g=this.performAction.call(S,o,c,a,this.yy,m[1],r,i)))return g;y&&(n=n.slice(0,-1*y*2),r=r.slice(0,-1*y),i=i.slice(0,-1*y)),n.push(this.productions_[m[1]][0]),r.push(S.$),i.push(S._$),b=s[n[n.length-2]][n[n.length-1]],n.push(b);break;case 3:return!0}}return!0}},m=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),r=0;r<n.length;r++)if(e=this._input.match(this.rules[n[r]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,n[r],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,n,r){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}};return e}(),p.lexer=m,p),e.exports&&(t=e.exports=d),t.Jed=d}()},4117:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4399:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4529:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lzw=void 0;t.lzw=function(e,t,n){var r,i,s,o,a,c,l,u,d,h,f,p,m,g,v,y,b=4096,_=n,w=new Array(n),S=new Array(b),x=new Array(b),A=new Array(4097);for(a=(i=1<<(h=e))+1,r=i+2,l=-1,s=(1<<(o=h+1))-1,u=0;u<i;u++)S[u]=0,x[u]=u;for(f=p=m=g=v=y=0,d=0;d<_;){if(0===g){if(p<o){f+=t[y]<<p,p+=8,y++;continue}if(u=f&s,f>>=o,p-=o,u>r||u==a)break;if(u==i){s=(1<<(o=h+1))-1,r=i+2,l=-1;continue}if(-1==l){A[g++]=x[u],l=u,m=u;continue}for(c=u,u==r&&(A[g++]=m,u=l);u>i;)A[g++]=x[u],u=S[u];m=255&x[u],A[g++]=m,r<b&&(S[r]=l,x[r]=m,0===(++r&s)&&r<b&&(o++,s+=r)),l=c}g--,w[v++]=A[g],d++}for(d=v;d<_;d++)w[d]=0;return w}},4563:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4641:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4647:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4659:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4734:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4776:(e,t,n)=>{var r=n(7999);function i(){var t,n,s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.toStringTag||"@@toStringTag";function c(e,i,s,o){var a=i&&i.prototype instanceof u?i:u,c=Object.create(a.prototype);return r(c,"_invoke",function(e,r,i){var s,o,a,c=0,u=i||[],d=!1,h={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,a=t,h.n=n,l}};function f(e,r){for(o=e,a=r,n=0;!d&&c&&!i&&n<u.length;n++){var i,s=u[n],f=h.p,p=s[2];e>3?(i=p===r)&&(a=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((i=e<2&&f<s[1])?(o=0,h.v=r,h.n=s[1]):f<p&&(i=e<3||s[0]>r||r>p)&&(s[4]=e,s[5]=r,h.n=p,o=0))}if(i||e>1)return l;throw d=!0,r}return function(i,u,p){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,p),o=u,a=p;(n=o<2?t:a)||!d;){s||(o?o<3?(o>1&&(h.n=-1),f(o,a)):h.n=a:h.v=a);try{if(c=2,s){if(o||(i="next"),n=s[i]){if(!(n=n.call(s,a)))throw TypeError("iterator result is not an object");if(!n.done)return n;a=n.value,o<2&&(o=0)}else 1===o&&(n=s.return)&&n.call(s),o<2&&(a=TypeError("The iterator does not provide a '"+i+"' method"),o=1);s=t}else if((n=(d=h.n<0)?a:e.call(r,h))!==l)break}catch(e){s=t,o=1,a=e}finally{c=1}}return{value:n,done:d}}}(e,s,o),!0),c}var l={};function u(){}function d(){}function h(){}n=Object.getPrototypeOf;var f=[][o]?n(n([][o]())):(r(n={},o,(function(){return this})),n),p=h.prototype=u.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,r(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return d.prototype=h,r(p,"constructor",h),r(h,"constructor",d),d.displayName="GeneratorFunction",r(h,a,"GeneratorFunction"),r(p),r(p,a,"Generator"),r(p,o,(function(){return this})),r(p,"toString",(function(){return"[object Generator]"})),(e.exports=i=function(){return{w:c,m}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},4842:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5056:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},5072:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var c=e[a],l=r.base?c[0]+r.base:c[0],u=s[l]||0,d="".concat(l," ").concat(u);s[l]=u+1;var h=n(d),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)t[h].references++,t[h].updater(f);else{var p=i(f,r);r.byIndex=a,t.splice(a,0,{identifier:d,updater:p,references:1})}o.push(d)}return o}function i(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var c=r(e,i),l=0;l<s.length;l++){var u=n(s[l]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=c}}},5186:(e,t,n)=>{"use strict";var r=n(7983);t.A=void 0;var i=(0,r(n(5723)).default)("webExtensionLocalStorage","local");t.A=i},5190:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5235:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5307:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),s="/*# ".concat(i," */");return[t].concat([s]).join("\n")}return[t].join("\n")}},5357:(e,t,n)=>{var r;!function(i){var s,o,a,c,l,u,d,h,f,p,m,g,v,y,b,_,w,S,x,A="sizzle"+1*new Date,j=i.document,$=0,E=0,O=he(),C=he(),k=he(),T=he(),N=function(e,t){return e===t&&(m=!0),0},M={}.hasOwnProperty,I=[],P=I.pop,D=I.push,R=I.push,z=I.slice,L=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},U="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",F="(?:\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\["+B+"*("+F+")(?:"+B+"*([*^$|!~]?=)"+B+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+B+"*\\]",H=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",G=new RegExp(B+"+","g"),W=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),V=new RegExp("^"+B+"*,"+B+"*"),K=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),J=new RegExp(B+"|>"),Y=new RegExp(H),X=new RegExp("^"+F+"$"),Q={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+U+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,ne=/^[^{]+\{\s*\[native \w/,re=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ie=/[+~]/,se=new RegExp("\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},le=function(){g()},ue=Ae((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{R.apply(I=z.call(j.childNodes),j.childNodes),I[j.childNodes.length].nodeType}catch(e){R={apply:I.length?function(e,t){D.apply(e,z.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function de(e,t,n,r){var i,s,a,c,l,d,f,p=t&&t.ownerDocument,m=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==m&&9!==m&&11!==m)return n;if(!r&&(g(t),t=t||v,b)){if(11!==m&&(l=re.exec(e)))if(i=l[1]){if(9===m){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(p&&(a=p.getElementById(i))&&x(t,a)&&a.id===i)return n.push(a),n}else{if(l[2])return R.apply(n,t.getElementsByTagName(e)),n;if((i=l[3])&&o.getElementsByClassName&&t.getElementsByClassName)return R.apply(n,t.getElementsByClassName(i)),n}if(o.qsa&&!T[e+" "]&&(!_||!_.test(e))&&(1!==m||"object"!==t.nodeName.toLowerCase())){if(f=e,p=t,1===m&&(J.test(e)||K.test(e))){for((p=ie.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=A)),s=(d=u(e)).length;s--;)d[s]=(c?"#"+c:":scope")+" "+xe(d[s]);f=d.join(",")}try{return R.apply(n,p.querySelectorAll(f)),n}catch(t){T(e,!0)}finally{c===A&&t.removeAttribute("id")}}}return h(e.replace(W,"$1"),t,n,r)}function he(){var e=[];return function t(n,r){return e.push(n+" ")>a.cacheLength&&delete t[e.shift()],t[n+" "]=r}}function fe(e){return e[A]=!0,e}function pe(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function me(e,t){for(var n=e.split("|"),r=n.length;r--;)a.attrHandle[n[r]]=t}function ge(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function ye(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function be(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ue(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function _e(e){return fe((function(t){return t=+t,fe((function(n,r){for(var i,s=e([],n.length,t),o=s.length;o--;)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(s in o=de.support={},l=de.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},g=de.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:j;return r!=v&&9===r.nodeType&&r.documentElement?(y=(v=r).documentElement,b=!l(v),j!=v&&(n=v.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",le,!1):n.attachEvent&&n.attachEvent("onunload",le)),o.scope=pe((function(e){return y.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.cssHas=pe((function(){try{return v.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),o.attributes=pe((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=pe((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=ne.test(v.getElementsByClassName),o.getById=pe((function(e){return y.appendChild(e).id=A,!v.getElementsByName||!v.getElementsByName(A).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(se,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var n=t.getElementById(e);return n?[n]:[]}}):(a.filter.ID=function(e){var t=e.replace(se,oe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var n,r,i,s=t.getElementById(e);if(s){if((n=s.getAttributeNode("id"))&&n.value===e)return[s];for(i=t.getElementsByName(e),r=0;s=i[r++];)if((n=s.getAttributeNode("id"))&&n.value===e)return[s]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){for(;n=s[i++];)1===n.nodeType&&r.push(n);return r}return s},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&b)return t.getElementsByClassName(e)},w=[],_=[],(o.qsa=ne.test(v.querySelectorAll))&&(pe((function(e){var t;y.appendChild(e).innerHTML="<a id='"+A+"'></a><select id='"+A+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&_.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||_.push("\\["+B+"*(?:value|"+U+")"),e.querySelectorAll("[id~="+A+"-]").length||_.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||_.push("\\["+B+"*name"+B+"*="+B+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||_.push(":checked"),e.querySelectorAll("a#"+A+"+*").length||_.push(".#.+[+~]"),e.querySelectorAll("\\\f"),_.push("[\\r\\n\\f]")})),pe((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&_.push("name"+B+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&_.push(":enabled",":disabled"),y.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&_.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),_.push(",.*:")}))),(o.matchesSelector=ne.test(S=y.matches||y.webkitMatchesSelector||y.mozMatchesSelector||y.oMatchesSelector||y.msMatchesSelector))&&pe((function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",H)})),o.cssHas||_.push(":has"),_=_.length&&new RegExp(_.join("|")),w=w.length&&new RegExp(w.join("|")),t=ne.test(y.compareDocumentPosition),x=t||ne.test(y.contains)?function(e,t){var n=9===e.nodeType&&e.documentElement||e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return m=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===n?e==v||e.ownerDocument==j&&x(j,e)?-1:t==v||t.ownerDocument==j&&x(j,t)?1:p?L(p,e)-L(p,t):0:4&n?-1:1)}:function(e,t){if(e===t)return m=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,o=[e],a=[t];if(!i||!s)return e==v?-1:t==v?1:i?-1:s?1:p?L(p,e)-L(p,t):0;if(i===s)return ge(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;o[r]===a[r];)r++;return r?ge(o[r],a[r]):o[r]==j?-1:a[r]==j?1:0},v):v},de.matches=function(e,t){return de(e,null,null,t)},de.matchesSelector=function(e,t){if(g(e),o.matchesSelector&&b&&!T[t+" "]&&(!w||!w.test(t))&&(!_||!_.test(t)))try{var n=S.call(e,t);if(n||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){T(t,!0)}return de(t,v,null,[e]).length>0},de.contains=function(e,t){return(e.ownerDocument||e)!=v&&g(e),x(e,t)},de.attr=function(e,t){(e.ownerDocument||e)!=v&&g(e);var n=a.attrHandle[t.toLowerCase()],r=n&&M.call(a.attrHandle,t.toLowerCase())?n(e,t,!b):void 0;return void 0!==r?r:o.attributes||!b?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},de.escape=function(e){return(e+"").replace(ae,ce)},de.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},de.uniqueSort=function(e){var t,n=[],r=0,i=0;if(m=!o.detectDuplicates,p=!o.sortStable&&e.slice(0),e.sort(N),m){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return p=null,e},c=de.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=c(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=c(t);return n},a=de.selectors={cacheLength:50,createPseudo:fe,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(se,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(se,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||de.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&de.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Y.test(n)&&(t=u(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(se,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=O[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&O(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var i=de.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(G," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var l,u,d,h,f,p,m=s!==o?"nextSibling":"previousSibling",g=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!c&&!a,b=!1;if(g){if(s){for(;m;){for(h=t;h=h[m];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;p=m="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?g.firstChild:g.lastChild],o&&y){for(b=(f=(l=(u=(d=(h=g)[A]||(h[A]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===$&&l[1])&&l[2],h=f&&g.childNodes[f];h=++f&&h&&h[m]||(b=f=0)||p.pop();)if(1===h.nodeType&&++b&&h===t){u[e]=[$,f,b];break}}else if(y&&(b=f=(l=(u=(d=(h=t)[A]||(h[A]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===$&&l[1]),!1===b)for(;(h=++f&&h&&h[m]||(b=f=0)||p.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++b||(y&&((u=(d=h[A]||(h[A]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]=[$,b]),h!==t)););return(b-=i)===r||b%r===0&&b/r>=0}}},PSEUDO:function(e,t){var n,r=a.pseudos[e]||a.setFilters[e.toLowerCase()]||de.error("unsupported pseudo: "+e);return r[A]?r(t):r.length>1?(n=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?fe((function(e,n){for(var i,s=r(e,t),o=s.length;o--;)e[i=L(e,s[o])]=!(n[i]=s[o])})):function(e){return r(e,0,n)}):r}},pseudos:{not:fe((function(e){var t=[],n=[],r=d(e.replace(W,"$1"));return r[A]?fe((function(e,t,n,i){for(var s,o=r(e,null,i,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,i,s){return t[0]=e,r(t,null,s,n),t[0]=null,!n.pop()}})),has:fe((function(e){return function(t){return de(e,t).length>0}})),contains:fe((function(e){return e=e.replace(se,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:fe((function(e){return X.test(e||"")||de.error("unsupported lang: "+e),e=e.replace(se,oe).toLowerCase(),function(t){var n;do{if(n=b?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===y},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:be(!1),disabled:be(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:_e((function(){return[0]})),last:_e((function(e,t){return[t-1]})),eq:_e((function(e,t,n){return[n<0?n+t:n]})),even:_e((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:_e((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:_e((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:_e((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}},a.pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[s]=ve(s);for(s in{submit:!0,reset:!0})a.pseudos[s]=ye(s);function Se(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function Ae(e,t,n){var r=t.dir,i=t.next,s=i||r,o=n&&"parentNode"===s,a=E++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var l,u,d,h=[$,a];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(u=(d=t[A]||(t[A]={}))[t.uniqueID]||(d[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=u[s])&&l[0]===$&&l[1]===a)return h[2]=l[2];if(u[s]=h,h[2]=e(t,n,c))return!0}return!1}}function je(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function $e(e,t,n,r,i){for(var s,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(s=e[a])&&(n&&!n(s,r,i)||(o.push(s),l&&t.push(a)));return o}function Ee(e,t,n,r,i,s){return r&&!r[A]&&(r=Ee(r)),i&&!i[A]&&(i=Ee(i,s)),fe((function(s,o,a,c){var l,u,d,h=[],f=[],p=o.length,m=s||function(e,t,n){for(var r=0,i=t.length;r<i;r++)de(e,t[r],n);return n}(t||"*",a.nodeType?[a]:a,[]),g=!e||!s&&t?m:$e(m,h,e,a,c),v=n?i||(s?e:p||r)?[]:o:g;if(n&&n(g,v,a,c),r)for(l=$e(v,f),r(l,[],a,c),u=l.length;u--;)(d=l[u])&&(v[f[u]]=!(g[f[u]]=d));if(s){if(i||e){if(i){for(l=[],u=v.length;u--;)(d=v[u])&&l.push(g[u]=d);i(null,v=[],l,c)}for(u=v.length;u--;)(d=v[u])&&(l=i?L(s,d):h[u])>-1&&(s[l]=!(o[l]=d))}}else v=$e(v===o?v.splice(p,v.length):v),i?i(null,o,v,c):R.apply(o,v)}))}function Oe(e){for(var t,n,r,i=e.length,s=a.relative[e[0].type],o=s||a.relative[" "],c=s?1:0,l=Ae((function(e){return e===t}),o,!0),u=Ae((function(e){return L(t,e)>-1}),o,!0),d=[function(e,n,r){var i=!s&&(r||n!==f)||((t=n).nodeType?l(e,n,r):u(e,n,r));return t=null,i}];c<i;c++)if(n=a.relative[e[c].type])d=[Ae(je(d),n)];else{if((n=a.filter[e[c].type].apply(null,e[c].matches))[A]){for(r=++c;r<i&&!a.relative[e[r].type];r++);return Ee(c>1&&je(d),c>1&&xe(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(W,"$1"),n,c<r&&Oe(e.slice(c,r)),r<i&&Oe(e=e.slice(r)),r<i&&xe(e))}d.push(n)}return je(d)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,u=de.tokenize=function(e,t){var n,r,i,s,o,c,l,u=C[e+" "];if(u)return t?0:u.slice(0);for(o=e,c=[],l=a.preFilter;o;){for(s in n&&!(r=V.exec(o))||(r&&(o=o.slice(r[0].length)||o),c.push(i=[])),n=!1,(r=K.exec(o))&&(n=r.shift(),i.push({value:n,type:r[0].replace(W," ")}),o=o.slice(n.length)),a.filter)!(r=Q[s].exec(o))||l[s]&&!(r=l[s](r))||(n=r.shift(),i.push({value:n,type:s,matches:r}),o=o.slice(n.length));if(!n)break}return t?o.length:o?de.error(e):C(e,c).slice(0)},d=de.compile=function(e,t){var n,r=[],i=[],s=k[e+" "];if(!s){for(t||(t=u(e)),n=t.length;n--;)(s=Oe(t[n]))[A]?r.push(s):i.push(s);s=k(e,function(e,t){var n=t.length>0,r=e.length>0,i=function(i,s,o,c,l){var u,d,h,p=0,m="0",y=i&&[],_=[],w=f,S=i||r&&a.find.TAG("*",l),x=$+=null==w?1:Math.random()||.1,A=S.length;for(l&&(f=s==v||s||l);m!==A&&null!=(u=S[m]);m++){if(r&&u){for(d=0,s||u.ownerDocument==v||(g(u),o=!b);h=e[d++];)if(h(u,s||v,o)){c.push(u);break}l&&($=x)}n&&((u=!h&&u)&&p--,i&&y.push(u))}if(p+=m,n&&m!==p){for(d=0;h=t[d++];)h(y,_,s,o);if(i){if(p>0)for(;m--;)y[m]||_[m]||(_[m]=P.call(c));_=$e(_)}R.apply(c,_),l&&!i&&_.length>0&&p+t.length>1&&de.uniqueSort(c)}return l&&($=x,f=w),y};return n?fe(i):i}(i,r)),s.selector=e}return s},h=de.select=function(e,t,n,r){var i,s,o,c,l,h="function"==typeof e&&e,f=!r&&u(e=h.selector||e);if(n=n||[],1===f.length){if((s=f[0]=f[0].slice(0)).length>2&&"ID"===(o=s[0]).type&&9===t.nodeType&&b&&a.relative[s[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(se,oe),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(s.shift().value.length)}for(i=Q.needsContext.test(e)?0:s.length;i--&&(o=s[i],!a.relative[c=o.type]);)if((l=a.find[c])&&(r=l(o.matches[0].replace(se,oe),ie.test(s[0].type)&&we(t.parentNode)||t))){if(s.splice(i,1),!(e=r.length&&xe(s)))return R.apply(n,r),n;break}}return(h||d(e,f))(r,t,!b,n,!t||ie.test(e)&&we(t.parentNode)||t),n},o.sortStable=A.split("").sort(N).join("")===A,o.detectDuplicates=!!m,g(),o.sortDetached=pe((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),pe((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||me("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&pe((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||me("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),pe((function(e){return null==e.getAttribute("disabled")}))||me(U,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}));var Ce=i.Sizzle;de.noConflict=function(){return i.Sizzle===de&&(i.Sizzle=Ce),de},void 0===(r=function(){return de}.call(t,n,t,e))||(e.exports=r)}(window)},5361:(e,t,n)=>{var r=n(4117).default,i=n(8452);e.exports=function(e){var t=i(e,"string");return"symbol"==r(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},5431:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5434:(e,t,n)=>{"use strict";t.Ud=t.O5=void 0;var r,i=(r=n(7682))&&r.__esModule?r:{default:r},s=n(3083),o=n(3028),a=n(6930),c=n(4529);t.O5=function(e){var t=new Uint8Array(e);return(0,s.parse)((0,o.buildStream)(t),i.default)};var l=function(e,t,n){if(e.image){var r=e.image,i=r.descriptor.width*r.descriptor.height,s=(0,c.lzw)(r.data.minCodeSize,r.data.blocks,i);r.descriptor.lct.interlaced&&(s=(0,a.deinterlace)(s,r.descriptor.width));var o={pixels:s,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return r.descriptor.lct&&r.descriptor.lct.exists?o.colorTable=r.lct:o.colorTable=t,e.gce&&(o.delay=10*(e.gce.delay||10),o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),n&&(o.patch=function(e){for(var t=e.pixels.length,n=new Uint8ClampedArray(4*t),r=0;r<t;r++){var i=4*r,s=e.pixels[r],o=e.colorTable[s]||[0,0,0];n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=s!==e.transparentIndex?255:0}return n}(o)),o}console.warn("gif frame does not have associated image.")};t.Ud=function(e,t){return e.frames.filter((function(e){return e.image})).map((function(n){return l(n,e.gct,t)}))}},5501:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5723:(e,t,n)=>{"use strict";var r=n(7983);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.getStorage)(),r=!(!n||!n[t]),c=r?n[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},l=c.clear.bind(c),u=c.get.bind(c),d=c.remove.bind(c),h=c.set.bind(c);return{_driver:e,_support:r,_initStorage:function(){return Promise.resolve()},clear:function(e){return(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l(),e&&e();case 2:case"end":return t.stop()}}),t)})))()},iterate:function(e,t){return(0,o.default)(i.default.mark((function n(){var r;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(u,null);case 2:r=n.sent,Object.keys(r).forEach((function(t,n){return e(r[t],t,n)})),t&&t();case 6:case"end":return n.stop()}}),n)})))()},getItem:function(e,t){return(0,o.default)(i.default.mark((function n(){var r;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,a.usePromise)(u,e);case 3:return r=n.sent,r=void 0===(r="string"==typeof e?r[e]:r)?null:r,t&&t(null,r),n.abrupt("return",r);case 10:throw n.prev=10,n.t0=n.catch(0),t&&t(n.t0),n.t0;case 14:case"end":return n.stop()}}),n,null,[[0,10]])})))()},key:function(e,t){return(0,o.default)(i.default.mark((function n(){var r,s;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(u,null);case 2:return r=n.sent,s=Object.keys(r)[e],t&&t(s),n.abrupt("return",s);case 6:case"end":return n.stop()}}),n)})))()},keys:function(e){return(0,o.default)(i.default.mark((function t(){var n,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(u,null);case 2:return n=t.sent,r=Object.keys(n),e&&e(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},length:function(e){return(0,o.default)(i.default.mark((function t(){var n,r,s;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(u,null);case 2:return n=t.sent,r=Object.keys(n),s=r.length,e&&e(s),t.abrupt("return",s);case 6:case"end":return t.stop()}}),t)})))()},removeItem:function(e,t){return(0,o.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(d,e);case 2:t&&t();case 3:case"end":return n.stop()}}),n)})))()},setItem:function(e,t,n){return(0,o.default)(i.default.mark((function r(){return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,a.usePromise)(h,(0,s.default)({},e,t));case 2:n&&n();case 3:case"end":return r.stop()}}),r)})))()}}};var i=r(n(3013)),s=r(n(182)),o=r(n(3486)),a=n(6252)},5832:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5909:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6120:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6215:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6252:(e,t)=>{"use strict";function n(){return"undefined"!=typeof browser&&browser.storage||"undefined"!=typeof chrome&&chrome.storage}Object.defineProperty(t,"__esModule",{value:!0}),t.getStorage=n,t.usePromise=function(e,t){if(function(){var e=n();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}())return e(t);return new Promise((function(n){e(t,(function(){n.apply(void 0,arguments)}))}))}},6264:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6524:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6557:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},6594:(e,t,n)=>{var r=n(4117).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},6669:(e,t,n)=>{var r={"./af.js":[1833,5628],"./am.js":[5400,8489],"./ar-dz.js":[6480,3741],"./ar-iq.js":[2964,6605],"./ar-kw.js":[2436,861],"./ar-ly.js":[3873,1696],"./ar-ma.js":[6192,7385],"./ar-sa.js":[8250,131],"./ar-tn.js":[1500,7801],"./ar.js":[6773,8880],"./az.js":[2189,9080],"./be.js":[6383,2366],"./bg.js":[3569,1072],"./bi.js":[5459,1938],"./bm.js":[6871,6486],"./bn-bd.js":[7341,6124],"./bn.js":[5418,9423],"./bo.js":[8201,1464],"./br.js":[910,2643],"./bs.js":[1085,1116],"./ca.js":[106,9395],"./cs.js":[8720,5825],"./cv.js":[6083,2766],"./cy.js":[3426,7003],"./da.js":[1841,6208],"./de-at.js":[6095,5534],"./de-ch.js":[2985,6064],"./de.js":[6093,5036],"./dv.js":[612,2993],"./el.js":[1347,9782],"./en-au.js":[7920,6121],"./en-ca.js":[570,5611],"./en-gb.js":[2115,4094],"./en-ie.js":[2968,1665],"./en-il.js":[343,8178],"./en-in.js":[9145,7028],"./en-nz.js":[1146,8343],"./en-sg.js":[4748,3341],"./en-tt.js":[8142,7627],"./en.js":[9445,6824],"./eo.js":[1174,8031],"./es-do.js":[9430,9271],"./es-mx.js":[1362,591],"./es-pr.js":[5237,2856],"./es-us.js":[3679,4182],"./es.js":[9186,1827],"./et.js":[9691,385],"./eu.js":[1748,933],"./fa.js":[8439,598],"./fi.js":[7183,3166],"./fo.js":[1917,7596],"./fr-ca.js":[3891,9870],"./fr-ch.js":[5348,9101],"./fr.js":[2154,8431],"./fy.js":[2863,9710],"./ga.js":[6998,7743],"./gd.js":[1753,5284],"./gl.js":[3985,5724],"./gom-latn.js":[3063,8630],"./gu.js":[8602,8443],"./he.js":[6977,2384],"./hi.js":[7413,4852],"./hr.js":[436,2241],"./ht.js":[9570,6007],"./hu.js":[7457,1712],"./hy-am.js":[5800,9589],"./id.js":[5599,4770],"./is.js":[5086,3359],"./it-ch.js":[2675,4718],"./it.js":[1935,4034],"./ja.js":[2979,4434],"./jv.js":[8874,9007],"./ka.js":[9170,4523],"./kk.js":[640,6641],"./km.js":[5110,3287],"./kn.js":[8579,4974],"./ko.js":[3116,8789],"./ku.js":[3438,687],"./ky.js":[8426,7491],"./lb.js":[3232,1373],"./lo.js":[2523,6042],"./lt.js":[4006,4859],"./lv.js":[2540,9593],"./me.js":[876,4333],"./mi.js":[6888,3729],"./mk.js":[5858,5059],"./ml.js":[9291,5998],"./mn.js":[5677,1056],"./mr.js":[5321,4260],"./ms-my.js":[1737,4512],"./ms.js":[2538,2091],"./mt.js":[8608,3014],"./my.js":[8888,561],"./nb.js":[8930,7],"./ne.js":[2363,5946],"./nl-be.js":[2424,9109],"./nl.js":[3596,7497],"./nn.js":[9830,1275],"./oc-lnc.js":[7746,1719],"./pa-in.js":[9833,2664],"./pl.js":[3858,6343],"./pt-br.js":[783,2014],"./pt.js":[9738,6191],"./rn.js":[3898,3519],"./ro.js":[6425,4584],"./ru.js":[8927,7806],"./rw.js":[9409,8176],"./sd.js":[9461,3664],"./se.js":[8742,9975],"./si.js":[4194,9547],"./sk.js":[7752,6537],"./sl.js":[3485,8232],"./sq.js":[6698,9411],"./sr-cyrl.js":[6154,9331],"./sr.js":[3959,4858],"./ss.js":[2656,2769],"./sv-fi.js":[4298,6660],"./sv.js":[7859,1982],"./sw.js":[8988,2389],"./ta.js":[753,832],"./te.js":[8509,4636],"./tet.js":[7517,8592],"./tg.js":[2123,7962],"./th.js":[4954,6655],"./tk.js":[8679,422],"./tl-ph.js":[6143,8022],"./tlh.js":[6060,8945],"./tr.js":[1720,9557],"./tzl.js":[4102,3683],"./tzm-latn.js":[5103,138],"./tzm.js":[4821,9052],"./ug-cn.js":[1838,3731],"./uk.js":[5770,4107],"./ur.js":[1153,1388],"./uz-latn.js":[1611,5970],"./uz.js":[8921,948],"./vi.js":[3103,3774],"./x-pseudo.js":[4707,5790],"./yo.js":[6346,6803],"./zh-cn.js":[6792,4385],"./zh-hk.js":[9232,7013],"./zh-tw.js":[7904,7981],"./zh.js":[8436,4497]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,23)))}i.keys=()=>Object.keys(r),i.id=6669,e.exports=i},6691:(e,t,n)=>{e.exports=function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return i(n||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var s=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,o=new i(u),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function d(e){1!==l.push(e)||r||n()}t.exports=d}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}function o(){t(i,r)}var a=p(o);"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function m(e){return e instanceof this?e:s.resolve(new this(i),e)}function g(e){var t=new this(i);return s.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,l=new this(i);++c<n;)u(e[c],c);return l;function u(e,i){function c(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(l,o))}t.resolve(e).then(c,(function(e){r||(r=!0,s.reject(l,e))}))}}function y(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(i);++o<n;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){r||(r=!0,s.resolve(a,e))}),(function(e){r||(r=!0,s.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?d(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=m,l.reject=g,l.all=v,l.race=y},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=s();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function d(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",m=void 0,g={},v=Object.prototype.toString,y="readonly",b="readwrite";function _(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function w(e){return new l((function(t){var n=e.transaction(p,b),r=c([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof m?l.resolve(m):w(e).then((function(e){return m=e}))}function x(e){var t=g[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function A(e){var t=g[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function j(e,t){var n=g[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function $(e,t){return new l((function(n,r){if(g[e.name]=g[e.name]||D(),e.db){if(!t)return n(e.db);x(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=o.open.apply(o,i);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),A(e)}}))}function E(e){return $(e,!1)}function O(e){return $(e,!0)}function C(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function k(e){return new l((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function T(e){return c([_(atob(e.data))],{type:e.type})}function N(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return d(n,e,e),n}function I(e){x(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,E(e).then((function(t){return e.db=t,C(e)?O(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw j(e,t),t}))}function P(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),O(e)})).then((function(){return I(e).then((function(){P(e,t,n,r-1)}))})).catch(n);n(i)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function R(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=g[n.name];i||(i=D(),g[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=M);var s=[];function o(){return l.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&s.push(c._initReady().catch(o))}var u=i.forages.slice(0);return l.all(s).then((function(){return n.db=i.db,E(n)})).then((function(e){return n.db=e,C(n,t._defaultConfig.version)?O(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var s=u[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))}function z(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){P(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),N(e)&&(e=T(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function L(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){P(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;N(r)&&(r=T(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function U(e,t,n){var r=this;e=h(e);var i=new l((function(n,i){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===v.call(t)?S(s.db).then((function(e){return e?t:k(t)})):t})).then((function(t){P(r._dbInfo,b,(function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return u(i,n),i}function B(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){P(n._dbInfo,b,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(o.error)},s.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function F(e){var t=this,n=new l((function(e,n){t.ready().then((function(){P(t._dbInfo,b,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function q(e){var t=this,n=new l((function(e,n){t.ready().then((function(){P(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function H(e,t){var n=this,r=new l((function(t,r){e<0?t(null):n.ready().then((function(){P(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,t),r}function G(e){var t=this,n=new l((function(e,n){t.ready().then((function(){P(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var t=s.result;t?(o.push(t.key),t.continue()):e(o)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,e),n}function W(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var s=e.name===n.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):E(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?s.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;x(e);var r=g[e.name],i=r.forages;t.close();for(var s=0;s<i.length;s++){var a=i[s];a._dbInfo.db=null,a._dbInfo.version=n}var c=new l((function(t,r){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,A(n._dbInfo)}})).catch((function(t){throw(j(e,t)||l.resolve()).catch((function(){})),t}))}})):s.then((function(t){x(e);var n=g[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var s=new l((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return s.then((function(e){n.db=e;for(var t=0;t<r.length;t++)A(r[t]._dbInfo)})).catch((function(t){throw(j(e,t)||l.resolve()).catch((function(){})),t}))}))}else r=l.reject("Invalid arguments");return u(r,t),r}var V={_driver:"asyncStorage",_initStorage:R,_support:a(),iterate:L,getItem:z,setItem:U,removeItem:B,clear:F,length:q,key:H,keys:G,dropInstance:W};function K(){return"function"==typeof openDatabase}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y="~~local_forage_type~",X=/^~~local_forage_type~([^~]+)~/,Q="__lfsc__:",Z=Q.length,ee="arbf",te="blob",ne="si08",re="ui08",ie="uic8",se="si16",oe="si32",ae="ur16",ce="ui32",le="fl32",ue="fl64",de=Z+ee.length,he=Object.prototype.toString;function fe(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=J.indexOf(e[t]),r=J.indexOf(e[t+1]),i=J.indexOf(e[t+2]),s=J.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&s;return l}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=J[n[t]>>2],r+=J[(3&n[t])<<4|n[t+1]>>4],r+=J[(15&n[t+1])<<2|n[t+2]>>6],r+=J[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function me(e,t){var n="";if(e&&(n=he.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var r,i=Q;e instanceof ArrayBuffer?(r=e,i+=ee):(r=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=re:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=se:"[object Uint16Array]"===n?i+=ae:"[object Int32Array]"===n?i+=oe:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=le:"[object Float64Array]"===n?i+=ue:t(new Error("Failed to get type for BinaryArray"))),t(i+pe(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=Y+e.type+"~"+pe(this.result);t(Q+te+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function ge(e){if(e.substring(0,Z)!==Q)return JSON.parse(e);var t,n=e.substring(de),r=e.substring(Z,de);if(r===te&&X.test(n)){var i=n.match(X);t=i[1],n=n.substring(i[0].length)}var s=fe(n);switch(r){case ee:return s;case te:return c([s],{type:t});case ne:return new Int8Array(s);case re:return new Uint8Array(s);case ie:return new Uint8ClampedArray(s);case se:return new Int16Array(s);case ae:return new Uint16Array(s);case oe:return new Int32Array(s);case ce:return new Uint32Array(s);case le:return new Float32Array(s);case ue:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}}var ve={serialize:me,deserialize:ge,stringToBuffer:fe,bufferToString:pe};function ye(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function be(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new l((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){ye(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=ve,i}function _e(e,t,n,r,i,s){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?s(e,o):ye(e,t,(function(){e.executeSql(n,r,i,s)}),s)}),s):s(e,o)}),s)}function we(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Se(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var c=s.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function xe(e,t,n,r){var i=this;e=h(e);var s=new l((function(s,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(n){_e(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){s(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(xe.apply(i,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return u(s,n),s}function Ae(e,t,n){return xe.apply(this,[e,t,n,1])}function je(e,t){var n=this;e=h(e);var r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function $e(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){_e(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Ee(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){_e(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function Oe(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r}function Ce(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){_e(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n}function ke(e){return new l((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function Te(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return u(r=e.name?new l((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(ke(r))})).then((function(e){return new l((function(t,n){e.db.transaction((function(r){function i(e){return new l((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var s=[],o=0,a=e.storeNames.length;o<a;o++)s.push(i(e.storeNames[o]));l.all(s).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),t),r}var Ne={_driver:"webSQLStorage",_initStorage:be,_support:K(),iterate:Se,getItem:we,setItem:Ae,removeItem:je,clear:$e,length:Ee,key:Oe,keys:Ce,dropInstance:Te};function Me(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ie(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Pe(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function De(){return!Pe()||localStorage.length>0}function Re(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Ie(e,t._defaultConfig),De()?(t._dbInfo=n,n.serializer=ve,l.resolve()):l.reject()}function ze(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return u(n,e),n}function Le(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return u(r,t),r}function Ue(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return u(r,t),r}function Be(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return u(r,t),r}function Fe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r}));return u(n,e),n}function qe(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t}function He(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(r,t),r}function Ge(e,t,n){var r=this;e=h(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(i,s){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return u(i,n),i}function We(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new l((function(t){e.storeName?t(Ie(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),u(r,t),r}var Ve={_driver:"localStorageWrapper",_initStorage:Re,_support:Me(),iterate:Ue,getItem:Le,setItem:Ge,removeItem:He,clear:ze,length:qe,key:Be,keys:Fe,dropInstance:We},Ke=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Je=function(e,t){for(var n=e.length,r=0;r<n;){if(Ke(e[r],t))return!0;r++}return!1},Ye=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Qe={},Ze={INDEXEDDB:V,WEBSQL:Ne,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function st(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ye(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ot=function(){function e(t){for(var n in i(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],s=r._driver;this[n]=s,Xe[s]||this.defineDriver(r)}this._defaultConfig=st({},rt),this._config=st({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new l((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var s=nt.concat("_initStorage"),o=0,a=s.length;o<a;o++){var c=s[o];if((!Je(tt,c)||e[c])&&"function"!=typeof e[c])return void n(i)}var d=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=l.reject(t);return u(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var i=tt[n];e[i]||(e[i]=t(i))}};d();var h=function(n){Xe[r]&&console.info("Redefining LocalForage driver: "+r),Xe[r]=e,Qe[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return d(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Xe[e]?l.resolve(Xe[e]):l.reject(new Error("Driver not found."));return d(r,t,n),r},e.prototype.getSerializer=function(e){var t=l.resolve(ve);return d(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return d(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Ye(e)||(e=[e]);var i=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function o(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o).catch(n)}s();var a=new Error("No available storage method found.");return r._driverSet=l.reject(a),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=c.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(i)}))})).catch((function(){s();var e=new Error("No available storage method found.");return r._driverSet=l.reject(e),r._driverSet})),d(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Qe[e]},e.prototype._extend=function(e){st(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)},6865:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6930:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinterlace=void 0;t.deinterlace=function(e,t){for(var n=new Array(e.length),r=e.length/t,i=function(r,i){var s=e.slice(i*t,(i+1)*t);n.splice.apply(n,[r*t,t].concat(s))},s=[0,4,2,1],o=[8,8,4,2],a=0,c=0;c<4;c++)for(var l=s[c];l<r;l+=o[c])i(l,a),a++;return n}},7181:(e,t,n)=>{var r;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function s(e){return function(e,t){var n,r,o,a,c,l,u,d,h,f=1,p=e.length,m="";for(r=0;r<p;r++)if("string"==typeof e[r])m+=e[r];else if("object"==typeof e[r]){if((a=e[r]).keys)for(n=t[f],o=0;o<a.keys.length;o++){if(null==n)throw new Error(s('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?t[a.param_no]:t[f++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(s("[sprintf] expecting number but found %T",n));switch(i.number.test(a.type)&&(d=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?m+=n:(!i.number.test(a.type)||d&&!a.sign?h="":(h=d?"+":"-",n=n.toString().replace(i.sign,"")),l=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",u=a.width-(h+n).length,c=a.width&&u>0?l.repeat(u):"",m+=a.align?h+n+c:"0"===l?h+c+n:c+h+n)}return m}(function(e){if(a[e])return a[e];var t,n=e,r=[],s=0;for(;n;){if(null!==(t=i.text.exec(n)))r.push(t[0]);else if(null!==(t=i.modulo.exec(n)))r.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){s|=1;var o=[],c=t[2],l=[];if(null===(l=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(l[1]);""!==(c=c.substring(l[0].length));)if(null!==(l=i.key_access.exec(c)))o.push(l[1]);else{if(null===(l=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(l[1])}t[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return a[e]=r}(e),arguments)}function o(e,t){return s.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=s,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=s,window.vsprintf=o,void 0===(r=function(){return{sprintf:s,vsprintf:o}}.call(t,n,t,e))||(e.exports=r))}()},7187:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7190:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7478:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7659:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},7682:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(3083),i=n(3028),s={blocks:function(e){for(var t=[],n=e.data.length,r=0,s=(0,i.readByte)()(e);0!==s&&s;s=(0,i.readByte)()(e)){if(e.pos+s>=n){var o=n-e.pos;t.push((0,i.readBytes)(o)(e)),r+=o;break}t.push((0,i.readBytes)(s)(e)),r+=s}for(var a=new Uint8Array(r),c=0,l=0;l<t.length;l++)a.set(t[l],c),c+=t[l].length;return a}},o=(0,r.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&249===t[1]})),a=(0,r.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,i.readArray)(3,(function(e,t,n){return Math.pow(2,n.descriptor.lct.size+1)}))},(function(e,t,n){return n.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},s]}]},(function(e){return 44===(0,i.peekByte)()(e)})),c=(0,r.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(e,t,n){return(0,i.readBytes)(n.text.blockSize)(e)}},s]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&1===t[1]})),l=(0,r.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(e,t,n){return(0,i.readString)(n.blockSize)(e)}},s]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&255===t[1]})),u=(0,r.conditional)({comment:[{codes:(0,i.readBytes)(2)},s]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&254===t[1]})),d=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,r.conditional)({gct:(0,i.readArray)(3,(function(e,t){return Math.pow(2,t.lsd.gct.size+1)}))},(function(e,t){return t.lsd.gct.exists})),{frames:(0,r.loop)([o,l,u,a,c],(function(e){var t=(0,i.peekByte)()(e);return 33===t||44===t}))}];t.default=d},7702:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7808:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7983:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},7999:e=>{function t(n,r,i,s){var o=Object.defineProperty;try{o({},"",{})}catch(n){o=0}e.exports=t=function(e,n,r,i){if(n)o?o(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r;else{var s=function(n,r){t(e,n,(function(e){return this._invoke(n,r,e)}))};s("next",0),s("throw",1),s("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,i,s)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},8011:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8083:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8185:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8452:(e,t,n)=>{var r=n(4117).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},8555:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8562:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8609:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8610:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8850:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8853:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8945:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9144:function(e){e.exports=function(){"use strict";return function(e,t){var n=t.prototype,r=n.format;n.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return r.bind(this)(e);var i=this.$utils(),s=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return r.bind(this)(s)}}}()},9402:(e,t,n)=>{"use strict";var r=n(7983);t.A=void 0;var i=(0,r(n(5723)).default)("webExtensionSyncStorage","sync");t.A=i},9440:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9442:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9495:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9569:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9613:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9845:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9847:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(5307),i=n.n(r),s=n(3241),o=n.n(s)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var i=Object.create(null);o.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,o.d(i,s),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>({7:"locales/dayjs/nb-js",131:"locales/dayjs/ar-sa-js",138:"locales/dayjs/tzm-latn-js",221:"locales/vi-LC_MESSAGES-converse-po",290:"locales/nl_BE-LC_MESSAGES-converse-po",345:"locales/el-LC_MESSAGES-converse-po",385:"locales/dayjs/et-js",422:"locales/dayjs/tk-js",453:"locales/fa-LC_MESSAGES-converse-po",507:"locales/mr-LC_MESSAGES-converse-po",528:"locales/ko-LC_MESSAGES-converse-po",548:"locales/tr-LC_MESSAGES-converse-po",561:"locales/dayjs/my-js",591:"locales/dayjs/es-mx-js",598:"locales/dayjs/fa-js",687:"locales/dayjs/ku-js",799:"locales/hi-LC_MESSAGES-converse-po",832:"locales/dayjs/ta-js",861:"locales/dayjs/ar-kw-js",933:"locales/dayjs/eu-js",948:"locales/dayjs/uz-js",962:"locales/ca-LC_MESSAGES-converse-po",1056:"locales/dayjs/mn-js",1072:"locales/dayjs/bg-js",1116:"locales/dayjs/bs-js",1275:"locales/dayjs/nn-js",1373:"locales/dayjs/lb-js",1388:"locales/dayjs/ur-js",1437:"locales/be-LC_MESSAGES-converse-po",1462:"locales/lt-LC_MESSAGES-converse-po",1464:"locales/dayjs/bo-js",1665:"locales/dayjs/en-ie-js",1696:"locales/dayjs/ar-ly-js",1712:"locales/dayjs/hu-js",1719:"locales/dayjs/oc-lnc-js",1827:"locales/dayjs/es-js",1938:"locales/dayjs/bi-js",1963:"locales/ro-LC_MESSAGES-converse-po",1982:"locales/dayjs/sv-js",2014:"locales/dayjs/pt-br-js",2091:"locales/dayjs/ms-js",2168:"locales/eu-LC_MESSAGES-converse-po",2241:"locales/dayjs/hr-js",2366:"locales/dayjs/be-js",2384:"locales/dayjs/he-js",2389:"locales/dayjs/sw-js",2546:"locales/pt-LC_MESSAGES-converse-po",2643:"locales/dayjs/br-js",2664:"locales/dayjs/pa-in-js",2766:"locales/dayjs/cv-js",2769:"locales/dayjs/ss-js",2787:"locales/gl-LC_MESSAGES-converse-po",2856:"locales/dayjs/es-pr-js",2894:"locales/ug-LC_MESSAGES-converse-po",2974:"emojis",2993:"locales/dayjs/dv-js",3014:"locales/dayjs/mt-js",3166:"locales/dayjs/fi-js",3287:"locales/dayjs/km-js",3330:"locales/th-LC_MESSAGES-converse-po",3341:"locales/dayjs/en-sg-js",3359:"locales/dayjs/is-js",3519:"locales/dayjs/rn-js",3613:"locales/fi-LC_MESSAGES-converse-po",3664:"locales/dayjs/sd-js",3683:"locales/dayjs/tzl-js",3698:"locales/fr-LC_MESSAGES-converse-po",3729:"locales/dayjs/mi-js",3731:"locales/dayjs/ug-cn-js",3741:"locales/dayjs/ar-dz-js",3774:"locales/dayjs/vi-js",3881:"locales/ja-LC_MESSAGES-converse-po",4034:"locales/dayjs/it-js",4094:"locales/dayjs/en-gb-js",4107:"locales/dayjs/uk-js",4146:"locales/sq-LC_MESSAGES-converse-po",4182:"locales/dayjs/es-us-js",4202:"locales/es-LC_MESSAGES-converse-po",4260:"locales/dayjs/mr-js",4267:"locales/af-LC_MESSAGES-converse-po",4315:"locales/pt_BR-LC_MESSAGES-converse-po",4333:"locales/dayjs/me-js",4336:"locales/nl-LC_MESSAGES-converse-po",4385:"locales/dayjs/zh-cn-js",4434:"locales/dayjs/ja-js",4497:"locales/dayjs/zh-js",4512:"locales/dayjs/ms-my-js",4523:"locales/dayjs/ka-js",4584:"locales/dayjs/ro-js",4636:"locales/dayjs/te-js",4718:"locales/dayjs/it-ch-js",4749:"locales/id-LC_MESSAGES-converse-po",4770:"locales/dayjs/id-js",4852:"locales/dayjs/hi-js",4858:"locales/dayjs/sr-js",4859:"locales/dayjs/lt-js",4974:"locales/dayjs/kn-js",5036:"locales/dayjs/de-js",5059:"locales/dayjs/mk-js",5283:"locales/ta-LC_MESSAGES-converse-po",5284:"locales/dayjs/gd-js",5534:"locales/dayjs/de-at-js",5611:"locales/dayjs/en-ca-js",5628:"locales/dayjs/af-js",5724:"locales/dayjs/gl-js",5743:"locales/ar-LC_MESSAGES-converse-po",5790:"locales/dayjs/x-pseudo-js",5825:"locales/dayjs/cs-js",5946:"locales/dayjs/ne-js",5970:"locales/dayjs/uz-latn-js",5998:"locales/dayjs/ml-js",6007:"locales/dayjs/ht-js",6042:"locales/dayjs/lo-js",6064:"locales/dayjs/de-ch-js",6109:"locales/it-LC_MESSAGES-converse-po",6121:"locales/dayjs/en-au-js",6124:"locales/dayjs/bn-bd-js",6179:"locales/bg-LC_MESSAGES-converse-po",6191:"locales/dayjs/pt-js",6208:"locales/dayjs/da-js",6311:"locales/de-LC_MESSAGES-converse-po",6343:"locales/dayjs/pl-js",6345:"locales/sv-LC_MESSAGES-converse-po",6486:"locales/dayjs/bm-js",6537:"locales/dayjs/sk-js",6550:"locales/zh_CN-LC_MESSAGES-converse-po",6605:"locales/dayjs/ar-iq-js",6641:"locales/dayjs/kk-js",6655:"locales/dayjs/th-js",6660:"locales/dayjs/sv-fi-js",6733:"locales/ru-LC_MESSAGES-converse-po",6803:"locales/dayjs/yo-js",6824:"locales/dayjs/en-js",6963:"locales/da-LC_MESSAGES-converse-po",7003:"locales/dayjs/cy-js",7013:"locales/dayjs/zh-hk-js",7028:"locales/dayjs/en-in-js",7370:"locales/pl-LC_MESSAGES-converse-po",7385:"locales/dayjs/ar-ma-js",7491:"locales/dayjs/ky-js",7494:"locales/eo-LC_MESSAGES-converse-po",7497:"locales/dayjs/nl-js",7576:"locales/oc-LC_MESSAGES-converse-po",7596:"locales/dayjs/fo-js",7627:"locales/dayjs/en-tt-js",7743:"locales/dayjs/ga-js",7801:"locales/dayjs/ar-tn-js",7806:"locales/dayjs/ru-js",7962:"locales/dayjs/tg-js",7981:"locales/dayjs/zh-tw-js",8022:"locales/dayjs/tl-ph-js",8031:"locales/dayjs/eo-js",8176:"locales/dayjs/rw-js",8178:"locales/dayjs/en-il-js",8227:"locales/he-LC_MESSAGES-converse-po",8232:"locales/dayjs/sl-js",8252:"locales/cs-LC_MESSAGES-converse-po",8343:"locales/dayjs/en-nz-js",8431:"locales/dayjs/fr-js",8443:"locales/dayjs/gu-js",8489:"locales/dayjs/am-js",8592:"locales/dayjs/tet-js",8630:"locales/dayjs/gom-latn-js",8714:"locales/si-LC_MESSAGES-converse-po",8789:"locales/dayjs/ko-js",8880:"locales/dayjs/ar-js",8898:"locales/uk-LC_MESSAGES-converse-po",8945:"locales/dayjs/tlh-js",8986:"locales/zh_TW-LC_MESSAGES-converse-po",9007:"locales/dayjs/jv-js",9052:"locales/dayjs/tzm-js",9080:"locales/dayjs/az-js",9101:"locales/dayjs/fr-ch-js",9109:"locales/dayjs/nl-be-js",9139:"locales/hu-LC_MESSAGES-converse-po",9271:"locales/dayjs/es-do-js",9331:"locales/dayjs/sr-cyrl-js",9395:"locales/dayjs/ca-js",9411:"locales/dayjs/sq-js",9423:"locales/dayjs/bn-js",9547:"locales/dayjs/si-js",9557:"locales/dayjs/tr-js",9562:"locales/nb-LC_MESSAGES-converse-po",9589:"locales/dayjs/hy-am-js",9593:"locales/dayjs/lv-js",9710:"locales/dayjs/fy-js",9782:"locales/dayjs/el-js",9870:"locales/dayjs/fr-ca-js",9975:"locales/dayjs/se-js"}[e]+".js"),o.miniCssF=e=>{},o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},r="converse.js:",o.l=(e,t,i,s)=>{if(n[e])n[e].push(t);else{var a,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==r+i){a=d;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",r+i),a.src=e),n[e]=[t];var h=(t,r)=>{a.onerror=a.onload=null,clearTimeout(f);var i=n[e];if(delete n[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(r))),t)return t(r)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="/dist/",(()=>{var e={50:0,6968:0};o.f.j=(t,n)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var s=o.p+o.u(t),a=new Error;o.l(s,(n=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,i,[s,a,c]=n,l=0;if(s.some((t=>0!==e[t]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(c)c(o)}for(t&&t(n);l<s.length;l++)i=s[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkconverse_js=self.webpackChunkconverse_js||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.nc=void 0,(()=>{"use strict";const e={},t={plugins:{add(t,n){if(void 0!==e[t])throw new TypeError(`Error: plugin with name "${t}" has already been registered!`);e[t]=n}},initialize:(e={})=>t.load(e).initialize(e),load:(n={})=>(n.assets_path&&(o.p=n.assets_path),o(216),Object.keys(e).forEach((n=>t.plugins.add(n,e[n]))),t)};window.converse=t;const n=new CustomEvent("converse-loaded",{detail:{converse:t}});window.dispatchEvent(n)})()})();
//# sourceMappingURL=converse.min.js.map