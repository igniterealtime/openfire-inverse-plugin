/*! For license information please see converse.min.js.LICENSE.txt */
(()=>{var e,t,n,s,i={33:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},169:(e,t,n)=>{var s;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(e){return function(e,t){var n,s,o,a,c,l,d,u,h,f=1,m=e.length,g="";for(s=0;s<m;s++)if("string"==typeof e[s])g+=e[s];else if("object"==typeof e[s]){if((a=e[s]).keys)for(n=t[f],o=0;o<a.keys.length;o++){if(null==n)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?t[a.param_no]:t[f++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(r("[sprintf] expecting number but found %T",n));switch(i.number.test(a.type)&&(u=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?g+=n:(!i.number.test(a.type)||u&&!a.sign?h="":(h=u?"+":"-",n=n.toString().replace(i.sign,"")),l=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",d=a.width-(h+n).length,c=a.width&&d>0?l.repeat(d):"",g+=a.align?h+n+c:"0"===l?h+c+n:c+h+n)}return g}(function(e){if(a[e])return a[e];var t,n=e,s=[],r=0;for(;n;){if(null!==(t=i.text.exec(n)))s.push(t[0]);else if(null!==(t=i.modulo.exec(n)))s.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){r|=1;var o=[],c=t[2],l=[];if(null===(l=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(l[1]);""!==(c=c.substring(l[0].length));)if(null!==(l=i.key_access.exec(c)))o.push(l[1]);else{if(null===(l=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(l[1])}t[2]=o}else r|=2;if(3===r)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");s.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return a[e]=s}(e),arguments)}function o(e,t){return r.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=r,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=r,window.vsprintf=o,void 0===(s=function(){return{sprintf:r,vsprintf:o}}.call(t,n,t,e))||(e.exports=s))}()},190:(e,t,n)=>{"use strict";t.Ud=t.O5=void 0;var s,i=(s=n(8006))&&s.__esModule?s:{default:s},r=n(1519),o=n(4632),a=n(1910),c=n(1293);t.O5=function(e){var t=new Uint8Array(e);return(0,r.parse)((0,o.buildStream)(t),i.default)};var l=function(e,t,n){if(e.image){var s=e.image,i=s.descriptor.width*s.descriptor.height,r=(0,c.lzw)(s.data.minCodeSize,s.data.blocks,i);s.descriptor.lct.interlaced&&(r=(0,a.deinterlace)(r,s.descriptor.width));var o={pixels:r,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return s.descriptor.lct&&s.descriptor.lct.exists?o.colorTable=s.lct:o.colorTable=t,e.gce&&(o.delay=10*(e.gce.delay||10),o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),n&&(o.patch=function(e){for(var t=e.pixels.length,n=new Uint8ClampedArray(4*t),s=0;s<t;s++){var i=4*s,r=e.pixels[s],o=e.colorTable[r]||[0,0,0];n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2],n[i+3]=r!==e.transparentIndex?255:0}return n}(o)),o}console.warn("gif frame does not have associated image.")};t.Ud=function(e,t){return e.frames.filter((function(e){return e.image})).map((function(n){return l(n,e.gct,t)}))}},304:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},569:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},593:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},710:(e,t,n)=>{"use strict";var s=n(569);t.A=void 0;var i=(0,s(n(8663)).default)("webExtensionSyncStorage","sync");t.A=i},719:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},845:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},998:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1070:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1089:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1133:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",s=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),s&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),s&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,s,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);s&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},1205:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1293:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lzw=void 0;t.lzw=function(e,t,n){var s,i,r,o,a,c,l,d,u,h,f,m,g,p,v,b,y=4096,_=n,w=new Array(n),S=new Array(y),A=new Array(y),x=new Array(4097);for(a=(i=1<<(h=e))+1,s=i+2,l=-1,r=(1<<(o=h+1))-1,d=0;d<i;d++)S[d]=0,A[d]=d;for(f=m=g=p=v=b=0,u=0;u<_;){if(0===p){if(m<o){f+=t[b]<<m,m+=8,b++;continue}if(d=f&r,f>>=o,m-=o,d>s||d==a)break;if(d==i){r=(1<<(o=h+1))-1,s=i+2,l=-1;continue}if(-1==l){x[p++]=A[d],l=d,g=d;continue}for(c=d,d==s&&(x[p++]=g,d=l);d>i;)x[p++]=A[d],d=S[d];g=255&A[d],x[p++]=g,s<y&&(S[s]=l,A[s]=g,!(++s&r)&&s<y&&(o++,r+=s)),l=c}p--,w[v++]=x[p],u++}for(u=v;u<_;u++)w[u]=0;return w}},1353:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1425:(e,t)=>{var n,s;s=function(e){"use strict";e=e||{};var t,n,s,i,r,o,a,c,l,d,u,h,f,m,g={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:!1,element:null,dataUrl:!1,win:window};(h={}).ff="undefined"!=typeof InstallTrigger,h.chrome=!!window.chrome,h.opera=!!window.opera||navigator.userAgent.indexOf("Opera")>=0,h.ie=!1,h.safari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,h.supported=h.chrome||h.ff||h.opera;var p=[];u=function(){},c=!1;var v={ready:function(){c=!0,v.reset(),u()},reset:function(){c&&(p=[],l=!1,d=!1,o.clearRect(0,0,i,s),o.drawImage(a,0,0,i,s),_.setIcon(r),window.clearTimeout(f),window.clearTimeout(void 0))},start:function(){if(c&&!d&&p.length>0){d=!0;var e=function(){["type","animation","bgColor","textColor","fontFamily","fontStyle"].forEach((function(e){e in p[0].options&&(t[e]=p[0].options[e])})),A.run(p[0].options,(function(){l=p[0],d=!1,p.length>0&&(p.shift(),v.start())}),!1)};l?A.run(l.options,(function(){e()}),!0):e()}}},b={},y=function(e){return e.n="number"==typeof e.n?Math.abs(0|e.n):e.n,e.x=i*e.x,e.y=s*e.y,e.w=i*e.w,e.h=s*e.h,e.len=(""+e.n).length,e};b.circle=function(e){var n=!1;2===(e=y(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w,n=!0):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w,n=!0),o.clearRect(0,0,i,s),o.drawImage(a,0,0,i,s),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.85:1))+"px "+t.fontFamily,o.textAlign="center",n?(o.moveTo(e.x+e.w/2,e.y),o.lineTo(e.x+e.w-e.h/2,e.y),o.quadraticCurveTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h/2),o.lineTo(e.x+e.w,e.y+e.h-e.h/2),o.quadraticCurveTo(e.x+e.w,e.y+e.h,e.x+e.w-e.h/2,e.y+e.h),o.lineTo(e.x+e.h/2,e.y+e.h),o.quadraticCurveTo(e.x,e.y+e.h,e.x,e.y+e.h-e.h/2),o.lineTo(e.x,e.y+e.h/2),o.quadraticCurveTo(e.x,e.y,e.x+e.h/2,e.y)):o.arc(e.x+e.w/2,e.y+e.h/2,e.h/2,0,2*Math.PI),o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fill(),o.closePath(),o.beginPath(),o.stroke(),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()},b.rectangle=function(e){2===(e=y(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w),o.clearRect(0,0,i,s),o.drawImage(a,0,0,i,s),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.9:1))+"px "+t.fontFamily,o.textAlign="center",o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fillRect(e.x,e.y,e.w,e.h),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()};var _={};function w(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,s){return t+t+n+n+s+s}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!!t&&{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}function S(e,t){var n,s={};for(n in e)s[n]=e[n];for(n in t)s[n]=t[n];return s}_.getIcons=function(){var e=[];return t.element?e=[t.element]:t.elementId?(e=[m.getElementById(t.elementId)])[0].setAttribute("href",e[0].getAttribute("src")):0===(e=function(){for(var e=[],t=m.getElementsByTagName("head")[0].getElementsByTagName("link"),n=0;n<t.length;n++)/(^|\s)icon(\s|$)/i.test(t[n].getAttribute("rel"))&&e.push(t[n]);return e}()).length&&((e=[m.createElement("link")])[0].setAttribute("rel","icon"),m.getElementsByTagName("head")[0].appendChild(e[0])),e.forEach((function(e){e.setAttribute("type","image/png")})),e},_.setIcon=function(e){var t=e.toDataURL("image/png");_.setIconSrc(t)},_.setIconSrc=function(e){if(t.dataUrl&&t.dataUrl(e),t.element)t.element.setAttribute("href",e),t.element.setAttribute("src",e);else if(t.elementId){var s=m.getElementById(t.elementId);s.setAttribute("href",e),s.setAttribute("src",e)}else if(h.ff||h.opera){var i=n[n.length-1],r=m.createElement("link");n=[r],h.opera&&r.setAttribute("rel","icon"),r.setAttribute("rel","icon"),r.setAttribute("type","image/png"),m.getElementsByTagName("head")[0].appendChild(r),r.setAttribute("href",e),i.parentNode&&i.parentNode.removeChild(i)}else n.forEach((function(t){t.setAttribute("href",e)}))};var A={duration:40,types:{}};return A.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],A.run=function(e,n,s,i){var o=A.types[m.hidden||m.msHidden||m.webkitHidden||m.mozHidden?"none":t.animation];i=!0===s?void 0!==i?i:o.length-1:void 0!==i?i:0,n=n||function(){},i<o.length&&i>=0?(b[t.type](S(e,o[i])),f=setTimeout((function(){s?i-=1:i+=1,A.run(e,n,s,i)}),A.duration),_.setIcon(r)):n()},function(){(t=S(g,e)).bgColor=w(t.bgColor),t.textColor=w(t.textColor),t.position=t.position.toLowerCase(),t.animation=A.types[""+t.animation]?t.animation:g.animation,m=t.win.document;var c=t.position.indexOf("up")>-1,l=t.position.indexOf("left")>-1;if(c||l)for(var d in A.types)for(var u=0;u<A.types[d].length;u++){var h=A.types[d][u];c&&(h.y<.6?h.y=h.y-.4:h.y=h.y-2*h.y+(1-h.w)),l&&(h.x<.6?h.x=h.x-.4:h.x=h.x-2*h.x+(1-h.h)),A.types[d][u]=h}t.type=b[""+t.type]?t.type:g.type,n=_.getIcons(),r=document.createElement("canvas"),a=document.createElement("img");var f=n[n.length-1];f.hasAttribute("href")?(a.setAttribute("crossOrigin","anonymous"),a.onload=function(){s=a.height>0?a.height:32,i=a.width>0?a.width:32,r.height=s,r.width=i,o=r.getContext("2d"),v.ready()},a.setAttribute("src",f.getAttribute("href"))):(s=32,i=32,a.height=s,a.width=i,r.height=s,r.width=i,o=r.getContext("2d"),v.ready())}(),{badge:function(e,t){t=("string"==typeof t?{animation:t}:t)||{},u=function(){try{if("number"==typeof e?e>0:""!==e){var n={type:"badge",options:{n:e}};if("animation"in t&&A.types[""+t.animation]&&(n.options.animation=""+t.animation),"type"in t&&b[""+t.type]&&(n.options.type=""+t.type),["bgColor","textColor"].forEach((function(e){e in t&&(n.options[e]=w(t[e]))})),["fontStyle","fontFamily"].forEach((function(e){e in t&&(n.options[e]=t[e])})),p.push(n),p.length>100)throw new Error("Too many badges requests in queue.");v.start()}else v.reset()}catch(e){throw new Error("Error setting badge. Message: "+e.message)}},c&&u()},setOpt:function(e,n){var s=e;null==n&&"[object Object]"==Object.prototype.toString.call(e)||((s={})[e]=n);for(var i=Object.keys(s),r=0;r<i.length;r++)"bgColor"==i[r]||"textColor"==i[r]?t[i[r]]=w(s[i[r]]):t[i[r]]=s[i[r]];p.push(l),v.start()},reset:v.reset,browser:{supported:h.supported}}},void 0===(n=function(){return s}.apply(t,[]))||(e.exports=n)},1519:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loop=t.conditional=t.parse=void 0;t.parse=function e(t,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;if(Array.isArray(n))n.forEach((function(n){return e(t,n,s,i)}));else if("function"==typeof n)n(t,s,i,e);else{var r=Object.keys(n)[0];Array.isArray(n[r])?(i[r]={},e(t,n[r],s,i[r])):i[r]=n[r](t,s,i,e)}return s};t.conditional=function(e,t){return function(n,s,i,r){t(n,s,i)&&r(n,e,s,i)}};t.loop=function(e,t){return function(n,s,i,r){for(var o=[],a=n.pos;t(n,s,i);){var c={};if(r(n,e,s,c),n.pos===a)break;a=n.pos,o.push(c)}return o}}},1702:(e,t,n)=>{"use strict";var s=n(569);t.A=void 0;var i=(0,s(n(8663)).default)("webExtensionLocalStorage","local");t.A=i},1709:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1742:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1910:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinterlace=void 0;t.deinterlace=function(e,t){for(var n=new Array(e.length),s=e.length/t,i=function(s,i){var r=e.slice(i*t,(i+1)*t);n.splice.apply(n,[s*t,t].concat(r))},r=[0,4,2,1],o=[8,8,4,2],a=0,c=0;c<4;c++)for(var l=r[c];l<s;l+=o[c])i(l,a),a++;return n}},1943:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),r="/*# ".concat(i," */");return[t].concat([r]).join("\n")}return[t].join("\n")}},1946:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2081:(e,t,n)=>{var s;!function(i){var r,o,a,c,l,d,u,h,f,m,g,p,v,b,y,_,w,S,A,x="sizzle"+1*new Date,$=i.document,E=0,j=0,C=he(),k=he(),T=he(),O=he(),N=function(e,t){return e===t&&(g=!0),0},M={}.hasOwnProperty,I=[],R=I.pop,D=I.push,z=I.push,L=I.slice,P=function(e,t){for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1},U="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",q="(?:\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",F="\\["+B+"*("+q+")(?:"+B+"*([*^$|!~]?=)"+B+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+B+"*\\]",H=":("+q+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",G=new RegExp(B+"+","g"),W=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),V=new RegExp("^"+B+"*,"+B+"*"),K=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),J=new RegExp(B+"|>"),Y=new RegExp(H),X=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+q+")"),CLASS:new RegExp("^\\.("+q+")"),TAG:new RegExp("^("+q+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+U+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,ne=/^[^{]+\{\s*\[native \w/,se=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ie=/[+~]/,re=new RegExp("\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},le=function(){p()},de=xe((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{z.apply(I=L.call($.childNodes),$.childNodes),I[$.childNodes.length].nodeType}catch(e){z={apply:I.length?function(e,t){D.apply(e,L.call(t))}:function(e,t){for(var n=e.length,s=0;e[n++]=t[s++];);e.length=n-1}}}function ue(e,t,n,s){var i,r,a,c,l,u,f,m=t&&t.ownerDocument,g=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==g&&9!==g&&11!==g)return n;if(!s&&(p(t),t=t||v,y)){if(11!==g&&(l=se.exec(e)))if(i=l[1]){if(9===g){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(m&&(a=m.getElementById(i))&&A(t,a)&&a.id===i)return n.push(a),n}else{if(l[2])return z.apply(n,t.getElementsByTagName(e)),n;if((i=l[3])&&o.getElementsByClassName&&t.getElementsByClassName)return z.apply(n,t.getElementsByClassName(i)),n}if(o.qsa&&!O[e+" "]&&(!_||!_.test(e))&&(1!==g||"object"!==t.nodeName.toLowerCase())){if(f=e,m=t,1===g&&(J.test(e)||K.test(e))){for((m=ie.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=x)),r=(u=d(e)).length;r--;)u[r]=(c?"#"+c:":scope")+" "+Ae(u[r]);f=u.join(",")}try{return z.apply(n,m.querySelectorAll(f)),n}catch(t){O(e,!0)}finally{c===x&&t.removeAttribute("id")}}}return h(e.replace(W,"$1"),t,n,s)}function he(){var e=[];return function t(n,s){return e.push(n+" ")>a.cacheLength&&delete t[e.shift()],t[n+" "]=s}}function fe(e){return e[x]=!0,e}function me(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ge(e,t){for(var n=e.split("|"),s=n.length;s--;)a.attrHandle[n[s]]=t}function pe(e,t){var n=t&&e,s=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(s)return s;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function be(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ye(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&de(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function _e(e){return fe((function(t){return t=+t,fe((function(n,s){for(var i,r=e([],n.length,t),o=r.length;o--;)n[i=r[o]]&&(n[i]=!(s[i]=n[i]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(r in o=ue.support={},l=ue.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},p=ue.setDocument=function(e){var t,n,s=e?e.ownerDocument||e:$;return s!=v&&9===s.nodeType&&s.documentElement?(b=(v=s).documentElement,y=!l(v),$!=v&&(n=v.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",le,!1):n.attachEvent&&n.attachEvent("onunload",le)),o.scope=me((function(e){return b.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.cssHas=me((function(){try{return v.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),o.attributes=me((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=me((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=ne.test(v.getElementsByClassName),o.getById=me((function(e){return b.appendChild(e).id=x,!v.getElementsByName||!v.getElementsByName(x).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,s,i,r=t.getElementById(e);if(r){if((n=r.getAttributeNode("id"))&&n.value===e)return[r];for(i=t.getElementsByName(e),s=0;r=i[s++];)if((n=r.getAttributeNode("id"))&&n.value===e)return[r]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,s=[],i=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[i++];)1===n.nodeType&&s.push(n);return s}return r},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},w=[],_=[],(o.qsa=ne.test(v.querySelectorAll))&&(me((function(e){var t;b.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&_.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||_.push("\\["+B+"*(?:value|"+U+")"),e.querySelectorAll("[id~="+x+"-]").length||_.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||_.push("\\["+B+"*name"+B+"*="+B+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||_.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||_.push(".#.+[+~]"),e.querySelectorAll("\\\f"),_.push("[\\r\\n\\f]")})),me((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&_.push("name"+B+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&_.push(":enabled",":disabled"),b.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&_.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),_.push(",.*:")}))),(o.matchesSelector=ne.test(S=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.oMatchesSelector||b.msMatchesSelector))&&me((function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",H)})),o.cssHas||_.push(":has"),_=_.length&&new RegExp(_.join("|")),w=w.length&&new RegExp(w.join("|")),t=ne.test(b.compareDocumentPosition),A=t||ne.test(b.contains)?function(e,t){var n=9===e.nodeType&&e.documentElement||e,s=t&&t.parentNode;return e===s||!(!s||1!==s.nodeType||!(n.contains?n.contains(s):e.compareDocumentPosition&&16&e.compareDocumentPosition(s)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return g=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===n?e==v||e.ownerDocument==$&&A($,e)?-1:t==v||t.ownerDocument==$&&A($,t)?1:m?P(m,e)-P(m,t):0:4&n?-1:1)}:function(e,t){if(e===t)return g=!0,0;var n,s=0,i=e.parentNode,r=t.parentNode,o=[e],a=[t];if(!i||!r)return e==v?-1:t==v?1:i?-1:r?1:m?P(m,e)-P(m,t):0;if(i===r)return pe(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;o[s]===a[s];)s++;return s?pe(o[s],a[s]):o[s]==$?-1:a[s]==$?1:0},v):v},ue.matches=function(e,t){return ue(e,null,null,t)},ue.matchesSelector=function(e,t){if(p(e),o.matchesSelector&&y&&!O[t+" "]&&(!w||!w.test(t))&&(!_||!_.test(t)))try{var n=S.call(e,t);if(n||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){O(t,!0)}return ue(t,v,null,[e]).length>0},ue.contains=function(e,t){return(e.ownerDocument||e)!=v&&p(e),A(e,t)},ue.attr=function(e,t){(e.ownerDocument||e)!=v&&p(e);var n=a.attrHandle[t.toLowerCase()],s=n&&M.call(a.attrHandle,t.toLowerCase())?n(e,t,!y):void 0;return void 0!==s?s:o.attributes||!y?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ue.escape=function(e){return(e+"").replace(ae,ce)},ue.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ue.uniqueSort=function(e){var t,n=[],s=0,i=0;if(g=!o.detectDuplicates,m=!o.sortStable&&e.slice(0),e.sort(N),g){for(;t=e[i++];)t===e[i]&&(s=n.push(i));for(;s--;)e.splice(n[s],1)}return m=null,e},c=ue.getText=function(e){var t,n="",s=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=c(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[s++];)n+=c(t);return n},a=ue.selectors={cacheLength:50,createPseudo:fe,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(re,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(re,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ue.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ue.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Y.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(re,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=C[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&C(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(s){var i=ue.attr(s,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(G," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,s,i){var r="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===s&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var l,d,u,h,f,m,g=r!==o?"nextSibling":"previousSibling",p=t.parentNode,v=a&&t.nodeName.toLowerCase(),b=!c&&!a,y=!1;if(p){if(r){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;m=g="only"===e&&!m&&"nextSibling"}return!0}if(m=[o?p.firstChild:p.lastChild],o&&b){for(y=(f=(l=(d=(u=(h=p)[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===E&&l[1])&&l[2],h=f&&p.childNodes[f];h=++f&&h&&h[g]||(y=f=0)||m.pop();)if(1===h.nodeType&&++y&&h===t){d[e]=[E,f,y];break}}else if(b&&(y=f=(l=(d=(u=(h=t)[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===E&&l[1]),!1===y)for(;(h=++f&&h&&h[g]||(y=f=0)||m.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++y||(b&&((d=(u=h[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[E,y]),h!==t)););return(y-=i)===s||y%s==0&&y/s>=0}}},PSEUDO:function(e,t){var n,s=a.pseudos[e]||a.setFilters[e.toLowerCase()]||ue.error("unsupported pseudo: "+e);return s[x]?s(t):s.length>1?(n=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?fe((function(e,n){for(var i,r=s(e,t),o=r.length;o--;)e[i=P(e,r[o])]=!(n[i]=r[o])})):function(e){return s(e,0,n)}):s}},pseudos:{not:fe((function(e){var t=[],n=[],s=u(e.replace(W,"$1"));return s[x]?fe((function(e,t,n,i){for(var r,o=s(e,null,i,[]),a=e.length;a--;)(r=o[a])&&(e[a]=!(t[a]=r))})):function(e,i,r){return t[0]=e,s(t,null,r,n),t[0]=null,!n.pop()}})),has:fe((function(e){return function(t){return ue(e,t).length>0}})),contains:fe((function(e){return e=e.replace(re,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:fe((function(e){return X.test(e||"")||ue.error("unsupported lang: "+e),e=e.replace(re,oe).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===b},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:_e((function(){return[0]})),last:_e((function(e,t){return[t-1]})),eq:_e((function(e,t,n){return[n<0?n+t:n]})),even:_e((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:_e((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:_e((function(e,t,n){for(var s=n<0?n+t:n>t?t:n;--s>=0;)e.push(s);return e})),gt:_e((function(e,t,n){for(var s=n<0?n+t:n;++s<t;)e.push(s);return e}))}},a.pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[r]=ve(r);for(r in{submit:!0,reset:!0})a.pseudos[r]=be(r);function Se(){}function Ae(e){for(var t=0,n=e.length,s="";t<n;t++)s+=e[t].value;return s}function xe(e,t,n){var s=t.dir,i=t.next,r=i||s,o=n&&"parentNode"===r,a=j++;return t.first?function(t,n,i){for(;t=t[s];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var l,d,u,h=[E,a];if(c){for(;t=t[s];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[s];)if(1===t.nodeType||o)if(d=(u=t[x]||(t[x]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[s]||t;else{if((l=d[r])&&l[0]===E&&l[1]===a)return h[2]=l[2];if(d[r]=h,h[2]=e(t,n,c))return!0}return!1}}function $e(e){return e.length>1?function(t,n,s){for(var i=e.length;i--;)if(!e[i](t,n,s))return!1;return!0}:e[0]}function Ee(e,t,n,s,i){for(var r,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(r=e[a])&&(n&&!n(r,s,i)||(o.push(r),l&&t.push(a)));return o}function je(e,t,n,s,i,r){return s&&!s[x]&&(s=je(s)),i&&!i[x]&&(i=je(i,r)),fe((function(r,o,a,c){var l,d,u,h=[],f=[],m=o.length,g=r||function(e,t,n){for(var s=0,i=t.length;s<i;s++)ue(e,t[s],n);return n}(t||"*",a.nodeType?[a]:a,[]),p=!e||!r&&t?g:Ee(g,h,e,a,c),v=n?i||(r?e:m||s)?[]:o:p;if(n&&n(p,v,a,c),s)for(l=Ee(v,f),s(l,[],a,c),d=l.length;d--;)(u=l[d])&&(v[f[d]]=!(p[f[d]]=u));if(r){if(i||e){if(i){for(l=[],d=v.length;d--;)(u=v[d])&&l.push(p[d]=u);i(null,v=[],l,c)}for(d=v.length;d--;)(u=v[d])&&(l=i?P(r,u):h[d])>-1&&(r[l]=!(o[l]=u))}}else v=Ee(v===o?v.splice(m,v.length):v),i?i(null,o,v,c):z.apply(o,v)}))}function Ce(e){for(var t,n,s,i=e.length,r=a.relative[e[0].type],o=r||a.relative[" "],c=r?1:0,l=xe((function(e){return e===t}),o,!0),d=xe((function(e){return P(t,e)>-1}),o,!0),u=[function(e,n,s){var i=!r&&(s||n!==f)||((t=n).nodeType?l(e,n,s):d(e,n,s));return t=null,i}];c<i;c++)if(n=a.relative[e[c].type])u=[xe($e(u),n)];else{if((n=a.filter[e[c].type].apply(null,e[c].matches))[x]){for(s=++c;s<i&&!a.relative[e[s].type];s++);return je(c>1&&$e(u),c>1&&Ae(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(W,"$1"),n,c<s&&Ce(e.slice(c,s)),s<i&&Ce(e=e.slice(s)),s<i&&Ae(e))}u.push(n)}return $e(u)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,d=ue.tokenize=function(e,t){var n,s,i,r,o,c,l,d=k[e+" "];if(d)return t?0:d.slice(0);for(o=e,c=[],l=a.preFilter;o;){for(r in n&&!(s=V.exec(o))||(s&&(o=o.slice(s[0].length)||o),c.push(i=[])),n=!1,(s=K.exec(o))&&(n=s.shift(),i.push({value:n,type:s[0].replace(W," ")}),o=o.slice(n.length)),a.filter)!(s=Q[r].exec(o))||l[r]&&!(s=l[r](s))||(n=s.shift(),i.push({value:n,type:r,matches:s}),o=o.slice(n.length));if(!n)break}return t?o.length:o?ue.error(e):k(e,c).slice(0)},u=ue.compile=function(e,t){var n,s=[],i=[],r=T[e+" "];if(!r){for(t||(t=d(e)),n=t.length;n--;)(r=Ce(t[n]))[x]?s.push(r):i.push(r);r=T(e,function(e,t){var n=t.length>0,s=e.length>0,i=function(i,r,o,c,l){var d,u,h,m=0,g="0",b=i&&[],_=[],w=f,S=i||s&&a.find.TAG("*",l),A=E+=null==w?1:Math.random()||.1,x=S.length;for(l&&(f=r==v||r||l);g!==x&&null!=(d=S[g]);g++){if(s&&d){for(u=0,r||d.ownerDocument==v||(p(d),o=!y);h=e[u++];)if(h(d,r||v,o)){c.push(d);break}l&&(E=A)}n&&((d=!h&&d)&&m--,i&&b.push(d))}if(m+=g,n&&g!==m){for(u=0;h=t[u++];)h(b,_,r,o);if(i){if(m>0)for(;g--;)b[g]||_[g]||(_[g]=R.call(c));_=Ee(_)}z.apply(c,_),l&&!i&&_.length>0&&m+t.length>1&&ue.uniqueSort(c)}return l&&(E=A,f=w),b};return n?fe(i):i}(i,s)),r.selector=e}return r},h=ue.select=function(e,t,n,s){var i,r,o,c,l,h="function"==typeof e&&e,f=!s&&d(e=h.selector||e);if(n=n||[],1===f.length){if((r=f[0]=f[0].slice(0)).length>2&&"ID"===(o=r[0]).type&&9===t.nodeType&&y&&a.relative[r[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(re,oe),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(i=Q.needsContext.test(e)?0:r.length;i--&&(o=r[i],!a.relative[c=o.type]);)if((l=a.find[c])&&(s=l(o.matches[0].replace(re,oe),ie.test(r[0].type)&&we(t.parentNode)||t))){if(r.splice(i,1),!(e=s.length&&Ae(r)))return z.apply(n,s),n;break}}return(h||u(e,f))(s,t,!y,n,!t||ie.test(e)&&we(t.parentNode)||t),n},o.sortStable=x.split("").sort(N).join("")===x,o.detectDuplicates=!!g,p(),o.sortDetached=me((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),me((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ge("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&me((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ge("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),me((function(e){return null==e.getAttribute("disabled")}))||ge(U,(function(e,t,n){var s;if(!n)return!0===e[t]?t.toLowerCase():(s=e.getAttributeNode(t))&&s.specified?s.value:null}));var ke=i.Sizzle;ue.noConflict=function(){return i.Sizzle===ue&&(i.Sizzle=ke),ue},void 0===(s=function(){return ue}.call(t,n,t,e))||(e.exports=s)}(window)},2470:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2579:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2778:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2852:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2995:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3015:(e,t,n)=>{var s=n(4227).default,i=n(7698);e.exports=function(e){var t=i(e,"string");return"symbol"==s(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},3134:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t="localforage-driver-memory";function n(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function s(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}}var i=/^~~local_forage_type~([^~]+)~/,r=9,o=r+4,a=Object.prototype.toString;function c(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var s=new ArrayBuffer(t),i=new Uint8Array(s),r=0,o=0;r<n;r+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|l>>2,i[o++]=(3&l)<<6|63&d}return s}function l(e){for(var t=new Uint8Array(e),n="",s=0;s<t.length;s+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[s]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[s])<<4|t[s+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[s+1])<<2|t[s+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[s+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function d(e,t){var n="";if(e&&(n=a.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===a.call(e.buffer))){var s=void 0,i="__lfsc__:";e instanceof ArrayBuffer?(s=e,i+="arbf"):(s=e.buffer,"[object Int8Array]"===n?i+="si08":"[object Uint8Array]"===n?i+="ui08":"[object Uint8ClampedArray]"===n?i+="uic8":"[object Int16Array]"===n?i+="si16":"[object Uint16Array]"===n?i+="ur16":"[object Int32Array]"===n?i+="si32":"[object Uint32Array]"===n?i+="ui32":"[object Float32Array]"===n?i+="fl32":"[object Float64Array]"===n?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+l(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n="~~local_forage_type~"+e.type+"~"+l(this.result);t("__lfsc__:blob"+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function u(e){if("__lfsc__:"!==e.substring(0,r))return JSON.parse(e);var t,n=e.substring(o),a=e.substring(r,o);if("blob"===a&&i.test(n)){var l=n.match(i);t=l[1],n=n.substring(l[0].length)}var d=c(n);switch(a){case"arbf":return d;case"blob":return s([d],{type:t});case"si08":return new Int8Array(d);case"ui08":return new Uint8Array(d);case"uic8":return new Uint8ClampedArray(d);case"si16":return new Int16Array(d);case"ur16":return new Uint16Array(d);case"si32":return new Int32Array(d);case"ui32":return new Uint32Array(d);case"fl32":return new Float32Array(d);case"fl64":return new Float64Array(d);default:throw new Error("Unkown type: "+a)}}function h(e){var t,s;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var i=e instanceof Date?new Date(e):e.constructor();try{for(var r=n(Object.keys(e)),o=r.next();!o.done;o=r.next()){var a=o.value;Object.prototype.hasOwnProperty.call(e,a)&&(e.isActiveClone=null,i[a]=h(e[a]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(s=r.return)&&s.call(r)}finally{if(t)throw t.error}}return i}function f(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function m(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function g(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function p(e,t){var n=this;if(t=g.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var s=this.config();e.name=e.name||s.name,e.storeName=e.storeName||s.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(f(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function v(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var b={bufferToString:l,deserialize:u,serialize:d,stringToBuffer:c},y={},_=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return y[t]||(y[t]=new e(t)),y[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete y[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function w(e){var t=e?h(e):{},n=f(t,this._defaultConfig),s=_.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=b,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=s,Promise.resolve()}function S(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return m(n,e),n}function A(e,t){var n=p.apply(this,arguments),s=n.promise,i=n.callback;return m(s.then((function(e){_.resolve(e).drop()})),i),s}function x(e,t){var n=this;e=v(e);var s=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return m(s,t),s}function $(e,t){var n=this,s=this.ready().then((function(){for(var t=n._dbInfo.mStore,s=t.keys(),i=0;i<s.length;i++){var r=t.get(s[i]);if(r&&(r=n._dbInfo.serializer.deserialize(r)),void 0!==(r=e(r,s[i],i+1)))return r}}));return m(s,t),s}function E(e,t){var n=this,s=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return m(s,t),s}function j(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return m(n,e),n}function C(e){var t=this.keys().then((function(e){return e.length}));return m(t,e),t}function k(e,t){var n=this;e=v(e);var s=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return m(s,t),s}function T(e,t,n){var s=this;e=v(e);var i=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(i,r){s._dbInfo.serializer.serialize(t,(function(t,o){if(o)r(o);else try{s._dbInfo.mStore.set(e,t),i(n)}catch(e){r(e)}}))}))}));return m(i,n),i}var O=!0;e._support=O,e._driver=t,e._initStorage=w,e.clear=S,e.dropInstance=A,e.getItem=x,e.iterate=$,e.key=E,e.keys=j,e.length=C,e.removeItem=k,e.setItem=T,Object.defineProperty(e,"__esModule",{value:!0})}(t)},3195:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3363:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3370:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3403:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3414:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3546:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3557:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3796:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3883:(e,t,n)=>{var s={"./af/LC_MESSAGES/converse.po":[5544,4267],"./ar/LC_MESSAGES/converse.po":[788,5743],"./be/LC_MESSAGES/converse.po":[9174,1437],"./bg/LC_MESSAGES/converse.po":[9088,6179],"./ca/LC_MESSAGES/converse.po":[6929,962],"./cs/LC_MESSAGES/converse.po":[4359,8252],"./da/LC_MESSAGES/converse.po":[1712,6963],"./de/LC_MESSAGES/converse.po":[7532,6311],"./el/LC_MESSAGES/converse.po":[6202,345],"./eo/LC_MESSAGES/converse.po":[7653,7494],"./es/LC_MESSAGES/converse.po":[8209,4202],"./eu/LC_MESSAGES/converse.po":[4147,2168],"./fa/LC_MESSAGES/converse.po":[4750,453],"./fi/LC_MESSAGES/converse.po":[6742,3613],"./fr/LC_MESSAGES/converse.po":[2889,3698],"./gl/LC_MESSAGES/converse.po":[2504,2787],"./he/LC_MESSAGES/converse.po":[5424,8227],"./hi/LC_MESSAGES/converse.po":[7140,799],"./hu/LC_MESSAGES/converse.po":[1520,9139],"./id/LC_MESSAGES/converse.po":[4326,4749],"./it/LC_MESSAGES/converse.po":[8854,6109],"./ja/LC_MESSAGES/converse.po":[762,3881],"./ko/LC_MESSAGES/converse.po":[6227,528],"./lt/LC_MESSAGES/converse.po":[8261,1462],"./mr/LC_MESSAGES/converse.po":[2251,507],"./nb/LC_MESSAGES/converse.po":[6529,9562],"./nl/LC_MESSAGES/converse.po":[347,4336],"./nl_BE/LC_MESSAGES/converse.po":[2361,290],"./oc/LC_MESSAGES/converse.po":[107,7576],"./pl/LC_MESSAGES/converse.po":[2993,7370],"./pt/LC_MESSAGES/converse.po":[3385,2546],"./pt_BR/LC_MESSAGES/converse.po":[3096,4315],"./ro/LC_MESSAGES/converse.po":[9576,1963],"./ru/LC_MESSAGES/converse.po":[6166,6733],"./si/LC_MESSAGES/converse.po":[8553,8714],"./sq/LC_MESSAGES/converse.po":[8785,4146],"./sv/LC_MESSAGES/converse.po":[6850,6345],"./ta/LC_MESSAGES/converse.po":[2608,5283],"./th/LC_MESSAGES/converse.po":[3161,3330],"./tr/LC_MESSAGES/converse.po":[9815,548],"./ug/LC_MESSAGES/converse.po":[1661,2894],"./uk/LC_MESSAGES/converse.po":[3689,8898],"./vi/LC_MESSAGES/converse.po":[358,221],"./zh_CN/LC_MESSAGES/converse.po":[5645,6550],"./zh_TW/LC_MESSAGES/converse.po":[5097,8986]};function i(e){if(!n.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,19)))}i.keys=()=>Object.keys(s),i.id=3883,e.exports=i},3952:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4200:(e,t,n)=>{var s=n(3015);e.exports=function(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},4227:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4399:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4563:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4632:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readBits=t.readArray=t.readUnsigned=t.readString=t.peekBytes=t.readBytes=t.peekByte=t.readByte=t.buildStream=void 0;t.buildStream=function(e){return{data:e,pos:0}};var n=function(){return function(e){return e.data[e.pos++]}};t.readByte=n;t.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){return t.data[t.pos+e]}};var s=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};t.readBytes=s;t.peekBytes=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}};t.readString=function(e){return function(t){return Array.from(s(e)(t)).map((function(e){return String.fromCharCode(e)})).join("")}};t.readUnsigned=function(e){return function(t){var n=s(2)(t);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};t.readArray=function(e,t){return function(n,i,r){for(var o="function"==typeof t?t(n,i,r):t,a=s(e),c=new Array(o),l=0;l<o;l++)c[l]=a(n);return c}};t.readBits=function(e){return function(t){for(var n=function(e){return e.data[e.pos++]}(t),s=new Array(8),i=0;i<8;i++)s[7-i]=!!(n&1<<i);return Object.keys(e).reduce((function(t,n){var i=e[n];return i.length?t[n]=function(e,t,n){for(var s=0,i=0;i<n;i++)s+=e[t+i]&&Math.pow(2,n-i-1);return s}(s,i.index,i.length):t[n]=s[i.index],t}),{})}}},4641:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4647:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4659:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4734:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4842:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4912:(e,t)=>{"use strict";function n(){return"undefined"!=typeof browser&&browser.storage||"undefined"!=typeof chrome&&chrome.storage}Object.defineProperty(t,"__esModule",{value:!0}),t.getStorage=n,t.usePromise=function(e,t){if(function(){var e=n();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}())return e(t);return new Promise((function(n){e(t,(function(){n.apply(void 0,arguments)}))}))}},4968:e=>{function t(e,t,n,s,i,r,o){try{var a=e[r](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(s,i)}e.exports=function(e){return function(){var n=this,s=arguments;return new Promise((function(i,r){var o=e.apply(n,s);function a(e){t(o,i,r,a,c,"next",e)}function c(e){t(o,i,r,a,c,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},5056:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},5072:e=>{"use strict";var t=[];function n(e){for(var n=-1,s=0;s<t.length;s++)if(t[s].identifier===e){n=s;break}return n}function s(e,s){for(var r={},o=[],a=0;a<e.length;a++){var c=e[a],l=s.base?c[0]+s.base:c[0],d=r[l]||0,u="".concat(l," ").concat(d);r[l]=d+1;var h=n(u),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)t[h].references++,t[h].updater(f);else{var m=i(f,s);s.byIndex=a,t.splice(a,0,{identifier:u,updater:m,references:1})}o.push(u)}return o}function i(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=s(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=n(r[o]);t[a].references--}for(var c=s(e,i),l=0;l<r.length;l++){var d=n(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},5190:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5299:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Dz});var s={};n.r(s),n.d(s,{isError:()=>Us,isErrorObject:()=>Fs,isFunction:()=>Bs,isPersistableModel:()=>Hs,isUndefined:()=>qs,merge:()=>Ps});var i={};n.r(i),n.d(i,{clearSession:()=>ni,getUnloadEvent:()=>Qs,isTestEnv:()=>Xs,isUniView:()=>Ys,replacePromise:()=>Zs,shouldClearCache:()=>ei,tearDown:()=>ti});var r={};n.r(r),n.d(r,{DOMParser:()=>ii,WebSocket:()=>si,getDummyXMLDOMDocument:()=>ri});var o={};n.r(o),n.d(o,{addCookies:()=>Si,arrayBufToBase64:()=>yi,base64ToArrayBuf:()=>_i,copyElement:()=>Ri,createHtml:()=>Ii,default:()=>Vi,escapeNode:()=>Bi,forEachChild:()=>Li,getBareJidFromJid:()=>Wi,getDomainFromJid:()=>Hi,getFirstElementChild:()=>ki,getNodeFromJid:()=>Fi,getParserError:()=>Ci,getResourceFromJid:()=>Gi,getText:()=>Ui,handleError:()=>pi,isTagEqual:()=>Pi,stringToArrayBuf:()=>wi,stripWhitespace:()=>Ei,toElement:()=>gi,unescapeNode:()=>qi,utf16to8:()=>vi,validAttribute:()=>Ni,validCSS:()=>Mi,validTag:()=>Oi,xmlElement:()=>Ti,xmlGenerator:()=>xi,xmlHtmlNode:()=>ji,xmlTextNode:()=>$i,xmlescape:()=>Di,xmlunescape:()=>zi,xorArrayBuffers:()=>bi});var a={};n.r(a),n.d(a,{ACTIVE:()=>Wr,ANONYMOUS:()=>Dr,BOSH_WAIT:()=>Tr,CHATROOMS_TYPE:()=>Xr,CHAT_STATES:()=>no,CLOSED:()=>zr,COMPOSING:()=>Vr,CONNECTION_STATUS:()=>eo,CONTROLBOX_TYPE:()=>Zr,CORE_PLUGINS:()=>to,EXTERNAL:()=>Lr,FAILURE:()=>Hr,GONE:()=>Jr,HEADLINES_TYPE:()=>Qr,INACTIVE:()=>Gr,KEYCODES:()=>io,LOGIN:()=>Pr,LOGOUT:()=>Ur,MARKER_TYPES:()=>so,METADATA_ATTRIBUTES:()=>Rr,OPENED:()=>Br,PAUSED:()=>Kr,PREBIND:()=>qr,PRES_SHOW_VALUES:()=>Nr,PRES_TYPE_VALUES:()=>Mr,PRIVATE_CHAT_TYPE:()=>Yr,STATUS_WEIGHTS:()=>Ir,SUCCESS:()=>Fr,VERSION_NAME:()=>Or,XFORM_TYPE_MAP:()=>ro,XFORM_VALIDATE_TYPE_MAP:()=>oo});var c={};n.r(c),n.d(c,{createStore:()=>Dc,getDefaultStore:()=>Ic,initStorage:()=>zc});var l={};n.r(l),n.d(l,{getJIDFromURI:()=>Fc,isOwnJID:()=>Hc,isSameBareJID:()=>Bc,isSameDomain:()=>qc,isValidJID:()=>Pc,isValidMUCJID:()=>Uc});var d={};n.r(d),n.d(d,{attemptNonPreboundSession:()=>tl,cleanup:()=>Zc,initClientConfig:()=>Wc,initPersistentStorage:()=>Kc,initPlugins:()=>Gc,initSession:()=>Xc,initSessionStorage:()=>Vc,registerGlobalEventHandlers:()=>Qc,safeSave:()=>il,savedLoginInfo:()=>nl,setUserJID:()=>Yc});var u={};n.r(u),n.d(u,{debounce:()=>ul,getOpenPromise:()=>re,waitUntil:()=>fl});var h={};n.r(h),n.d(h,{BadRequestError:()=>yl,ConflictError:()=>_l,FeatureNotImplementedError:()=>wl,ForbiddenError:()=>Sl,GoneError:()=>Al,InternalServerError:()=>xl,ItemNotFoundError:()=>$l,JIDMalformedError:()=>El,MethodNotImplementedError:()=>gl,NotAcceptableError:()=>jl,NotAllowedError:()=>Cl,NotAuthorizedError:()=>kl,PaymentRequiredError:()=>Tl,RecipientUnavailableError:()=>Ol,RedirectError:()=>Nl,RegistrationRequiredError:()=>Ml,RemoteServerNotFoundError:()=>Il,RemoteServerTimeoutError:()=>Rl,ResourceConstraintError:()=>Dl,ServiceUnavailableError:()=>zl,StanzaError:()=>vl,StanzaParseError:()=>bl,SubscriptionRequiredError:()=>Ll,TimeoutError:()=>pl,UndefinedConditionError:()=>Pl,UnexpectedRequestError:()=>Ul});var f={};n.r(f),n.d(f,{decodeHTMLEntities:()=>yu,isElement:()=>fu,isTagEqual:()=>mu,queryChildren:()=>pu,siblingIndex:()=>vu,stringToElement:()=>gu});var m={};n.r(m),n.d(m,{getAttributes:()=>Au,isErrorStanza:()=>_u,isForbiddenError:()=>wu,isServiceUnavailableError:()=>Su,toStanza:()=>kr});var g={};n.r(g),n.d(g,{unique:()=>Gh});var p={};n.r(p),n.d(p,{appendArrayBuffer:()=>Wh,arrayBufferToBase64:()=>Yh,arrayBufferToHex:()=>Vh,arrayBufferToString:()=>Kh,base64ToArrayBuffer:()=>Xh,hexToArrayBuffer:()=>Qh,stringToArrayBuffer:()=>Jh});var v={};n.r(v),n.d(v,{colorize:()=>tf});var b={};n.r(b),n.d(b,{getCurrentWord:()=>af,getSelectValues:()=>rf,isMentionBoundary:()=>cf,placeCaretAtEnd:()=>df,replaceCurrentWord:()=>lf,webForm2xForm:()=>of});var y={};n.r(y),n.d(y,{firstCharToUpperCase:()=>uf,getLongestSubstring:()=>hf,isString:()=>ff});var _={};n.r(_),n.d(_,{addMediaURLsOffset:()=>Tf,checkFileTypes:()=>bf,getHeaders:()=>Ef,getMediaURLs:()=>kf,getMediaURLsMetadata:()=>Cf,getMetadataForURL:()=>jf,getURL:()=>vf,isAudioURL:()=>wf,isEncryptedFileURL:()=>xf,isGIFURL:()=>_f,isImageURL:()=>Af,isURLWithImageExtension:()=>yf,isValidURL:()=>pf,isVideoURL:()=>Sf,withinString:()=>$f});var w={};n.r(w),n.d(w,{ACTION_INFO_CODES:()=>vg,ADMIN_COMMANDS:()=>yg,AFFILIATIONS:()=>_g,AFFILIATION_CHANGES:()=>Cg,AFFILIATION_CHANGES_LIST:()=>kg,DISCONNECT_CODES:()=>wg,INFO_CODES:()=>Ig,MODERATOR_COMMANDS:()=>Sg,MUC_NICK_CHANGED_CODE:()=>zg,MUC_ROLE_CHANGES:()=>Ng,MUC_ROLE_CHANGES_LIST:()=>Mg,MUC_ROLE_WEIGHTS:()=>jg,MUC_TRAFFIC_STATES:()=>Tg,MUC_TRAFFIC_STATES_LIST:()=>Og,NEW_NICK_CODES:()=>bg,OWNER_COMMANDS:()=>Ag,ROLES:()=>xg,ROOMSTATUS:()=>Rg,ROOM_FEATURES:()=>Dg,STATUS_CODE_STANZAS:()=>Eg,VISITOR_COMMANDS:()=>$g});var S={};n.r(S),n.d(S,{addClass:()=>Sw,ancestor:()=>$w,default:()=>Mw,getFileName:()=>yw,getHyperlinkTemplate:()=>Ew,getNameAndValue:()=>bw,getOuterWidth:()=>Tw,getRootElement:()=>Nw,hasClass:()=>ww,removeClass:()=>Aw,removeElement:()=>xw,slideIn:()=>Cw,slideOut:()=>jw,xFormField2TemplateResult:()=>kw});var A={};n.r(A),n.d(A,{afterMain:()=>iS,afterRead:()=>tS,afterWrite:()=>aS,applyStyles:()=>mS,arrow:()=>IS,auto:()=>Fw,basePlacements:()=>Hw,beforeMain:()=>nS,beforeRead:()=>Zw,beforeWrite:()=>rS,bottom:()=>Uw,clippingParents:()=>Vw,computeStyles:()=>LS,createPopper:()=>mA,createPopperBase:()=>fA,createPopperLite:()=>gA,detectOverflow:()=>eA,end:()=>Ww,eventListeners:()=>US,flip:()=>tA,hide:()=>iA,left:()=>qw,main:()=>sS,modifierPhases:()=>cS,offset:()=>rA,placements:()=>Qw,popper:()=>Jw,popperGenerator:()=>hA,popperOffsets:()=>oA,preventOverflow:()=>aA,read:()=>eS,reference:()=>Yw,right:()=>Bw,start:()=>Gw,top:()=>Pw,variationPlacements:()=>Xw,viewport:()=>Kw,write:()=>oS});var x={};n.r(x),n.d(x,{getAuthorStyle:()=>l$});var $={};n.r($),n.d($,{MIMETYPES_MAP:()=>h$,compressImage:()=>m$,isImageWithAlphaChannel:()=>f$});var E={};n.r(E),n.d(E,{filterQueryParamsFromURL:()=>y$,isDomainAllowed:()=>p$,isDomainWhitelisted:()=>g$,isMediaURLDomainAllowed:()=>v$,shouldRenderMediaFromURL:()=>b$});var j=n(5072),C=n.n(j),k=n(7825),T=n.n(k),O=n(7659),N=n.n(O),M=n(5056),I=n.n(M),R=n(540),D=n.n(R),z=n(1113),L=n.n(z),P=n(845),U={};U.styleTagTransform=L(),U.setAttributes=I(),U.insert=N().bind(null,"head"),U.domAPI=T(),U.insertStyleElement=D();C()(P.A,U);P.A&&P.A.locals&&P.A.locals;var B=n(7988),q=n.n(B),F=n(5646),H=n.n(F),G=n(9844),W=n.n(G);const V={debug:0,info:1,warn:2,error:3,fatal:4},K=Object.assign({debug:console?.log?console.log.bind(console):function(){},error:console?.log?console.log.bind(console):function(){},info:console?.log?console.log.bind(console):function(){},warn:console?.log?console.log.bind(console):function(){}},console),J={loglevel:"info",setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t,n=""){if(V[t]<V[this.loglevel])return;var s;"error"===t||"fatal"===t?n=n||"color: maroon":"debug"===t&&(n=n||"color: green"),e instanceof Error?e=e.stack:((s=e)instanceof Element||s instanceof Document)&&(e=e.outerHTML);const i=n?"%c":"";"error"===t?K.error(`${i} ERROR: ${e}`,n):"warn"===t?K.warn(`${i} ${(new Date).toISOString()} WARNING: ${e}`,n):"fatal"===t?K.error(`${i} FATAL: ${e}`,n):"debug"===t?K.debug(`${i} ${(new Date).toISOString()} DEBUG: ${e}`,n):K.info(`${i} ${(new Date).toISOString()} INFO: ${e}`,n)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}};const Y=J;var X=n(2081),Q=n.n(X),Z=n(169);const ee={async initialize(){},__:(...e)=>(0,Z.sprintf)(...e)};function te(e,t,n,s,...i){return"function"==typeof n&&(void 0===this.__super__&&(this.__super__=s),this.__super__[e]=n.bind(this)),t.apply(this,i)}class ne{constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}_overrideAttribute(e,t){const n=t.overrides[e];if("function"==typeof n){const t={};t[this.name]=this.plugged;const s=this.plugged[e];this.plugged[e]=function(...i){return te.apply(this,[e,n,s,t,...i])}}else this.plugged[e]=n}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[n,s]of Object.entries(t))if("events"===n)e.prototype[n]=Object.assign(s,e.prototype[n]);else if("function"==typeof s){const t={};t[this.name]=this.plugged;const i=e.prototype[n];e.prototype[n]=function(...e){return te.apply(this,[n,s,i,t,...e])}}else e.prototype[n]=s}loadPluginDependencies(e){e.dependencies?.forEach((t=>{const n=this.plugins[t];if(n){if(n.dependencies?.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(n)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const n=e.overrides[t];"object"==typeof n?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)}))}initializePlugin(e){Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||e.enabled?.(this.plugged)||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(e={},t=[],n=[]){if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,s]of Object.entries(this.plugins))t.length&&!t.includes(e)||n.includes(e)||(this.allowed_plugins[e]=s);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}}const se={enable:function(e,t,n){return void 0===n&&(n="pluginSocket"),void 0===t&&(t="plugged"),e[n]=new ne(e,t),e}};var ie=n(7811);function re(){let e,t=()=>{},n=()=>{};if("function"==typeof Promise.withResolvers){const{promise:s,resolve:i,reject:r}=Promise.withResolvers();e=s,t=i,n=r}else e=new Promise(((e,s)=>{t=e,n=s}));return Object.assign(e,{isResolved:!1,isPending:!0,isRejected:!1,resolve:t,reject:n}),e.then((t=>(e.isResolved=!0,e.isPending=!1,e.isRejected=!1,t)),(t=>{throw e.isResolved=!1,e.isPending=!1,e.isRejected=!0,t})),e}const oe=function(){this.__data__=[],this.size=0};const ae=function(e,t){return e===t||e!=e&&t!=t};const ce=function(e,t){for(var n=e.length;n--;)if(ae(e[n][0],t))return n;return-1};var le=Array.prototype.splice;const de=function(e){var t=this.__data__,n=ce(t,e);return!(n<0)&&(n==t.length-1?t.pop():le.call(t,n,1),--this.size,!0)};const ue=function(e){var t=this.__data__,n=ce(t,e);return n<0?void 0:t[n][1]};const he=function(e){return ce(this.__data__,e)>-1};const fe=function(e,t){var n=this.__data__,s=ce(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this};function me(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}me.prototype.clear=oe,me.prototype.delete=de,me.prototype.get=ue,me.prototype.has=he,me.prototype.set=fe;const ge=me;const pe=function(){this.__data__=new ge,this.size=0};const ve=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const be=function(e){return this.__data__.get(e)};const ye=function(e){return this.__data__.has(e)};const _e="object"==typeof global&&global&&global.Object===Object&&global;var we="object"==typeof self&&self&&self.Object===Object&&self;const Se=_e||we||Function("return this")();const Ae=Se.Symbol;var xe=Object.prototype,$e=xe.hasOwnProperty,Ee=xe.toString,je=Ae?Ae.toStringTag:void 0;const Ce=function(e){var t=$e.call(e,je),n=e[je];try{e[je]=void 0;var s=!0}catch(e){}var i=Ee.call(e);return s&&(t?e[je]=n:delete e[je]),i};var ke=Object.prototype.toString;const Te=function(e){return ke.call(e)};var Oe=Ae?Ae.toStringTag:void 0;const Ne=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Oe&&Oe in Object(e)?Ce(e):Te(e)};const Me=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const Ie=function(e){if(!Me(e))return!1;var t=Ne(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const Re=Se["__core-js_shared__"];var De,ze=(De=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+De:"";const Le=function(e){return!!ze&&ze in e};var Pe=Function.prototype.toString;const Ue=function(e){if(null!=e){try{return Pe.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Be=/^\[object .+?Constructor\]$/,qe=Function.prototype,Fe=Object.prototype,He=qe.toString,Ge=Fe.hasOwnProperty,We=RegExp("^"+He.call(Ge).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Ve=function(e){return!(!Me(e)||Le(e))&&(Ie(e)?We:Be).test(Ue(e))};const Ke=function(e,t){return null==e?void 0:e[t]};const Je=function(e,t){var n=Ke(e,t);return Ve(n)?n:void 0};const Ye=Je(Se,"Map");const Xe=Je(Object,"create");const Qe=function(){this.__data__=Xe?Xe(null):{},this.size=0};const Ze=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var et=Object.prototype.hasOwnProperty;const tt=function(e){var t=this.__data__;if(Xe){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return et.call(t,e)?t[e]:void 0};var nt=Object.prototype.hasOwnProperty;const st=function(e){var t=this.__data__;return Xe?void 0!==t[e]:nt.call(t,e)};const it=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Xe&&void 0===t?"__lodash_hash_undefined__":t,this};function rt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}rt.prototype.clear=Qe,rt.prototype.delete=Ze,rt.prototype.get=tt,rt.prototype.has=st,rt.prototype.set=it;const ot=rt;const at=function(){this.size=0,this.__data__={hash:new ot,map:new(Ye||ge),string:new ot}};const ct=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const lt=function(e,t){var n=e.__data__;return ct(t)?n["string"==typeof t?"string":"hash"]:n.map};const dt=function(e){var t=lt(this,e).delete(e);return this.size-=t?1:0,t};const ut=function(e){return lt(this,e).get(e)};const ht=function(e){return lt(this,e).has(e)};const ft=function(e,t){var n=lt(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this};function mt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}mt.prototype.clear=at,mt.prototype.delete=dt,mt.prototype.get=ut,mt.prototype.has=ht,mt.prototype.set=ft;const gt=mt;const pt=function(e,t){var n=this.__data__;if(n instanceof ge){var s=n.__data__;if(!Ye||s.length<199)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new gt(s)}return n.set(e,t),this.size=n.size,this};function vt(e){var t=this.__data__=new ge(e);this.size=t.size}vt.prototype.clear=pe,vt.prototype.delete=ve,vt.prototype.get=be,vt.prototype.has=ye,vt.prototype.set=pt;const bt=vt;const yt=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const _t=function(e){return this.__data__.has(e)};function wt(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new gt;++t<n;)this.add(e[t])}wt.prototype.add=wt.prototype.push=yt,wt.prototype.has=_t;const St=wt;const At=function(e,t){for(var n=-1,s=null==e?0:e.length;++n<s;)if(t(e[n],n,e))return!0;return!1};const xt=function(e,t){return e.has(t)};const $t=function(e,t,n,s,i,r){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=r.get(e),d=r.get(t);if(l&&d)return l==t&&d==e;var u=-1,h=!0,f=2&n?new St:void 0;for(r.set(e,t),r.set(t,e);++u<a;){var m=e[u],g=t[u];if(s)var p=o?s(g,m,u,t,e,r):s(m,g,u,e,t,r);if(void 0!==p){if(p)continue;h=!1;break}if(f){if(!At(t,(function(e,t){if(!xt(f,t)&&(m===e||i(m,e,n,s,r)))return f.push(t)}))){h=!1;break}}else if(m!==g&&!i(m,g,n,s,r)){h=!1;break}}return r.delete(e),r.delete(t),h};const Et=Se.Uint8Array;const jt=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,s){n[++t]=[s,e]})),n};const Ct=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var kt=Ae?Ae.prototype:void 0,Tt=kt?kt.valueOf:void 0;const Ot=function(e,t,n,s,i,r,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!r(new Et(e),new Et(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ae(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=jt;case"[object Set]":var c=1&s;if(a||(a=Ct),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;s|=2,o.set(e,t);var d=$t(a(e),a(t),s,i,r,o);return o.delete(e),d;case"[object Symbol]":if(Tt)return Tt.call(e)==Tt.call(t)}return!1};const Nt=function(e,t){for(var n=-1,s=t.length,i=e.length;++n<s;)e[i+n]=t[n];return e};const Mt=Array.isArray;const It=function(e,t,n){var s=t(e);return Mt(e)?s:Nt(s,n(e))};const Rt=function(e,t){for(var n=-1,s=null==e?0:e.length,i=0,r=[];++n<s;){var o=e[n];t(o,n,e)&&(r[i++]=o)}return r};const Dt=function(){return[]};var zt=Object.prototype.propertyIsEnumerable,Lt=Object.getOwnPropertySymbols;const Pt=Lt?function(e){return null==e?[]:(e=Object(e),Rt(Lt(e),(function(t){return zt.call(e,t)})))}:Dt;const Ut=function(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s};const Bt=function(e){return null!=e&&"object"==typeof e};const qt=function(e){return Bt(e)&&"[object Arguments]"==Ne(e)};var Ft=Object.prototype,Ht=Ft.hasOwnProperty,Gt=Ft.propertyIsEnumerable;const Wt=qt(function(){return arguments}())?qt:function(e){return Bt(e)&&Ht.call(e,"callee")&&!Gt.call(e,"callee")};const Vt=function(){return!1};var Kt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Jt=Kt&&"object"==typeof module&&module&&!module.nodeType&&module,Yt=Jt&&Jt.exports===Kt?Se.Buffer:void 0;const Xt=(Yt?Yt.isBuffer:void 0)||Vt;var Qt=/^(?:0|[1-9]\d*)$/;const Zt=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Qt.test(e))&&e>-1&&e%1==0&&e<t};const en=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var tn={};tn["[object Float32Array]"]=tn["[object Float64Array]"]=tn["[object Int8Array]"]=tn["[object Int16Array]"]=tn["[object Int32Array]"]=tn["[object Uint8Array]"]=tn["[object Uint8ClampedArray]"]=tn["[object Uint16Array]"]=tn["[object Uint32Array]"]=!0,tn["[object Arguments]"]=tn["[object Array]"]=tn["[object ArrayBuffer]"]=tn["[object Boolean]"]=tn["[object DataView]"]=tn["[object Date]"]=tn["[object Error]"]=tn["[object Function]"]=tn["[object Map]"]=tn["[object Number]"]=tn["[object Object]"]=tn["[object RegExp]"]=tn["[object Set]"]=tn["[object String]"]=tn["[object WeakMap]"]=!1;const nn=function(e){return Bt(e)&&en(e.length)&&!!tn[Ne(e)]};const sn=function(e){return function(t){return e(t)}};var rn="object"==typeof exports&&exports&&!exports.nodeType&&exports,on=rn&&"object"==typeof module&&module&&!module.nodeType&&module,an=on&&on.exports===rn&&_e.process;const cn=function(){try{var e=on&&on.require&&on.require("util").types;return e||an&&an.binding&&an.binding("util")}catch(e){}}();var ln=cn&&cn.isTypedArray;const dn=ln?sn(ln):nn;var un=Object.prototype.hasOwnProperty;const hn=function(e,t){var n=Mt(e),s=!n&&Wt(e),i=!n&&!s&&Xt(e),r=!n&&!s&&!i&&dn(e),o=n||s||i||r,a=o?Ut(e.length,String):[],c=a.length;for(var l in e)!t&&!un.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Zt(l,c))||a.push(l);return a};var fn=Object.prototype;const mn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||fn)};const gn=function(e,t){return function(n){return e(t(n))}};const pn=gn(Object.keys,Object);var vn=Object.prototype.hasOwnProperty;const bn=function(e){if(!mn(e))return pn(e);var t=[];for(var n in Object(e))vn.call(e,n)&&"constructor"!=n&&t.push(n);return t};const yn=function(e){return null!=e&&en(e.length)&&!Ie(e)};const _n=function(e){return yn(e)?hn(e):bn(e)};const wn=function(e){return It(e,_n,Pt)};var Sn=Object.prototype.hasOwnProperty;const An=function(e,t,n,s,i,r){var o=1&n,a=wn(e),c=a.length;if(c!=wn(t).length&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in t:Sn.call(t,d)))return!1}var u=r.get(e),h=r.get(t);if(u&&h)return u==t&&h==e;var f=!0;r.set(e,t),r.set(t,e);for(var m=o;++l<c;){var g=e[d=a[l]],p=t[d];if(s)var v=o?s(p,g,d,t,e,r):s(g,p,d,e,t,r);if(!(void 0===v?g===p||i(g,p,n,s,r):v)){f=!1;break}m||(m="constructor"==d)}if(f&&!m){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(f=!1)}return r.delete(e),r.delete(t),f};const xn=Je(Se,"DataView");const $n=Je(Se,"Promise");const En=Je(Se,"Set");const jn=Je(Se,"WeakMap");var Cn="[object Map]",kn="[object Promise]",Tn="[object Set]",On="[object WeakMap]",Nn="[object DataView]",Mn=Ue(xn),In=Ue(Ye),Rn=Ue($n),Dn=Ue(En),zn=Ue(jn),Ln=Ne;(xn&&Ln(new xn(new ArrayBuffer(1)))!=Nn||Ye&&Ln(new Ye)!=Cn||$n&&Ln($n.resolve())!=kn||En&&Ln(new En)!=Tn||jn&&Ln(new jn)!=On)&&(Ln=function(e){var t=Ne(e),n="[object Object]"==t?e.constructor:void 0,s=n?Ue(n):"";if(s)switch(s){case Mn:return Nn;case In:return Cn;case Rn:return kn;case Dn:return Tn;case zn:return On}return t});const Pn=Ln;var Un="[object Arguments]",Bn="[object Array]",qn="[object Object]",Fn=Object.prototype.hasOwnProperty;const Hn=function(e,t,n,s,i,r){var o=Mt(e),a=Mt(t),c=o?Bn:Pn(e),l=a?Bn:Pn(t),d=(c=c==Un?qn:c)==qn,u=(l=l==Un?qn:l)==qn,h=c==l;if(h&&Xt(e)){if(!Xt(t))return!1;o=!0,d=!1}if(h&&!d)return r||(r=new bt),o||dn(e)?$t(e,t,n,s,i,r):Ot(e,t,c,n,s,i,r);if(!(1&n)){var f=d&&Fn.call(e,"__wrapped__"),m=u&&Fn.call(t,"__wrapped__");if(f||m){var g=f?e.value():e,p=m?t.value():t;return r||(r=new bt),i(g,p,n,s,r)}}return!!h&&(r||(r=new bt),An(e,t,n,s,i,r))};const Gn=function e(t,n,s,i,r){return t===n||(null==t||null==n||!Bt(t)&&!Bt(n)?t!=t&&n!=n:Hn(t,n,s,i,e,r))};const Wn=function(e,t){return Gn(e,t)};const Vn=function(e){return"symbol"==typeof e||Bt(e)&&"[object Symbol]"==Ne(e)};var Kn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Jn=/^\w*$/;const Yn=function(e,t){if(Mt(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Vn(e))||(Jn.test(e)||!Kn.test(e)||null!=t&&e in Object(t))};function Xn(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var s=arguments,i=t?t.apply(this,s):s[0],r=n.cache;if(r.has(i))return r.get(i);var o=e.apply(this,s);return n.cache=r.set(i,o)||r,o};return n.cache=new(Xn.Cache||gt),n}Xn.Cache=gt;const Qn=Xn;const Zn=function(e){var t=Qn(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t};var es=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ts=/\\(\\)?/g;const ns=Zn((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(es,(function(e,n,s,i){t.push(s?i.replace(ts,"$1"):n||e)})),t}));const ss=function(e,t){for(var n=-1,s=null==e?0:e.length,i=Array(s);++n<s;)i[n]=t(e[n],n,e);return i};var is=Ae?Ae.prototype:void 0,rs=is?is.toString:void 0;const os=function e(t){if("string"==typeof t)return t;if(Mt(t))return ss(t,e)+"";if(Vn(t))return rs?rs.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const as=function(e){return null==e?"":os(e)};const cs=function(e,t){return Mt(e)?e:Yn(e,t)?[e]:ns(as(e))};const ls=function(e){if("string"==typeof e||Vn(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};const ds=function(e,t){for(var n=0,s=(t=cs(t,e)).length;null!=e&&n<s;)e=e[ls(t[n++])];return n&&n==s?e:void 0};var us=function(){try{var e=Je(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const hs=us;const fs=function(e,t,n){"__proto__"==t&&hs?hs(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var ms=Object.prototype.hasOwnProperty;const gs=function(e,t,n){var s=e[t];ms.call(e,t)&&ae(s,n)&&(void 0!==n||t in e)||fs(e,t,n)};const ps=function(e,t,n,s){if(!Me(e))return e;for(var i=-1,r=(t=cs(t,e)).length,o=r-1,a=e;null!=a&&++i<r;){var c=ls(t[i]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var d=a[c];void 0===(l=s?s(d,c,a):void 0)&&(l=Me(d)?d:Zt(t[i+1])?[]:{})}gs(a,c,l),a=a[c]}return e};const vs=function(e,t,n){for(var s=-1,i=t.length,r={};++s<i;){var o=t[s],a=ds(e,o);n(a,o)&&ps(r,cs(o,e),a)}return r};const bs=function(e,t){return null!=e&&t in Object(e)};const ys=function(e,t,n){for(var s=-1,i=(t=cs(t,e)).length,r=!1;++s<i;){var o=ls(t[s]);if(!(r=null!=e&&n(e,o)))break;e=e[o]}return r||++s!=i?r:!!(i=null==e?0:e.length)&&en(i)&&Zt(o,i)&&(Mt(e)||Wt(e))};const _s=function(e,t){return null!=e&&ys(e,t,bs)};const ws=function(e,t){return vs(e,t,(function(t,n){return _s(e,n)}))};var Ss=Ae?Ae.isConcatSpreadable:void 0;const As=function(e){return Mt(e)||Wt(e)||!!(Ss&&e&&e[Ss])};const xs=function e(t,n,s,i,r){var o=-1,a=t.length;for(s||(s=As),r||(r=[]);++o<a;){var c=t[o];n>0&&s(c)?n>1?e(c,n-1,s,i,r):Nt(r,c):i||(r[r.length]=c)}return r};const $s=function(e){return(null==e?0:e.length)?xs(e,1):[]};const Es=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var js=Math.max;const Cs=function(e,t,n){return t=js(void 0===t?e.length-1:t,0),function(){for(var s=arguments,i=-1,r=js(s.length-t,0),o=Array(r);++i<r;)o[i]=s[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=s[i];return a[t]=n(o),Es(e,this,a)}};const ks=function(e){return function(){return e}};const Ts=function(e){return e};var Os=hs?function(e,t){return hs(e,"toString",{configurable:!0,enumerable:!1,value:ks(t),writable:!0})}:Ts;const Ns=Os;var Ms=Date.now;const Is=function(e){var t=0,n=0;return function(){var s=Ms(),i=16-(s-n);if(n=s,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};const Rs=Is(Ns);const Ds=function(e){return Rs(Cs(e,void 0,$s),e+"")};const zs=Ds((function(e,t){return null==e?{}:ws(e,t)})),Ls={allow_non_roster_messaging:!0,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,disable_effects:!1,discover_connection_methods:!0,embed_3rd_party_media_players:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,jid:void 0,reuse_scram_keys:!0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","en","eo","es","eu","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","mr","nb","nl","oc","pl","pt","pt_BR","ro","ru","sv","ta","th","tr","ug","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,stanza_timeout:6e4,view_mode:"fullscreen",websocket_url:void 0,whitelisted_plugins:[]};function Ps(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&"__proto__"!==n&&"constructor"!==n&&(e[n]instanceof Object?Ps(e[n],t[n]):e[n]=t[n])}function Us(e){return"[object Error]"===Object.prototype.toString.call(e)}function Bs(e){return"function"==typeof e}function qs(e){return void 0===e}function Fs(e){return e instanceof Error}function Hs(e){return e.browserStorage||e.collection?.browserStorage}let Gs,Ws={};class Vs extends((0,ie.EventEmitter)(Object)){}const Ks={extend:e=>function(e){Ps(Ls,e);const t=Object.keys(e).filter((e=>e in Ls)),n=zs(Ws,t),s=Object.assign(zs(e,t),n);Ps(Gs,s)}(e),get:e=>e?function(e){if(Object.keys(Ls).includes(e))return Gs[e]}(e):Gs,set(e,t){!function(e,t){if(null==e)return this;let n;e instanceof Object?n=e:"string"==typeof e&&(n={},n[e]=t);const s=Object.keys(n).filter((e=>e in Ls)),i={};s.forEach((e=>{const t=n[e];Wn(Gs[e],t)||(i[e]=t,Gs[e]=t)})),Object.keys(i).forEach((e=>Gs.trigger("change:"+e,i[e]))),Gs.trigger("change",i)}(e,t)},listen:{on(e,t,n){!function(e,t,n){Gs.on(e,t,n)}(e,t,n)},not(e,t){!function(e,t){Gs.off(e,t)}(e,t)}}},Js=Ks;function Ys(){return["fullscreen","embedded"].includes(Js.get("view_mode"))}function Xs(){return"montague.lit/http-bind"===Ws.bosh_service_url}function Qs(){return"onpagehide"in window?"pagehide":"onbeforeunload"in window?"beforeunload":"unload"}function Zs(e,t){const n=e.promises[t];if(!n)throw new Error(`Tried to replace non-existing promise: ${t}`);if(n.replace){const s=re();s.replace=n.replace,e.promises[t]=s}else Y.debug(`Not replacing promise "${t}"`)}function ei(e){const{api:t}=e;return!e.state.config.get("trusted")||t.settings.get("clear_cache_on_logout")||Xs()}async function ti(e){const{api:t}=e;return await t.trigger("beforeTearDown",{synchronous:!0}),t.trigger("afterTearDown"),e}function ni(e){return ei(e)&&(e.api.user.settings.clear(),e.state.login_info?.destroy()),e.initSession(),e.api.trigger("clearSession",{synchronous:!0})}const si=window.WebSocket,ii=window.DOMParser;function ri(){return document.implementation.createDocument("jabber:client","strophe",null)}const oi={HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",SERVER:"jabber:server",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},ai="http://www.w3.org/1999/xhtml",ci={tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"]},li={ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12,RECONNECTING:13},di={BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},ui={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},hi={NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11};let fi=ui.DEBUG;const mi={setLogLevel(e){if(e<ui.DEBUG||e>ui.FATAL)throw new Error("Invalid log level supplied to setLogLevel");fi=e},log(e,t){e<fi||(e>=ui.ERROR?console?.error(t):e===ui.INFO?console?.info(t):e===ui.WARN?console?.warn(t):e===ui.DEBUG&&console?.debug(t))},debug(e){this.log(ui.DEBUG,e)},info(e){this.log(ui.INFO,e)},warn(e){this.log(ui.WARN,e)},error(e){this.log(ui.ERROR,e)},fatal(e){this.log(ui.FATAL,e)}};function gi(e,t){const n=ji(e),s=Ci(n);if(s)throw new Error(`Parser Error: ${s}`);const i=ki(n);if(["message","iq","presence"].includes(i.nodeName.toLowerCase())&&"jabber:client"!==i.namespaceURI&&"jabber:server"!==i.namespaceURI){const e=`Invalid namespaceURI ${i.namespaceURI}`;if(t)throw new Error(e);mi.error(e)}return i}function pi(e){void 0!==e.stack&&mi.fatal(e.stack),mi.fatal("error: "+e.message)}function vi(e){let t="";const n=e.length;for(let s=0;s<n;s++){const n=e.charCodeAt(s);n>=0&&n<=127?t+=e.charAt(s):n>2047?(t+=String.fromCharCode(224|n>>12&15),t+=String.fromCharCode(128|n>>6&63),t+=String.fromCharCode(128|63&n)):(t+=String.fromCharCode(192|n>>6&31),t+=String.fromCharCode(128|63&n))}return t}function bi(e,t){const n=new Uint8Array(e),s=new Uint8Array(t),i=new Uint8Array(e.byteLength);for(let t=0;t<e.byteLength;t++)i[t]=n[t]^s[t];return i.buffer}function yi(e){let t="";const n=new Uint8Array(e),s=n.byteLength;for(let e=0;e<s;e++)t+=String.fromCharCode(n[e]);return btoa(t)}function _i(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))?.buffer}function wi(e){return(new TextEncoder).encode(e).buffer}function Si(e){"undefined"==typeof document&&mi.error("addCookies: not adding any cookies, since there's no document object"),e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",s="",i="";const r=e[t],o="object"==typeof r,a=escape(unescape(o?r.value:r));o&&(n=r.expires?";expires="+r.expires:"",s=r.domain?";domain="+r.domain:"",i=r.path?";path="+r.path:""),document.cookie=t+"="+a+n+s+i}}let Ai=null;function xi(){return Ai||(Ai=ri()),Ai}function $i(e){return xi().createTextNode(e)}function Ei(e){const t=Array.from(e.childNodes);return 1===t.length&&t[0].nodeType===hi.TEXT||t.forEach((t=>{"body"!==t.nodeName.toLowerCase()&&(t.nodeType!==hi.TEXT||/\S/.test(t.nodeValue)?t.nodeType===hi.NORMAL&&Ei(t):e.removeChild(t))})),e}function ji(e){return(new ii).parseFromString(e,"text/xml")}function Ci(e){const t="parsererror"===e.firstElementChild?.nodeName?e.firstElementChild:e.getElementsByTagNameNS(ai,"parsererror")[0];return"parsererror"===t?.nodeName?t?.textContent:null}function ki(e){if(e.firstElementChild)return e.firstElementChild;let t,n=0;const s=e.childNodes;for(;t=s[n++];)if(1===t.nodeType)return t;return null}function Ti(e,t,n){if(!e)return null;const s=xi().createElement(e);if(!n||"string"!=typeof n&&"number"!=typeof n){if("string"==typeof t||"number"==typeof t)return s.appendChild($i(t.toString())),s}else s.appendChild($i(n.toString()));if(!t)return s;if(Array.isArray(t))for(const e of t)Array.isArray(e)&&null!=e[0]&&null!=e[1]&&s.setAttribute(e[0],e[1]);else if("object"==typeof t)for(const e of Object.keys(t))e&&null!=t[e]&&s.setAttribute(e,t[e].toString());return s}function Oi(e){for(let t=0;t<ci.tags.length;t++)if(e===ci.tags[t])return!0;return!1}function Ni(e,t){const n=ci.attributes[e];if(n?.length>0)for(let e=0;e<n.length;e++)if(t===n[e])return!0;return!1}function Mi(e){for(let t=0;t<ci.css.length;t++)if(e===ci.css[t])return!0;return!1}function Ii(e){if(e.nodeType===hi.NORMAL)return function(e){let t;const n=e.nodeName.toLowerCase();if(Oi(n))try{if(t=Ti(n),n in ci.attributes){const s=ci.attributes[n];for(let n=0;n<s.length;n++){const i=s[n];let r=e.getAttribute(i);if(null!=r&&""!==r)if("style"===i&&"object"==typeof r&&(r=r.cssText??r),"style"===i){const e=[],n=r.split(";");for(let t=0;t<n.length;t++){const s=n[t].split(":"),i=s[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(Mi(i)){const t=s[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(r=e.join("; "),t.setAttribute(i,r))}else t.setAttribute(i,r)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(Ii(e.childNodes[n]))}}catch(e){t=$i("")}else{t=xi().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(Ii(e.childNodes[n]))}return t}(e);if(e.nodeType===hi.FRAGMENT){const t=xi().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(Ii(e.childNodes[n]));return t}return e.nodeType===hi.TEXT?$i(e.nodeValue):void 0}function Ri(e){let t;if(e.nodeType===hi.NORMAL){const n=e;t=Ti(n.tagName);for(let e=0;e<n.attributes.length;e++)t.setAttribute(n.attributes[e].nodeName,n.attributes[e].value);for(let e=0;e<n.childNodes.length;e++)t.appendChild(Ri(n.childNodes[e]))}else e.nodeType===hi.TEXT&&(t=xi().createTextNode(e.nodeValue));return t}function Di(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")}function zi(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')}function Li(e,t,n){for(let s=0;s<e.childNodes.length;s++){const i=e.childNodes[s];i.nodeType!==hi.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}}function Pi(e,t){return e.tagName===t}function Ui(e){if(!e)return null;let t="";e.childNodes.length||e.nodeType!==hi.TEXT||(t+=e.nodeValue);for(const n of e.childNodes)n.nodeType===hi.TEXT&&(t+=n.nodeValue);return Di(t)}function Bi(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function qi(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}function Fi(e){return e.indexOf("@")<0?null:e.split("@")[0]}function Hi(e){const t=Wi(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}}function Gi(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))}function Wi(e){return e?e.split("/")[0]:null}const Vi={utf16to8:vi,xorArrayBuffers:bi,arrayBufToBase64:yi,base64ToArrayBuf:_i,stringToArrayBuf:wi,addCookies:Si};function Ki(e,t){return new Qi(e,t)}function Ji(e){return new Qi("message",e)}function Yi(e){return new Qi("iq",e)}function Xi(e){return new Qi("presence",e)}class Qi{#e;#t;#n;#s;constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=oi.CLIENT:t||(t={xmlns:oi.CLIENT})),this.#n=e,this.#s=t}static fromString(e){const t=gi(e,!0),n=new Qi("");return n.#e=t,n}buildTree(){return Ti(this.#n,this.#s)}get nodeTree(){return this.#e||(this.#e=this.buildTree()),this.#e}get node(){return this.#t||(this.#t=this.tree()),this.#t}set node(e){this.#t=e}static serialize(e){if(!e)return null;const t=e instanceof Qi?e.tree():e,n=[...Array(t.attributes.length).keys()].map((e=>t.attributes[e].nodeName));n.sort();let s=n.reduce(((e,n)=>`${e} ${n}="${Di(t.attributes.getNamedItem(n).value)}"`),`<${t.nodeName}`);if(t.childNodes.length>0){s+=">";for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];switch(n.nodeType){case hi.NORMAL:s+=Qi.serialize(n);break;case hi.TEXT:s+=Di(n.nodeValue);break;case hi.CDATA:s+="<![CDATA["+n.nodeValue+"]]>"}}s+="</"+t.nodeName+">"}else s+="/>";return s}tree(){return this.nodeTree}toString(){return Qi.serialize(this.tree())}up(){return this.node=this.node.parentElement?this.node.parentElement:this.node.parentNode,this}root(){return this.node=this.tree(),this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(null!=e[t]?this.node.setAttribute(t,e[t].toString()):this.node.removeAttribute(t));return this}c(e,t,n){const s=Ti(e,t,n);return this.node.appendChild(s),"string"!=typeof n&&"number"!=typeof n&&(this.node=s),this}cnode(e){let t;e instanceof Qi&&(e=e.tree());const n=xi();try{t=void 0!==n.importNode}catch(e){t=!1}const s=t?n.importNode(e,!0):Ri(e);return this.node.appendChild(s),this.node=s,this}t(e){const t=$i(e);return this.node.appendChild(t),this}h(e){const t=xi().createElement("body");t.innerHTML=e;const n=Ii(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}}const Zi=Qi;let er=0;const tr=class{constructor(e,t,n,s=0){this.id=++er,this.xmlData=e,this.data=Zi.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=s,this.abort=!1,this.dead=null,this.age=()=>this.date?((new Date).valueOf()-this.date.valueOf())/1e3:0,this.timeDead=()=>this.dead?((new Date).valueOf()-this.dead.valueOf())/1e3:0,this.xhr=this._newXHR()}getResponse(){const e=this.xhr.responseXML?.documentElement;if(e){if("parsererror"===e.tagName)throw mi.error("invalid response received"),mi.error("responseText: "+this.xhr.responseText),mi.error("responseXML: "+Zi.serialize(e)),new Error("parsererror")}else if(this.xhr.responseText){mi.debug("Got responseText but no responseXML; attempting to parse it with DOMParser...");const e=ji(this.xhr.responseText),t=Ci(e);if(!e||t){t&&(mi.error("invalid response received: "+t),mi.error("responseText: "+this.xhr.responseText));const e=new Error;throw e.name=di.BAD_FORMAT,e}}return e}_newXHR(){const e=new XMLHttpRequest;return e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"),e.onreadystatechange=this.func.bind(null,this),e}};let nr=1.1,sr=.1;class ir{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.strip=ir.prototype.strip??!1,this.lastResponseHeaders=null,this._requests=[]}static setTimeoutMultiplier(e){nr=e}static getTimeoutMultplier(){return nr}static setSecondaryTimeoutMultiplier(e){sr=e}static getSecondaryTimeoutMultplier(){return sr}_buildBody(){const e=Ki("body",{rid:this.rid++,xmlns:oi.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":oi.BOSH});n&&s.attrs({route:n});const i=this._conn._connect_cb;this._requests.push(new tr(s.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),Number(s.tree().getAttribute("rid")))),this._throttledRequestHandler()}_attach(e,t,n,s,i,r,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=s,this._conn.domain=Hi(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=r||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(li.ATTACHED,null)}_restore(e,t,n,s,i){const r=JSON.parse(sessionStorage.getItem("strophe-bosh-session"));if(!(null!=r&&r.rid&&r.sid&&r.jid&&(null==e||Wi(r.jid)===Wi(e)||null===Fi(e)&&Hi(r.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(r.jid,r.sid,r.rid,t,n,s,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");mi.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(li.CONNFAIL,t)):this._conn._changeConnectStatus(li.CONNFAIL,"unknown"),this._conn._doDisconnect(t),li.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const r=e.getAttribute("inactivity");r&&(this.inactivity=parseInt(r,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(e){const t=ir._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)}_hitError(e){this.errors++,mi.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){mi.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new tr(t.tree(),this._onRequestStateChange.bind(this,e),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(mi.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":oi.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new tr(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(nr*this.wait)&&this._throttledRequestHandler(),e>Math.floor(nr*this.wait)&&(mi.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(nr*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){mi.error(`Caught an error while retrieving a request's status, reqStatus: ${n}, message: ${e.message}`)}return void 0===n&&(n="number"==typeof t?t:0),n}_onRequestStateChange(e,t){if(mi.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);if(4!==t.xhr.readyState)return;const n=ir._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this._conn.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);const s=this._requests[0]===t,i=this._requests[1]===t,r=n>0&&n<500,o=t.sends>this._conn.maxRetries;(r||o)&&(this._removeRequest(t),mi.debug("request id "+t.id+" should now be removed")),200===n?((i||s&&this._requests.length>0&&this._requests[0].age()>Math.floor(nr*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(t.rid+1),mi.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):0===n||n>=400&&n<600||n>=12e3?(mi.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(li.DISCONNECTING,null),this._conn._doDisconnect())):mi.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),r||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(li.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(e){let t=this._requests[e];const n=ir._getRequestStatus(t,-1);if(t.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const s=t.age(),i=!isNaN(s)&&s>Math.floor(nr*this.wait),r=null!==t.dead&&t.timeDead()>Math.floor(sr*this.wait),o=4===t.xhr.readyState&&(n<1||n>=500);if((i||r||o)&&(r&&mi.error(`Request ${this._requests[e].id} timed out (secondary), restarting`),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){},this._requests[e]=new tr(t.xmlData,t.origFunc,t.rid,t.sends),t=this._requests[e]),0===t.xhr.readyState){mi.debug("request id "+t.id+"."+t.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";t.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==t.xhr.setRequestHeader&&t.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(t.xhr.withCredentials=!0)}catch(e){return mi.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(li.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(t.date=(new Date).valueOf(),this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.xhr.setRequestHeader(n,e[n])}t.xhr.send(t.data)};if(t.sends>1){const n=1e3*Math.min(Math.floor(nr*this.wait),Math.pow(t.sends,3));setTimeout((function(){e()}),n)}else e();t.sends++,this.strip&&"body"===t.xmlData.nodeName&&t.xmlData.childNodes.length?this._conn.xmlOutput?.(t.xmlData.children[0]):this._conn.xmlOutput?.(t.xmlData),this._conn.rawOutput?.(t.data)}else mi.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+t.xhr.readyState)}_removeRequest(e){mi.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){mi.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"}),n=e instanceof Zi?e.tree():e;e&&t.cnode(n);const s=new tr(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")));this._requests.push(s),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?mi.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):mi.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}const rr=ir;const or=class{constructor(e,t,n,s,i,r,o){this.handler=e,this.ns=t,this.name=n,this.type=s,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBareFromJid?this.from=r?Wi(r):null:this.from=r,this.user=!0}getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t}namespaceMatch(e){if(!this.ns||this.getNamespace(e)===this.ns)return!0;for(const t of e.children??[]){if(this.getNamespace(t)===this.ns)return!0;if(this.namespaceMatch(t))return!0}return!1}isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=Wi(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!Pi(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)}run(e){let t=null;try{t=this.handler(e)}catch(e){throw pi(e),e}return t}toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};const ar=class{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};const cr=class{constructor(e,t,n){this.mechname=e,this.isClientFirst=t,this.priority=n}test(e){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}};const lr=class extends cr{constructor(e="ANONYMOUS",t=!1,n=20){super(e,t,n)}test(e){return null===e.authcid}};const dr=class extends cr{constructor(e="EXTERNAL",t=!0,n=10){super(e,t,n)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}};const ur=class extends cr{constructor(e="OAUTHBEARER",t=!0,n=40){super(e,t,n)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",Vi.utf16to8(t)}};const hr=class extends cr{constructor(e="PLAIN",t=!0,n=50){super(e,t,n)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:n,domain:s,pass:i}=e;if(!s)throw new Error("SASLPlain onChallenge: domain is not defined!");let r=n!==`${t}@${s}`?n:"";return r+="\0",r+=t,r+="\0",r+=i,Vi.utf16to8(r)}};const fr={async scramResponse(e,t,n,s){const i=e._sasl_data.cnonce,r=function(e){let t,n,s;const i=/([a-z]+)=([^,]+)(,|$)/;for(;e.match(i);){const r=e.match(i);switch(e=e.replace(r[0],""),r[1]){case"r":t=r[2];break;case"s":n=Vi.base64ToArrayBuf(r[2]);break;case"i":s=parseInt(r[2],10);break;case"m":return}}if(isNaN(s)||s<4096)mi.warn("Failing SCRAM authentication because server supplied iteration count < 4096.");else{if(n)return{nonce:t,salt:n,iter:s};mi.warn("Failing SCRAM authentication because server supplied incorrect salt.")}}(t);if(!r&&r?.nonce.slice(0,i.length)!==i)return mi.warn("Failing SCRAM authentication because server supplied incorrect nonce."),e._sasl_data={},e._sasl_failure_cb();let o,a;const{pass:c}=e;if("string"==typeof e.pass||e.pass instanceof String){const e=await async function(e,t,n,s,i){const r=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:n,hash:{name:s}},await crypto.subtle.importKey("raw",Vi.stringToArrayBuf(e),"PBKDF2",!1,["deriveBits"]),i),o=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:s},!1,["sign"]);return{ck:await crypto.subtle.sign("HMAC",o,Vi.stringToArrayBuf("Client Key")),sk:await crypto.subtle.sign("HMAC",o,Vi.stringToArrayBuf("Server Key"))}}(c,r.salt,r.iter,n,s);o=e.ck,a=e.sk}else{if(c?.name!==n||c?.salt!==Vi.arrayBufToBase64(r.salt)||c?.iter!==r.iter)return e._sasl_failure_cb();{const{ck:e,sk:t}=c;o=Vi.base64ToArrayBuf(e),a=Vi.base64ToArrayBuf(t)}}const l=e._sasl_data["client-first-message-bare"],d=t,u=`c=biws,r=${r.nonce}`,h=`${l},${d},${u}`,f=await async function(e,t,n){const s=await crypto.subtle.importKey("raw",await crypto.subtle.digest(n,t),{name:"HMAC",hash:n},!1,["sign"]),i=await crypto.subtle.sign("HMAC",s,Vi.stringToArrayBuf(e));return Vi.xorArrayBuffers(t,i)}(h,o,n),m=await async function(e,t,n){const s=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:n},!1,["sign"]);return crypto.subtle.sign("HMAC",s,Vi.stringToArrayBuf(e))}(h,a,n);return e._sasl_data["server-signature"]=Vi.arrayBufToBase64(m),e._sasl_data.keys={name:n,iter:r.iter,salt:Vi.arrayBufToBase64(r.salt),ck:Vi.arrayBufToBase64(o),sk:Vi.arrayBufToBase64(a)},`${u},p=${Vi.arrayBufToBase64(f)}`},clientChallenge(e,t){const n=t||function(){const e=new Uint8Array(16);return Vi.arrayBufToBase64(crypto.getRandomValues(e).buffer)}(),s=`n=${e.authcid},r=${n}`;return e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=s,`n,,${s}`}};const mr=class extends cr{constructor(e="SCRAM-SHA-1",t=!0,n=60){super(e,t,n)}test(e){return null!==e.authcid}async onChallenge(e,t){return await fr.scramResponse(e,t,"SHA-1",160)}clientChallenge(e,t){return fr.clientChallenge(e,t)}};const gr=class extends cr{constructor(e="SCRAM-SHA-256",t=!0,n=70){super(e,t,n)}test(e){return null!==e.authcid}async onChallenge(e,t){return await fr.scramResponse(e,t,"SHA-256",256)}clientChallenge(e,t){return fr.clientChallenge(e,t)}};const pr=class extends cr{constructor(e="SCRAM-SHA-384",t=!0,n=71){super(e,t,n)}test(e){return null!==e.authcid}async onChallenge(e,t){return await fr.scramResponse(e,t,"SHA-384",384)}clientChallenge(e,t){return fr.clientChallenge(e,t)}};const vr=class extends cr{constructor(e="SCRAM-SHA-512",t=!0,n=72){super(e,t,n)}test(e){return null!==e.authcid}async onChallenge(e,t){return await fr.scramResponse(e,t,"SHA-512",512)}clientChallenge(e,t){return fr.clientChallenge(e,t)}};const br=class extends cr{constructor(e="X-OAUTH2",t=!0,n=30){super(e,t,n)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,Vi.utf16to8(t)}};class yr extends Error{constructor(e){super(e),this.name="StropheSessionError"}}const _r=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==location.protocol?n+="ws":n+="wss",n+="://"+location.host,0!==t.indexOf("/")?n+=location.pathname+t:n+=t,e.service=n}}_buildStream(){return Ki("open",{xmlns:oi.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(oi.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const s=n[0];let i="",r="";for(let e=0;e<s.childNodes.length;e++){const t=s.childNodes[e];if(t.nodeType===t.ELEMENT_NODE){if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break}"text"===t.nodeName?r=t.textContent:i=t.nodeName}let o="WebSocket stream error: ";return o+=i||"unknown",r&&(o+=" - "+r),mi.error(o),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new si(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,li.CONNFAIL))return li.CONNFAIL}_handleStreamStart(e){let t=null;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==oi.FRAMING&&(t="Wrong xmlns in <open />: "+n);const s=e.getAttribute("version");return"string"!=typeof s?t="Missing version in <open />":"1.0"!==s&&(t="Wrong version in <open />: "+s),!t||(this._conn._changeConnectStatus(li.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new ii).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new ii).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(li.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(li.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),n=(new ii).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(n,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==si.CLOSED){e&&this._conn.send(e);const t=Ki("close",{xmlns:oi.FRAMING});this._conn.xmlOutput(t.tree());const n=Zi.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){mi.warn(`Couldn't send <close /> tag. "${e.message}"`)}}setTimeout((()=>this._conn._doDisconnect()),0)}_doDisconnect(){mi.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){mi.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(mi.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(mi.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(li.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):mi.debug("Websocket closed")}_no_auth_received(e){mi.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(li.CONNFAIL,di.NO_AUTH_MECH),e?.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){mi.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(li.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){const n="restart"===e[t]?this._buildStream().tree():e[t];if("restart"===n)throw new Error("Wrong type for stanza");const s=Zi.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}}_onMessage(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new ii).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new ii).parseFromString(n,"text/xml").documentElement}return this._checkStreamError(t,li.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstElementChild.nodeName&&"unavailable"===t.firstElementChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Zi.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){mi.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=Zi.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const wr=class extends _r{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{console?.error(e),mi.error(`Shared Worker Error: ${e}`)}}_setSocket(){this.socket={send:e=>this.worker.port.postMessage(["send",e]),close:()=>this.worker.port.postMessage(["_closeSocket"]),onopen:()=>{},onerror:e=>this._onError(e),onclose:e=>this._onClose(e),onmessage:()=>{},readyState:null}}_connect(){this._setSocket(),this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._setSocket(),this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===li.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(li.ATTACHED)):e===li.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(li.ATTACHFAIL))}_disconnect(e){e&&this._conn.send(e);const t=Ki("close",{xmlns:oi.FRAMING});this._conn.xmlOutput(t.tree());const n=Zi.serialize(t);this._conn.rawOutput(n),this.worker.port.postMessage(["send",n]),this._conn._doDisconnect()}_closeSocket(){this.socket.close()}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){mi.error(e)}else if("log"===n){const e={debug:ui.DEBUG,info:ui.INFO,warn:ui.WARN,error:ui.ERROR,fatal:ui.FATAL},n=t[1],s=t[2];mi.log(e[n],s)}else mi.error(`Found unhandled service worker message: ${t}`)}},Sr={};class Ar{constructor(e,t={}){this.service=e,this.options=t,this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),Si(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new or((e=>this.send(Yi({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:oi.STANZAS}))),null,"iq",["get","set"]);for(const e in Sr)if(Object.prototype.hasOwnProperty.call(Sr,e)){const t=function(){};t.prototype=Sr[e],this[e]=new t,this[e].init(this)}}static addConnectionPlugin(e,t){Sr[e]=t}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new wr(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new _r(this):this._proto=new rr(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,n){this.protocolErrorHandlers[e][t]=n}connect(e,t,n,s,i,r,o,a=3e3){this.jid=e,this.authzid=Wi(this.jid),this.authcid=o||Fi(this.jid),this.pass=t,this.scram_keys=null,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=a,this.domain=Hi(this.jid),this._changeConnectStatus(li.CONNECTING,null),this._proto._connect(s,i,r)}attach(e,t,n,s,i,r,o){if(this._proto instanceof rr&&"string"==typeof e)return this._proto._attach(e,t,n,s,i,r,o);if(this._proto instanceof wr&&"function"==typeof e){const t=e;return this._proto._attach(t)}throw new yr('The "attach" method is not available for your connection protocol')}restore(e,t,n,s,i){if(!(this._proto instanceof rr&&this._sessionCachingSupported()))throw new yr('The "restore" method can only be used with a BOSH connection.');this._sessionCachingSupported()&&this._proto._restore(e,t,n,s,i)}_sessionCachingSupported(){if(this._proto instanceof rr){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if(Array.isArray(e))e.forEach((e=>this._queueData(e instanceof Zi?e.tree():e)));else{const t=e instanceof Zi?e.tree():e;this._queueData(t)}this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,n,s){let i=null;const r=e instanceof Zi?e.tree():e;let o=r.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),r.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?n?.(e):t&&t(e)}),null,"presence",null,o);s&&(i=this.addTimedHandler(s,(()=>(this.deleteHandler(e),n?.(null),!1))))}return this.send(r),o}sendIQ(e,t,n,s){let i=null;const r=e instanceof Zi?e.tree():e;let o=r.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),r.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i);const s=e.getAttribute("type");if("result"===s)t?.(e);else{if("error"!==s){const e=new Error(`Got bad IQ type of ${s}`);throw e.name="StropheError",e}n?.(e)}}),null,"iq",["error","result"],o);s&&(i=this.addTimedHandler(s,(()=>(this.deleteHandler(e),n?.(null),!1))))}return this.send(r),o}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const n=new ar(e,t);return this.addTimeds.push(n),n}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,n,s,i,r,o){const a=new or(e,t,n,s,i,r,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e||[lr,dr,ur,br,hr,mr,gr,pr,vr]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(li.DISCONNECTING,e),e?mi.info("Disconnect was called because: "+e):mi.debug("Disconnect was called"),this.connected){let e=null;this.disconnecting=!0,this.authenticated&&(e=Xi({xmlns:oi.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else mi.debug("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,n){for(const n in Sr)if(Object.prototype.hasOwnProperty.call(Sr,n)){const s=this[n];if(s.statusChanged)try{s.statusChanged(e,t)}catch(e){mi.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){pi(e),mi.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),mi.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(li.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const n="_reqToData"in this._proto?this._proto._reqToData(e):e;if(null===n)return;for(this.xmlInput!==Ar.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==Ar.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(Zi.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const s=n.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(li.CONNFAIL,e)):this._changeConnectStatus(li.CONNFAIL,di.UNKNOWN_REASON),void this._doDisconnect(e)}Li(n,null,(e=>{const t=[];this.handlers=this.handlers.reduce(((n,s)=>{try{!s.isMatch(e)||!this.authenticated&&s.user?n.push(s):(s.run(e)&&n.push(s),t.push(s))}catch(e){mi.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return n}),[]),!t.length&&this.iqFallbackHandler.isMatch(e)&&this.iqFallbackHandler.run(e)}))}_connect_cb(e,t,n){let s;mi.debug("_connect_cb was called"),this.connected=!0;try{s="_reqToData"in this._proto?this._proto._reqToData(e):e}catch(e){if(e.name!==di.BAD_FORMAT)throw e;this._changeConnectStatus(li.CONNFAIL,di.BAD_FORMAT),this._doDisconnect(di.BAD_FORMAT)}if(!s)return;this.xmlInput!==Ar.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==Ar.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(Zi.serialize(s)));if(this._proto._connect_cb(s)===li.CONNFAIL)return;let i;if(i=s.getElementsByTagNameNS?s.getElementsByTagNameNS(oi.STREAM,"features").length>0:s.getElementsByTagName("stream:features").length>0||s.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const r=Array.from(s.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==r.length||0!==s.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let n=t;for(let s=t+1;s<e.length;++s)e[s].priority>e[n].priority&&(n=s);if(n!==t){const s=e[t];e[t]=e[n],e[n]=s}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);const s=Ki("auth",{xmlns:oi.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);s.t(btoa(e))}this.send(s.tree()),t=!0;break}return t}async _sasl_challenge_cb(e){const t=atob(Ui(e)),n=await this._sasl_mechanism.onChallenge(this,t),s=Ki("response",{xmlns:oi.SASL});return n&&s.t(btoa(n)),this.send(s.tree()),!0}_attemptLegacyAuth(){null===Fi(this.jid)?(this._changeConnectStatus(li.CONNFAIL,di.MISSING_JID_NODE),this.disconnect(di.MISSING_JID_NODE)):(this._changeConnectStatus(li.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(Yi({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:oi.AUTH}).c("username",{}).t(Fi(this.jid)).tree()))}_onLegacyAuthIQResult(){const e="string"==typeof this.pass?this.pass:"",t=Yi({type:"set",id:"_auth_2"}).c("query",{xmlns:oi.AUTH}).c("username",{}).t(Fi(this.jid)).up().c("password").t(e);return Gi(this.jid)||(this.jid=Wi(this.jid)+"/strophe"),t.up().c("resource",{}).t(Gi(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,s=atob(Ui(e)).match(n);if("v"===s[1]&&(t=s[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}mi.info("SASL authentication succeeded."),this._sasl_data.keys&&(this.scram_keys=this._sasl_data.keys),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>n(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>n(t,e)),oi.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(li.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(li.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void mi.info('Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=Gi(this.jid);e?this.send(Yi({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:oi.BIND}).c("resource",{}).t(e).tree()):this.send(Yi({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:oi.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){mi.warn("Resource binding failed.");let t;return e.getElementsByTagName("conflict").length>0&&(t=di.CONFLICT),this._changeConnectStatus(li.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return mi.warn("Resource binding failed."),this._changeConnectStatus(li.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=Ui(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(li.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Connection.prototype._establishSession called but apparently ${oi.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(Yi({type:"set",id:"_session_auth_2"}).c("session",{xmlns:oi.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(li.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,mi.warn("Session creation failed."),this._changeConnectStatus(li.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(li.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(li.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(li.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const n=new ar(e,t);return n.user=!1,this.addTimeds.push(n),n}_addSysHandler(e,t,n,s,i){const r=new or(e,t,n,s,i);return r.user=!1,this.addHandlers.push(r),r}_onDisconnectTimeout(){return mi.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(li.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const s=this.timedHandlers[n];if(this.authenticated||!s.user){s.lastCalled+s.period-e<=0?s.run()&&t.push(s):t.push(s)}}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}}const xr=Ar;class $r extends String{}class Er extends Zi{#i;#r;#o;constructor(e,t){super("stanza"),this.#r=e,this.#o=t}static unsafeXML(e){return new $r(e)}static toElement(e,t){const n=ji(e),s=Ci(n);if(s)throw new Error(`Parser Error: ${s}`);const i=Ei(ki(n));if(["message","iq","presence"].includes(i.nodeName.toLowerCase())&&"jabber:client"!==i.namespaceURI&&"jabber:server"!==i.namespaceURI){const e=`Invalid namespaceURI ${i.namespaceURI}`;if(t)throw new Error(e);mi.error(e)}return i}buildTree(){return Er.toElement(this.toString(),!0)}toString(){return this.#i=this.#i||this.#r.reduce(((e,t,n)=>{const s=this.#o.length>n?this.#o[n]:"";return e+t+(Array.isArray(s)?s.map((e=>e instanceof $r||e instanceof Zi?e:Di(e.toString()))).join(""):s instanceof $r||s instanceof Zi?s:Di((s??"").toString()))}),"").trim(),this.#i}}function jr(e,...t){return new Er(e,t)}const Cr={VERSION:"3.0.0",get TIMEOUT(){return rr.getTimeoutMultplier()},set TIMEOUT(e){rr.setTimeoutMultiplier(e)},get SECONDARY_TIMEOUT(){return rr.getSecondaryTimeoutMultplier()},set SECONDARY_TIMEOUT(e){rr.setSecondaryTimeoutMultiplier(e)},...o,...mi,shims:r,Request:tr,Bosh:rr,Websocket:_r,WorkerWebsocket:wr,Connection:xr,Handler:or,SASLAnonymous:lr,SASLPlain:hr,SASLSHA1:mr,SASLSHA256:gr,SASLSHA384:pr,SASLSHA512:vr,SASLOAuthBearer:ur,SASLExternal:dr,SASLXOAuth2:br,Stanza:Er,Builder:Zi,ElementType:hi,ErrorCondition:di,LogLevel:ui,NS:oi,SASLMechanism:cr,Status:li,TimedHandler:ar,XHTML:{...ci,validTag:Oi,validCSS:Mi,validAttribute:Ni},serialize:e=>Zi.serialize(e),setLogLevel(e){mi.setLogLevel(e)},addNamespace(e,t){Cr.NS[e]=t},addConnectionPlugin(e,t){xr.addConnectionPlugin(e,t)}};globalThis.$build=Ki,globalThis.$iq=Yi,globalThis.$msg=Ji,globalThis.$pres=Xi,globalThis.Strophe=Cr,globalThis.stx=jr;const kr=Er.toElement;globalThis.toStanza=Er.toElement;const Tr=59,Or="v11.0.0",Nr=["chat","dnd","away","xa"],Mr=["available","unavailable","error","probe","subscribe","subscribed","unsubscribe","unsubscribed"],Ir={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},Rr=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],Dr="anonymous",zr="closed",Lr="external",Pr="login",Ur="logout",Br="opened",qr="prebind",Fr="success",Hr="failure",Gr="inactive",Wr="active",Vr="composing",Kr="paused",Jr="gone",Yr="chatbox",Xr="chatroom",Qr="headline",Zr="controlbox",eo={};eo[Cr.Status.ATTACHED]="ATTACHED",eo[Cr.Status.AUTHENTICATING]="AUTHENTICATING",eo[Cr.Status.AUTHFAIL]="AUTHFAIL",eo[Cr.Status.CONNECTED]="CONNECTED",eo[Cr.Status.CONNECTING]="CONNECTING",eo[Cr.Status.CONNFAIL]="CONNFAIL",eo[Cr.Status.DISCONNECTED]="DISCONNECTED",eo[Cr.Status.DISCONNECTING]="DISCONNECTING",eo[Cr.Status.ERROR]="ERROR",eo[Cr.Status.RECONNECTING]="RECONNECTING",eo[Cr.Status.REDIRECT]="REDIRECT",Cr.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),Cr.addNamespace("CARBONS","urn:xmpp:carbons:2"),Cr.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),Cr.addNamespace("CSI","urn:xmpp:csi:0"),Cr.addNamespace("DELAY","urn:xmpp:delay"),Cr.addNamespace("EME","urn:xmpp:eme:0"),Cr.addNamespace("FALLBACK","urn:xmpp:fallback:0"),Cr.addNamespace("FASTEN","urn:xmpp:fasten:0"),Cr.addNamespace("FORWARD","urn:xmpp:forward:0"),Cr.addNamespace("HINTS","urn:xmpp:hints"),Cr.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),Cr.addNamespace("MAM","urn:xmpp:mam:2"),Cr.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),Cr.addNamespace("MENTIONS","urn:xmpp:mmn:0"),Cr.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),Cr.addNamespace("MODERATE","urn:xmpp:message-moderate:1"),Cr.addNamespace("MODERATE0","urn:xmpp:message-moderate:0"),Cr.addNamespace("NICK","http://jabber.org/protocol/nick"),Cr.addNamespace("OCCUPANTID","urn:xmpp:occupant-id:0"),Cr.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),Cr.addNamespace("OUTOFBAND","jabber:x:oob"),Cr.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),Cr.addNamespace("RAI","urn:xmpp:rai:0"),Cr.addNamespace("RECEIPTS","urn:xmpp:receipts"),Cr.addNamespace("REFERENCE","urn:xmpp:reference:0"),Cr.addNamespace("REGISTER","jabber:iq:register"),Cr.addNamespace("RETRACT","urn:xmpp:message-retract:1"),Cr.addNamespace("RETRACT0","urn:xmpp:message-retract:0"),Cr.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),Cr.addNamespace("RSM","http://jabber.org/protocol/rsm"),Cr.addNamespace("SID","urn:xmpp:sid:0"),Cr.addNamespace("SPOILER","urn:xmpp:spoiler:0"),Cr.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),Cr.addNamespace("STYLING","urn:xmpp:styling:0"),Cr.addNamespace("VCARD","vcard-temp"),Cr.addNamespace("VCARDUPDATE","vcard-temp:x:update"),Cr.addNamespace("XFORM","jabber:x:data"),Cr.addNamespace("XHTML","http://www.w3.org/1999/xhtml");const to=["converse-adhoc","converse-bookmarks","converse-blocklist","converse-bosh","converse-caps","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],no=["active","composing","gone","inactive","paused"],so=["displayed","received","acknowledged"],io={TAB:"Tab",ENTER:"Enter",SHIFT:"Shift",CTRL:"Control",ALT:"Alt",ESCAPE:"Escape",LEFT_ARROW:"ArrowLeft",UP_ARROW:"ArrowUp",RIGHT_ARROW:"ArrowRight",DOWN_ARROW:"ArrowDown",FORWARD_SLASH:"Divide",AT:"Alt",META:"Meta"},ro={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"},oo={"xs:anyURI":"url","xs:byte":"number","xs:date":"date","xs:dateTime":"datetime","xs:int":"number","xs:integer":"number","xs:time":"time"},ao={chatboxes:null,bookmarks:null,ANONYMOUS:Dr,CLOSED:zr,EXTERNAL:Lr,LOGIN:Pr,LOGOUT:Ur,OPENED:Br,PREBIND:qr,SUCCESS:Fr,FAILURE:Hr,INACTIVE:Gr,ACTIVE:Wr,COMPOSING:Vr,PAUSED:Kr,GONE:Jr};class co extends((0,ie.EventEmitter)(Object)){constructor(){super();const e=new Proxy(this,{get:(e,t)=>(Xs()||"string"!=typeof t||Object.keys(ao).includes(t)&&Y.warn(`Accessing ${t} on _converse is DEPRECATED`),Reflect.get(e,t))});return e.initialize(),e}initialize(){this.VERSION_NAME=Or,this.strict_plugin_dependencies=!1,this.pluggable=null,this.templates={},this.storage={},this.promises={initialized:re()},this.NUM_PREKEYS=100,this.TIMEOUTS={PAUSED:1e4,INACTIVE:9e4},Object.assign(this,ao),this.api=null,this.labels={},this.exports={},this.constants={},this.env={},this.state={},this.initSession()}initSession(){this.session?.destroy(),this.session=new ie.Model,Object.assign(this,{jid:void 0,bare_jid:void 0,domain:void 0,resource:void 0})}__(...e){return ee.__(...e)}___(e){return e}}const lo=new co;se.enable(lo,"_converse","pluggable");const uo=lo,ho={async trigger(e){if(!uo._events)return;const t=Array.from(arguments),n=t.pop();if(n&&n.synchronous){const n=uo._events[e]||[],s=t.splice(1);await Promise.all(n.map((e=>e.callback.apply(e.ctx,s))))}else uo.trigger.apply(uo,arguments);const s=uo.promises[e];void 0!==s&&s.resolve(arguments[1])},hook(e,t,n){const s=uo._events[e]||[];return s.length?s.reduce(((e,n)=>e.then((e=>n.callback(t,e)))),Promise.resolve(n)):n},listen:{once:uo.once.bind(uo),on:uo.on.bind(uo),not:uo.off.bind(uo),stanza(e,t,n){Bs(t)?(n=t,t={}):t=t||{},uo.api.connection.get().addHandler(n,t.ns,e,t.type,t.id,t.from,t)}}};const fo=function(){return Se.Date.now()};var mo=/\s/;const go=function(e){for(var t=e.length;t--&&mo.test(e.charAt(t)););return t};var po=/^\s+/;const vo=function(e){return e?e.slice(0,go(e)+1).replace(po,""):e};var bo=/^[-+]0x[0-9a-f]+$/i,yo=/^0b[01]+$/i,_o=/^0o[0-7]+$/i,wo=parseInt;const So=function(e){if("number"==typeof e)return e;if(Vn(e))return NaN;if(Me(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Me(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=vo(e);var n=yo.test(e);return n||_o.test(e)?wo(e.slice(2),n?2:8):bo.test(e)?NaN:+e};var Ao=Math.max,xo=Math.min;const $o=function(e,t,n){var s,i,r,o,a,c,l=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=s,r=i;return s=i=void 0,l=t,o=e.apply(r,n)}function m(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=r}function g(){var e=fo();if(m(e))return p(e);a=setTimeout(g,function(e){var n=t-(e-c);return u?xo(n,r-(e-l)):n}(e))}function p(e){return a=void 0,h&&s?f(e):(s=i=void 0,o)}function v(){var e=fo(),n=m(e);if(s=arguments,i=this,c=e,n){if(void 0===a)return function(e){return l=e,a=setTimeout(g,t),d?f(e):o}(c);if(u)return clearTimeout(a),a=setTimeout(g,t),f(c)}return void 0===a&&(a=setTimeout(g,t)),o}return t=So(t)||0,Me(n)&&(d=!!n.leading,r=(u="maxWait"in n)?Ao(So(n.maxWait)||0,t):r,h="trailing"in n?!!n.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,s=c=i=a=void 0},v.flush=function(){return void 0===a?o:p(fo())},v};var Eo=n(3134);const jo=function(e,t){for(var n=-1,s=null==e?0:e.length;++n<s&&!1!==t(e[n],n,e););return e};const Co=function(e,t,n,s){var i=!n;n||(n={});for(var r=-1,o=t.length;++r<o;){var a=t[r],c=s?s(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?fs(n,a,c):gs(n,a,c)}return n};const ko=function(e,t){return e&&Co(t,_n(t),e)};const To=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var Oo=Object.prototype.hasOwnProperty;const No=function(e){if(!Me(e))return To(e);var t=mn(e),n=[];for(var s in e)("constructor"!=s||!t&&Oo.call(e,s))&&n.push(s);return n};const Mo=function(e){return yn(e)?hn(e,!0):No(e)};const Io=function(e,t){return e&&Co(t,Mo(t),e)};var Ro="object"==typeof exports&&exports&&!exports.nodeType&&exports,Do=Ro&&"object"==typeof module&&module&&!module.nodeType&&module,zo=Do&&Do.exports===Ro?Se.Buffer:void 0,Lo=zo?zo.allocUnsafe:void 0;const Po=function(e,t){if(t)return e.slice();var n=e.length,s=Lo?Lo(n):new e.constructor(n);return e.copy(s),s};const Uo=function(e,t){var n=-1,s=e.length;for(t||(t=Array(s));++n<s;)t[n]=e[n];return t};const Bo=function(e,t){return Co(e,Pt(e),t)};const qo=gn(Object.getPrototypeOf,Object);const Fo=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Nt(t,Pt(e)),e=qo(e);return t}:Dt;const Ho=function(e,t){return Co(e,Fo(e),t)};const Go=function(e){return It(e,Mo,Fo)};var Wo=Object.prototype.hasOwnProperty;const Vo=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Wo.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const Ko=function(e){var t=new e.constructor(e.byteLength);return new Et(t).set(new Et(e)),t};const Jo=function(e,t){var n=t?Ko(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var Yo=/\w*$/;const Xo=function(e){var t=new e.constructor(e.source,Yo.exec(e));return t.lastIndex=e.lastIndex,t};var Qo=Ae?Ae.prototype:void 0,Zo=Qo?Qo.valueOf:void 0;const ea=function(e){return Zo?Object(Zo.call(e)):{}};const ta=function(e,t){var n=t?Ko(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const na=function(e,t,n){var s=e.constructor;switch(t){case"[object ArrayBuffer]":return Ko(e);case"[object Boolean]":case"[object Date]":return new s(+e);case"[object DataView]":return Jo(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ta(e,n);case"[object Map]":case"[object Set]":return new s;case"[object Number]":case"[object String]":return new s(e);case"[object RegExp]":return Xo(e);case"[object Symbol]":return ea(e)}};var sa=Object.create;const ia=function(){function e(){}return function(t){if(!Me(t))return{};if(sa)return sa(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const ra=function(e){return"function"!=typeof e.constructor||mn(e)?{}:ia(qo(e))};const oa=function(e){return Bt(e)&&"[object Map]"==Pn(e)};var aa=cn&&cn.isMap;const ca=aa?sn(aa):oa;const la=function(e){return Bt(e)&&"[object Set]"==Pn(e)};var da=cn&&cn.isSet;const ua=da?sn(da):la;var ha="[object Arguments]",fa="[object Function]",ma="[object Object]",ga={};ga[ha]=ga["[object Array]"]=ga["[object ArrayBuffer]"]=ga["[object DataView]"]=ga["[object Boolean]"]=ga["[object Date]"]=ga["[object Float32Array]"]=ga["[object Float64Array]"]=ga["[object Int8Array]"]=ga["[object Int16Array]"]=ga["[object Int32Array]"]=ga["[object Map]"]=ga["[object Number]"]=ga[ma]=ga["[object RegExp]"]=ga["[object Set]"]=ga["[object String]"]=ga["[object Symbol]"]=ga["[object Uint8Array]"]=ga["[object Uint8ClampedArray]"]=ga["[object Uint16Array]"]=ga["[object Uint32Array]"]=!0,ga["[object Error]"]=ga[fa]=ga["[object WeakMap]"]=!1;const pa=function e(t,n,s,i,r,o){var a,c=1&n,l=2&n,d=4&n;if(s&&(a=r?s(t,i,r,o):s(t)),void 0!==a)return a;if(!Me(t))return t;var u=Mt(t);if(u){if(a=Vo(t),!c)return Uo(t,a)}else{var h=Pn(t),f=h==fa||"[object GeneratorFunction]"==h;if(Xt(t))return Po(t,c);if(h==ma||h==ha||f&&!r){if(a=l||f?{}:ra(t),!c)return l?Ho(t,Io(a,t)):Bo(t,ko(a,t))}else{if(!ga[h])return r?t:{};a=na(t,h,c)}}o||(o=new bt);var m=o.get(t);if(m)return m;o.set(t,a),ua(t)?t.forEach((function(i){a.add(e(i,n,s,i,t,o))})):ca(t)&&t.forEach((function(i,r){a.set(r,e(i,n,s,r,t,o))}));var g=u?void 0:(d?l?Go:wn:l?Mo:_n)(t);return jo(g||t,(function(i,r){g&&(i=t[r=i]),gs(a,r,e(i,n,s,r,t,o))})),a};const va=function(e){return pa(e,5)};const ba=function(e){return"string"==typeof e||!Mt(e)&&Bt(e)&&"[object String]"==Ne(e)};var ya=n(6759),_a=n.n(ya);const wa=function(e,t,n){(void 0!==n&&!ae(e[t],n)||void 0===n&&!(t in e))&&fs(e,t,n)};const Sa=function(e){return function(t,n,s){for(var i=-1,r=Object(t),o=s(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===n(r[c],c,r))break}return t}};const Aa=Sa();const xa=function(e){return Bt(e)&&yn(e)};var $a=Function.prototype,Ea=Object.prototype,ja=$a.toString,Ca=Ea.hasOwnProperty,ka=ja.call(Object);const Ta=function(e){if(!Bt(e)||"[object Object]"!=Ne(e))return!1;var t=qo(e);if(null===t)return!0;var n=Ca.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ja.call(n)==ka};const Oa=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};const Na=function(e){return Co(e,Mo(e))};const Ma=function(e,t,n,s,i,r,o){var a=Oa(e,n),c=Oa(t,n),l=o.get(c);if(l)wa(e,n,l);else{var d=r?r(a,c,n+"",e,t,o):void 0,u=void 0===d;if(u){var h=Mt(c),f=!h&&Xt(c),m=!h&&!f&&dn(c);d=c,h||f||m?Mt(a)?d=a:xa(a)?d=Uo(a):f?(u=!1,d=Po(c,!0)):m?(u=!1,d=ta(c,!0)):d=[]:Ta(c)||Wt(c)?(d=a,Wt(a)?d=Na(a):Me(a)&&!Ie(a)||(d=ra(c))):u=!1}u&&(o.set(c,d),i(d,c,s,r,o),o.delete(c)),wa(e,n,d)}};const Ia=function e(t,n,s,i,r){t!==n&&Aa(n,(function(o,a){if(r||(r=new bt),Me(o))Ma(t,n,a,s,e,i,r);else{var c=i?i(Oa(t,a),o,a+"",t,n,r):void 0;void 0===c&&(c=o),wa(t,a,c)}}),Mo)};const Ra=function(e,t){return Rs(Cs(e,t,Ts),e+"")};const Da=function(e,t,n){if(!Me(n))return!1;var s=typeof t;return!!("number"==s?yn(n)&&Zt(t,n.length):"string"==s&&t in n)&&ae(n[t],e)};const za=function(e){return Ra((function(t,n){var s=-1,i=n.length,r=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(r=e.length>3&&"function"==typeof r?(i--,r):void 0,o&&Da(n[0],n[1],o)&&(r=i<3?void 0:r,i=1),t=Object(t);++s<i;){var a=n[s];a&&e(t,a,s,r)}return t}))};const La=za((function(e,t,n){Ia(e,t,n)}));const Pa=za((function(e,t,n,s){Ia(e,t,n,s)})),Ua=Math.max,Ba=Math.min;function qa(e){if("number"==typeof e)return e;if("string"==typeof e){const t=parseFloat(e);return isNaN(t)?0:t}return 0}const Fa=function(e,t,n={}){let s,i,r,o,a,c,l=0,d=!1,u=n.promise?re():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const r=s,a=i,c=u;return s=i=void 0,l=t,o=e.apply(a,r),n.promise&&(c.resolve(o),u=re()),n.promise?c:o}function f(e){const n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=r}function m(){const e=Date.now();if(f(e))return g(e);a=setTimeout(m,function(e){const n=t-(e-c);return d?Ba(n,r-(e-l)):n}(e))}function g(e){return a=void 0,s?h(e):(s=i=void 0,n.promise?u:o)}function p(e,t){if(Array.isArray(e)&&Array.isArray(t))return n?.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function v(){const e=Date.now(),r=f(e);var g;if(g=Array.from(arguments),s=s?.length?g.length?n?.concatArrays||n?.dedupeArrays?Pa(s,g,p):La(s,g):s:g||[],i=this,c=e,r){if(void 0===a)return function(e){return l=e,a=setTimeout(m,t),n.promise?u:o}(c);if(d)return clearTimeout(a),a=setTimeout(m,t),h(c)}return void 0===a&&(a=setTimeout(m,t)),n.promise?u:o}return t=qa(t)||0,function(e){const t=typeof e;return null!=e&&("object"===t||"function"===t)}(n)&&(d="maxWait"in n,r=d?Ua(qa(n.maxWait)||0,t):r),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,s=c=i=a=void 0},v.flush=function(){return void 0===a?o:g(Date.now())},v};const Ha=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))};function Ga(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function Wa(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}const Va=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}};var Ka="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ja=/^~~local_forage_type~([^~]+)~/,Ya="__lfsc__:",Xa="arbf",Qa="blob",Za="si08",ec="ui08",tc="uic8",nc="si16",sc="si32",ic="ur16",rc="ui32",oc="fl32",ac="fl64",cc=Object.prototype.toString;function lc(e){var t,n,s,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=Ka.indexOf(e[t]),s=Ka.indexOf(e[t+1]),i=Ka.indexOf(e[t+2]),r=Ka.indexOf(e[t+3]),d[c++]=n<<2|s>>4,d[c++]=(15&s)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function dc(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=Ka[n[t]>>2],s+=Ka[(3&n[t])<<4|n[t+1]>>4],s+=Ka[(15&n[t+1])<<2|n[t+2]>>6],s+=Ka[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}var uc={serialize:function(e,t){var n="";if(e&&(n=cc.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===cc.call(e.buffer))){var s,i=Ya;e instanceof ArrayBuffer?(s=e,i+=Xa):(s=e.buffer,"[object Int8Array]"===n?i+=Za:"[object Uint8Array]"===n?i+=ec:"[object Uint8ClampedArray]"===n?i+=tc:"[object Int16Array]"===n?i+=nc:"[object Uint16Array]"===n?i+=ic:"[object Int32Array]"===n?i+=sc:"[object Uint32Array]"===n?i+=rc:"[object Float32Array]"===n?i+=oc:"[object Float64Array]"===n?i+=ac:t(new Error("Failed to get type for BinaryArray"))),t(i+dc(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n="~~local_forage_type~"+e.type+"~"+dc(this.result);t(Ya+Qa+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,9)!==Ya)return JSON.parse(e);var t,n=e.substring(13),s=e.substring(9,13);if(s===Qa&&Ja.test(n)){var i=n.match(Ja);t=i[1],n=n.substring(i[0].length)}var r=lc(n);switch(s){case Xa:return r;case Qa:return Va([r],{type:t});case Za:return new Int8Array(r);case ec:return new Uint8Array(r);case tc:return new Uint8ClampedArray(r);case nc:return new Int16Array(r);case ic:return new Uint16Array(r);case sc:return new Int32Array(r);case rc:return new Uint32Array(r);case oc:return new Float32Array(r);case ac:return new Float64Array(r);default:throw new Error("Unkown type: "+s)}},stringToBuffer:lc,bufferToString:dc};function hc(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const fc={serializer:{serialize:uc.serialize,deserialize:uc.deserialize}};const mc={_driver:"sessionStorageWrapper",_initStorage:function(e){if(fc.keyPrefix=hc(e,this._defaultConfig),e)for(const t in e)fc[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const n=this.ready().then((function(){const t=fc.keyPrefix,n=t.length,s=sessionStorage.length;let i=1;for(let r=0;r<s;r++){const s=sessionStorage.key(r);if(0!==s.indexOf(t))continue;let o=sessionStorage.getItem(s);if(o&&(o=fc.serializer.deserialize(o)),o=e(o,s.substring(n),i++),void 0!==o)return o}}));return Ha(n,t),n},getItem:function(e,t){e=Wa(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(fc.keyPrefix+e);return t&&(t=fc.serializer.deserialize(t)),t}));return Ha(n,t),n},setItem:async function(e,t,n){e=Wa(e),await this.ready();const s=t=t??null;return fc.serializer.serialize(t,((t,i)=>{if(i)throw i;try{sessionStorage.setItem(fc.keyPrefix+e,t),Ha(Promise.resolve(s),n)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}})),t},removeItem:function(e,t){e=Wa(e);const n=this.ready().then((function(){sessionStorage.removeItem(fc.keyPrefix+e)}));return Ha(n,t),n},clear:function(e){const t=this.ready().then((function(){const e=fc.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return Ha(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return Ha(t,e),t},key:function(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(fc.keyPrefix.length)),t}));return Ha(n,t),n},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(fc.keyPrefix)&&t.push(e.substring(fc.keyPrefix.length))}return t}));return Ha(t,e),t},dropInstance:function(e,t){if(t=Ga.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let s;return s=e.name?new Promise((function(t){e.storeName?t(hc(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),Ha(s,t),s}},gc=mc;var pc=n(8461);function vc(e){return vc.result?vc.result:e&&"function"==typeof e.getSerializer?(vc.result=e.getSerializer(),vc.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function bc(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function yc(e,t){var n=this.getItem(e).then((function(t){return{key:e,value:t}}));return bc(n,t),n}function _c(e){var t=this,n=new Promise((function(n,s){for(var i=[],r=0,o=e.length;r<o;r++)i.push(yc.call(t,e[r]));Promise.all(i).then((function(e){for(var t={},s=0,i=e.length;s<i;s++){var r=e[s];t[r.key]=r.value}n(t)})).catch(s)}));return n}function wc(){var e={};return this.iterate((function(t,n){e[n]=t})).then((function(){return e}))}var Sc="undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0;function Ac(e){e=e.slice();var t=this;function n(e,t){return e<t?-1:e>t?1:0}var s=new Promise((function(s,i){t.ready().then((function(){var r,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),c=e.sort(n),l=Sc.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(r=a.getAll(l)).onsuccess=function(){var e=r.result;void 0===e&&(e=null),s(e)};else{r=a.openCursor(l);var d={},u=0;r.onsuccess=function(){var e=r.result;if(e){for(var t=e.key;t>c[u];)if(++u===c.length)return void s(d);if(t===c[u]){var n=e.value;void 0===n&&(n=null),d[t]=n,e.continue()}else e.continue(c[u])}else s(d)}}r.onerror=function(){i(r.error)}})).catch(i)}));return s}function xc(e){var t=this,n=new Promise((function(n,s){t.ready().then((function(){return vc(t)})).then((function(i){var r=t._dbInfo;r.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+r.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var s={},r=t.rows,o=0,a=r.length;o<a;o++){var c=r.item(o),l=c.value;l&&(l=i.deserialize(l)),s[c.key]=l}n(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return n}function $c(e,t){var n,s=this;if(arguments.length&&null!==e){var i=s.driver();n=i===s.INDEXEDDB?Ac.apply(s,arguments):i===s.WEBSQL?xc.apply(s,arguments):_c.apply(s,arguments)}else n=wc.apply(s);return bc(n,t),n}function Ec(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=$c,t.getItems.indexedDB=function(){return Ac.apply(this,arguments)},t.getItems.websql=function(){return xc.apply(this,arguments)},t.getItems.generic=function(){return _c.apply(this,arguments)})}Ec(_a());function jc(){return(65536*(1+Math.random())|0).toString(16).substring(1)}const Cc=Eo._driver;_a().defineDriver(Eo),(0,pc.extendPrototype)(_a()),Ec(_a());class kc{constructor(e,t,n=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");ba(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=Fa((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)await _a().setDriver(gc._driver);else if("local"===e)await _a().config({driver:_a().LOCALSTORAGE});else if("in_memory"===e)await _a().config({driver:Cc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=_a(),t&&(this.store.debouncedSetItems=Fa((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){return this.store.debouncedSetItems?.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(){const e=this;async function t(t,n,s){let i,r,o,a;const c=n.collection;["patch","update"].includes(t)&&(a=va(n.attributes)),await e.storeInitialized;try{const r=n.attributes;switch(t){case"read":i=void 0!==n.id?await e.find(n):await e.findAll();break;case"create":i=await e.create(n,s);break;case"patch":case"update":s.wait&&(n.attributes=a),o=e.update(n),s.wait&&(n.attributes=r),i=await o;break;case"delete":i=await e.destroy(n,c)}}catch(t){r=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(i){if(s&&s.success){const e="read"===t?i:null;s.success(e,s)}}else r=r||"Record Not Found",s&&s.error&&s.error(r)}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),s=this.getItemName(e.id);return n.includes(s)||n.push(s),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const s={};return s[this.name]=t,s}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),n}}create(e,t){return e.id||(e.id=jc()+jc()+"-"+jc()+"-"+jc()+"-"+jc()+"-"+jc()+jc()+jc(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);if(e?.length){const t=await this.store.getItems(e);return Object.values(t)}return[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}kc.sessionStorageInitialized=_a().defineDriver(gc),kc.localForage=_a();const Tc=kc;var Oc=n(1702),Nc=n(710);const Mc=Ks;function Ic(){if(uo.state.config.get("trusted")){return"sessionStorage"===Mc.get("persistent_store")?"session":"persistent"}return"session"}function Rc(e){return"persistent"===e&&"IndexedDB"===Mc.get("persistent_store")}function Dc(e,t){const n=t||Ic(),s=uo.storage[n];if(void 0===s)throw new TypeError(`createStore: Could not find store for ${e}`);return new Tc(e,s,Rc(t))}function zc(e,t,n){const s=n||Ic();if(e.browserStorage=Dc(t,s),Rc(s)){const t=()=>e.browserStorage.flush(),n=Qs();window.addEventListener(n,t),e.on("destroy",(()=>window.removeEventListener(n,t))),e.listenTo(uo,"beforeLogout",t)}}function Lc(){return("WebSocket"in window||"MozWebSocket"in window)&&Ks.get("websocket_url")?Ks.get("websocket_url"):Ks.get("bosh_service_url")?Ks.get("bosh_service_url"):""}function Pc(e){if("string"!=typeof e)return!1;return!(e.split("/").length-1>1)&&(2===e.split("@").filter((e=>!!e)).length&&!e.startsWith("@")&&!e.endsWith("@"))}function Uc(e){return!e.startsWith("@")&&!e.endsWith("@")}function Bc(e,t){return"string"==typeof e&&"string"==typeof t&&Cr.getBareJidFromJid(e).toLowerCase()===Cr.getBareJidFromJid(t).toLowerCase()}function qc(e,t){return"string"==typeof e&&"string"==typeof t&&Cr.getDomainFromJid(e).toLowerCase()===Cr.getDomainFromJid(t).toLowerCase()}function Fc(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e}function Hc(e,t=!1){return t?e===uo.session.get("full_jid"):Cr.getBareJidFromJid(e)===uo.session.get("bare_jid")}function Gc(e){e.pluggable.initialized_plugins=[];const t=to.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}async function Wc(e){const t="converse.client-config",n=new ie.Model({id:t,trusted:!0});n.browserStorage=Dc(t,"session"),Object.assign(e,{config:n}),Object.assign(e.state,{config:n}),await new Promise((e=>n.fetch({success:e,error:e}))),e.api.trigger("clientConfigInitialized")}async function Vc(e){await Tc.sessionStorageInitialized,e.storage.session=Tc.localForage.createInstance({name:Xs()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}function Kc(e,t,n="persistent"){const{api:s}=e;if("sessionStorage"===s.settings.get("persistent_store"))return void(e.storage[n]=e.storage.session);if("BrowserExtLocal"===s.settings.get("persistent_store"))return Tc.localForage.defineDriver(Oc.A).then((()=>Tc.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage[n]=Tc.localForage);if("BrowserExtSync"===s.settings.get("persistent_store"))return Tc.localForage.defineDriver(Nc.A).then((()=>Tc.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage[n]=Tc.localForage);const i={name:Xs()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===s.settings.get("persistent_store")?(i.description="localStorage instance",i.driver=[Tc.localForage.LOCALSTORAGE]):"IndexedDB"===s.settings.get("persistent_store")&&(i.description="indexedDB instance",i.driver=[Tc.localForage.INDEXEDDB]),e.storage[n]=Tc.localForage.createInstance(i)}function Jc(e,t){const{api:n,session:s}=e;n.settings.get("authentication")===Dr||Cr.getResourceFromJid(t)||(t=t.toLowerCase()+`/converse.js-${Math.floor(139749528*Math.random()).toString()}`);const i=Cr.getBareJidFromJid(t),r=Cr.getResourceFromJid(t),o=Cr.getDomainFromJid(t);Object.assign(e,{jid:t,bare_jid:i,resource:r,domain:o}),s.save({jid:t,bare_jid:i,resource:r,domain:o,active:!0}),n.connection.get().jid=t}async function Yc(e){return await Xc(uo,e),uo.api.trigger("setUserJID"),e}async function Xc(e,t){const n=e.api.settings.get("connection_options").worker,s=Cr.getBareJidFromJid(t).toLowerCase(),i=`converse.session-${s}`;e.session?.get("id")!==i?(Kc(e,s),e.session.set({id:i}),zc(e.session,i,n?"persistent":"session"),await new Promise((t=>e.session.fetch({success:t,error:t}))),!n&&e.session.get("active")&&(e.session.clear(),e.session.save({id:i})),Jc(e,t),window.addEventListener(Qs(),(()=>il(e.session,{active:!1}))),e.api.trigger("userSessionInitialized")):Jc(e,t)}function Qc(e){e.api.trigger("registeredGlobalEventHandlers")}async function Zc(e){const{api:t}=e;await t.trigger("cleanup",{synchronous:!0}),function(e){e.api.trigger("unregisteredGlobalEventHandlers")}(e),t.connection.get()?.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&t.promises.add("initialized")}function el(e=0){return new Promise($o((async(e,t)=>{let n=new XMLHttpRequest;n.open("GET",uo.api.settings.get("credentials_url"),!0),n.setRequestHeader("Accept","application/json, text/javascript"),n.onload=()=>{if(n.status>=200&&n.status<400){const t=JSON.parse(n.responseText);Yc(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${n.status}: ${n.responseText}`))},n.onerror=t,n=await uo.api.hook("beforeFetchLoginCredentials",this,n),n.send()}),e))}async function tl(e,t){const{api:n}=uo,{credentials:s}=await n.hook("beforeAttemptNonPreboundSession",this,{credentials:e,automatic:t});if(s)return sl(s);if(n.settings.get("authentication")===Pr){const t=uo.session.get("jid");if(e)return sl(e);if(n.settings.get("credentials_url"))return sl(await async function(){let e,t=0;for(;!e;){try{e=await el(t)}catch(e){Y.error("Could not fetch login credentials"),Y.error(e)}t=2e3}return e}());if(t&&(n.settings.get("password")||n.connection.get().pass))return sl();if(n.settings.get("reuse_scram_keys")){const e=await async function(){const e=localStorage.getItem("conversejs-session-jid");if(!e)return null;await Yc(e);const t=(await nl(e)).get("scram_keys");return t?{jid:e,password:t}:null}();if(e)return sl(e)}if(!Xs()&&"credentials"in navigator){const e=await async function(){if(!localStorage.getItem("conversejs-session-jid"))return null;try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&Pc(e.id))return await Yc(e.id),{jid:e.id,password:e.password}}catch(e){return Y.error(e),null}}();if(e)return sl(e)}Xs()||Y.debug("attemptNonPreboundSession: Couldn't find credentials to log in with")}else![Dr,Lr].includes(n.settings.get("authentication"))||t&&!n.settings.get("auto_login")||sl()}async function nl(e){const t=`converse.scram-keys-${Cr.getBareJidFromJid(e)}`;if(uo.state.login_info?.get("id")===t)return uo.state.login_info;const n=new ie.Model({id:t});return uo.state.login_info=n,zc(n,t,"persistent"),await new Promise((e=>n.fetch({success:e,error:e}))),n}async function sl(e){const{api:t}=uo,n=uo.session.get("jid"),s=t.connection.get();if([Dr,Lr].includes(t.settings.get("authentication"))){if(!n)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");s.reconnecting||s.reset(),s.connect(n.toLowerCase())}else if(t.settings.get("authentication")===Pr){const i=e?.password??(s?.pass||t.settings.get("password"));if(!i){if(t.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return s.setDisconnectionCause(Cr.Status.AUTHFAIL,void 0,!0),void t.connection.disconnect()}let r;if(s.reconnecting||(s.reset(),s.service=Lc()),uo.state.config.get("trusted")&&n&&t.settings.get("reuse_scram_keys")&&!i?.ck){const e=await nl(n);r=(t,n)=>{const{scram_keys:i}=s;i&&e.save({scram_keys:i}),s.onConnectStatusChanged(t,n)}}s.connect(n,i,r)}}function il(e,t,n){Hs(e)?e.save(t,n):e.set(t,n)}const rl=Object.keys(Cr.Status).reduce(((e,t)=>Math.max(e,Cr.Status[t])),0);Cr.Status.RECONNECTING=rl+1;class ol extends Cr.Connection{constructor(e,t){super(e,t),this.send_initial_presence=!0,this.debouncedReconnect=$o(this.reconnect,3e3)}xmlInput(e){Y.debug(e.outerHTML,"color: darkgoldenrod")}xmlOutput(e){Y.debug(e.outerHTML,"color: darkcyan")}async bind(){const{api:e}=uo;await e.trigger("beforeResourceBinding",{synchronous:!0}),super.bind()}async onDomainDiscovered(e){const{api:t}=uo,n=await e.text(),s=(new DOMParser).parseFromString(n,"text/xml").firstElementChild;if("XRD"!=s.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=s.namespaceURI)return Y.info("Could not discover XEP-0156 connection methods");const i=Q()('Link[rel="urn:xmpp:alt-connections:xbosh"]',s),r=Q()('Link[rel="urn:xmpp:alt-connections:websocket"]',s),o=i.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("https:"))),a=r.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("wss:")));0===o.length&&0===a.length?Y.info("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(t.settings.set("websocket_url",a.pop()),t.settings.set("bosh_service_url",o.pop()),this.service=t.settings.get("websocket_url")||t.settings.get("bosh_service_url"),this.setProtocol())}async discoverConnectionMethods(e){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},n=`https://${e}/.well-known/host-meta`;let s;try{s=await fetch(n,t)}catch(e){return Y.info(`Failed to discover alternative connection methods at ${n}`),void Y.error(e)}s.status>=200&&s.status<400?await this.onDomainDiscovered(s):Y.info("Could not discover XEP-0156 connection methods")}async connect(e,t,n){const{__:s,api:i}=uo;if(i.settings.get("discover_connection_methods")){const t=Cr.getDomainFromJid(e);await this.discoverConnectionMethods(t)}if(!i.settings.get("bosh_service_url")&&!i.settings.get("websocket_url"))return i.settings.set("show_connection_url_input",!0),void(n||this.onConnectStatusChanged.bind(this))(Cr.Status.DISCONNECTED,s("Could not automatically determine a connection URL"));super.connect(e,t,n||this.onConnectStatusChanged,Tr)}disconnect(e){super.disconnect(e),this.send_initial_presence=!0}async switchTransport(){const{api:e}=uo,t=uo.session.get("bare_jid");e.connection.isType("websocket")&&e.settings.get("bosh_service_url")?(await Yc(t),this._proto._doDisconnect(),this._proto=new Cr.Bosh(this),this.service=e.settings.get("bosh_service_url")):e.connection.isType("bosh")&&e.settings.get("websocket_url")&&(e.settings.get("authentication")===Dr?await Yc(e.settings.get("jid")):await Yc(t),this._proto._doDisconnect(),this._proto=new Cr.Websocket(this),this.service=e.settings.get("websocket_url"))}async reconnect(){const{api:e}=uo;Y.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.reconnecting=!0,await ti(uo);const t=uo.state.connfeedback.get("connection_status");t===Cr.Status.CONNFAIL?this.switchTransport():t===Cr.Status.AUTHFAIL&&e.settings.get("authentication")===Dr&&await Yc(e.settings.get("jid")),e.trigger("will-reconnect"),e.settings.get("authentication")===Dr&&await ni(uo);const n=uo.session.get("jid");return e.user.login(n)}async onConnected(e){const{api:t}=uo;if(delete this.reconnecting,this.flush(),await Yc(this.jid),uo.state.config.get("trusted")){const e=uo.session.get("bare_jid");localStorage.setItem("conversejs-session-jid",e)}await t.trigger("afterResourceBinding",e,{synchronous:!0}),e?t.trigger("reconnected"):t.trigger("connected")}setDisconnectionCause(e,t,n){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||n)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,uo.state.connfeedback.set({connection_status:e,message:t})}async finishDisconnection(){this.setConnectionStatus(Cr.Status.DISCONNECTED);const{api:e}=uo;Y.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),ti(uo),await ni(uo),e.connection.destroy(),e.trigger("disconnected")}onDisconnected(){const{api:e}=uo;if(!e.settings.get("auto_reconnect"))return this.finishDisconnection();{const t=this.disconnection_reason;if(this.disconnection_cause===Cr.Status.AUTHFAIL)return e.settings.get("credentials_url")||e.settings.get("authentication")===Dr?e.connection.reconnect():this.finishDisconnection();if(this.status===Cr.Status.CONNECTING){const{__:e}=uo;return this.setConnectionStatus(Cr.Status.CONNFAIL,e("An error occurred while connecting to the chat server.")),this.finishDisconnection()}if(this.disconnection_cause===Ur||t===Cr.ErrorCondition.NO_AUTH_MECH||"host-unknown"===t||"remote-connection-failed"===t)return this.finishDisconnection();e.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:n}=uo;if(Y.debug(`Status changed to: ${eo[e]}`),e===Cr.Status.ATTACHFAIL)this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!1);else if(e===Cr.Status.CONNECTED||e===Cr.Status.ATTACHED){if(this.worker_attach_promise?.isResolved&&this.status===Cr.Status.ATTACHED)return;this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!0),this.setDisconnectionCause(),this.reconnecting?(Y.debug(e===Cr.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(Y.debug(e===Cr.Status.CONNECTED?"Connected":"Attached"),this.restored&&(this.send_initial_presence=!1),this.onConnected())}else if(e===Cr.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===Cr.Status.BINDREQUIRED)this.bind();else if(e===Cr.Status.ERROR)this.setConnectionStatus(e,n("An error occurred while connecting to the chat server."));else if(e===Cr.Status.CONNECTING)this.setConnectionStatus(e);else if(e===Cr.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===Cr.Status.AUTHFAIL)t||(t=n("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===Cr.Status.CONNFAIL){let s=t;"host-unknown"===t||"remote-connection-failed"==t?s=n("We could not connect to %1$s, is your XMPP address correct?",Cr.getDomainFromJid(this.jid)):"policy-violation"===t?s=n("The XMPP server rejected the connection because of a policy violation"):void 0!==t&&t===Cr?.ErrorCondition?.NO_AUTH_MECH&&(s=n("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,s),this.setDisconnectionCause(e,t)}else e===Cr.Status.DISCONNECTING&&(this.setConnectionStatus(e),this.setDisconnectionCause(e,t))}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof Cr.Websocket:"bosh"===e.toLowerCase()?Cr.Bosh&&this._proto instanceof Cr.Bosh:void 0}hasResumed(){const{api:e}=uo;return e.settings.get("connection_options")?.worker||this.isType("bosh")?uo.state.connfeedback.get("connection_status")===Cr.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=re(),this.worker_attach_promise}}class al extends ol{constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=Cr.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstElementChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(Cr.Status.BINDREQUIRED)}}get _sasl_mechanism(){return new Cr.SASLSHA256}_processRequest(){}sendIQ(e,t,n){e=e.tree?.()??e,this.IQ_stanzas.push(e);const s=super.sendIQ(e,t,n);return this.IQ_ids.push(s),s}send(e){return e=e.tree?.()??e,this.sent_stanzas.push(e),super.send(e)}async bind(){const{api:e}=uo;await e.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,this._changeConnectStatus(Cr.Status.CONNECTED)}}let cl;const ll={explicitResourceBinding:!0},dl={init(e){if(e&&cl?.jid&&qc(cl.jid,e))return cl;if(!Ks.get("bosh_service_url")&&Ks.get("authentication")===qr)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");const t=Xs()?al:ol;return cl=new t(Lc(),Object.assign(ll,Ks.get("connection_options"),{keepalive:Ks.get("keepalive")})),function(){const e=Ks.get("loglevel");Cr.setLogLevel(Cr.LogLevel[e.toUpperCase()]);const t={};t[Cr.LogLevel.DEBUG]="debug",t[Cr.LogLevel.INFO]="info",t[Cr.LogLevel.WARN]="warn",t[Cr.LogLevel.ERROR]="error",t[Cr.LogLevel.FATAL]="fatal",Cr.log=(e,n)=>Y.log(n,t[e]),Cr.error=e=>Y.error(e)}(),ho.trigger("connectionInitialized"),cl},get:()=>cl,destroy(){this.disconnect(),cl?.disconnect(),cl=void 0},authenticated:()=>cl?.authenticated&&!0,connected:()=>cl?.connected&&!0,disconnect(){cl?.disconnect()},reconnect:()=>(cl.setConnectionStatus(Cr.Status.RECONNECTING,"The connection has dropped, attempting to reconnect."),cl?.reconnecting?cl.debouncedReconnect():cl.reconnect()),isType:e=>cl.isType(e)};function ul(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout((()=>{e.apply(this,s)}),t)}}function hl(e,t){clearTimeout(e),clearInterval(t)}function fl(e,t=300,n=3){try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const s=re(),i=new Error;const r=setInterval((function(){try{const t=e();t&&(hl(o,r),s.resolve(t))}catch(e){hl(o,r),s.reject(e)}}),n);const o=setTimeout((function(){hl(o,r);const e=`Wait until promise timed out: \n\n${i.stack}`;console.trace(),Y.error(e),s.reject(new Error(e))}),t);return s}const ml={promises:{add(e,t=!0){(e=Array.isArray(e)?e:[e]).forEach((e=>{const n=re();n.replace=t,uo.promises[e]=n}))}},waitUntil(e){if(Bs(e))return fl(e);{const t=uo.promises[e];return void 0===t?null:t}}};class gl extends Error{}class pl extends Error{constructor(e){super(e),this.retry_event_id=null}}class vl extends Error{constructor(e,t,n){super(t.querySelector("text")?.textContent??""),this.name=e,this.message=e,this.type=t.getAttribute("type"),this.el=t,this.extra=n}}class bl extends Error{constructor(e,t){super(t),this.name="StanzaParseError",this.stanza=e}}class yl extends vl{}class _l extends vl{}class wl extends vl{}class Sl extends vl{}class Al extends vl{}class xl extends vl{}class $l extends vl{}class El extends vl{}class jl extends vl{}class Cl extends vl{}class kl extends vl{}class Tl extends vl{}class Ol extends vl{}class Nl extends vl{}class Ml extends vl{}class Il extends vl{}class Rl extends vl{}class Dl extends vl{}class zl extends vl{}class Ll extends vl{}class Pl extends vl{}class Ul extends vl{}const Bl={send(e){const{api:t}=uo;if(!t.connection.connected())return Y.warn("Not sending stanza because we're not connected!"),void Y.warn(Cr.serialize(e));const n=e instanceof Element?e:e.tree();if("iq"===n.tagName)return t.sendIQ(n);t.connection.get().send(n),t.trigger("send",n)},sendIQ(e,t,n=!0){const{api:s}=uo;if(!s.connection.connected())throw new Error("Not sending IQ stanza because we're not connected!");const i=s.connection.get();let r;const o=e instanceof Element?e:e.tree();return["get","set"].includes(o.getAttribute("type"))?(t=t||s.settings.get("stanza_timeout"),n?(r=new Promise(((e,n)=>i.sendIQ(o,e,n,t))),r.catch((e=>{if(null===e)throw new pl(`Timeout error after ${t}ms for the following IQ stanza: ${Cr.serialize(o)}`)}))):r=new Promise((e=>i.sendIQ(o,e,e,t)))):(i.sendIQ(o),r=Promise.resolve()),s.trigger("send",o),r}};async function ql(){if(ei(uo)){const{chatboxes:e}=uo.state;await Promise.all(e.map((e=>e.messages?.clearStore({silent:!0})))),e.clearStore({silent:!0},(e=>e.get("type")!==Zr))}}async function Fl(e,t,n){let s;e=Cr.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{s=new n(t,{collection:uo.state.chatboxes})}catch(e){return Y.error(e),null}return await s.initialized,s.isValid()?(uo.state.chatboxes.add(s),s):(s.destroy(),null)}const{waitUntil:Hl}=ml,Gl={},Wl={create:async(e=[],t={},n)=>(await Hl("chatBoxesFetched"),"string"==typeof e?Fl(e,t,n):Promise.all(e.map((e=>Fl(e,t,n))))),async get(e){await Hl("chatBoxesFetched");const{chatboxes:t}=uo.state;return void 0===e?t.models:"string"==typeof e?t.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),t.models.filter((t=>e.includes(t.get("jid")))))},registry:{add(e,t){Gl[e]=t},get:e=>Gl[e]}},{waitUntil:Vl}=ml,Kl={create(e,t={}){if(!(t="string"==typeof t?{nick:t}:t||{}).nick&&Ks.get("muc_nickname_from_jid")){const e=uo.session.get("bare_jid");t.nick=Cr.getNodeFromJid(e)}if(void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?Kl.get(Fc(e),t,!0):Promise.all(e.map((e=>Kl.get(Fc(e),t,!0))))},async open(e,t={},n=!1){if(await Vl("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw Y.error(e),new TypeError(e)}if("string"==typeof e){const s=await Kl.get(e,t,!0);return!t.hidden&&s?.maybeShow(n),s}{const s=await Promise.all(e.map((e=>s.get(e,t,!0))));return s.forEach((e=>!t.hidden&&e.maybeShow(n))),s}},async get(e,t={},n=!1){async function s(e){e=Fc(e);let s=await Wl.get(e);return!s&&n?s=await Wl.create(e,t,uo.exports.MUC):(s=s&&s.get("type")===Xr?s:null,s&&Object.keys(t).length&&s.save(t)),s}if(await Vl("chatBoxesFetched"),void 0===e){return(await Wl.get()).filter((e=>e.get("type")===Xr))}return"string"==typeof e?s(e):Promise.all(e.map((e=>s(e))))}},Jl={rooms:Kl},{waitUntil:Yl}=ml,{send:Xl}=Bl,{rooms:Ql}=Jl,Zl={presence:{async send(e,t){await Yl("statusInitialized");let n=[];t&&(n=Array.isArray(t)?t:[t]);const s=uo.state.profile,i=await s.constructPresence(e);n.map((e=>e?.tree()??e)).forEach((e=>i.cnode(e).up())),Xl(i);const{show:r,type:o}=e||{};if(r||!o){(await Ql.get()).forEach((t=>t.sendStatusPresence(e,n)))}}}};let ed;function td(){const e=uo.session.get("bare_jid");if(!e){const e="No JID to fetch user settings for";throw Y.error(e),Error(e)}const t=`converse.user-settings.${e}`;if(ed?.get("id")!==t)return ed=new ie.Model({id:t}),zc(ed,t),ed.fetch({promise:!0})}async function nd(){return await td(),ed}async function sd(e,t){return await td(),ed.save(e,t)}const id={getModel:()=>nd(),async get(e,t){const n=await nd();return void 0===n.get(e)?t:n.get(e)},set(e,t){if(e instanceof Object)return sd(e,{promise:!0});{const n={};return n[e]=t,sd(n,{promise:!0})}},clear:()=>async function(){if(uo.session.get("bare_jid"))return await td(),ed.clear();ed=void 0}()},rd={user:{settings:id,...Zl,jid:()=>dl.get()?.jid,async login(e,t,n=!1){const{api:s}=uo;e=e||s.settings.get("jid");const i=dl.init(e);if(s.settings.get("connection_options")?.worker&&await i.restoreWorkerSession())return;e&&(e=await Yc(e));const{success:r}=await uo.api.hook("login",this,{jid:e,password:t,automatic:n});if(r)return;t=t||s.settings.get("password");const o=e&&t?{jid:e,password:t}:null;await tl(o,n)},async logout(){const{api:e}=uo;await e.trigger("beforeLogout",{synchronous:!0});const t=re(),n=()=>{Object.keys(uo.promises).forEach((e=>Zs(uo,e))),localStorage.removeItem("conversejs-session-jid"),e.trigger("logout"),t.resolve()},s=dl.get();return s?(s.setDisconnectionCause(Ur,void 0,!0),e.listen.once("disconnected",(()=>n())),s.disconnect()):n(),t}}},od=rd,ad={connection:dl,settings:Ks,...Bl,...od,...ho,...ml,disco:null,elements:null,contacts:null},{entries:cd,setPrototypeOf:ld,isFrozen:dd,getPrototypeOf:ud,getOwnPropertyDescriptor:hd}=Object;let{freeze:fd,seal:md,create:gd}=Object,{apply:pd,construct:vd}="undefined"!=typeof Reflect&&Reflect;fd||(fd=function(e){return e}),md||(md=function(e){return e}),pd||(pd=function(e,t,n){return e.apply(t,n)}),vd||(vd=function(e,t){return new e(...t)});const bd=Md(Array.prototype.forEach),yd=Md(Array.prototype.lastIndexOf),_d=Md(Array.prototype.pop),wd=Md(Array.prototype.push),Sd=Md(Array.prototype.splice),Ad=Md(String.prototype.toLowerCase),xd=Md(String.prototype.toString),$d=Md(String.prototype.match),Ed=Md(String.prototype.replace),jd=Md(String.prototype.indexOf),Cd=Md(String.prototype.trim),kd=Md(Object.prototype.hasOwnProperty),Td=Md(RegExp.prototype.test),Od=(Nd=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return vd(Nd,t)});var Nd;function Md(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return pd(e,t,s)}}function Id(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ad;ld&&ld(e,null);let s=t.length;for(;s--;){let i=t[s];if("string"==typeof i){const e=n(i);e!==i&&(dd(t)||(t[s]=e),i=e)}e[i]=!0}return e}function Rd(e){for(let t=0;t<e.length;t++){kd(e,t)||(e[t]=null)}return e}function Dd(e){const t=gd(null);for(const[n,s]of cd(e)){kd(e,n)&&(Array.isArray(s)?t[n]=Rd(s):s&&"object"==typeof s&&s.constructor===Object?t[n]=Dd(s):t[n]=s)}return t}function zd(e,t){for(;null!==e;){const n=hd(e,t);if(n){if(n.get)return Md(n.get);if("function"==typeof n.value)return Md(n.value)}e=ud(e)}return function(){return null}}const Ld=fd(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Pd=fd(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ud=fd(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Bd=fd(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),qd=fd(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Fd=fd(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Hd=fd(["#text"]),Gd=fd(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Wd=fd(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Vd=fd(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Kd=fd(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Jd=md(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Yd=md(/<%[\w\W]*|[\w\W]*%>/gm),Xd=md(/\$\{[\w\W]*/gm),Qd=md(/^data-[\-\w.\u00B7-\uFFFF]+$/),Zd=md(/^aria-[\-\w]+$/),eu=md(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),tu=md(/^(?:\w+script|data):/i),nu=md(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),su=md(/^html$/i),iu=md(/^[a-z][.\w]*(-[.\w]+)+$/i);var ru=Object.freeze({__proto__:null,ARIA_ATTR:Zd,ATTR_WHITESPACE:nu,CUSTOM_ELEMENT:iu,DATA_ATTR:Qd,DOCTYPE_NAME:su,ERB_EXPR:Yd,IS_ALLOWED_URI:eu,IS_SCRIPT_OR_DATA:tu,MUSTACHE_EXPR:Jd,TMPLIT_EXPR:Xd});const ou=1,au=3,cu=7,lu=8,du=9,uu=function(){return"undefined"==typeof window?null:window};var hu=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uu();const n=t=>e(t);if(n.version="3.2.5",n.removed=[],!t||!t.document||t.document.nodeType!==du||!t.Element)return n.isSupported=!1,n;let{document:s}=t;const i=s,r=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:c,Element:l,NodeFilter:d,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:m}=t,g=l.prototype,p=zd(g,"cloneNode"),v=zd(g,"remove"),b=zd(g,"nextSibling"),y=zd(g,"childNodes"),_=zd(g,"parentNode");if("function"==typeof a){const e=s.createElement("template");e.content&&e.content.ownerDocument&&(s=e.content.ownerDocument)}let w,S="";const{implementation:A,createNodeIterator:x,createDocumentFragment:$,getElementsByTagName:E}=s,{importNode:j}=i;let C={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof cd&&"function"==typeof _&&A&&void 0!==A.createHTMLDocument;const{MUSTACHE_EXPR:k,ERB_EXPR:T,TMPLIT_EXPR:O,DATA_ATTR:N,ARIA_ATTR:M,IS_SCRIPT_OR_DATA:I,ATTR_WHITESPACE:R,CUSTOM_ELEMENT:D}=ru;let{IS_ALLOWED_URI:z}=ru,L=null;const P=Id({},[...Ld,...Pd,...Ud,...qd,...Hd]);let U=null;const B=Id({},[...Gd,...Wd,...Vd,...Kd]);let q=Object.seal(gd(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),F=null,H=null,G=!0,W=!0,V=!1,K=!0,J=!1,Y=!0,X=!1,Q=!1,Z=!1,ee=!1,te=!1,ne=!1,se=!0,ie=!1,re=!0,oe=!1,ae={},ce=null;const le=Id({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let de=null;const ue=Id({},["audio","video","img","source","image","track"]);let he=null;const fe=Id({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),me="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",pe="http://www.w3.org/1999/xhtml";let ve=pe,be=!1,ye=null;const _e=Id({},[me,ge,pe],xd);let we=Id({},["mi","mo","mn","ms","mtext"]),Se=Id({},["annotation-xml"]);const Ae=Id({},["title","style","font","a","script"]);let xe=null;const $e=["application/xhtml+xml","text/html"];let Ee=null,je=null;const Ce=s.createElement("form"),ke=function(e){return e instanceof RegExp||e instanceof Function},Te=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!je||je!==e){if(e&&"object"==typeof e||(e={}),e=Dd(e),xe=-1===$e.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Ee="application/xhtml+xml"===xe?xd:Ad,L=kd(e,"ALLOWED_TAGS")?Id({},e.ALLOWED_TAGS,Ee):P,U=kd(e,"ALLOWED_ATTR")?Id({},e.ALLOWED_ATTR,Ee):B,ye=kd(e,"ALLOWED_NAMESPACES")?Id({},e.ALLOWED_NAMESPACES,xd):_e,he=kd(e,"ADD_URI_SAFE_ATTR")?Id(Dd(fe),e.ADD_URI_SAFE_ATTR,Ee):fe,de=kd(e,"ADD_DATA_URI_TAGS")?Id(Dd(ue),e.ADD_DATA_URI_TAGS,Ee):ue,ce=kd(e,"FORBID_CONTENTS")?Id({},e.FORBID_CONTENTS,Ee):le,F=kd(e,"FORBID_TAGS")?Id({},e.FORBID_TAGS,Ee):{},H=kd(e,"FORBID_ATTR")?Id({},e.FORBID_ATTR,Ee):{},ae=!!kd(e,"USE_PROFILES")&&e.USE_PROFILES,G=!1!==e.ALLOW_ARIA_ATTR,W=!1!==e.ALLOW_DATA_ATTR,V=e.ALLOW_UNKNOWN_PROTOCOLS||!1,K=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,J=e.SAFE_FOR_TEMPLATES||!1,Y=!1!==e.SAFE_FOR_XML,X=e.WHOLE_DOCUMENT||!1,ee=e.RETURN_DOM||!1,te=e.RETURN_DOM_FRAGMENT||!1,ne=e.RETURN_TRUSTED_TYPE||!1,Z=e.FORCE_BODY||!1,se=!1!==e.SANITIZE_DOM,ie=e.SANITIZE_NAMED_PROPS||!1,re=!1!==e.KEEP_CONTENT,oe=e.IN_PLACE||!1,z=e.ALLOWED_URI_REGEXP||eu,ve=e.NAMESPACE||pe,we=e.MATHML_TEXT_INTEGRATION_POINTS||we,Se=e.HTML_INTEGRATION_POINTS||Se,q=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ke(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(q.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ke(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(q.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(q.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),J&&(W=!1),te&&(ee=!0),ae&&(L=Id({},Hd),U=[],!0===ae.html&&(Id(L,Ld),Id(U,Gd)),!0===ae.svg&&(Id(L,Pd),Id(U,Wd),Id(U,Kd)),!0===ae.svgFilters&&(Id(L,Ud),Id(U,Wd),Id(U,Kd)),!0===ae.mathMl&&(Id(L,qd),Id(U,Vd),Id(U,Kd))),e.ADD_TAGS&&(L===P&&(L=Dd(L)),Id(L,e.ADD_TAGS,Ee)),e.ADD_ATTR&&(U===B&&(U=Dd(U)),Id(U,e.ADD_ATTR,Ee)),e.ADD_URI_SAFE_ATTR&&Id(he,e.ADD_URI_SAFE_ATTR,Ee),e.FORBID_CONTENTS&&(ce===le&&(ce=Dd(ce)),Id(ce,e.FORBID_CONTENTS,Ee)),re&&(L["#text"]=!0),X&&Id(L,["html","head","body"]),L.table&&(Id(L,["tbody"]),delete F.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Od('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Od('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=e.TRUSTED_TYPES_POLICY,S=w.createHTML("")}else void 0===w&&(w=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(n=t.getAttribute(s));const i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(m,r)),null!==w&&"string"==typeof S&&(S=w.createHTML(""));fd&&fd(e),je=e}},Oe=Id({},[...Pd,...Ud,...Bd]),Ne=Id({},[...qd,...Fd]),Me=function(e){wd(n.removed,{element:e});try{_(e).removeChild(e)}catch(t){v(e)}},Ie=function(e,t){try{wd(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){wd(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||te)try{Me(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},Re=function(e){let t=null,n=null;if(Z)e="<remove></remove>"+e;else{const t=$d(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===xe&&ve===pe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const i=w?w.createHTML(e):e;if(ve===pe)try{t=(new f).parseFromString(i,xe)}catch(e){}if(!t||!t.documentElement){t=A.createDocument(ve,"template",null);try{t.documentElement.innerHTML=be?S:i}catch(e){}}const r=t.body||t.documentElement;return e&&n&&r.insertBefore(s.createTextNode(n),r.childNodes[0]||null),ve===pe?E.call(t,X?"html":"body")[0]:X?t.documentElement:r},De=function(e){return x.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},ze=function(e){return e instanceof h&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof u)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Le=function(e){return"function"==typeof c&&e instanceof c};function Pe(e,t,s){bd(e,(e=>{e.call(n,t,s,je)}))}const Ue=function(e){let t=null;if(Pe(C.beforeSanitizeElements,e,null),ze(e))return Me(e),!0;const s=Ee(e.nodeName);if(Pe(C.uponSanitizeElement,e,{tagName:s,allowedTags:L}),e.hasChildNodes()&&!Le(e.firstElementChild)&&Td(/<[/\w!]/g,e.innerHTML)&&Td(/<[/\w!]/g,e.textContent))return Me(e),!0;if(e.nodeType===cu)return Me(e),!0;if(Y&&e.nodeType===lu&&Td(/<[/\w]/g,e.data))return Me(e),!0;if(!L[s]||F[s]){if(!F[s]&&qe(s)){if(q.tagNameCheck instanceof RegExp&&Td(q.tagNameCheck,s))return!1;if(q.tagNameCheck instanceof Function&&q.tagNameCheck(s))return!1}if(re&&!ce[s]){const t=_(e)||e.parentNode,n=y(e)||e.childNodes;if(n&&t){for(let s=n.length-1;s>=0;--s){const i=p(n[s],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,b(e))}}}return Me(e),!0}return e instanceof l&&!function(e){let t=_(e);t&&t.tagName||(t={namespaceURI:ve,tagName:"template"});const n=Ad(e.tagName),s=Ad(t.tagName);return!!ye[e.namespaceURI]&&(e.namespaceURI===ge?t.namespaceURI===pe?"svg"===n:t.namespaceURI===me?"svg"===n&&("annotation-xml"===s||we[s]):Boolean(Oe[n]):e.namespaceURI===me?t.namespaceURI===pe?"math"===n:t.namespaceURI===ge?"math"===n&&Se[s]:Boolean(Ne[n]):e.namespaceURI===pe?!(t.namespaceURI===ge&&!Se[s])&&!(t.namespaceURI===me&&!we[s])&&!Ne[n]&&(Ae[n]||!Oe[n]):!("application/xhtml+xml"!==xe||!ye[e.namespaceURI]))}(e)?(Me(e),!0):"noscript"!==s&&"noembed"!==s&&"noframes"!==s||!Td(/<\/no(script|embed|frames)/i,e.innerHTML)?(J&&e.nodeType===au&&(t=e.textContent,bd([k,T,O],(e=>{t=Ed(t,e," ")})),e.textContent!==t&&(wd(n.removed,{element:e.cloneNode()}),e.textContent=t)),Pe(C.afterSanitizeElements,e,null),!1):(Me(e),!0)},Be=function(e,t,n){if(se&&("id"===t||"name"===t)&&(n in s||n in Ce))return!1;if(W&&!H[t]&&Td(N,t));else if(G&&Td(M,t));else if(!U[t]||H[t]){if(!(qe(e)&&(q.tagNameCheck instanceof RegExp&&Td(q.tagNameCheck,e)||q.tagNameCheck instanceof Function&&q.tagNameCheck(e))&&(q.attributeNameCheck instanceof RegExp&&Td(q.attributeNameCheck,t)||q.attributeNameCheck instanceof Function&&q.attributeNameCheck(t))||"is"===t&&q.allowCustomizedBuiltInElements&&(q.tagNameCheck instanceof RegExp&&Td(q.tagNameCheck,n)||q.tagNameCheck instanceof Function&&q.tagNameCheck(n))))return!1}else if(he[t]);else if(Td(z,Ed(n,R,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==jd(n,"data:")||!de[e]){if(V&&!Td(I,Ed(n,R,"")));else if(n)return!1}else;return!0},qe=function(e){return"annotation-xml"!==e&&$d(e,D)},Fe=function(e){Pe(C.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||ze(e))return;const s={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let i=t.length;for(;i--;){const r=t[i],{name:o,namespaceURI:a,value:c}=r,l=Ee(o);let d="value"===o?c:Cd(c);if(s.attrName=l,s.attrValue=d,s.keepAttr=!0,s.forceKeepAttr=void 0,Pe(C.uponSanitizeAttribute,e,s),d=s.attrValue,!ie||"id"!==l&&"name"!==l||(Ie(o,e),d="user-content-"+d),Y&&Td(/((--!?|])>)|<\/(style|title)/i,d)){Ie(o,e);continue}if(s.forceKeepAttr)continue;if(Ie(o,e),!s.keepAttr)continue;if(!K&&Td(/\/>/i,d)){Ie(o,e);continue}J&&bd([k,T,O],(e=>{d=Ed(d,e," ")}));const u=Ee(e.nodeName);if(Be(u,l,d)){if(w&&"object"==typeof m&&"function"==typeof m.getAttributeType)if(a);else switch(m.getAttributeType(u,l)){case"TrustedHTML":d=w.createHTML(d);break;case"TrustedScriptURL":d=w.createScriptURL(d)}try{a?e.setAttributeNS(a,o,d):e.setAttribute(o,d),ze(e)?Me(e):_d(n.removed)}catch(e){}}}Pe(C.afterSanitizeAttributes,e,null)},He=function e(t){let n=null;const s=De(t);for(Pe(C.beforeSanitizeShadowDOM,t,null);n=s.nextNode();)Pe(C.uponSanitizeShadowNode,n,null),Ue(n),Fe(n),n.content instanceof o&&e(n.content);Pe(C.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null,r=null,a=null,l=null;if(be=!e,be&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Le(e)){if("function"!=typeof e.toString)throw Od("toString is not a function");if("string"!=typeof(e=e.toString()))throw Od("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Q||Te(t),n.removed=[],"string"==typeof e&&(oe=!1),oe){if(e.nodeName){const t=Ee(e.nodeName);if(!L[t]||F[t])throw Od("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof c)s=Re("\x3c!----\x3e"),r=s.ownerDocument.importNode(e,!0),r.nodeType===ou&&"BODY"===r.nodeName||"HTML"===r.nodeName?s=r:s.appendChild(r);else{if(!ee&&!J&&!X&&-1===e.indexOf("<"))return w&&ne?w.createHTML(e):e;if(s=Re(e),!s)return ee?null:ne?S:""}s&&Z&&Me(s.firstChild);const d=De(oe?e:s);for(;a=d.nextNode();)Ue(a),Fe(a),a.content instanceof o&&He(a.content);if(oe)return e;if(ee){if(te)for(l=$.call(s.ownerDocument);s.firstChild;)l.appendChild(s.firstChild);else l=s;return(U.shadowroot||U.shadowrootmode)&&(l=j.call(i,l,!0)),l}let u=X?s.outerHTML:s.innerHTML;return X&&L["!doctype"]&&s.ownerDocument&&s.ownerDocument.doctype&&s.ownerDocument.doctype.name&&Td(su,s.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+s.ownerDocument.doctype.name+">\n"+u),J&&bd([k,T,O],(e=>{u=Ed(u,e," ")})),w&&ne?w.createHTML(u):u},n.setConfig=function(){Te(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Q=!0},n.clearConfig=function(){je=null,Q=!1},n.isValidAttribute=function(e,t,n){je||Te({});const s=Ee(e),i=Ee(t);return Be(s,i,n)},n.addHook=function(e,t){"function"==typeof t&&wd(C[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=yd(C[e],t);return-1===n?void 0:Sd(C[e],n,1)[0]}return _d(C[e])},n.removeHooks=function(e){C[e]=[]},n.removeAllHooks=function(){C={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();function fu(e){return e instanceof Element||e instanceof HTMLDocument}function mu(e,t){if(e instanceof Cr.Builder)return mu(e.tree(),t);if(e instanceof Element)return Cr.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")}function gu(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function pu(e,t){return Array.from(e.childNodes).filter((e=>e instanceof Element&&e.matches(t)))}function vu(e){for(var t=0;e=e.previousElementSibling;t++);return t}const bu=document.createElement("div");function yu(e){return e&&"string"==typeof e&&(bu.innerHTML=hu.sanitize(e),e=bu.textContent,bu.textContent=""),e}function _u(e){return!!fu(e)&&"error"===e.getAttribute("type")}function wu(e){return!!fu(e)&&Q()(`error[type="auth"] forbidden[xmlns="${Cr.NS.STANZAS}"]`,e).length>0}function Su(e){return!!fu(e)&&Q()(`error[type="cancel"] service-unavailable[xmlns="${Cr.NS.STANZAS}"]`,e).length>0}function Au(e){return e.getAttributeNames().reduce(((t,n)=>(t[n]=Cr.xmlunescape(e.getAttribute(n)),t)),{})}const xu="bits",$u="bytes",Eu="",ju="jedec",Cu="round",ku="string",Tu={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function Ou(e,{bits:t=!1,pad:n=!1,base:s=-1,round:i=2,locale:r="",localeOptions:o={},separator:a="",spacer:c=" ",symbols:l={},standard:d="",output:u=ku,fullform:h=!1,fullforms:f=[],exponent:m=-1,roundingMethod:g=Cu,precision:p=0}={}){let v=m,b=Number(e),y=[],_=0,w=Eu;"si"===d?(s=10,d=ju):"iec"===d||d===ju?s=2:2===s?d="iec":(s=10,d=ju);const S=10===s?1e3:1024,A=!0===h,x=b<0,$=Math[g];if("bigint"!=typeof e&&isNaN(e))throw new TypeError("Invalid number");if("function"!=typeof $)throw new TypeError("Invalid rounding method");if(x&&(b=-b),(-1===v||isNaN(v))&&(v=Math.floor(Math.log(b)/Math.log(S)),v<0&&(v=0)),v>8&&(p>0&&(p+=8-v),v=8),"exponent"===u)return v;if(0===b)y[0]=0,w=y[1]=Tu.symbol[d][t?xu:$u][v];else{_=b/(2===s?Math.pow(2,10*v):Math.pow(1e3,v)),t&&(_*=8,_>=S&&v<8&&(_/=S,v++));const e=Math.pow(10,v>0?i:0);y[0]=$(_*e)/e,y[0]===S&&v<8&&-1===m&&(y[0]=1,v++),w=y[1]=10===s&&1===v?t?"kbit":"kB":Tu.symbol[d][t?xu:$u][v]}if(x&&(y[0]=-y[0]),p>0&&(y[0]=y[0].toPrecision(p)),y[1]=l[y[1]]||y[1],!0===r?y[0]=y[0].toLocaleString():r.length>0?y[0]=y[0].toLocaleString(r,o):a.length>0&&(y[0]=y[0].toString().replace(".",a)),n&&i>0){const e=y[0].toString(),t=a||(e.match(/(\D)/g)||[]).pop()||".",n=e.toString().split(t),s=n[1]||Eu,r=s.length,o=i-r;y[0]=`${n[0]}${t}${s.padEnd(r+o,"0")}`}return A&&(y[1]=f[v]?f[v]:Tu.fullform[d][v]+(t?"bit":"byte")+(1===y[0]?Eu:"s")),"array"===u?y:"object"===u?{value:y[0],symbol:y[1],exponent:v,unit:w}:y.join(c)}const Nu=globalThis,Mu=Nu.ShadowRoot&&(void 0===Nu.ShadyCSS||Nu.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Iu=Symbol(),Ru=new WeakMap;class Du{constructor(e,t,n){if(this._$cssResult$=!0,n!==Iu)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Mu&&void 0===e){const n=void 0!==t&&1===t.length;n&&(e=Ru.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&Ru.set(t,e))}return e}toString(){return this.cssText}}const zu=(e,t)=>{if(Mu)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const n of t){const t=document.createElement("style"),s=Nu.litNonce;void 0!==s&&t.setAttribute("nonce",s),t.textContent=n.cssText,e.appendChild(t)}},Lu=Mu?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new Du("string"==typeof e?e:e+"",void 0,Iu))(t)})(e):e,{is:Pu,defineProperty:Uu,getOwnPropertyDescriptor:Bu,getOwnPropertyNames:qu,getOwnPropertySymbols:Fu,getPrototypeOf:Hu}=Object,Gu=globalThis,Wu=Gu.trustedTypes,Vu=Wu?Wu.emptyScript:"",Ku=Gu.reactiveElementPolyfillSupport,Ju=(e,t)=>e,Yu={toAttribute(e,t){switch(t){case Boolean:e=e?Vu:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},Xu=(e,t)=>!Pu(e,t),Qu={attribute:!0,type:String,converter:Yu,reflect:!1,hasChanged:Xu};Symbol.metadata??=Symbol("metadata"),Gu.litPropertyMetadata??=new WeakMap;class Zu extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=Qu){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),s=this.getPropertyDescriptor(e,n,t);void 0!==s&&Uu(this.prototype,e,s)}}static getPropertyDescriptor(e,t,n){const{get:s,set:i}=Bu(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get(){return s?.call(this)},set(t){const r=s?.call(this);i.call(this,t),this.requestUpdate(e,r,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??Qu}static _$Ei(){if(this.hasOwnProperty(Ju("elementProperties")))return;const e=Hu(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Ju("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ju("properties"))){const e=this.properties,t=[...qu(e),...Fu(e)];for(const n of t)this.createProperty(n,e[n])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,n]of t)this.elementProperties.set(e,n)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const n=this._$Eu(e,t);void 0!==n&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(Lu(e))}else void 0!==e&&t.push(Lu(e));return t}static _$Eu(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return zu(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EC(e,t){const n=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,n);if(void 0!==s&&!0===n.reflect){const i=(void 0!==n.converter?.toAttribute?n.converter:Yu).toAttribute(t,n.type);this._$Em=e,null==i?this.removeAttribute(s):this.setAttribute(s,i),this._$Em=null}}_$AK(e,t){const n=this.constructor,s=n._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=n.getPropertyOptions(s),i="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:Yu;this._$Em=s,this[s]=i.fromAttribute(t,e.type),this._$Em=null}}requestUpdate(e,t,n){if(void 0!==e){if(n??=this.constructor.getPropertyOptions(e),!(n.hasChanged??Xu)(this[e],t))return;this.P(e,t,n)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(e,t,n){this._$AL.has(e)||this._$AL.set(e,t),!0===n.reflect&&this._$Em!==e&&(this._$Ej??=new Set).add(e)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,n]of e)!0!==n.wrapped||this._$AL.has(t)||void 0===this[t]||this.P(t,this[t],n)}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EU()}catch(t){throw e=!1,this._$EU(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&=this._$Ej.forEach((e=>this._$EC(e,this[e]))),this._$EU()}updated(e){}firstUpdated(e){}}Zu.elementStyles=[],Zu.shadowRootOptions={mode:"open"},Zu[Ju("elementProperties")]=new Map,Zu[Ju("finalized")]=new Map,Ku?.({ReactiveElement:Zu}),(Gu.reactiveElementVersions??=[]).push("2.0.4");const eh=globalThis,th=eh.trustedTypes,nh=th?th.createPolicy("lit-html",{createHTML:e=>e}):void 0,sh="$lit$",ih=`lit$${Math.random().toFixed(9).slice(2)}$`,rh="?"+ih,oh=`<${rh}>`,ah=document,ch=()=>ah.createComment(""),lh=e=>null===e||"object"!=typeof e&&"function"!=typeof e,dh=Array.isArray,uh=e=>dh(e)||"function"==typeof e?.[Symbol.iterator],hh="[ \t\n\f\r]",fh=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,mh=/-->/g,gh=/>/g,ph=RegExp(`>|${hh}(?:([^\\s"'>=/]+)(${hh}*=${hh}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),vh=/'/g,bh=/"/g,yh=/^(?:script|style|textarea|title)$/i,_h=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),wh=_h(1),Sh=_h(2),Ah=(_h(3),Symbol.for("lit-noChange")),xh=Symbol.for("lit-nothing"),$h=new WeakMap,Eh=ah.createTreeWalker(ah,129);function jh(e,t){if(!dh(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==nh?nh.createHTML(t):t}const Ch=(e,t)=>{const n=e.length-1,s=[];let i,r=2===t?"<svg>":3===t?"<math>":"",o=fh;for(let t=0;t<n;t++){const n=e[t];let a,c,l=-1,d=0;for(;d<n.length&&(o.lastIndex=d,c=o.exec(n),null!==c);)d=o.lastIndex,o===fh?"!--"===c[1]?o=mh:void 0!==c[1]?o=gh:void 0!==c[2]?(yh.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=ph):void 0!==c[3]&&(o=ph):o===ph?">"===c[0]?(o=i??fh,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?ph:'"'===c[3]?bh:vh):o===bh||o===vh?o=ph:o===mh||o===gh?o=fh:(o=ph,i=void 0);const u=o===ph&&e[t+1].startsWith("/>")?" ":"";r+=o===fh?n+oh:l>=0?(s.push(a),n.slice(0,l)+sh+n.slice(l)+ih+u):n+ih+(-2===l?t:u)}return[jh(e,r+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]};class kh{constructor({strings:e,_$litType$:t},n){let s;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=Ch(e,t);if(this.el=kh.createElement(c,n),Eh.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=Eh.nextNode())&&a.length<o;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(sh)){const t=l[r++],n=s.getAttribute(e).split(ih),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:n,ctor:"."===o[1]?Ih:"?"===o[1]?Rh:"@"===o[1]?Dh:Mh}),s.removeAttribute(e)}else e.startsWith(ih)&&(a.push({type:6,index:i}),s.removeAttribute(e));if(yh.test(s.tagName)){const e=s.textContent.split(ih),t=e.length-1;if(t>0){s.textContent=th?th.emptyScript:"";for(let n=0;n<t;n++)s.append(e[n],ch()),Eh.nextNode(),a.push({type:2,index:++i});s.append(e[t],ch())}}}else if(8===s.nodeType)if(s.data===rh)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=s.data.indexOf(ih,e+1));)a.push({type:7,index:i}),e+=ih.length-1}i++}}static createElement(e,t){const n=ah.createElement("template");return n.innerHTML=e,n}}function Th(e,t,n=e,s){if(t===Ah)return t;let i=void 0!==s?n._$Co?.[s]:n._$Cl;const r=lh(t)?void 0:t._$litDirective$;return i?.constructor!==r&&(i?._$AO?.(!1),void 0===r?i=void 0:(i=new r(e),i._$AT(e,n,s)),void 0!==s?(n._$Co??=[])[s]=i:n._$Cl=i),void 0!==i&&(t=Th(e,i._$AS(e,t.values),i,s)),t}class Oh{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,s=(e?.creationScope??ah).importNode(t,!0);Eh.currentNode=s;let i=Eh.nextNode(),r=0,o=0,a=n[0];for(;void 0!==a;){if(r===a.index){let t;2===a.type?t=new Nh(i,i.nextSibling,this,e):1===a.type?t=new a.ctor(i,a.name,a.strings,this,e):6===a.type&&(t=new zh(i,this,e)),this._$AV.push(t),a=n[++o]}r!==a?.index&&(i=Eh.nextNode(),r++)}return Eh.currentNode=ah,s}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class Nh{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,n,s){this.type=2,this._$AH=xh,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Th(this,e,t),lh(e)?e===xh||null==e||""===e?(this._$AH!==xh&&this._$AR(),this._$AH=xh):e!==this._$AH&&e!==Ah&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):uh(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==xh&&lh(this._$AH)?this._$AA.nextSibling.data=e:this.T(ah.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:n}=e,s="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=kh.createElement(jh(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===s)this._$AH.p(t);else{const e=new Oh(s,this),n=e.u(this.options);e.p(t),this.T(n),this._$AH=e}}_$AC(e){let t=$h.get(e.strings);return void 0===t&&$h.set(e.strings,t=new kh(e)),t}k(e){dh(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,s=0;for(const i of e)s===t.length?t.push(n=new Nh(this.O(ch()),this.O(ch()),this,this.options)):n=t[s],n._$AI(i),s++;s<t.length&&(this._$AR(n&&n._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Mh{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,s,i){this.type=1,this._$AH=xh,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=xh}_$AI(e,t=this,n,s){const i=this.strings;let r=!1;if(void 0===i)e=Th(this,e,t,0),r=!lh(e)||e!==this._$AH&&e!==Ah,r&&(this._$AH=e);else{const s=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=Th(this,s[n+o],t,o),a===Ah&&(a=this._$AH[o]),r||=!lh(a)||a!==this._$AH[o],a===xh?e=xh:e!==xh&&(e+=(a??"")+i[o+1]),this._$AH[o]=a}r&&!s&&this.j(e)}j(e){e===xh?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Ih extends Mh{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===xh?void 0:e}}class Rh extends Mh{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==xh)}}class Dh extends Mh{constructor(e,t,n,s,i){super(e,t,n,s,i),this.type=5}_$AI(e,t=this){if((e=Th(this,e,t,0)??xh)===Ah)return;const n=this._$AH,s=e===xh&&n!==xh||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==xh&&(n===xh||s);s&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class zh{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Th(this,e)}}const Lh={M:sh,P:ih,A:rh,C:1,L:Ch,R:Oh,D:uh,V:Th,I:Nh,H:Mh,N:Rh,U:Dh,B:Ih,F:zh},Ph=eh.litHtmlPolyfillSupport;Ph?.(kh,Nh),(eh.litHtmlVersions??=[]).push("3.2.1");const Uh=(e,t,n)=>{const s=n?.renderBefore??t;let i=s._$litPart$;if(void 0===i){const e=n?.renderBefore??null;s._$litPart$=i=new Nh(t.insertBefore(ch(),e),e,void 0,n??{})}return i._$AI(e),i};class Bh extends Zu{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Uh(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Ah}}Bh._$litElement$=!0,Bh.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:Bh});const qh=globalThis.litElementPolyfillSupport;qh?.({LitElement:Bh});(globalThis.litElementVersions??=[]).push("4.1.1");class Fh extends ie.Model{defaults(){return{connection_status:Cr.Status.DISCONNECTED,message:""}}initialize(){super.initialize();const{api:e}=uo;this.on("change",(()=>e.trigger("connfeedback",uo.state.connfeedback)))}}const Hh=Fh;function Gh(e){return[...new Set(e)]}function Wh(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}function Vh(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function Kh(e){return new TextDecoder("utf-8").decode(e)}function Jh(e){return(new TextEncoder).encode(e).buffer}function Yh(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}function Xh(e){const t=atob(e),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.charCodeAt(e);return s.buffer}function Qh(e){const t=new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16))));return t.buffer}class Zh{constructor(){this.hex="#000000",this.rgb_r=0,this.rgb_g=0,this.rgb_b=0,this.xyz_x=0,this.xyz_y=0,this.xyz_z=0,this.luv_l=0,this.luv_u=0,this.luv_v=0,this.lch_l=0,this.lch_c=0,this.lch_h=0,this.hsluv_h=0,this.hsluv_s=0,this.hsluv_l=0,this.hpluv_h=0,this.hpluv_p=0,this.hpluv_l=0,this.r0s=0,this.r0i=0,this.r1s=0,this.r1i=0,this.g0s=0,this.g0i=0,this.g1s=0,this.g1i=0,this.b0s=0,this.b0i=0,this.b1s=0,this.b1i=0}static fromLinear(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}static toLinear(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}static yToL(e){return e<=Zh.epsilon?e/Zh.refY*Zh.kappa:116*Math.pow(e/Zh.refY,1/3)-16}static lToY(e){return e<=8?Zh.refY*e/Zh.kappa:Zh.refY*Math.pow((e+16)/116,3)}static rgbChannelToHex(e){const t=Math.round(255*e),n=t%16,s=(t-n)/16|0;return Zh.hexChars.charAt(s)+Zh.hexChars.charAt(n)}static hexToRgbChannel(e,t){return(16*Zh.hexChars.indexOf(e.charAt(t))+Zh.hexChars.indexOf(e.charAt(t+1)))/255}static distanceFromOriginAngle(e,t,n){const s=t/(Math.sin(n)-e*Math.cos(n));return s<0?1/0:s}static distanceFromOrigin(e,t){return Math.abs(t)/Math.sqrt(Math.pow(e,2)+1)}static min6(e,t,n,s,i,r){return Math.min(e,Math.min(t,Math.min(n,Math.min(s,Math.min(i,r)))))}rgbToHex(){this.hex="#",this.hex+=Zh.rgbChannelToHex(this.rgb_r),this.hex+=Zh.rgbChannelToHex(this.rgb_g),this.hex+=Zh.rgbChannelToHex(this.rgb_b)}hexToRgb(){this.hex=this.hex.toLowerCase(),this.rgb_r=Zh.hexToRgbChannel(this.hex,1),this.rgb_g=Zh.hexToRgbChannel(this.hex,3),this.rgb_b=Zh.hexToRgbChannel(this.hex,5)}xyzToRgb(){this.rgb_r=Zh.fromLinear(Zh.m_r0*this.xyz_x+Zh.m_r1*this.xyz_y+Zh.m_r2*this.xyz_z),this.rgb_g=Zh.fromLinear(Zh.m_g0*this.xyz_x+Zh.m_g1*this.xyz_y+Zh.m_g2*this.xyz_z),this.rgb_b=Zh.fromLinear(Zh.m_b0*this.xyz_x+Zh.m_b1*this.xyz_y+Zh.m_b2*this.xyz_z)}rgbToXyz(){const e=Zh.toLinear(this.rgb_r),t=Zh.toLinear(this.rgb_g),n=Zh.toLinear(this.rgb_b);this.xyz_x=.41239079926595*e+.35758433938387*t+.18048078840183*n,this.xyz_y=.21263900587151*e+.71516867876775*t+.072192315360733*n,this.xyz_z=.019330818715591*e+.11919477979462*t+.95053215224966*n}xyzToLuv(){const e=this.xyz_x+15*this.xyz_y+3*this.xyz_z;let t=4*this.xyz_x,n=9*this.xyz_y;0!==e?(t/=e,n/=e):(t=NaN,n=NaN),this.luv_l=Zh.yToL(this.xyz_y),0===this.luv_l?(this.luv_u=0,this.luv_v=0):(this.luv_u=13*this.luv_l*(t-Zh.refU),this.luv_v=13*this.luv_l*(n-Zh.refV))}luvToXyz(){if(0===this.luv_l)return this.xyz_x=0,this.xyz_y=0,void(this.xyz_z=0);const e=this.luv_u/(13*this.luv_l)+Zh.refU,t=this.luv_v/(13*this.luv_l)+Zh.refV;this.xyz_y=Zh.lToY(this.luv_l),this.xyz_x=0-9*this.xyz_y*e/((e-4)*t-e*t),this.xyz_z=(9*this.xyz_y-15*t*this.xyz_y-t*this.xyz_x)/(3*t)}luvToLch(){if(this.lch_l=this.luv_l,this.lch_c=Math.sqrt(this.luv_u*this.luv_u+this.luv_v*this.luv_v),this.lch_c<1e-8)this.lch_h=0;else{const e=Math.atan2(this.luv_v,this.luv_u);this.lch_h=180*e/Math.PI,this.lch_h<0&&(this.lch_h=360+this.lch_h)}}lchToLuv(){const e=this.lch_h/180*Math.PI;this.luv_l=this.lch_l,this.luv_u=Math.cos(e)*this.lch_c,this.luv_v=Math.sin(e)*this.lch_c}calculateBoundingLines(e){const t=Math.pow(e+16,3)/1560896,n=t>Zh.epsilon?t:e/Zh.kappa,s=n*(284517*Zh.m_r0-94839*Zh.m_r2),i=n*(838422*Zh.m_r2+769860*Zh.m_r1+731718*Zh.m_r0),r=n*(632260*Zh.m_r2-126452*Zh.m_r1),o=n*(284517*Zh.m_g0-94839*Zh.m_g2),a=n*(838422*Zh.m_g2+769860*Zh.m_g1+731718*Zh.m_g0),c=n*(632260*Zh.m_g2-126452*Zh.m_g1),l=n*(284517*Zh.m_b0-94839*Zh.m_b2),d=n*(838422*Zh.m_b2+769860*Zh.m_b1+731718*Zh.m_b0),u=n*(632260*Zh.m_b2-126452*Zh.m_b1);this.r0s=s/r,this.r0i=i*e/r,this.r1s=s/(r+126452),this.r1i=(i-769860)*e/(r+126452),this.g0s=o/c,this.g0i=a*e/c,this.g1s=o/(c+126452),this.g1i=(a-769860)*e/(c+126452),this.b0s=l/u,this.b0i=d*e/u,this.b1s=l/(u+126452),this.b1i=(d-769860)*e/(u+126452)}calcMaxChromaHpluv(){const e=Zh.distanceFromOrigin(this.r0s,this.r0i),t=Zh.distanceFromOrigin(this.r1s,this.r1i),n=Zh.distanceFromOrigin(this.g0s,this.g0i),s=Zh.distanceFromOrigin(this.g1s,this.g1i),i=Zh.distanceFromOrigin(this.b0s,this.b0i),r=Zh.distanceFromOrigin(this.b1s,this.b1i);return Zh.min6(e,t,n,s,i,r)}calcMaxChromaHsluv(e){const t=e/360*Math.PI*2,n=Zh.distanceFromOriginAngle(this.r0s,this.r0i,t),s=Zh.distanceFromOriginAngle(this.r1s,this.r1i,t),i=Zh.distanceFromOriginAngle(this.g0s,this.g0i,t),r=Zh.distanceFromOriginAngle(this.g1s,this.g1i,t),o=Zh.distanceFromOriginAngle(this.b0s,this.b0i,t),a=Zh.distanceFromOriginAngle(this.b1s,this.b1i,t);return Zh.min6(n,s,i,r,o,a)}hsluvToLch(){if(this.hsluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hsluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hsluv_l,this.calculateBoundingLines(this.hsluv_l);const e=this.calcMaxChromaHsluv(this.hsluv_h);this.lch_c=e/100*this.hsluv_s}this.lch_h=this.hsluv_h}lchToHsluv(){if(this.lch_l>99.9999999)this.hsluv_s=0,this.hsluv_l=100;else if(this.lch_l<1e-8)this.hsluv_s=0,this.hsluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHsluv(this.lch_h);this.hsluv_s=this.lch_c/e*100,this.hsluv_l=this.lch_l}this.hsluv_h=this.lch_h}hpluvToLch(){if(this.hpluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hpluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hpluv_l,this.calculateBoundingLines(this.hpluv_l);const e=this.calcMaxChromaHpluv();this.lch_c=e/100*this.hpluv_p}this.lch_h=this.hpluv_h}lchToHpluv(){if(this.lch_l>99.9999999)this.hpluv_p=0,this.hpluv_l=100;else if(this.lch_l<1e-8)this.hpluv_p=0,this.hpluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHpluv();this.hpluv_p=this.lch_c/e*100,this.hpluv_l=this.lch_l}this.hpluv_h=this.lch_h}hsluvToRgb(){this.hsluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hpluvToRgb(){this.hpluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hsluvToHex(){this.hsluvToRgb(),this.rgbToHex()}hpluvToHex(){this.hpluvToRgb(),this.rgbToHex()}rgbToHsluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHsluv()}rgbToHpluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHpluv()}hexToHsluv(){this.hexToRgb(),this.rgbToHsluv()}hexToHpluv(){this.hexToRgb(),this.rgbToHpluv()}}Zh.hexChars="0123456789abcdef",Zh.refY=1,Zh.refU=.19783000664283,Zh.refV=.46831999493879,Zh.kappa=903.2962962,Zh.epsilon=.0088564516,Zh.m_r0=3.240969941904521,Zh.m_r1=-1.537383177570093,Zh.m_r2=-.498610760293,Zh.m_g0=-.96924363628087,Zh.m_g1=1.87596750150772,Zh.m_g2=.041555057407175,Zh.m_b0=.055630079696993,Zh.m_b1=-.20397695888897,Zh.m_b2=1.056971514242878;const ef=new Map;async function tf(e){const t=ef.get(e);if(t)return t;const n=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",(new TextEncoder).encode(e)))),s=(n[0]+256*n[1])/65536*360,i=new Zh;return i.hsluv_h=s,i.hsluv_s=100,i.hsluv_l=50,i.hsluvToHex(),ef.set(e,i.hex),i.hex}const nf=(e,t)=>`<field var="${e}">${t}</field>`,sf=e=>`<value>${Cr.xmlescape(e)}</value>`;function rf(e){const t=[],n=e?.options;for(let e=0,s=n.length;e<s;e++){const s=n[e];s.selected&&t.push(s.value||s.text)}return t}function of(e){const t=e.getAttribute("name");if(!t)return null;let n;return n="checkbox"===e.getAttribute("type")?e.checked?"1":"0":"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?rf(e):e.value,kr(nf(t,Array.isArray(n)?n.map(sf):sf(n)))}function af(e,t,n){t||(t=e.selectionEnd||void 0);let[s]=e.value.slice(0,t).split(/\s/).slice(-1);return n&&([s]=s.split(n).slice(-1)),s}function cf(e){return"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e)}function lf(e,t){const n=e.selectionEnd||void 0,s=e.value.slice(0,n).split(/\s/).pop(),i=e.value,r=cf(s[0])?s[0]:"";e.value=i.slice(0,n-s.length)+r+`${t} `+i.slice(n);const o=n-s.length+t.length+1;e.selectionEnd=r?o+1:o}function df(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),e.scrollTop=999999}function uf(e){if(!e)return"";const t=e.codePointAt(0),n=t>65535?2:1;return String.fromCodePoint(t).toLocaleUpperCase()+e.substring(n)}function hf(e,t){return t.reduce((function(t,n){return e.startsWith(n)&&n.length>t.length?n:t}),"")}function ff(e){return"string"==typeof e||e instanceof String}const mf=Ks,gf={start:/(\b|_)(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?Â«Â»âââââ]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g};function pf(e){try{return e.startsWith("www.")?!!vf(`http://${e}`):!!vf(e)}catch{return!1}}function vf(e){return e instanceof URL?e:e.toLowerCase().startsWith("www.")?vf(`http://${e}`):new URL(e)}function bf(e,t){let n;try{n=vf(t)}catch(e){throw new Error(`checkFileTypes: could not parse url ${t}`)}const s=n.pathname.split("/").pop().toLowerCase();return!!e.filter((e=>s.endsWith(e))).length}function yf(e){return bf([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}function _f(e){return bf([".gif"],e)}function wf(e,t){return!!t?.get("content-type")?.startsWith("audio")||bf([".ogg",".mp3",".m4a"],e)}function Sf(e,t){return!!t?.get("content-type")?.startsWith("video")||bf([".mp4",".webm"],e)}function Af(e,t){if(t?.get("content-type")?.startsWith("video"))return!0;const n=mf.get("image_urls_regex");return n?.test(e)||yf(e)}function xf(e){return vf(e).href.startsWith("aesgcm://")}function $f(e,t,n){const s=(n=n||{}).start||gf.start,i=n.end||gf.end,r=n.trim||gf.trim,o=n.parens||gf.parens,a=/[a-z0-9-]=["']?$/i;for(s.lastIndex=0;;){const c=s.exec(e);if(!c)break;let l=c.index;if(n.ignoreHtml){const t=e.slice(Math.max(l-3,0),l);if(t&&a.test(t))continue}let d=l+e.slice(l).search(i),u=e.slice(l,d),h=-1;for(;;){const e=o.exec(u);if(!e)break;const t=e.index+e[0].length;h=Math.max(h,t)}if(u=h>-1?u.slice(0,h)+u.slice(h).replace(r,""):u.replace(r,""),u.length<=c[0].length)continue;if(n.ignore&&n.ignore.test(u))continue;d=l+u.length;const f=t(u,l,d);void 0!==f?(e=e.slice(0,l)+String(f)+e.slice(d),s.lastIndex=l+String(f).length):s.lastIndex=d}return s.lastIndex=0,e}async function Ef(e){try{return(await fetch(e,{method:"HEAD"})).headers}catch(t){return console.debug(`Error calling HEAD on url ${e}: ${t}`),null}}async function jf(e){const t=Ks.get("fetch_url_headers")?await Ef(e.url):null;return{...e,is_gif:_f(e.url),is_audio:wf(e.url,t),is_image:Af(e.url,t),is_video:Sf(e.url,t),is_encrypted:xf(e.url)}}async function Cf(e,t=0){const n=[];if(!e)return{};try{$f(e,((e,s,i)=>(e.startsWith("_")&&(e=e.slice(1),s+=1),e.endsWith("_")&&(e=e.slice(0,e.length-1),i-=1),pf(e)&&n.push({url:e,start:s+t,end:i+t}),e)))}catch(e){Y.debug(e)}const s=await Promise.all(n.map(jf));return s.length?{media_urls:s}:{}}function kf(e,t){return e.map((e=>{if(e.start<0||e.start>=t.length)return null;const n=t.substring(e.start,e.end);return{...e,url:n}})).filter((e=>e))}function Tf(e,t,n=0){return e.map((e=>{const s=e.start-n,i=e.end-n;return s<0||s>=t.length?null:Object.assign({},e,{start:s,end:i,url:t.substring(e.start-n,e.end-n)})})).filter((e=>e))}function Of(e){if(location.hash.startsWith("#converse?loglevel=")){e?.preventDefault();const t=location.hash.split("=").pop();Object.keys(V).includes(t)?Y.setLogLevel(t):Y.error(`Could not set loglevel of ${t}`)}}function Nf(e){return e instanceof ie.Model&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message||e.body)}function Mf(e){return Math.random()*e|0}function If(e){const t=crypto.randomUUID?.()??"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=Mf(16);return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t}const Rf=Object.assign({...g,...p,...v,...b,...f,...d,...l,...s,...u,...i,...m,...c,...y,..._,getRandomInt:Mf,getUniqueId:If,isEmptyMessage:Nf,onMultipleEvents:function(e=[],t){let n=[];function s(s){n.push(s),e.length===n.length&&(t(n),n=[])}e.forEach((e=>e.object.on(e.event,s)))},prefixMentions:function(e){let t=e.getMessageText();return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},shouldCreateMessage:function(e){return e.retracted||!Nf(e)},triggerEvent:function(e,t,n="Event",s=!0,i=!0){const r=document.createEvent(n);r.initEvent(t,s,i),e.dispatchEvent(r)}},{muc:null,mam:null});uo.api=ad;const Df={$build:Ki,$iq:Yi,$msg:Ji,$pres:Xi,Collection:ie.Collection,Model:ie.Model,Stanza:Er,Strophe:Cr,TimeoutError:pl,VERSION_NAME:Or,css:(e,...t)=>{const n=1===e.length?e[0]:t.reduce(((t,n,s)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+e[s+1]),e[0]);return new Du(n,e,Iu)},dayjs:H(),errors:h,filesize:Ou,html:wh,log:Y,nothing:xh,render:Uh,sizzle:Q(),sprintf:Z.sprintf,stx:jr,u:Rf,utils:Rf},zf=Object.assign(window.converse||{},{CHAT_STATES:no,keycodes:io,async initialize(e){const{api:t}=uo;if(await Zc(uo),function(e){Ws=e,Gs=new Vs;const t=zs(e,Object.keys(Ls));Object.assign(Gs,Ls,t)}(e),uo.strict_plugin_dependencies=e.strict_plugin_dependencies,Y.setLogLevel(t.settings.get("loglevel")),t.settings.get("authentication")===Dr&&t.settings.get("auto_login")&&!t.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");Of(),addEventListener("hashchange",Of);const n=new Hh;Object.assign(uo,{connfeedback:n}),Object.assign(uo.state,{connfeedback:n}),uo.env=Df,await Vc(uo),await Wc(uo),await ee.initialize(),Gc(uo),t.elements?.register(),Qc(uo);const s=uo.pluggable.plugins;if((t.settings.get("auto_login")||t.settings.get("keepalive")&&s["converse-bosh"]?.enabled())&&await t.user.login(null,null,!0),t.trigger("initialized"),Xs())return uo},plugins:{add(e,t){if(t.__name__=e,void 0!==uo.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);uo.pluggable.plugins[e]=t}},env:Df}),Lf=zf,{u:Pf,stx:Uf,Stanza:Bf}=Lf.env;function qf(e,t){ad.send(Uf`<message to="${e.getAttribute("from")}"
                    type="error"
                    id="${e.getAttribute("id")}"
                    xmlns="jabber:client">
                <error type="cancel">
                    <not-allowed xmlns="${Cr.NS.STANZAS}"/>
                    <text xmlns="${Cr.NS.STANZAS}">${t}</text>
                </error>
            </message>`),Y.warn(`Rejecting message stanza with the following reason: ${t}`),Y.warn(e)}function Ff(e,t,n,s){if(!so.includes(n))return void Y.error(`Invalid marker type: ${n}`);const i=Uf`
        <message from="${ad.connection.get().jid}"
                id="${Pf.getUniqueId()}"
                to="${e}"
                type="${s||"chat"}"
                xmlns="jabber:client">
            <${Bf.unsafeXML(n)} xmlns="${Cr.NS.MARKERS}" id="${t}"/>
        </message>`;ad.send(i)}function Hf(e,t){if(ad.settings.get("send_chat_state_notifications")&&t){const n=ad.settings.get("send_chat_state_notifications");if(Array.isArray(n)&&!n.includes(t))return;if(!no.includes(t))return void Y.error(`Invalid chat state: ${t}`);ad.send(Uf`<message id="${Pf.getUniqueId()}" to="${e}" type="chat" xmlns="jabber:client">
                <${Bf.unsafeXML(t)} xmlns="${Cr.NS.CHATSTATES}"/>
                <no-store xmlns="${Cr.NS.HINTS}"/>
                <no-permanent-store xmlns="${Cr.NS.HINTS}"/>
            </message>`)}}const{NS:Gf}=Cr;async function Wf(e){if(null===e)return null;if(e instanceof Error)return e;if("error"!==e.getAttribute("type"))return null;const t=e.querySelector("error");if(!t)return null;const n=Q()(`[xmlns="${Cr.NS.STANZAS}"]`,t),s=n.filter((e=>e.nodeName&&"text"!==e.nodeName)).pop()?.nodeName,i=await ad.hook("parseErrorStanza",e,{});return"bad-request"===s?new yl(s,t,i):"conflict"===s?new _l(s,t,i):"feature-not-implemented"===s?new wl(s,t,i):"forbidden"===s?new Sl(s,t,i):"gone"===s?new Al(s,t,i):"internal-server-error"===s?new xl(s,t,i):"item-not-found"===s?new $l(s,t,i):"jid-malformed"===s?new El(s,t,i):"not-acceptable"===s?new jl(s,t,i):"not-allowed"===s?new Cl(s,t,i):"not-authorized"===s?new kl(s,t,i):"payment-required"===s?new Tl(s,t,i):"recipient-unavailable"===s?new Ol(s,t,i):"redirect"===s?new Nl(s,t,i):"registration-required"===s?new Ml(s,t,i):"remote-server-not-found"===s?new Il(s,t,i):"remote-server-timeout"===s?new Rl(s,t,i):"resource-constraint"===s?new Dl(s,t,i):"service-unavailable"===s?new zl(s,t,i):"subscription-required"===s?new Ll(s,t,i):"undefined-condition"===s?new Pl(s,t,i):"unexpected-request"===s?new Ul(s,t,i):new vl("unknown",t)}function Vf(e,t){const n=Q()(`stanza-id[xmlns="${Cr.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{}),s=Q()(`origin-id[xmlns="${Cr.NS.SID}"]`,e).pop()?.getAttribute("id"),i={origin_id:s,msgid:e.getAttribute("id")||t.getAttribute("id"),...n},r=Q()(`message > result[xmlns="${Cr.NS.MAM}"]`,t).pop();if(r){const e=uo.session.get("bare_jid");i[`stanza_id ${t.getAttribute("from")||e}`]=r.getAttribute("id")}return i}function Kf(e){const t=Q()(`encryption[xmlns="${Cr.NS.EME}"]`,e).pop(),n=t?.getAttribute("namespace"),s={};return n?(s.is_encrypted=!0,s.encryption_namespace=n):Q()(`encrypted[xmlns="${Cr.NS.OMEMO}"]`,e).pop()&&(s.is_encrypted=!0,s.encryption_namespace=Cr.NS.OMEMO),s}function Jf(e,t){const n=Q()(`> retract[xmlns="${Cr.NS.RETRACT}"]`,e).pop();if(n){const e=Q()(`> delay[xmlns="${Cr.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:e?H()(e.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:n.getAttribute("id")}}{const t=Q()(`> retracted[xmlns="${Cr.NS.RETRACT}"]`,e).pop()||Q()(`> retracted[xmlns="${Cr.NS.RETRACT0}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp"),retraction_id:t.getAttribute("id")}}return function(e,t){const n=Q()(`> apply-to[xmlns="${Cr.NS.FASTEN}"]`,e).pop();if(n){const e=n.getAttribute("id");if(Q()(`> retract[xmlns="${Cr.NS.RETRACT0}"]`,n).pop()){const n=Q()(`delay[xmlns="${Cr.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:n?H()(n.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}return{}}(e,t)}function Yf(e,t){const n=Q()(`replace[xmlns="${Cr.NS.MESSAGE_CORRECT}"]`,e).pop();if(n){const e=n.getAttribute("id");if(e){const n=Q()(`delay[xmlns="${Cr.NS.DELAY}"]`,t).pop();return{replace_id:e,edited:n?H()(n.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function Xf(e){const t=Q()(`spoiler[xmlns="${Cr.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:t?.textContent}}function Qf(e){const t=Q()(`x[xmlns="${Cr.NS.OUTOFBAND}"]`,e).pop();return t?{oob_url:t.querySelector("url")?.textContent,oob_desc:t.querySelector("desc")?.textContent}:{}}function Zf(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),n=Q()(`text[xmlns="${Cr.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:n?.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName,errors:Array.from(t.children).map((e=>({name:e.nodeName,xmlns:e.getAttribute("xmlns")})))}}return{}}function em(e){return Q()(`reference[xmlns="${Cr.NS.REFERENCE}"]`,e).map((t=>{const n=t.getAttribute("anchor"),s=e.querySelector(n?`#${n}`:"body")?.textContent;if(!s)return Y.warn(`Could not find referenced text for ${t}`),null;const i=Number(t.getAttribute("begin")),r=Number(t.getAttribute("end"));return{begin:i,end:r,type:t.getAttribute("type"),value:s.slice(i,r),uri:t.getAttribute("uri")}})).filter((e=>e))}function tm(e){const t=Q()(`received[xmlns="${Cr.NS.RECEIPTS}"]`,e).pop();return t?.getAttribute("id")}function nm(e){const t=Cr.NS.CARBONS;return Q()(`message > received[xmlns="${t}"]`,e).length>0||Q()(`message > sent[xmlns="${t}"]`,e).length>0}function sm(e){return Q()(`\n        composing[xmlns="${Gf.CHATSTATES}"],\n        paused[xmlns="${Gf.CHATSTATES}"],\n        inactive[xmlns="${Gf.CHATSTATES}"],\n        active[xmlns="${Gf.CHATSTATES}"],\n        gone[xmlns="${Gf.CHATSTATES}"]`,e).pop()?.nodeName}function im(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&Q()(`request[xmlns="${Cr.NS.RECEIPTS}"]`,e).length}function rm(e){if(Q()(`message > forwarded[xmlns="${Cr.NS.FORWARD}"]`,e).length){qf(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new bl(e,`Ignoring unencapsulated forwarded message from ${t}`)}}function om(e){return Q()(`\n        acknowledged[xmlns="${Cr.NS.MARKERS}"],\n        displayed[xmlns="${Cr.NS.MARKERS}"],\n        received[xmlns="${Cr.NS.MARKERS}"]`,e).pop()}function am(e){return"headline"===e.getAttribute("type")}function cm(e){if(Q()(`mentions[xmlns="${Cr.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function lm(e){return!!Q()(`message > result[xmlns="${Cr.NS.MAM}"]`,e).pop()}function dm(e,t,n){const s=e.getAttribute("var"),i=e.getAttribute("label")||"",r=e.getAttribute("type"),o=e.querySelector("desc")?.textContent,a={readonly:t,desc:o};if("list-single"===r||"list-multi"===r){const t=Array.from(e.querySelectorAll(":scope > value")).map((e=>e?.textContent));return{type:r,options:Array.from(e.querySelectorAll(":scope > option")).map((n=>{const s=n.querySelector("value")?.textContent;return{value:s,label:n.getAttribute("label"),selected:t.includes(s),required:!!e.querySelector("required"),...a}})),label:e.getAttribute("label"),var:s,required:!!e.querySelector("required"),...a}}if("fixed"===r){const t=e.querySelector("value")?.textContent;return{text:t,label:i,type:r,var:s,...a}}if("jid-multi"===r)return{type:r,var:s,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),...a};if("boolean"===r){const t=e.querySelector("value")?.textContent;return{type:r,var:s,label:i,checked:"1"===t||"true"===t,...a}}if("url"===s)return{var:s,label:i,value:e.querySelector("value")?.textContent,...a};if("username"===s)return{var:s,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),type:um(e),...a};if("password"===s)return{var:s,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),...a};if("ocr"===s){const t=e.querySelector("uri"),i=Q()('data[cid="'+t.textContent.replace(/^cid:/,"")+'"]',n)[0];return{label:e.getAttribute("label"),var:s,uri:{type:t.getAttribute("type"),data:i?.textContent},required:!!e.querySelector("required"),...a}}return{label:i,var:s,required:!!e.querySelector("required"),value:e.querySelector("value")?.textContent,type:um(e),...a}}function um(e){const t=ro[e.getAttribute("type")];if("text"==t){const n=e.getElementsByTagNameNS("http://jabber.org/protocol/xdata-validate","validate");if(1===n.length){const e=n[0].getAttribute("datatype");return oo[e]||t}}return t}function hm(e){const t=Q()(`x[xmlns="${Cr.NS.XFORM}"]`,e);if(t.length>1)throw Y.error(e),new Error("Invalid stanza");if(0===t.length)return null;const n=t[0],s=n.getAttribute("type"),i={type:s,title:n.querySelector("title")?.textContent};if("result"===s){const t=n.querySelector(":scope > reported");if(t){const e=t?Array.from(t.querySelectorAll(":scope > field")):[],s=Array.from(n.querySelectorAll(":scope > item"));return{...i,reported:e.map(Au),items:s.map((e=>Array.from(e.querySelectorAll("field")).map((e=>({...Au(e),value:e.querySelector("value")?.textContent??""})))))}}return{...i,fields:Array.from(n.querySelectorAll("field")).map((t=>dm(t,!0,e)))}}if("form"===s)return{...i,instructions:n.querySelector("instructions")?.textContent,fields:Array.from(n.querySelectorAll("field")).map((t=>dm(t,!1,e)))};throw new Error(`Invalid type in XForm response stanza: ${s}`)}const{safeSave:fm,colorize:mm}=Rf;function gm(e){return class extends e{async setColor(){const e=await mm(this.getIdentifier());fm(this,{color:e})}getIdentifier(){return this.get("type")===Xr?this.get("jid"):"groupchat"===this.get("type")?this.get("from_real_jid")||this.get("from"):this.get("occupant_id")||this.get("jid")||this.get("from")||this.get("nick")}async getColor(){return this.get("color")||await this.setColor(),this.get("color")}async getAvatarStyle(e=""){try{return`background-color: ${await this.getColor()} !important; ${e}`}catch{return`background-color: gray !important; ${e}`}}}}function pm(e){return class extends e{initialize(){super.initialize(),this.rosterContactAdded=re(),this.contact=null}async setModelContact(e){if(this.contact?.get("jid")===e)return;const{session:t,state:n}=uo;let s;Cr.getBareJidFromJid(e)===t.get("bare_jid")?s=n.profile:(s=await ad.contacts.get(e),s||(await ad.blocklist.get()).get(e)||(s=await ad.contacts.add({jid:e},!1,!1))),s&&(this.contact=s,this.set("nickname",s.get("nickname")),this.listenTo(this.contact,"vcard:add",(e=>{this.trigger("contact:change",e)})),this.listenTo(this.contact,"vcard:change",(e=>{this.trigger("contact:change",e)})),this.listenTo(this.contact,"change",(e=>{e.nickname&&this.set("nickname",e.nickname),this.trigger("contact:change",e)})),this.listenTo(this.contact,"destroy",(()=>{delete this.contact})),this.rosterContactAdded.resolve(),this.trigger("contactAdded",this.contact))}}}const{u:vm}=Lf.env;const{Strophe:bm,$iq:ym,sizzle:_m,stx:wm}=Lf.env;function Sm(e,t,n){const s=ym(t?{type:e,to:t}:{type:e});return n?s.cnode(n):s.c("vCard",{xmlns:bm.NS.VCARD}),s}async function Am(e,t=!1){let n;if(await ad.waitUntil("VCardsInitialized"),e instanceof uo.exports.MUCOccupant)n=await async function(e,t=!0){await ad.waitUntil("VCardsInitialized");const{vcards:n,profile:s}=uo.state,i=e?.collection?.chatroom,r=e.get("nick");if(r&&i?.get("nick")===r)return s.vcard;{const s=e.get("jid")||e.get("from");return s?n.get(s)||n.create({jid:s},{lazy_load:t}):(Y.debug("Could not get VCard for occupant because no JID found!"),null)}}(e,t);else if(e instanceof uo.exports.MUCMessage)n=await async function(e,t=!0){if(["error","info"].includes(e.get("type")))return;await ad.waitUntil("VCardsInitialized");const{vcards:n,profile:s}=uo.state,i=e?.collection?.chatbox,r=bm.getResourceFromJid(e.get("from"));if(r&&i?.get("nick")===r)return s.vcard;{const s=e.occupant?.get("jid")||e.get("from");return s?n.get(s)||n.create({jid:s},{lazy_load:t}):(Y.warn(`Could not get VCard for message because no JID found! msgid: ${e.get("msgid")}`),null)}}(e,t);else{let s;if(e instanceof uo.exports.Message){if(["error","info"].includes(e.get("type")))return;s=bm.getBareJidFromJid(e.get("from"))}else s=e.get("jid");if(!s)return Y.warn("Could not set VCard on model because no JID found!"),null;const{vcards:i}=uo.state;n=i.get(s)||i.create({jid:s},{lazy_load:t})}return n&&n.on("change",(()=>e.trigger("vcard:change"))),n}async function xm(e){const t=uo.session.get("bare_jid"),n=bm.getBareJidFromJid(e)===t?null:e;let s;try{s=await ad.sendIQ(Sm("get",n))}catch(t){const{message:n}=(fu(t)?await Wf(t):t)??{};return{jid:e,stanza:fu(t)?t:null,error:n,vcard_error:(new Date).toISOString()}}return async function(e){const t={email:e.querySelector(":scope > vCard EMAIL USERID")?.textContent,fullname:e.querySelector(":scope > vCard FN")?.textContent,image:e.querySelector(":scope > vCard PHOTO BINVAL")?.textContent,image_type:e.querySelector(":scope > vCard PHOTO TYPE")?.textContent,nickname:e.querySelector(":scope > vCard NICKNAME")?.textContent,role:e.querySelector(":scope > vCard ROLE")?.textContent,stanza:e,url:e.querySelector(":scope > vCard URL")?.textContent,vcard_updated:(new Date).toISOString(),error:void 0,vcard_error:void 0,image_hash:void 0};if(t.image){const e=vm.base64ToArrayBuffer(t.image),n=await crypto.subtle.digest("SHA-1",e);t.image_hash=vm.arrayBufferToHex(n)}return t}(s)}let $m;function Em(){const e=ad.connection.get();$m=e.addHandler((e=>{try{!async function(e){await ad.waitUntil("VCardsInitialized");const t=_m(`x[xmlns="${bm.NS.VCARD_UPDATE}"] photo`,e).pop();if(t){const n=t.textContent,s=bm.getBareJidFromJid(e.getAttribute("from")),i=await uo.state.vcards.get(s);i?.get("image_hash")!==n&&ad.vcard.update(s,!0).catch((e=>Y.error(e)))}}(e)}catch(e){Y.error(e)}return!0}),null,"presence",null)}function jm(e){return class extends e{constructor(...e){super(...e),this._vcard=null,this.lazy_load_vcard=!1}initialize(){super.initialize(),this.getVCard()}get vcard(){return this._vcard}async getVCard(){const{pluggable:e}=uo;return e.plugins["converse-vcard"]?.enabled(uo)?(this._vcard||(this._vcard=await Am(this,this.lazy_load_vcard),this.trigger("vcard:add",{vcard:this._vcard})),this._vcard):null}}}bm.addNamespace("VCARD_UPDATE","vcard-temp:x:update");class Cm extends(jm(pm(gm(ie.Model)))){defaults(){return{msgid:If(),time:(new Date).toISOString(),is_ephemeral:!1}}constructor(e,t){super(e,t),this.file=null,this.attributes}initialize(){this.lazy_load_vcard=!0,super.initialize(),this.chatbox=this.collection?.chatbox,this.checkValidity()&&(this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),this.setTimerForEphemeralMessage())}checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)}safeDestroy(){try{this.destroy()}catch(e){Y.warn(`safeDestroy: ${e}`)}}setTimerForEphemeralMessage(){this.ephemeral_timer&&clearTimeout(this.ephemeral_timer);const e=this.isEphemeral();if(e){const t="number"==typeof e?e:1e4;this.ephemeral_timer=setTimeout((()=>this.safeDestroy()),t)}}isEphemeral(){return this.get("is_ephemeral")}isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")}isRetracted(){return this.get("retracted")||"retracted"===this.get("moderated")}isFollowup(){const e=this.collection?.models;if(!e)return!1;const t=e.indexOf(this),n=t?e[t-1]:null;if(null===n)return!1;const s=H()(this.get("time"));return this.get("from")===n.get("from")&&!this.isRetracted()&&!n.isRetracted()&&!this.isMeCommand()&&!n.isMeCommand()&&!!this.get("is_encrypted")==!!n.get("is_encrypted")&&this.get("type")===n.get("type")&&"info"!==this.get("type")&&s.isBefore(H()(n.get("time")).add(10,"minutes"))&&("groupchat"!==this.get("type")||this.get("occupant_id")===n.get("occupant_id"))}mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(ad.settings.get("allow_message_retraction"))}getMessageText(){if(this.get("is_encrypted")){const{__:e}=uo;return this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message")}return["groupchat","chat","normal"].includes(this.get("type"))?this.get("body"):this.get("message")}sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=Yi({from:uo.session.get("jid"),to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:Cr.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return ad.sendIQ(e)}getUploadRequestMetadata(e){return{headers:Q()(`slot[xmlns="${Cr.NS.HTTPUPLOAD}"] put header`,e).map((e=>({name:e.getAttribute("name"),value:e.textContent}))).filter((e=>["Authorization","Expires"].includes(e.name)))}}async getRequestSlotURL(){const{__:e}=uo;let t;try{t=await this.sendSlotRequestStanza()}catch(t){return Y.error(t),this.save({is_ephemeral:!0,message:e("Sorry, could not determine upload URL."),type:"error"})}const n=Q()(`slot[xmlns="${Cr.NS.HTTPUPLOAD}"]`,t).pop();if(!n)return this.save({is_ephemeral:!0,message:e("Sorry, could not determine file upload URL."),type:"error"});this.upload_metadata=this.getUploadRequestMetadata(t),this.save({get:n.querySelector("get").getAttribute("url"),put:n.querySelector("put").getAttribute("url")})}uploadFile(){const e=new XMLHttpRequest;e.onreadystatechange=async t=>{if(e.readyState===XMLHttpRequest.DONE)if(Y.info("Status: "+e.status),200===e.status||201===e.status){let e={body:this.get("get"),message:this.get("get"),oob_url:this.get("get"),upload:Fr};e=await ad.hook("afterFileUploaded",this,e),this.save(e)}else Y.error(t),e.onerror(new ProgressEvent(`Response status: ${e.status}`))},e.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),e.onerror=()=>{const{__:t}=uo;let n;n=e.responseText?t('Sorry, could not succesfully upload your file. Your serverâs response: "%1$s"',e.responseText):t("Sorry, could not succesfully upload your file."),this.save({is_ephemeral:!0,message:n,type:"error",upload:Hr})},e.open("PUT",this.get("put"),!0),e.setRequestHeader("Content-type",this.file.type),this.upload_metadata.headers?.forEach((t=>e.setRequestHeader(t.name,t.value))),e.send(this.file)}}const km=Cm,{Strophe:Tm,sizzle:Om}=Lf.env;async function Nm(e){rm(e);let t=e.getAttribute("to");const n=Tm.getResourceFromJid(t),s=uo.session.get("resource");if(ad.settings.get("filter_by_resource")&&n&&n!==s)return new bl(e,`Ignoring incoming message intended for a different resource: ${t}`);const i=uo.session.get("bare_jid"),r=e;let o=e.getAttribute("from")||i;if(nm(e)){if(o!==i)return qf(e,"Rejecting carbon from invalid JID"),new bl(e,`Rejecting carbon from invalid JID ${t}`);{const n=`[xmlns="${Tm.NS.CARBONS}"] > forwarded[xmlns="${Tm.NS.FORWARD}"] > message`;t=(e=Om(n,e).pop()).getAttribute("to"),o=e.getAttribute("from")}}const a=lm(e);if(a){if(o!==i)return new bl(e,`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`);{const n=`[xmlns="${Tm.NS.MAM}"] > forwarded[xmlns="${Tm.NS.FORWARD}"] > message`;t=(e=Om(n,e).pop()).getAttribute("to"),o=e.getAttribute("from")}}const c=Tm.getBareJidFromJid(o),l=c===i;if(l&&null===t)return new bl(e,`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`);const d=am(e),u=cm(e);let h,f;if(!d&&!u&&(f=l?Tm.getBareJidFromJid(t):c,h=await ad.contacts.get(f),void 0===h&&!ad.settings.get("allow_non_roster_messaging")))return Y.error(e),new bl(e,"Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.");const m=Om(`delay[xmlns="${Tm.NS.DELAY}"]`,r).pop(),g=om(e),p=(new Date).toISOString();let v=Object.assign({contact_jid:f,is_archived:a,is_headline:d,is_server_message:u,body:e.querySelector("body")?.textContent?.trim(),chat_state:sm(e),from:e.getAttribute("from"),is_carbon:nm(r),is_delayed:!!m,is_markable:!!Om(`markable[xmlns="${Tm.NS.MARKERS}"]`,e).length,is_marker:!!g,is_unstyled:!!Om(`unstyled[xmlns="${Tm.NS.STYLING}"]`,e).length,marker_id:g&&g.getAttribute("id"),nick:h?.attributes?.nickname,receipt_id:tm(e),received:(new Date).toISOString(),references:em(e),sender:l?"me":"them",subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:m?H()(m.getAttribute("stamp")).toISOString():p,to:e.getAttribute("to"),type:e.getAttribute("type")||"normal"},Zf(e),Qf(e),Xf(e),Yf(e,r),Vf(e,r),Jf(e,r),Kf(e));if(v.is_archived){const t=r.getAttribute("from");if(t&&t!==i)return new bl(e,`Invalid Stanza: Forged MAM message from ${t}`)}v=Object.assign({message:v.body||v.error,is_valid_receipt_request:im(e,v)},v),v.id=v.origin_id||v[`stanza_id ${v.from}`]||Rf.getUniqueId(),v=await ad.hook("parseMessage",e,v);const b=await Rf.getMediaURLsMetadata(v.is_encrypted?v.plaintext:v.body);return Object.assign(v,b)}const{Strophe:Mm,u:Im}=Lf.env;function Rm(e){if(!location.hash.startsWith("#converse/chat?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!Im.isValidJID(t))return Y.warn(`Invalid JID "${t}" provided in URL fragment`);ad.chats.open(t)}function Dm(){ad.settings.get("auto_join_private_chats").forEach((e=>{uo.state.chatboxes.where({jid:e}).length||("string"==typeof e?ad.chats.open(e):Y.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),ad.trigger("privateChatsAutoJoined")}function zm(){ad.connection.get().addHandler((e=>!!(["groupchat","error"].includes(e.getAttribute("type"))||am(e)||cm(e)||lm(e))||(uo.exports.handleMessageStanza(e)||!0)),null,"message"),ad.connection.get().addHandler((e=>(async function(e){const t=Mm.getBareJidFromJid(e.getAttribute("from")),n=uo.session.get("bare_jid");if(Im.isSameBareJID(t,n))return;const s=await ad.chatboxes.get(t);s?.get("type")===Yr&&s?.handleErrorMessageStanza(e)}(e),!0)),null,"message","error")}async function Lm(e){if(cm(e=e instanceof Element?e:e.tree())){const t=e.getAttribute("from");return Y.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}if(await async function(e){const t=Cr.getBareJidFromJid(e.getAttribute("from"));return!!await ad.rooms.get(t)}(e))return!0;let t;try{t=await Nm(e)}catch(e){return Y.error(e)}if(Im.isErrorObject(t)){const{stanza:e,message:n}=t;return e&&Y.error(e),Y.error(n)}const{body:n,plaintext:s,contact_jid:i,nick:r}=t,o=!(!n&&!s),a=await ad.chats.get(i,{nickname:r},o);await(a?.queueMessage(t));const c={stanza:e,attrs:t,chatbox:a};ad.trigger("message",c)}async function Pm(){const e=uo.session.get("bare_jid"),t=Mm.getDomainFromJid(e);if(!await ad.disco.supports(Mm.NS.CARBONS,t))return void Y.warn("Not enabling carbons because it's not supported!");const n=new Mm.Builder("iq",{from:ad.connection.get().jid,type:"set"}).c("enable",{xmlns:Mm.NS.CARBONS}),s=await ad.sendIQ(n,null,!1);null===s?Y.warn("A timeout occurred while trying to enable carbons"):Im.isErrorStanza(s)?(Y.warn("An error occurred while trying to enable message carbons."),Y.error(s)):Y.debug("Message carbons have been enabled.")}const{Strophe:Um,stx:Bm,u:qm}=Lf.env;function Fm(e){return class extends e{constructor(...e){super(e[0],e[1]),this.disable_mam=!1}async initialize(){super.initialize(),this.initUI(),this.initMessages(),this.initNotifications(),this.ui.on("change:scrolled",(()=>this.onScrolledChanged()))}initNotifications(){this.notifications=new ie.Model}initUI(){this.ui=new ie.Model}getDisplayName(){return this.get("jid")}canPostMessages(){return!0}async createMessage(e,t){return e.time=e.time||(new Date).toISOString(),await this.messages.fetched,this.messages.create(e,t)}getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${uo.session.get("bare_jid")}`}getMessagesCollection(){return new uo.exports.Messages}getNotificationsText(){const{__:e}=uo;return this.notifications?.get("chat_state")===Vr?e("%1$s is typing",this.getDisplayName()):this.notifications?.get("chat_state")===Kr?e("%1$s has stopped typing",this.getDisplayName()):this.notifications?.get("chat_state")===Jr?e("%1$s has gone away",this.getDisplayName()):""}initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=re(),this.messages.chatbox=this,zc(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"add",(e=>this.onMessageAdded(e))),this.listenTo(this.messages,"change:upload",(e=>this.onMessageUploadChanged(e))),this.listenTo(this.messages,"change:correcting",(e=>this.onMessageCorrecting(e)))}fetchMessages(){if(this.messages.fetched_flag)return void Y.info(`Not re-fetching messages for ${this.get("jid")}`);this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:()=>{this.afterMessagesFetched(),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched}afterMessagesFetched(){this.pruneHistoryWhenScrolledDown(),ad.trigger("afterMessagesFetched",this)}async onMessage(e){throw new gl("onMessage is not implemented")}getUpdatedMessageAttributes(e,t){return t.error_type||"Decryption"!==e.get("error_type")?{is_archived:t.is_archived,time:t.time?t.time:e.get("time")}:Object.assign({},t,{error_condition:void 0,error_message:void 0,error_text:void 0,error_type:void 0,is_archived:t.is_archived,is_ephemeral:!1,is_error:!1})}updateMessage(e,t){const n=this.getUpdatedMessageAttributes(e,t);n&&e.save(n)}async handleCorrection(e){if(!e.replace_id||!e.from)return;let t;if("groupchat"===e.type){const{occupant_id:n,replace_id:s}=e;t=n?({attributes:e})=>e.msgid===s&&e.occupant_id==n:({attributes:t})=>t.msgid===e.replace_id&&t.from===e.from&&null==t.occupant_id}else t=({attributes:t})=>t.msgid===e.replace_id&&t.from===e.from&&null==t.occupant_id;const n=this.messages.models.find(t);if(!n)return e.older_versions={},await this.createMessage(e);const s=n.get("older_versions")||{};return e.time<n.get("time")&&n.get("edited")?(s[e.time]=e.message,n.save({older_versions:s})):(Object.keys(s).length?s[n.get("edited")]=n.getMessageText():s[n.get("time")]=n.getMessageText(),delete(e=Object.assign(e,{older_versions:s})).msgid,delete e.id,e.time=n.get("time"),n.save(e)),n}queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>Y.error(e))),this.msg_chain}async getOutgoingMessageAttributes(e){throw new gl("getOutgoingMessageAttributes is not implemented")}async sendMessage(e){if(await(Lf.emojis?.initialized_promise),!this.canPostMessages())return void Y.warn("sendMessage was called but canPostMessages is false");e=await this.getOutgoingMessageAttributes(e);let t=this.messages.findWhere("correcting");if(t){const n=t.get("older_versions")||{};n[t.get("edited")||t.get("time")]=t.getMessageText(),t.save({...["body","is_only_emojis","media_urls","references","is_encrypted"].reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{}),correcting:!1,edited:(new Date).toISOString(),message:e.body,ogp_metadata:[],older_versions:n,origin_id:qm.getUniqueId(),plaintext:e.is_encrypted?e.message:void 0,received:void 0})}else this.setEditable(e,(new Date).toISOString()),t=await this.createMessage(e);try{const e=await this.createMessageStanza(t);ad.send(e)}catch(e){return t.destroy(),void Y.error(e)}return ad.trigger("sendMessage",{chatbox:this,message:t}),t}retractOwnMessage(e){const t=qm.getUniqueId();!function(e,t,n){const s=t.get("origin_id");if(!s)throw new Error("Can't retract message without a XEP-0359 Origin ID");const i=Uf`
        <message id="${n}"
                 to="${e}"
                 type="chat"
                 xmlns="jabber:client">
            <retract id="${s}" xmlns="${Cr.NS.RETRACT}"/>
            <body>/me retracted a message</body>
            <store xmlns="${Cr.NS.HINTS}"/>
            <fallback xmlns="${Cr.NS.FALLBACK}" for="${Cr.NS.RETRACT}" />
        </message>`;ad.connection.get().send(i)}(this.get("jid"),e,t),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:t,is_ephemeral:!0,editable:!1})}async sendFiles(e){const{__:t,session:n}=uo,s=(await ad.disco.features.get(Um.NS.HTTPUPLOAD,n.get("domain"))).pop();if(!s)return void this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const i=s.dataforms.where({FORM_TYPE:{value:Um.NS.HTTPUPLOAD,type:"hidden"}}).pop(),r=parseInt((i?.attributes||{})["max-file-size"]?.value,10),o=s?.id;o?Array.from(e).forEach((async e=>{if(e=await ad.hook("beforeFileUpload",this,e),!isNaN(r)&&e.size>r){const n=Ou(r),s=Array.isArray(n)?t("The size of your file, %1$s, exceeds the maximum allowed by your server.",e.name):t("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,n);return this.createMessage({message:s,type:"error",is_ephemeral:!0})}{const t=await this.getOutgoingMessageAttributes(),n=Object.assign(t,{file:!0,progress:0,slot_request_url:o});this.setEditable(n,(new Date).toISOString());const s=await this.createMessage(n,{silent:!0});s.file=e,this.messages.trigger("add",s),s.getRequestSlotURL()}})):this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})}setEditable(e,t){e.is_headline||qm.isEmptyMessage(e)||"me"!==e.sender||("all"===ad.settings.get("allow_message_corrections")?e.editable=!(e.file||e.retracted||"oob_url"in e):"last"===ad.settings.get("allow_message_corrections")&&t>this.get("time_sent")&&(this.set({time_sent:t}),this.messages.findWhere({editable:!0})?.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)))}setChatState(e,t){return void 0!==this.chat_state_timeout&&(clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===Vr?this.chat_state_timeout=setTimeout(this.setChatState.bind(this),uo.TIMEOUTS.PAUSED,Kr):e===Kr&&(this.chat_state_timeout=setTimeout(this.setChatState.bind(this),uo.TIMEOUTS.INACTIVE,Gr)),this.set("chat_state",e,t),this}onMessageAdded(e){!ad.settings.get("prune_messages_above")||"scrolled"!==ad.settings.get("pruning_behavior")&&this.ui.get("scrolled")||qm.isEmptyMessage(e)||this.debouncedPruneHistory()}async onMessageUploadChanged(e){if(e.get("upload")===Fr){const t={body:e.get("body"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};await this.sendMessage(t),e.destroy()}}onMessageCorrecting(e){e.get("correcting")?this.save({correcting:e.get("id"),draft:qm.prefixMentions(e)}):this.save({correcting:void 0,draft:void 0})}onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())}pruneHistoryWhenScrolledDown(){ad.settings.get("prune_messages_above")&&"unscrolled"===ad.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&this.debouncedPruneHistory()}shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||!e.chat_state)return Promise.resolve(!0)}async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),Y.error(e)}finally{this.messages.fetched.resolve()}}editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const n=this.messages.at(t);if(n.get("editable")){e=n;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),e?.save("correcting",!0)}editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const n=this.messages.at(t);if(n.get("editable")){e=n,e.save("correcting",!0);break}}return e}isChatMessage(e){throw new gl}getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(this.isChatMessage(t))return t}}getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(this.isChatMessage(t))return t}}getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))}findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((({attributes:t})=>t.retracted_id===e.origin_id&&t.from===e.from&&!t.moderated_by))}return null}getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.find((t=>Object.keys(t).every((n=>e.get(n)===t[n]))))))}getOriginIdQueryAttrs(e){return e.origin_id&&{origin_id:e.origin_id,from:e.from}}getStanzaIdQueryAttrs(e){const t=Object.keys(e).filter((e=>e.startsWith("stanza_id ")));return t.map((t=>{const n={};return n[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],n}))}getMessageBodyQueryAttrs(e){if(e.msgid){const t={from:e.from,msgid:e.msgid};return!e.is_encrypted&&e.body&&(t.body=e.body),t}}async sendMarkerForMessage(e,t="displayed",n=!1){if(!e||"groupchat"===e?.get("type")||!ad.settings.get("send_chat_markers").includes(t))return;const s=await ad.contacts.get(this.get("jid")),i=s?.get("subscription");if(s&&"none"!==i&&"to"!==i&&(e?.get("is_markable")||n)){Ff(Um.getBareJidFromJid(e.get("from")),e.get("msgid"),t,e.get("type"))}}handleUnreadMessage(e){e?.get("body")&&function(e){return e instanceof Element?!(Q()(`result[xmlns="${Mm.NS.MAM}"]`,e).length&&Q()(`delay[xmlns="${Mm.NS.DELAY}"]`,e).length):(e instanceof ie.Model&&(e=e.attributes),!(e.is_delayed&&e.is_archived))}(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))}async getErrorAttributesForMessage(e,t){const{__:n}=uo,s={editable:!1,error:t.error,error_condition:t.error_condition,error_text:t.error_text,error_type:t.error_type,is_error:!0};return t.msgid===e.get("retraction_id")?(s.retraction_id=void 0,t.error||("forbidden"===t.error_condition?s.error=n("You're not allowed to retract your message."):s.error=n("Sorry, an error occurred while trying to retract your message."))):t.error||("forbidden"===t.error_condition?s.error=n("You're not allowed to send a message."):s.error=n("Sorry, an error occurred while trying to send your message.")),await ad.hook("getErrorAttributesForMessage",t,s)}async handleErrorMessageStanza(e){const t=await Nm(e);if(qm.isErrorObject(t)){const{stanza:e,message:n}=t;return e&&Y.error(e),Y.error(n)}const n=t;if(!await this.shouldShowErrorMessage(n))return;const s=this.getMessageReferencedByError(n);if(s){const e=await this.getErrorAttributesForMessage(s,n);s.save(e)}else this.createMessage(n)}incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)}clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),qm.safeSave(this,{num_unread:0})}async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;for(const n of this.messages.models)if(n.get("from")===e.from&&(n.get("origin_id")===e.retracted_id||n.get("msgid")===e.retracted_id))return n.save(zs(e,t)),!0;return e.dangling_retraction=!0,await this.createMessage(e),!0}{const n=this.findDanglingRetraction(e);if(n){const s=zs(n.attributes,t),i=Object.assign({dangling_retraction:!1},e,s);return delete i.id,n.save(i),!0}}return!1}handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)!function(e,t){const n=Uf`
        <message from="${ad.connection.get().jid}"
                id="${Pf.getUniqueId()}"
                to="${e}"
                type="chat"
                xmlns="jabber:client">
            <received xmlns="${Cr.NS.RECEIPTS}" id="${t}"/>
            <store xmlns="${Cr.NS.HINTS}"/>
        </message>`;ad.send(n)}(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1}async createMessageStanza(e){const{body:t,edited:n,is_encrypted:s,is_spoiler:i,msgid:r,oob_url:o,origin_id:a,references:c,spoiler_hint:l,type:d}=e.attributes,u=Bm`
                <message xmlns="jabber:client"
                        from="${"groupchat"===e.get("type")?ad.connection.get().jid:e.get("from")}"
                        to="${e.get("to")||this.get("jid")}"
                        type="${this.get("message_type")}"
                        id="${n&&qm.getUniqueId()||r}">
                    ${t?Bm`<body>${t}</body>`:""}
                    <active xmlns="${Um.NS.CHATSTATES}"/>
                    ${"chat"===d?Bm`<request xmlns="${Um.NS.RECEIPTS}"></request>`:""}
                    ${!s&&o?Bm`<x xmlns="${Um.NS.OUTOFBAND}"><url>${o}</url></x>`:""}
                    ${!s&&i?Bm`<spoiler xmlns="${Um.NS.SPOILER}">${l??""}</spoiler>`:""}
                    ${s?"":c?.map((e=>Bm`<reference xmlns="${Um.NS.REFERENCE}"
                                                begin="${e.begin}"
                                                end="${e.end}"
                                                type="${e.type}"
                                                uri="${e.uri}"></reference>`))}
                    ${n?Bm`<replace xmlns="${Um.NS.MESSAGE_CORRECT}" id="${r}"></replace>`:""}
                    ${a?Bm`<origin-id xmlns="${Um.NS.SID}" id="${a}"></origin-id>`:""}
                </message>`;return(await ad.hook("createMessageStanza",this,{message:e,stanza:u})).stanza}pruneHistory(){const e=ad.settings.get("prune_messages_above");if(e&&"number"==typeof e&&this.messages.length>e){const t=this.messages.filter((e=>!qm.isEmptyMessage(e)));if(t.length>e){for(;t.length>e;)t.shift().destroy();this.trigger("historyPruned")}}}debouncedPruneHistory=$o((()=>this.pruneHistory()),500,{maxWait:2e3});isScrolledUp(){return this.ui.get("scrolled")}isHidden(){return this.get("hidden")||this.isScrolledUp()||document.hidden}}}class Hm extends ie.Model{defaults(){return{current_category:"smileys",current_skintone:"",scroll_position:0}}}const Gm=Hm,Wm={async initialize(){if(!Lf.emojis.initialized){Lf.emojis.initialized=!0;const e=await n.e(2974).then(n.t.bind(n,7641,19)),t=await ad.hook("loadEmojis",{},e.default);Lf.emojis.json=t,Lf.emojis.by_sn=Object.keys(t).reduce(((e,n)=>Object.assign(e,t[n])),{}),Lf.emojis.list=Object.values(Lf.emojis.by_sn),Lf.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),Lf.emojis.shortnames=Lf.emojis.list.map((e=>e.sn));const s=()=>Lf.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");Lf.emojis.shortnames_regex=new RegExp(s(),"gi"),Lf.emojis.initialized_promise.resolve()}return Lf.emojis.initialized_promise}},Vm={emojis:Wm},Km=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Ã|\\:\\-Ã|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Ã|\\:Ã|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),Jm=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,{u:Ym}=Lf.env,Xm={},Qm={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Ã":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Ã":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function Zm(e){if(e.indexOf("-")>-1){const t=[],n=e.split("-");for(let e=0;e<n.length;e++){const s=parseInt(n[e],16);if(s>=65536&&s<=1114111){const e=Math.floor((s-65536)/1024)+55296,n=(s-65536)%1024+56320;t.push(String.fromCharCode(e)+String.fromCharCode(n))}else t.push(String.fromCharCode(s))}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function eg(e){return e.replace(Km,((e,t,n,s)=>{if(void 0===s||""===s||!(Ym.unescapeHTML(s)in Qm))return e;s=Ym.unescapeHTML(s);return n+Zm(Qm[s].toUpperCase())}))}function tg(e){if(!Lf.emojis.initialized)throw new Error("getShortnameReferences called before emojis are initialized. To avoid this problem, first await the converse.emojis.initialized_promise");return[...e.matchAll(Lf.emojis.shortnames_regex)].filter((e=>e[0].length>0)).map((e=>{const t=Lf.emojis.by_sn[e[0].toLowerCase()].cp;return{cp:t,begin:e.index,end:e.index+e[0].length,shortname:e[0],emoji:t?Zm(t):null}}))}function ng(e){const t=[];return function(e,t){const n=/\uFE0F/g,s=String.fromCharCode(8205);String(e).replace(Jm,((e,i,r)=>{const o=function(e){const t=[];let n=0,s=0;for(;s<e.length;){const i=e.charCodeAt(s++);n?(t.push((65536+(n-55296<<10)+(i-56320)).toString(16)),n=0):55296<=i&&i<=56319?n=i:t.push(i.toString(16))}return t.join("-")}(e.indexOf(s)<0?e.replace(n,""):e);return o&&t(o,e,r),e}))}(e,((e,n,s)=>{t.push({begin:s,cp:e,emoji:n,end:s+n.length,shortname:ig("cp")[e]?.sn||""})})),t}function sg(e){const t=e.trim().split(/\s+/);if(0===t.length||t.length>3)return!1;const n=t.filter((e=>{const t=ng(Ym.shortnamesToUnicode(e));return 1===t.length&&(e.toLowerCase()===t[0].shortname||e===t[0].emoji)}));return n.length===t.length}function ig(e){if(Xm[e])return Xm[e];if("category"===e)return Lf.emojis.json;const t=Lf.emojis.list.map((t=>t[e])).filter(((e,t,n)=>n.indexOf(e)==t));return Xm[e]={},t.forEach((t=>Xm[e][t]=Lf.emojis.list.find((n=>n[e]===t)))),Xm[e]}Object.assign(Ym,{getCodePointReferences:ng,getShortnameReferences:tg,convertASCII2Emoji:eg,getEmojisByAttribute:ig,isOnlyEmojis:sg,shortnamesToUnicode:function(e){return function(e){let t=[e];return[...tg(e),...ng(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const n=t.shift(),s=e.emoji||e.shortname;t=[n.slice(0,e.begin)+s+n.slice(e.end),...t]})),t}(eg(e)).pop()}}),Lf.emojis={initialized:!1,initialized_promise:re()},Lf.plugins.add("converse-emoji",{initialize(){const{___:e}=uo;ad.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}});const t={EmojiPicker:Gm};async function n(e,t){return await ad.emojis.initialize(),{...t,is_only_emojis:!!t.body&&sg(t.body)}}Object.assign(uo,t),Object.assign(uo.exports,t),Object.assign(ad,Vm),ad.listen.on("getOutgoingMessageAttributes",(async(e,t)=>{await ad.emojis.initialize();const{original_text:n}=t;return{...t,is_only_emojis:!!n&&sg(n)}})),ad.listen.on("parseMUCMessage",n),ad.listen.on("parseMessage",n)}});const{Strophe:rg}=Lf.env;class og extends ie.Model{get idAttribute(){return"jid"}getDisplayName(){return rg.xmlunescape(this.get("name"))}}const ag=og,{Strophe:cg,sizzle:lg}=Lf.env;const dg=class extends km{initialize(){super.initialize(),this.on("change:type",(()=>this.setOccupant())),this.setOccupant(),ad.trigger("chatRoomMessageInitialized",this)}get occupants(){return"chat"===this.get("type")?this.chatbox.collection:this.chatbox.occupants}getDisplayName(){return this.occupant?.getDisplayName()||this.get("nick")}async mayBeModerated(){if(void 0!==this.get("from_muc"))return["all","moderator"].includes(ad.settings.get("allow_message_retraction"))&&this.get(`stanza_id ${this.get("from_muc")}`)&&await this.chatbox.canModerateMessages()}checkValidity(){const e=super.checkValidity();return!e&&this.chatbox.debouncedRejoin(),e}onOccupantRemoved(){this.stopListening(this.occupant),delete this.occupant,this.listenTo(this.occupants,"add",this.onOccupantAdded)}onOccupantAdded(e){if(this.get("occupant_id")){if(e.get("occupant_id")!==this.get("occupant_id"))return}else if(e.get("nick")!==Cr.getResourceFromJid(this.get("from")))return;this.setOccupant(e)}getOccupant(){return this.occupant||this.setOccupant()}setOccupant(e){if(["groupchat","chat"].includes(this.get("type"))&&!this.isEphemeral()){if(e)this.occupant=e;else if("chat"===this.get("type")&&"them"===this.get("sender"))this.occupant=this.chatbox;else{if(this.occupant)return;const e=Cr.getResourceFromJid(this.get("from")),t=this.get("occupant_id");if(this.occupant=e||t?this.occupants.findOccupant({nick:e,occupant_id:t}):null,!this.occupant){const n=this.get("from_real_jid");if(!e&&!t&&!n)return;if(this.occupant=this.occupants.create({nick:e,occupant_id:t,jid:n}),ad.settings.get("muc_send_probes")){const t=`${this.chatbox.get("jid")}/${e}`;ad.user.presence.send({to:t,type:"probe"})}}}return this.get("from_real_jid")!==this.occupant.get("jid")&&this.save("from_real_jid",this.occupant.get("jid")),this.trigger("occupant:add"),this.listenTo(this.occupant,"change",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"vcard:add",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"vcard:change",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved),this.stopListening(this.occupants,"add",this.onOccupantAdded),this.occupant}}};class ug extends ie.Collection{constructor(e,t={}){super(e,Object.assign({comparator:"time"},t)),this.model=dg,this.fetched=null}}const hg=ug,fg={},mg=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);fg.escapeCharacters=e=>t=>e.split("").reduce(mg,t),fg.escapeRegexString=fg.escapeCharacters("[\\^$.?*+(){}|"),fg.findFirstMatchInArray=e=>t=>{for(let n=0;n<e.length;n++)if(0===t.localeCompare(e[n],void 0,{sensitivity:"base"}))return e[n];return null};const gg=([e,t],n,s)=>{let i=e,{begin:r,end:o}=n;const{value:a}=n;return r-=s,o=o-s-1,i=`${i.slice(0,r)}${a}${i.slice(o+1)}`,[i,[...t,{...n,begin:r,end:o}]]};fg.reduceTextFromReferences=(e,t)=>t.reduce(gg,[e,[]]);const pg=fg,vg=["301","333","307","321","322"],bg=["210","303"],yg=["admin","ban","deop","destroy","member","op","revoke"],_g=["owner","admin","member","outcast","none"],wg=["301","333","307","321","322","332"],Sg=["kick","mute","voice","modtools"],Ag=["owner"],xg=["moderator","participant","visitor"],$g=["nick"],Eg={100:["message","presence"],101:["message"],102:["message"],103:["message"],104:["message"],110:["presence"],170:["message","presence"],171:["message"],172:["message"],173:["message"],174:["message"],201:["presence"],210:["presence"],301:["presence"],303:["presence"],307:["presence"],321:["presence"],322:["presence"],332:["presence"],333:["presence"]},jg={moderator:1,participant:2,visitor:3,none:2},Cg={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},kg=Object.values(Cg),Tg={ENTERED:"entered",EXITED:"exited"},Og=Object.values(Tg),Ng={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},Mg=Object.values(Ng),Ig={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...kg],join_leave_events:[...Og],role_changes:[...Mg]},Rg={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7,CLOSING:8},Dg=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled","vcard-temp"],zg="303",{Strophe:Lg,sizzle:Pg,u:Ug}=Lf.env,{NS:Bg}=Lg;function qg(e){const t=Pg(`items[node="${Lg.NS.CONFINFO}"]`,e).pop();if(!t)return null;const n=e.getAttribute("from"),s=e.getAttribute("id"),i=`item conference-info[xmlns="${Lg.NS.CONFINFO}"] activity[xmlns="${Lg.NS.ACTIVITY}"]`;return Pg(i,t).map((t=>{const i=t.querySelector("text")?.textContent;if(i){const r=em(e),o=t.querySelector("reason")?.textContent;return{from:n,msgid:s,message:i,reason:o,references:r,type:"mep"}}return{}}))}function Fg(e){const t=Pg(`> retract[xmlns="${Lg.NS.RETRACT}"]`,e).pop();if(t){const e=Pg(`moderated[xmlns="${Lg.NS.MODERATE}"]`,t).pop();if(e)return{editable:!1,moderated:"retracted",moderated_by:e.getAttribute("by"),moderated_by_id:e.querySelector("occupant-id")?.getAttribute("id"),moderated_id:t.getAttribute("id"),moderation_reason:t.querySelector("reason")?.textContent}}else{const t=Pg(`retracted[xmlns="${Lg.NS.RETRACT}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),moderated_by_id:t.querySelector("occupant-id")?.getAttribute("id"),retracted:t.getAttribute("stamp"),moderation_reason:t.querySelector("reason")?.textContent}}return function(e){const t=Pg(`apply-to[xmlns="${Lg.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=Pg(`moderated[xmlns="${Lg.NS.MODERATE0}"]`,t).pop();if(n&&Pg(`retract[xmlns="${Lg.NS.RETRACT0}"]`,n).pop())return{editable:!1,moderated:"retracted",moderated_by:n.getAttribute("by"),moderated_id:e,moderation_reason:n.querySelector("reason")?.textContent}}else{const t=Pg(`> moderated[xmlns="${Lg.NS.MODERATE0}"]`,e).pop();if(t&&Pg(`retracted[xmlns="${Lg.NS.RETRACT0}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:t.querySelector("reason")?.textContent}}return{}}(e)}function Hg(e,t){const n=Pg(`${t} > x[xmlns="${Lg.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code"))).filter((e=>Eg[e]?.includes(t)));return"presence"===t&&n.includes("333")&&n.includes("307")&&n.splice(n.indexOf("307"),1),{codes:n,is_self:n.includes("110")}}function Gg(e,t){if(t.features.get(Lg.NS.OCCUPANTID))return Pg(`occupant-id[xmlns="${Lg.NS.OCCUPANTID}"]`,e).pop()?.getAttribute("id")}function Wg(e,t){let n;const s=t.get("occupant_id");if(s)n=e.occupant_id===s;else if(e.from_real_jid){const t=uo.session.get("bare_jid");n=Lg.getBareJidFromJid(e.from_real_jid)===t}else n=e.nick===t.get("nick");return n?"me":"them"}async function Vg(e,t){rm(e);const n=Pg(`result[xmlns="${Bg.MAM}"] > forwarded[xmlns="${Bg.FORWARD}"] > message`,e).pop(),s=n||e;if(Pg(`message > forwarded[xmlns="${Lg.NS.FORWARD}"]`,s).length)return new bl(s,`Invalid Stanza: Forged MAM groupchat message from ${s.getAttribute("from")}`);let i,r;if(n){if(Pg(`message > forwarded[xmlns="${Lg.NS.FORWARD}"]`,n).length)return new bl(e,`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`);i=Pg(`delay[xmlns="${Lg.NS.DELAY}"]`,n.parentElement).pop(),r=n.querySelector(":scope > body")?.textContent?.trim()}else i=Pg(`message > delay[xmlns="${Lg.NS.DELAY}"]`,e).pop(),r=e.querySelector(":scope > body")?.textContent?.trim();const o=s.getAttribute("from"),a=om(s);let c=Object.assign({from:o,body:r,activities:qg(s),chat_state:sm(s),from_muc:Lg.getBareJidFromJid(o),is_archived:lm(e),is_carbon:nm(e),is_delayed:!!i,is_forwarded:!!Pg(`message > forwarded[xmlns="${Lg.NS.FORWARD}"]`,s).length,is_headline:am(s),is_markable:!!Pg(`message > markable[xmlns="${Lg.NS.MARKERS}"]`,s).length,is_marker:!!a,is_unstyled:!!Pg(`message > unstyled[xmlns="${Lg.NS.STYLING}"]`,s).length,marker_id:a&&a.getAttribute("id"),nick:Lg.unescapeNode(Lg.getResourceFromJid(o)),occupant_id:Gg(s,t),receipt_id:tm(s),received:(new Date).toISOString(),references:em(s),subject:s.querySelector(":scope > subject")?.textContent,thread:s.querySelector(":scope > thread")?.textContent,time:i?H()(i.getAttribute("stamp")).toISOString():(new Date).toISOString(),to:s.getAttribute("to"),type:s.getAttribute("type")},Zf(s),Qf(s),Xf(s),Yf(s,e),Vf(s,e),function(e){const t=Q()(`> apply-to[xmlns="${Cr.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=Q()(`> meta[xmlns="${Cr.NS.XHTML}"]`,t);if(n.length){const t=ad.settings.get("message_limit"),s=n.reduce(((e,n)=>{const s=n.getAttribute("property");if(s){let i=yu(n.getAttribute("content")||"");t&&"og:description"===s&&i.length>=t&&(i=`${i.slice(0,t)}${yu("&#8230;")}`),e[s]=i}return e}),{ogp_for_id:e}),i=s["og:url"];if(i?.startsWith("/")&&"github"===s["og:site_name"]?.toLowerCase()&&(s["og:url"]=`https://github.com${i}`),"og:description"in s||"og:title"in s||"og:image"in s)return s}}return{}}(s),Jf(s,e),Fg(s),Kf(s),Hg(s,"message"));if(c.from_real_jid=c.is_archived&&function(e){const t=Pg(`message > x[xmlns="${Lg.NS.MUC_USER}"] item`,e).pop();return t?.getAttribute("jid")}(s)||t.occupants.findOccupant(c)?.get("jid"),c=Object.assign({is_valid_receipt_request:im(s,c),message:c.body||c.error,sender:Wg(c,t)},c),c.is_archived&&e.getAttribute("from")!==c.from_muc)return new bl(e,`Invalid Stanza: Forged MAM message from ${e.getAttribute("from")}`);if(c.is_archived&&e.getAttribute("from")!==t.get("jid"))return new bl(e,`Invalid Stanza: Forged MAM groupchat message from ${s.getAttribute("from")}`);if(c.is_carbon)return new bl(e,"Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied");c.id=c.origin_id||c[`stanza_id ${c.from_muc||c.from}`]||Ug.getUniqueId(),c=await ad.hook("parseMUCMessage",e,c);const l=await Ug.getMediaURLsMetadata(c.is_encrypted?c.plaintext:c.body);return Object.assign(c,l)}function Kg(e,t){const n=Pg(`presence > x[xmlns="${Lg.NS.MUC_USER}"] item`,e).pop();if(n){const e=n.querySelector("actor");return{affiliation:n.getAttribute("affiliation"),role:n.getAttribute("role"),jid:n.getAttribute("jid"),nick:n.getAttribute("nick")||t,...e?{actor:{nick:e?.getAttribute("nick")??null,jid:e?.getAttribute("jid")??null}}:{},reason:n.querySelector("reason")?.textContent??null}}}const{Strophe:Jg,$iq:Yg,u:Xg,stx:Qg}=Lf.env;async function Zg(e,t){const n=Qg`
        <iq xmlns="jabber:client" to="${t}" type="get">
            <query xmlns="${Jg.NS.MUC_ADMIN}">
                <item affiliation="${e}"/>
            </query>
        </iq>`,s=await ad.sendIQ(n,null,!1);if(null===s){const n=`Error: timeout while fetching ${e} list for MUC ${t}`,s=new Error(n);return Y.warn(n),s}if(Xg.isErrorStanza(s)){const n=`Error: not allowed to fetch ${e} list for MUC ${t}`,i=new Error(n);return Y.warn(n),Y.warn(s),i}return function(e){return Pg(`query[xmlns="${Lg.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},n=e.getAttribute("jid");Ug.isValidJID(n)?t.jid=n:t.nick=n;const s=e.getAttribute("nick");return s&&(t.nick=s),e.getAttribute("role")&&(t.role=s),t}))}(s).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))}function ep(e,t){const n=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(n.map((n=>tp(n,e,t))))}function tp(e,t,n){return Array.isArray(t)||(t=[t]),n=n.filter((t=>[void 0,e].includes(t.affiliation))),Promise.all(t.reduce(((t,s)=>[...t,...n.map((t=>function(e,t,n){e=n.affiliation||e;const s=Yg({to:t,type:"set"}).c("query",{xmlns:Jg.NS.MUC_ADMIN}).c("item",{affiliation:e,..."outcast"===e?{}:{nick:n.nick},jid:n.jid});void 0!==n.reason&&s.c("reason",n.reason);return ad.sendIQ(s)}(e,s,t)))]),[]))}function np(e,t,n,s){const i=n.map((e=>e.jid)),r=s.map((e=>e.jid));let o=i.filter((e=>!r.includes(e))).map((e=>n[i.indexOf(e)]));return e||(o=o.concat(n.filter((e=>{const t=r.indexOf(e.jid);return t>=0&&e.affiliation!==s[t].affiliation})))),t&&(o=o.concat(r.filter((e=>!i.includes(e))).map((e=>({jid:e,affiliation:"none"}))))),o}const{u:sp}=Lf.env;class ip extends(Fm(ie.Model)){async initialize(){await super.initialize();const e=this.get("jid");e&&this.set({box_id:`box-${e}`})}validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=ad.settings.get("auto_join_rooms").map((e=>e instanceof Object?e.jid:e)),n=ad.settings.get("auto_join_private_chats").concat(t);if(ad.settings.get("singleton")&&!n.includes(e.jid)&&!ad.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return Y.warn(t),t}}maybeShow(e){if(Ys()){const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),n=uo.state.chatboxes.filter(t);return(e||0===n.length)&&(n.forEach((e=>sp.safeSave(e,{hidden:!0}))),sp.safeSave(this,{hidden:!1}),this.trigger("show")),this}return sp.safeSave(this,{hidden:!1}),this.trigger("show"),this}async close(e){try{await new Promise(((e,t)=>this.destroy({success:e,error:(e,n)=>t(n)})))}catch(e){Y.debug(e)}finally{ad.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}ad.trigger("chatBoxClosed",this)}announceReconnection(){ad.trigger("chatReconnected",this)}async onReconnection(){ad.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()}}const{Strophe:rp,sizzle:op,u:ap}=Lf.env;function cp(e){return e.nick&&(ap.shouldCreateMessage(e)||e.is_tombstone)}function lp(e,t){const n=e.get("role")||"none",s=t.get("role")||"none";if(jg[n]===jg[s]){const n=e.getDisplayName().toLowerCase(),s=t.getDisplayName().toLowerCase();return n<s?-1:n>s?1:0}return jg[n]<jg[s]?-1:1}function dp(){ad.connection.get().addHandler((e=>(uo.exports.onDirectMUCInvitation(e),!0)),"jabber:x:conference","message")}function up(){return uo.state.chatboxes.filter((e=>e.get("type")===Xr)).forEach((e=>e.session.save({connection_status:Lf.ROOMSTATUS.DISCONNECTED})))}async function hp(){if(!document.hidden&&ad.connection.connected()){(await ad.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}}async function fp(e){if(!location.hash.startsWith("#converse/room?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!ap.isValidMUCJID(t))return Y.warn(`invalid jid "${t}" provided in url fragment`);await ad.waitUntil("roomsAutoJoined"),ad.settings.get("allow_bookmarks")&&await ad.waitUntil("bookmarksInitialized"),ad.rooms.open(t,{},!0)}async function mp(e){const t=op('x[xmlns="jabber:x:conference"]',e).pop(),n=rp.getBareJidFromJid(e.getAttribute("from")),s=t.getAttribute("jid"),i=t.getAttribute("reason");let r;if(ad.settings.get("auto_join_on_invite"))r=!0;else{const e=uo.state.roster.get(n)?.getDisplayName()??n;r=await ad.hook("confirmDirectMUCInvitation",{contact:e,reason:i,jid:s},!1)}if(r){const e=await async function(e,t){t.type=Xr,t.id=e;const n=await ad.rooms.get(e,t,!0);return n.maybeShow(!0),n}(s,{password:t.getAttribute("password")});e.session.get("connection_status")===Lf.ROOMSTATUS.DISCONNECTED&&uo.state.chatboxes.get(s).rejoin()}}function gp(){const{profile:e}=uo.state;if(!e)return Y.error("Called getDefaultMUCNickname before statusInitialized has been fired."),"";const t=e.getNickname();if(t)return t;if(ad.settings.get("muc_nickname_from_jid")){const e=uo.session.get("bare_jid");return rp.unescapeNode(rp.getNodeFromJid(e))}}function pp(e){return!!ad.settings.get("muc_show_info_messages").includes(e)}async function vp(){await Promise.all(ad.settings.get("auto_join_rooms").map((e=>"string"==typeof e?uo.state.chatboxes.where({jid:e}).length?Promise.resolve():ad.rooms.open(e):e instanceof Object?ad.rooms.open(e.jid,{...e}):(Y.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),ad.trigger("roomsAutoJoined")}function bp(){ad.disco.own.features.add(rp.NS.MUC),ad.settings.get("allow_muc_invitations")&&ad.disco.own.features.add("jabber:x:conference")}function yp(){uo.state.chatboxes.where({type:Xr}).forEach((e=>il(e.session,{connection_status:Lf.ROOMSTATUS.DISCONNECTED})))}function _p(){window.addEventListener(Qs(),(()=>{!ad.connection.isType("websocket")||ad.settings.get("enable_smacks")&&uo.session.get("smacks_stream_id")||up()}))}function wp(){ad.connection.get().addHandler((e=>{const t=rp.getBareJidFromJid(e.getAttribute("from"));return uo.state.chatboxes.get(t)||ad.waitUntil("chatBoxesFetched").then((async()=>{const n=uo.state.chatboxes.get(t);n&&(await n.initialized,n.message_handler.run(e))})),!0}),null,"message","groupchat")}class Sp extends ie.Model{defaults(){return{connection_status:Rg.DISCONNECTED}}}const Ap=Sp,{u:xp,stx:$p}=Lf.env;class Ep extends(jm(Fm(gm(ip)))){defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:Ys()&&!ad.settings.get("singleton"),hidden_occupants:!!ad.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:Xr}}async initialize(){super.initialize(),this.initialized=re(),this.debouncedRejoin=$o(this.rejoin,250),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:presence",this.onOccupantPresenceChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage);await this.restoreFromCache()||await this.join(),await ad.trigger("chatRoomInitialized",this,{synchronous:!0}),this.initialized.resolve()}isEntered(){return this.session?.get("connection_status")===Rg.ENTERED}isRAICandidate(){return this.get("hidden")&&ad.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()}async restoreFromCache(){if(this.isEntered()){if(await this.fetchOccupants().catch((e=>Y.error(e))),this.isRAICandidate())return this.session.save("connection_status",Rg.DISCONNECTED),this.enableRAI(),!0;if(await this.isJoined())return await new Promise((e=>this.config.fetch({success:e,error:e}))),await new Promise((e=>this.features.fetch({success:e,error:e}))),await this.fetchMessages().catch((e=>Y.error(e))),!0}return this.session.save("connection_status",Rg.DISCONNECTED),this.clearOccupantsCache(),!1}async join(e,t){if(this.isEntered())return;this.session.save("connection_status",Rg.CONNECTING);const n=await this.refreshDiscoInfo()instanceof $l;if(!(e=await this.getAndPersistNickname(e)))return il(this.session,{connection_status:Rg.NICKNAME_REQUIRED}),void(!n&&ad.settings.get("muc_show_logs_before_join")&&await this.fetchMessages());ad.send(await this.constructJoinPresence(t,n)),n&&await this.refreshDiscoInfo()}rejoin(){return this.session.save("connection_status",Rg.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()}async constructJoinPresence(e,t){const n=t||this.features.get("mam_enabled")?0:ad.settings.get("muc_history_max_stanzas");e=e||this.get("password");const{profile:s}=uo.state,i=s.get("show"),r=s.get("status_message"),o=$p`
            <presence xmlns="jabber:client"
                      id="${If()}"
                      from="${ad.connection.get().jid}"
                      to="${this.getRoomJIDAndNick()}">
                <x xmlns="${Cr.NS.MUC}">
                    <history maxstanzas="${n}"/>
                    ${e?$p`<password>${e}</password>`:""}
                </x>
                ${Nr.includes(i)?$p`<show>${i}</show>`:""}
                ${r?$p`<status>${r}</status>`:""}
            </presence>`;return await ad.hook("constructedMUCPresence",this,o)}clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()}sendMarkerForMessage(e,t="displayed",n=!1){if(e&&ad.settings.get("send_chat_markers").includes(t)&&"groupchat"===e?.get("type")){if(e?.get("is_markable")||n){const n=`stanza_id ${this.get("jid")}`,s=e.get(n);if(!s)return Y.error(`Can't send marker for message without stanza ID: ${n}`),Promise.resolve();Ff(Cr.getBareJidFromJid(e.get("from")),s,t,e.get("type"))}return Promise.resolve()}}sendMarkerForLastMessage(e="displayed",t=!1){const n=Array.from(this.messages.models);n.reverse();const s=n.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));s&&this.sendMarkerForMessage(s,e,t)}enableRAI(){if(ad.settings.get("muc_subscribe_to_rai")){const e=Cr.getDomainFromJid(this.get("jid"));ad.user.presence.send({to:e},Ki("rai",{xmlns:Cr.NS.RAI}))}}async onHiddenChange(){const e=Rg,t=this.session.get("connection_status");this.get("hidden")?t===e.ENTERED&&(this.setChatState(Gr),this.isRAICandidate()&&(this.sendMarkerForLastMessage("received",!0),await this.leave(),this.enableRAI())):(await this.initialized,t===e.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())}onOccupantAdded(e){pp(Lf.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===Rg.ENTERED&&"online"===e.get("presence")&&this.updateNotifications(e.get("nick"),Lf.MUC_TRAFFIC_STATES.ENTERED)}onOccupantRemoved(e){pp(Lf.MUC_TRAFFIC_STATES.EXITED)&&this.isEntered()&&"online"===e.get("presence")&&this.updateNotifications(e.get("nick"),Lf.MUC_TRAFFIC_STATES.EXITED)}onOccupantPresenceChanged(e){e.get("states").includes("303")||("offline"===e.get("presence")&&pp(Lf.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),Lf.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("presence")&&pp(Lf.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),Lf.MUC_TRAFFIC_STATES.ENTERED))}async onRoomEntered(){await this.occupants.fetchMembers(),ad.settings.get("clear_messages_on_reconnection")?await this.clearMessages():await this.fetchMessages(),ad.trigger("enteredNewRoom",this),ad.settings.get("auto_register_muc_nickname")&&await ad.disco.supports(Cr.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname()}async onConnectionStatusChanged(){if(this.isEntered())if(this.isRAICandidate()){try{await this.leave()}catch(e){Y.error(e)}this.enableRAI()}else await this.onRoomEntered()}async onReconnection(){await this.rejoin(),this.announceReconnection()}getMessagesCollection(){return new uo.exports.MUCMessages}restoreSession(){const e=`muc.session-${uo.session.get("bare_jid")}-${this.get("jid")}`;return this.session=new Ap({id:e}),zc(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))}initDiscoModels(){const e=uo.session.get("bare_jid");let t=`converse.muc-features-${e}-${this.get("jid")}`;this.features=new ie.Model(Object.assign({id:t},Lf.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{}))),this.features.browserStorage=Dc(t,"session"),this.features.listenTo(uo,"beforeLogout",(()=>this.features.browserStorage.flush())),t=`converse.muc-config-${e}-${this.get("jid")}`,this.config=new ie.Model({id:t}),this.config.browserStorage=Dc(t,"session"),this.config.listenTo(uo,"beforeLogout",(()=>this.config.browserStorage.flush()))}initOccupants(){this.occupants=new uo.exports.MUCOccupants;const e=`converse.occupants-${uo.session.get("bare_jid")}${this.get("jid")}`;this.occupants.browserStorage=Dc(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(uo,"beforeLogout",(()=>this.occupants.browserStorage.flush()))}fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched}handleAffiliationChangedMessage(e){if(e.querySelector("body"))return;const t=Q()(`x[xmlns="${Cr.NS.MUC_USER}"] item`,e).pop();if(t){const n=e.getAttribute("from"),s=t.getAttribute("jid"),i={from:n,states:[],jid:Cr.getBareJidFromJid(s),resource:Cr.getResourceFromJid(s)},r=t.getAttribute("affiliation");r&&(i.affiliation=r);const o=t.getAttribute("role");o&&(i.role=o);const a=this.occupants.findOccupant({jid:i.jid});a?a.save(i):this.occupants.create(i)}}async handleErrorMessageStanza(e){const{__:t}=uo,n=await Vg(e,this);if(xp.isErrorObject(n)){const{stanza:e,message:t}=n;return e&&Y.error(e),Y.error(t)}const s=n;if(!await this.shouldShowErrorMessage(s))return;const i=Cr.getResourceFromJid(s.from),r=i?this.getOccupant(i):null,o=r||this,a=o.getMessageReferencedByError(s);if(a){const e={error:s.error,error_condition:s.error_condition,error_text:s.error_text,error_type:s.error_type,editable:!1};s.msgid===a.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,s.error||("forbidden"===s.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===s.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):s.error||("forbidden"===s.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===s.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),a.save(e)}else o.createMessage(s)}handleMessageFromMUCHost(e){if(this.isEntered())return;const t=Q()(`rai[xmlns="${Cr.NS.RAI}"]`,e).pop(),n=Array.from(t?.querySelectorAll("activity")||[]).map((e=>e.textContent));n.includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})}handleForwardedMentions(e){if(this.isEntered())return;const t=Q()(`mentions[xmlns="${Cr.NS.MENTIONS}"] forwarded[xmlns="${Cr.NS.FORWARD}"] message[type="groupchat"]`,e),n=this.get("jid"),s=t.filter((e=>Cr.getBareJidFromJid(e.getAttribute("from"))===n));s.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+s.length}),s.forEach((async e=>{const t={stanza:e,attrs:await Vg(e,this),chatbox:this};ad.trigger("message",t)})))}async handleMessageStanza(e){const t=(e=e.tree?.()??e).getAttribute("type");if("error"===t)return this.handleErrorMessageStanza(e);if("groupchat"===t){if(lm(e))return Y.warn('Received a MAM message with type "groupchat"')}else if(!t)return this.handleForwardedMentions(e);let n;try{n=await Vg(e,this)}catch(e){return Y.error(e)}if(xp.isErrorObject(n)){const{stanza:e,message:t}=n;return e&&Y.error(e),Y.error(t)}const s=n;"groupchat"===s.type&&(s.codes.forEach((e=>this.createInfoMessage(e))),this.fetchFeaturesIfConfigurationChanged(s));const i={stanza:e,attrs:s,chatbox:this};return ad.trigger("message",i),s&&this.queueMessage(s)}registerHandlers(){const e=this.get("jid"),t=Cr.getDomainFromJid(e);this.removeHandlers();const n=ad.connection.get();this.presence_handler=n.addHandler((e=>(this.onPresence(e),!0)),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=n.addHandler((e=>(this.onPresenceFromMUCHost(e),!0)),null,"presence",null,null,t),this.message_handler=n.addHandler((e=>(this.handleMessageStanza(e),!0)),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=n.addHandler((e=>(this.handleMessageFromMUCHost(e),!0)),null,"message",null,null,t),this.affiliation_message_handler=n.addHandler((e=>(this.handleAffiliationChangedMessage(e),!0)),Cr.NS.MUC_USER,"message",null,null,e)}removeHandlers(){const e=ad.connection.get();return this.message_handler&&(e?.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(e?.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(e?.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(e?.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(e?.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this}invitesAllowed(){return ad.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())}getDisplayName(){const e=this.get("name");return e?e.trim():"hidden"===ad.settings.get("locked_muc_domain")?Cr.getNodeFromJid(this.get("jid")):this.get("jid")}sendTimedMessage(e){const t=e instanceof Element?e:e.tree();let n=t.getAttribute("id");n||(n=If("sendIQ"),t.setAttribute("id",n));const s=re(),i=ad.settings.get("stanza_timeout"),r=ad.connection.get(),o=r.addTimedHandler(i,(()=>{r.deleteHandler(a);const e=new pl("Timeout Error: No response from server");return s.resolve(e),!1})),a=r.addHandler((e=>{o&&r.deleteTimedHandler(o),s.resolve(e)}),null,"message",["error","groupchat"],n);return ad.send(t),s}async retractOwnMessage(e){const t=uo.__,n=e.get("editable"),s=If(),i=e.get("id"),r=$p`
            <message id="${s}"
                     to="${this.get("jid")}"
                     type="groupchat"
                     xmlns="jabber:client">
                <retract id="${i}" xmlns="${Cr.NS.RETRACT}"/>
                <body>/me retracted a message</body>
                <store xmlns="${Cr.NS.HINTS}"/>
                <fallback xmlns="${Cr.NS.FALLBACK}" for="${Cr.NS.RETRACT}" />
            </message>`;e.set({retracted:(new Date).toISOString(),retracted_id:i,retraction_id:s,editable:!1});const o=await this.sendTimedMessage(r);xp.isErrorStanza(o)?Y.error(o):o instanceof pl&&(Y.error(o),e.save({editable:n,error_type:"timeout",error:t("A timeout happened while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))}async retractOtherMessage(e,t){const n=e.get("editable"),s=uo.session.get("bare_jid");e.save({moderated:"retracted",moderated_by:s,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const i=await this.sendRetractionIQ(e,t);return(null===i||xp.isErrorStanza(i))&&e.save({editable:n,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),i}sendRetractionIQ(e,t){const n=$p`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <moderate id="${e.get(`stanza_id ${this.get("jid")}`)}" xmlns="${Cr.NS.MODERATE}">
                    <retract xmlns="${Cr.NS.RETRACT}"/>
                    ${t?$p`<reason>${t}</reason>`:""}
                </moderate>
            </iq>`;return ad.sendIQ(n,null,!1)}sendDestroyIQ(e,t){const n=$p`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Cr.NS.MUC_OWNER}">
                    <destroy ${t?Er.unsafeXML(`jid="${Cr.xmlescape(t)}"`):""}>
                        ${e?$p`<reason>${e}</reason>`:""}
                    </destroy>
                </query>
            </iq>`;return ad.sendIQ(n)}async leave(e){ad.user.presence.send({type:"unavailable",to:this.getRoomJIDAndNick(),status:e}),il(this.session,{connection_status:Rg.DISCONNECTED}),this.features&&await new Promise((e=>this.features.destroy({success:e,error:(t,n)=>{Y.error(n),e()}})));const t=uo.state.disco_entities?.get(this.get("jid"));t&&await new Promise((e=>t.destroy({success:e,error:(t,n)=>{Y.error(n),e()}})))}async close(e){const{ENTERED:t,CLOSING:n}=Rg,s=this.session.get("connection_status")===t;il(this.session,{connection_status:n}),s&&this.sendMarkerForLastMessage("received",!0),await this.leave(),this.occupants.clearStore();return"closeAllChatBoxes"!==e?.name&&(await this.unregisterNickname(),ad.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),ad.trigger("leaveRoom",this)),await new Promise((e=>this.session.destroy({success:e,error:(t,n)=>{Y.error(n),e()}}))),super.close()}canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&ad.disco.supports(Cr.NS.MODERATE,this.get("jid"))}canPostMessages(){return this.isEntered()&&!(this.features.get("moderated")&&"visitor"===this.getOwnRole())}isChatMessage(e){return e.get("type")===this.get("message_type")}getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))}getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>pg.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")}getOccupantByJID(e){return this.occupants.findOccupant({jid:e})}getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})}getReferenceURIFromNickname(e){const t=this.get("jid"),n=this.getOccupant(e),s=this.features.get("nonanonymous")&&n?.get("jid")||`${t}/${e}`;return encodeURI(`xmpp:${s}`)}parseTextForReferences(e){if(!e||!/(\p{P}|\p{Z}|^)([@][\w_-]+(?:\.\w+)*)/giu.test(e))return[e,[]];const t=pg.findFirstMatchInArray(this.getAllKnownNicknames()),n=this.getAllKnownNicknamesRegex(),s=[...e.matchAll(n)].filter((e=>!e[0].startsWith("/"))),i=s.map((e=>{let n=e[0].indexOf("@");"@"===e[0][n+1]&&(n+=1);const s=e.index+n,i=s+e[0].length-n,r=t(e[1]);return{begin:s,end:i,value:r,type:"mention",uri:this.getReferenceURIFromNickname(r)}})),[r,o]=pg.reduceTextFromReferences(e,i);return[r,o]}async getOutgoingMessageAttributes(e){const t=this.get("composing_spoiler");let n,s="";e?.body&&([s,n]=this.parseTextForReferences(e.body));const i=If(),r=s?xp.shortnamesToUnicode(s):void 0;return e=Object.assign({},e,{body:r,is_spoiler:t,origin_id:i,references:n,id:i,msgid:i,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),message:r,nick:this.get("nick"),sender:"me",type:"groupchat",original_text:s},await xp.getMediaURLsMetadata(s)),e=await ad.hook("getOutgoingMessageAttributes",this,e)}getRoomJIDAndNick(){const e=this.get("nick");return Cr.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")}sendChatState(){if(!ad.settings.get("send_chat_state_notifications")||!this.get("chat_state")||!this.isEntered()||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=ad.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==Jr&&ad.send($p`
            <message to="${this.get("jid")}" type="groupchat" xmlns="jabber:client">
                ${t===Gr?$p`<inactive xmlns="${Cr.NS.CHATSTATES}"/>`:""}
                ${t===Wr?$p`<active xmlns="${Cr.NS.CHATSTATES}"/>`:""}
                ${t===Vr?$p`<composing xmlns="${Cr.NS.CHATSTATES}"/>`:""}
                ${t===Kr?$p`<paused xmlns="${Cr.NS.CHATSTATES}"/>`:""}
                <no-store xmlns="${Cr.NS.HINTS}"/>
                <no-permanent-store xmlns="${Cr.NS.HINTS}"/>
            </message>`)}directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const n=$p`
            <message xmlns="jabber:client" to="${e}" id="${If()}">
                <x xmlns="jabber:x:conference"
                    jid="${this.get("jid")}"
                    ${this.get("password")?Er.unsafeXML(`password="${Cr.xmlescape(this.get("password"))}"`):""}
                    ${t?Er.unsafeXML(`reason="${Cr.xmlescape(t)}"`):""} />
            </message>`;ad.send(n),ad.trigger("roomInviteSent",{room:this,recipient:e,reason:t})}async refreshDiscoInfo(){const e=await ad.disco.refresh(this.get("jid"));return e instanceof vl?e:this.getDiscoInfo().catch((e=>Y.error(e)))}async getDiscoInfo(){const e=await ad.disco.getIdentity("conference","text",this.get("jid"));e?.get("name")?this.save({name:e.get("name")}):Y.error(`No identity or name found for ${this.get("jid")}`),await this.getDiscoInfoFields(),await this.getDiscoInfoFeatures()}async getDiscoInfoFields(){const e=(await ad.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const n=t.get("var");return"muc#roomconfig_roomname"===n&&(e.roomname=t.get("value")),n?.startsWith("muc#roominfo_")&&(e[n.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e),e.roomname&&this.save({name:e.roomname})}async getDiscoInfoFeatures(){const e=await ad.disco.getFeatures(this.get("jid")),t=Lf.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{fetched:(new Date).toISOString()});e.each((e=>{const n=e.get("var");n.startsWith("muc_")?t[n.replace("muc_","")]=!0:n===Cr.NS.MAM?t.mam_enabled=!0:t[n]=!0})),this.features.save(t)}addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const n=e.getAttribute("var").replace("muc#roomconfig_",""),s=this.get("roomconfig");if(n in s){let i;switch(t){case"boolean":i=[s[n]?1:0];break;case"list-multi":i=s[n];break;default:i=[s[n]]}e.innerHTML=i.map((e=>Ki("value").t(e))).join("")}return e}async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=Q()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)}fetchRoomConfiguration(){return ad.sendIQ($p`
            <iq to="${this.get("jid")}" type="get" xmlns="jabber:client">
                <query xmlns="${Cr.NS.MUC_OWNER}"/>
            </iq>`)}sendConfiguration(e=[]){const t=$p`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Cr.NS.MUC_OWNER}">
                    <x xmlns="${Cr.NS.XFORM}" type="submit">
                        ${e.map((e=>Cr.Builder.fromString(e.outerHTML)))}
                    </x>
                </query>
            </iq>`;return ad.sendIQ(t)}onCommandError(e){const{__:t}=uo;Y.fatal(e);const n=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:n,type:"error"})}getNickOrJIDFromCommandArgs(e){const{__:t}=uo;if(xp.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const n=this.parseTextForReferences(e)[1];if(!n.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(n.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const s=n.pop().value,i=e.split(s,2)[1];if(!i||i.startsWith(" "))return s;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}}validateRoleOrAffiliationChangeArgs(e,t){const{__:n}=uo;if(!t){const t=n('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0}getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=uo.session.get("bare_jid"),n=this.occupants.findWhere({jid:t});return this.verifyAffiliations(["owner"],n,!1)?e=e.concat(Ag).concat(yg):this.verifyAffiliations(["admin"],n,!1)&&(e=e.concat(yg)),this.verifyRoles(["moderator"],n,!1)?e=e.concat(Sg).concat($g):this.verifyRoles(["visitor","participant","moderator"],n,!1)||(e=e.concat($g)),e.sort(),Array.isArray(ad.settings.get("muc_disable_slash_commands"))?e.filter((e=>!ad.settings.get("muc_disable_slash_commands").includes(e))):e}verifyAffiliations(e,t,n=!0){const{__:s}=uo;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;const i=uo.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const n=t.get("affiliation");if(e.includes(n))return!0}if(n){const e=s("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1}verifyRoles(e,t,n=!0){const{__:s}=uo;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;const i=uo.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const n=t.get("role");if(e.includes(n))return!0}if(n){const e=s("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error",is_ephemeral:2e4})}return!1}getOwnRole(){return this.getOwnOccupant()?.get("role")}getOwnAffiliation(){return this.getOwnOccupant()?.get("affiliation")||"none"}getOwnOccupant(){return this.occupants.getOwnOccupant()}async setNickname(e){const t=Cr.getBareJidFromJid(this.get("jid"));ad.send($p`<presence xmlns="jabber:client"
                    id="${If()}"
                    from="${ad.connection.get().jid}"
                    to="${t}/${e}"></presence>`)}setRole(e,t,n,s,i){const r=$p`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Cr.NS.MUC_ADMIN}">
                    <item nick="${e.get("nick")}" role="${t}">
                        ${null!==n?$p`<reason>${n}</reason>`:""}
                    </item>
                </query>
            </iq>`;return ad.sendIQ(r).then(s).catch(i)}getOccupant(e){return xp.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)}getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))}getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))}getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,n)=>t.get(e)<n.get(e)?-1:t.get(e)>n.get(e)?1:0))}async updateMemberLists(e){const t=this.get("jid"),n=await Promise.all(["member","admin","owner"].map((e=>Zg(e,t)))),s=n.reduce(((e,t)=>t instanceof Error?(Y.error(t),e):[...t,...e]),[]);await ep(t,np(!0,!1,e,s)),await this.occupants.fetchMembers()}async getNicknameFromHook(){return await ad.hook("getNicknameForMUC",this,null)}async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||await this.getNicknameFromHook()||uo.exports.getDefaultMUCNickname())&&il(this,{nick:e},{silent:!0}),e}async getReservedNick(){const e=$p`
            <iq to="${this.get("jid")}" type="get" xmlns="jabber:client">
                <query xmlns="${Cr.NS.DISCO_INFO}" node="x-roomuser-item"/>
            </iq>`,t=await ad.sendIQ(e,null,!1);if(xp.isErrorObject(t))throw t;const n=t?.querySelector('query[node="x-roomuser-item"] identity');return n?n.getAttribute("name"):null}async registerNickname(){const{__:e}=uo,t=this.get("nick"),n=this.get("jid");let s,i;try{s=await ad.sendIQ($p`<iq to="${n}" type="get" xmlns="jabber:client">
                    <query xmlns="${Cr.NS.MUC_REGISTER}"/>
                </iq>`)}catch(t){return Q()(`not-allowed[xmlns="${Cr.NS.STANZAS}"]`,t).length?i=e("You're not allowed to register yourself in this groupchat."):Q()(`registration-required[xmlns="${Cr.NS.STANZAS}"]`,t).length&&(i=e("You're not allowed to register in this groupchat because it's members-only.")),Y.error(t),i}const r=Q()("field required",s).map((e=>e.parentElement));if(r.length>1&&"muc#register_roomnick"!==r[0].getAttribute("var"))return Y.error(`Can't register the user register in the groupchat ${n} due to the required fields`);try{await ad.sendIQ($p`<iq to="${n}" type="set" xmlns="jabber:client">
                    <query xmlns="${Cr.NS.MUC_REGISTER}">
                        <x xmlns="${Cr.NS.XFORM}" type="submit">
                            <field var="FORM_TYPE">
                                <value>http://jabber.org/protocol/muc#register</value>
                            </field>
                            <field var="muc#register_roomnick">
                                <value>${t}</value>
                            </field>
                        </x>
                    </query>
                </iq>`)}catch(e){const t=await Wf(e);throw"service-unavailable"===t?.name?Y.error("Can't register your nickname in this groupchat, it doesn't support registration."):"bad-request"===t?.name?Y.error("Can't register your nickname in this groupchat, invalid data form supplied."):Y.error(e),t}}async unregisterNickname(){if("unregister"===ad.settings.get("auto_register_muc_nickname"))try{await ad.disco.supports(Cr.NS.MUC_REGISTER,this.get("jid"))&&await this.sendUnregistrationIQ()}catch(e){Y.error(e)}}sendUnregistrationIQ(){const e=$p`
            <iq to="${this.get("jid")}" type="set" xmlns="jabber:client">
                <query xmlns="${Cr.NS.MUC_REGISTER}">
                    <remove/>
                </query>
            </iq>`;return ad.sendIQ(e).catch((e=>Y.error(e)))}updateOccupantsOnPresence(e){if("error"===e.type||!e.jid&&!e.nick&&!e.occupant_id)return!0;const t=this.occupants.findOccupant(e);if("unavailable"===e.type&&t&&!e.codes.includes(Lf.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(e.affiliation))return t.set({...e,presence:"offline"}),void t.destroy();const n="unavailable"!==e.type?"online":"offline",s=e.jid||"",i={...e,presence:n,jid:Cr.getBareJidFromJid(s)||t?.attributes?.jid,resource:Cr.getResourceFromJid(s)||t?.attributes?.resource};if(e.is_self){let t=!1;e.codes.includes(Lf.MUC_NICK_CHANGED_CODE)&&(t=!0,this.set("nick",e.nick)),this.features.get(Cr.NS.OCCUPANTID)&&this.get("occupant-id")!==e.occupant_id&&(t=!0,this.set("occupant_id",e.occupant_id)),t&&this.save()}t?t.save(i):this.occupants.create(i)}fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];e.codes.filter((e=>t.includes(e))).length&&this.refreshDiscoInfo()}isSameUser(e,t){const n=Cr.getBareJidFromJid(e),s=Cr.getBareJidFromJid(t),i=Cr.getResourceFromJid(e),r=Cr.getResourceFromJid(t);if(xp.isSameBareJID(e,t))return n!==this.get("jid")||i===r;return(n===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:n}))===(s===this.get("jid")?this.occupants.findOccupant({nick:r}):this.occupants.findOccupant({jid:s}))}async isSubjectHidden(){return(await ad.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))}async toggleSubjectHiddenState(){const e=this.get("jid"),t=await ad.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?ad.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):ad.user.settings.set("mucs_with_hidden_subject",[...t,e])}async handleSubjectChange(e){const t=uo.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const n=e.subject,s=e.nick;if(il(this,{subject:{author:s,text:e.subject||""}}),!e.is_delayed&&s){const i=t(n?"Topic set by %1$s":"Topic cleared by %1$s",s),r=this.messages.last();r?.get("nick")===e.nick&&"info"===r?.get("type")&&r?.get("message")===i||this.createMessage({message:i,nick:e.nick,type:"info",is_ephemeral:!0}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1}setSubject(e=""){ad.send($p`
            <message to="${this.get("jid")}" type="groupchat" xmlns="jabber:client">
                <subject>${e}</subject>
            </message>`)}ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))}isOwnMessage(e){let t;return t=e instanceof Element?e.getAttribute("from"):e instanceof uo.exports.MUCMessage?e.get("from"):e.from,Cr.getResourceFromJid(t)==this.get("nick")}getUpdatedMessageAttributes(e,t){const n={...super.getUpdatedMessageAttributes(e,t),...zs(t,["from_muc","occupant_id"])};if(this.isOwnMessage(t)){const s=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(n,{...zs(t,s)},{body:t.body}),e.get("received")||(n.received=(new Date).toISOString())}return n}async isJoined(){return this.isEntered()?(ad.connection.connected()||await new Promise((e=>ad.listen.once("reconnected",e))),ad.ping(`${this.get("jid")}/${this.get("nick")}`)):(Y.info(`isJoined: not pinging MUC ${this.get("jid")} since we're not entered`),!1)}async sendStatusPresence(e,t){if(this.session.get("connection_status")===Rg.ENTERED){const n=await uo.state.profile.constructPresence({...e,to:`${this.get("jid")}/${this.get("nick")}`},t?.map((e=>e?.tree()??e)));ad.send(n)}}async rejoinIfNecessary(){return this.isRAICandidate()?(Y.debug(`rejoinIfNecessary: not rejoining hidden MUC "${this.get("jid")}" since we're using RAI`),!0):await this.isJoined()?void 0:(this.rejoin(),!0)}async shouldShowErrorMessage(e){if("Decryption"===e.error_type){if("Message key not found. The counter was repeated or the key was not filled."===e.error_message)return!1;if("not-encrypted-for-this-device"===e.error_condition)return!1}else if("not-acceptable"===e.error_condition&&await this.rejoinIfNecessary())return!1;return super.shouldShowErrorMessage(e)}findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),n=e[`stanza_id ${this.get("jid")}`];return n?(t.reverse(),t.find((({attributes:e})=>"retracted"===e.moderated&&e.moderated_id===n&&e.moderated_by))):null}}async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_by_id","moderated_id","moderation_reason"];if("retracted"===e.moderated){const n={};n[`stanza_id ${this.get("jid")}`]=e.moderated_id;const s=this.messages.findWhere(n);return s?(s.save(zs(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const n=this.findDanglingModeration(e);if(n){const s=zs(n.attributes,t),i=Object.assign({dangling_moderation:!1},e,s);return delete i.id,n.save(i),!0}}return!1}getNotificationsText(){const{__:e}=uo,t=this.notifications.toJSON(),n=ad.settings.get("muc_show_info_messages").filter((e=>Lf.MUC_ROLE_CHANGES_LIST.includes(e))),s=ad.settings.get("muc_show_info_messages").filter((e=>Lf.MUC_TRAFFIC_STATES_LIST.includes(e)));return[...Lf.CHAT_STATES,...s,...n].reduce(((n,s)=>{const i=t[s];if(!i?.length)return n;const r=i.map((e=>this.getOccupant(e)?.getDisplayName()||e));if(1===r.length){if("composing"===s)return`${n}${e("%1$s is typing",r[0])}\n`;if("paused"===s)return`${n}${e("%1$s has stopped typing",r[0])}\n`;if(s===Jr)return`${n}${e("%1$s has gone away",r[0])}\n`;if("entered"===s)return`${n}${e("%1$s has entered the groupchat",r[0])}\n`;if("exited"===s)return`${n}${e("%1$s has left the groupchat",r[0])}\n`;if("op"===s)return`${n}${e("%1$s is now a moderator",r[0])}\n`;if("deop"===s)return`${n}${e("%1$s is no longer a moderator",r[0])}\n`;if("voice"===s)return`${n}${e("%1$s has been given a voice",r[0])}\n`;if("mute"===s)return`${n}${e("%1$s has been muted",r[0])}\n`}else if(r.length>1){let t;if(r.length>3)t=`${Array.from(r).slice(0,2).join(", ")} and others`;else{const n=r.pop();t=e("%1$s and %2$s",r.join(", "),n)}if("composing"===s)return`${n}${e("%1$s are typing",t)}\n`;if("paused"===s)return`${n}${e("%1$s have stopped typing",t)}\n`;if(s===Jr)return`${n}${e("%1$s have gone away",t)}\n`;if("entered"===s)return`${n}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===s)return`${n}${e("%1$s have left the groupchat",t)}\n`;if("op"===s)return`${n}${e("%1$s are now moderators",r[0])}\n`;if("deop"===s)return`${n}${e("%1$s are no longer moderators",r[0])}\n`;if("voice"===s)return`${n}${e("%1$s have been given voices",r[0])}\n`;if("mute"===s)return`${n}${e("%1$s have been muted",r[0])}\n`}return n}),"")}removeNotification(e,t){const n=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const s=Array.from(n[t]||[]);if(s.includes(e)){const n=s.indexOf(e);s.splice(n,1),this.notifications.set(t,Array.from(s))}}))}updateNotifications(e,t){const n=this.notifications.toJSON(),s=n[t]||[];if(s.includes(e))return;const i=(i,r)=>(i[r]=r===t?[...s,e]:(n[r]||[]).filter((t=>t!==e)),i),r=Lf.CHAT_STATES.reduce(i,{}),o=Lf.MUC_TRAFFIC_STATES_LIST.reduce(i,{}),a=Lf.MUC_ROLE_CHANGES_LIST.reduce(i,{});this.notifications.set(Object.assign(r,o,a)),setTimeout((()=>this.removeNotification(e,t)),1e4)}handleMUCPrivateMessage(e){if("chat"===e.type||null===e.type){const t=this.occupants.findOccupant(e);if(t)return t.queueMessage(e)}return!1}handleMetadataFastening(e){if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const n=t.get("ogp_metadata")||[];if(n.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const s=[...n,zs(e,Rr)];return t.save("ogp_metadata",s),!0}}return!1}handleMEPNotification(e){return!(e.from!==this.get("jid")||!e.activities)&&(e.activities?.forEach((t=>{const n=Object.assign(e,t);this.createMessage(n),ad.trigger("message",{attrs:n,chatbox:this})})),!!e.activities.length)}getDuplicateMessage(e){return e.activities?.length?this.messages.findWhere({type:"mep",msgid:e.msgid}):super.getDuplicateMessage(e)}async onMessage(e){if(xp.isErrorObject(e))return Y.error(e.message);const t=e;if("error"===t.type&&!await this.shouldShowErrorMessage(t))return;const n=this.getDuplicateMessage(t);if(n)"groupchat"===n.get("type")&&this.updateMessage(n,t);else if(!(t.receipt_id||t.is_marker||this.ignorableCSN(t)))if(this.handleMUCPrivateMessage(t)||this.handleMetadataFastening(t)||this.handleMEPNotification(t)||await this.handleModeration(t)||await this.handleRetraction(t)||await this.handleSubjectChange(t))t.nick&&this.removeNotification(t.nick,["composing","paused"]);else if(this.setEditable(t,t.time),t.chat_state&&this.updateNotifications(t.nick,t.chat_state),cp(t)){const e=await this.handleCorrection(t)||await this.createMessage(t);this.removeNotification(t.nick,["composing","paused"]),this.handleUnreadMessage(e)}}handleModifyError(e){const t=e.querySelector("error text")?.textContent;if(t)if(this.session.get("connection_status")===Rg.CONNECTING)this.setDisconnectionState(t);else{const e={type:"error",message:t,is_ephemeral:!0};this.createMessage(e)}}handleDisconnection(e){const{is_self:t,reason:n,actor:s}=e,i=e.codes.filter((e=>wg.includes(e)));if(!(t&&i.length>0))return;const{STATUS_CODE_MESSAGES:r}=uo.labels.muc,o=r[i[0]],a=i.includes("301")?Rg.BANNED:Rg.DISCONNECTED;this.setDisconnectionState(o,n,s?.nick,a)}getActionInfoMessage(e,t){const{nick:n,actor:s}=t,i=uo.__;return"301"===e?s?.nick?i("%1$s has been banned by %2$s",n,s.nick):i("%1$s has been banned",n):"303"===e?i("%1$s's nickname has changed",n):"307"===e?s?.nick?i("%1$s has been kicked out by %2$s",n,s.nick):i("%1$s has been kicked out",n):"321"===e?i("%1$s has been removed because of an affiliation change",n):"322"===e?i("%1$s has been removed for not being a member",n):void 0}createAffiliationChangeMessage(e){const t=uo.__,n=e._previousAttributes.affiliation;if(!n)return;const s=e.get("affiliation");"admin"===n&&pp(Lf.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===n&&pp(Lf.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===n&&pp(Lf.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===s&&"member"===n&&pp(Lf.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===s&&pp(Lf.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===s&&pp(Lf.AFFILIATION_CHANGES.ADMIN)||"owner"==s&&pp(Lf.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),s)})}createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const n=e._previousAttributes.role;"moderator"===n&&pp(Lf.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),Lf.MUC_ROLE_CHANGES.DEOP):"visitor"===n&&pp(Lf.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),Lf.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&pp(Lf.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),Lf.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&pp(Lf.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),Lf.MUC_ROLE_CHANGES.OP)}createInfoMessageFromPresence(e,t){const n=uo.__,s=t.is_self??!1;if(!pp||"110"===e||"100"===e&&!s)return;const{STATUS_CODE_MESSAGES:i}=uo.labels.muc,r=i[e],o={type:"info",is_ephemeral:!0,message:r,code:e};if(!s&&vg.includes(e)?(o.message=this.getActionInfoMessage(e,t),o.reason=t.reason):s&&bg.includes(e)&&(o.message=t.nick?n(r,t.nick):void 0),o.message){if("201"===e&&this.messages.findWhere(o))return;this.createMessage(o)}}createInfoMessage(e){if(!pp(e)||"110"===e)return;const{STATUS_CODE_MESSAGES:t}=uo.labels.muc,n=t[e];n&&this.createMessage({type:"info",is_ephemeral:!0,message:n,code:e})}setDisconnectionState(e,t,n,s=Rg.DISCONNECTED){this.session.save({connection_status:s,disconnection_actor:n,disconnection_message:e,disconnection_reason:t})}onNicknameClash(e){const t=uo.__;if(ad.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===uo.exports.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),n=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(n)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:Rg.NICKNAME_REQUIRED})}onErrorPresence(e){const t=uo.__,n=e.querySelector("error"),s=n.getAttribute("type"),i=Q()(`text[xmlns="${Cr.NS.STANZAS}"]`,n).pop()?.textContent;if("modify"===s)this.handleModifyError(e);else if("auth"===s){if(Q()(`not-authorized[xmlns="${Cr.NS.STANZAS}"]`,n).length&&(this.save({password_validation_message:i||t("Password incorrect")}),this.session.save({connection_status:Rg.PASSWORD_REQUIRED})),n.querySelector("registration-required")){const e=t("You are not on the member list of this groupchat.");this.setDisconnectionState(e,i)}else if(n.querySelector("forbidden")){const{STATUS_CODE_MESSAGES:e}=uo.labels.muc;this.setDisconnectionState(e[301],i,null,Rg.BANNED)}}else if("cancel"===s)if(n.querySelector("not-allowed")){const e=t("You are not allowed to create new groupchats.");this.setDisconnectionState(e,i)}else if(n.querySelector("not-acceptable")){const e=t("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,i)}else if(Q()(`gone[xmlns="${Cr.NS.STANZAS}"]`,n).length){const e=Q()(`gone[xmlns="${Cr.NS.STANZAS}"]`,n).pop()?.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:i}),this.session.save({connection_status:Rg.DESTROYED})}else if(n.querySelector("conflict"))this.onNicknameClash(e);else if(n.querySelector("item-not-found")){const e=t("This groupchat does not (yet) exist.");this.setDisconnectionState(e,i)}else if(n.querySelector("service-unavailable")){const e=t("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,i)}else if(n.querySelector("remote-server-not-found")){const e=t("Remote server not found");this.setDisconnectionState(e,i)}else if(n.querySelector("forbidden")){const e=t("You're not allowed to enter this groupchat");this.setDisconnectionState(e,i)}else{const e=t("An error happened while trying to enter this groupchat");this.setDisconnectionState(e,i)}}onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===t?.getAttribute("type")&&t?.querySelector("resource-constraint")&&this.session.get("connection_status")===Rg.DISCONNECTED&&this.rejoin()}}async onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);const t=await async function(e,t){await t.initialized;const n=e.getAttribute("from"),s=e.getAttribute("type"),i=Lg.getResourceFromJid(n),r={from:n,nick:i,type:s,muc_jid:Lg.getBareJidFromJid(n),occupant_id:Gg(e,t),status:e.querySelector(":scope > status")?.textContent??void 0,show:e.querySelector(":scope > show")?.textContent??void 0,image_hash:Pg(`presence > x[xmlns="${Lg.NS.VCARDUPDATE}"] photo`,e).pop()?.textContent,hats:Pg(`presence > hats[xmlns="${Lg.NS.MUC_HATS}"] hat`,e).map((e=>({title:e.getAttribute("title"),uri:e.getAttribute("uri")}))),...Hg(e,"presence"),...Kg(e,i)};return await ad.hook("parseMUCPresence",e,r)}(e,this);t.codes.forEach((async e=>{if(this.createInfoMessageFromPresence(e,t),t.is_self&&bg.includes(e)&&(this.save("nick",t.nick),"303"===e&&ad.settings.get("auto_register_muc_nickname")&&await ad.disco.supports(Cr.NS.MUC_REGISTER,this.get("jid"))))try{await this.registerNickname()}catch(e){Y.error(e),Y.error("Error: could not register new nickname")}})),t.is_self?(this.onOwnPresence(t),"none"!==this.getOwnRole()&&this.session.get("connection_status")===Rg.CONNECTING&&this.session.save("connection_status",Rg.CONNECTED)):this.updateOccupantsOnPresence(t)}async onOwnPresence(e){if(await this.occupants.fetched,"unavailable"===e.type)return void this.handleDisconnection(e);const t=this.session.get("connection_status");t!==Rg.ENTERED&&t!==Rg.CLOSING?(this.session.save("connection_status",Rg.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e);e.codes.includes("201")&&(this.get("auto_configure")?await this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):ad.settings.get("muc_instant_rooms")?await this.sendConfiguration().then((()=>this.refreshDiscoInfo())):ad.modal.show("converse-muc-config-modal",{model:this}))}isUserMentioned(e){const t=this.get("nick");if(e.get("references").length){return e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t)}return new RegExp(`\\b${t}\\b`).test(e.get("body"))}incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)}async clearUnreadMsgCounter(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&await this.sendMarkerForMessage(this.messages.last()),il(this,{has_activity:!1,num_unread:0,num_unread_general:0})}}const jp=Ep,{Strophe:Cp,stx:kp}=Lf.env;class Tp extends(jm(Fm(gm(ie.Model)))){async initialize(){this.lazy_load_vcard=!0,super.initialize(),await this.fetchMessages(),this.on("change:nick",(()=>this.setColor())),this.on("change:jid",(()=>this.setColor())),this.on("change:chat_state",(()=>Hf(this.get("jid"),this.get("chat_state"))))}defaults(){return{hats:[],presence:"offline",show:void 0,states:[],hidden:!0,num_unread:0,message_type:"chat"}}save(e,t,n){let s;return null==e?super.save(e,t,n):("object"==typeof e?(s=e,n=t):(s={})[e]=t,s.occupant_id&&(s.id=s.occupant_id),super.save(s,n))}getMessagesCacheKey(){return`converse.muc-private-msgs-${this.get("occupant_id")||this.get("jid")||this.get("nick")}-${uo.session.get("bare_jid")}`}getMessagesCollection(){return new hg}async onMessage(e){if(Rf.isErrorObject(e)){const{stanza:t,message:n}=e;return t&&Y.error(t),Y.error(n)}const t=e;if("error"===t.type&&!await this.shouldShowErrorMessage(t))return;const n=this.getDuplicateMessage(t);if(n)this.updateMessage(n,t);else if(!await this.handleRetraction(t)&&(this.setEditable(t,t.time),cp(t))){const e=await this.handleCorrection(t)||await this.createMessage(t);this.handleUnreadMessage(e)}}getDisplayName(){return this.get("nick")||this.get("jid")||""}getAssignableRoles(){let e=ad.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?xg:[]),"moderator"===this.get("role")?xg.filter((t=>!e.includes(t))):[]}getAssignableAffiliations(){let e=ad.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?_g:[]),"owner"===this.get("affiliation")?_g.filter((t=>!e.includes(t))):"admin"===this.get("affiliation")?_g.filter((t=>!["owner","admin",...e].includes(t))):[]}isMember(){return["admin","owner","member"].includes(this.get("affiliation"))}isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")}isSelf(){return this.get("states").includes("110")}async getOutgoingMessageAttributes(e){const t=Rf.getUniqueId(),n=e?.body,s=n?Rf.shortnamesToUnicode(n):void 0,i=this.collection.chatroom,r=i.getOwnOccupant();return e=Object.assign({},e,{body:s,from:r.get("from"),fullname:uo.state.profile.get("fullname"),id:t,jid:this.get("jid"),message:s,msgid:t,nick:r.get("nickname"),origin_id:t,sender:"me",time:(new Date).toISOString(),to:this.get("from")??`${i.get("jid")}/${this.get("nick")}`,type:"chat"},await Rf.getMediaURLsMetadata(n)),e=await ad.hook("getOutgoingMessageAttributes",this,e)}async createMessageStanza(e){const t=await super.createMessageStanza(e);return t.cnode(kp`<x xmlns="${Cp.NS.MUC}#user"/>`).root(),t}isChatMessage(e){return e.get("type")===this.get("message_type")}}const Op=Tp,{u:Np}=Lf.env;class Mp extends ie.Collection{constructor(e,t){super(e,Object.assign({comparator:lp},t)),this.chatroom=null}get model(){return Op}initialize(){this.on("change:nick",(()=>this.sort())),this.on("change:role",(()=>this.sort()))}static getAutoFetchedAffiliationLists(){const e=ad.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]}create(e,t){return e.id||e instanceof ie.Model||(e.id=e.occupant_id||If()),super.create(e,t)}async fetchMembers(){if(!["member","admin","owner"].includes(this.getOwnOccupant()?.get("affiliation")))return;const e=Mp.getAutoFetchedAffiliationLists();if(0===e.length)return;const t=this.chatroom.get("jid"),n=await Promise.all(e.map((e=>Zg(e,t)))),s=n.reduce(((e,t)=>t instanceof Error?e:[...t,...e]),[]),i=e.filter((t=>!Np.isErrorObject(n[e.indexOf(t)]))),r=s.map((e=>e.jid)).filter((e=>void 0!==e)),o=s.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e)),a=this.filter((e=>i.includes(e.get("affiliation"))&&!o.includes(e.get("nick"))&&!r.includes(e.get("jid")))),c=uo.session.get("bare_jid");a.forEach((e=>{e.get("jid")!==c&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),s.forEach((e=>{const t=this.findOccupant(e);t?t.save(e):this.create(e)})),ad.trigger("membersFetched")}findOccupant(e){if(e.occupant_id)return this.get(e.occupant_id);const t=e.jid&&Cr.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||e.nick&&this.findWhere({nick:e.nick})}getOwnOccupant(){return this.findOccupant({jid:uo.session.get("bare_jid"),occupant_id:this.chatroom.get("occupant_id")})}}const Ip=Mp,{Strophe:Rp,u:Dp}=Lf.env;class zp extends(jm(Fm(pm(gm(ip))))){defaults(){return{bookmarked:!1,hidden:Ys()&&!ad.settings.get("singleton"),message_type:"chat",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:Yr}}constructor(e,t){super(e,t),this.disable_mam=!1}async initialize(){super.initialize(),this.initialized=re();const e=this.get("jid");this.setPresence(e),await this.setModelContact(e),this.on("change:chat_state",(()=>Hf(this.get("jid"),this.get("chat_state")))),this.on("change:hidden",(()=>this.get("hidden")&&this.setChatState(Gr))),await this.fetchMessages(),await ad.trigger("chatBoxInitialized",this,{synchronous:!0}),this.initialized.resolve()}async setPresence(e){await ad.waitUntil("presencesInitialized");const{presences:t}=uo.state;this.presence=t.get(e)||t.create({jid:e}),this.presence.on("change:show",(e=>this.onPresenceChanged(e)))}async onMessage(e){if(Dp.isErrorObject(e)){const{stanza:t,message:n}=e;return t&&Y.error(t),Y.error(n)}const t=e,n=this.getDuplicateMessage(t);if(n)this.updateMessage(n,t);else if(!this.handleReceipt(t)&&!this.handleChatMarker(t)&&!await this.handleRetraction(t)&&(this.setEditable(t,t.time),t.chat_state&&"them"===t.sender&&this.notifications.set("chat_state",t.chat_state),Dp.shouldCreateMessage(t))){const e=await this.handleCorrection(t)||await this.createMessage(t);this.notifications.set({chat_state:null}),this.handleUnreadMessage(e)}}onPresenceChanged(e){const{__:t}=uo,n=e.get("show"),s=this.getDisplayName();let i;"offline"===n?i=t("%1$s has gone offline",s):"away"===n?i=t("%1$s has gone away",s):"dnd"===n?i=t("%1$s is busy",s):"online"===n&&(i=t("%1$s is online",s)),i&&this.createMessage({message:i,type:"info",is_ephemeral:!0})}async close(){ad.connection.connected()&&(this.setChatState(Gr),Hf(this.get("jid"),this.get("chat_state"))),await super.close()}getDisplayName(){if(this.contact){const e=this.contact.getDisplayName({no_jid:!0});if(e)return e}return this.vcard?this.vcard.getDisplayName():this.get("jid")}isSameUser(e,t){return Dp.isSameBareJID(e,t)}handleChatMarker(e){if(Rp.getBareJidFromJid(e.to)!==uo.session.get("bare_jid"))return!1;if(e.is_markable)return!this.contact||["none","to",void 0].includes(this.contact.get("subscription"))||e.is_archived||e.is_carbon||Ff(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),n=`marker_${e.marker}`;return t&&!t.get(n)&&t.save({field_name:(new Date).toISOString()}),!0}}async getOutgoingMessageAttributes(e){const t=!!this.get("composing_spoiler"),n=Dp.getUniqueId(),s=e?.body,i=s?Dp.shortnamesToUnicode(s):void 0;return e=Object.assign({},e,{body:i,from:uo.session.get("jid"),fullname:uo.state.profile.get("fullname"),id:n,is_spoiler:t,jid:this.get("jid"),message:i,msgid:n,nick:this.get("nickname"),origin_id:n,sender:"me",time:(new Date).toISOString(),type:this.get("message_type")},await Dp.getMediaURLsMetadata(s)),e=await ad.hook("getOutgoingMessageAttributes",this,e)}canPostMessages(){return!0}isChatMessage(e){const t=e.get("type");return t===this.get("message_type")||"normal"===t}}const Lp=zp;const Pp=class extends km{async initialize(){super.initialize(),this.initialized=re(),this.on("change:type",(()=>this.setContact())),await this.setContact(),await ad.trigger("messageInitialized",this,{synchronous:!0}),this.initialized.resolve()}setContact(){if(["chat","normal"].includes(this.get("type")))return this.setModelContact(Cr.getBareJidFromJid(this.get("from")))}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")}};class Up extends ie.Collection{constructor(){super(),this.comparator="time",this.model=Pp,this.fetched=null,this.chatbox=null}}const Bp=Up,qp={chats:{async create(e,t){if("string"==typeof e){if(t&&!t?.fullname){const n=await ad.contacts.get(e);t.fullname=n?.attributes?.fullname}const n=ad.chats.get(e,t,!0);return n||void Y.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.map((async n=>{const s=await ad.contacts.get(e);return t.fullname=s?.attributes?.fullname,ad.chats.get(n,t,!0).maybeShow()}))):(Y.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,n){if("string"==typeof e){const s=await ad.chats.get(e,t,!0);return s?s.maybeShow(n):s}if(Array.isArray(e))return Promise.all(e.map((e=>ad.chats.get(e,t,!0).then((e=>e&&e.maybeShow(n))))).filter((e=>e)));const s="chats.open: You need to provide at least one JID";throw Y.error(s),new Error(s)},async get(e,t={},n=!1){async function s(e){let s=await ad.chatboxes.get(e);return!s&&n?s=await ad.chatboxes.create(e,t,uo.exports.ChatBox):(s=s&&s.get("type")===Yr?s:null,s&&Object.keys(t).length&&s.save(t)),s}if(await ad.waitUntil("chatBoxesFetched"),void 0===e){return(await ad.chatboxes.get()).filter((e=>e.get("type")===Yr))}return"string"==typeof e?s(e):Promise.all(e.map((e=>s(e))))}}};Lf.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){ad.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0});const e={ChatBox:Lp,Message:Pp,Messages:Bp,handleMessageStanza:Lm};Object.assign(uo,e),Object.assign(uo.exports,e),Object.assign(ad,qp),Wl.registry.add(Yr,Lp),Rm(),addEventListener("hashchange",Rm),ad.listen.on("chatBoxesFetched",Dm),ad.listen.on("presencesInitialized",zm),ad.listen.on("connected",(()=>Pm())),ad.listen.on("reconnected",(()=>Pm()))}});const{Strophe:Fp,u:Hp}=Lf.env;class Gp extends ie.Model{get idAttribute(){return"jid"}initialize(e,t){super.initialize(),this.waitUntilFeaturesDiscovered=re(),this.waitUntilItemsFetched=re(),this.dataforms=new ie.Collection;let n=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=Dc(n,"session"),this.features=new ie.Collection,n=`converse.features-${this.get("jid")}`,this.features.browserStorage=Dc(n,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new ie.Collection,n=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=Dc(n,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.items=new ie.Collection,n=`converse.items-${this.get("jid")}`,this.items.browserStorage=Dc(n,"session"),this.identities=new ie.Collection,n=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=Dc(n,"session"),this.fetchFeatures(t)}async getIdentity(e,t){return await this.waitUntilItemsFetched,this.identities.findWhere({category:e,type:t})}async getFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this}onFeatureAdded(e){e.entity=this,ad.trigger("serviceDiscovered",e)}onFieldAdded(e){e.entity=this,ad.trigger("discoExtensionFieldDiscovered",e)}async fetchFeatures(e){if(e.ignore_cache)await this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);if(t&&0===t.length||null===t)await this.queryInfo();else{await new Promise((e=>this.fetch({success:e,error:e}))),await new Promise((e=>this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered"),e()},error:e}))),await new Promise((e=>this.identities.fetch({add:!0,success:e,error:e})));const e=this.get("items");Array.isArray(e)?await Promise.all(e.map((async e=>await ad.disco.entities.get(e,!0)))):await this.queryForItems(),this.waitUntilItemsFetched.resolve()}}}async queryInfo(){let e;try{e=await ad.disco.info(this.get("jid"),null)}catch(e){if(Hp.isElement(e)){const t=await Wf(e);"item-not-found"!==t.message&&Y.error(`Error querying disco#info for ${this.get("jid")}: ${t.message}`),this.waitUntilFeaturesDiscovered.resolve(t),this.waitUntilItemsFetched.resolve(t)}else null===e?Y.error(`Timeout for disco#info query for ${this.get("jid")}`):Y.error(`Error querying disco#info for ${this.get("jid")}: ${e}`),this.waitUntilFeaturesDiscovered.resolve(e),this.waitUntilItemsFetched.resolve(e);return}this.onInfo(e)}onDiscoItems(e){const t=Q()(`query[xmlns="${Fp.NS.DISCO_ITEMS}"] item`,e),n=[];t.forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid");let s=uo.state.disco_entities.get(t);if(s){const e=s.get("parent_jids");s.set({parent_jids:[...e,this.get("jid")]})}else s=ad.disco.entities.create({jid:t,parent_jids:[this.get("jid")],name:e.getAttribute("name")});n.push(s.get("jid"))})),this.save({items:n})}async queryForItems(){if(0===this.identities.where({category:"server"}).length)return;const e=await ad.disco.items(this.get("jid"));this.onDiscoItems(e)}async onInfo(e){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),Q()(`x[type="result"][xmlns="${Fp.NS.XFORM}"]`,e).forEach((e=>{const t={};Q()("field",e).forEach((e=>{t[e.getAttribute("var")]={value:e.querySelector("value")?.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${Fp.NS.DISCO_ITEMS}"]`)&&await this.queryForItems(),this.waitUntilItemsFetched.resolve(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),Q()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{this.fields.create({var:t.getAttribute("var"),value:t.querySelector("value")?.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}const Wp=Gp;class Vp extends ie.Collection{constructor(){super(),this.model=Wp}fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,n){Y.error(n),t(new Error("Could not fetch disco entities"))}})}))}}const Kp=Vp,{Strophe:Jp,$iq:Yp}=Lf.env,Xp={disco:{stream:{async getFeature(e,t){await ad.waitUntil("streamFeaturesAdded");const n=uo.state.stream_features;if(!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==n||ad.connection.connected())return n.findWhere({name:e,xmlns:t});{const n=`Tried to get feature ${e} ${t} but stream_features has been torn down`;Y.warn(n)}}},own:{identities:{add(e,t,n,s){const i=uo.state.disco;for(var r=0;r<i._identities.length;r++)if(i._identities[r].category==e&&i._identities[r].type==t&&i._identities[r].name==n&&i._identities[r].lang==s)return!1;i._identities.push({category:e,type:t,name:n,lang:s})},clear(){uo.state.disco._identities=[]},get:()=>uo.state.disco._identities},features:{add(e){const t=uo.state.disco;for(let n=0;n<t._features.length;n++)if(t._features[n]==e)return!1;t._features.push(e)},clear(){uo.state.disco._features=[]},get:()=>uo.state.disco._features}},info(e,t){const n={xmlns:Jp.NS.DISCO_INFO};t&&(n.node=t);const s=Yp({from:ad.connection.get().jid,to:e,type:"get"}).c("query",n);return ad.sendIQ(s)},items(e,t){const n={xmlns:Jp.NS.DISCO_ITEMS};return t&&(n.node=t),ad.sendIQ(Yp({from:ad.connection.get().jid,to:e,type:"get"}).c("query",n))},entities:{async get(e,t=!1){await ad.waitUntil("discoInitialized");const n=uo.state.disco_entities;if(!e)return n;if(void 0===n)return void Y.warn(`Tried to look up entity ${e} but disco_entities has been torn down`);const s=n.get(e);return s||!t?s:ad.disco.entities.create({jid:e})},async items(e){const t=await ad.disco.entities.get(e);await t.waitUntilItemsFetched;return uo.state.disco_entities.filter((t=>t.get("parent_jids")?.includes(e)))},create:(e,t)=>uo.state.disco_entities.create(e,t)},features:{async get(e,t){if(!t)throw new TypeError("api.disco.features.get: You need to provide an entity JID");const n=await ad.disco.entities.get(t,!0);if(void 0===uo.state.disco_entities&&!ad.connection.connected())return Y.warn(`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`),[];const s=await ad.disco.entities.items(t),i=[n.getFeature(e),...s.map((t=>t.getFeature(e)))];return(await Promise.all(i)).filter((e=>e instanceof Object))},async has(e,t){if(!t)throw new TypeError("api.disco.feature.has: You need to provide an entity JID");const n=await ad.disco.entities.get(t,!0);if(!n)return Y.warn(`api.disco.has: could not get entity for ${t}`),!1;if(void 0===uo.state.disco_entities&&!ad.connection.connected())return Y.warn(`Tried to check if ${t} supports feature ${e}`),!1;if(await n.getFeature(e))return!0;const s=await ad.disco.entities.items(t),i=await Promise.all(s.map((t=>t.getFeature(e))));return i.map((e=>e instanceof Object)).includes(!0)}},supports(e,t){try{return ad.disco.features.has(e,t)}catch(e){return Y.error(e),!1}},async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await ad.waitUntil("discoInitialized");let t=await ad.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=re()),t.waitUntilItemsFetched.isPending||(t.waitUntilItemsFetched=re()),t.queryInfo()):t=await ad.disco.entities.create({jid:e},{ignore_cache:!0}),t.waitUntilItemsFetched},async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await ad.waitUntil("discoInitialized");let t=await ad.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await ad.waitUntil("discoInitialized");let t=await ad.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,n){const s=await ad.disco.entities.get(n,!0);if(void 0!==s||ad.connection.connected())return s.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${n} but _converse.disco_entities has been torn down`;Y.warn(t)}}}},{Strophe:Qp,$iq:Zp}=Lf.env;async function ev(){ad.disco.own.identities.add("client","web","Converse"),ad.disco.own.features.add(Qp.NS.CHATSTATES),ad.disco.own.features.add(Qp.NS.DISCO_INFO),ad.disco.own.features.add(Qp.NS.ROSTERX),ad.disco.own.features.add(Qp.NS.CARBONS),ad.trigger("addClientFeatures"),ad.connection.get().addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:Qp.NS.DISCO_INFO};t&&(n.node=t);const s=Zp({type:"result",id:e.getAttribute("id")}),i=e.getAttribute("from");return null!==i&&s.attrs({to:i}),s.c("query",n),uo.state.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),s.c("identity",t).up()})),uo.state.disco._features.forEach((e=>s.c("feature",{var:e}).up())),ad.send(s.tree()),!0}(e)),Qp.NS.DISCO_INFO,"iq","get",null,null);const e=new uo.exports.DiscoEntities;Object.assign(uo,{disco_entities:e}),Object.assign(uo.state,{disco_entities:e});const t=`converse.disco-entities-${uo.session.get("bare_jid")}`;e.browserStorage=Dc(t,"session");const n=await e.fetchEntities(),s=uo.session.get("domain");0!==n.length&&n.get(s)||ad.disco.entities.create({jid:s},{ignore_cache:!0}),ad.trigger("discoInitialized")}function tv(){if(!uo.state.stream_features){const e=`converse.stream-features-${uo.session.get("bare_jid")}`;ad.promises.add("streamFeaturesAdded");const t=new ie.Collection;t.browserStorage=Dc(e,"session"),Object.assign(uo,{stream_features:t}),Object.assign(uo.state,{stream_features:t})}}function nv(){ad.trigger("streamFeaturesAdded")}function sv(){tv(),Array.from(ad.connection.get().features.childNodes).forEach((e=>{uo.state.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),nv()}function iv(){const{disco_entities:e}=uo.state;e?.forEach((e=>e.features.clearStore())),e?.forEach((e=>e.identities.clearStore())),e?.forEach((e=>e.dataforms.clearStore())),e?.forEach((e=>e.fields.clearStore())),e?.clearStore(),delete uo.state.disco_entities,Object.assign(uo,{disco_entities:void 0})}const{Strophe:rv}=Lf.env;Lf.plugins.add("converse-disco",{initialize(){Object.assign(ad,Xp),ad.promises.add("discoInitialized"),ad.promises.add("streamFeaturesAdded");const e={DiscoEntity:Wp,DiscoEntities:Kp};Object.assign(uo,e),Object.assign(uo.exports,e);const t={_identities:[],_features:[]};Object.assign(uo,{disco:t}),Object.assign(uo.state,{disco:t}),ad.listen.on("userSessionInitialized",(async()=>{tv(),uo.state.connfeedback.get("connection_status")===rv.Status.ATTACHED&&(await new Promise(((e,t)=>uo.state.stream_features.fetch({success:e,error:t}))),nv())})),ad.listen.on("beforeResourceBinding",sv),ad.listen.on("reconnected",ev),ad.listen.on("connected",ev),ad.listen.on("beforeTearDown",(async()=>{ad.promises.add("streamFeaturesAdded");const{stream_features:e}=uo.state;e&&(await e.clearStore(),delete uo.state.stream_features,Object.assign(uo,{stream_features:void 0}))})),ad.listen.on("will-reconnect",iv),ad.listen.on("clearSession",iv)}});const ov={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],ep(e=Array.isArray(e)?e:[e],t)),get:(e,t)=>Zg(e,t)}};Lf.AFFILIATION_CHANGES=Cg,Lf.AFFILIATION_CHANGES_LIST=kg,Lf.MUC_TRAFFIC_STATES=Tg,Lf.MUC_TRAFFIC_STATES_LIST=Og,Lf.MUC_ROLE_CHANGES=Ng,Lf.MUC_ROLE_CHANGES_LIST=Mg,Lf.MUC={INFO_CODES:Ig},Lf.MUC_NICK_CHANGED_CODE=zg,Lf.ROOM_FEATURES=Dg,Lf.ROOMSTATUS=Rg;const{Strophe:av}=Lf.env;av.addNamespace("MUC_ADMIN",av.NS.MUC+"#admin"),av.addNamespace("MUC_OWNER",av.NS.MUC+"#owner"),av.addNamespace("MUC_REGISTER","jabber:iq:register"),av.addNamespace("MUC_ROOMCONF",av.NS.MUC+"#roomconfig"),av.addNamespace("MUC_USER",av.NS.MUC+"#user"),av.addNamespace("MUC_HATS","urn:xmpp:hats:0"),av.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),Lf.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco"],initialize(){const{__:e,___:t}=uo;if(ad.settings.extend({allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!0,colorize_username:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[...Lf.MUC.INFO_CODES.visibility_changes,...Lf.MUC.INFO_CODES.self,...Lf.MUC.INFO_CODES.non_privacy_changes,...Lf.MUC.INFO_CODES.muc_logging_changes,...Lf.MUC.INFO_CODES.nickname_changes,...Lf.MUC.INFO_CODES.disconnected,...Lf.MUC.INFO_CODES.affiliation_changes,...Lf.MUC.INFO_CODES.join_leave_events,...Lf.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_subscribe_to_rai:!1}),ad.promises.add(["roomsAutoJoined"]),ad.settings.get("locked_muc_domain")&&"string"!=typeof ad.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");Lf.env.muc_utils={computeAffiliationsDelta:np},Object.assign(ad,Jl),Object.assign(ad.rooms,ov);const n={muc:{STATUS_CODE_MESSAGES:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created"),210:t("Your nickname has been automatically set to %1$s"),301:e("You have been banned from this groupchat"),303:t("Your nickname has been changed to %1$s"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because it has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down"),333:e("You have exited this groupchat due to a technical problem")}}};Object.assign(uo.labels,n),Object.assign(uo,n),fp(),addEventListener("hashchange",fp);const s={ChatRoom:jp,ChatRoomMessage:dg,ChatRoomMessages:hg,ChatRoomOccupant:Op,ChatRoomOccupants:Ip};Object.assign(uo,s);const i={MUC:jp,MUCMessage:dg,MUCMessages:hg,MUCOccupant:Op,MUCOccupants:Ip,getDefaultMUCNickname:gp,isInfoVisible:pp,onDirectMUCInvitation:mp};Object.assign(uo.exports,i),Object.assign(uo,i),ad.chatboxes.registry.add(Xr,jp),ad.settings.get("allow_muc_invitations")&&(ad.listen.on("connected",dp),ad.listen.on("reconnected",dp)),ad.listen.on("addClientFeatures",(()=>ad.disco.own.features.add(`${av.NS.CONFINFO}+notify`))),ad.listen.on("addClientFeatures",bp),ad.listen.on("beforeResourceBinding",wp),ad.listen.on("beforeTearDown",yp),ad.listen.on("chatBoxesFetched",vp),ad.listen.on("disconnected",up),ad.listen.on("statusInitialized",_p),document.addEventListener("visibilitychange",hp)}}),Object.assign(Rf,{muc:{isChatRoom:function(e){return"chatroom"===e?.get("type")},setAffiliation:tp,getDefaultMUCService:async function(){let e=ad.settings.get("muc_domain")||uo.session.get("default_muc_service");if(!e){const t=uo.session.get("domain"),n=await ad.disco.entities.items(t);for(const t of n)if(await ad.disco.features.has(rp.NS.MUC,t.get("jid"))){e=t.get("jid"),uo.session.save({default_muc_service:e});break}}return e}}});const{Strophe:cv,stx:lv}=Lf.env;class dv extends ie.Collection{get idAttribute(){return"jid"}async initialize(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>Y.fatal(e))))),this.on("remove",this.leaveRoom,this),this.on("change:autojoin",this.onAutoJoinChanged,this),this.on("remove",((e,t)=>this.sendBookmarkStanza(t)),this);const{session:e}=uo,t=`converse.room-bookmarks${e.get("bare_jid")}`;this.fetched_flag=t+"fetched",zc(this,t),await this.fetchBookmarks(),ad.trigger("bookmarksInitialized",this)}static async checkBookmarksSupport(){const e=uo.session.get("bare_jid");if(!e)return!1;const t=await ad.disco.getIdentity("pubsub","pep",e);return ad.settings.get("allow_public_bookmarks")?!!t:ad.disco.supports(cv.NS.PUBSUB+"#publish-options",e)}constructor(){super([],{comparator:e=>e.get("name").toLowerCase()}),this.model=ag}async openBookmarkedRoom(e){if(ad.settings.get("muc_respect_autojoin")&&e.get("autojoin")){(await ad.rooms.create(e.get("jid"),{nick:e.get("nick"),password:e.get("password")})).maybeShow()}return e}fetchBookmarks(){const e=re();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e}setBookmark(e,t=!0,n={}){if(!e.jid)return Y.warn("No JID provided for setBookmark");let s=!1,i=this.get(e.jid);if(i){const t=Object.keys(e).reduce(((t,n)=>t||(e[n]??"")!==(i.attributes[n]??"")),!1);t&&(i.save(e,n),s=!0)}else t&&(i=this.create(e,n),s=!0);s&&this.sendBookmarkStanza(i).catch((t=>this.onBookmarkError(t,e)))}getPublishedItems(e,t){if(e===cv.NS.BOOKMARKS2){const e=t.get("extensions")??[];return lv`<item id="${t.get("jid")}">
                        <conference xmlns="${cv.NS.BOOKMARKS2}"
                                name="${t.get("name")||xh}"
                                autojoin="${t.get("autojoin")}">
                            ${t.get("nick")?lv`<nick>${t.get("nick")}</nick>`:""}
                            ${t.get("password")?lv`<password>${t.get("password")}</password>`:""}
                        ${e.length?lv`<extensions>${e.map((e=>Er.fromString(e)))}</extensions>`:""}
                        </conference>
                    </item>`}return lv`<item id="current">
                <storage xmlns="${cv.NS.BOOKMARKS}">
                ${this.map((e=>lv`<conference name="${e.get("name")}" autojoin="${e.get("autojoin")}"
                        jid="${e.get("jid")}">
                        ${e.get("nick")?lv`<nick>${e.get("nick")}</nick>`:""}
                        ${e.get("password")?lv`<password>${e.get("password")}</password>`:""}
                    </conference>`))}
                </storage>
            </item>`}async sendBookmarkStanza(e){const t=uo.session.get("bare_jid"),n=await ad.disco.supports(`${cv.NS.BOOKMARKS2}#compat`,t)?cv.NS.BOOKMARKS2:cv.NS.BOOKMARKS;return ad.pubsub.publish(null,n,this.getPublishedItems(n,e),{persist_items:!0,max_items:"max",send_last_published_item:"never",access_model:"whitelist"})}onBookmarkError(e,t){Y.error("Error while trying to add bookmark"),Y.error(e),this.get(t.jid)?.destroy()}async fetchBookmarksFromServer(e){const t=uo.session.get("bare_jid"),n=await ad.disco.supports(`${cv.NS.BOOKMARKS2}#compat`,t)?cv.NS.BOOKMARKS2:cv.NS.BOOKMARKS,s=lv`
            <iq type="get" from="${ad.connection.get().jid}" xmlns="jabber:client">
                <pubsub xmlns="${cv.NS.PUBSUB}">
                    <items node="${n}"/>
                </pubsub>
            </iq>`;ad.sendIQ(s).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))}markRoomAsBookmarked(e){const{chatboxes:t}=uo.state,n=t.get(e.get("jid"));n?.save("bookmarked",!0)}onAutoJoinChanged(e){e.get("autojoin")?this.openBookmarkedRoom(e):this.leaveRoom(e)}async leaveRoom(e){const t=await ad.rooms.get(e.get("jid"));t?.close()}async setBookmarksFromStanza(e){const t=await async function(e){let t,n;const s=uo.session.get("bare_jid");return await ad.disco.supports(`${cg.NS.BOOKMARKS2}#compat`,s)?(t=cg.NS.BOOKMARKS2,n=`items[node="${t}"] item conference`):(t=cg.NS.BOOKMARKS,n=`items[node="${t}"] item storage[xmlns="${t}"] conference`),lg(n,e).map((e=>{const n=t===cg.NS.BOOKMARKS2?e.parentElement.getAttribute("id"):e.getAttribute("jid");return{jid:n,name:e.getAttribute("name")||n,autojoin:["1","true"].includes(e.getAttribute("autojoin")),nick:e.querySelector("nick")?.textContent??"",password:e.querySelector("password")?.textContent??"",extensions:Array.from(e.querySelector("extensions")?.children??[]).map((e=>e.outerHTML))}}))}(e);t.forEach((e=>{const t=this.get(e.jid);t?t.save(e):this.create(e)}))}async onBookmarksReceived(e,t){if(await this.setBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,"true"),void 0!==e)return e.resolve()}async onBookmarksReceivedError(e,t){if(null===t){const{__:t}=uo;Y.error("Error: timeout while fetching bookmarks"),ad.alert("error",t("Timeout Error"),[t("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]),e?.reject(new Error("Could not fetch bookmarks"))}else{const{errors:n}=Lf.env;await Wf(t)instanceof n.ItemNotFoundError?(window.sessionStorage.setItem(this.fetched_flag,"true"),e?.resolve()):(Y.error("Error while fetching bookmarks"),t&&Y.error(t),e?.reject(new Error("Could not fetch bookmarks")))}}async getUnopenedBookmarks(){await ad.waitUntil("bookmarksInitialized"),await ad.waitUntil("chatBoxesFetched");const{chatboxes:e}=uo.state;return this.filter((t=>!e.get(t.get("jid"))))}}const uv=dv;function hv(e){return ad.waitUntil("bookmarksInitialized").then((()=>uo.state.bookmarks.setBookmarksFromStanza(e))).catch((e=>Y.fatal(e))),!0}const{waitUntil:fv}=ml,mv={set:async(e,t=!0,n={})=>(await fv("bookmarksInitialized")).setBookmark(e,t,n),get:async e=>(await fv("bookmarksInitialized")).get(e)},gv={bookmarks:mv},{Strophe:pv}=Lf.env;pv.addNamespace("BOOKMARKS","storage:bookmarks"),pv.addNamespace("BOOKMARKS2","urn:xmpp:bookmarks:1"),Lf.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],initialize(){ad.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),ad.promises.add("bookmarksInitialized"),Object.assign(ad,gv);const e={Bookmark:ag,Bookmarks:uv};Object.assign(uo,e),Object.assign(uo.exports,e),ad.listen.on("getNicknameForMUC",((e,t)=>{return t||(n=e.get("jid"),ad.settings.get("allow_bookmarks")?uo.state.bookmarks?.get(n)?.get("nick"):null);var n})),ad.listen.on("parseMUCPresence",((e,t)=>(t.is_self&&t.codes.includes("303")&&ad.bookmarks.get(t.muc_jid).then((e=>{e||Y.warn("parseMUCPresence: no bookmark returned");const{nick:n,muc_jid:s}=t;ad.bookmarks.set({jid:s,nick:n,autojoin:e?.get("autojoin")??!0,password:e?.get("password")??"",name:e?.get("name")??"",extensions:e?.get("extensions")??[]})})),t))),ad.listen.on("enteredNewRoom",(async({attributes:e})=>{const{jid:t,nick:n,password:s,name:i}=e;await ad.bookmarks.set({jid:t,autojoin:!0,nick:n,...s?{password:s}:{},...i?{name:i}:{}})})),ad.listen.on("leaveRoom",(async({attributes:e})=>{const{jid:t}=e;await ad.bookmarks.set({jid:t,autojoin:!1},!1,{silent:!0})})),ad.listen.on("addClientFeatures",(()=>{ad.settings.get("allow_bookmarks")&&ad.disco.own.features.add(pv.NS.BOOKMARKS+"+notify")})),ad.listen.on("clearSession",(()=>{const{state:e}=uo;e.bookmarks&&(e.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(e.bookmarks.fetched_flag),delete e.bookmarks)})),ad.listen.on("connected",(async()=>{const e=uo.session.get("bare_jid"),t=ad.connection.get();t.addHandler(hv,pv.NS.BOOKMARKS,"message","headline",null,e),t.addHandler(hv,pv.NS.BOOKMARKS2,"message","headline",null,e),await Promise.all([ad.waitUntil("chatBoxesFetched")]),async function(){ad.settings.get("allow_bookmarks")&&await uv.checkBookmarksSupport()&&(uo.state.bookmarks=new uo.exports.Bookmarks,Object.assign(uo,{bookmarks:uo.state.bookmarks}))}()}))}});const{Strophe:vv}=Lf.env;class bv extends ie.Model{get idAttribute(){return"jid"}getDisplayName(){return vv.xmlunescape(this.get("name"))}}const yv=bv,{stx:_v,u:wv}=Lf.env;class Sv extends ie.Collection{get idAttribute(){return"jid"}constructor(){super(),this.model=yv}async initialize(){const{session:e}=uo,t=`converse.blocklist-${e.get("bare_jid")}`;this.fetched_flag=`${t}-fetched`,zc(this,t),this.on("add",this.rejectContactRequest),await this.fetchBlocklist(),ad.trigger("blocklistInitialized",this)}async rejectContactRequest(e){const t=(await ad.waitUntil("rosterContactsFetched")).get(e.get("jid"));if(t?.get("requesting")){const e=await ad.chats.get(t.get("jid"));e?.close(),t.unauthorize().destroy()}}fetchBlocklist(){const e=re();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBlocklistFromServer(e),e}async fetchBlocklistFromServer(e){const t=_v`<iq xmlns="jabber:client"
            type="get"
            id="${wv.getUniqueId()}"><blocklist xmlns="urn:xmpp:blocking"/></iq>`;try{this.onBlocklistReceived(e,await ad.sendIQ(t))}catch(t){return Y.error(t),void e.resolve()}}async onBlocklistReceived(e,t){if(Array.from(t.querySelectorAll("blocklist item")).forEach((e=>{const t=e.getAttribute("jid"),n=this.get(t);n?n.save({jid:t}):this.create({jid:t})})),window.sessionStorage.setItem(this.fetched_flag,"true"),void 0!==e)return e.resolve()}}const Av=Sv,{Strophe:xv,stx:$v,u:Ev}=Lf.env;const{waitUntil:jv}=ml,Cv={blocklist:{get:async()=>await jv("blocklistInitialized"),async add(e,t=!0){const n=await jv("blocklistInitialized"),s=Array.isArray(e)?e:[e];return t&&await async function(e){const t=Array.isArray(e)?e:[e],n=$v`
        <iq xmlns="jabber:client" type="set" id="${Ev.getUniqueId()}">
            <block xmlns="${xv.NS.BLOCKING}">
                ${t.map((e=>$v`<item jid="${e}"/>`))}
            </block>
        </iq>`;await Bl.sendIQ(n)}(s),s.forEach((e=>n.create({jid:e}))),n},async remove(e,t=!0){const n=await jv("blocklistInitialized"),s=Array.isArray(e)?e:[e];return t&&await async function(e){const t=Array.isArray(e)?e:[e],n=$v`
        <iq xmlns="jabber:client" type="set" id="${Ev.getUniqueId()}">
            <unblock xmlns="${xv.NS.BLOCKING}">
                ${t.map((e=>$v`<item jid="${e}"/>`))}
            </unblock>
        </iq>`;await Bl.sendIQ(n)}(s),n.remove(s),n}}};class kv extends ie.Model{initialize(){super.initialize(),this.set({text:"",type:"items",state:"online"})}}const{$pres:Tv}=Lf.env;function Ov(e){const t=uo.state.roster,n=t?.get(e.get("jid"));n?.save({num_unread:e.get("num_unread")})}let Nv;function Mv(){if(Nv){ad.connection.get().deleteHandler(Nv),Nv=null}}async function Iv(){await(uo.state.presences?.clearStore())}async function Rv(){if(await Iv(),ei(uo)){const e=uo.state.roster;e&&(e.data?.destroy(),await e.clearStore(),delete uo.state.roster,Object.assign(uo,{roster:void 0}))}}function Dv(e){e?ad.trigger("rosterReadyAfterReconnection"):function(){const e=new uo.exports.RosterContacts;Object.assign(uo,{roster:e}),Object.assign(uo.state,{roster:e});const t=uo.session.get("bare_jid");let n=`converse.contacts-${t}`;zc(e,n);const s=new kv;Object.assign(uo,{roster_filter:s}),Object.assign(uo.state,{roster_filter:s}),s.id=`_converse.rosterfilter-${t}`,zc(s,s.id),s.fetch(),n=`converse-roster-model-${t}`,e.data=new ie.Model,e.data.id=n,zc(e.data,n),e.data.fetch(),ad.trigger("rosterInitialized",e)}();uo.state.roster.onConnected(),function(){Mv();const e=ad.connection.get();Nv=e.addHandler((e=>(uo.state.roster.presenceHandler(e),!0)),null,"presence",null)}(),async function(e=!1){const t=ad.connection.get();e&&(t.send_initial_presence=!0);const n=uo.state.roster;try{await n.fetchRosterContacts(),ad.trigger("rosterContactsFetched",n)}catch(e){Y.error(e)}finally{t.send_initial_presence&&(ad.user.presence.send(),uo.state.profile.save({presence:"online"}))}}(!ad.connection.get().restored)}async function zv(e){if(e)!ad.connection.get().hasResumed()&&await Iv();else{const e=new uo.exports.Presences;Object.assign(uo,{presences:e}),Object.assign(uo.state,{presences:e});const t=uo.session.get("bare_jid");zc(e,`converse.presences-${t}`,"session"),await new Promise((t=>e.fetch({success:t,error:t})))}ad.trigger("presencesInitialized",e)}function Lv(){const{chatboxes:e}=uo.state;e.on("change:num_unread",Ov),e.on("add",(e=>{e.get("type")===Yr&&e.setModelContact(e.get("jid"))}))}function Pv(){uo.state.roster.on("add",(e=>{const t=uo.state.chatboxes.findWhere({jid:e.get("jid")});t?.setModelContact(e.get("jid"))}))}function Uv(e,t){const n=Tv({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),ad.send(n)}const{Strophe:Bv,sizzle:qv}=Lf.env;Bv.addNamespace("BLOCKING","urn:xmpp:blocking"),Lf.plugins.add("converse-blocklist",{dependencies:["converse-disco"],initialize(){const e={Blocklist:Av,BlockedEntity:yv};Object.assign(uo.exports,e),Object.assign(ad,Cv),ad.promises.add(["blocklistInitialized"]),ad.listen.on("cachedRoster",(async e=>{const t=uo.session.get("domain");if(await ad.disco.supports(Bv.NS.BLOCKING,t)){const t=await ad.blocklist.get(),n=e.filter((e=>e.get("requesting")));n.forEach((async e=>{t.get(e.get("jid"))&&(Uv(e.get("jid")),e.destroy())}))}})),ad.listen.on("getErrorAttributesForMessage",((e,t)=>{if(e.errors.find((e=>"blocked"===e.name&&e.xmlns===`${Bv.NS.BLOCKING}:errors`))){const{__:e}=uo;t.error=e("You are blocked from sending messages.")}return t})),ad.listen.on("connected",(()=>{ad.connection.get().addHandler((e=>{const t=uo.session.get("bare_jid"),n=e.getAttribute("from");if(Bv.getBareJidFromJid(n??t)!=t)return Y.warn(`Received a blocklist push stanza from a suspicious JID ${n}`),!0;const s=qv(`block[xmlns="${Bv.NS.BLOCKING}"] item`,e).map((e=>e.getAttribute("jid")));s.length&&ad.blocklist.add(s,!1);const i=qv(`unblock[xmlns="${Bv.NS.BLOCKING}"] item`,e).map((e=>e.getAttribute("jid")));return i.length&&ad.blocklist.remove(i,!1),!0}),Bv.NS.BLOCKING,"iq","set")})),ad.listen.on("clearSession",(()=>{const{state:e}=uo;e.blocklist&&(e.blocklist.clearStore({silent:!0}),window.sessionStorage.removeItem(e.blocklist.fetched_flag),delete e.blocklist)})),ad.listen.on("discoInitialized",(async()=>{const e=uo.session.get("domain");await ad.disco.supports(Bv.NS.BLOCKING,e)&&(uo.state.blocklist=new uo.exports.Blocklist)}))}});const Fv={tokens:{get(e){const t=ad.connection.get();return t?"rid"===e.toLowerCase()?t.rid||t._proto.rid:"sid"===e.toLowerCase()?t.sid||t._proto.sid:void 0:null}}},Hv="converse.bosh-session";let Gv;async function Wv(e,t){if(t.success)return t;const{automatic:n}=t;return await async function(){const e=(await async function(){const e=Hv;Gv||(Gv=new ie.Model({id:e}),Gv.browserStorage=Dc(e,"session"),await new Promise((e=>Gv.fetch({success:e,error:e}))));let t=uo.session.get("jid");if(t)Gv.get("jid")!==t&&(t=await Yc(t),Gv.clear({silent:!0}),Gv.save({jid:t}));else{const e=Gv.get("jid");e&&await Yc(e)}return Gv}()).get("jid"),t=ad.connection.get();if(e&&t._proto instanceof Cr.Bosh)try{return t.restore(e,t.onConnectStatusChanged),!0}catch(t){return!Xs()&&Y.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1}()?{...t,success:!0}:ad.settings.get("authentication")!==qr||n&&!ad.settings.get("auto_login")?t:(function(){if(!ad.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=ad.connection.get(),t=new XMLHttpRequest;t.open("GET",ad.settings.get("prebind_url"),!0),t.setRequestHeader("Accept","application/json, text/javascript"),t.onload=async function(n){if(t.status>=200&&t.status<400){const n=JSON.parse(t.responseText),s=await Yc(n.jid);e.attach(s,n.sid,n.rid,e.onConnectStatusChanged,Tr)}else t.onerror(n)},t.onerror=function(){ad.connection.destroy(),ad.trigger("noResumeableBOSHSession",uo)},t.send()}(),{...t,success:!0})}function Vv(){void 0!==Gv&&Gv.save({jid:uo.session.get("jid")})}function Kv(){if(void 0===Gv){const e=Hv;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else Gv.destroy(),Gv=void 0}Lf.plugins.add("converse-bosh",{enabled:()=>!uo.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){ad.settings.extend({bosh_service_url:void 0,prebind_url:null}),Object.assign(ad,Fv),ad.listen.on("clearSession",Kv),ad.listen.on("setUserJID",Vv),ad.listen.on("login",Wv),ad.listen.on("addClientFeatures",(()=>ad.disco.own.features.add(Cr.NS.BOSH)))}});const{Strophe:Jv,stx:Yv}=Lf.env;function Xv(e,t){return e.sort(((e,n)=>e[t]>n[t]?-1:1))}async function Qv(e){const t=Yv`<c
        xmlns="${Jv.NS.CAPS}"
        hash="sha-1"
        node="https://conversejs.org"
        ver="${await async function(){const e=uo.api.disco.own.identities.get(),t=uo.api.disco.own.features.get();e.length>1&&(Xv(e,"category"),Xv(e,"type"),Xv(e,"lang"));let n=e.reduce(((e,t)=>`${e}${t.category}/${t.type}/${t?.lang??""}/${t.name}<`),"");return t.sort(),n=t.reduce(((e,t)=>`${e}${t}<`),n),Yh(await crypto.subtle.digest("SHA-1",Jh(n)))}()}"></c>`;return e.root().cnode(t).up(),e}const{Strophe:Zv}=Lf.env;Zv.addNamespace("CAPS","http://jabber.org/protocol/caps"),Lf.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){ad.listen.on("constructedPresence",((e,t)=>Qv(t))),ad.listen.on("constructedMUCPresence",((e,t)=>Qv(t)))}});class eb extends ie.Collection{constructor(e,t){super(e,Object.assign({comparator:"time_opened"},t))}onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),ad.trigger("chatBoxesFetched")}onConnected(e){if(e)return;zc(this,`converse.chatboxes-${uo.session.get("bare_jid")}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)})}createModel(e,t){if(!e.type)throw new Error("You need to specify a type of chatbox to be created");return new(ad.chatboxes.registry.get(e.type))(e,t)}}const tb=eb,{Strophe:nb}=Lf.env;Lf.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){let e;ad.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(ad,{chatboxes:Wl}),Object.assign(uo,{ChatBoxes:tb}),Object.assign(uo.exports,{ChatBoxes:tb}),ad.listen.on("addClientFeatures",(()=>{ad.disco.own.features.add(nb.NS.MESSAGE_CORRECT),ad.disco.own.features.add(nb.NS.HTTPUPLOAD),ad.disco.own.features.add(nb.NS.OUTOFBAND)})),ad.listen.on("pluginsInitialized",(()=>{e=new uo.exports.ChatBoxes,Object.assign(uo,{chatboxes:e}),Object.assign(uo.state,{chatboxes:e}),ad.trigger("chatBoxesInitialized")})),ad.listen.on("presencesInitialized",(t=>e.onConnected(t))),ad.listen.on("reconnected",(()=>e.forEach((e=>e.onReconnection())))),ad.listen.on("clearSession",ql),ad.listen.on("chatBoxClosed",(()=>{Ys()&&uo.state.chatboxes.find((e=>e.get("jid")))?.maybeShow()}))}});const{Strophe:sb,u:ib}=Lf.env;function rb(e){const t=Q()(`command[xmlns="${sb.NS.ADHOC}"]`,e).pop(),n=t.querySelector("note");return{...hm(e),sessionid:t.getAttribute("sessionid"),note:n?{text:n.textContent,type:n.getAttribute("type")}:null,actions:Array.from(t.querySelector("actions")?.children??[]).map((e=>e.nodeName.toLowerCase()))}}const{Strophe:ob,$iq:ab,u:cb,stx:lb}=Lf.env,db={adhoc:{async getCommands(e){try{return t=await ad.disco.items(e,ob.NS.ADHOC),Q()(`query[xmlns="${sb.NS.DISCO_ITEMS}"][node="${sb.NS.ADHOC}"] item`,t).map(ib.getAttributes)}catch(t){return null===t?Y.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(Y.error(`Error while fetching ad-hoc commands for ${e}`),Y.error(t)),[]}var t},async fetchCommandForm(e,t){const n=ab({type:"set",to:e}).c("command",{xmlns:ob.NS.ADHOC,action:"execute",node:t});return rb(await ad.sendIQ(n))},async runCommand(e,t,n,s,i){const r=lb`<iq type="set" to="${e}" xmlns="jabber:client">
                    <command sessionid="${t}" node="${n}" action="${s}" xmlns="${ob.NS.ADHOC}">
                        ${["cancel","prev"].includes(s)?"":lb`
                            <x xmlns="${ob.NS.XFORM}" type="submit">
                                ${i.map((({name:e,value:t})=>lb`<field var="${e}"><value>${t}</value></field>`))}
                            </x>`}
                    </command>
                </iq>`,o=await ad.sendIQ(r,null,!1);if(null===o){Y.warn("A timeout occurred while trying to run an ad-hoc command");const{__:e}=uo;return{status:"error",note:e("A timeout occurred")}}cb.isErrorStanza(o)&&(Y.error("Error while trying to execute an ad-hoc command"),Y.error(o));const a=o.querySelector("command"),c=a?.getAttribute("status");return{status:c,..."executing"===c?rb(o):{},note:o.querySelector("note")?.textContent}}}},{Strophe:ub}=Lf.env;ub.addNamespace("ADHOC","http://jabber.org/protocol/commands"),Lf.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){Object.assign(this._converse.api,db)}});class hb extends ip{defaults(){return{bookmarked:!1,hidden:Ys()&&!ad.settings.get("singleton"),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:void 0,type:Qr}}constructor(e,t){super(e,t),this.disable_mam=!0}async initialize(){await super.initialize(),await this.fetchMessages(),ad.trigger("headlinesFeedInitialized",this)}canPostMessages(){return!1}isChatMessage(e){const t=e.get("type");return t===this.get("message_type")||"normal"===t}}const fb={headlines:{async get(e,t={},n=!1){async function s(e){let s=await ad.chatboxes.get(e);if(!s&&n){const{HeadlinesFeed:n}=uo.exports;s=await ad.chatboxes.create(e,t,n)}else s=s&&s.get("type")===Qr?s:null,s&&Object.keys(t).length&&s.save(t);return s}if(void 0===e){return(await ad.chatboxes.get()).filter((e=>e.get("type")===Qr))}return"string"==typeof e?s(e):Promise.all(e.map((e=>s(e))))}}};Lf.plugins.add("converse-headlines",{dependencies:["converse-chat"],initialize(){const e={HeadlinesFeed:hb};function t(){ad.connection.get()?.addHandler((e=>(async function(e){if(am(e)||cm(e)){const t=e.getAttribute("from");if(await ad.waitUntil("rosterInitialized"),t.includes("@")&&!uo.state.roster.get(t)&&!ad.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const n=await ad.chatboxes.create(t,{id:t,jid:t,type:Qr,from:t},hb),s=await Nm(e);await n.createMessage(s),ad.trigger("message",{chatbox:n,stanza:e,attrs:s})}}(e),!0)),null,"message")}Object.assign(uo,e),Object.assign(uo.exports,e),ad.listen.on("connected",t),ad.listen.on("reconnected",t),Object.assign(ad,fb),ad.chatboxes.registry.add(Qr,hb)}});class mb extends ie.Model{defaults(){return{msgid:If(),is_ephemeral:!1}}async fetchMissingMessages(){this.set("fetching",!0);const e={rsm:{before:this.get("before")??""},mam:{start:this.get("start")}};await Rf.mam.fetchArchivedMessages(this.collection.chatbox,e),this.destroy()}}const{NS:gb}=Cr,pb=Lf.env.utils;async function vb(e,t){if(pb.isElement(e)){const n=await Wf(e);if("feature-not-implemented"===n?.name)return void Y.warn(`Message Archive Management (XEP-0313) not supported by ${t.getAttribute("to")}`)}Y.error(`Error while trying to set archiving preferences for ${t.getAttribute("to")}.`),Y.error(t)}function bb(e,t){const n=Q()(`prefs[xmlns="${gb.MAM}"]`,e).pop();if(n.getAttribute("default")!==ad.settings.get("message_archiving")){const e=Yi({type:"set"}).c("prefs",{xmlns:gb.MAM,default:ad.settings.get("message_archiving")});Array.from(n.children).forEach((t=>e.cnode(t).up())),ad.sendIQ(e).then((()=>t.save({preferences:{default:ad.settings.get("message_archiving")}}))).catch((t=>uo.exports.onMAMError(t,e.tree())))}else t.save({preferences:{default:ad.settings.get("message_archiving")}})}function yb(e){const t=e.get("preferences")||{};if(e.get("var")===gb.MAM&&void 0!==ad.settings.get("message_archiving")&&t.default!==ad.settings.get("message_archiving")){const t=Yi({type:"get"}).c("prefs",{xmlns:gb.MAM});ad.sendIQ(t).then((t=>uo.exports.onMAMPreferences(t,e))).catch((e=>uo.exports.onMAMError(e,t.tree())))}}function _b(e){ad.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(Ab(e),e.save({prejoin_mam_fetched:!0}))}async function wb(e,t,n,s,i=!1){const r=e.get("type")===Xr,o=await Promise.all(t.messages.map((t=>r?Vg(t,e):Nm(t))));t.messages=o;const a={query:n,chatbox:e,messages:o};if(await ad.trigger("MAMResult",a,{synchronous:!0}),o.forEach((t=>e.queueMessage(t))),t.error){const n=t.error.retry_event_id=pb.getUniqueId();ad.listen.once(n,(()=>Sb(e,s,i))),async function(e,t){t instanceof pl&&((await e.createMessage({type:"error",message:t.message,retry_event_id:t.retry_event_id,is_ephemeral:2e4})).error=t)}(e,t.error)}}async function Sb(e,t={},n=!1){if(e.disable_mam)return;const s=e.get("type")===Xr,i=uo.session.get("bare_jid"),r=s?e.get("jid"):i;if(!await ad.disco.supports(gb.MAM,r))return;const o=ad.settings.get("archived_messages_page_size"),a={is_groupchat:s,rsm:{max:o,...t.rsm},mam:{with:e.get("jid"),...t.mam}},c=await ad.archive.query(a);if(await wb(e,c,a,t,n),c.rsm&&!c.complete){if(n)return"forwards"===n?t=c.rsm.next(o,t.rsm.before).query:"backwards"===n&&(t=c.rsm.previous(o,t.rsm.after).query),Sb(e,t,n);!async function(e,t,n){const s=await Promise.all(n.messages),i=e.get("type")===Xr,r=i?e.get("jid"):uo.session.get("bare_jid"),{rsm:o}=n,a=`stanza_id ${r}`,c=s.find((e=>e[a]===o.result.first)),l=new Date(c.time),d={before:o.result.first,start:t.mam?.start,template_hook:"getMessageTemplate",time:new Date(l.getTime()-1).toISOString()};if(e.messages.findWhere(d))return void Y.debug("Gap placeholder already exists, not recreating.");e.messages.add(new mb(d))}(e,t,c)}}function Ab(e){if(e.disable_mam)return;const t=e.getMostRecentMessage(),n=!!ad.settings.get("mam_request_all_pages")&&"backwards";return Sb(e,t?{mam:{start:t.get("time")},rsm:{before:""}}:{rsm:{before:""}},n)}const{Strophe:xb,$build:$b}=Lf.env;xb.addNamespace("RSM","http://jabber.org/protocol/rsm");const Eb=["after","before","index","max"],jb=e=>Number(e),Cb=e=>e.toString(),kb={after:Cb,before:Cb,count:jb,first:Cb,index:jb,last:Cb,max:jb},Tb=Object.keys(kb);class Ob{static getQueryParameters(e={}){return Eb.reduce(((t,n)=>(void 0!==e[n]&&(t[n]=e[n]),t)),{})}static parseXMLResult(e){const t={};for(var n=0;n<Tb.length;n++){const s=Tb[n],i=e.getElementsByTagName(s)[0];qs(i)||null===i||(t[s]=kb[s](xb.getText(i)),"first"==s&&(t.index=kb.index(i.getAttribute("index"))))}return t}constructor(e={}){this.query=Ob.getQueryParameters(e),this.result=e.xml?Ob.parseXMLResult(e.xml):{}}toXML(){const e=$b("set",{xmlns:xb.NS.RSM});return Eb.reduce(((e,t)=>qs(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}toString(){return xb.serialize(this.toXML())}next(e,t){const n=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new Ob(n)}previous(e,t){const n=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new Ob(n)}}const{NS:Nb}=Cr,{stx:Mb,u:Ib}=Lf.env,Rb={archive:{async query(e={}){if(!ad.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");let t;if(e&&e.is_groupchat){if(!e.mam?.with)throw new Error('You need to specify a "with" value containing the groupchat JID, when querying groupchat messages.');t=e.mam.with}const n=!e.is_groupchat&&e.mam?.with||null,s=uo.session.get("bare_jid"),i=t||s;if(!await ad.disco.supports(Nb.MAM,i))return Y.warn(`Did not fetch MAM archive for ${i} because it doesn't support ${Nb.MAM}`),{messages:[]};const{start:r,end:o}=["start","end"].reduce(((t,n)=>{if(e.mam?.[n]){const s=H()(e.mam[n]);if(!s.isValid())throw new TypeError(`archive.query: invalid date provided for: ${n}`);t[n]=s.toISOString()}return t}),{start:null,end:null}),a=ad.connection.get(),c=e.rsm?new Ob(e.rsm):{},l=Ib.getUniqueId(),d=Mb`
                <iq id="${Ib.getUniqueId()}"
                        ${t?Er.unsafeXML(`to="${Cr.xmlescape(t)}"`):""}
                        type="set"
                        xmlns="jabber:client">
                    <query queryid="${l}" xmlns="${Nb.MAM}">
                        ${n||r||o?Mb`
                            <x type="submit" xmlns="${Nb.XFORM}">
                                <field type="hidden" var="FORM_TYPE"><value>${Nb.MAM}</value></field>
                                ${n?Mb`<field var="with"><value>${n}</value></field>`:""}
                                ${r?Mb`<field var="start"><value>${r}</value></field>`:""}
                                ${o?Mb`<field var="end"><value>${o}</value></field>`:""}
                            </x>`:""}
                        ${Object.keys(c.query??{}).length?Er.fromString(c.toString()):""}
                    </query>
                </iq>`,u=[],h=a.addHandler((t=>{const n=Q()(`message > result[xmlns="${Nb.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==l)return!0;const i=t.getAttribute("from")||s;if(e.is_groupchat){if(i!==e.mam?.with)return Y.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(i!==s)return Y.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return u.push(t),!0}),Nb.MAM);let f;const m=ad.settings.get("message_archiving_timeout"),g=await ad.sendIQ(d,m,!1);if(null===g){const{__:e}=uo,t=e("Timeout while trying to fetch archived messages.");return Y.error(t),f=new pl(t),{messages:u,error:f}}if(Ib.isErrorStanza(g)){const{__:e}=uo,t=e("An error occurred while querying for archived messages.");return Y.error(t),Y.error(g),f=new Error(t),{messages:u,error:f}}let p;a.deleteHandler(h);const v=g&&Q()(`fin[xmlns="${Nb.MAM}"]`,g).pop(),b="true"===v?.getAttribute("complete"),y=Q()(`set[xmlns="${Nb.RSM}"]`,v).pop();return y&&(p=new Ob({...e.rsm,xml:y})),{messages:u,rsm:p,complete:b}}}},{NS:Db}=Cr;Lf.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){ad.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!1,message_archiving:void 0,message_archiving_timeout:6e4}),Object.assign(ad,Rb);const e={onMAMError:vb,onMAMPreferences:bb,handleMAMResult:wb,MAMPlaceholderMessage:mb};Object.assign(uo,e),Object.assign(uo.exports,e),ad.listen.on("addClientFeatures",(()=>ad.disco.own.features.add(Db.MAM))),ad.listen.on("serviceDiscovered",yb),ad.listen.on("chatRoomViewInitialized",(({model:e})=>{ad.settings.get("muc_show_logs_before_join")&&(_b(e),e.features.on("change:mam_enabled",(()=>_b(e))))})),ad.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&Ab(e))),ad.listen.on("chatReconnected",(e=>{[Xr,Yr].includes(e.get("type"))&&Ab(e)})),ad.listen.on("afterMessagesFetched",(e=>{e.get("type")===Yr&&Ab(e),function(e){if(e.messages.length){const t=`stanza_id ${e.get("type")===Xr?e.get("jid"):uo.session.get("bare_jid")}`,n=e.getOldestMessage();if(!n)return;const s={before:n.get(t),template_hook:"getMessageTemplate",time:new Date(new Date(n.get("time")).getTime()-1).toISOString()};if(e.messages.findWhere(s))return void Y.debug("Gap placeholder already exists, not recreating.");e.messages.add(new mb(s))}}(e)}))}}),Object.assign(Rf,{mam:{fetchArchivedMessages:Sb}});const{Strophe:zb,$iq:Lb}=Lf.env;let Pb,Ub;function Bb(){document.hidden||ad.ping(null,5e3)}function qb(e){Pb=new Date;const t=e.getAttribute("from"),n=e.getAttribute("id"),s=Lb({type:"result",to:t,id:n});return ad.sendIQ(s),!0}function Fb(){!function(){const e=ad.connection.get();e.disco&&ad.disco.own.features.add(zb.NS.PING),e.addHandler(qb,zb.NS.PING,"iq","get")}(),ad.connection.get()?.addHandler((()=>{if(ad.settings.get("ping_interval")>0)return Pb=new Date,!0})),clearInterval(Ub),Ub=setInterval(Gb,1e3)}function Hb(){clearInterval(Ub)}function Gb(){if(Xs()||!ad.connection.authenticated())return;const e=ad.settings.get("ping_interval");if(e>0){const t=new Date;Pb=Pb??t,(t.valueOf()-Pb.valueOf())/1e3>e&&ad.ping()}}const{Strophe:Wb,$iq:Vb,u:Kb}=Lf.env,Jb={async ping(e,t){if(!ad.connection.authenticated())return Y.debug("Not pinging when we know we're not authenticated"),null;var n;n=new Date,Pb=n;const s=uo.session.get("bare_jid");e=e||Wb.getDomainFromJid(s);const i=Vb({type:"get",to:e,id:Kb.getUniqueId("ping")}).c("ping",{xmlns:Wb.NS.PING}),r=await ad.sendIQ(i,t||1e4,!1);return null===r?(Y.warn(`Timeout while pinging ${e}`),e===Wb.getDomainFromJid(s)&&ad.connection.reconnect(),!1):!Kb.isErrorStanza(r)||(Y.error(`Error while pinging ${e}`),Y.error(r),!1)}},{Strophe:Yb}=Lf.env;Yb.addNamespace("PING","urn:xmpp:ping"),Lf.plugins.add("converse-ping",{initialize(){ad.settings.extend({ping_interval:60}),Object.assign(ad,Jb),ad.listen.on("connected",Fb),ad.listen.on("reconnected",Fb),ad.listen.on("disconnected",Hb),document.addEventListener("visibilitychange",Bb)}});const{Strophe:Xb,stx:Qb}=Lf.env,Zb={pubsub:{config:{async get(e,t){if(!t)throw new Error("api.pubsub.config.get: Node value required");const n=uo.session.get("bare_jid"),s=uo.session.get("jid"),i=Qb`
                    <iq xmlns="jabber:client"
                        from="${s}"
                        type="get"
                        to="${e||n}">
                    <pubsub xmlns="${Xb.NS.PUBSUB}"><configure node="${t}"/></pubsub>
                    </iq>`;let r;try{r=await ad.sendIQ(i)}catch(e){throw await Wf(e)}return hm(r).fields.reduce(((e,t)=>{if(t.var.startsWith("pubsub#")){const n=t.var.replace(/^pubsub#/,""),s="boolean"===t.type?t.checked:t.value??null;e[n]=s}return e}),{})},async set(e,t,n){if(!t)throw new Error("api.pubsub.config.set: Node value required");const s=uo.session.get("bare_jid"),i=e||s,r={...await ad.pubsub.config.get(i,t),...n},o=Qb`
                    <iq xmlns="jabber:client"
                        from="${s}"
                        type="set"
                        to="${i}">
                    <pubsub xmlns="${Xb.NS.PUBSUB}#owner">
                        <configure node="${t}">
                            <x xmlns="${Xb.NS.XFORM}" type="submit">
                                <field var="FORM_TYPE" type="hidden">
                                    <value>${Xb.NS.PUBSUB}#nodeconfig</value>
                                </field>
                                ${Object.entries(r).map((([e,t])=>Qb`<field var="${e}"><value>${t}</value></field>`))}
                            </x>
                        </configure>
                    </pubsub>
                    </iq>`;try{await ad.sendIQ(o)}catch(e){throw await Wf(e)}return r}},async publish(e,t,n,s,i=!0){if(!t)throw new Error("api.pubsub.publish: node value required");if(!n)throw new Error("api.pubsub.publish: item value required");const r=uo.session.get("bare_jid"),o=e||r,a=Qb`
                <iq xmlns="jabber:client"
                    from="${r}"
                    type="set"
                    to="${o}">
                <pubsub xmlns="${Xb.NS.PUBSUB}">
                    <publish node="${t}">${n}</publish>
                    ${s?Qb`<publish-options>
                    <x xmlns="${Xb.NS.XFORM}" type="submit">
                        <field var="FORM_TYPE" type="hidden">
                            <value>${Xb.NS.PUBSUB}#publish-options</value>
                        </field>
                        ${Object.entries(s).map((([e,t])=>Qb`<field var="pubsub#${e}"><value>${t}</value></field>`))}
                    </x></publish-options>`:""}
                </pubsub>
                </iq>`;if(o===r){if(!(await ad.disco.getIdentity("pubsub","pep",r)||await ad.disco.getIdentity("pubsub","pep",Xb.getDomainFromJid(r))))return Y.warn("api.pubsub.publish: Not publishing via PEP because it's not supported!"),void Y.warn(a)}if(!(await ad.disco.supports(Xb.NS.PUBSUB+"#publish-options",o)||o===r&&await ad.disco.supports(Xb.NS.PUBSUB+"#publish-options",Xb.getDomainFromJid(o)))&&i)return Y.warn("api.pubsub.publish: #publish-options not supported, refusing to publish item."),void Y.warn(a);try{await ad.sendIQ(a)}catch(e){const n=await Wf(e);if("conflict"!==n.name||"precondition-not-met"!==n.extra[Xb.NS.PUBSUB_ERROR])throw e;await ad.pubsub.config.set(o,t,s);try{await ad.sendIQ(a)}catch(e){if(Y.error(e),!i){const e=a.tree();e.querySelector("publish-options").outerHTML="",Y.warn("api.pubsub.publish: #publish-options precondition-not-met, publishing anyway."),await ad.sendIQ(e)}}}}}},{Strophe:ey,sizzle:ty}=Lf.env;ey.addNamespace("PUBSUB_ERROR",ey.NS.PUBSUB+"#errors"),Lf.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){const{api:e}=uo;Object.assign(uo.api,Zb),e.listen.on("parseErrorStanza",((e,t)=>{const n=ty(`error [xmlns="${ey.NS.PUBSUB_ERROR}"]`,e).pop();return n?{...t,[ey.NS.PUBSUB_ERROR]:n.nodeName}:t}))}});const ny={status:{async get(){await ad.waitUntil("statusInitialized");const e=uo.state.profile.get("show");if(e)return e;const t=uo.state.profile.get("status");return t||"online"},async set(e,t){if(!Object.keys(Ir).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");let n=Nr.includes(e)?e:void 0;"away"===e&&(n="dnd");const s={show:n,type:Mr.includes(e)?e:void 0};"string"==typeof t&&(s.status_message=t),await ad.waitUntil("statusInitialized"),uo.state.profile.save(s)},message:{get:async()=>(await ad.waitUntil("statusInitialized"),uo.state.profile.get("status_message")),async set(e){await ad.waitUntil("statusInitialized"),uo.state.profile.save({status_message:e})}}}},{Strophe:sy,$pres:iy,stx:ry}=Lf.env;class oy extends(jm(gm(ie.Model))){get idAttribute(){return"jid"}defaults(){return{groups:[],num_unread:0}}async initialize(e){this.lazy_load_vcard=!0,super.initialize(),this.initialized=re(),await this.setPresence();const{jid:t}=e;this.set({...e,jid:sy.getBareJidFromJid(t).toLowerCase(),user_id:sy.getNodeFromJid(t)}),this.listenTo(this.presence,"change:show",(()=>ad.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presence:change"))),this.listenTo(this.presence,"change:presence",(()=>ad.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:presence",(()=>this.trigger("presence:change"))),await ad.trigger("rosterContactInitialized",this,{synchronous:!0}),this.initialized.resolve()}async setPresence(){const e=this.get("jid");await ad.waitUntil("presencesInitialized");const{presences:t}=uo.state;this.presence=t.get(e)||t.create({jid:e})}getStatus(){return this.presence?.getStatus()||"offline"}openChat(){ad.chats.open(this.get("jid"),{},!0)}getDisplayName(e){return this.get("nickname")||this.vcard?.getDisplayName()||(e?.no_jid?null:this.get("jid"))}subscribe(e){return ad.user.presence.send({type:"subscribe",to:this.get("jid"),status:e}),this.save("ask","subscribe"),this}ackSubscribe(){ad.send(iy({type:"subscribe",to:this.get("jid")}))}ackUnsubscribe(){ad.send(iy({type:"unsubscribe",to:this.get("jid")})),this.sendRosterRemoveStanza(),this.destroy()}unauthorize(e){return Uv(this.get("jid"),e),this}authorize(e){return ad.send(ry`
            <presence
                to="${this.get("jid")}"
                type="subscribed"
                xmlns="jabber:client">
                    ${e&&""!==e?ry`<status>${e}</status>`:""}
            </presence>`),this.save({requesting:!1,subscription:"from"}),this}remove(e){const t=this.get("subscription");if("none"===t&&"subscribe"!==this.get("ask"))return void this.destroy();"subscribe"!==this.get("ask")&&"to"!==t||ad.send(iy({type:"unsubscribe",to:this.get("jid")})),e&&["from","both"].includes(t)&&this.unauthorize();const n=this.sendRosterRemoveStanza();return this.collection&&this.destroy(),n}async update(e){return this.save(e),await ad.sendIQ(ry`<iq xmlns="jabber:client" type="set">
                <query xmlns="${sy.NS.ROSTER}">
                    <item jid="${this.get("jid")}" name="${this.get("nickname")}">
                        ${this.get("groups")?.map((e=>ry`<group>${e}</group>`))}
                    </item>
                </query>
            </iq>`)}async sendRosterRemoveStanza(){const e=ry`<iq type="set" xmlns="jabber:client">
            <query xmlns="${sy.NS.ROSTER}">
                <item jid="${this.get("jid")}" subscription="remove"/>
            </query>
        </iq>`;return await ad.sendIQ(e)}isUnsaved(){return void 0===this.get("subscription")}}const ay=oy,{Strophe:cy,sizzle:ly,stx:dy,u:uy,Stanza:hy}=Lf.env;class fy extends ie.Collection{constructor(){super(),this.model=ay,this.data=null}initialize(){const e=`roster.state-${uo.session.get("bare_jid")}-${this.get("jid")}`;this.state=new ie.Model({id:e,collapsed_groups:[]}),zc(this.state,e),this.state.fetch(),ad.listen.on("chatBoxClosed",(e=>this.removeUnsavedContact(e)))}removeUnsavedContact(e){const t=this.get(e.get("jid"));t&&void 0===t.get("subscription")&&t.destroy()}onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()}registerRosterHandler(){ad.connection.get().addHandler((e=>(uo.state.roster.onRosterPush(e),!0)),cy.NS.ROSTER,"iq","set")}registerRosterXHandler(){let e=0;ad.connection.get().addHandler((t=>(setTimeout((()=>{const{roster:e}=uo.state;ad.connection.get().flush(),e.subscribeToSuggestedItems(t)}),e),e+=250*t.querySelectorAll("item").length,!0)),cy.NS.ROSTERX,"message",null)}async fetchRosterContacts(){const e=await new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,n)=>t(n)})}));if(uy.isErrorObject(e)&&(Y.error(e),uo.session.save("roster_cached",!1),this.data.save("version",void 0)),!uo.session.get("roster_cached"))return ad.connection.get().send_initial_presence=!0,uo.state.roster.fetchFromServer();ad.trigger("cachedRoster",e)}subscribeToSuggestedItems(e){return Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&this.addContact({jid:e.getAttribute("jid"),name:e.getAttribute("name"),subscription:"to"})})),!0}isSelf(e){return uy.isSameBareJID(e,ad.connection.get().jid)}sendContactAddIQ(e){const{jid:t,groups:n}=e,s=e.name?e.name:null,i=dy`
            <iq type="set" xmlns="jabber:client">
                <query xmlns="${cy.NS.ROSTER}">
                    <item jid="${t}" ${s?hy.unsafeXML(`name="${cy.xmlescape(s)}"`):""}>
                        ${n?.map((e=>dy`<group>${e}</group>`))}
                    </item>
                </query>
            </iq>`;return ad.sendIQ(i)}async addContact(e,t=!0,n=!0,s=""){const{jid:i,name:r}=e??{};if(!i||!uy.isValidJID(i))throw new Error("Invalid JID provided to addContact");if(await ad.waitUntil("rosterContactsFetched"),t)try{await this.sendContactAddIQ(e)}catch(e){Y.error(e);const{__:t}=uo;throw alert(t("Sorry, an error occurred while trying to add %1$s as a contact.",r||i)),e}const o=await this.create({ask:void 0,nickname:r,groups:[],requesting:!1,subscription:t?"none":void 0,...e},{sort:!1});return n&&o.subscribe(s),o}async subscribeBack(e,t,n="",s=""){const i=this.get(e),{RosterContact:r}=uo.exports;if(i instanceof r)i.authorize().subscribe();else{const i=ly(`nick[xmlns="${cy.NS.NICK}"]`,t).pop()?.textContent||void 0,o=await this.addContact({jid:e,name:i,groups:[],subscription:"from"});o instanceof r&&o.authorize(n).subscribe(s)}}onRosterPush(e){const t=e.getAttribute("id"),n=e.getAttribute("from"),s=uo.session.get("bare_jid");if(n&&n!==s)return void Y.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);ad.send(dy`<iq type="result" id="${t}" from="${ad.connection.get().jid}" xmlns="jabber:client" />`);const i=ly(`query[xmlns="${cy.NS.ROSTER}"]`,e).pop();this.data.save("version",i.getAttribute("ver"));const r=ly("item",i);if(r.length>1)throw Y.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===r.length)return Y.warn(e),void Y.warn('Received a roster push stanza without an "item" element.');this.updateContact(r.pop()),ad.trigger("rosterPush",e)}shouldUseRosterVersioning(){return ad.settings.get("enable_roster_versioning")&&this.data.get("version")&&ad.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")}async fetchFromServer(){const e=dy`
            <iq type="get" id="${uy.getUniqueId("roster")}" xmlns="jabber:client">
                <query xmlns="${cy.NS.ROSTER}"
                    ${this.shouldUseRosterVersioning()?hy.unsafeXML(`ver="${this.data.get("version")}"`):""}>
                </query>
            </iq>`,t=await ad.sendIQ(e,null,!1);if("result"===t.getAttribute("type")){const e=ly(`query[xmlns="${cy.NS.ROSTER}"]`,t).pop();if(e){const t=ly("item",e);if(!this.data.get("version")&&this.models.length){const e=t.map((e=>e.getAttribute("jid")));this.forEach((t=>!t.get("requesting")&&!e.includes(t.get("jid"))&&t.destroy()))}t.forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver"))}}else if(!uy.isServiceUnavailableError(t))return Y.error(t),void Y.error("Error while trying to fetch roster from the server");uo.session.save("roster_cached",!0),ad.trigger("roster",t)}updateContact(e){const t=e.getAttribute("jid"),n=this.get(t),s=e.getAttribute("subscription");if("remove"===s)return n?.destroy();const i=e.getAttribute("ask"),r=e.getAttribute("name"),o=[...new Set(ly("group",e).map((e=>e.textContent)))];n?n.save({subscription:s,ask:i,nickname:r,groups:o,requesting:null}):this.create({nickname:r,ask:i,groups:o,jid:t,subscription:s},{sort:!1})}createRequestingContact(e){const t={jid:cy.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:ly(`nick[xmlns="${cy.NS.NICK}"]`,e).pop()?.textContent||null};ad.trigger("contactRequest",this.create(t))}handleIncomingSubscription(e){const t=e.getAttribute("from"),n=cy.getBareJidFromJid(t),s=this.get(n);if(!ad.settings.get("allow_contact_requests")){const{__:e}=uo;Uv(t,e("This client does not allow presence subscriptions"))}ad.settings.get("auto_subscribe")?s&&"to"===s.get("subscription")?s.authorize():this.subscribeBack(n,e):s?("none"!==s.get("subscription")||"subscribe"===s.get("ask"))&&s.authorize():this.createRequestingContact(e)}handleOwnPresence(e){const t=e.getAttribute("from"),n=cy.getResourceFromJid(t),s=e.getAttribute("type"),{profile:i}=uo.state;if(ad.connection.get().jid!==t&&"unavailable"!==s&&(!0===ad.settings.get("synchronize_availability")||ad.settings.get("synchronize_availability")===n)){const t=e.querySelector("show")?.textContent;i.save({show:t,presence:"online"},{silent:!0});const n=e.querySelector("status")?.textContent;n&&i.save({status_message:n})}uo.session.get("jid")===t&&"unavailable"===s&&ad.user.presence.send()}presenceHandler(e){const t=e.getAttribute("type");if("error"===t)return!0;const n=e.getAttribute("from"),s=cy.getBareJidFromJid(n);if(this.isSelf(s))return this.handleOwnPresence(e);if(ly(`query[xmlns="${cy.NS.MUC}"]`,e).length)return;const i=this.get(s);if(i){const t=e.querySelector("status")?.textContent;i.get("status")!==t&&i.save({status:t})}if("subscribed"===t&&i)i.ackSubscribe();else if("unsubscribed"===t&&i)i.ackUnsubscribe();else{if("unsubscribe"===t)return;if("subscribe"===t)this.handleIncomingSubscription(e);else if("unavailable"===t&&i){const e=cy.getResourceFromJid(n);i.presence.removeResource(e)}else i&&i.presence.addResource(e)}}}const my=fy;class gy extends ie.Model{get idAttribute(){return"name"}}const py=gy;class vy extends ie.Collection{constructor(){super(),this.model=py}}const by=vy,{Strophe:yy,sizzle:_y,dayjs:wy}=Lf.env;class Sy extends ie.Model{get idAttribute(){return"jid"}defaults(){return{presence:"offline",show:null}}initialize(){super.initialize(),this.resources=new by;const e=`converse.identities-${this.get("jid")}`;zc(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)}onResourcesChanged(){const e=this.getHighestPriorityResource(),{presence:t,show:n}=e?.attributes??{};this.save({presence:t,show:n})}getStatus(){const e=this.get("presence");return"offline"===e?"offline":this.get("show")||e||"offline"}getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]}addResource(e){const t=function(e){const t=e.getAttribute("from"),n=e.getAttribute("type"),s=yy.getResourceFromJid(t),i=_y(`delay[xmlns="${yy.NS.DELAY}"]`,e).pop(),r=e.querySelector("priority")?.textContent,o=e.querySelector("show")?.textContent;return{resource:s,show:o,timestamp:i?wy(i.getAttribute("stamp")).toISOString():(new Date).toISOString(),type:n,priority:Number.isNaN(parseInt(r,10))?0:parseInt(r,10)}}(e),n={name:t.resource,presence:"unavailable"===t.type?"offline":"online",priority:t.priority,show:t.show,timestamp:t.timestamp},s=this.resources.get(n.name);s?s.save(n):this.resources.create(n)}removeResource(e){const t=this.resources.get(e);t?.destroy()}}const Ay=Sy;class xy extends ie.Collection{constructor(){super(),this.model=Ay}}const $y=xy,{Strophe:Ey,$build:jy}=Lf.env;function Cy(e){ad.trigger("statusInitialized",e)}function ky(e){if(e=void 0!==uo.state.profile&&e)Cy(e);else{const t=`converse.xmppstatus-${uo.session.get("bare_jid")}`;uo.state.profile=new uo.exports.Profile({id:t}),uo.state.xmppstatus=uo.state.profile,Object.assign(uo,{xmppstatus:uo.state.profile}),zc(uo.state.profile,t,"session"),uo.state.profile.fetch({success:()=>Cy(e),error:()=>Cy(e),silent:!0})}}let Ty,Oy=0,Ny=!1,My=!1,Iy=!1;function Ry(){Oy>0&&(Oy=0),ad.connection.get()?.authenticated&&(Iy&&zy(Wr),Ny&&(Ny=!1,ad.user.presence.send()),!0===My&&(My=!1,uo.state.profile.set("show",void 0)))}function Dy(){if(!ad.connection.get()?.authenticated)return;const{profile:e}=uo.state,t=e.get("show");Oy++,ad.settings.get("csi_waiting_time")>0&&Oy>ad.settings.get("csi_waiting_time")&&!Iy&&zy(Gr),ad.settings.get("idle_presence_timeout")>0&&Oy>ad.settings.get("idle_presence_timeout")&&!Ny&&(Ny=!0,ad.user.presence.send()),ad.settings.get("auto_away")>0&&Oy>ad.settings.get("auto_away")&&"away"!==t&&"xa"!==t&&"dnd"!==t?(My=!0,e.set("show","away")):ad.settings.get("auto_xa")>0&&Oy>ad.settings.get("auto_xa")&&"xa"!==t&&"dnd"!==t&&(My=!0,e.set("show","xa"))}function zy(e){ad.send(jy(e,{xmlns:Ey.NS.CSI})),Iy=e===Gr}function Ly(){if(ad.settings.get("auto_away")<1&&ad.settings.get("auto_xa")<1&&ad.settings.get("csi_waiting_time")<1&&ad.settings.get("idle_presence_timeout")<1)return;Oy=0,My=!1;const{onUserActivity:e,onEverySecond:t}=uo.exports;window.addEventListener("click",e),window.addEventListener("focus",e),window.addEventListener("keypress",e),window.addEventListener("mousemove",e),window.addEventListener(Qs(),e,{once:!0,passive:!0}),Ty=setInterval(t,1e3)}function Py(){const{onUserActivity:e}=uo.exports;window.removeEventListener("click",e),window.removeEventListener("focus",e),window.removeEventListener("keypress",e),window.removeEventListener("mousemove",e),window.removeEventListener(Qs(),e),Ty&&(clearInterval(Ty),Ty=null)}const{Stanza:Uy,Strophe:By,stx:qy}=Lf.env;class Fy extends(jm(gm(ie.Model))){defaults(){return{presence:"online",status:null,show:null,groups:[]}}getStatus(){const e=this.get("presence");return"offline"===e||"unavailable"===e?"offline":this.get("show")||e||"offline"}get(e){return"jid"===e?uo.session.get("bare_jid"):"nickname"===e?ad.settings.get("nickname"):super.get(e)}set(e,t,n){if("jid"===e||"nickname"===e)throw new Error("Readonly property");return super.set(e,t,n)}initialize(){super.initialize(),this.on("change",(e=>{(e.changed?.status||e.changed?.status_message||e.changed?.show)&&ad.user.presence.send({show:this.get("show"),status:this.get("status_message")})}))}getDisplayName(e){const{__:t}=uo,n=this.vcard?.get("fullname")||this.getNickname()||this.get("jid");return"roster"===e?.context?`${n} (${t("me")})`:n}getNickname(){return this.vcard?.get("nickname")||ad.settings.get("nickname")}async constructPresence(e={}){const{type:t,to:n}=e,{profile:s}=uo.state,i="string"==typeof e.status?e.status:this.get("status_message"),r=e.show||this.get("status"),o="subscribe"===t?s.getNickname():null,a=ad.settings.get("priority");let c;Ny&&(c=new Date,c.setSeconds(c.getSeconds()-Oy));const l=qy`
            <presence ${n?Uy.unsafeXML(`to="${By.xmlescape(n)}"`):""}
                    ${t?Uy.unsafeXML(`type="${By.xmlescape(t)}"`):""}
                    xmlns="jabber:client">
                ${o?qy`<nick xmlns="${By.NS.NICK}">${o}</nick>`:""}
                ${r?qy`<show>${r}</show>`:""}
                ${i?qy`<status>${i}</status>`:""}
                <priority>${Number.isNaN(Number(a))?0:a}</priority>
                ${c?qy`<idle xmlns="${By.NS.IDLE}" since="${c.toISOString()}"></idle>`:""}
            </presence>`;return await ad.hook("constructedPresence",null,l)}}const{Strophe:Hy}=Lf.env;Hy.addNamespace("IDLE","urn:xmpp:idle:1"),Lf.plugins.add("converse-status",{initialize(){ad.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,idle_presence_timeout:300,priority:0}),ad.promises.add(["statusInitialized"]);const e={XMPPStatus:Fy,Profile:Fy,onUserActivity:Ry,onEverySecond:Dy,sendCSI:zy,registerIntervalHandler:Ly};Object.assign(uo,e),Object.assign(uo.exports,e),Object.assign(uo.api.user,ny),ad.settings.get("idle_presence_timeout")>0&&ad.listen.on("addClientFeatures",(()=>ad.disco.own.features.add(Hy.NS.IDLE))),ad.listen.on("presencesInitialized",(e=>!e&&Ly())),ad.listen.on("beforeTearDown",Py),ad.listen.on("clearSession",(()=>{ei(uo)&&uo.state.profile&&(uo.state.profile.destroy(),delete uo.state.profile,Object.assign(uo,{profile:void 0}),ad.promises.add(["statusInitialized"]))})),ad.listen.on("connected",(()=>ky(!1))),ad.listen.on("reconnected",(()=>ky(!0)))}});const{Strophe:Gy}=Lf.env,Wy={contacts:{async get(e){await ad.waitUntil("rosterContactsFetched");const{roster:t}=uo.state,n=e=>t.get(Gy.getBareJidFromJid(e));if(void 0===e)e=t.pluck("jid");else if("string"==typeof e)return n(e);return e.map(n)},async remove(e,t){await ad.waitUntil("rosterContactsFetched");(await ad.contacts.get(e)).remove(t)},async add(e,t=!0,n=!0,s=""){if(!Pc(e?.jid))throw new Error("api.contacts.add: Valid JID required");const{roster:i}=uo.state;return i.addContact(e,t,n,s)}}};Lf.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){ad.settings.extend({allow_contact_requests:!0,auto_subscribe:!1,enable_roster_versioning:!0,show_self_in_roster:!0,synchronize_availability:!0}),ad.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized","presencesInitialized"]),Object.assign(uo.api,Wy);const{__:e}=uo,t={HEADER_UNSAVED_CONTACTS:e("Unsaved contacts"),HEADER_CURRENT_CONTACTS:e("My contacts"),HEADER_REQUESTING_CONTACTS:e("Contact requests"),HEADER_UNGROUPED:e("Ungrouped"),HEADER_UNREAD:e("New messages")};Object.assign(uo,t),Object.assign(uo.labels,t);const n={Presence:Ay,Presences:$y,RosterContact:ay,RosterContacts:my};Object.assign(uo,n),Object.assign(uo.exports,n),ad.listen.on("beforeTearDown",(()=>Mv())),ad.listen.on("chatBoxesInitialized",Lv),ad.listen.on("clearSession",Rv),ad.listen.on("presencesInitialized",Dv),ad.listen.on("statusInitialized",zv),ad.listen.on("streamResumptionFailed",(()=>uo.session.set("roster_cached",!1))),ad.waitUntil("rosterContactsFetched").then(Pv)}});const{Strophe:Vy,u:Ky,stx:Jy}=Lf.env;function Yy(){return!(ad.connection.isType("bosh")&&!Xs())&&ad.disco.stream.getFeature("sm",Vy.NS.SM)}function Xy(e){if(!uo.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),n=uo.session.get("num_stanzas_handled_by_server"),s=t-n;if(s<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${n}`;Y.error(e)}const i=uo.session.get("unacked_stanzas");if(s>i.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${s} -Unacknowledged Stanza Count: ${i.length} -New: ${t} - Previous: ${n}`;Y.error(e)}return uo.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:i.slice(s)}),!0}function Qy(){if(uo.session.get("smacks_enabled")){const e=uo.session.get("num_stanzas_handled"),t=Jy`<a xmlns="${Vy.NS.SM}" h="${e}"/>`;ad.send(t)}return!0}function Zy(e){if(uo.session.get("smacks_enabled")&&(Ky.isTagEqual(e,"iq")||Ky.isTagEqual(e,"presence")||Ky.isTagEqual(e,"message"))){const e=uo.session.get("num_stanzas_handled");uo.session.save("num_stanzas_handled",e+1)}return!0}function e_(){const{session:e}=uo;e.save({smacks_enabled:uo.session.get("smacks_enabled")||!1,num_stanzas_handled:uo.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:uo.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:uo.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:uo.session.get("unacked_stanzas")||[]})}function t_(){const{session:e}=uo;Ky.safeSave(e,{smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function n_(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),uo.session.save(t),!0}function s_(e){if(t_(),ad.trigger("streamResumptionFailed"),e.querySelector("item-not-found"))Y.warn("Could not resume previous SMACKS session, session id not found. A new session will be established.");else{Y.error("Failed to enable stream management"),Y.error(e.outerHTML);ad.connection.get()._changeConnectStatus(Vy.Status.DISCONNECTED,null)}return!0}function i_(e){n_(e),Xy(e),function(){const e=uo.session.get("unacked_stanzas");uo.session.save("unacked_stanzas",[]),e.forEach((e=>ad.send(Ky.toStanza(e))))}();const t=ad.connection.get();t.do_bind=!1,t.authenticated=!0,t.restored=!0,t._changeConnectStatus(Vy.Status.CONNECTED,null)}async function r_(){if(ad.settings.get("enable_smacks")&&!uo.session.get("smacks_enabled")&&await Yy()){const e=re(),t=ad.connection.get();t._addSysHandler((t=>e.resolve(n_(t))),Vy.NS.SM,"enabled"),t._addSysHandler((t=>e.resolve(s_(t))),Vy.NS.SM,"failed");const n=ad.connection.isType("websocket")||Xs(),s=Jy`<enable xmlns="${Vy.NS.SM}" resume="${n}"/>`;ad.send(s),t.flush(),await e}}const o_=[];async function a_(){if(!ad.settings.get("enable_smacks"))return;if(!await Yy())return;const e=ad.connection.get();for(;o_.length;)e.deleteHandler(o_.pop());o_.push(e.addHandler(Zy)),o_.push(e.addHandler(Qy,Vy.NS.SM,"r")),o_.push(e.addHandler(Xy,Vy.NS.SM,"a"));const{session:t}=uo;t?.get("smacks_stream_id")?await async function(){const e=re(),t=ad.connection.get();t._addSysHandler((t=>e.resolve(i_(t))),Vy.NS.SM,"resumed"),t._addSysHandler((t=>e.resolve(s_(t))),Vy.NS.SM,"failed");const n=uo.session.get("smacks_stream_id"),s=uo.session.get("num_stanzas_handled"),i=Jy`<resume xmlns="${Vy.NS.SM}" h="${s}" previd="${n}"/>`;ad.send(i),t.flush(),await e}():t_()}function c_(e){if(uo.session){if(uo.session.get("smacks_enabled")&&(Ky.isTagEqual(e,"iq")||Ky.isTagEqual(e,"presence")||Ky.isTagEqual(e,"message"))){const t=Vy.serialize(e);uo.session.save("unacked_stanzas",(uo.session.get("unacked_stanzas")||[]).concat([t]));const n=ad.settings.get("smacks_max_unacked_stanzas");if(n>0){const e=uo.session.get("num_stanzas_since_last_ack")+1;e%n==0&&ad.send(Jy`<r xmlns="${Vy.NS.SM}"/>`),uo.session.save({num_stanzas_since_last_ack:e})}}}else Y.warn("No _converse.session!")}const{Strophe:l_}=Lf.env;l_.addNamespace("SM","urn:xmpp:sm:3"),Lf.plugins.add("converse-smacks",{initialize(){ad.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),ad.listen.on("afterResourceBinding",r_),ad.listen.on("beforeResourceBinding",a_),ad.listen.on("send",c_),ad.listen.on("userSessionInitialized",e_)}});class d_ extends ie.Model{constructor(e,t){super(e,t),this._vcard=null}initialize(e,t){this.lazy_load=ad.settings.get("lazy_load_vcards")&&!!t?.lazy_load,this.lazy_load?this.once("visibilityChanged",(()=>ad.vcard.update(this))):ad.vcard.update(this)}get idAttribute(){return"jid"}getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}}const u_=d_;class h_ extends ie.Collection{constructor(){super(),this.model=u_}async initialize(){const{session:e}=uo;zc(this,`${e.get("bare_jid")}-converse.vcards`),await this.fetchVCards(),ad.trigger("VCardsInitialized")}fetchVCards(){const e=re();return this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}),e}}const f_=h_,{Strophe:m_,dayjs:g_,u:p_,stx:v_}=Lf.env,b_={vcard:{async set(e,t){if(!e)throw Error("No jid provided for the VCard data");ad.waitUntil("VCardsInitialized");let n=uo.state.vcards.get(e);const s=n?.attributes??null;if(n&&s.image!==t.image){const e=p_.base64ToArrayBuffer(t.image),s=await crypto.subtle.digest("SHA-1",e);n.save({image:t.image,image_type:t.image_type,image_hash:p_.arrayBufferToHex(s)})}let i;const r=v_`
                <vCard xmlns="vcard-temp">
                    <FN>${t.fn??""}</FN>
                    <NICKNAME>${t.nickname??""}</NICKNAME>
                    <URL>${t.url??""}</URL>
                    <ROLE>${t.role??""}</ROLE>
                    <EMAIL><INTERNET/><PREF/><USERID>${t.email??""}</USERID></EMAIL>
                    <PHOTO>
                        <TYPE>${t.image_type??""}</TYPE>
                        <BINVAL>${t.image??""}</BINVAL>
                    </PHOTO>
                </vCard>`;try{i=await ad.sendIQ(Sm("set",e,r))}catch(e){throw s&&n.save(s),e}if(n=await ad.vcard.update(e,!0),p_.isOwnJID(e)){const e=v_`<x xmlns="${m_.NS.VCARD_UPDATE}">
                    <photo>${n.get("image_hash")??""}</photo>
                </x>`;ad.user.presence.send({},e)}return i},async get(e,t){if(ad.waitUntil("VCardsInitialized"),"string"==typeof e)return xm(e);const n=e.get("vcard_error");if(n){const{random:e,round:s}=Math,i=s(e()),r=g_().subtract(21,"days").subtract(s(24*e())*i,"hours").add(s(24*e())*(i?0:1),"hours"),o=g_(n).isAfter(r);if(!t&&o)return null}const s=e.get("vcard_updated");if(s){const{random:e,round:n}=Math,i=n(e()),r=g_().subtract(7,"days").subtract(n(24*e())*i,"hours").add(n(24*e())*(i?0:1),"hours"),o=g_(s).isAfter(r);if(!t&&o)return null}const i=e.get("jid");return i?xm(i):(Y.error("No JID to get vcard for"),null)},async update(e,t){ad.waitUntil("VCardsInitialized");const n=await this.get(e,t);if(null!==n){if(e="string"==typeof e?uo.state.vcards.get(e):e)return Object.keys(n).length&&(delete n.stanza,p_.safeSave(e,n)),e;Y.error(`Could not find a VCard model for ${e}`)}else Y.debug("api.vcard.update: null data returned, not updating the vcard")}}},{Strophe:y_}=Lf.env;Lf.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],enabled:()=>!ad.settings.get("blacklisted_plugins")?.includes("converse-vcard"),initialize(){ad.settings.extend({lazy_load_vcards:!0}),ad.promises.add("VCardsInitialized"),Object.assign(uo.api,b_);const e={VCard:u_,VCards:f_};Object.assign(uo,e),Object.assign(uo.exports,e),ad.listen.on("chatRoomInitialized",(e=>{e.listenTo(e.occupants,"change:image_hash",(e=>function(e){const t=e.get("image_hash"),n=[];e.get("jid")&&n.push(uo.state.vcards.get(e.get("jid"))),n.push(uo.state.vcards.get(e.get("from"))),n.forEach((e=>t&&e&&e?.get("image_hash")!==t&&ad.vcard.update(e,!0)))}(e)))})),ad.listen.on("addClientFeatures",(()=>{ad.disco.own.features.add(y_.NS.VCARD),ad.disco.own.features.add(y_.NS.VCARD_UPDATE)})),ad.listen.on("clearSession",(()=>{ei(uo)&&(ad.promises.add("VCardsInitialized"),uo.state.vcards&&(uo.state.vcards.clearStore(),Object.assign(uo,{vcards:void 0}),delete uo.state.vcards))})),ad.listen.on("visibilityChanged",(({el:e})=>{const{model:t}=e;t?.vcard&&t.vcard.trigger("visibilityChanged")})),ad.listen.on("connected",(()=>{const e=new uo.exports.VCards;uo.state.vcards=e,Object.assign(uo,{vcards:e})})),ad.listen.on("presencesInitialized",(()=>Em())),ad.listen.on("beforeTearDown",(()=>{$m&&(ad.connection.get().deleteHandler($m),$m=null)})),ad.listen.on("constructedPresence",((e,t)=>function(e){if(0===_m(`x[xmlns=${bm.NS.VCARD_UPDATE}"]`,e.root()).length){const t=wm`<x xmlns="${bm.NS.VCARD_UPDATE}"></x>`;e.root().cnode(t).up()}return e}(t)))}}),H().extend(W());const __=Object.assign({},a,w);Object.assign(uo.constants,__);const{dayjs:w_}=Lf.env;let S_,A_="en";function x_(e,t){return t.includes(e)}function $_(e,t){if("en"===e||t(e))return e;const{languages:n}=window.navigator;let s;for(let e=0;e<n.length&&!s;e++)s=E_(n[e],t);return s||"en"}function E_(e,t){if(t(e))return e;var n=e.split("-")[0];return n!==e&&t(n)?n:void 0}const j_=Object.assign(ee,{getLocale:()=>A_,translate(e,t){if(!S_)return q().sprintf.apply(q(),arguments);const n=S_.translate(e);return arguments.length>1?n.fetch.apply(n,t):n.fetch()},async initialize(){if(Rf.isTestEnv())A_="en";else try{const e=ad.settings.get("i18n"),t=ad.settings.get("locales");A_=$_(e,(e=>x_(e,t))),S_=await async function(){const e=function(e){const t=e.toLowerCase().replace("_","-");return"ug"===t?"ug-cn":t}(A_);if(!x_(A_,ad.settings.get("locales"))||"en"===A_)return;const{default:t}=await n(3883)(`./${A_}/LC_MESSAGES/converse.po`);return await n(6669)(`./${e}.js`),w_.locale($_(e,(e=>w_.locale(e)))),new(q())(t)}()}catch(e){Y.fatal(e.message),A_="en"}},__:(e,...t)=>j_.translate(e,t)}),C_=j_.__,k_={},T_={registry:k_,define(e,t){this.registry[e]=t},register(){Object.keys(k_).forEach((e=>{customElements.get(e)||customElements.define(e,k_[e])}))}};Object.assign(ad,{elements:T_});class O_ extends((0,ie.EventEmitter)(Bh)){constructor(){super()}createRenderRoot(){return this}initialize(){return null}connectedCallback(){return super.connectedCallback(),this.initialize()}disconnectedCallback(){super.disconnectedCallback(),this.stopListening()}}ad.elements.define("converse-logo",class extends O_{render(){return"overlayed"===ad.settings.get("view_mode")?wh`<svg class="converse-svg-logo" version="1.1" viewBox="0 0 364 364" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><title>Converse Logo</title><g class="cls-1" id="g904"><g data-name="Layer 2"><g data-name="Layer 7"><path class="cls-3" d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z"/><path class="cls-4" d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z"/></g></g></g></svg>`:wh`<svg class="converse-svg-logo" version="1.1" viewBox="0 0 364 364" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><title>Converse Logo</title><defs><linearGradient id="gradient" x1="92.14" y1="27.64" x2="267.65" y2="331.62" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff1d1"/><stop offset="0.05" stop-color="#fae8c1"/><stop offset="0.15" stop-color="#f0d5a1"/><stop offset="0.27" stop-color="#e7c687"/><stop offset="0.4" stop-color="#e1bb72"/><stop offset="0.54" stop-color="#dcb264"/><stop offset="0.71" stop-color="#daad5c"/><stop offset="1" stop-color="#d9ac59"/></linearGradient><filter id="shadow"><feGaussianBlur in="SourceAlpha" stdDeviation="2.3" result="blur1"/><feOffset in="blur1" dx="3" dy="3" result="blur2"/><feColorMatrix in="blur2" type="matrix" result="blur3" values="1 0 0 0 0.1                            0 1 0 0 0.1                            0 0 1 0 0.1                            0 0 0 1 0"/><feMerge><feMergeNode in="blur3"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><g filter="url(#shadow)"><path d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" fill="#d9ac59"/><path d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" fill="url(#gradient)"/></g></svg>`}});ad.elements.define("converse-brand-logo",class extends O_{render(){const e="fullscreen"===ad.settings.get("view_mode");return wh`<a class="brand-heading" href="https://conversejs.org" target="_blank" rel="noopener"><span class="brand-name-wrapper ${e?"brand-name-wrapper--fullscreen":""}"><converse-logo class="converse-svg-logo"></converse-logo><span class="brand-name"><span class="brand-name__text">converse<span class="subdued">.js</span></span> ${e?wh`<p class="byline">messaging freedom</p>`:""}</span></span></a>`}});ad.elements.define("converse-brand-heading",class extends O_{render(){return wh`<converse-brand-logo></converse-brand-logo>`}});const{I:N_}=Lh,M_=()=>document.createComment(""),I_=(e,t,n)=>{const s=e._$AA.parentNode,i=void 0===t?e._$AB:t._$AA;if(void 0===n){const t=s.insertBefore(M_(),i),r=s.insertBefore(M_(),i);n=new N_(t,r,e,e.options)}else{const t=n._$AB.nextSibling,r=n._$AM,o=r!==e;if(o){let t;n._$AQ?.(e),n._$AM=e,void 0!==n._$AP&&(t=e._$AU)!==r._$AU&&n._$AP(t)}if(t!==i||o){let e=n._$AA;for(;e!==t;){const t=e.nextSibling;s.insertBefore(e,i),e=t}}}return n},R_=(e,t,n=e)=>(e._$AI(t,n),e),D_={},z_=e=>{e._$AP?.(!1,!0);let t=e._$AA;const n=e._$AB.nextSibling;for(;t!==n;){const e=t.nextSibling;t.remove(),t=e}},L_=2,P_=e=>(...t)=>({_$litDirective$:e,values:t});class U_{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const B_=(e,t)=>{const n=e._$AN;if(void 0===n)return!1;for(const e of n)e._$AO?.(t,!1),B_(e,t);return!0},q_=e=>{let t,n;do{if(void 0===(t=e._$AM))break;n=t._$AN,n.delete(e),e=t}while(0===n?.size)},F_=e=>{for(let t;t=e._$AM;e=t){let n=t._$AN;if(void 0===n)t._$AN=n=new Set;else if(n.has(e))break;n.add(e),W_(t)}};function H_(e){void 0!==this._$AN?(q_(this),this._$AM=e,F_(this)):this._$AM=e}function G_(e,t=!1,n=0){const s=this._$AH,i=this._$AN;if(void 0!==i&&0!==i.size)if(t)if(Array.isArray(s))for(let e=n;e<s.length;e++)B_(s[e],!1),q_(s[e]);else null!=s&&(B_(s,!1),q_(s));else B_(this,e)}const W_=e=>{e.type==L_&&(e._$AP??=G_,e._$AQ??=H_)};class V_ extends U_{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,n){super._$AT(e,t,n),F_(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(B_(this,e),q_(this))}setValue(e){if((e=>void 0===e.strings)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}class K_{constructor(e){this.Y=e}disconnect(){this.Y=void 0}reconnect(e){this.Y=e}deref(){return this.Y}}class J_{constructor(){this.Z=void 0,this.q=void 0}get(){return this.Z}pause(){this.Z??=new Promise((e=>this.q=e))}resume(){this.q?.(),this.Z=this.q=void 0}}const Y_=e=>!(e=>null===e||"object"!=typeof e&&"function"!=typeof e)(e)&&"function"==typeof e.then,X_=1073741823;const Q_=P_(class extends V_{constructor(){super(...arguments),this._$Cwt=X_,this._$Cbt=[],this._$CK=new K_(this),this._$CX=new J_}render(...e){return e.find((e=>!Y_(e)))??Ah}update(e,t){const n=this._$Cbt;let s=n.length;this._$Cbt=t;const i=this._$CK,r=this._$CX;this.isConnected||this.disconnected();for(let e=0;e<t.length&&!(e>this._$Cwt);e++){const o=t[e];if(!Y_(o))return this._$Cwt=e,o;e<s&&o===n[e]||(this._$Cwt=X_,s=0,Promise.resolve(o).then((async e=>{for(;r.get();)await r.get();const t=i.deref();if(void 0!==t){const n=t._$Cbt.indexOf(o);n>-1&&n<t._$Cwt&&(t._$Cwt=n,t.setValue(e))}})))}return Ah}disconnected(){this._$CK.disconnect(),this._$CX.pause()}reconnected(){this._$CK.reconnect(this),this._$CX.resume()}}),Z_=e=>wh`<div class="mb-3"><label for="${e.id}" class="form-label">${e.label} ${e.desc?wh`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <input class="form-control" id="${e.id}" name="${e.name}" type="datetime-local" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`,ew=e=>wh`<fieldset class="mb-3">${e.label?wh`<label class="form-label">${e.label}</label>`:""} <img src="data:${e.type};base64,${e.data}"> <input name="${e.name}" type="text" ?required="${e.required}"></fieldset>`,tw=e=>wh`<fieldset class="mb-3 form-check"><input id="${e.id}" name="${e.name}" type="checkbox" class="form-check-input" ?readonly="${e.readonly}" ?checked="${e.checked}" ?required="${e.required}"> <label class="form-check-label" for="${e.id}">${e.label} ${e.desc?wh`<small class="form-text text-muted">${e.desc}</small>`:""}</label></fieldset>`,nw=e=>wh`<p>${e.text}</p>`,sw=e=>wh`<div class="mb-3">${"hidden"!==e.type?wh`<label for="${e.id}" class="form-label">${e.label} ${e.desc?wh`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""} ${"password"===e.type&&e.fixed_username?wh`<input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.fixed_username}">`:""} <input autocomplete="${e.autocomplete||""}" class="form-control" id="${e.id}" name="${e.name}" placeholder="${e.placeholder||""}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`,iw=e=>wh`<div class="mb-3"><label for="${e.id}" class="form-label">${e.label}</label> <select class="form-control" id="${e.id}" name="${e.name}" ?multiple="${e.multiple}">${e.options?.map((e=>(e=>wh`<option value="${e.value}" ?selected="${e.selected}">${e.label}</option>`)(e)))}</select></div>`,rw=e=>{const t=Rf.getUniqueId();return wh`<div class="mb-3"><label class="form-label label-ta" for="${e.id}">${e.label} ${e.desc?wh`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <textarea name="${e.name}" id="${t}" ?readonly="${e.readonly}" ?required="${e.required}" class="form-control">${e.value}</textarea></div>`},ow=e=>wh`<div class="mb-3"><label for="${e.id}" class="form-label">${e.label} ${e.desc?wh`<small id="o.id" class="form-text text-muted">${e.desc}</small>`:""}</label><div><a class="form-url" target="_blank" rel="noopener" id="${e.id}" href="${e.value}">${e.value}</a></div></div>`,aw=e=>wh`<div class="mb-3">${"hidden"!==e.type?wh`<label for="${e.id}" class="form-label">${e.label} ${e.desc?wh`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""}<div class="input-group"><input name="${e.name}" class="form-control" id="${e.id}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"> ${e.domain?wh`<div class="input-group-append"><div class="input-group-text" title="${e.domain}">${e.domain}</div></div>`:""}</div></div>`;function cw(e){e.preventDefault(),ad.rooms.open(e.target.href)}const lw=(e,t)=>"xmpp:"===e.protocol&&null!=e.searchParams.get("join")?wh`<a target="_blank" rel="noopener" @click="${cw}" href="${e.href}">${t}</a>`:wh`<a target="_blank" rel="noopener" href="${e.href}">${t}</a>`,{sizzle:dw,Strophe:uw,dayjs:hw}=Lf.env,{isValidURL:fw}=Rf,mw=["http:","https:","xmpp:","mailto:"],gw=/\s*\n\s*/;function pw(e){let t;(e instanceof Zi||e instanceof Er)&&(e=e.tree());const n=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,(e=>"body"===e.parentElement.nodeName.toLowerCase()?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT));for(;t=s.nextNode();)n.push(t);return n.forEach((e=>gw.test(e.data)&&e.parentElement.removeChild(e))),e}function vw(e,t){return{"muc#roomconfig_lang":"language","muc#roomconfig_roomsecret":t?.new_password?"new-password":"current-password"}[e]}function bw(e){const t=e.getAttribute("name");if(!t)return null;let n;return n="checkbox"===e.getAttribute("type")?e.checked?1:0:"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?Rf.getSelectValues(e):e.value,{name:t,value:n}}function yw(e){try{const t=Rf.getURL(e);return decodeURI(t.pathname.split("/").pop())}catch(t){return Y.debug(t),e}}function _w(e){return Array.from(e.children).reduce(((e,t)=>t instanceof HTMLElement?e+t.offsetHeight:e),0)}function ww(e,t){return t instanceof Element&&t.classList.contains(e)}function Sw(e,t){return t instanceof Element&&t.classList.add(e),t}function Aw(e,t){return t instanceof Element&&t.classList.remove(e),t}function xw(e){return e instanceof Element&&e.parentNode&&e.parentNode.removeChild(e),e}function $w(e,t){let n=e;for(;null!==n&&!dw.matchesSelector(n,t);)n=n.parentElement;return n}function Ew(e){const t=RegExp("^w{3}.","ig").test(e)?`http://${e}`:e;try{const n=Rf.getURL(t);return function(e,t=mw){return!!t.includes(e)}(n.protocol)?lw(n,e):e}catch(e){Y.debug(e)}}function jw(e,t=200){return new Promise(((n,s)=>{if(!e){const e="An element needs to be passed in to slideOut";return Y.warn(e),void s(new Error(e))}const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const r=_w(e);if(ad.settings.get("disable_effects"))return e.style.height=r+"px",function(e){e.removeAttribute("data-slider-marker"),e.classList.remove("collapsed"),e.style.overflow="",e.style.height=""}(e),void n();if(!ww("collapsed",e)&&!ww("hidden",e))return void n();const o=t/17;let a=0;e.style.height="0",e.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("collapsed"),e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a+=r/o,a<r?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.style.height=_w(e)+"px",e.style.overflow="",e.style.height="",n())})).toString())}))}function Cw(e,t=200){return new Promise(((n,s)=>{if(!e){const e="An element needs to be passed in to slideIn";return Y.warn(e),s(new Error(e))}if(ww("collapsed",e))return n(e);if(ad.settings.get("disable_effects"))return e.classList.add("collapsed"),e.style.height="",n(e);const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const r=e.offsetHeight,o=t/17;let a=r;e.style.overflow="hidden",e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a-=r/o,a>0?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.classList.add("collapsed"),e.style.height="",n(e))})).toString())}))}function kw(e,t={}){const n={id:Rf.getUniqueId(),name:e.var};if("list-single"===e.type||"list-multi"===e.type)return iw({...n,...e,multiple:"list-multi"===e.type});if("fixed"===e.type)return nw(e);if("jid-multi"===e.type)return rw({...n,...e});if("boolean"===e.type)return tw({...n,...e});if("username"===e.var)return aw({...n,domain:t.domain?" @"+t.domain:"",...e});if("password"===e.var)return sw({...n,...e,autocomplete:vw(e.var,t),fixed_username:t?.fixed_username,type:"password"});if("ocr"===e.var)return ew({...n,...e,data:e.uri.data,type:e.uri.type});if("hidden"===e.type||"url"!==e.var&&"uri"!==e.var&&!fw(e.value)){if("datetime"===e.type||"date"===e.type){const t=e.value?hw(e.value):null,s=t?.isValid()?"datetime"===e.type?t.format("YYYY-MM-DDTHH:mm:ss"):t.format("YYYY-MM-DD"):null;return Z_({...n,...e,value:s})}return sw({...n,...e,autocomplete:vw(e.var,t),placeholder:null})}return ow(e)}function Tw(e,t=!1){let n=e.offsetWidth;if(!t)return n;const s=window.getComputedStyle(e);return n+=parseInt(s.marginLeft?s.marginLeft:"0",10)+parseInt(s.marginRight?s.marginRight:"0",10),n}let Ow;function Nw(){return Ow||(Ow=document.querySelector("converse-root")||document.createElement("converse-root")),Ow}Object.assign(Rf,{addClass:Sw,ancestor:$w,calculateElementHeight:_w,escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getElementFromTemplateResult:function(e){const t=document.createElement("div");return Uh(e,t),t.firstElementChild},getNextElement:function(e,t="*"){let n=e.nextElementSibling;for(;null!==n&&!dw.matchesSelector(n,t);)n=n.nextElementSibling;return n},getOuterWidth:Tw,getRootElement:Nw,hasClass:ww,hideElement:function(e){return e instanceof Element&&e.classList.add("hidden"),e},isEqualNode:function(e,t){if(!Rf.isElement(e))throw new Error("Element being compared must be an Element!");e=pw(e),t=pw(t);let n=e.isEqualNode(t);if(!n){const{xmlHtmlNode:s}=uw,i=uw.serialize(e),r=uw.serialize(t);n=i===r||s(i).isEqualNode(s(r))}return n},isInDOM:function(e){return document.querySelector("body").contains(e)},isVisible:function(e){return null!==e&&(!ww("hidden",e)&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0))},nextUntil:function(e,t){const n=[];let s=e.nextElementSibling;for(;null!==s&&!s.matches(t);)n.push(s),s=s.nextElementSibling;return n},removeClass:Aw,removeElement:xw,showElement:function(e){Aw("collapsed",e),Aw("hidden",e)},slideIn:Cw,slideOut:jw,unescapeHTML:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText},xFormField2TemplateResult:kw});const Mw=Rf;function Iw(e){let t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}function Rw(e){let t=0;do{isNaN(e.offsetLeft)||(t+=e.offsetLeft)}while(e=e.offsetParent);return t}const{keycodes:Dw}=Lf;class zw{static get DIRECTION(){return{down:"down",end:"end",home:"home",left:"left",right:"right",up:"up"}}static get DEFAULTS(){return{home:[`${Dw.SHIFT}${Dw.UP_ARROW}`],end:[`${Dw.SHIFT}${Dw.DOWN_ARROW}`],up:[Dw.UP_ARROW],down:[Dw.DOWN_ARROW],left:[Dw.LEFT_ARROW,`${Dw.SHIFT}${Dw.TAB}`],right:[Dw.RIGHT_ARROW,Dw.TAB],getSelector:null,jump_to_picked:null,jump_to_picked_direction:null,jump_to_picked_selector:"picked",onSelected:null,selected:"selected",selector:"li"}}static getClosestElement(e,t){return e.reduce(((e,n)=>{const s=t(n);return s<e.distance?{distance:s,element:n}:e}),{distance:1/0,element:null}).element}constructor(e,t){this.container=e,this.scroll_container=t.scroll_container||e,this.options=Object.assign({},zw.DEFAULTS,t),this.init()}init(){this.selected=null,this.keydownHandler=null,this.elements={},this.keys={},this.options.down.forEach((e=>this.keys[e]=zw.DIRECTION.down)),this.options.end.forEach((e=>this.keys[e]=zw.DIRECTION.end)),this.options.home.forEach((e=>this.keys[e]=zw.DIRECTION.home)),this.options.left.forEach((e=>this.keys[e]=zw.DIRECTION.left)),this.options.right.forEach((e=>this.keys[e]=zw.DIRECTION.right)),this.options.up.forEach((e=>this.keys[e]=zw.DIRECTION.up))}enable(){this.getElements(),this.keydownHandler=e=>this.handleKeydown(e);Mw.getRootElement().addEventListener("keydown",this.keydownHandler),this.enabled=!0}disable(){if(this.keydownHandler){Mw.getRootElement().removeEventListener("keydown",this.keydownHandler)}this.unselect(),this.elements={},this.enabled=!1}destroy(){this.disable()}getNextElement(e){let t;if(e===zw.DIRECTION.home)t=this.getElements(e)[0];else if(e===zw.DIRECTION.end)t=Array.from(this.getElements(e)).pop();else if(this.selected)if(e===zw.DIRECTION.right){const n=this.getElements(e);t=n.slice(n.indexOf(this.selected))[1]}else if(e==zw.DIRECTION.left){const n=this.getElements(e);t=n.slice(0,n.indexOf(this.selected)).pop()||this.selected}else if(e==zw.DIRECTION.down){const e=this.selected.offsetLeft,n=this.selected.offsetTop+this.selected.offsetHeight,s=this.elementsAfter(0,n),i=t=>Math.abs(t.offsetLeft-e)+Math.abs(t.offsetTop-n);t=zw.getClosestElement(s,i)}else{if(e!=zw.DIRECTION.up)throw new Error("getNextElement: invalid direction value");{const e=this.selected.offsetLeft,n=this.selected.offsetTop-1,s=this.elementsBefore(1/0,n),i=t=>Math.abs(e-t.offsetLeft)+Math.abs(n-t.offsetTop);t=zw.getClosestElement(s,i)}}else t=e===zw.DIRECTION.right||e===zw.DIRECTION.down?this.getElements(e)[1]:this.getElements(e)[0];return this.options.jump_to_picked&&t&&t.matches(this.options.jump_to_picked)&&e===this.options.jump_to_picked_direction&&(t=this.container.querySelector(this.options.jump_to_picked_selector)||t),t}select(e,t){e&&e!==this.selected&&(this.unselect(),t&&this.scrollTo(e,t),e.matches("input")?e.focus():Mw.addClass(this.options.selected,e),this.selected=e,this.options.onSelected&&this.options.onSelected(e))}unselect(){this.selected&&(Mw.removeClass(this.options.selected,this.selected),delete this.selected)}scrollTo(e,t){if(this.inScrollContainerViewport(e)){if(!function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(e))switch(t){case zw.DIRECTION.left:document.body.scrollLeft=Rw(e)-document.body.offsetLeft;break;case zw.DIRECTION.up:document.body.scrollTop=Iw(e)-document.body.offsetTop;break;case zw.DIRECTION.right:document.body.scrollLeft=Rw(e)-document.body.offsetLeft-(document.documentElement.clientWidth-e.offsetWidth);break;case zw.DIRECTION.down:document.body.scrollTop=Iw(e)-document.body.offsetTop-(document.documentElement.clientHeight-e.offsetHeight)}}else{const n=this.scroll_container;if(!n.contains(e))return;switch(t){case zw.DIRECTION.left:n.scrollLeft=e.offsetLeft-n.offsetLeft,n.scrollTop=e.offsetTop-n.offsetTop;break;case zw.DIRECTION.up:n.scrollTop=e.offsetTop-n.offsetTop;break;case zw.DIRECTION.right:n.scrollLeft=e.offsetLeft-n.offsetLeft-(n.offsetWidth-e.offsetWidth),n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight);break;case zw.DIRECTION.down:n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight)}}}inScrollContainerViewport(e){const t=this.scroll_container;return!(e.offsetLeft-t.scrollLeft<t.offsetLeft)&&(!(e.offsetTop-t.scrollTop<t.offsetTop)&&(!(e.offsetLeft+e.offsetWidth-t.scrollLeft>t.offsetLeft+t.offsetWidth)&&!(e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetTop+t.offsetHeight)))}getElements(e){const t=this.options.getSelector?this.options.getSelector(e):this.options.selector;return this.elements[t]||(this.elements[t]=Array.from(this.container.querySelectorAll(t))),this.elements[t]}elementsAfter(e,t){return this.getElements(zw.DIRECTION.down).filter((n=>n.offsetLeft>=e&&n.offsetTop>=t))}elementsBefore(e,t){return this.getElements(zw.DIRECTION.up).filter((n=>n.offsetLeft<=e&&n.offsetTop<=t))}handleKeydown(e){const t=Dw,n=e.shiftKey?this.keys[`${t.SHIFT}${e.key}`]:this.keys[e.key];if(n){e.preventDefault(),e.stopPropagation();const t=this.getNextElement(n);this.select(t,n)}}}const Lw=zw;var Pw="top",Uw="bottom",Bw="right",qw="left",Fw="auto",Hw=[Pw,Uw,Bw,qw],Gw="start",Ww="end",Vw="clippingParents",Kw="viewport",Jw="popper",Yw="reference",Xw=Hw.reduce((function(e,t){return e.concat([t+"-"+Gw,t+"-"+Ww])}),[]),Qw=[].concat(Hw,[Fw]).reduce((function(e,t){return e.concat([t,t+"-"+Gw,t+"-"+Ww])}),[]),Zw="beforeRead",eS="read",tS="afterRead",nS="beforeMain",sS="main",iS="afterMain",rS="beforeWrite",oS="write",aS="afterWrite",cS=[Zw,eS,tS,nS,sS,iS,rS,oS,aS];function lS(e){return e?(e.nodeName||"").toLowerCase():null}function dS(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function uS(e){return e instanceof dS(e).Element||e instanceof Element}function hS(e){return e instanceof dS(e).HTMLElement||e instanceof HTMLElement}function fS(e){return"undefined"!=typeof ShadowRoot&&(e instanceof dS(e).ShadowRoot||e instanceof ShadowRoot)}const mS={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},s=t.attributes[e]||{},i=t.elements[e];hS(i)&&lS(i)&&(Object.assign(i.style,n),Object.keys(s).forEach((function(e){var t=s[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var s=t.elements[e],i=t.attributes[e]||{},r=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});hS(s)&&lS(s)&&(Object.assign(s.style,r),Object.keys(i).forEach((function(e){s.removeAttribute(e)})))}))}},requires:["computeStyles"]};function gS(e){return e.split("-")[0]}var pS=Math.max,vS=Math.min,bS=Math.round;function yS(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function _S(){return!/^((?!chrome|android).)*safari/i.test(yS())}function wS(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var s=e.getBoundingClientRect(),i=1,r=1;t&&hS(e)&&(i=e.offsetWidth>0&&bS(s.width)/e.offsetWidth||1,r=e.offsetHeight>0&&bS(s.height)/e.offsetHeight||1);var o=(uS(e)?dS(e):window).visualViewport,a=!_S()&&n,c=(s.left+(a&&o?o.offsetLeft:0))/i,l=(s.top+(a&&o?o.offsetTop:0))/r,d=s.width/i,u=s.height/r;return{width:d,height:u,top:l,right:c+d,bottom:l+u,left:c,x:c,y:l}}function SS(e){var t=wS(e),n=e.offsetWidth,s=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-s)<=1&&(s=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:s}}function AS(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&fS(n)){var s=t;do{if(s&&e.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function xS(e){return dS(e).getComputedStyle(e)}function $S(e){return["table","td","th"].indexOf(lS(e))>=0}function ES(e){return((uS(e)?e.ownerDocument:e.document)||window.document).documentElement}function jS(e){return"html"===lS(e)?e:e.assignedSlot||e.parentNode||(fS(e)?e.host:null)||ES(e)}function CS(e){return hS(e)&&"fixed"!==xS(e).position?e.offsetParent:null}function kS(e){for(var t=dS(e),n=CS(e);n&&$S(n)&&"static"===xS(n).position;)n=CS(n);return n&&("html"===lS(n)||"body"===lS(n)&&"static"===xS(n).position)?t:n||function(e){var t=/firefox/i.test(yS());if(/Trident/i.test(yS())&&hS(e)&&"fixed"===xS(e).position)return null;var n=jS(e);for(fS(n)&&(n=n.host);hS(n)&&["html","body"].indexOf(lS(n))<0;){var s=xS(n);if("none"!==s.transform||"none"!==s.perspective||"paint"===s.contain||-1!==["transform","perspective"].indexOf(s.willChange)||t&&"filter"===s.willChange||t&&s.filter&&"none"!==s.filter)return n;n=n.parentNode}return null}(e)||t}function TS(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function OS(e,t,n){return pS(e,vS(t,n))}function NS(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function MS(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}const IS={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,s=e.name,i=e.options,r=n.elements.arrow,o=n.modifiersData.popperOffsets,a=gS(n.placement),c=TS(a),l=[qw,Bw].indexOf(a)>=0?"height":"width";if(r&&o){var d=function(e,t){return NS("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:MS(e,Hw))}(i.padding,n),u=SS(r),h="y"===c?Pw:qw,f="y"===c?Uw:Bw,m=n.rects.reference[l]+n.rects.reference[c]-o[c]-n.rects.popper[l],g=o[c]-n.rects.reference[c],p=kS(r),v=p?"y"===c?p.clientHeight||0:p.clientWidth||0:0,b=m/2-g/2,y=d[h],_=v-u[l]-d[f],w=v/2-u[l]/2+b,S=OS(y,w,_),A=c;n.modifiersData[s]=((t={})[A]=S,t.centerOffset=S-w,t)}},effect:function(e){var t=e.state,n=e.options.element,s=void 0===n?"[data-popper-arrow]":n;null!=s&&("string"!=typeof s||(s=t.elements.popper.querySelector(s)))&&AS(t.elements.popper,s)&&(t.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function RS(e){return e.split("-")[1]}var DS={top:"auto",right:"auto",bottom:"auto",left:"auto"};function zS(e){var t,n=e.popper,s=e.popperRect,i=e.placement,r=e.variation,o=e.offsets,a=e.position,c=e.gpuAcceleration,l=e.adaptive,d=e.roundOffsets,u=e.isFixed,h=o.x,f=void 0===h?0:h,m=o.y,g=void 0===m?0:m,p="function"==typeof d?d({x:f,y:g}):{x:f,y:g};f=p.x,g=p.y;var v=o.hasOwnProperty("x"),b=o.hasOwnProperty("y"),y=qw,_=Pw,w=window;if(l){var S=kS(n),A="clientHeight",x="clientWidth";if(S===dS(n)&&"static"!==xS(S=ES(n)).position&&"absolute"===a&&(A="scrollHeight",x="scrollWidth"),i===Pw||(i===qw||i===Bw)&&r===Ww)_=Uw,g-=(u&&S===w&&w.visualViewport?w.visualViewport.height:S[A])-s.height,g*=c?1:-1;if(i===qw||(i===Pw||i===Uw)&&r===Ww)y=Bw,f-=(u&&S===w&&w.visualViewport?w.visualViewport.width:S[x])-s.width,f*=c?1:-1}var $,E=Object.assign({position:a},l&&DS),j=!0===d?function(e,t){var n=e.x,s=e.y,i=t.devicePixelRatio||1;return{x:bS(n*i)/i||0,y:bS(s*i)/i||0}}({x:f,y:g},dS(n)):{x:f,y:g};return f=j.x,g=j.y,c?Object.assign({},E,(($={})[_]=b?"0":"",$[y]=v?"0":"",$.transform=(w.devicePixelRatio||1)<=1?"translate("+f+"px, "+g+"px)":"translate3d("+f+"px, "+g+"px, 0)",$)):Object.assign({},E,((t={})[_]=b?g+"px":"",t[y]=v?f+"px":"",t.transform="",t))}const LS={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,s=n.gpuAcceleration,i=void 0===s||s,r=n.adaptive,o=void 0===r||r,a=n.roundOffsets,c=void 0===a||a,l={placement:gS(t.placement),variation:RS(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,zS(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,zS(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var PS={passive:!0};const US={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,s=e.options,i=s.scroll,r=void 0===i||i,o=s.resize,a=void 0===o||o,c=dS(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&l.forEach((function(e){e.addEventListener("scroll",n.update,PS)})),a&&c.addEventListener("resize",n.update,PS),function(){r&&l.forEach((function(e){e.removeEventListener("scroll",n.update,PS)})),a&&c.removeEventListener("resize",n.update,PS)}},data:{}};var BS={left:"right",right:"left",bottom:"top",top:"bottom"};function qS(e){return e.replace(/left|right|bottom|top/g,(function(e){return BS[e]}))}var FS={start:"end",end:"start"};function HS(e){return e.replace(/start|end/g,(function(e){return FS[e]}))}function GS(e){var t=dS(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function WS(e){return wS(ES(e)).left+GS(e).scrollLeft}function VS(e){var t=xS(e),n=t.overflow,s=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+s)}function KS(e){return["html","body","#document"].indexOf(lS(e))>=0?e.ownerDocument.body:hS(e)&&VS(e)?e:KS(jS(e))}function JS(e,t){var n;void 0===t&&(t=[]);var s=KS(e),i=s===(null==(n=e.ownerDocument)?void 0:n.body),r=dS(s),o=i?[r].concat(r.visualViewport||[],VS(s)?s:[]):s,a=t.concat(o);return i?a:a.concat(JS(jS(o)))}function YS(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function XS(e,t,n){return t===Kw?YS(function(e,t){var n=dS(e),s=ES(e),i=n.visualViewport,r=s.clientWidth,o=s.clientHeight,a=0,c=0;if(i){r=i.width,o=i.height;var l=_S();(l||!l&&"fixed"===t)&&(a=i.offsetLeft,c=i.offsetTop)}return{width:r,height:o,x:a+WS(e),y:c}}(e,n)):uS(t)?function(e,t){var n=wS(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):YS(function(e){var t,n=ES(e),s=GS(e),i=null==(t=e.ownerDocument)?void 0:t.body,r=pS(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=pS(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-s.scrollLeft+WS(e),c=-s.scrollTop;return"rtl"===xS(i||n).direction&&(a+=pS(n.clientWidth,i?i.clientWidth:0)-r),{width:r,height:o,x:a,y:c}}(ES(e)))}function QS(e,t,n,s){var i="clippingParents"===t?function(e){var t=JS(jS(e)),n=["absolute","fixed"].indexOf(xS(e).position)>=0&&hS(e)?kS(e):e;return uS(n)?t.filter((function(e){return uS(e)&&AS(e,n)&&"body"!==lS(e)})):[]}(e):[].concat(t),r=[].concat(i,[n]),o=r[0],a=r.reduce((function(t,n){var i=XS(e,n,s);return t.top=pS(i.top,t.top),t.right=vS(i.right,t.right),t.bottom=vS(i.bottom,t.bottom),t.left=pS(i.left,t.left),t}),XS(e,o,s));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function ZS(e){var t,n=e.reference,s=e.element,i=e.placement,r=i?gS(i):null,o=i?RS(i):null,a=n.x+n.width/2-s.width/2,c=n.y+n.height/2-s.height/2;switch(r){case Pw:t={x:a,y:n.y-s.height};break;case Uw:t={x:a,y:n.y+n.height};break;case Bw:t={x:n.x+n.width,y:c};break;case qw:t={x:n.x-s.width,y:c};break;default:t={x:n.x,y:n.y}}var l=r?TS(r):null;if(null!=l){var d="y"===l?"height":"width";switch(o){case Gw:t[l]=t[l]-(n[d]/2-s[d]/2);break;case Ww:t[l]=t[l]+(n[d]/2-s[d]/2)}}return t}function eA(e,t){void 0===t&&(t={});var n=t,s=n.placement,i=void 0===s?e.placement:s,r=n.strategy,o=void 0===r?e.strategy:r,a=n.boundary,c=void 0===a?Vw:a,l=n.rootBoundary,d=void 0===l?Kw:l,u=n.elementContext,h=void 0===u?Jw:u,f=n.altBoundary,m=void 0!==f&&f,g=n.padding,p=void 0===g?0:g,v=NS("number"!=typeof p?p:MS(p,Hw)),b=h===Jw?Yw:Jw,y=e.rects.popper,_=e.elements[m?b:h],w=QS(uS(_)?_:_.contextElement||ES(e.elements.popper),c,d,o),S=wS(e.elements.reference),A=ZS({reference:S,element:y,strategy:"absolute",placement:i}),x=YS(Object.assign({},y,A)),$=h===Jw?x:S,E={top:w.top-$.top+v.top,bottom:$.bottom-w.bottom+v.bottom,left:w.left-$.left+v.left,right:$.right-w.right+v.right},j=e.modifiersData.offset;if(h===Jw&&j){var C=j[i];Object.keys(E).forEach((function(e){var t=[Bw,Uw].indexOf(e)>=0?1:-1,n=[Pw,Uw].indexOf(e)>=0?"y":"x";E[e]+=C[n]*t}))}return E}const tA={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,s=e.name;if(!t.modifiersData[s]._skip){for(var i=n.mainAxis,r=void 0===i||i,o=n.altAxis,a=void 0===o||o,c=n.fallbackPlacements,l=n.padding,d=n.boundary,u=n.rootBoundary,h=n.altBoundary,f=n.flipVariations,m=void 0===f||f,g=n.allowedAutoPlacements,p=t.options.placement,v=gS(p),b=c||(v===p||!m?[qS(p)]:function(e){if(gS(e)===Fw)return[];var t=qS(e);return[HS(e),t,HS(t)]}(p)),y=[p].concat(b).reduce((function(e,n){return e.concat(gS(n)===Fw?function(e,t){void 0===t&&(t={});var n=t,s=n.placement,i=n.boundary,r=n.rootBoundary,o=n.padding,a=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?Qw:c,d=RS(s),u=d?a?Xw:Xw.filter((function(e){return RS(e)===d})):Hw,h=u.filter((function(e){return l.indexOf(e)>=0}));0===h.length&&(h=u);var f=h.reduce((function(t,n){return t[n]=eA(e,{placement:n,boundary:i,rootBoundary:r,padding:o})[gS(n)],t}),{});return Object.keys(f).sort((function(e,t){return f[e]-f[t]}))}(t,{placement:n,boundary:d,rootBoundary:u,padding:l,flipVariations:m,allowedAutoPlacements:g}):n)}),[]),_=t.rects.reference,w=t.rects.popper,S=new Map,A=!0,x=y[0],$=0;$<y.length;$++){var E=y[$],j=gS(E),C=RS(E)===Gw,k=[Pw,Uw].indexOf(j)>=0,T=k?"width":"height",O=eA(t,{placement:E,boundary:d,rootBoundary:u,altBoundary:h,padding:l}),N=k?C?Bw:qw:C?Uw:Pw;_[T]>w[T]&&(N=qS(N));var M=qS(N),I=[];if(r&&I.push(O[j]<=0),a&&I.push(O[N]<=0,O[M]<=0),I.every((function(e){return e}))){x=E,A=!1;break}S.set(E,I)}if(A)for(var R=function(e){var t=y.find((function(t){var n=S.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},D=m?3:1;D>0;D--){if("break"===R(D))break}t.placement!==x&&(t.modifiersData[s]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function nA(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function sA(e){return[Pw,Bw,Uw,qw].some((function(t){return e[t]>=0}))}const iA={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,s=t.rects.reference,i=t.rects.popper,r=t.modifiersData.preventOverflow,o=eA(t,{elementContext:"reference"}),a=eA(t,{altBoundary:!0}),c=nA(o,s),l=nA(a,i,r),d=sA(c),u=sA(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}};const rA={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,s=e.name,i=n.offset,r=void 0===i?[0,0]:i,o=Qw.reduce((function(e,n){return e[n]=function(e,t,n){var s=gS(e),i=[qw,Pw].indexOf(s)>=0?-1:1,r="function"==typeof n?n(Object.assign({},t,{placement:e})):n,o=r[0],a=r[1];return o=o||0,a=(a||0)*i,[qw,Bw].indexOf(s)>=0?{x:a,y:o}:{x:o,y:a}}(n,t.rects,r),e}),{}),a=o[t.placement],c=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[s]=o}};const oA={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=ZS({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};const aA={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,s=e.name,i=n.mainAxis,r=void 0===i||i,o=n.altAxis,a=void 0!==o&&o,c=n.boundary,l=n.rootBoundary,d=n.altBoundary,u=n.padding,h=n.tether,f=void 0===h||h,m=n.tetherOffset,g=void 0===m?0:m,p=eA(t,{boundary:c,rootBoundary:l,padding:u,altBoundary:d}),v=gS(t.placement),b=RS(t.placement),y=!b,_=TS(v),w="x"===_?"y":"x",S=t.modifiersData.popperOffsets,A=t.rects.reference,x=t.rects.popper,$="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,E="number"==typeof $?{mainAxis:$,altAxis:$}:Object.assign({mainAxis:0,altAxis:0},$),j=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,C={x:0,y:0};if(S){if(r){var k,T="y"===_?Pw:qw,O="y"===_?Uw:Bw,N="y"===_?"height":"width",M=S[_],I=M+p[T],R=M-p[O],D=f?-x[N]/2:0,z=b===Gw?A[N]:x[N],L=b===Gw?-x[N]:-A[N],P=t.elements.arrow,U=f&&P?SS(P):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},q=B[T],F=B[O],H=OS(0,A[N],U[N]),G=y?A[N]/2-D-H-q-E.mainAxis:z-H-q-E.mainAxis,W=y?-A[N]/2+D+H+F+E.mainAxis:L+H+F+E.mainAxis,V=t.elements.arrow&&kS(t.elements.arrow),K=V?"y"===_?V.clientTop||0:V.clientLeft||0:0,J=null!=(k=null==j?void 0:j[_])?k:0,Y=M+W-J,X=OS(f?vS(I,M+G-J-K):I,M,f?pS(R,Y):R);S[_]=X,C[_]=X-M}if(a){var Q,Z="x"===_?Pw:qw,ee="x"===_?Uw:Bw,te=S[w],ne="y"===w?"height":"width",se=te+p[Z],ie=te-p[ee],re=-1!==[Pw,qw].indexOf(v),oe=null!=(Q=null==j?void 0:j[w])?Q:0,ae=re?se:te-A[ne]-x[ne]-oe+E.altAxis,ce=re?te+A[ne]+x[ne]-oe-E.altAxis:ie,le=f&&re?function(e,t,n){var s=OS(e,t,n);return s>n?n:s}(ae,te,ce):OS(f?ae:se,te,f?ce:ie);S[w]=le,C[w]=le-te}t.modifiersData[s]=C}},requiresIfExists:["offset"]};function cA(e,t,n){void 0===n&&(n=!1);var s,i,r=hS(t),o=hS(t)&&function(e){var t=e.getBoundingClientRect(),n=bS(t.width)/e.offsetWidth||1,s=bS(t.height)/e.offsetHeight||1;return 1!==n||1!==s}(t),a=ES(t),c=wS(e,o,n),l={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(r||!r&&!n)&&(("body"!==lS(t)||VS(a))&&(l=(s=t)!==dS(s)&&hS(s)?{scrollLeft:(i=s).scrollLeft,scrollTop:i.scrollTop}:GS(s)),hS(t)?((d=wS(t,!0)).x+=t.clientLeft,d.y+=t.clientTop):a&&(d.x=WS(a))),{x:c.left+l.scrollLeft-d.x,y:c.top+l.scrollTop-d.y,width:c.width,height:c.height}}function lA(e){var t=new Map,n=new Set,s=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var s=t.get(e);s&&i(s)}})),s.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),s}var dA={placement:"bottom",modifiers:[],strategy:"absolute"};function uA(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function hA(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,s=void 0===n?[]:n,i=t.defaultOptions,r=void 0===i?dA:i;return function(e,t,n){void 0===n&&(n=r);var i,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},dA,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,d={state:a,setOptions:function(n){var i="function"==typeof n?n(a.options):n;u(),a.options=Object.assign({},r,a.options,i),a.scrollParents={reference:uS(e)?JS(e):e.contextElement?JS(e.contextElement):[],popper:JS(t)};var o,l,h=function(e){var t=lA(e);return cS.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((o=[].concat(s,a.options.modifiers),l=o.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(l).map((function(e){return l[e]}))));return a.orderedModifiers=h.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,s=void 0===n?{}:n,i=e.effect;if("function"==typeof i){var r=i({state:a,name:t,instance:d,options:s}),o=function(){};c.push(r||o)}})),d.update()},forceUpdate:function(){if(!l){var e=a.elements,t=e.reference,n=e.popper;if(uA(t,n)){a.rects={reference:cA(t,kS(n),"fixed"===a.options.strategy),popper:SS(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var s=0;s<a.orderedModifiers.length;s++)if(!0!==a.reset){var i=a.orderedModifiers[s],r=i.fn,o=i.options,c=void 0===o?{}:o,u=i.name;"function"==typeof r&&(a=r({state:a,options:c,name:u,instance:d})||a)}else a.reset=!1,s=-1}}},update:(i=function(){return new Promise((function(e){d.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(i())}))}))),o}),destroy:function(){u(),l=!0}};if(!uA(e,t))return d;function u(){c.forEach((function(e){return e()})),c=[]}return d.setOptions(n).then((function(e){!l&&n.onFirstUpdate&&n.onFirstUpdate(e)})),d}}var fA=hA(),mA=hA({defaultModifiers:[US,oA,LS,mS,rA,tA,aA,IS,iA]}),gA=hA({defaultModifiers:[US,oA,LS,mS]});const pA=new Map,vA={set(e,t,n){pA.has(e)||pA.set(e,new Map);const s=pA.get(e);s.has(t)||0===s.size?s.set(t,n):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(s.keys())[0]}.`)},get:(e,t)=>pA.has(e)&&pA.get(e).get(t)||null,remove(e,t){if(!pA.has(e))return;const n=pA.get(e);n.delete(t),0===n.size&&pA.delete(e)}},bA="transitionend",yA=e=>(e&&window.CSS&&window.CSS.escape&&(e=e.replace(/#([^\s"#']+)/g,((e,t)=>`#${CSS.escape(t)}`))),e),_A=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),wA=e=>_A(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(yA(e)):null,SA=e=>{if(!_A(e)||0===e.getClientRects().length)return!1;const t="visible"===getComputedStyle(e).getPropertyValue("visibility"),n=e.closest("details:not([open])");if(!n)return t;if(n!==e){const t=e.closest("summary");if(t&&t.parentNode!==n)return!1;if(null===t)return!1}return t},AA=e=>!e||e.nodeType!==Node.ELEMENT_NODE||(!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled"))),xA=e=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof e.getRootNode){const t=e.getRootNode();return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?xA(e.parentNode):null},$A=()=>{},EA=e=>{e.offsetHeight},jA=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,CA=[],kA=()=>"rtl"===document.documentElement.dir,TA=e=>{var t;t=()=>{const t=jA();if(t){const n=e.NAME,s=t.fn[n];t.fn[n]=e.jQueryInterface,t.fn[n].Constructor=e,t.fn[n].noConflict=()=>(t.fn[n]=s,e.jQueryInterface)}},"loading"===document.readyState?(CA.length||document.addEventListener("DOMContentLoaded",(()=>{for(const e of CA)e()})),CA.push(t)):t()},OA=(e,t=[],n=e)=>"function"==typeof e?e.call(...t):n,NA=(e,t,n=!0)=>{if(!n)return void OA(e);const s=(e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:n}=window.getComputedStyle(e);const s=Number.parseFloat(t),i=Number.parseFloat(n);return s||i?(t=t.split(",")[0],n=n.split(",")[0],1e3*(Number.parseFloat(t)+Number.parseFloat(n))):0})(t)+5;let i=!1;const r=({target:n})=>{n===t&&(i=!0,t.removeEventListener(bA,r),OA(e))};t.addEventListener(bA,r),setTimeout((()=>{i||t.dispatchEvent(new Event(bA))}),s)},MA=/[^.]*(?=\..*)\.|.*/,IA=/\..*/,RA=/::\d+$/,DA={};let zA=1;const LA={mouseenter:"mouseover",mouseleave:"mouseout"},PA=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function UA(e,t){return t&&`${t}::${zA++}`||e.uidEvent||zA++}function BA(e){const t=UA(e);return e.uidEvent=t,DA[t]=DA[t]||{},DA[t]}function qA(e,t,n=null){return Object.values(e).find((e=>e.callable===t&&e.delegationSelector===n))}function FA(e,t,n){const s="string"==typeof t,i=s?n:t||n;let r=VA(e);return PA.has(r)||(r=e),[s,i,r]}function HA(e,t,n,s,i){if("string"!=typeof t||!e)return;let[r,o,a]=FA(t,n,s);if(t in LA){const e=e=>function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)};o=e(o)}const c=BA(e),l=c[a]||(c[a]={}),d=qA(l,o,r?n:null);if(d)return void(d.oneOff=d.oneOff&&i);const u=UA(o,t.replace(MA,"")),h=r?function(e,t,n){return function s(i){const r=e.querySelectorAll(t);for(let{target:o}=i;o&&o!==this;o=o.parentNode)for(const a of r)if(a===o)return JA(i,{delegateTarget:o}),s.oneOff&&KA.off(e,i.type,t,n),n.apply(o,[i])}}(e,n,o):function(e,t){return function n(s){return JA(s,{delegateTarget:e}),n.oneOff&&KA.off(e,s.type,t),t.apply(e,[s])}}(e,o);h.delegationSelector=r?n:null,h.callable=o,h.oneOff=i,h.uidEvent=u,l[u]=h,e.addEventListener(a,h,r)}function GA(e,t,n,s,i){const r=qA(t[n],s,i);r&&(e.removeEventListener(n,r,Boolean(i)),delete t[n][r.uidEvent])}function WA(e,t,n,s){const i=t[n]||{};for(const[r,o]of Object.entries(i))r.includes(s)&&GA(e,t,n,o.callable,o.delegationSelector)}function VA(e){return e=e.replace(IA,""),LA[e]||e}const KA={on(e,t,n,s){HA(e,t,n,s,!1)},one(e,t,n,s){HA(e,t,n,s,!0)},off(e,t,n,s){if("string"!=typeof t||!e)return;const[i,r,o]=FA(t,n,s),a=o!==t,c=BA(e),l=c[o]||{},d=t.startsWith(".");if(void 0===r){if(d)for(const n of Object.keys(c))WA(e,c,n,t.slice(1));for(const[n,s]of Object.entries(l)){const i=n.replace(RA,"");a&&!t.includes(i)||GA(e,c,o,s.callable,s.delegationSelector)}}else{if(!Object.keys(l).length)return;GA(e,c,o,r,i?n:null)}},trigger(e,t,n){if("string"!=typeof t||!e)return null;const s=jA();let i=null,r=!0,o=!0,a=!1;t!==VA(t)&&s&&(i=s.Event(t,n),s(e).trigger(i),r=!i.isPropagationStopped(),o=!i.isImmediatePropagationStopped(),a=i.isDefaultPrevented());const c=JA(new Event(t,{bubbles:r,cancelable:!0}),n);return a&&c.preventDefault(),o&&e.dispatchEvent(c),c.defaultPrevented&&i&&i.preventDefault(),c}};function JA(e,t={}){for(const[n,s]of Object.entries(t))try{e[n]=s}catch{Object.defineProperty(e,n,{configurable:!0,get:()=>s})}return e}const YA=KA;function XA(e){if("true"===e)return!0;if("false"===e)return!1;if(e===Number(e).toString())return Number(e);if(""===e||"null"===e)return null;if("string"!=typeof e)return e;try{return JSON.parse(decodeURIComponent(e))}catch{return e}}function QA(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}const ZA={setDataAttribute(e,t,n){e.setAttribute(`data-bs-${QA(t)}`,n)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${QA(t)}`)},getDataAttributes(e){if(!e)return{};const t={},n=Object.keys(e.dataset).filter((e=>e.startsWith("bs")&&!e.startsWith("bsConfig")));for(const s of n){let n=s.replace(/^bs/,"");n=n.charAt(0).toLowerCase()+n.slice(1),t[n]=XA(e.dataset[s])}return t},getDataAttribute:(e,t)=>XA(e.getAttribute(`data-bs-${QA(t)}`))},ex=ZA;const tx=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const n=_A(t)?ex.getDataAttribute(t,"config"):{};return{...this.constructor.Default,..."object"==typeof n?n:{},..._A(t)?ex.getDataAttributes(t):{},..."object"==typeof e?e:{}}}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[s,i]of Object.entries(t)){const t=e[s],r=_A(t)?"element":null==(n=t)?`${n}`:Object.prototype.toString.call(n).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(i).test(r))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${s}" provided type "${r}" but expected type "${i}".`)}var n}};const nx=class extends tx{constructor(e,t){super(),(e=wA(e))&&(this._element=e,this._config=this._getConfig(t),vA.set(this._element,this.constructor.DATA_KEY,this))}dispose(){vA.remove(this._element,this.constructor.DATA_KEY),YA.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,n=!0){NA(e,t,n)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return vA.get(wA(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,"object"==typeof t?t:null)}static get VERSION(){return"5.3.5"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}},sx=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let n=e.getAttribute("href");if(!n||!n.includes("#")&&!n.startsWith("."))return null;n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),t=n&&"#"!==n?n.trim():null}return t?t.split(",").map((e=>yA(e))).join(","):null},ix={find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter((e=>e.matches(t))),parents(e,t){const n=[];let s=e.parentNode.closest(t);for(;s;)n.push(s),s=s.parentNode.closest(t);return n},prev(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return[n];n=n.previousElementSibling}return[]},next(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return[n];n=n.nextElementSibling}return[]},focusableChildren(e){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((e=>`${e}:not([tabindex^="-"])`)).join(",");return this.find(t,e).filter((e=>!AA(e)&&SA(e)))},getSelectorFromElement(e){const t=sx(e);return t&&ix.findOne(t)?t:null},getElementFromSelector(e){const t=sx(e);return t?ix.findOne(t):null},getMultipleElementsFromSelector(e){const t=sx(e);return t?ix.find(t):[]}},rx=ix,ox="dropdown",ax=".bs.dropdown",cx=".data-api",lx="ArrowUp",dx="ArrowDown",ux=`hide${ax}`,hx=`hidden${ax}`,fx=`show${ax}`,mx=`shown${ax}`,gx=`click${ax}${cx}`,px=`keydown${ax}${cx}`,vx=`keyup${ax}${cx}`,bx="show",yx='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',_x=`${yx}.${bx}`,wx=".dropdown-menu",Sx=kA()?"top-end":"top-start",Ax=kA()?"top-start":"top-end",xx=kA()?"bottom-end":"bottom-start",$x=kA()?"bottom-start":"bottom-end",Ex=kA()?"left-start":"right-start",jx=kA()?"right-start":"left-start",Cx={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},kx={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Tx extends nx{constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=rx.next(this._element,wx)[0]||rx.prev(this._element,wx)[0]||rx.findOne(wx,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Cx}static get DefaultType(){return kx}static get NAME(){return ox}toggle(){return this._isShown()?this.hide():this.show()}show(){if(AA(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!YA.trigger(this._element,fx,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const e of[].concat(...document.body.children))YA.on(e,"mouseover",$A);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(bx),this._element.classList.add(bx),YA.trigger(this._element,mx,e)}}hide(){if(AA(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!YA.trigger(this._element,ux,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))YA.off(e,"mouseover",$A);this._popper&&this._popper.destroy(),this._menu.classList.remove(bx),this._element.classList.remove(bx),this._element.setAttribute("aria-expanded","false"),ex.removeDataAttribute(this._menu,"popper"),YA.trigger(this._element,hx,e)}}_getConfig(e){if("object"==typeof(e=super._getConfig(e)).reference&&!_A(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${ox.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){let e=this._element;"parent"===this._config.reference?e=this._parent:_A(this._config.reference)?e=wA(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference);const t=this._getPopperConfig();this._popper=mA(e,this._menu,t)}_isShown(){return this._menu.classList.contains(bx)}_getPlacement(){const e=this._parent;if(e.classList.contains("dropend"))return Ex;if(e.classList.contains("dropstart"))return jx;if(e.classList.contains("dropup-center"))return"top";if(e.classList.contains("dropdown-center"))return"bottom";const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return e.classList.contains("dropup")?t?Ax:Sx:t?$x:xx}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(ex.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...OA(this._config.popperConfig,[void 0,e])}}_selectMenuItem({key:e,target:t}){const n=rx.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((e=>SA(e)));n.length&&((e,t,n,s)=>{const i=e.length;let r=e.indexOf(t);return-1===r?!n&&s?e[i-1]:e[0]:(r+=n?1:-1,s&&(r=(r+i)%i),e[Math.max(0,Math.min(r,i-1))])})(n,t,e===dx,!n.includes(t)).focus()}static jQueryInterface(e){return this.each((function(){const t=Tx.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}static clearMenus(e){if(2===e.button||"keyup"===e.type&&"Tab"!==e.key)return;const t=rx.find(_x);for(const n of t){const t=Tx.getInstance(n);if(!t||!1===t._config.autoClose)continue;const s=e.composedPath(),i=s.includes(t._menu);if(s.includes(t._element)||"inside"===t._config.autoClose&&!i||"outside"===t._config.autoClose&&i)continue;if(t._menu.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const r={relatedTarget:t._element};"click"===e.type&&(r.clickEvent=e),t._completeHide(r)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),n="Escape"===e.key,s=[lx,dx].includes(e.key);if(!s&&!n)return;if(t&&!n)return;e.preventDefault();const i=this.matches(yx)?this:rx.prev(this,yx)[0]||rx.next(this,yx)[0]||rx.findOne(yx,e.delegateTarget.parentNode),r=Tx.getOrCreateInstance(i);if(s)return e.stopPropagation(),r.show(),void r._selectMenuItem(e);r._isShown()&&(e.stopPropagation(),r.hide(),i.focus())}}YA.on(document,px,yx,Tx.dataApiKeydownHandler),YA.on(document,px,wx,Tx.dataApiKeydownHandler),YA.on(document,gx,Tx.clearMenus),YA.on(document,vx,Tx.clearMenus),YA.on(document,gx,yx,(function(e){e.preventDefault(),Tx.getOrCreateInstance(this).toggle()})),TA(Tx);const Ox=Tx;class Nx extends O_{firstUpdated(e){super.firstUpdated(e),this.menu=this.querySelector(".dropdown-menu"),this.button=this.querySelector("button"),this.dropdown=new Ox(this.button)}}YA.off(document,"keydown.bs.dropdown.data-api");var Mx=n(1353),Ix={};Ix.styleTagTransform=L(),Ix.setAttributes=I(),Ix.insert=N().bind(null,"head"),Ix.domAPI=T(),Ix.insertStyleElement=D();C()(Mx.A,Ix);Mx.A&&Mx.A.locals&&Mx.A.locals;ad.elements.define("converse-icon",class extends O_{static get properties(){return{color:{type:String},class_name:{attribute:"class"},css:{type:String},size:{type:String}}}constructor(){super(),this.class_name="",this.css="",this.size="",this.color=""}getSource(){return`#icon-${this.class_name.trim().split(" ")[1].replace("fa-","")}`}getStyles(){const e=this.color.match(/var\((--.*)\)/)?.[1],t=e?getComputedStyle(this).getPropertyValue(e):this.color;return`\n            ${this.size?`width: ${this.size};`:""}\n            ${this.size?`height: ${this.size};`:""}\n            ${t?`fill: ${t};`:""}\n            ${this.css}\n        `}render(){return wh`<svg .style="${this.getStyles()}"><use href="${this.getSource()}"></use></svg>`}});var Rx=n(3557),Dx={};Dx.styleTagTransform=L(),Dx.setAttributes=I(),Dx.insert=N().bind(null,"head"),Dx.domAPI=T(),Dx.insertStyleElement=D();C()(Rx.A,Dx);Rx.A&&Rx.A.locals&&Rx.A.locals;const{KEYCODES:zx}=__;class Lx extends Nx{static get properties(){return{icon_classes:{type:String},items:{type:Array}}}constructor(){super(),this.icon_classes="fa fa-bars",this.items=[],this.id=Rf.getUniqueId()}render(){return wh`<button class="btn btn--transparent btn--standalone dropdown-toggle dropdown-toggle--no-caret" id="${this.id}" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="${C_("Menu")}"><converse-icon aria-hidden="true" size="1em" class="${this.icon_classes}"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}">${this.items.map((e=>wh`<li>${Q_(e,"")}</li>`))}</ul>`}firstUpdated(){super.firstUpdated(),this.initArrowNavigation()}connectedCallback(){super.connectedCallback(),this.registerEvents()}disconnectedCallback(){this.removeEventListener("keydown",this.onKeyDown),this.disableArrowNavigation(),super.disconnectedCallback()}registerEvents(){this.onKeyDown=e=>this.#a(e),this.addEventListener("hide.bs.dropdown",(()=>this.onDropdownHide())),this.addEventListener("keydown",this.onKeyDown)}onDropdownHide(){this.disableArrowNavigation()}initArrowNavigation(){if(!this.navigator){const e={selector:".dropdown-menu li",onSelected:e=>e.focus()};this.navigator=new Lw(this.menu,e)}}disableArrowNavigation(){this.navigator?.disable()}enableArrowNavigation(e){e?.preventDefault(),e?.stopPropagation(),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.select(this.menu.firstElementChild)}onEnterPressed(e){e.preventDefault(),e.stopPropagation(),this.navigator.selected?.querySelector("a")?.click(),this.dropdown.hide()}#a(e){this.navigator&&Rf.isVisible(this)&&(e.key===zx.ENTER?this.onEnterPressed(e):e.key!==zx.DOWN_ARROW||this.navigator.enabled?e.key===zx.ESCAPE&&this.dropdown.hide():this.enableArrowNavigation(e))}}ad.elements.define("converse-dropdown",Lx);ad.elements.define("converse-fontawesome",class extends O_{render(){return wh`<?xml version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" style="display:none"><symbol id="icon-filter" viewBox="0 0 512 512"><path d="M3.9 54.9C10.5 40.9 24.5 32 40 32H472c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9V448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6V320.9L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/></symbol><symbol id="icon-address-book" viewBox="0 0 448 512"><path d="M436 160c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20zm-228-32c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H118.4C106 384 96 375.4 96 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z"></path></symbol><symbol id="icon-angle-double-down" viewBox="0 0 320 512"><path d="M143 256.3L7 120.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0L313 86.3c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.4 9.5-24.6 9.5-34 .1zm34 192l136-136c9.4-9.4 9.4-24.6 0-33.9l-22.6-22.6c-9.4-9.4-24.6-9.4-33.9 0L160 352.1l-96.4-96.4c-9.4-9.4-24.6-9.4-33.9 0L7 278.3c-9.4 9.4-9.4 24.6 0 33.9l136 136c9.4 9.5 24.6 9.5 34 .1z"></path></symbol><symbol id="icon-angle-double-left" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"></path></symbol><symbol id="icon-angle-double-right" viewBox="0 0 448 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"></path></symbol><symbol id="icon-angle-double-up" viewBox="0 0 320 512"><path d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"></path></symbol><symbol id="icon-angle-down" viewBox="0 0 320 512"><path d="M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"></path></symbol><symbol id="icon-angle-left" viewBox="0 0 256 512"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path></symbol><symbol id="icon-angle-right" viewBox="0 0 256 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></symbol><symbol id="icon-angle-up" viewBox="0 0 320 512"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"></path></symbol><symbol id="icon-arrow-alt-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm116-292H256v-70.9c0-10.7-13-16.1-20.5-8.5L121.2 247.5c-4.7 4.7-4.7 12.2 0 16.9l114.3 114.9c7.6 7.6 20.5 2.2 20.5-8.5V300h116c6.6 0 12-5.4 12-12v-64c0-6.6-5.4-12-12-12z"></path></symbol><symbol id="icon-arrow-alt-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zM140 300h116v70.9c0 10.7 13 16.1 20.5 8.5l114.3-114.9c4.7-4.7 4.7-12.2 0-16.9l-114.3-115c-7.6-7.6-20.5-2.2-20.5 8.5V212H140c-6.6 0-12 5.4-12 12v64c0 6.6 5.4 12 12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-arrow-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-143.6-28.9L288 302.6V120c0-13.3-10.7-24-24-24h-16c-13.3 0-24 10.7-24 24v182.6l-72.4-75.5c-9.3-9.7-24.8-9.9-34.3-.4l-10.9 11c-9.4 9.4-9.4 24.6 0 33.9L239 404.3c9.4 9.4 24.6 9.4 33.9 0l132.7-132.7c9.4-9.4 9.4-24.6 0-33.9l-10.9-11c-9.5-9.5-25-9.3-34.3.4z"></path></symbol><symbol id="icon-arrow-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm28.9-143.6L209.4 288H392c13.3 0 24-10.7 24-24v-16c0-13.3-10.7-24-24-24H209.4l75.5-72.4c9.7-9.3 9.9-24.8.4-34.3l-11-10.9c-9.4-9.4-24.6-9.4-33.9 0L107.7 239c-9.4 9.4-9.4 24.6 0 33.9l132.7 132.7c9.4 9.4 24.6 9.4 33.9 0l11-10.9c9.5-9.5 9.3-25-.4-34.3z"></path></symbol><symbol id="icon-arrow-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></symbol><symbol id="icon-arrow-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm143.6 28.9l72.4-75.5V392c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V209.4l72.4 75.5c9.3 9.7 24.8 9.9 34.3.4l10.9-11c9.4-9.4 9.4-24.6 0-33.9L273 107.7c-9.4-9.4-24.6-9.4-33.9 0L106.3 240.4c-9.4 9.4-9.4 24.6 0 33.9l10.9 11c9.6 9.5 25.1 9.3 34.4-.4z"></path></symbol><symbol id="icon-arrow-down" viewBox="0 0 448 512"><path d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"></path></symbol><symbol id="icon-arrow-left" viewBox="0 0 448 512"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 448 512"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></symbol><symbol id="icon-arrow-up" viewBox="0 0 448 512"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></symbol><symbol id="icon-arrows-alt" viewBox="0 0 512 512"><path d="M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"></path></symbol><symbol id="icon-arrows-alt-h" viewBox="0 0 512 512"><path d="M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z"></path></symbol><symbol id="icon-arrows-alt-v" viewBox="0 0 256 512"><path d="M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"></path></symbol><symbol id="icon-bars" viewBox="0 0 448 512"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></symbol><symbol id="icon-bookmark" viewBox="0 0 384 512"><path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"></path></symbol><symbol id="icon-bookmark-empty" viewBox="0 0 384 512"><path d="M0 48C0 21.5 21.5 0 48 0l0 48V441.4l130.1-92.9c8.3-6 19.6-6 27.9 0L336 441.4V48H48V0H336c26.5 0 48 21.5 48 48V488c0 9-5 17.2-13 21.3s-17.6 3.4-24.9-1.8L192 397.5 37.9 507.5c-7.3 5.2-16.9 5.9-24.9 1.8S0 497 0 488V48z"/></symbol><symbol id="icon-caret-down" viewBox="0 0 320 512"><path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></symbol><symbol id="icon-caret-right" viewBox="0 0 192 512"><path d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></symbol><symbol id="icon-check" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path></symbol><symbol id="icon-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></symbol><symbol id="icon-cog" viewBox="0 0 512 512"><path d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path></symbol><symbol id="icon-database" viewBox="0 0 448 512"><path d="M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"></path></symbol><symbol id="icon-edit" viewBox="0 0 576 512"><path d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"></path></symbol><symbol id="icon-eye" viewBox="0 0 576 512"><path d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></symbol><symbol id="icon-eye-slash" viewBox="0 0 640 512"><path d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"></path></symbol><symbol id="icon-gavel" viewBox="0 0 512 512"><path d="M504.971 199.362l-22.627-22.627c-9.373-9.373-24.569-9.373-33.941 0l-5.657 5.657L329.608 69.255l5.657-5.657c9.373-9.373 9.373-24.569 0-33.941L312.638 7.029c-9.373-9.373-24.569-9.373-33.941 0L154.246 131.48c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l5.657-5.657 39.598 39.598-81.04 81.04-5.657-5.657c-12.497-12.497-32.758-12.497-45.255 0L9.373 412.118c-12.497 12.497-12.497 32.758 0 45.255l45.255 45.255c12.497 12.497 32.758 12.497 45.255 0l114.745-114.745c12.497-12.497 12.497-32.758 0-45.255l-5.657-5.657 81.04-81.04 39.598 39.598-5.657 5.657c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l124.451-124.451c9.372-9.372 9.372-24.568 0-33.941z"></path></symbol><symbol id="icon-globe" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></symbol><symbol id="icon-id-card" viewBox="0 0 576 512"><path d="M528 32H48C21.5 32 0 53.5 0 80v16h576V80c0-26.5-21.5-48-48-48zM0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V128H0v304zm352-232c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zM176 192c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zM67.1 396.2C75.5 370.5 99.6 352 128 352h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.9-5.2 19.8-15.6 19.8H82.7c-10.4 0-18.8-10-15.6-19.8z"></path></symbol><symbol id="icon-id-card-alt" viewBox="0 0 576 512"><path d="M528 64H384v96H192V64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM288 224c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm93.3 224H194.7c-10.4 0-18.8-10-15.6-19.8 8.3-25.6 32.4-44.2 60.9-44.2h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.8-5.2 19.8-15.6 19.8zM352 32c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v96h128V32z"></path></symbol><symbol id="icon-info" viewBox="0 0 192 512"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></symbol><symbol id="icon-info-circle" viewBox="0 0 512 512"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></symbol><symbol id="icon-list-ul" viewBox="0 0 512 512"><path d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-lock" viewBox="0 0 448 512"><path d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"></path></symbol><symbol id="icon-lock-open" viewBox="0 0 576 512"><path d="M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"></path></symbol><symbol id="icon-minus" viewBox="0 0 448 512"><path d="M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-minus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"></path></symbol><symbol id="icon-minus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"></path></symbol><symbol id="icon-paper-plane" viewBox="0 0 512 512"><path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"></path></symbol><symbol id="icon-paperclip" viewBox="0 0 448 512"><path d="M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"></path></symbol><symbol id="icon-pencil-alt" viewBox="0 0 512 512"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"></path></symbol><symbol id="icon-phone" viewBox="0 0 512 512"><path d="M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"></path></symbol><symbol id="icon-plus" viewBox="0 0 448 512"><path d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-plus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-plus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-save" viewBox="0 0 448 512"><path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"></path></symbol><symbol id="icon-sign-out-alt" viewBox="0 0 512 512"><path d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-smile" viewBox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"></path></symbol><symbol id="icon-snowflake" viewBox="0 0 448 512"><path d="M440.3 345.2l-33.8-19.5 26-7c8.2-2.2 13.1-10.7 10.9-18.9l-4-14.9c-2.2-8.2-10.7-13.1-18.9-10.9l-70.8 19-63.9-37 63.8-36.9 70.8 19c8.2 2.2 16.7-2.7 18.9-10.9l4-14.9c2.2-8.2-2.7-16.7-10.9-18.9l-26-7 33.8-19.5c7.4-4.3 9.9-13.7 5.7-21.1L430.4 119c-4.3-7.4-13.7-9.9-21.1-5.7l-33.8 19.5 7-26c2.2-8.2-2.7-16.7-10.9-18.9l-14.9-4c-8.2-2.2-16.7 2.7-18.9 10.9l-19 70.8-62.8 36.2v-77.5l53.7-53.7c6.2-6.2 6.2-16.4 0-22.6l-11.3-11.3c-6.2-6.2-16.4-6.2-22.6 0L256 56.4V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v40.4l-19.7-19.7c-6.2-6.2-16.4-6.2-22.6 0L138.3 48c-6.3 6.2-6.3 16.4 0 22.6l53.7 53.7v77.5l-62.8-36.2-19-70.8c-2.2-8.2-10.7-13.1-18.9-10.9l-14.9 4c-8.2 2.2-13.1 10.7-10.9 18.9l7 26-33.8-19.5c-7.4-4.3-16.8-1.7-21.1 5.7L2.1 145.7c-4.3 7.4-1.7 16.8 5.7 21.1l33.8 19.5-26 7c-8.3 2.2-13.2 10.7-11 19l4 14.9c2.2 8.2 10.7 13.1 18.9 10.9l70.8-19 63.8 36.9-63.8 36.9-70.8-19c-8.2-2.2-16.7 2.7-18.9 10.9l-4 14.9c-2.2 8.2 2.7 16.7 10.9 18.9l26 7-33.8 19.6c-7.4 4.3-9.9 13.7-5.7 21.1l15.5 26.8c4.3 7.4 13.7 9.9 21.1 5.7l33.8-19.5-7 26c-2.2 8.2 2.7 16.7 10.9 18.9l14.9 4c8.2 2.2 16.7-2.7 18.9-10.9l19-70.8 62.8-36.2v77.5l-53.7 53.7c-6.3 6.2-6.3 16.4 0 22.6l11.3 11.3c6.2 6.2 16.4 6.2 22.6 0l19.7-19.7V496c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-40.4l19.7 19.7c6.2 6.2 16.4 6.2 22.6 0l11.3-11.3c6.2-6.2 6.2-16.4 0-22.6L256 387.7v-77.5l62.8 36.2 19 70.8c2.2 8.2 10.7 13.1 18.9 10.9l14.9-4c8.2-2.2 13.1-10.7 10.9-18.9l-7-26 33.8 19.5c7.4 4.3 16.8 1.7 21.1-5.7l15.5-26.8c4.3-7.3 1.8-16.8-5.6-21z"></path></symbol><symbol id="icon-spinner" viewBox="0 0 512 512"><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"></path></symbol><symbol id="icon-sync" viewBox="0 0 512 512"><path d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"></path></symbol><symbol id="icon-times" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></symbol><symbol id="icon-times-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path></symbol><symbol id="icon-trash" viewBox="0 0 448 512"><path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"></path></symbol><symbol id="icon-trash-alt" viewBox="0 0 448 512"><path d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-unlock" viewBox="0 0 448 512"><path d="M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"></path></symbol><symbol id="icon-user" viewBox="0 0 448 512"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-cog" viewBox="0 0 640 512"><path d="M610.5 373.3c2.6-14.1 2.6-28.5 0-42.6l25.8-14.9c3-1.7 4.3-5.2 3.3-8.5-6.7-21.6-18.2-41.2-33.2-57.4-2.3-2.5-6-3.1-9-1.4l-25.8 14.9c-10.9-9.3-23.4-16.5-36.9-21.3v-29.8c0-3.4-2.4-6.4-5.7-7.1-22.3-5-45-4.8-66.2 0-3.3.7-5.7 3.7-5.7 7.1v29.8c-13.5 4.8-26 12-36.9 21.3l-25.8-14.9c-2.9-1.7-6.7-1.1-9 1.4-15 16.2-26.5 35.8-33.2 57.4-1 3.3.4 6.8 3.3 8.5l25.8 14.9c-2.6 14.1-2.6 28.5 0 42.6l-25.8 14.9c-3 1.7-4.3 5.2-3.3 8.5 6.7 21.6 18.2 41.1 33.2 57.4 2.3 2.5 6 3.1 9 1.4l25.8-14.9c10.9 9.3 23.4 16.5 36.9 21.3v29.8c0 3.4 2.4 6.4 5.7 7.1 22.3 5 45 4.8 66.2 0 3.3-.7 5.7-3.7 5.7-7.1v-29.8c13.5-4.8 26-12 36.9-21.3l25.8 14.9c2.9 1.7 6.7 1.1 9-1.4 15-16.2 26.5-35.8 33.2-57.4 1-3.3-.4-6.8-3.3-8.5l-25.8-14.9zM496 400.5c-26.8 0-48.5-21.8-48.5-48.5s21.8-48.5 48.5-48.5 48.5 21.8 48.5 48.5-21.7 48.5-48.5 48.5zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm201.2 226.5c-2.3-1.2-4.6-2.6-6.8-3.9l-7.9 4.6c-6 3.4-12.8 5.3-19.6 5.3-10.9 0-21.4-4.6-28.9-12.6-18.3-19.8-32.3-43.9-40.2-69.6-5.5-17.7 1.9-36.4 17.9-45.7l7.9-4.6c-.1-2.6-.1-5.2 0-7.8l-7.9-4.6c-16-9.2-23.4-28-17.9-45.7.9-2.9 2.2-5.8 3.2-8.7-3.8-.3-7.5-1.2-11.4-1.2h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c10.1 0 19.5-3.2 27.2-8.5-1.2-3.8-2-7.7-2-11.8v-9.2z"></path></symbol><symbol id="icon-user-plus" viewBox="0 0 640 512"><path d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-secret" viewBox="0 0 448 512"><path d="M383.9 308.3l23.9-62.6c4-10.5-3.7-21.7-15-21.7h-58.5c11-18.9 17.8-40.6 17.8-64v-.3c39.2-7.8 64-19.1 64-31.7 0-13.3-27.3-25.1-70.1-33-9.2-32.8-27-65.8-40.6-82.8-9.5-11.9-25.9-15.6-39.5-8.8l-27.6 13.8c-9 4.5-19.6 4.5-28.6 0L182.1 3.4c-13.6-6.8-30-3.1-39.5 8.8-13.5 17-31.4 50-40.6 82.8-42.7 7.9-70 19.7-70 33 0 12.6 24.8 23.9 64 31.7v.3c0 23.4 6.8 45.1 17.8 64H56.3c-11.5 0-19.2 11.7-14.7 22.3l25.8 60.2C27.3 329.8 0 372.7 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-48.4-25.8-90.4-64.1-114.1zM176 480l-41.6-192 49.6 32 24 40-32 120zm96 0l-32-120 24-40 49.6-32L272 480zm41.7-298.5c-3.9 11.9-7 24.6-16.5 33.4-10.1 9.3-48 22.4-64-25-2.8-8.4-15.4-8.4-18.3 0-17 50.2-56 32.4-64 25-9.5-8.8-12.7-21.5-16.5-33.4-.8-2.5-6.3-5.7-6.3-5.8v-10.8c28.3 3.6 61 5.8 96 5.8s67.7-2.1 96-5.8v10.8c-.1.1-5.6 3.2-6.4 5.8z"></path></symbol><symbol id="icon-users" viewBox="0 0 640 512"><path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path></symbol><symbol id="icon-wrench" viewBox="0 0 512 512"><path d="M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"></path></symbol><symbol id="icon-refresh" viewBox="0 0 512 512"><path d="M464 16c-17.67 0-32 14.31-32 32v74.09C392.1 66.52 327.4 32 256 32C161.5 32 78.59 92.34 49.58 182.2c-5.438 16.81 3.797 34.88 20.61 40.28c16.89 5.5 34.88-3.812 40.3-20.59C130.9 138.5 189.4 96 256 96c50.5 0 96.26 24.55 124.4 64H336c-17.67 0-32 14.31-32 32s14.33 32 32 32h128c17.67 0 32-14.31 32-32V48C496 30.31 481.7 16 464 16zM441.8 289.6c-16.92-5.438-34.88 3.812-40.3 20.59C381.1 373.5 322.6 416 256 416c-50.5 0-96.25-24.55-124.4-64H176c17.67 0 32-14.31 32-32s-14.33-32-32-32h-128c-17.67 0-32 14.31-32 32v144c0 17.69 14.33 32 32 32s32-14.31 32-32v-74.09C119.9 445.5 184.6 480 255.1 480c94.45 0 177.4-60.34 206.4-150.2C467.9 313 458.6 294.1 441.8 289.6z"></path></symbol><symbol id="icon-copy" viewBox="0 0 448 512"><path d="M320 448v40c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V120c0-13.3 10.7-24 24-24h72v296c0 30.9 25.1 56 56 56h168zm0-344V0H152c-13.3 0-24 10.7-24 24v368c0 13.3 10.7 24 24 24h272c13.3 0 24-10.7 24-24V128H344c-13.2 0-24-10.8-24-24zm121-31L375 7A24 24 0 0 0 358.1 0H352v96h96v-6.1a24 24 0 0 0 -7-17z"></path></symbol><symbol id="icon-quote-right" viewBox="0 0 512 512"><path d="M464 32H336c-26.5 0-48 21.5-48 48v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48zm-288 0H48C21.5 32 0 53.5 0 80v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48z"></path></symbol><symbol id="icon-bell" viewBox="0 0 512 512"><path d="M224 0c-17.7 0-32 14.3-32 32l0 19.2C119 66 64 130.6 64 208l0 18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416l384 0c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3C401.3 319.2 384 273.9 384 226.8l0-18.8c0-77.4-55-142-128-156.8L256 32c0-17.7-14.3-32-32-32zm45.3 493.3c12-12 18.7-28.3 18.7-45.3l-64 0-64 0c0 17 6.7 33.3 18.7 45.3s28.3 18.7 45.3 18.7s33.3-6.7 45.3-18.7z"></path></symbol><symbol id="icon-bell-alt" viewBox="0 0 512 512"><path d="M224 0c-17.7 0-32 14.3-32 32l0 19.2C119 66 64 130.6 64 208l0 25.4c0 45.4-15.5 89.5-43.8 124.9L5.3 377c-5.8 7.2-6.9 17.1-2.9 25.4S14.8 416 24 416l400 0c9.2 0 17.6-5.3 21.6-13.6s2.9-18.2-2.9-25.4l-14.9-18.6C399.5 322.9 384 278.8 384 233.4l0-25.4c0-77.4-55-142-128-156.8L256 32c0-17.7-14.3-32-32-32zm0 96c61.9 0 112 50.1 112 112l0 25.4c0 47.9 13.9 94.6 39.7 134.6L72.3 368C98.1 328 112 281.3 112 233.4l0-25.4c0-61.9 50.1-112 112-112zm64 352l-64 0-64 0c0 17 6.7 33.3 18.7 45.3s28.3 18.7 45.3 18.7s33.3-6.7 45.3-18.7s18.7-28.3 18.7-45.3z"></path></symbol></svg>`}});var Px=n(2778),Ux={};Ux.styleTagTransform=L(),Ux.setAttributes=I(),Ux.insert=N().bind(null,"head"),Ux.domAPI=T(),Ux.insertStyleElement=D();C()(Px.A,Ux);Px.A&&Px.A.locals&&Px.A.locals;const Bx=C_("Click to set a new picture"),qx=C_("Clear picture");ad.elements.define("converse-image-picker",class extends O_{constructor(){super(),this.model=null,this.width=null,this.height=null,this.nonce=null}static get properties(){return{height:{type:Number},model:{type:Object},width:{type:Number}}}render(){return wh`<div class="image-picker"><a class="change-avatar" @click="${this.openFileSelection}" title="${Bx}"><converse-avatar .model="${this.model}" .pickerdata="${this.data}" class="avatar" name="${this.model.getDisplayName()}" height="${this.height}" nonce="${this.nonce||this.model.vcard?.get("vcard_updated")}" width="${this.width}"></converse-avatar></a>${this.data?.data_uri||this.model?.vcard?.get("image")?wh`<button class="clear-image" @click="${this.clearImage}" title="${qx}"><converse-icon class="fa fa-trash-alt" size="1.5em"></converse-icon></button>`:""} <input @change="${this.updateFilePreview}" class="hidden" name="avatar_image" type="file"></div>`}clearImage(e){e.preventDefault();this.querySelector('input[name="avatar_image').value="",this.model.vcard.set({image:null,image_type:null}),this.data={data_uri:null,image_type:null},this.nonce=(new Date).toISOString(),this.requestUpdate()}openFileSelection(e){e.preventDefault(),this.querySelector('input[type="file"]').click()}updateFilePreview(e){const t=e.target.files[0],n=new FileReader;n.onloadend=()=>{this.data={data_uri:n.result,image_type:t.type},this.nonce=(new Date).toISOString(),this.requestUpdate()},n.readAsDataURL(t)}});var Fx=n(1709),Hx={};Hx.styleTagTransform=L(),Hx.setAttributes=I(),Hx.insert=N().bind(null,"head"),Hx.domAPI=T(),Hx.insertStyleElement=D();C()(Fx.A,Hx);Fx.A&&Fx.A.locals&&Fx.A.locals;ad.elements.define("converse-list-filter",class extends O_{constructor(){super(),this.items=null,this.model=null,this.template=null,this.promise=Promise.resolve()}static get properties(){return{items:{type:Array},model:{type:Object},promise:{type:Promise},template:{type:Object}}}initialize(){this.liveFilter=$o((e=>this.model.save({text:e.target.value})),250),this.listenTo(this.items,"add",(()=>this.requestUpdate())),this.listenTo(this.items,"destroy",(()=>this.requestUpdate())),this.listenTo(this.items,"remove",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>{this.dispatchUpdateEvent(),this.requestUpdate()})),this.promise.then((()=>this.requestUpdate())),this.requestUpdate()}render(){return this.shouldBeVisible()?this.template(this):""}dispatchUpdateEvent(){this.dispatchEvent(new CustomEvent("update",{detail:this.model.changed}))}changeChatStateFilter(e){e&&e.preventDefault();const t=this.querySelector(".state-type").value;this.model.save({state:t})}changeTypeFilter(e){e&&e.preventDefault();const t=e.target,n=t.closest("converse-icon")?.dataset.type||"items";if("state"===n){const e=this.querySelector(".state-type").value;this.model.save({type:n,state:e})}else{const e=this.querySelector(".items-filter").value;this.model.save({type:n,text:e})}}submitFilter(e){e?.preventDefault(),this.liveFilter()}isActive(){return"state"===this.model.get("type")||this.model.get("text")}shouldBeVisible(){return this.items?.length>=5||this.isActive()}clearFilter(e){e&&e.preventDefault(),this.model.save({text:""})}});var Gx=n(9495),Wx={};Wx.styleTagTransform=L(),Wx.setAttributes=I(),Wx.insert=N().bind(null,"head"),Wx.domAPI=T(),Wx.insertStyleElement=D();C()(Gx.A,Wx);Gx.A&&Gx.A.locals&&Gx.A.locals;const{dayjs:Vx}=Lf.env;ad.elements.define("converse-message-versions",class extends O_{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}render(){const e=this.model.get("older_versions"),t=Object.keys(e);return wh`${t.length?wh`<h4>${C_("Older versions")}</h4>${t.map((t=>((e,t)=>wh`<p class="older-msg"><time>${Vx(e).format("MMM D, YYYY, HH:mm:ss")}</time>: ${t[e]}</p>`)(t,e)))}`:wh`<h4>${C_("No older versions found")}</h4>`}<hr><h4>${C_("Current version")}</h4><p><time>${Vx(this.model.get("time")).format("MMM D, YYYY, HH:mm:ss")}</time>: ${this.model.getMessageText()}</p>`}});class Kx extends O_{static get properties(){return{...super.properties,observable:{type:String},intersectionRatio:{type:Number}}}constructor(){super(),this.model=null,this.observable=null,this.isVisible=!1,this.observableThresholds=[0,.25,.5,.75,1],this.observableMargin="0px",this.intersectionRatio=.5,this.observableDelay=100}firstUpdated(e){super.firstUpdated(e),this.initIntersectionObserver()}disconnectedCallback(){super.disconnectedCallback(),this.intersectionObserver?.disconnect()}initIntersectionObserver(){this.observable&&!this.isVisible&&(this.intersectionObserver=new IntersectionObserver((e=>this.handleIntersectionCallback(e)),{rootMargin:this.observableMargin,threshold:this.observableThresholds,delay:this.observableDelay}),this.intersectionObserver.observe(this))}alreadyHandled(){return"once"===this.observable&&this.isVisible}handleIntersectionCallback(e){if(!this.alreadyHandled())for(const t of e){Number(t.intersectionRatio.toFixed(2))>=this.intersectionRatio&&!this.alreadyHandled()&&("once"===this.observable&&this.intersectionObserver.disconnect(),this.isVisible=!0,ad.trigger("visibilityChanged",{el:this,entry:t}),this.onVisibilityChanged(t))}}onVisibilityChanged(e){}}var Jx=n(2470),Yx={};Yx.styleTagTransform=L(),Yx.setAttributes=I(),Yx.insert=N().bind(null,"head"),Yx.domAPI=T(),Yx.insertStyleElement=D();C()(Jx.A,Yx);Jx.A&&Jx.A.locals&&Jx.A.locals;const Xx=(e={})=>wh`<div class="d-flex justify-content-center ${e.class}"><div class="spinner-grow" role="status"><span class="visually-hidden">Loading...</span></div></div>`;ad.elements.define("converse-spinner",class extends O_{render(){return Xx()}});var Qx=n(4647),Zx={};Zx.styleTagTransform=L(),Zx.setAttributes=I(),Zx.insert=N().bind(null,"head"),Zx.domAPI=T(),Zx.insertStyleElement=D();C()(Qx.A,Zx);Qx.A&&Qx.A.locals&&Qx.A.locals;const e$="_a",t$="_b",n$="_c",s$="horizontal",i$=()=>!1,r$="undefined"!=typeof window?window:null;ad.elements.define("converse-split-resize",class extends O_{initialize(){super.initialize()}constructor(){super(),this.pair=null}render(){return wh`<div class="gutter gutter-horizontal"></div>`}disconnectedCallback(){super.disconnectedCallback(),this.pair.gutter.removeEventListener("mousedown",this.pair[e$]),this.pair.gutter.removeEventListener("touchstart",this.pair[e$])}updated(e){super.updated(e),this.pair||this.setupSplit([this.previousElementSibling,this.nextElementSibling])}getOption(e,t,n){const s=e[t];return void 0!==s?s:n}getElementStyle(e,t,n){const s={};return Rf.isString(t)?s[e]=t:s[e]=`calc(${t}% - ${n}px)`,s}defaultGutterStyleFn(e,t){return{[e]:`${t}px`}}getGutterSize(e,t,n,s){if(t){if("end"===s)return 0;if("center"===s)return e/2}else if(n){if("start"===s)return 0;if("center"===s)return e/2}return e}setElementSize(e,t,n){const s=this.getElementStyle(this.dimension,t,n);Object.keys(s).forEach((t=>{e.style[t]=s[t]}))}getSizes(){return this.elements.map((e=>e.size))}getMousePosition(e){return"touches"in e?e.touches[0][this.clientAxis]:e[this.clientAxis]}adjust(e){const t=this.elements[this.pair.a],n=this.elements[this.pair.b],s=t.size+n.size;t.size=e/this.pair.size*s,n.size=s-e/this.pair.size*s,this.setElementSize(t.element,t.size,this.pair[t$]),this.setElementSize(n.element,n.size,this.pair[n$])}drag(e,t){let n;const s=this.elements[this.pair.a],i=this.elements[this.pair.b];this.pair.dragging&&(n=this.getMousePosition(e)-this.pair.start+(this.pair[t$]-this.pair.dragOffset),this.dragInterval>1&&(n=Math.round(n/this.dragInterval)*this.dragInterval),n<=s.minSize+s.snapOffset+this.pair[t$]?n=s.minSize+this.pair[t$]:n>=this.pair.size-(i.minSize+i.snapOffset+this.pair[n$])&&(n=this.pair.size-(i.minSize+this.pair[n$])),n>=s.maxSize-s.snapOffset+this.pair[t$]?n=s.maxSize+this.pair[t$]:n<=this.pair.size-(i.maxSize-i.snapOffset+this.pair[n$])&&(n=this.pair.size-(i.maxSize+this.pair[n$])),this.adjust(n),this.getOption(t,"onDrag",i$)(this.getSizes()))}calculateSizes(e){const t=this.elements[e.a].element,n=this.elements[e.b].element,s=t.getBoundingClientRect(),i=n.getBoundingClientRect();e.size=s[this.dimension]+i[this.dimension]+e[t$]+e[n$],e.start=s[this.position],e.end=s[this.positionEnd]}innerSize(e){if(!getComputedStyle)return null;const t=getComputedStyle(e);if(!t)return null;let n=e[this.clientSize];return 0===n?null:(this.direction===s$?n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight):n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n)}trimToMin(e){const t=this.innerSize(this.parent);if(null===t)return e;if(this.minSizes.reduce(((e,t)=>e+t),0)>t)return e;let n=0;const s=[],i=e.map(((i,r)=>{const o=t*i/100,a=this.getGutterSize(this.gutterSize,0===r,r===e.length-1,this.gutterAlign),c=this.minSizes[r]+a;return o<c?(n+=c-o,s.push(0),c):(s.push(o-c),o)}));return 0===n?e:i.map(((e,i)=>{let r=e;if(n>0&&s[i]-n>0){const t=Math.min(n,s[i]-n);n-=t,r=e-t}return r/t*100}))}stopDragging(e){const t=this.elements[this.pair.a].element,n=this.elements[this.pair.b].element;this.pair.dragging&&this.getOption(e,"onDragEnd",i$)(this.getSizes()),this.pair.dragging=!1,r$.removeEventListener("mouseup",this.pair.stop),r$.removeEventListener("touchend",this.pair.stop),r$.removeEventListener("touchcancel",this.pair.stop),r$.removeEventListener("mousemove",this.pair.move),r$.removeEventListener("touchmove",this.pair.move),this.pair.stop=null,this.pair.move=null,t.removeEventListener("selectstart",i$),t.removeEventListener("dragstart",i$),n.removeEventListener("selectstart",i$),n.removeEventListener("dragstart",i$),t.style.userSelect="",t.style.pointerEvents="",n.style.userSelect="",n.style.pointerEvents="",this.pair.gutter.style.cursor="",this.pair.parent.style.cursor="",document.body.style.cursor=""}startDragging(e,t){if("button"in e&&0!==e.button)return;const n=this.elements[this.pair.a].element,s=this.elements[this.pair.b].element;this.pair.dragging||this.getOption(t,"onDragStart",i$)(this.getSizes()),e.preventDefault(),this.pair.dragging=!0,this.pair.stop=()=>this.stopDragging(t),this.pair.move=e=>this.drag(e,t),r$.addEventListener("mouseup",this.pair.stop),r$.addEventListener("touchend",this.pair.stop),r$.addEventListener("touchcancel",this.pair.stop),r$.addEventListener("mousemove",this.pair.move),r$.addEventListener("touchmove",this.pair.move),n.addEventListener("selectstart",i$),n.addEventListener("dragstart",i$),s.addEventListener("selectstart",i$),s.addEventListener("dragstart",i$),n.style.userSelect="none",n.style.pointerEvents="none",s.style.userSelect="none",s.style.pointerEvents="none",this.pair.gutter.style.cursor=this.cursor,this.pair.parent.style.cursor=this.cursor,document.body.style.cursor=this.cursor,this.calculateSizes(this.pair),this.pair.dragOffset=this.getMousePosition(e)-this.pair.end}adjustToMin(e){this.calculateSizes(this.pair),this.adjust(this.pair.size-e.minSize-this.pair[n$])}setSizes(e){const t=this.trimToMin(e);t.forEach(((e,n)=>{if(n>0){const s=this.elements[this.pair.a],i=this.elements[this.pair.b];s.size=t[n-1],i.size=e,this.setElementSize(s.element,s.size,this.pair[t$]),this.setElementSize(i.element,i.size,this.pair[n$])}}))}setupSplit(e,t={}){const n=(e=Array.from(e))[0];this.parent=n.parentElement;const s=this.getOption(t,"minSize",100);this.minSizes=Array.isArray(s)?s:e.map((()=>s));const i=this.getOption(t,"expandToMin",!1);this.gutterSize=this.getOption(t,"gutterSize",5),this.gutterAlign=this.getOption(t,"gutterAlign","center"),this.dragInterval=this.getOption(t,"dragInterval",1),this.direction=this.getOption(t,"direction",s$),this.cursor=this.getOption(t,"cursor",this.direction===s$?"col-resize":"row-resize"),this.direction===s$?(this.dimension="width",this.clientAxis="clientX",this.position="left",this.positionEnd="right",this.clientSize="clientWidth"):"vertical"===this.direction&&(this.dimension="height",this.clientAxis="clientY",this.position="top",this.positionEnd="bottom",this.clientSize="clientHeight"),this.elements=e.map(((n,s)=>this.createElement(e,n,s,t))),this.elements.forEach((e=>{const t=e.element.getBoundingClientRect()[this.dimension];t<e.minSize&&(i?this.adjustToMin(e):e.minSize=t)})),this.createPair(t)}createElement(e,t,n,s){let i=this.getOption(s,"sizes")||e.map((()=>100/e.length));i=this.trimToMin(i);const r=this.getOption(s,"maxSize",1/0),o=Array.isArray(r)?r:e.map((()=>r)),a=this.getOption(s,"snapOffset",30),c=Array.isArray(a)?a:e.map((()=>a));return{element:t,size:i[n],minSize:this.minSizes[n],maxSize:o[n],snapOffset:c[n],i:n}}createPair(e){const t=getComputedStyle?getComputedStyle(this.parent):null,n=t?t.flexDirection:null;if(this.pair={a:0,b:1,dragging:!1,direction:this.direction,parent:this.parent},this.pair[t$]=this.getGutterSize(this.gutterSize,!0,!1,this.gutterAlign),this.pair[n$]=this.getGutterSize(this.gutterSize,!1,!0,this.gutterAlign),"row-reverse"===n||"column-reverse"===n){const e=this.pair.a;this.pair.a=this.pair.b,this.pair.b=e}const s=this.firstElementChild;this.pair[e$]=t=>this.startDragging(t,e),this.addEventListener("mousedown",this.pair[e$]),this.addEventListener("touchstart",this.pair[e$]),this.pair.gutter=s}});const o$=["converse-adhoc-views","converse-bookmark-views","converse-chatboxviews","converse-chatview","converse-controlbox","converse-dragresize","converse-fullscreen","converse-headlines-view","converse-mam-views","converse-minimize","converse-modal","converse-muc-views","converse-notification","converse-omemo","converse-profile","converse-push","converse-register","converse-roomslist","converse-rootview","converse-rosterview","converse-singleton"],a$={offline:C_("Offline"),unavailable:C_("Unavailable"),xa:C_("Extended Away"),away:C_("Away"),dnd:C_("Do not disturb"),chat:C_("Chatty"),online:C_("Online")};function c$(e,t=""){return`color: ${e}!important;${t}`}function l$(e){if(ad.settings.get("colorize_username")){const t=e?.get("color");return t?c$(t):e?wh`${Q_(e?.getColor().then(c$),"")}`:""}}var d$=n(7391),u$=n.n(d$);const h$={aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",cda:"application/x-cdf",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",m4a:"audio/mp4",mid:"audio/midi",midi:"audio/midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"text/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};async function f$(e){if(e.type===h$.png){const t=new FileReader;return await new Promise((n=>{t.onloadend=e=>{const t=new DataView(e.target.result);if(2303741511===t.getUint32(0)&&218765834===t.getUint32(4)){const e=t.getUint8(25);n(e===4||e===6)}n(!1)},t.readAsArrayBuffer(e)}))}return!1}async function m$(e,t={targetSize:.1,quality:.75,maxWidth:256,maxHeight:256,maxUncompressedSize:100}){if(t.maxUncompressedSize&&e.size>1024*t.maxUncompressedSize){delete t.maxUncompressedSize;const n=new(u$())(t),s=await n.compress([e]),{photo:i}=s[0];return i.data}return e}function g$(e,t){const n=Rf.getURL(t).hostname.split("."),s=n.slice(-2).join("."),i=n.slice(0,-2).join("."),r=`${i?`${i}.`:""}${s}`;return e.includes(s)||e.includes(r)}function p$(e,t){const n=ad.settings.get(t);if(!Array.isArray(n))return!0;try{return g$(n,e)}catch(e){return Y.debug(e),!1}}function v$(e){return e.is_audio&&p$(e.url,"allowed_audio_domains")||e.is_video&&p$(e.url,"allowed_video_domains")||e.is_image&&p$(e.url,"allowed_image_domains")}function b$(e,t){if(!function(e){const{protocol:t}=window.location;if(["chrome-extension:","file:"].includes(t))return!0;const n=Rf.getURL(e);return"http:"===t||"https:"===t&&["https","aesgcm"].includes(n.protocol.toLowerCase())}(e))return!1;const n=ad.settings.get("render_media"),s=p$(e,`allowed_${t}_domains`);return Array.isArray(n)?s&&g$(n,e):s&&n}function y$(e){const t=ad.settings.get("filter_url_query_params");if(!t)return e;const n=Array.isArray(t)?t:[t],s=Rf.getURL(e);return n.forEach((e=>s.searchParams.delete(e))),s.toString()}Object.assign(Rf,{...x,...$,...S,...E});const _$="backdrop",w$="show",S$=`mousedown.bs.${_$}`,A$={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},x$={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};const $$=class extends tx{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return A$}static get DefaultType(){return x$}static get NAME(){return _$}show(e){if(!this._config.isVisible)return void OA(e);this._append();const t=this._getElement();this._config.isAnimated&&EA(t),t.classList.add(w$),this._emulateAnimation((()=>{OA(e)}))}hide(e){this._config.isVisible?(this._getElement().classList.remove(w$),this._emulateAnimation((()=>{this.dispose(),OA(e)}))):OA(e)}dispose(){this._isAppended&&(YA.off(this._element,S$),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add("fade"),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=wA(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),YA.on(e,S$,(()=>{OA(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(e){NA(e,this._getElement(),this._config.isAnimated)}},E$=".bs.focustrap",j$=`focusin${E$}`,C$=`keydown.tab${E$}`,k$="backward",T$={autofocus:!0,trapElement:null},O$={autofocus:"boolean",trapElement:"element"};const N$=class extends tx{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return T$}static get DefaultType(){return O$}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),YA.off(document,E$),YA.on(document,j$,(e=>this._handleFocusin(e))),YA.on(document,C$,(e=>this._handleKeydown(e))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,YA.off(document,E$))}_handleFocusin(e){const{trapElement:t}=this._config;if(e.target===document||e.target===t||t.contains(e.target))return;const n=rx.focusableChildren(t);0===n.length?t.focus():this._lastTabNavDirection===k$?n[n.length-1].focus():n[0].focus()}_handleKeydown(e){"Tab"===e.key&&(this._lastTabNavDirection=e.shiftKey?k$:"forward")}},M$=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",I$=".sticky-top",R$="padding-right",D$="margin-right";const z$=class{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,R$,(t=>t+e)),this._setElementAttributes(M$,R$,(t=>t+e)),this._setElementAttributes(I$,D$,(t=>t-e))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,R$),this._resetElementAttributes(M$,R$),this._resetElementAttributes(I$,D$)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,n){const s=this.getWidth();this._applyManipulationCallback(e,(e=>{if(e!==this._element&&window.innerWidth>e.clientWidth+s)return;this._saveInitialAttribute(e,t);const i=window.getComputedStyle(e).getPropertyValue(t);e.style.setProperty(t,`${n(Number.parseFloat(i))}px`)}))}_saveInitialAttribute(e,t){const n=e.style.getPropertyValue(t);n&&ex.setDataAttribute(e,t,n)}_resetElementAttributes(e,t){this._applyManipulationCallback(e,(e=>{const n=ex.getDataAttribute(e,t);null!==n?(ex.removeDataAttribute(e,t),e.style.setProperty(t,n)):e.style.removeProperty(t)}))}_applyManipulationCallback(e,t){if(_A(e))t(e);else for(const n of rx.find(e,this._element))t(n)}},L$=".bs.modal",P$=`hide${L$}`,U$=`hidePrevented${L$}`,B$=`hidden${L$}`,q$=`show${L$}`,F$=`shown${L$}`,H$=`resize${L$}`,G$=`click.dismiss${L$}`,W$=`mousedown.dismiss${L$}`,V$=`keydown.dismiss${L$}`,K$=`click${L$}.data-api`,J$="modal-open",Y$="show",X$="modal-static",Q$={backdrop:!0,focus:!0,keyboard:!0},Z$={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class eE extends nx{constructor(e,t){super(e,t),this._dialog=rx.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new z$,this._addEventListeners()}static get Default(){return Q$}static get DefaultType(){return Z$}static get NAME(){return"modal"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||this._isTransitioning)return;YA.trigger(this._element,q$,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(J$),this._adjustDialog(),this._backdrop.show((()=>this._showElement(e))))}hide(){if(!this._isShown||this._isTransitioning)return;YA.trigger(this._element,P$).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Y$),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated()))}dispose(){YA.off(window,L$),YA.off(this._dialog,L$),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new $$({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new N$({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=rx.findOne(".modal-body",this._dialog);t&&(t.scrollTop=0),EA(this._element),this._element.classList.add(Y$);this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,YA.trigger(this._element,F$,{relatedTarget:e})}),this._dialog,this._isAnimated())}_addEventListeners(){YA.on(this._element,V$,(e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),YA.on(window,H$,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),YA.on(this._element,W$,(e=>{YA.one(this._element,G$,(t=>{this._element===e.target&&this._element===t.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(J$),this._resetAdjustments(),this._scrollBar.reset(),YA.trigger(this._element,B$)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(YA.trigger(this._element,U$).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._element.style.overflowY;"hidden"===t||this._element.classList.contains(X$)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(X$),this._queueCallback((()=>{this._element.classList.remove(X$),this._queueCallback((()=>{this._element.style.overflowY=t}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),n=t>0;if(n&&!e){const e=kA()?"paddingLeft":"paddingRight";this._element.style[e]=`${t}px`}if(!n&&e){const e=kA()?"paddingRight":"paddingLeft";this._element.style[e]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each((function(){const n=eE.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`);n[e](t)}}))}}YA.on(document,K$,'[data-bs-toggle="modal"]',(function(e){const t=rx.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),YA.one(t,q$,(e=>{e.defaultPrevented||YA.one(t,B$,(()=>{SA(this)&&this.focus()}))}));const n=rx.findOne(".modal.show");n&&eE.getInstance(n).hide();eE.getOrCreateInstance(t).toggle(this)})),((e,t="hide")=>{const n=`click.dismiss${e.EVENT_KEY}`,s=e.NAME;YA.on(document,n,`[data-bs-dismiss="${s}"]`,(function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),AA(this))return;const i=rx.getElementFromSelector(this)||this.closest(`.${s}`);e.getOrCreateInstance(i)[t]()}))})(eE),TA(eE);const tE=eE,nE=wh`<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">${C_("Close")}</button>`,sE=wh`<button type="button" class="btn d-flex align-items-center justify-content-center" data-bs-dismiss="modal" aria-label="${C_("Close")}"><converse-icon size="1.25em" class="fa fa-times"></converse-icon></button>`,iE=e=>{const t=e.model?.get("alert"),n=e.model?.get("level")??"";return wh`<div class="modal-dialog" role="document" role="dialog"><div class="modal-content"><div class="modal-header ${n}"><h5 class="modal-title">${e.getModalTitle()}</h5>${sE}</div><div class="modal-body"><span class="modal-alert">${t?(e=>wh`<div class="alert ${e.type}" role="alert"><p>${e.message}</p></div>`)({type:`alert-${t.type}`,message:t.message}):""} </span>${e.renderModal()}</div>${e.renderModalFooter()}</div></div>`};var rE=n(8610),oE={};oE.styleTagTransform=L(),oE.setAttributes=I(),oE.insert=N().bind(null,"head"),oE.domAPI=T(),oE.insertStyleElement=D();C()(rE.A,oE);rE.A&&rE.A.locals&&rE.A.locals;const aE=class extends O_{static get properties(){return{model:{type:ie.Model}}}#c;constructor(e){super(),this.model=null,this.className=Rf.isTestEnv()?"modal":"modal fade",this.tabIndex=-1,this.ariaHidden="true",this.onKeyDown=e=>{"Escape"===e.key&&"false"===this.ariaHidden&&this.close()},this.initialized=re(),Object.assign(this,e),setTimeout((()=>this.insertIntoDOM())),this.addEventListener("shown.bs.modal",(()=>{this.ariaHidden="false"})),this.addEventListener("hidden.bs.modal",(()=>{this.ariaHidden="true"}))}connectedCallback(){super.connectedCallback(),window.addEventListener("keydown",this.onKeyDown)}disconnectedCallback(){window.removeEventListener("resize",this.onKeyDown),super.disconnectedCallback()}get modal(){return this.#c||(this.#c=new tE(this,{backdrop:!Rf.isTestEnv(),keyboard:!0})),this.#c}initialize(){this.requestUpdate(),this.initialized.resolve()}renderModal(){return""}renderModalFooter(){return wh`<div class="modal-footer">${nE}</div>`}render(){return iE(this)}getModalTitle(){return""}switchTab(e){e?.stopPropagation(),e?.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.requestUpdate()}close(){this.modal.hide()}insertIntoDOM(){document.querySelector("#converse-modals").insertAdjacentElement("beforeend",this)}alert(e,t="primary"){this.model.set("alert",{message:e,type:t}),setTimeout((()=>{this.model.set("alert",void 0)}),5e3)}async show(){await this.initialized,this.modal.show(),this.requestUpdate()}};ad.elements.define("converse-alert-modal",class extends aE{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.addEventListener("hide.bs.modal",(()=>this.remove()),!1)}renderModal(){return(e=>wh`<div class="modal-body"><span class="modal-alert"></span> ${e.messages.map((e=>wh`<p>${e}</p>`))}</div>`)(this.model.toJSON())}getModalTitle(){return this.model.get("title")}});const cE=e=>{const t=e.model.get("messages")?.[0],n=e.model.get("messages")?.slice(1)||[];return wh`<form class="converse-form converse-form--modal confirm" action="#" @submit="${t=>e.onConfimation(t)}"><div class="mb-3 lh-base"><strong>${t}</strong></div><div class="mb-3">${n?.map((e=>wh`<p>${e}</p>`))}</div>${e.model.get("fields")?.map((e=>function(e){return"checkbox"===e.type?wh`<div class="form-check"><input name="${e.name}" class="form-check-input" type="checkbox" id="${e.name}"> <label class="form-check-label" for="${e.name}">${e.label}</label></div>`:wh`<div class="mb-3"><label class="form-label" for="${e.name}">${e.label||""}</label> <input type="text" name="${e.name}" class="${e.challenge_failed?"is-invalid":""} form-control" ?required="${e.required}" placeholder="${e.placeholder}" id="${e.name}"> ${e.challenge_failed?wh`<div class="invalid-feedback">Please provide a valid input.</div>`:""}</div>`}(e)))}<div class="d-flex justify-content-end"><button type="submit" class="btn btn-primary me-2">${C_("Confirm")}</button> <input type="button" class="btn btn-secondary" data-bs-dismiss="modal" value="${C_("Cancel")}"></div></form>`};class lE extends aE{constructor(e){super(e),this.confirmation=re()}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.addEventListener("hide.bs.modal",(()=>{this.confirmation.isResolved||this.confirmation.reject()}),!1),this.onKeyDown=e=>{if(e.key===__.KEYCODES.ENTER){e.preventDefault(),e.stopPropagation();this.querySelector("form.confirm button[type=submit]").click()}}}connectedCallback(){super.connectedCallback(),this.addEventListener("keydown",this.onKeyDown)}disconnectedCallback(){this.removeEventListener("keydown",this.onKeyDown),super.disconnectedCallback()}renderModal(){return cE(this)}getModalTitle(){return this.model.get("title")}renderModalFooter(){return""}onConfimation(e){e.preventDefault();const t=e.target,n=new FormData(t),s=(this.model.get("fields")||[]).map((e=>{const t=n.get(e.name);return e.value=t,e.challenge&&(e.challenge_failed=t!==e.challenge),e}));if(s.filter((e=>e.challenge_failed)).length)return this.model.set("fields",s),void this.model.trigger("change");this.confirmation.resolve(s),this.modal.hide()}}ad.elements.define("converse-confirm-modal",lE);let dE=[],uE={},hE={};const fE={modal:{show(e,t,n){let s;if("string"==typeof e)s=this.get(e)??this.create(e,t),Object.assign(s,t);else{const n=e,i=n.id??t.id;s=this.get(i)??this.create(n,t)}return s.show(n),s},get:e=>uE[e]??dE.filter((t=>t.id==e)).pop(),create(e,t){const n=customElements.get(e);return uE[e]=new n(t)},remove(e){let t;"string"==typeof e?(t=uE[e],delete uE[e]):(t=e,dE=dE.filter((e=>e!==t))),t?.remove()},removeAll(){dE.forEach((e=>e.remove())),dE=[],uE={}}},async confirm(e,t=[],n=[]){"string"==typeof t&&(t=[t]);const s=new ie.Model({title:e,messages:t,fields:n,type:"confirm"}),i=new lE({model:s});let r;i.show();try{r=await i.confirmation}catch(e){r=!1}return i.remove(),r},async prompt(e,t=[],n=""){"string"==typeof t&&(t=[t]);const s=new ie.Model({title:e,messages:t,fields:[{name:"reason",placeholder:n}],type:"prompt"}),i=new lE({model:s});let r;i.show();try{r=(await i.confirmation).pop()?.value}catch(e){r=!1}return i.remove(),r},alert(e,t,n){let s;"string"==typeof n&&(n=[n]),"error"===e?s="alert-danger":"info"===e?s="alert-info":"warn"===e&&(s="alert-warning");const i=new ie.Model({title:t,messages:n,level:s,type:"alert"});fE.modal.show("converse-alert-modal",{model:i})},toast:{show(e,t){hE[e]=t,ad.trigger("showToast",t)},get:e=>e?hE[e]:Object.keys(hE).map((e=>({name:e,...hE[e]}))),remove(e){delete hE[e],ad.trigger("hideToast")}}},mE=fE,gE={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},pE=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),vE=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,bE=(e,t)=>{const n=e.nodeName.toLowerCase();return t.includes(n)?!pE.has(n)||Boolean(vE.test(e.nodeValue)):t.filter((e=>e instanceof RegExp)).some((e=>e.test(n)))};const yE={allowList:gE,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},_E={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},wE={entry:"(string|element|function|null)",selector:"(string|element)"};const SE=class extends tx{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return yE}static get DefaultType(){return _E}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((e=>this._resolvePossibleFunction(e))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[t,n]of Object.entries(this._config.content))this._setContent(e,n,t);const t=e.children[0],n=this._resolvePossibleFunction(this._config.extraClass);return n&&t.classList.add(...n.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,n]of Object.entries(e))super._typeCheckConfig({selector:t,entry:n},wE)}_setContent(e,t,n){const s=rx.findOne(n,e);s&&((t=this._resolvePossibleFunction(t))?_A(t)?this._putElementInTemplate(wA(t),s):this._config.html?s.innerHTML=this._maybeSanitize(t):s.textContent=t:s.remove())}_maybeSanitize(e){return this._config.sanitize?function(e,t,n){if(!e.length)return e;if(n&&"function"==typeof n)return n(e);const s=(new window.DOMParser).parseFromString(e,"text/html"),i=[].concat(...s.body.querySelectorAll("*"));for(const e of i){const n=e.nodeName.toLowerCase();if(!Object.keys(t).includes(n)){e.remove();continue}const s=[].concat(...e.attributes),i=[].concat(t["*"]||[],t[n]||[]);for(const t of s)bE(t,i)||e.removeAttribute(t.nodeName)}return s.body.innerHTML}(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return OA(e,[void 0,this])}_putElementInTemplate(e,t){if(this._config.html)return t.innerHTML="",void t.append(e);t.textContent=e.textContent}},AE=new Set(["sanitize","allowList","sanitizeFn"]),xE="fade",$E="show",EE=".tooltip-inner",jE=".modal",CE="hide.bs.modal",kE="hover",TE="focus",OE={AUTO:"auto",TOP:"top",RIGHT:kA()?"left":"right",BOTTOM:"bottom",LEFT:kA()?"right":"left"},NE={allowList:gE,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},ME={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class IE extends nx{constructor(e,t){super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return NE}static get DefaultType(){return ME}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),YA.off(this._element.closest(jE),CE,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const e=YA.trigger(this._element,this.constructor.eventName("show")),t=(xA(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!t)return;this._disposePopper();const n=this._getTipElement();this._element.setAttribute("aria-describedby",n.getAttribute("id"));const{container:s}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(s.append(n),YA.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(n),n.classList.add($E),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))YA.on(e,"mouseover",$A);this._queueCallback((()=>{YA.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(YA.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented)return;if(this._getTipElement().classList.remove($E),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))YA.off(e,"mouseover",$A);this._activeTrigger.click=!1,this._activeTrigger[TE]=!1,this._activeTrigger[kE]=!1,this._isHovered=null;this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),YA.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml();if(!t)return null;t.classList.remove(xE,$E),t.classList.add(`bs-${this.constructor.NAME}-auto`);const n=(e=>{do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e})(this.constructor.NAME).toString();return t.setAttribute("id",n),this._isAnimated()&&t.classList.add(xE),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new SE({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[EE]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(xE)}_isShown(){return this.tip&&this.tip.classList.contains($E)}_createPopper(e){const t=OA(this._config.placement,[this,e,this._element]),n=OE[t.toUpperCase()];return mA(this._element,e,this._getPopperConfig(n))}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_resolvePossibleFunction(e){return OA(e,[this._element,this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:e=>{this._getTipElement().setAttribute("data-popper-placement",e.state.placement)}}]};return{...t,...OA(this._config.popperConfig,[void 0,t])}}_setListeners(){const e=this._config.trigger.split(" ");for(const t of e)if("click"===t)YA.on(this._element,this.constructor.eventName("click"),this._config.selector,(e=>{this._initializeOnDelegatedTarget(e).toggle()}));else if("manual"!==t){const e=t===kE?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),n=t===kE?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");YA.on(this._element,e,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusin"===e.type?TE:kE]=!0,t._enter()})),YA.on(this._element,n,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusout"===e.type?TE:kE]=t._element.contains(e.relatedTarget),t._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},YA.on(this._element.closest(jE),CE,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=ex.getDataAttributes(this._element);for(const e of Object.keys(t))AE.has(e)&&delete t[e];return e={...t,..."object"==typeof e&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=!1===e.container?document.body:wA(e.container),"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),"number"==typeof e.title&&(e.title=e.title.toString()),"number"==typeof e.content&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[t,n]of Object.entries(this._config))this.constructor.Default[t]!==n&&(e[t]=n);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each((function(){const t=IE.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}}TA(IE);const RE=IE,DE=".popover-header",zE=".popover-body",LE={...RE.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},PE={...RE.DefaultType,content:"(null|string|element|function)"};class UE extends RE{static get Default(){return LE}static get DefaultType(){return PE}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[DE]:this._getTitle(),[zE]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each((function(){const t=UE.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}}TA(UE);const BE=UE;var qE=n(6865),FE={};FE.styleTagTransform=L(),FE.setAttributes=I(),FE.insert=N().bind(null,"head"),FE.domAPI=T(),FE.insertStyleElement=D();C()(qE.A,FE);qE.A&&qE.A.locals&&qE.A.locals;class HE extends O_{static get properties(){return{title:{type:String},text:{type:String}}}constructor(){super(),this.title=null,this.text=null}firstUpdated(e){super.firstUpdated(e),new BE(this.firstElementChild,{container:"converse-root",trigger:"focus"})}render(){return wh`<button type="button" class="btn p-0" data-toggle="popover" data-bs-title="${this.title}" data-bs-content="${this.text}"><converse-icon class="fa fa-info-circle" size="1.2em"></converse-icon></button>`}}ad.elements.define("converse-popover",HE);const GE=HE;var WE=n(4399),VE={};VE.styleTagTransform=L(),VE.setAttributes=I(),VE.insert=N().bind(null,"head"),VE.domAPI=T(),VE.insertStyleElement=D();C()(WE.A,VE);WE.A&&WE.A.locals&&WE.A.locals;class KE extends O_{static get properties(){return{type:{type:String},name:{type:String},title:{type:String},body:{type:String}}}constructor(){super(),this.name="",this.body="",this.header="",this.type="info"}updated(e){"danger"!==e.get("type")?this.timeoutId=setTimeout((()=>this.hide()),5e3):clearTimeout(this.timeoutId)}render(){return wh`<div class="toast show text-bg-${this.type??"info"}" role="alert" aria-live="assertive" aria-atomic="true">${this.title?wh`<div class="toast-header"><img src="/logo/conversejs-filled.svg" class="rounded me-2" alt="${C_("Converse logo")}"> <strong class="me-auto">${this.title??""}</strong> <button @click="${this.hide}" type="button" class="btn-close" aria-label="${C_("Close")}"></button></div>`:""} ${this.body?wh`<div class="d-flex justify-content-between toast-body__container"><div class="toast-body w-100">${this.body??""}</div>${this.title?"":wh`<button @click="${this.hide}" type="button" class="btn centered" aria-label="${C_("Close")}"><converse-icon size="1em" class="fa fa-times"></converse-icon></button>`}</div>`:""}</div>`}hide(e){e?.preventDefault(),ad.toast.remove(this.name)}}ad.elements.define("converse-toast",KE);class JE extends O_{render(){return wh`<converse-about-modal></converse-about-modal>`}}ad.elements.define("converse-modals",JE);class YE extends O_{initialize(){super.initialize(),ad.listen.on("showToast",(()=>this.requestUpdate())),ad.listen.on("hideToast",(()=>this.requestUpdate()))}render(){const e=ad.toast.get();return wh`${e.map((e=>wh`<converse-toast name="${e.name}" title="${e.title??""}" body="${e.body??""}" type="${e.type??""}"></converse-toast>`))}`}}ad.elements.define("converse-toasts",YE);Lf.plugins.add("converse-modal",{initialize(){ad.listen.on("disconnect",(()=>{const e=document.querySelector("#converse-modals");e&&(e.innerHTML="")})),ad.listen.on("clearSession",(()=>ad.modal.removeAll())),Object.assign(uo.exports,{BaseModal:aE,Popover:GE,Toast:KE}),Object.assign(uo.api,mE)}});const XE=class extends String{constructor(e,t){super();const n=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=n.label||n.value,this.value=n.value,this.query=t}get lenth(){return this.label.length}toString(){return""+this.label}valueOf(){return this.toString()}},QE=Lf.env.utils,ZE={getElement:(e,t)=>"string"==typeof e?(t||document).querySelector(e):e||null,bind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const s=t[n];n.split(/\s+/).forEach((t=>e.addEventListener(t,s)))}},unbind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const s=t[n];n.split(/\s+/).forEach((t=>e.removeEventListener(t,s)))}},regExpEscape:e=>e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),isMention:(e,t)=>t.includes(e[0])||QE.isMentionBoundary(e[0])&&t.includes(e[1])};function ej(e,t){return RegExp(ZE.regExpEscape(t.trim()),"i").test(e)}function tj(e,t){return RegExp("^"+ZE.regExpEscape(t.trim()),"i").test(e)}const nj=function(e,t){const n=e.query.toLowerCase(),s=e.label.toLowerCase().indexOf(n),i=t.label.toLowerCase().indexOf(n);return s===i?function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1}(e,t):(-1===s?1/0:s)<(-1===i?1/0:i)?-1:1},sj=(e,t)=>{t=t.trim();const n=document.createElement("li");n.setAttribute("aria-selected","false");const s=new RegExp("("+t+")","ig");return(t?e.split(s):[e]).forEach((e=>{if(t&&e.match(s)){const t=document.createElement("mark");t.textContent=e,n.appendChild(t)}else n.appendChild(document.createTextNode(e))})),n},{siblingIndex:ij}=Rf;class rj extends((0,ie.EventEmitter)(Object)){constructor(e,t={}){super(),this.suggestions=[],this.is_opened=!1,this.match_current_word=!1,this.sort=!1===t.sort?null:nj,this.filter=ej,this.ac_triggers=[],this.include_triggers=[],this.min_chars=2,this.max_items=10,this.auto_first=!1,this.data=(e,t)=>e,this.item=sj,Rf.hasClass("suggestion-box",e)?this.container=e:this.container=e.querySelector(".suggestion-box"),this.input=this.container.querySelector(".suggestion-box__input"),this.input.setAttribute("aria-autocomplete","list"),this.ul=this.container.querySelector(".suggestion-box__results"),this.status=this.container.querySelector(".suggestion-box__additions"),Object.assign(this,t),this.index=-1,this.bindEvents(),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||t.list||[]}bindEvents(){this._events={input:{blur:()=>this.close({reason:"blur"})},form:{submit:()=>this.close({reason:"submit"})},ul:{mousedown:e=>this.onMouseDown(e),mouseover:e=>this.onMouseOver(e)}},ZE.bind(this.input,this._events.input),ZE.bind(this.input.form,this._events.form),ZE.bind(this.ul,this._events.ul)}set list(e){if(Array.isArray(e)||"function"==typeof e)this._list=e;else if("string"==typeof e&&e.includes(","))this._list=e.split(/\s*,\s*/);else{const t=ZE.getElement(e)?.children||[];this._list=Array.from(t).filter((e=>!e.disabled)).map((e=>{const t=e.textContent.trim(),n=e.value||t,s=e.label||t;return""!==n?{label:s,value:n}:null})).filter((e=>e))}document.activeElement===this.input&&this.evaluate()}get list(){return this._list}get selected(){return this.index>-1}get opened(){return this.is_opened}close(e){this.opened&&(this.ul.setAttribute("hidden",""),this.is_opened=!1,this.index=-1,this.trigger("suggestion-box-close",e||{}))}insertValue(e){this.match_current_word?Rf.replaceCurrentWord(this.input,e.value):this.input.value=e.value}open(){this.ul.removeAttribute("hidden"),this.is_opened=!0,this.auto_first&&-1===this.index&&this.goto(0),this.trigger("suggestion-box-open")}destroy(){ZE.unbind(this.input,this._events.input),ZE.unbind(this.input.form,this._events.form),this.input.removeAttribute("aria-autocomplete")}next(){const e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)}previous(){const e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)}goto(e,t=!0){const n=Array.from(this.ul.children).filter((e=>e instanceof HTMLElement));this.selected&&n[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&n.length>0&&(n[e].setAttribute("aria-selected","true"),n[e].focus(),this.status.textContent=n[e].textContent,t&&(this.ul.scrollTop=n[e].offsetTop-this.ul.clientHeight+n[e].clientHeight),this.trigger("suggestion-box-highlight",{text:this.suggestions[this.index]}))}select(e){if(e?this.index=ij(e):e=this.ul.children[this.index],e){const e=this.suggestions[this.index];this.insertValue(e),this.close({reason:"select"}),this.auto_completing=!1,this.trigger("suggestion-box-selectcomplete",{text:e})}}onMouseOver(e){const t=Rf.ancestor(e.target,"li");if(t){const e=Array.prototype.slice.call(this.ul.children).indexOf(t);this.goto(e,!1)}}onMouseDown(e){if(0!==e.button)return;const t=Rf.ancestor(e.target,"li");t&&(e.preventDefault(),this.select(t))}onKeyDown(e){if(this.opened){if([Lf.keycodes.ENTER,Lf.keycodes.TAB].includes(e.key)&&this.selected)return e.preventDefault(),e.stopPropagation(),this.select(),!0;if(e.key===Lf.keycodes.ESCAPE)return this.close({reason:"esc"}),!0;if([Lf.keycodes.UP_ARROW,Lf.keycodes.DOWN_ARROW].includes(e.key))return e.preventDefault(),e.stopPropagation(),this[e.key===Lf.keycodes.UP_ARROW?"previous":"next"](),!0}if(![Lf.keycodes.SHIFT,Lf.keycodes.META,Lf.keycodes.ESCAPE,Lf.keycodes.ALT].includes(e.key))if(this.ac_triggers.includes(e.key)){if("Tab"===e.key){if(e.shiftKey)return;if(this.min_chars>0&&""===this.input.value)return;e.preventDefault()}this.auto_completing=!0}else if("Backspace"===e.key){const t=e.target,n=Rf.getCurrentWord(t,t.selectionEnd-1);ZE.isMention(n,this.ac_triggers)&&(this.auto_completing=!0)}}async evaluate(e){if(this.selected&&e&&(e.key===Lf.keycodes.UP_ARROW||e.key===Lf.keycodes.DOWN_ARROW))return;let t=this.match_current_word?Rf.getCurrentWord(this.input):this.input.value;const n=ZE.isMention(t,this.ac_triggers);n&&!this.include_triggers.includes(e.key)&&(t=Rf.isMentionBoundary(t[0])?t.slice(2):t.slice(1));const s=t.length&&t.length>=this.min_chars;if(n||s){this.auto_completing=!0;const e="function"==typeof this._list?await this._list(t):this._list;if(0===e.length||!this.auto_completing)return void this.close({reason:"nomatches"});this.index=-1,this.ul.innerHTML="",this.suggestions=e.map((e=>new XE(this.data(e,t),t))).filter((({value:e})=>this.filter(e,t))),this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.max_items),this.suggestions.forEach((e=>this.ul.appendChild(this.item(e,t)))),0===this.ul.children.length?this.close({reason:"nomatches"}):this.open()}else this.close({reason:"nomatches"}),n||(this.auto_completing=!1)}}const oj=rj;ad.elements.define("converse-autocomplete",class extends O_{static get properties(){return{auto_evaluate:{type:Boolean},auto_first:{type:Boolean},autofocus:{type:Boolean},data:{type:Function},error_message:{type:String},filter:{type:String},getAutoCompleteList:{type:Function},include_triggers:{type:String},list:{type:Array},min_chars:{type:Number},name:{type:String},placeholder:{type:String},position:{type:String},required:{type:Boolean},triggers:{type:String},validate:{type:Function},value:{type:String}}}constructor(){super(),this.auto_evaluate=!0,this.auto_first=!1,this.data=e=>e,this.error_message="",this.filter="contains",this.getAutoCompleteList=null,this.include_triggers="",this.list=null,this.match_current_word=!1,this.max_items=10,this.min_chars=1,this.name="",this.placeholder="",this.position="above",this.required=!1,this.triggers="",this.validate=null,this.value="",this.evaluate=Rf.debounce((e=>{this.auto_evaluate&&this.auto_complete.evaluate(e)}),250)}render(){const e=`suggestion-box__results--${this.position}`;return wh`<div class="suggestion-box suggestion-box__name"><ul class="suggestion-box__results ${e}" hidden=""></ul><input .validate="${this.validate}" ?autofocus="${this.autofocus}" ?required="${this.required}" @change="${this.onChange}" @keydown="${this.onKeyDown}" @input="${this.evaluate}" autocomplete="off" class="form-control suggestion-box__input ${this.error_message?"is-invalid error":""}" name="${this.name}" placeholder="${this.placeholder}" type="text" value="${this.value}"> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div>${this.error_message?wh`<div class="invalid-feedback">${this.error_message}</div>`:""}`}firstUpdated(){this.auto_complete=new oj(this.firstElementChild,{ac_triggers:this.triggers.split(" "),auto_first:this.auto_first,filter:"contains"==this.filter?ej:tj,include_triggers:[],list:this.list??(e=>this.getAutoCompleteList(e)),data:this.data,match_current_word:!0,max_items:this.max_items,min_chars:this.min_chars}),this.auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}onKeyDown(e){this.auto_complete.onKeyDown(e)}async onChange(){const e=this.querySelector("input");return this.error_message=await(this.validate?.(e.value)),this.error_message&&this.requestUpdate(),this}});var aj=n(593),cj={};cj.styleTagTransform=L(),cj.setAttributes=I(),cj.insert=N().bind(null,"head"),cj.domAPI=T(),cj.insertStyleElement=D();C()(aj.A,cj);aj.A&&aj.A.locals&&aj.A.locals;const lj={AutoComplete:oj};Object.assign(uo,lj),Object.assign(uo.exports,lj);const dj={execute:C_("Execute"),prev:C_("Previous"),next:C_("Next"),complete:C_("Complete")},uj={info:"primary",warn:"secondary",error:"danger"};const hj=(e,t)=>{const n=C_("Cancel");return wh`<span><form class="converse-form">${t.alert?wh`<div class="alert alert-${t.alert_type}" role="alert">${t.alert}</div>`:""} ${t.note?wh`<div class="alert alert-${uj[t.note.type||"info"]}" role="alert">${t.note.text}</div>`:""} ${"result"===t.type&&t.title?wh`<div class="alert alert-info">${t.title}</div>`:""} ${"form"===t.type&&t.title?wh`<h6>${t.title}</h6>`:""}<fieldset><input type="hidden" name="command_node" value="${t.node}"> <input type="hidden" name="command_jid" value="${t.jid}"> ${t.instructions?wh`<p class="form-instructions">${t.instructions}</p>`:""} ${"result"===t.type?function(e){return wh`<table class="table"><thead class="thead-light">${e.reported?.map((e=>wh`<th scope="col" data-var="${e.var}">${e.label}</th>`))}</thead><tbody>${e.items?.map((e=>wh`<tr>${e.map((e=>wh`<td data-var="${e.var}">${e.value}</td>`))}</tr>`))}</tbody></table>`}(t):""} ${t.fields?.map((e=>kw(e)),{domain:t.jid})??""}</fieldset>${t.actions?.length?wh`<fieldset>${t.actions?.map((t=>wh`<input data-action="${t}" @click="${t=>e.executeAction(t)}" type="button" class="btn btn-primary" value="${dj[t]}">`))} <input type="button" class="btn btn-secondary button-cancel" value="${n}" @click="${t=>e.cancel(t)}"></fieldset>`:""}</form></span>`};var fj=n(7983),mj={};mj.styleTagTransform=L(),mj.setAttributes=I(),mj.insert=N().bind(null,"head"),mj.domAPI=T(),mj.insertStyleElement=D();C()(fj.A,mj);fj.A&&fj.A.locals&&fj.A.locals;ad.elements.define("converse-avatar",class extends O_{static get properties(){return{model:{type:Object},pickerdata:{type:Object},name:{type:String},width:{type:String},height:{type:String},nonce:{type:String}}}constructor(){super(),this.model=null,this.pickerdata=null,this.width=36,this.height=36,this.name=""}render(){let e,t,n;if(this.pickerdata?(e=this.pickerdata.image_type,n=this.pickerdata.data_uri):(e=this.model?.vcard?.get("image_type"),t=this.model?.vcard?.get("image")),e&&(t||n))return(e=>{return e.image?wh`<svg xmlns="http://www.w3.org/2000/svg" class="avatar ${e.classes}" width="${e.width}" height="${e.height}" aria-label="${e.alt_text}" role="${e.alt_text?xh:"presentation"}"><image width="${e.width}" height="${e.height}" preserveAspectRatio="xMidYMid meet" href="${t=e.image,n=e.image_type,t.startsWith("data:")?t:`data:${n};base64,${t}`}"/></svg>`:"";var t,n})({classes:this.getAttribute("class"),height:this.height,width:this.width,image:n||`data:${e};base64,${t}`,image_type:e,alt_text:C_("The profile picture of %1$s",this.name)});const s=`\n            width: ${this.width}px;\n            height: ${this.height}px;\n            font: ${this.width/2}px Arial;\n            line-height: ${this.height}px;`,i=this.model.getAvatarStyle(s);return wh`<div class="avatar-initials" style="${Q_(i,"background-color: gray;"+s)}" aria-label="${this.name}">${this.getInitials(this.name)}</div>`}getInitials(e){const t=e?.split(" ");return t?.length>1?t[0].charAt(0).toUpperCase()+t[t.length-1].charAt(0).toUpperCase():1===t?.length?t[0].charAt(0).toUpperCase():""}});var gj=n(8083),pj={};pj.styleTagTransform=L(),pj.setAttributes=I(),pj.insert=N().bind(null,"head"),pj.domAPI=T(),pj.insertStyleElement=D();C()(gj.A,pj);gj.A&&gj.A.locals&&gj.A.locals;const{u:vj}=Lf.env;function bj(e){return"moderator"===e?C_("Moderators are privileged users who can change the roles of other users (except those with admin or owner affiliations."):"participant"===e?C_("The default role, implies that you can read and write messages."):"visitor"==e?C_("Visitors aren't allowed to write messages in a moderated multi-user chat."):void 0}function yj(e){return"owner"===e?C_("Owner is the highest affiliation. Owners can modify roles and affiliations of all other users."):"admin"===e?C_("Admin is the 2nd highest affiliation. Admins can modify roles and affiliations of all other users except owners."):"outcast"===e?C_('To ban a user, you give them the affiliation of "outcast".'):void 0}ad.elements.define("converse-muc-occupant-modal",class extends aE{constructor(e){super(),this.message=e.message,this.addEventListener("affiliationChanged",(()=>this.alert(C_("Affiliation changed")))),this.addEventListener("roleChanged",(()=>this.alert(C_("role changed"))))}initialize(){super.initialize();const e=this.model??this.message;this.listenTo(e,"change",(()=>this.requestUpdate())),ad.trigger("occupantModalInitialized",{model:this.model,message:this.message})}renderModal(){return(e=>{const t=e.model??e.message,n=t?.get("jid"),s=e.getVcard(),i=t.get("nick"),r=t.get("occupant_id"),o=e.model?.get("role"),a=e.model?.get("affiliation"),c=e.model?.get("hats")?.length?e.model.get("hats"):null,l=e.model.collection.chatroom,d=C_("Add to Contacts"),u=l.getAllowedCommands().includes("modtools"),h=l.features.get("nonanonymous")||"moderator"===l.getOwnRole(),f=n!=uo.session.get("bare_jid"),m=ad.settings.get("singleton")?"":ad.contacts.get(n).then((e=>!e&&f&&h)).then((t=>t?wh`<li><button class="btn btn-primary" type="button" @click="${()=>e.addToContacts()}">${d}</button></li>`:""));return wh`<div class="row"><div class="col-auto"><converse-avatar .model="${e.model}" class="avatar modal-avatar" name="${e.model.getDisplayName()}" nonce="${s?.get("vcard_updated")}" height="120" width="120"></converse-avatar></div><div class="col"><ul class="occupant-details list-unstyled"><li class="row mb-2"><div class="col text-start"><strong>${C_("Nickname")}:</strong></div><div class="col text-end">${i}</div></li><li class="row mb-2"><div class="col text-start"><strong>${C_("XMPP Address")}:</strong></div><div class="col text-end">${n?wh`<a href="#" @click="${e.openChat}">${n}</a>`:""}</div></li><li class="row mb-2"><div class="col text-start"><strong>${C_("Affiliation")}:</strong></div><div class="col text-end">${a}Â  ${u?wh`<a href="#" data-form="affiliation-form" class="toggle-form" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`:""}</div>${e.show_affiliation_form?wh`<div class="row mt-2"><converse-muc-affiliation-form jid="${n}" .muc="${l}" affiliation="${a}"></converse-muc-affiliation-form></div>`:""}</li><li class="row mb-2"><div class="col text-start"><strong>${C_("Role")}:</strong></div><div class="col text-end">${o}Â  ${u&&o?wh`<a href="#" data-form="row-form" class="toggle-form" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`:""}</div>${e.show_role_form?wh`<div class="row mt-2"><converse-muc-role-form jid="${n}" .muc="${l}" role="${o}"></converse-muc-role-form></div>`:""}</li><li class="row mb-2"><div class="col text-start"><strong>${C_("Hats")}:</strong></div><div class="col text-end">${c}</div></li><li class="row mb-2"><div class="col text-start"><strong>${C_("Occupant Id")}:</strong></div><div class="col text-end text-occupant-id">${r}</div></li>${Q_(m,"")}</ul></div></div>`})(this)}openChat(e){e.preventDefault(),ad.chats.open(this.model.get("jid"),{},!0),this.close()}getVcard(){const e=this.model??this.message;if(e.vcard)return e.vcard;const t=e?.get("jid")||e?.get("from");return t?uo.state.vcards.get(t):null}getModalTitle(){const e=this.model??this.message;return e?.getDisplayName()}addToContacts(){const e=(this.model??this.message).get("jid");e&&ad.modal.show("converse-add-contact-modal",{model:new ie.Model({jid:e})})}toggleForm(e){"row-form"===vj.ancestor(e.target,".toggle-form").getAttribute("data-form")?this.show_role_form=!this.show_role_form:this.show_affiliation_form=!this.show_affiliation_form,this.requestUpdate()}});const _j=(e,t)=>wh`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Role:</strong> ${t.item.role} ${t.assignable_roles.length?(e=>wh`<a href="#" data-form="converse-muc-role-form" class="toggle-form right" color="var(--secondary-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_roles.length?wh`<converse-muc-role-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" role="${t.item.role}"></converse-muc-role-form>`:""}</li></ul></li>`,wj=(e,t)=>wh`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Affiliation:</strong> ${t.item.affiliation} ${t.assignable_affiliations.length?(e=>wh`<a href="#" data-form="converse-muc-affiliation-form" class="toggle-form right" color="var(--secondary-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_affiliations.length?wh`<converse-muc-affiliation-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" affiliation="${t.item.affiliation}"></converse-muc-affiliation-form>`:""}</li></ul></li>`,Sj=(e,t)=>{const n=C_("Affiliation"),s=C_("No users with that affiliation found."),i=C_("No users with that role found."),r=C_("Type here to filter the search results"),o=C_("Role"),a=C_("Show users"),c=C_("Roles are assigned to users to grant or deny them certain abilities in a multi-user chat. They're assigned either explicitly or implicitly as part of an affiliation. A role that's not due to an affiliation, is only valid for the duration of the user's session."),l=C_("An affiliation is a long-lived entitlement which typically implies a certain role and which grants privileges and responsibilities. For example admins and owners automatically have the moderator role."),d=t.queryable_roles.length&&t.queryable_affiliations.length;return wh`${t.alert_message?wh`<div class="alert alert-${t.alert_type}" role="alert">${t.alert_message}</div>`:""} ${d?(e=>wh`<ul class="nav nav-pills justify-content-center"><li role="presentation" class="nav-item"><a class="nav-link ${"affiliations"===e.tab?"active":""}" id="affiliations-tab" href="#affiliations-tabpanel" aria-controls="affiliations-tabpanel" role="tab" data-name="affiliations" @click="${e.switchTab}">Affiliations</a></li><li role="presentation" class="nav-item"><a class="nav-link ${"roles"===e.tab?"active":""}" id="roles-tab" href="#roles-tabpanel" aria-controls="roles-tabpanel" role="tab" data-name="roles" @click="${e.switchTab}">Roles</a></li></ul>`)(t):""}<div class="tab-content">${t.queryable_affiliations.length?wh`<div class="tab-pane tab-pane--columns ${"affiliations"===t.tab?"active":""}" id="affiliations-tabpanel" role="tabpanel" aria-labelledby="affiliations-tab"><form class="converse-form query-affiliation" @submit="${t.queryAffiliation}"><p class="helptext pb-3">${l}</p><div><label class="form-label" for="affiliation"><strong>${n}:</strong></label><div class="row"><div class="col"><select class="form-select select-affiliation" name="affiliation">${t.queryable_affiliations.map((e=>(e=>wh`<option value="${e.item||""}" ?selected="${e.item===e.affiliation}" title="${yj(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_affiliation" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_affiliation)&&t.users_with_affiliation.length>5?wh`<input class="form-control" .value="${t.affiliations_filter}" @keyup="${t.filterAffiliationResults}" type="text" name="filter" placeholder="${r}">`:""}</div></div>${yj(t.affiliation)?wh`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${yj(t.affiliation)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_affiliation?wh`<li class="list-group-item">${Xx()}</li>`:""} ${Array.isArray(t.users_with_affiliation)&&0===t.users_with_affiliation.length?wh`<li class="list-group-item">${s}</li>`:""} ${t.users_with_affiliation instanceof Error?wh`<li class="list-group-item">${t.users_with_affiliation.message}</li>`:(t.users_with_affiliation||[]).map((n=>(n.nick||n.jid).match(new RegExp(t.affiliations_filter,"i"))?wj(e,Object.assign({item:n},t)):""))}</ul></div></div>`:""} ${t.queryable_roles.length?wh`<div class="tab-pane tab-pane--columns ${"roles"===t.tab?"active":""}" id="roles-tabpanel" role="tabpanel" aria-labelledby="roles-tab"><form class="converse-form query-role" @submit="${t.queryRole}"><p class="helptext pb-3">${c}</p><div><label class="form-label" for="role"><strong>${o}:</strong></label><div class="row"><div class="col"><select class="form-select select-role" name="role">${t.queryable_roles.map((e=>(e=>wh`<option value="${e.item||""}" ?selected="${e.item===e.role}" title="${bj(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_role" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_role)&&t.users_with_role.length>5?wh`<input class="form-control" .value="${t.roles_filter}" @keyup="${t.filterRoleResults}" type="text" name="filter" placeholder="${r}">`:""}</div></div>${bj(t.role)?wh`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${bj(t.role)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_role?wh`<li class="list-group-item">${Xx()}</li>`:""} ${t.users_with_role&&0===t.users_with_role.length?wh`<li class="list-group-item">${i}</li>`:""} ${(t.users_with_role||[]).map((n=>n.nick.match(t.roles_filter)?_j(e,Object.assign({item:n},t)):""))}</ul></div></div>`:""}</div>`};var Aj=n(1946),xj={};xj.styleTagTransform=L(),xj.setAttributes=I(),xj.insert=N().bind(null,"head"),xj.domAPI=T(),xj.insertStyleElement=D();C()(Aj.A,xj);Aj.A&&Aj.A.locals&&Aj.A.locals;const{u:$j}=Lf.env,{AFFILIATIONS:Ej,ROLES:jj}=__;ad.elements.define("converse-modtools",class extends O_{static get properties(){return{affiliation:{type:String},affiliations_filter:{type:String,attribute:!1},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1},jid:{type:String},muc:{type:Object,attribute:!1},role:{type:String},roles_filter:{type:String,attribute:!1},tab:{type:String},users_with_affiliation:{type:Array,attribute:!1},users_with_role:{type:Array,attribute:!1}}}constructor(){super(),this.jid=null,this.tab="affiliations",this.affiliation=null,this.affiliations_filter="",this.role="",this.roles_filter="",this.addEventListener("affiliationChanged",(()=>{this.alert(C_("Affiliation changed"),"primary"),this.onSearchAffiliationChange(),this.requestUpdate()})),this.addEventListener("roleChanged",(()=>{this.alert(C_("Role changed"),"primary"),this.requestUpdate()}))}updated(e){e.has("role")&&this.onSearchRoleChange(),e.has("affiliation")&&this.onSearchAffiliationChange(),e.has("jid")&&e.get("jid")&&this.initialize()}async initialize(){this.initialized=re();const e=await ad.rooms.get(this.jid);await e.initialized,this.muc=e,this.initialized.resolve()}render(){if(this.muc?.occupants){const e=this.muc.occupants.getOwnOccupant();return Sj(this,{affiliations_filter:this.affiliations_filter,alert_message:this.alert_message,alert_type:this.alert_type,assignable_affiliations:e.getAssignableAffiliations(),assignable_roles:e.getAssignableRoles(),filterAffiliationResults:e=>this.filterAffiliationResults(e),filterRoleResults:e=>this.filterRoleResults(e),loading_users_with_affiliation:this.loading_users_with_affiliation,queryAffiliation:e=>this.queryAffiliation(e),queryRole:e=>this.queryRole(e),queryable_affiliations:Ej.filter((e=>!ad.settings.get("modtools_disable_query").includes(e))),queryable_roles:jj.filter((e=>!ad.settings.get("modtools_disable_query").includes(e))),roles_filter:this.roles_filter,switchTab:e=>this.switchTab(e),tab:this.tab,toggleForm:e=>this.toggleForm(e),users_with_affiliation:this.users_with_affiliation,users_with_role:this.users_with_role})}return""}switchTab(e){e.stopPropagation(),e.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.requestUpdate()}async onSearchAffiliationChange(){if(this.affiliation){if(await this.initialized,this.clearAlert(),this.loading_users_with_affiliation=!0,this.users_with_affiliation=null,this.shouldFetchAffiliationsList()){const e=await ad.rooms.affiliations.get(this.affiliation,this.jid);e instanceof Error?(this.alert(e.message,"danger"),this.users_with_affiliation=[]):this.users_with_affiliation=e}else this.users_with_affiliation=this.muc.getOccupantsWithAffiliation(this.affiliation);this.loading_users_with_affiliation=!1}}async onSearchRoleChange(){this.role&&(await this.initialized,this.clearAlert(),this.users_with_role=this.muc.getOccupantsWithRole(this.role))}shouldFetchAffiliationsList(){const e=this.affiliation;if("none"===e)return!1;return!Ip.getAutoFetchedAffiliationLists().includes(e)}toggleForm(e){e.stopPropagation(),e.preventDefault();const t=$j.ancestor(e.target,".toggle-form"),n=t.getAttribute("data-form"),s=$j.ancestor(t,".list-group-item").querySelector(n);$j.hasClass("hidden",s)?$j.removeClass("hidden",s):$j.addClass("hidden",s)}filterRoleResults(e){this.roles_filter=e.target.value,this.requestUpdate()}filterAffiliationResults(e){this.affiliations_filter=e.target.value}queryRole(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("role");this.role=null,this.role=t}queryAffiliation(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("affiliation");this.affiliation=null,this.affiliation=t}alert(e,t){this.alert_message=e,this.alert_type=t}clearAlert(){this.alert_message=void 0,this.alert_type=void 0}});ad.elements.define("converse-modtools-modal",class extends aE{constructor(e){super(e),this.id="converse-modtools-modal",this.affiliation=e.affiliation,this.jid=e.jid}renderModal(){return wh`<converse-modtools jid="${this.jid}" affiliation="${this.affiliation}"></converse-modtools>`}getModalTitle(){return C_("Moderator Tools")}});const{Strophe:Cj,u:kj}=Lf.env,{CHATROOMS_TYPE:Tj}=__,Oj={admin:"admin",ban:"outcast",member:"member",owner:"owner",revoke:"none"},Nj={deop:"participant",kick:"none",mute:"visitor",op:"moderator",voice:"participant"};function Mj({contact:e,jid:t,reason:n}){return n?ad.confirm(C_('%1$s has invited you to join a groupchat: %2$s, and left the following reason: "%3$s"',e,t,n)):ad.confirm(C_("%1$s has invited you to join a groupchat: %2$s",e,t))}async function Ij(e){const t=[C_("Are you sure you want to destroy this groupchat?")];let n=[{name:"challenge",label:C_("Please enter the XMPP address of this groupchat to confirm"),challenge:e.get("jid"),placeholder:C_("name@example.org"),required:!0},{name:"reason",label:C_("Optional reason for destroying this groupchat"),placeholder:C_("Reason")},{name:"newjid",label:C_("Optional XMPP address for a new groupchat that replaces this one"),placeholder:C_("replacement@example.org")}];try{n=await ad.confirm(C_("Confirm"),t,n);const s=n.filter((e=>"reason"===e.name)).pop()?.value,i=n.filter((e=>"newjid"===e.name)).pop()?.value;return e.sendDestroyIQ(s,i).then((()=>e.close()))}catch(e){Y.error(e)}}function Rj(e){const t=e.session.get("view"),n=e.get("jid"),s=Lf.ROOMSTATUS,i=e.session.get("connection_status");return t===Lf.MUC.VIEWS.CONFIG?wh`<converse-muc-config-form class="muc-form-container" jid="${n}"></converse-muc-config-form>`:wh`${i==s.PASSWORD_REQUIRED?wh`<converse-muc-password-form class="muc-form-container" jid="${n}"></converse-muc-password-form>`:""} ${i==s.ENTERED?wh`<converse-muc-chatarea class="row g-0" jid="${n}"></converse-muc-chatarea>`:""} ${i==s.CONNECTING?Xx({class:"vertically-centered"}):""} ${i==s.NICKNAME_REQUIRED?function(e){const t=e.get("jid");return ad.settings.get("muc_show_logs_before_join")?wh`<converse-muc-chatarea class="row g-0" jid="${t}"></converse-muc-chatarea>`:wh`<converse-muc-nickname-form jid="${t}"></converse-muc-nickname-form>`}(e):""} ${i==s.DISCONNECTED?wh`<converse-muc-disconnected jid="${n}"></converse-muc-disconnected>`:""} ${i==s.BANNED?wh`<converse-muc-disconnected jid="${n}"></converse-muc-disconnected>`:""} ${i==s.DESTROYED?wh`<converse-muc-destroyed jid="${n}"></converse-muc-destroyed>`:""}`}async function Dj(){const e=[...await ad.rooms.get(),...await ad.contacts.get()],t=[...new Set(e.map((e=>Cj.getDomainFromJid(e.get("jid")))))];return t}function zj(e,t,n,s=[],i=[]){const r=Nj[t];if(!r)throw Error(`ChatRoomView#setRole called with invalid command: ${t}`);if(!e.verifyAffiliations(s)||!e.verifyRoles(i))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,n))return!1;const o=e.getNickOrJIDFromCommandArgs(n);if(!o)return!1;const a=n.split(o,2)[1].trim(),c=e.getOccupant(o);return e.setRole(c,r,a,void 0,(t=>e.onCommandError(t))),!0}function Lj(e,t,n,s){const i=Oj[t];if(!i)throw Error(`verifyAffiliations called with invalid command: ${t}`);if(!e.verifyAffiliations(s))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,n))return!1;const r=e.getNickOrJIDFromCommandArgs(n);if(!r)return!1;let o;const a=n.split(r,2)[1].trim(),c=e.getOccupant(r);if(c)o=c.get("jid");else{if(!kj.isValidJID(r)){const t=C_("Couldn't find a participant with that nickname. They might have left the groupchat.");return void e.createMessage({message:t,type:"error"})}o=r}const l={jid:o,reason:a};c&&ad.settings.get("auto_register_muc_nickname")&&(l.nick=c.get("nick")),kj.muc.setAffiliation(i,e.get("jid"),[l]).then((()=>e.occupants.fetchMembers())).catch((t=>e.onCommandError(t)))}function Pj(e,t){if(!e.verifyRoles(["moderator"]))return;let n=ad.modal.get("converse-modtools-modal");n?(n.affiliation=t,n.render()):n=ad.modal.create("converse-modtools-modal",{affiliation:t,jid:e.get("jid")}),n.show()}function Uj(e,t){const n=e.model;if(t||n.get("type")!==Tj||ad.settings.get("muc_disable_slash_commands")&&!Array.isArray(ad.settings.get("muc_disable_slash_commands")))return t;let s=e.text;s=s.replace(/^\s*/,"");const i=(s.match(/^\/([a-zA-Z]*) ?/)||[""]).pop().toLowerCase();if(!i)return!1;const r=s.slice(("/"+i).length+1).trim(),o=n.getAllowedCommands()??[];if("admin"===i&&o.includes(i))return Lj(n,i,r,["owner"]),!0;if("ban"===i&&o.includes(i))return Lj(n,i,r,["admin","owner"]),!0;if("modtools"===i&&o.includes(i))return Pj(n,r),!0;if("deop"===i&&o.includes(i))return zj(n,i,r,["admin","owner"]),!0;if("destroy"===i&&o.includes(i))return!n.verifyAffiliations(["owner"])||(Ij(n).catch((e=>n.onCommandError(e))),!0);if("help"===i&&o.includes(i))return n.set({show_help_messages:!1},{silent:!0}),n.set({show_help_messages:!0}),!0;if("kick"===i&&o.includes(i))return zj(n,i,r,[],["moderator"]),!0;if("mute"===i&&o.includes(i))return zj(n,i,r,[],["moderator"]),!0;if("member"===i&&o.includes(i))return Lj(n,i,r,["admin","owner"]),!0;if("nick"===i&&o.includes(i)){if(!n.verifyRoles(["visitor","participant","moderator"]))return!0;if(0===r.length){const e=C_('Your nickname is "%1$s"',n.get("nick"));n.createMessage({message:e,type:"error"})}else n.setNickname(r);return!0}return"owner"===i&&o.includes(i)?(Lj(n,i,r,["owner"]),!0):"op"===i&&o.includes(i)?(zj(n,i,r,["admin","owner"]),!0):"register"===i&&o.includes(i)?(r.length>1?n.createMessage({message:C_("Error: invalid number of arguments"),type:"error"}):n.registerNickname().then((e=>{e&&n.createMessage({message:e,type:"error"})})),!0):"revoke"===i&&o.includes(i)?(Lj(n,i,r,["admin","owner"]),!0):"topic"===i&&o.includes(i)||"subject"===i&&o.includes(i)?(n.setSubject(r),!0):!("voice"!==i||!o.includes(i))&&(zj(n,i,r,[],["moderator"]),!0)}const Bj=e=>{const t=C_("On which entity do you want to run commands?"),n=C_("Certain XMPP services and entities allow privileged users to execute ad-hoc commands on them."),s=C_("Commands found"),i=C_("List available commands"),r=C_("XMPP Address"),o=C_("No commands found");return wh`${e.alert?wh`<div class="alert alert-${e.alert_type}" role="alert">${e.alert}</div>`:""} ${e.note?wh`<p class="form-help">${e.note}</p>`:""}<form class="converse-form" @submit="${e.fetchCommands}"><fieldset><label class="form-label">${t}<p class="form-help">${n}</p><converse-autocomplete .getAutoCompleteList="${Dj}" required placeholder="${r}" name="jid"></converse-autocomplete></label></fieldset><fieldset>${e.fetching?wh`<converse-spinner></converse-spinner>`:wh`<input type="submit" class="btn btn-primary" value="${i}">`}</fieldset>${"list-commands"===e.view?wh`<fieldset><ul class="list-group"><li class="list-group-item active">${e.commands.length?s:o}:</li>${e.commands.map((t=>((e,t)=>wh`<li class="room-item list-group-item"><div class="available-chatroom d-flex flex-row"><a class="open-room available-room w-100" @click="${t=>e.toggleCommandForm(t)}" data-command-node="${t.node}" data-command-jid="${t.jid}" data-command-name="${t.name}" title="${t.name}" href="#">${t.name||t.jid}</a></div>${t.node===e.showform?hj(e,t):""}</li>`)(e,t)))}</ul></fieldset>`:""}</form>`},{Strophe:qj,sizzle:Fj}=Lf.env;async function Hj(e){e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-bookmark-name"),s=t.getAttribute("data-room-jid");await ad.confirm(C_('Are you sure you want to remove the bookmark "%1$s"?',n))&&uo.state.bookmarks.where({jid:s}).forEach((e=>e.destroy()))}function Gj(e){e.preventDefault();const{Strophe:t}=Lf.env,n=e.currentTarget,s=n.textContent,i=n.getAttribute("data-room-jid"),r={name:s||t.unescapeNode(t.getNodeFromJid(i))||i};ad.rooms.open(i,r,!0)}ad.elements.define("converse-adhoc-commands",class extends O_{static get properties(){return{alert:{type:String},alert_type:{type:String},commands:{type:Array},fetching:{type:Boolean},showform:{type:String},view:{type:String}}}constructor(){super(),this.view="choose-service",this.fetching=!1,this.showform="",this.commands=[]}render(){return Bj(this)}async fetchCommands(e){if(e.preventDefault(),!(e.target instanceof HTMLFormElement))return this.alert_type="danger",void(this.alert="Form could not be submitted");this.fetching=!0,delete this.alert_type,delete this.alert;const t=new FormData(e.target).get("jid").trim();let n;try{n=await ad.disco.supports(qj.NS.ADHOC,t)}catch(e){Y.error(e)}finally{this.fetching=!1}if(n)try{this.commands=await ad.adhoc.getCommands(t),this.view="list-commands"}catch(e){return Y.error(e),this.alert_type="danger",this.alert=C_("Sorry, an error occurred while looking for commands on that entity."),this.commands=[],void Y.error(e)}else this.commands=[],this.alert_type="danger",this.alert=C_("The specified entity doesn't support ad-hoc commands")}async toggleCommandForm(e){e.preventDefault();const t=e.target.getAttribute("data-command-node"),n=this.commands.filter((e=>e.node===t))[0],{jid:s}=n;if(this.showform===t)this.showform="",this.requestUpdate();else{try{const e=await ad.adhoc.fetchCommandForm(s,t);Object.assign(n,e)}catch(e){null===e?Y.error(`Error: timeout while trying to execute command for ${s}`):(Y.error(`Error while trying to execute command for ${s}`),Y.error(e)),n.alert=C_("An error occurred while trying to fetch the command form"),n.alert_type="danger"}this.showform=t}}executeAction(e){e.preventDefault();const t=e.target,n=t.getAttribute("data-action");["execute","next","prev","complete"].includes(n)?this.runCommand(t.form,n):Y.error(`Unknown action: ${n}`)}clearCommand(e){delete e.alert,delete e.instructions,delete e.sessionid,delete e.alert_type,delete e.status,e.fields=[],e.actions=[],this.showform=""}async runCommand(e,t){const n=new FormData(e),s=n.get("command_jid").trim(),i=n.get("command_node").trim(),r=this.commands.filter((e=>e.node===i))[0];delete r.alert,this.requestUpdate();const o="prev"===t?[]:Fj(":input:not([type=button]):not([type=submit])",e).filter((e=>!["command_jid","command_node"].includes(e.getAttribute("name")))).map(bw).filter((e=>e)),a=await ad.adhoc.runCommand(s,r.sessionid,r.node,t,o),{fields:c,status:l,note:d,instructions:u,actions:h}=a;if("error"===l)return r.status=l,r.alert_type="danger",r.alert=C_("Sorry, an error occurred while trying to execute the command. See the developer console for details"),this.requestUpdate();"executing"===l?(Object.assign(r,{fields:c,instructions:u,actions:h,status:l}),r.alert=C_("Executing"),r.alert_type="primary"):"completed"===l?(this.alert_type="primary",this.alert=C_("Completed"),this.note=d,this.clearCommand(r)):(Y.error(`Unexpected status for ad-hoc command: ${l}`),r.alert=C_("Completed"),r.alert_type="primary"),this.requestUpdate()}async cancel(e){e.preventDefault(),this.showform="",this.requestUpdate();const t=new FormData(e.target.form),n=t.get("command_jid").trim(),s=t.get("command_node").trim(),i=this.commands.filter((e=>e.node===s))[0];delete i.alert,this.requestUpdate();const{status:r}=await ad.adhoc.runCommand(n,i.sessionid,i.node,"cancel",[]);"error"===r?(i.alert_type="danger",i.alert=C_("An error occurred while trying to cancel the command. See the developer console for details")):"canceled"===r?(this.alert_type="",this.alert="",this.clearCommand(i)):(Y.error(`Unexpected status for ad-hoc command: ${r}`),i.alert=C_("Error: unexpected result"),i.alert_type="danger"),this.requestUpdate()}}),Lf.plugins.add("converse-adhoc-views",{dependencies:["converse-controlbox","converse-muc"],initialize(){ad.settings.extend({allow_adhoc_commands:!0})}});const Wj=e=>{const t=e.get("jid"),n=C_("Unbookmark this groupchat"),s=C_("Click to open this groupchat");return wh`<div class="list-item room-item available-chatroom d-flex flex-row" data-room-jid="${t}"><a class="list-item-link open-room w-100" data-room-jid="${t}" title="${s}" @click="${Gj}">${e.getDisplayName()}</a> <a class="list-item-action remove-bookmark align-self-center ${e.get("bookmarked")?"button-on":""}" tabindex="0" data-room-jid="${t}" data-bookmark-name="${e.getDisplayName()}" title="${n}" @click="${Hj}"><converse-icon class="fa fa-times" size="1em"></converse-icon></a></div>`};var Vj=n(1205),Kj={};Kj.styleTagTransform=L(),Kj.setAttributes=I(),Kj.insert=N().bind(null,"head"),Kj.domAPI=T(),Kj.insertStyleElement=D();C()(Vj.A,Kj);Vj.A&&Vj.A.locals&&Vj.A.locals;const{initStorage:Jj}=Rf;class Yj extends O_{async initialize(){await ad.waitUntil("bookmarksInitialized");const{bookmarks:e,chatboxes:t}=uo.state;this.liveFilter=$o((e=>this.model.set({text:e.target.value})),100),this.listenTo(e,"add",(()=>this.requestUpdate())),this.listenTo(e,"remove",(()=>this.requestUpdate())),this.listenTo(t,"add",(()=>this.requestUpdate())),this.listenTo(t,"remove",(()=>this.requestUpdate()));const n=`converse.bookmarks-list-model-${uo.session.get("bare_jid")}`;this.model=new ie.Model({id:n}),Jj(this.model,n),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.model.fetch({success:()=>this.requestUpdate(),error:()=>this.requestUpdate()})}render(){return uo.state.bookmarks&&this.model?(e=>{const t=C_("Filter"),n=e.model.get("text"),{bookmarks:s}=uo.state,i=n?s.filter((e=>((e,t)=>e.get("name")?.includes(t)||e.get("jid")?.includes(t))(e,n))):s;return wh`<form class="converse-form bookmarks-filter"><div class="btn-group w-100"><input .value="${n??""}" @keydown="${t=>e.liveFilter(t)}" class="form-control" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${n?"":"hidden"}" @click="${e.clearFilter}"></converse-icon></div></form><div class="list-container list-container--bookmarks"><div class="items-list bookmarks rooms-list">${i.map((e=>Wj(e)))}</div></div>`})(this):Xx()}clearFilter(e){e?.stopPropagation?.(),this.model.set("text","")}}ad.elements.define("converse-bookmarks",Yj);ad.elements.define("converse-bookmark-list-modal",class extends aE{renderModal(){return wh`<converse-bookmarks></converse-bookmarks>`}getModalTitle(){return C_("Bookmarks")}});class Xj extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}willUpdate(e){const{chatboxes:t,bookmarks:n}=uo.state;e.has("jid")&&(this.model=t.get(this.jid),this.bookmark=n.get(this.jid))}render(){return(e=>{const t=e.model.getDisplayName(),n=e.bookmark?.get("nick")??e.model.get("nick"),s=C_('Bookmark for "%1$s"',t),i=C_("Would you like this groupchat to be automatically joined upon startup?"),r=C_("Remove"),o=C_("Name"),a=C_("What should your nickname for this groupchat be?"),c=C_("Password (for a protected groupchat)"),l=C_("If the groupchat requires a password to enter, you can save it here. Note this is not intended to be a secure storage."),d=e.bookmark?C_("Update"):C_("Save");return wh`<form class="converse-form chatroom-form" @submit="${t=>e.onBookmarkFormSubmitted(t)}"><legend>${s}</legend><fieldset><label class="form-label" for="converse_muc_bookmark_name">${o}</label> <input class="form-control" type="text" value="${t}" name="name" required="required" id="converse_muc_bookmark_name"></fieldset><fieldset><label class="form-label" for="converse_muc_bookmark_nick">${a}</label> <input class="form-control" type="text" name="nick" value="${n||""}" id="converse_muc_bookmark_nick"></fieldset><fieldset><label for="muc-password" class="form-label">${c}</label><p class="form-help">${l}</p><input type="password" name="password" class="form-control" id="muc-password"></fieldset><fieldset class="form-group form-check"><input class="form-check-input" id="converse_muc_bookmark_autojoin" type="checkbox" ?checked="${e.bookmark?.get("autojoin")}" name="autojoin"> <label class="form-check-label" for="converse_muc_bookmark_autojoin">${i}</label></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${d}"> ${e.bookmark?wh`<input class="btn btn-secondary button-remove" type="button" value="${r}" @click="${t=>e.removeBookmark(t)}">`:""}</fieldset></form>`})(this)}onBookmarkFormSubmitted(e){e.preventDefault();const{bookmarks:t}=uo.state,n=e.target;t.setBookmark({jid:this.jid,autojoin:n.querySelector('input[name="autojoin"]')?.checked||!1,name:n.querySelector("input[name=name]")?.value,nick:n.querySelector("input[name=nick]")?.value,password:n.querySelector("input[name=password]")?.value}),this.closeBookmarkForm(e)}removeBookmark(e){this.bookmark?.destroy(),this.closeBookmarkForm(e)}closeBookmarkForm(e){e.preventDefault(),this.dispatchEvent(new Event("hide.bs.modal",{bubbles:!0,cancelable:!0}))}}ad.elements.define("converse-muc-bookmark-form",Xj);const Qj=Xj;ad.elements.define("converse-bookmark-form-modal",class extends aE{constructor(e){super(e),this.jid=null}renderModal(){return wh`<converse-muc-bookmark-form class="muc-form-container" jid="${this.jid}"></converse-muc-bookmark-form>`}getModalTitle(){return C_("Bookmark")}});const{u:Zj}=Lf.env,eC={setBookmarkState(){const{bookmarks:e}=uo.state;if(e){e.where({jid:this.model.get("jid")}).length?this.model.save("bookmarked",!0):this.model.save("bookmarked",!1)}},renderBookmarkForm(){if(!this.bookmark_form){this.bookmark_form=new uo.state.MUCBookmarkForm({model:this.model,chatroomview:this});this.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.bookmark_form.el)}Zj.showElement(this.bookmark_form.el)},showBookmarkModal(e){e?.preventDefault();const t=this.model.get("jid");ad.modal.show("converse-bookmark-form-modal",{jid:t},e)}};Lf.plugins.add("converse-bookmark-views",{dependencies:["converse-chatboxes","converse-muc","converse-muc-views"],initialize(){ad.settings.extend({hide_open_bookmarks:!0});const e={removeBookmarkViaEvent:Hj,MUCBookmarkForm:Qj,BookmarksView:Yj};Object.assign(uo,e),Object.assign(uo.exports,e),Object.assign(uo.exports.ChatRoomView.prototype,eC),ad.listen.on("chatRoomViewInitialized",(e=>e.setBookmarkState()))}});const tC=(e,t,n)=>{const s=new Map;for(let i=t;i<=n;i++)s.set(e[i],i);return s},nC=P_(class extends U_{constructor(e){if(super(e),e.type!==L_)throw Error("repeat() can only be used in text expressions")}dt(e,t,n){let s;void 0===n?n=t:void 0!==t&&(s=t);const i=[],r=[];let o=0;for(const t of e)i[o]=s?s(t,o):o,r[o]=n(t,o),o++;return{values:r,keys:i}}render(e,t,n){return this.dt(e,t,n).values}update(e,[t,n,s]){const i=(e=>e._$AH)(e),{values:r,keys:o}=this.dt(t,n,s);if(!Array.isArray(i))return this.ut=o,r;const a=this.ut??=[],c=[];let l,d,u=0,h=i.length-1,f=0,m=r.length-1;for(;u<=h&&f<=m;)if(null===i[u])u++;else if(null===i[h])h--;else if(a[u]===o[f])c[f]=R_(i[u],r[f]),u++,f++;else if(a[h]===o[m])c[m]=R_(i[h],r[m]),h--,m--;else if(a[u]===o[m])c[m]=R_(i[u],r[m]),I_(e,c[m+1],i[u]),u++,m--;else if(a[h]===o[f])c[f]=R_(i[h],r[f]),I_(e,i[u],i[h]),h--,f++;else if(void 0===l&&(l=tC(o,f,m),d=tC(a,u,h)),l.has(a[u]))if(l.has(a[h])){const t=d.get(o[f]),n=void 0!==t?i[t]:null;if(null===n){const t=I_(e,i[u]);R_(t,r[f]),c[f]=t}else c[f]=R_(n,r[f]),I_(e,i[u],n),i[t]=null;f++}else z_(i[h]),h--;else z_(i[u]),u++;for(;f<=m;){const t=I_(e,c[m+1]);R_(t,r[f]),c[f++]=t}for(;u<=h;){const e=i[u++];null!==e&&z_(e)}return this.ut=o,((e,t=D_)=>{e._$AH=t})(e,c),Ah}}),{CONTROLBOX_TYPE:sC,CHATROOMS_TYPE:iC,HEADLINES_TYPE:rC,CONNECTION_STATUS:oC}=__;function aC(e){const t="overlayed"===ad.settings.get("view_mode")&&e.get("hidden");return e.get("type")===sC||!(e.get("hidden")||t)}ad.elements.define("converse-chats",class extends O_{initialize(){this.model=uo.state.chatboxes,this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>this.requestUpdate())),this.listenTo(this.model,"change:jid",(()=>this.requestUpdate())),this.listenTo(this.model,"destroy",(()=>this.requestUpdate())),this.listenTo(uo,"connected",(()=>this.requestUpdate())),this.listenTo(uo,"reconnected",(()=>this.requestUpdate())),this.listenTo(uo,"disconnected",(()=>this.requestUpdate()));const e=ad.settings.get();this.listenTo(e,"change:view_mode",(()=>this.requestUpdate())),this.listenTo(e,"change:singleton",(()=>this.requestUpdate()));document.querySelector("body").classList.add(`converse-${ad.settings.get("view_mode")}`),ad.trigger("chatBoxViewsInitialized")}render(){return(()=>{const{chatboxes:e,connfeedback:t}=uo.state,n=ad.settings.get("view_mode"),s=ad.connection.get(),i=!s?.connected||!s?.authenticated||s?.disconnecting,r=t.get("connection_status"),o=["CONNECTED","CONNECTING","AUTHENTICATING","RECONNECTING"].includes(oC[r]);return wh`${i||"overlayed"!==n?"":wh`<converse-minimized-chats class="col-auto"></converse-minimized-chats>`} ${nC(e.filter(aC),(e=>e.get("jid")),(e=>e.get("type")===sC?wh`${"overlayed"===n?wh`<converse-controlbox-toggle class="${e.get("closed")?"col-auto":"hidden"}"></converse-controlbox-toggle>`:""}<converse-controlbox id="controlbox" class="col-auto chatbox ${"overlayed"===n&&e.get("closed")?"hidden":""} ${i&&!o?"logged-out":""}" style="${e.get("width")?`width: ${e.get("width")}`:""}"></converse-controlbox>`:e.get("type")===iC?wh`<converse-muc jid="${e.get("jid")}" class="col-auto chatbox chatroom"></converse-muc>`:e.get("type")===rC?wh`<converse-headlines jid="${e.get("jid")}" class="col-auto chatbox headlines"></converse-headlines>`:wh`<converse-chat jid="${e.get("jid")}" class="col-auto chatbox"></converse-chat>`))}`})()}});const cC=class{constructor(){this.views={},this.el=null}add(e,t){this.views[e]=t}get(e){return this.views[e]}xget(e){return this.keys().filter((t=>t!==e)).reduce(((e,t)=>(e[t]=this.views[t],e)),{})}getAll(){return Object.values(this.views)}keys(){return Object.keys(this.views)}remove(e){delete this.views[e]}map(e){return Object.values(this.views).map(e)}forEach(e){return Object.values(this.views).forEach(e)}filter(e){return Object.values(this.views).filter(e)}closeAllChatBoxes(){return Promise.all(Object.values(this.views).map((e=>e.close({name:"closeAllChatBoxes"}))))}};function lC(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}var dC=n(3403),uC={};uC.styleTagTransform=L(),uC.setAttributes=I(),uC.insert=N().bind(null,"head"),uC.domAPI=T(),uC.insertStyleElement=D();C()(dC.A,uC);dC.A&&dC.A.locals&&dC.A.locals;Lf.plugins.add("converse-chatboxviews",{dependencies:["converse-chatboxes","converse-vcard"],initialize(){ad.promises.add(["chatBoxViewsInitialized"]),ad.settings.extend({animate:!0});const e=new cC;Object.assign(uo,{chatboxviews:e}),Object.assign(uo.state,{chatboxviews:e}),ad.listen.on("chatBoxesInitialized",(()=>{uo.state.chatboxes.on("destroy",(t=>e.remove(t.get("jid"))))})),ad.listen.on("cleanup",(()=>Object.assign(uo,{chatboxviews:null}))),ad.listen.on("cleanup",(()=>delete uo.state.chatboxviews)),ad.listen.on("clearSession",(()=>e.closeAllChatBoxes())),ad.listen.on("chatBoxViewsInitialized",lC),window.addEventListener("resize",lC),Object.assign(Lf,{insertInto(t){const n=e.el;if(n&&!t.contains(n))t.insertAdjacentElement("afterbegin",n);else if(!n)throw new Error("Cannot insert non-existing #conversejs element into the DOM")}})}});const{dayjs:hC,u:fC}=Lf.env,{convertASCII2Emoji:mC,getShortnameReferences:gC,getCodePointReferences:pC}=fC;function vC(e){const t=e.get("num_unread")||0;return t<100?t:"99+"}async function bC(e){return(await e).filter((e=>e.standalone)).map((e=>async function(e){const t=await e;return wh`<button type="button" class="btn chatbox-btn ${t.a_class}" @click="${t.handler}" title="${t.i18n_title}"><converse-icon size="1em" class="fa ${t.icon_class}"></converse-icon></button>`}(e))).reverse().map((e=>Q_(e,"")))}async function yC(e){const t=(await e).filter((e=>!e.standalone)).map((e=>async function(e){const t=await e;return t?wh`<a href="#" role="button" class="dropdown-item ${t.a_class}" @click="${t.handler}" title="${t.i18n_title}"><converse-icon size="1em" class="fa ${t.icon_class}"></converse-icon>${t.i18n_text}</a>`:""}(e)));return t.length?wh`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${t}"></converse-dropdown>`:""}function _C(e){if(!e.isHidden()&&ad.settings.get("allow_url_history_change")){const t=window.location.hash;t&&e.messages.get(t.slice(1))&&history.pushState(null,"",window.location.pathname)}}function wC(e){const t=e.collection?.models;if(!t)return;const n=t.indexOf(e),s=t[n-1];if(!s||hC(e.get("time")).isAfter(hC(s.get("time")),"day")){const t=hC(e.get("time")).startOf("day");return(e=>wh`<div class="message date-separator" data-isodate="${e.time}"><hr class="separator"><time class="separator-text" datetime="${e.time}"><span>${e.datestring}</span></time></div>`)({type:"date",time:t.toISOString(),datestring:t.format("dddd MMM Do YYYY")})}}function SC(){return Lf.emojis.toned||(Lf.emojis.toned=fC.unique(Object.values(Lf.emojis.json.people).filter((e=>e.sn.includes("_tone"))).map((e=>e.sn.replace(/_tone[1-5]/,""))))),Lf.emojis.toned}function AC(e,t={unicode_only:!1,add_title_wrapper:!1}){const n=e.emoji,s=e.shortname;if(n){if(t.unicode_only)return n;if(ad.settings.get("use_system_emojis"))return t.add_title_wrapper&&s?wh`<span title="${s}">${n}</span>`:n;{const t=ad.settings.get("emoji_image_path");return wh`<img class="emoji" loading="lazy" draggable="false" title="${s}" alt="${n}" src="${t}/72x72/${e.cp}.png">`}}if(t.unicode_only)return s;{const{url:e}=Lf.emojis.by_sn[s];return wh`<img class="emoji" loading="lazy" draggable="false" title="${s}" alt="${s}" src="${e.startsWith(".")?`${ad.settings.get("assets_path")}/${e}`:e}">`}}Object.assign(fC,{shortnamesToEmojis:function(e,t={unicode_only:!1,add_title_wrapper:!1}){return function(e,t){let n=[e];return[...gC(e),...pC(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const s=n.shift(),i=AC(e,t);n="string"==typeof i?[s.slice(0,e.begin)+i+s.slice(e.end),...n]:[s.slice(0,e.begin),i,s.slice(e.end),...n]})),n}(e=mC(e),t)}});var xC=n(7187),$C={};$C.styleTagTransform=L(),$C.setAttributes=I(),$C.insert=N().bind(null,"head"),$C.domAPI=T(),$C.insertStyleElement=D();C()(xC.A,$C);xC.A&&xC.A.locals&&xC.A.locals;const{getMediaURLs:EC}=Rf,{CHATROOMS_TYPE:jC}=__;class CC extends O_{static get properties(){return{is_retracted:{type:Boolean},model:{type:Object}}}constructor(){super(),this.model=null,this.is_retracted=null}initialize(){const e=ad.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.chatbox.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.chatbox.occupants,"add",this.updateIfOwnOccupant),this.listenTo(this.model.chatbox.occupants,"change:role",this.updateIfOwnOccupant),this.listenTo(this.model.chatbox.session,"change:connection_status",(()=>this.requestUpdate()))}updateIfOwnOccupant(e){const t=uo.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}render(){return wh`${Q_(this.renderActions(),"")}`}async renderActions(){if(!this.model.collection)return"";const e=(await this.getActionButtons()).map((e=>CC.getActionsDropdownItem(e)));return e.length?wh`<converse-dropdown class="chat-msg__actions btn-group dropstart" .items="${e}"></converse-dropdown>`:""}static getActionsDropdownItem(e){return wh`<button type="button" class="dropdown-item chat-msg__action ${e.button_class}" @click="${e.handler}"><converse-icon class="${e.icon_class}" color="var(--foreground-color)" size="1em"></converse-icon>Â ${e.i18n_text}</button>`}async onMessageEditButtonClicked(e){e.preventDefault();const t=this.model.collection.findWhere("correcting"),n=Rf.ancestor(this,".chatbox")?.querySelector(".chat-textarea")?.value;if(n&&(!t||t.getMessageText()!==n)){if(!await ad.confirm(C_("Confirm"),C_("You have an unsent message which will be lost if you continue. Are you sure?")))return}t!==this.model?(t?.save("correcting",!1),this.model.save("correcting",!0)):this.model.save("correcting",!1)}async onDirectMessageRetractButtonClicked(){if("me"!==this.model.get("sender"))return Y.error("onMessageRetractButtonClicked called for someone else's message!");const e=C_("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere."),t=[C_("Are you sure you want to retract this message?")];ad.settings.get("show_retraction_warning")&&(t[1]=e);if(await ad.confirm(C_("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}}async retractOtherMessage(e){const t=this.model.collection.chatbox,n=await t.retractOtherMessage(this.model,e);if(null===n){const e=C_("A timeout occurred while trying to retract the message");ad.alert("error",C_("Error"),e),Y.warn(e)}else if(Rf.isErrorStanza(n)){const e=C_("Sorry, you're not allowed to retract this message.");ad.alert("error",C_("Error"),e),Y.warn(e),Y.error(n)}}async onMUCMessageRetractButtonClicked(){const e=C_("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere.");if(this.model.mayBeRetracted()){const t=[C_("Are you sure you want to retract this message?")];if(ad.settings.get("show_retraction_warning")&&(t[1]=e),await ad.confirm(C_("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}}else if(await this.model.mayBeModerated())if("me"===this.model.get("sender")){let t=[C_("Are you sure you want to retract this message?")];ad.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]),await ad.confirm(C_("Confirm"),t)&&this.retractOtherMessage()}else{let t=[C_("You are about to retract this message."),C_("You may optionally include a message, explaining the reason for the retraction.")];ad.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]);const n=await ad.prompt(C_("Message Retraction"),t,C_("Optional reason"));!1!==n&&this.retractOtherMessage(n)}else{const e=C_("Sorry, you're not allowed to retract this message");ad.alert("error",C_("Error"),e)}}onMessageRetractButtonClicked(e){e?.preventDefault?.();this.model.collection.chatbox.get("type")===jC?this.onMUCMessageRetractButtonClicked():this.onDirectMessageRetractButtonClicked()}onMediaToggleClicked(e){if(e?.preventDefault?.(),this.hasHiddenMedia(this.getMediaURLs()))this.model.save({hide_url_previews:!1,url_preview_transition:"fade-in"});else{(this.model.get("ogp_metadata")||[]).length?this.model.set("url_preview_transition","fade-out"):this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}}hasHiddenMedia(e){if("boolean"==typeof this.model.get("hide_url_previews"))return this.model.get("hide_url_previews");const t=ad.settings.get("render_media");return Array.isArray(t)?e.reduce(((e,n)=>e||!g$(t,n)),!1):!t}getMediaURLs(){const e=(this.model.get("ogp_metadata")||[]).map((e=>({url:e["og:image"],is_image:!0}))).filter((e=>v$(e))),t=EC(this.model.get("media_urls")||[],this.model.get("body")).filter((e=>v$(e)));return[...new Set([...t.map((e=>e.url)),...e.map((e=>e.url))])]}addMediaRenderingToggle(e){const t=this.getMediaURLs();if(t.length){const n=this.hasHiddenMedia(t);e.push({i18n_text:C_(n?"Show media":"Hide media"),handler:e=>this.onMediaToggleClicked(e),button_class:"chat-msg__action-hide-previews",icon_class:n?"fas fa-eye":"fas fa-eye-slash",name:"hide"})}}async onMessageCopyButtonClicked(e){e?.preventDefault?.(),await navigator.clipboard.writeText(this.model.getMessageText())}onMessageQuoteButtonClicked(e){e?.preventDefault?.();const t=this.model.collection.chatbox,n=Rf.ancestor(this,".chatbox")?.querySelector(".chat-textarea")?.selectionEnd,s=this.model.getMessageText().replaceAll(/^/gm,"> ");let i=t.get("draft")??"";n?i=`${i.slice(0,n)}\n${s}\n${i.slice(n)}`:i+=s,t.save({draft:i})}async getActionButtons(){const e=[];this.model.get("editable")&&e.push({i18n_text:this.model.get("correcting")?C_("Cancel Editing"):C_("Edit"),handler:e=>this.onMessageEditButtonClicked(e),button_class:"chat-msg__action-edit",icon_class:"fa fa-pencil-alt",name:"edit"});const t=["groupchat","mep"].includes(this.model.get("type"))&&await this.model.mayBeModerated();return!this.is_retracted&&(this.model.mayBeRetracted()||t)&&e.push({i18n_text:C_("Retract"),handler:e=>this.onMessageRetractButtonClicked(e),button_class:"chat-msg__action-retract",icon_class:"fas fa-trash-alt",name:"retract"}),this.model.collection?(this.addMediaRenderingToggle(e),e.push({i18n_text:C_("Copy"),handler:e=>this.onMessageCopyButtonClicked(e),button_class:"chat-msg__action-copy",icon_class:"fas fa-copy",name:"copy"}),this.model.collection.chatbox.canPostMessages()&&e.push({i18n_text:C_("Quote"),handler:e=>this.onMessageQuoteButtonClicked(e),button_class:"chat-msg__action-quote",icon_class:"fas fa-quote-right",name:"quote"}),ad.hook("getMessageActionButtons",this,e)):[]}}ad.elements.define("converse-message-actions",CC);var kC=n(719),TC={};TC.styleTagTransform=L(),TC.setAttributes=I(),TC.insert=N().bind(null,"head"),TC.domAPI=T(),TC.insertStyleElement=D();C()(kC.A,TC);kC.A&&kC.A.locals&&kC.A.locals;ad.elements.define("converse-image-modal",class extends aE{constructor(e){super(e),this.src=e.src}renderModal(){return(e=>wh`<img class="chat-image chat-image--modal" src="${e.src}">`)({src:this.src})}getModalTitle(){return wh`${C_("Image: ")}<a target="_blank" rel="noopener" href="${this.src}">${yw(this.src)}</a>`}});var OC=n(8555),NC={};NC.styleTagTransform=L(),NC.setAttributes=I(),NC.insert=N().bind(null,"head"),NC.domAPI=T(),NC.insertStyleElement=D();C()(OC.A,NC);OC.A&&OC.A.locals&&OC.A.locals;const MC=(e,t,n)=>{const{hostname:s}=Rf.getURL(e);return wh`<figure class="audio-element">${n||!t?wh`<figcaption>${n?wh`${n}<br>`:""} ${t?"":wh`<a target="_blank" rel="noopener" title="${e}" href="${e}">${s}</a>`}</figcaption>`:""}<audio controls src="${e}"></audio></figure>`};var IC=n(190);class RC{constructor(e,t){this.options=Object.assign({width:null,height:null,autoplay:!0,loop:!0,show_progress_bar:!0,progress_bg_color:"rgba(0,0,0,0.4)",progress_color:"rgba(255,0,22,.8)",progress_bar_height:5},t),this.el=e,this.gif_el=e.querySelector("img"),this.canvas=e.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.offscreenCanvas=document.createElement("canvas"),this.patchCanvas=document.createElement("canvas"),this.ctx_scaled=!1,this.frames=[],this.load_error=null,this.playing=this.options.autoplay,this.frame_idx=0,this.iteration_count=0,this.start=null,this.hovering=null,this.frameImageData=null,this.disposal_restore_from_idx=null,this.initialize()}async initialize(){this.options.width&&this.options.height&&this.setSizes(this.options.width,this.options.height);const e=await this.fetchGIF(this.gif_el.src);requestAnimationFrame((()=>this.handleGIFResponse(e)))}initPlayer(){if(!this.load_error&&(this.options.width&&this.options.height||this.ctx.scale(this.getCanvasScale(),this.getCanvasScale()),this.frame_idx=0,this.renderImage(),this.options.autoplay)){const e=this.frames[this.frame_idx]?.delay??0;setTimeout((()=>this.play()),e)}}getNextFrameNo(){return 0===this.frames.length?0:(this.frame_idx+1+this.frames.length)%this.frames.length}onIterationEnd(){return this.iteration_count++,this.options.onIterationEnd?.(this.el),!this.options.loop&&(this.pause(),!0)}onAnimationFrame(e,t,n){if(!this.playing)return;if(e-t<n)return this.hovering?this.drawPauseIcon():this.renderImage(),void requestAnimationFrame((e=>this.onAnimationFrame(e,t,n)));const s=this.getNextFrameNo();if(0===s&&this.onIterationEnd())return;this.frame_idx=s,this.renderImage();const i=this.frames[this.frame_idx]?.delay||8;requestAnimationFrame((t=>this.onAnimationFrame(t,e,i)))}setSizes(e,t){this.canvas.width=e*this.getCanvasScale(),this.canvas.height=t*this.getCanvasScale(),this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,this.offscreenCanvas.style.width=e+"px",this.offscreenCanvas.style.height=t+"px",this.offscreenCanvas.getContext("2d").setTransform(1,0,0,1,0,0)}doShowProgress(e,t,n){if(n&&this.options.show_progress_bar){let n=this.options.progress_bar_height;const s=(this.canvas.height-n)/(this.ctx_scaled?this.getCanvasScale():1),i=e/t*this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1),r=this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1);n/=this.ctx_scaled?this.getCanvasScale():1,this.ctx.fillStyle=this.options.progress_bg_color,this.ctx.fillRect(i,s,r-i,n),this.ctx.fillStyle=this.options.progress_color,this.ctx.fillRect(0,s,i,n)}}handleGIFResponse(e){try{const t=(0,IC.O5)(e);this.hdr=t.header,this.lsd=t.lsd,this.setSizes(this.options.width??this.lsd.width,this.options.height??this.lsd.height),this.frames=(0,IC.Ud)(t,!0)}catch(e){this.showError()}this.initPlayer(),!this.options.autoplay&&this.drawPlayIcon()}drawError(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.options.width,this.options.height),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(this.options.width,this.options.height),this.ctx.moveTo(0,this.options.height),this.ctx.lineTo(this.options.width,0),this.ctx.stroke()}showError(){this.load_error=!0,this.hdr={width:this.gif_el.width,height:this.gif_el.height},this.frames=[],this.drawError(),this.el.requestUpdate()}manageDisposal(e){if(e<=0)return;const t=this.offscreenCanvas.getContext("2d"),n=this.frames[e-1].disposalType;e>1&&(3===n?null!=this.disposal_restore_from_idx&&t.putImageData(this.frames[this.disposal_restore_from_idx].data,0,0):this.disposal_restore_from_idx=e-1),2===n&&t.clearRect(this.last_frame.dims.left,this.last_frame.dims.top,this.last_frame.dims.width,this.last_frame.dims.height)}renderImage(e=!0){if(!this.frames.length)return;let t=this.frame_idx;t=parseInt(t.toString(),10),(t>this.frames.length-1||t<0)&&(t=0),this.manageDisposal(t);const n=this.frames[t],s=this.patchCanvas.getContext("2d"),i=this.offscreenCanvas.getContext("2d"),r=n.dims;this.frameImageData&&r.width==this.frameImageData.width&&r.height==this.frameImageData.height||(this.patchCanvas.width=r.width,this.patchCanvas.height=r.height,this.frameImageData=s.createImageData(r.width,r.height)),this.frameImageData.data.set(n.patch),s.putImageData(this.frameImageData,0,0),i.drawImage(this.patchCanvas,r.left,r.top);const o=i.getImageData(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height);this.ctx.putImageData(o,0,0),this.ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height),e&&this.hovering&&this.drawPauseIcon(),this.last_frame=n}play(){this.playing=!0,requestAnimationFrame((e=>this.onAnimationFrame(e,0,0)))}pause(){this.playing=!1,requestAnimationFrame((()=>this.drawPlayIcon()))}drawPauseIcon(){if(!this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height;this.ctx.lineWidth=.04*this.canvas.height,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2-e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2+e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2+e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,1.5*e,0,2*Math.PI),this.ctx.stroke()}drawPlayIcon(){if(this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height,t=new Path2D;t.moveTo(this.canvas.width/2+e,this.canvas.height/2),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2-e),t.closePath(),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.fill(t);const n=1.5*e;this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,n,0,2*Math.PI),this.ctx.stroke()}getCanvasScale(){let e;return e=this.options.max_width&&this.hdr&&this.lsd.width>this.options.max_width?this.options.max_width/this.lsd.width:1,e}fetchGIF(e){const t=re(),n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n?.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=()=>{if(200!=n.status)return this.showError(),t.reject();t.resolve(n.response)},n.onprogress=e=>e.lengthComputable&&this.doShowProgress(e.loaded,e.total,!0),n.onerror=e=>{Y.error(e),this.showError()},n.send(),t}}var DC=n(8609),zC={};zC.styleTagTransform=L(),zC.setAttributes=I(),zC.insert=N().bind(null,"head"),zC.domAPI=T(),zC.insertStyleElement=D();C()(DC.A,zC);DC.A&&DC.A.locals&&DC.A.locals;ad.elements.define("converse-gif",class extends O_{static get properties(){return{autoplay:{type:Boolean},noloop:{type:Boolean},progress_color:{type:String},fallback:{type:String},src:{type:String}}}constructor(){super(),this.src=null,this.autoplay=!1,this.noloop=!1,this.fallback="url",this.progress_color=null}initGIF(){const e={autoplay:this.autoplay,loop:!this.noloop};this.progress_color&&(e.progress_color=this.progress_color),this.supergif=new RC(this,e)}updated(e){this.supergif&&!e.has("src")?(e.has("autoplay")&&(this.supergif.options.autoplay=this.autoplay),e.has("noloop")&&(this.supergif.options.loop=!this.noloop),e.has("progress_color")&&(this.supergif.options.progress_color=this.progress_color)):this.initGIF()}render(){return this.supergif?.load_error&&["url","empty"].includes(this.fallback)?this.renderErrorFallback():wh`<canvas class="gif-canvas" @mouseover="${()=>this.setHover()}" @mouseleave="${()=>this.unsetHover()}" @click="${e=>this.onControlsClicked(e)}"><img class="gif" src="${this.src}"></canvas>`}renderErrorFallback(){return"url"===this.fallback?Ew(this.src):"empty"===this.fallback?"":void 0}setHover(){this.supergif&&(this.supergif.hovering=!0,this.hover_timeout&&clearTimeout(this.hover_timeout),this.hover_timeout=setTimeout((()=>this.unsetHover()),2e3))}unsetHover(){this.supergif&&(this.supergif.hovering=!1)}onControlsClicked(e){e.preventDefault(),this.supergif.playing?this.supergif.pause():this.supergif.frames.length>0&&(this.supergif.options.loop=!0,this.supergif.play())}});const LC=(e,t)=>wh`<converse-gif autoplay noloop fallback="empty" src="${e}"></converse-gif>${t?"":wh`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,{isURLWithImageExtension:PC}=Rf;const UC=P_(class extends V_{render(e,t,n,s){return t?wh`<a href="${t}" class="chat-image__link" target="_blank" rel="noopener">${this.renderImage(e,t,n,s)}</a>`:this.renderImage(e,t,n,s)}renderImage(e,t,n,s){return wh`<img class="chat-image img-thumbnail" loading="lazy" src="${e}" @click="${s}" @error="${()=>this.onError(e,t,n,s)}" @load="${n}">`}onError(e,t,n,s){if(PC(e))t&&this.setValue(Ew(t));else try{const i=new URL(e),r=i.pathname.split("/").pop();if(r){const e=`${r}.png`;i.pathname=i.pathname.replace(r,e),this.setValue(UC(i.toString(),t,n,s))}}catch(t){console.error("Invalid URL:",e)}}}),BC=e=>wh`${UC(e.src||e.url,e.href,e.onLoad,e.onClick)}`,qC=(e,t)=>{const{hostname:n}=Rf.getURL(e);return wh`<figure><video controls preload="metadata" src="${e}"></video>${t||!n?"":wh`<a target="_blank" rel="noopener" title="${e}" href="${e}">${n}</a>`}</figure>`},FC=["*","_","~","`"],HC=[...FC,"```",">"],GC={"*":{name:"strong",type:"span"},_:{name:"emphasis",type:"span"},"~":{name:"strike",type:"span"},"`":{name:"preformatted",type:"span"},"```":{name:"preformatted_block",type:"block"},">":{name:"quote",type:"block"}},WC=["_",">","`","~"];function VC(e){return"string"==typeof e}function KC(e,t,n=!0){let s;if(/(^```[\s,\u200B]*\n)|(^```[\s,\u200B]*$)/.test(e.slice(t))&&(0===t||">"===e[t-1]||/\n\u200B{0,2}$/.test(e.slice(0,t))))s=e.slice(t,t+3);else{if(!HC.includes(e.slice(t,t+1)))return null;if(s=e.slice(t,t+1),!function(e,t,n,s){if(s){const s=RegExp(WC.includes(e)?`^(\\p{L}|\\p{N})${e}`:`^(\\p{L}|\\p{N})\\${e}`,"u");if(n>1&&s.test(t.slice(n-1)))return!1;if(YC(e)&&n>0&&"\n"!==t[n-1])return!1;if(FC.includes(e)&&t[n+1]===e)return!1}else{const s=RegExp(WC.includes(e)?`^${e}(\\p{L}|\\p{N})`:`^\\${e}(\\p{L}|\\p{N})`,"u");if(n<t.length-1&&s.test(t.slice(n)))return!1;if(FC.includes(e)&&t[n-1]===e)return!1}return!0}(s,e,t,n))return null}return s}function JC(e,t){const n=KC(e,t),s=n?function(e,t,n){if(!e)return 0;const s=n;if(n+=e.length,YC(e))return(n+=t.slice(n).split(/\n\u200B*[^>\u200B]/).shift().length)-s;if("span"===GC[e].type){const s=t.slice(n).split("\n").shift();let i=0,r=s.indexOf(e);for(;-1!==r;){if(KC(t,n+r,!1)===e)return r+2*e.length;r=s.indexOf(e,i++)}return 0}{const s=t.slice(n+1);let i=0,r=s.indexOf(e);for(;-1!==r;){if(KC(t,n+1+r,!1)===e)return r+1+2*e.length;r=s.indexOf(e,i++)}return 0}}(n,e,t):0;return s>0?{d:n,length:s}:{}}function YC(e){return[">","&gt;"].includes(e)}const{addMediaURLsOffset:XC,convertASCII2Emoji:QC,getCodePointReferences:ZC,getMediaURLsMetadata:ek,getShortnameReferences:tk}=Rf;class nk extends String{constructor(e,t=0,n={}){super(e),this.embed_audio=n?.embed_audio,this.embed_videos=n?.embed_videos,this.mentions=n?.mentions||[],this.media_urls=n?.media_urls,this.nick=n?.nick,this.offset=t,this.onImgClick=n?.onImgClick,this.onImgLoad=n?.onImgLoad,this.options=n,this.payload=[],this.references=[],this.render_styling=n?.render_styling,this.show_images=n?.show_images,this.hide_media_urls=n?.hide_media_urls}shouldRenderMedia(e,t){let n;return"image"===t?n=this.show_images:"audio"===t?n=this.embed_audio:"video"===t&&(n=this.embed_videos),"boolean"==typeof n?n:b$(e,t)}async addHyperlinkTemplate(e){const{url:t}=e,n=y$(t);let s;if(e.is_gif&&this.shouldRenderMedia(t,"image"))s=LC(n,this.hide_media_urls);else if(e.is_image&&this.shouldRenderMedia(t,"image"))s=BC({src:n,href:this.hide_media_urls?null:n,onClick:this.onImgClick,onLoad:this.onImgLoad});else if(e.is_video&&this.shouldRenderMedia(t,"video"))s=qC(n,this.hide_media_urls);else if(e.is_audio&&this.shouldRenderMedia(t,"audio"))s=MC(n,this.hide_media_urls);else if(ad.settings.get("embed_3rd_party_media_players")&&function(e){try{const{hostname:t,pathname:n}=Rf.getURL(e);return"open.spotify.com"===t&&n.startsWith("/track/")}catch(t){return console.debug(`Could not create URL object from ${e}`),!1}}(t)){s=((e,t,n)=>{const{hostname:s}=Rf.getURL(t);return wh`<figure><iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${e}" width="100%" height="352" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>${n?"":wh`<a target="_blank" rel="noopener" title="${t}" href="${t}">${s}</a>`}</figure>`})(t.split("/track/")[1],t,this.hide_media_urls)}return s||Ew(n)}async addHyperlinks(e,t){const n=t+this.offset,s=this.media_urls||(await ek(e,t)).media_urls||[],i=XC(s,e,n);await Promise.all(i.filter((e=>!e.is_encrypted)).map((async e=>{const n=await this.addHyperlinkTemplate(e);this.addTemplateResult(e.start+t,e.end+t,n)})))}addMapURLs(e,t){const n=/geo:([\-0-9.]+),([\-0-9.]+)(?:,([\-0-9.]+))?(?:\?(.*))?/g,s=e.matchAll(n);for(const e of s)this.addTemplateResult(e.index+t,e.index+e[0].length+t,Ew(e[0].replace(n,ad.settings.get("geouri_replacement"))))}addEmojis(e,t){[...tk(e.toString()),...ZC(e.toString())].forEach((e=>{this.addTemplateResult(e.begin+t,e.end+t,AC(e,{add_title_wrapper:!0}))}))}addMentions(e,t){const n=t+this.offset;this.mentions?.forEach((s=>{const i=Number(s.begin)-n;if(i<0||i>=n+e.length)return;const r=Number(s.end)-n,o=e.slice(i,r);o===this.nick?this.addTemplateResult(i+t,r+t,(e=>wh`<span class="mention mention--self badge badge-info" data-uri="${e.uri}">${e.mention}</span>`)({...s,mention:o})):this.addTemplateResult(i+t,r+t,function(e){return wh`<span class="mention" data-uri="${e.uri}">${e.mention}</span>`}({...s,mention:o}))}))}addStyling(){if(!function(e){for(let t=0;t<HC.length;t++)if(e.includes(HC[t]))return!0;return!1}(this))return;const e=[],t=this.mentions.map((e=>Array.from({length:Number(e.end)},((t,n)=>Number(e.begin)+n))));let n=0;for(;n<this.length;){if(t.filter((e=>e.includes(n))).length){n++;continue}const{d:s,length:i}=JC(this,n);if(s&&i){const t=YC(s),r=n+i,o=t?r:r-s.length;let a="```"===s?n+s.length+1:n+s.length;t&&" "===this[a]&&(a+=1);const c=a,l=this.slice(a,o);e.push({begin:n,template:ok(s,l,c,this.options),end:r}),n=r}n++}e.forEach((e=>this.addTemplateResult(e.begin,e.end,e.template)))}trimMeMessage(){0===this.offset&&this.isMeCommand()&&(this.payload[0]=this.payload[0].substring(4))}async addAnnotations(e){const t=this.marshall();let n=0;for(const s of t)s&&(VC(s)?(await e.call(this,s,n),n+=s.length):n=s.end)}async addTemplates(){await ad.trigger("beforeMessageBodyTransformed",this,{synchronous:!0}),this.render_styling&&this.addStyling(),await this.addAnnotations(this.addMentions),await this.addAnnotations(this.addHyperlinks),await this.addAnnotations(this.addMapURLs),await ad.emojis.initialize(),await this.addAnnotations(this.addEmojis),await ad.trigger("afterMessageBodyTransformed",this,{synchronous:!0}),this.payload=this.marshall(),this.options.show_me_message&&this.trimMeMessage(),this.payload=this.payload.map((e=>VC(e)?e:e.template))}addTemplateResult(e,t,n){this.references.push({begin:e,end:t,template:n})}isMeCommand(){const e=this.toString();return!!e&&e.startsWith("/me ")}marshall(){let e=[this.toString()];return this.references.sort(((e,t)=>t.begin-e.begin)).forEach((t=>{const n=e.shift();e=[n.slice(0,t.begin),t,n.slice(t.end),...e]})),e.reduce(((e,t)=>{return VC(t)?[...e,QC((n=t,n.replace(/\n(\u200B*\n)+/g,(e=>e.length>2?`\n${"â".repeat(e.length-2)}\n`:2===e.length?"\nâ":1===e.length?"â":void 0))))]:[...e,t];var n}),[])}}class sk extends U_{static async transform(e){try{await e.addTemplates()}catch(e){console.error(e)}return e.payload}render(e,t,n){const s=new nk(e,t,Object.assign(n,{show_images:!1,embed_videos:!1,embed_audio:!1}));return wh`${Q_(sk.transform(s),wh`${s}`)}`}}const ik=P_(sk),rk={emphasis:(e,t,n)=>wh`<span class="styling-directive">_</span><i>${ik(e,t,n)}</i><span class="styling-directive">_</span>`,preformatted:e=>wh`<span class="styling-directive">\`</span><code>${e}</code><span class="styling-directive">\`</span>`,preformatted_block:e=>wh`<div class="styling-directive">\`\`\`</div><pre><code class="block">${e}</code></pre><div class="styling-directive">\`\`\`</div>`,quote:(e,t,n)=>wh`<blockquote>${ik(e,t,n)}</blockquote>`,strike:(e,t,n)=>wh`<span class="styling-directive">~</span><del>${ik(e,t,n)}</del><span class="styling-directive">~</span>`,strong:(e,t,n)=>wh`<span class="styling-directive">*</span><b>${ik(e,t,n)}</b><span class="styling-directive">*</span>`};function ok(e,t,n,s){const i=rk[GC[e].name];if(YC(e)){const e=t.replace(/\n\u200B*>[ \f\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]?/g,(e=>`\n${"â".repeat(e.length-1)}`)).replace(/\n$/,"");return i(e,n,s)}return i(t,n,s)}class ak{constructor(e,t,n={}){this.offset=t,this.options=n,this.text=e}async transform(){const e=new nk(this.text,this.offset,this.options);try{await e.addTemplates()}catch(e){console.error(e)}return e.payload}render(){return wh`${Q_(this.transform(),wh`${this.text}`)}`}}const ck=P_(class extends U_{render(e,t,n,s){const i=new ak(e,t,n).render();return s?.(),i}}),lk=ck;var dk=n(3796),uk={};uk.styleTagTransform=L(),uk.setAttributes=I(),uk.insert=N().bind(null,"head"),uk.domAPI=T(),uk.insertStyleElement=D();C()(dk.A,uk);dk.A&&dk.A.locals&&dk.A.locals;ad.elements.define("converse-chat-message-body",class extends O_{static get properties(){return{hide_url_previews:{type:String},is_me_message:{type:Boolean},model:{type:Object},text:{type:String}}}constructor(){super(),this.text=null,this.model=null,this.hide_url_previews=null}initialize(){const e=ad.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}onImgClick(e){e.preventDefault(),ad.modal.show("converse-image-modal",{src:e.target.src},e)}onImgLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}render(){const e={media_urls:this.model.get("media_urls"),mentions:this.model.get("references"),nick:this.model.chatbox.get("nick"),onImgClick:e=>this.onImgClick(e),onImgLoad:()=>this.onImgLoad(),render_styling:!this.model.get("is_unstyled")&&ad.settings.get("allow_message_styling"),show_me_message:!0};return"false"===this.hide_url_previews?(e.embed_audio=!0,e.embed_videos=!0,e.show_images=!0):"true"===this.hide_url_previews&&(e.embed_audio=!1,e.embed_videos=!1,e.show_images=!1),lk(this.text,0,e,(()=>this.model.collection?.trigger("rendered",this.model)))}});ad.elements.define("converse-message-versions-modal",class extends aE{renderModal(){return wh`<converse-message-versions .model="${this.model}"></converse-message-versions>`}getModalTitle(){return C_("Message versions")}});const{Strophe:hk}=Lf.env,{STATUS_WEIGHTS:fk}=__;async function mk(e,t=!1){if(!ad.settings.get("allow_contact_removal"))return;if(!await ad.confirm(C_("Confirm"),C_("Are you sure you want to remove this contact?")))return!1;const n=await ad.chats.get(e.get("jid"));n?.close();try{await e.remove(t)}catch(t){Y.error(t),ad.alert("error",C_("Error"),[C_("Sorry, an error occurred while trying to remove %1$s as a contact",e.getDisplayName())])}return!0}async function gk(e){const t=uo.session.get("domain"),n=await ad.disco.supports(hk.NS.BLOCKING,t),s=await ad.confirm(C_("Remove and decline contact request"),[C_("Are you sure you want to decline the contact request from %1$s?",e.getDisplayName())],n?[{label:C_("Also block this user from sending you further messages"),name:"block",type:"checkbox"}]:[]);if(s){const t=await ad.chats.get(e.get("jid"));t?.close(),e.unauthorize(),n&&Array.isArray(s)&&"on"===s.find((e=>"block"===e.name))?.value?(ad.blocklist.add(e.get("jid")),ad.toast.show("declined-and-blocked",{type:"success",body:C_("Contact request declined and user blocked")})):ad.toast.show("request-declined",{type:"success",body:C_("Contact request declined")}),e.destroy()}return this}async function pk(e){const t=uo.session.get("domain");if(!await ad.disco.supports(hk.NS.BLOCKING,t))return!1;const n=C_("Do you want to block this contact, so they cannot send you messages?");if(!await ad.confirm(n))return!1;(await ad.chats.get(e.get("jid")))?.close();try{await Promise.all([ad.blocklist.add(e.get("jid")),e.remove(!0)])}catch(t){Y.error(t),ad.alert("error",C_("Error"),[C_("Sorry, an error occurred while trying to block %1$s",e.getDisplayName())])}}function vk(e){uo.state.roster?.get(e)?.trigger("highlight")}function bk(e,t){const n=uo.state.roster_filter,s=n.get("type"),i="state"===s?n.get("state").toLowerCase():n.get("text").toLowerCase();if(!i)return!1;if("state"===s){return![uo.labels.HEADER_REQUESTING_CONTACTS,uo.labels.HEADER_UNREAD].includes(t)&&("unread_messages"===i?0===e.get("num_unread"):"online"===i?["offline","unavailable","dnd","away","xa"].includes(e.getStatus()):!e.getStatus().includes(i))}return"items"===s?!function(e){const t=e instanceof Fy?e.getNickname():e.get("nickname"),n=e.get("jid");let s=e.getDisplayName({context:"roster"});return s=s.includes(n)?s:s.concat(`   ${n}`),s=s.includes(t)?s:s.concat(`   ${t}`),s.toLowerCase()}(e).includes(i):void 0}function yk(e,t){const n=e.getStatus(),s=t.getStatus();if(fk[n]===fk[s]){const n=e.getDisplayName().toLowerCase(),s=t.getDisplayName().toLowerCase();return n<s?-1:n>s?1:0}return fk[n]<fk[s]?-1:1}function _k(e,t){const n={},{HEADER_CURRENT_CONTACTS:s,HEADER_REQUESTING_CONTACTS:i,HEADER_UNGROUPED:r,HEADER_UNREAD:o,HEADER_UNSAVED_CONTACTS:a}=uo.labels;n[o]=0,n[a]=1,n[i]=2,n[s]=3,n[r]=4;const c=n,l=Object.keys(n),d=l.includes(e),u=l.includes(t);if(!d&&!u)return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0;if(d&&u)return c[e]<c[t]?-1:c[e]>c[t]?1:0;if(!d&&u){const e=s;return c[e]<c[t]?-1:c[e]>c[t]?1:0}if(d&&!u){const t=s;return c[e]<c[t]?-1:c[e]>c[t]?1:0}}function wk(){const e=uo.state.roster.reduce(((e,t)=>e.concat(t.get("groups"))),[]);return[...new Set(e.filter((e=>e)))]}async function Sk(e){const t={mode:"cors",headers:{Accept:"text/json"}},n=`${ad.settings.get("xhr_user_search_url")}q=${encodeURIComponent(e)}`;let s;try{s=await fetch(n,t)}catch(t){return Y.error(`Failed to fetch names for query "${e}"`),Y.error(t),[]}const i=await s.json();return Array.isArray(i)?i.map((e=>({label:`${e.fullname} <${e.jid}>`,value:`${e.fullname} <${e.jid}>`}))):(Y.error('Invalid JSON returned"'),[])}const{Strophe:Ak}=Lf.env;function xk(e){const t=C_("Add to blocklist");return wh`<button type="button" @click="${t=>e.blockContact(t)}" class="btn btn-danger"><converse-icon class="fas fa-times" color="var(--background-color)" size="1em"></converse-icon>Â ${t}</button>`}function $k(e){const t=e.model?.vcard,n=t?t.toJSON():{},s={...e.model.toJSON(),...n},i=e.getContact(),r=i&&!i.isUnsaved(),o=ad.settings.get("allow_contact_removal"),a=uo.session.get("domain"),c=ad.disco.supports(Ak.NS.BLOCKING,a).then((async t=>{const n=await ad.blocklist.get();t&&(n.get(e.model.get("jid"))?function(e){const t=C_("Remove from blocklist");wh`<button type="button" @click="${t=>e.unblockContact(t)}" class="btn btn-danger"><converse-icon class="fas fa-times" color="var(--background-color)" size="1em"></converse-icon>Â ${t}</button>`}(e):xk(e))})),l=C_("XMPP Address"),d=C_("Email"),u=C_("Full Name"),h=C_("Nickname"),f=C_("Role"),m=C_("URL"),g=C_("Groups"),p=C_("Use commas to separate multiple values"),v=C_("OMEMO"),b=C_("Profile"),y=C_("Edit"),_=[wh`<li role="presentation" class="nav-item"><a class="nav-link ${"profile"===e.tab?"active":""}" id="profile-tab" href="#profile-tabpanel" aria-controls="profile-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="profile" data-toggle="tab">${b}</a></li>`];r&&_.push(wh`<li role="presentation" class="nav-item"><a class="nav-link ${"edit"===e.tab?"active":""}" id="edit-tab" href="#edit-tabpanel" aria-controls="edit-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="edit" data-toggle="tab">${y}</a></li>`),uo.pluggable.plugins["converse-omemo"]?.enabled(uo)&&_.push(wh`<li role="presentation" class="nav-item"><a class="nav-link ${"omemo"===e.tab?"active":""}" id="omemo-tab" href="#omemo-tabpanel" aria-controls="omemo-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="omemo" data-toggle="tab">${v}</a></li>`);const w=i?.get("nickname")||i.vcard?.get("fullname"),S=i?.get("groups");return wh`<ul class="nav nav-pills justify-content-center">${_}</ul><div class="tab-content"><div class="tab-pane ${"profile"===e.tab?"active":""}" id="profile-tabpanel" role="tabpanel" aria-labelledby="profile-tab"><div class="mb-4 centered"><converse-avatar .model="${e.model}" name="${e.model.getDisplayName()}" height="140" width="140"></converse-avatar></div>${s.fullname?wh`<div class="row mb-2"><div class="col-sm-4"><label>${u}:</label></div><div class="col-sm-8">${s.fullname}</div></div>`:""}<div class="row mb-2"><div class="col-sm-4"><label>${l}:</label></div><div class="col-sm-8"><a href="xmpp:${s.jid}">${s.jid}</a></div></div>${s.nickname?wh`<div class="row mb-2"><div class="col-sm-4"><label>${h}:</label></div><div class="col-sm-8">${s.nickname}</div></div>`:""} ${s.url?wh`<div class="row mb-2"><div class="col-sm-4"><label>${m}:</label></div><div class="col-sm-8"><a target="_blank" rel="noopener" href="${s.url}">${s.url}</a></div></div>`:""} ${s.email?wh`<div class="row mb-2"><div class="col-sm-4"><label>${d}:</label></div><div class="col-sm-8"><a href="mailto:${s.email}">${s.email}</a></div></div>`:""} ${s.role?wh`<div class="row mb-2"><div class="col-sm-4"><label>${f}:</label></div><div class="col-sm-8">${s.role}</div></div>`:""} ${S.length?wh`<div class="row mb-2"><div class="col-sm-4"><label>${g}:</label></div><div class="col-sm-8">${S.map((e=>wh`<span class="badge badge-roster-group me-1">${e}</span>`))}</div></div>`:""}<hr>${i.get("requesting")?wh`<div class="row mb-2"><div class="col-sm-4"><label>${C_("Contact Request")}:</label></div><div class="col-sm-8">${function(e){const t=C_("Accept");return wh`<button type="button" @click="${t=>e.acceptContactRequest(t)}" class="btn btn-success accept-contact-request"><converse-icon class="fas fa-user-plus" color="var(--background-color)" size="1em"></converse-icon>Â ${t}</button>`}(e)} ${function(e){const t=C_("Decline");return wh`<button type="button" @click="${t=>e.declineContactRequest(t)}" class="btn btn-danger decline-contact-request"><converse-icon class="fas fa-user-plus" color="var(--background-color)" size="1em"></converse-icon>Â ${t}</button>`}(e)}</div></div>`:""} ${r?"":function(e){const t=C_("Add as contact");return wh`<button type="button" @click="${t=>e.addContact(t)}" class="btn btn-success add-contact"><converse-icon class="fas fa-user-plus" color="var(--background-color)" size="1em"></converse-icon>Â ${t}</button>`}(e)} ${i?"":Q_(c.then((()=>xk(e))),"")}</div>${r?wh`<div class="tab-pane ${"edit"===e.tab?"active":""}" id="edit-tabpanel" role="tabpanel" aria-labelledby="edit-tab">${"edit"===e.tab?wh`<form class="converse-form" @submit="${t=>e.updateContact(t)}"><div class="mb-3"><label class="form-label clearfix" for="name">${C_("Name")}:</label> <input type="text" name="name" value="${w}" class="form-control"></div><div class="mb-3"><label class="form-label clearfix" for="name">${g}:</label><div class="mb-1"><small class="form-text text-muted">${p}</small></div><converse-autocomplete .list="${wk()}" name="groups" value="${S}"></converse-autocomplete></div><button type="submit" class="btn btn-primary">${C_("Update")}</button></form><hr>${o&&r?function(e){const t=C_("Remove as contact");return wh`<button type="button" @click="${t=>e.removeContact(t)}" class="btn btn-danger remove-contact"><converse-icon class="fas fa-trash-alt" color="var(--background-color)" size="1em"></converse-icon>Â ${t}</button>`}(e):""} ${Q_(c.then((()=>xk(e))),"")}`:""}</div>`:""} ${uo.pluggable.plugins["converse-omemo"]?.enabled(uo)?wh`<div class="tab-pane ${"omemo"===e.tab?"active":""}" id="omemo-tabpanel" role="tabpanel" aria-labelledby="omemo-tab">${"omemo"===e.tab?wh`<converse-omemo-fingerprints jid="${s.jid}"></converse-omemo-fingerprints>`:""}</div>`:""}</div>`}var Ek=n(8850),jk={};jk.styleTagTransform=L(),jk.setAttributes=I(),jk.insert=N().bind(null,"head"),jk.domAPI=T(),jk.insertStyleElement=D();C()(Ek.A,jk);Ek.A&&Ek.A.locals&&Ek.A.locals;ad.elements.define("converse-user-details-modal",class extends aE{constructor(e){super(e),this.tab="profile"}initialize(){super.initialize(),this.addListeners(),ad.trigger("userDetailsModalInitialized",this.model)}addListeners(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.model instanceof uo.exports.ChatBox?(this.model.rosterContactAdded.then((()=>this.registerContactEventHandlers(this.model.contact))),void 0!==this.model.contact&&this.registerContactEventHandlers(this.model.contact)):this.registerContactEventHandlers(this.model)}getContact(){return this.model instanceof uo.exports.ChatBox?this.model.contact:this.model}shouldUpdate(e){return e.has("model")&&this.model&&(this.stopListening(),this.addListeners(),this.tab="profile",this.requestUpdate()),!0}renderModal(){return $k(this)}getModalTitle(){return this.model.getDisplayName()}registerContactEventHandlers(e){this.listenTo(e,"change",(()=>this.requestUpdate())),this.listenTo(e,"destroy",(()=>this.close())),this.listenTo(e.vcard,"change",(()=>this.requestUpdate())),e.vcard&&ad.vcard.update(e.vcard,!0)}async addContact(e){e?.preventDefault?.(),this.modal.hide(),ad.modal.show("converse-add-contact-modal",{contact:this.model,model:new ie.Model},e)}async updateContact(e){e?.preventDefault?.();const t=e.target,n=new FormData(t),s=(n.get("name")||"").trim(),i=n.get("groups")?.split(",").map((e=>e.trim()))||[];this.getContact().update({nickname:s,groups:i}),this.modal.hide()}async removeContact(e){e?.preventDefault?.(),setTimeout((()=>mk(this.getContact())),1),this.modal.hide()}async blockContact(e){e?.preventDefault?.(),setTimeout((()=>pk(this.getContact())),1),this.modal.hide()}async unblockContact(e){e?.preventDefault?.(),setTimeout((()=>async function(e){const t=uo.session.get("domain");if(!await ad.disco.supports(hk.NS.BLOCKING,t))return!1;const n=C_("Do you want to unblock this contact, so they can send you messages?");if(!await ad.confirm(n))return!1;try{await ad.blocklist.remove(e.get("jid"))}catch(t){Y.error(t),ad.alert("error",C_("Error"),[C_("Sorry, an error occurred while trying to unblock %1$s",e.getDisplayName())])}}(this.getContact())),1),this.modal.hide()}async acceptContactRequest(e){e?.preventDefault?.(),setTimeout((()=>{ad.modal.show("converse-accept-contact-request-modal",{model:new ie.Model,contact:this.getContact()},e)})),this.modal.hide()}async declineContactRequest(e){e?.preventDefault?.(),setTimeout((()=>gk(this.getContact()))),this.modal.hide()}});const{filesize:Ck}=Lf.env,{dayjs:kk}=Lf.env,{dayjs:Tk}=Lf.env,{isGIFURL:Ok}=Rf;ad.elements.define("converse-image",class extends O_{static get properties(){return{src:{type:String},onImgLoad:{type:Function},href:{type:String}}}constructor(){super(),this.src=null,this.href=null,this.onImgClick=null,this.onImgLoad=null}render(){return Ok(this.src)&&b$(this.src,"image")?LC(y$(this.src),!0):BC({src:y$(this.src),href:this.href,onClick:this.onImgClick,onLoad:this.onImgLoad})}});const Nk=e=>{const t=e.description||"",n=e.image||"",s=e.title||"",i=e.url||"",r=function(e){return e&&p$(e,"allowed_image_domains")&&Rf.isValidURL(e)}(n),o=s||t||i;return r||o?wh`<div class="card card--unfurl">${r?function(e){const t=e.image||"",n=e.url||"";return wh`<converse-image class="card-img-top hor_centered" href="${n}" src="${t}" .onImgLoad="${()=>e.onImageLoad()}"></converse-image>`}(e):""} ${o?wh`<div class="card-body">${s?function(e,t){const n=e.image||"",s=e.url||"",i=e.title||"";return s&&Rf.isValidURL(s)&&!Rf.isGIFURL(n)?wh`<a href="${s}" target="_blank" rel="noopener">${t(i)}</a>`:t(i??"")}(e,(e=>wh`<h5 class="card-title">${e}</h5>`)):""} ${t?wh`<p class="card-text"><converse-texture text="${t}"></converse-texture></p>`:""} ${i&&Rf.isValidURL(i)?wh`<p class="card-text"><a href="${i}" target="_blank" rel="noopener">${new URL(i).hostname}</a></p>`:""}</div>`:""}</div>`:""};var Mk=n(1070),Ik={};Ik.styleTagTransform=L(),Ik.setAttributes=I(),Ik.insert=N().bind(null,"head"),Ik.domAPI=T(),Ik.insertStyleElement=D();C()(Mk.A,Ik);Mk.A&&Mk.A.locals&&Mk.A.locals;ad.elements.define("converse-message-unfurl",class extends O_{static get properties(){return{description:{type:String},image:{type:String},jid:{type:String},title:{type:String},url:{type:String},site_name:{type:String}}}constructor(){super(),this.jid=null,this.url=null,this.title=null,this.image=null,this.description=null,this.site_name=null}initialize(){const e=ad.settings.get();this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}render(){return Nk(this)}onImageLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}});const{dayjs:Rk}=Lf.env,Dk=e=>{const t=C_("New messages"),n=e.model.get("edited"),s=e.model_with_messages.get("first_unread_id")===e.model.get("id"),i=e.model.isFollowup(),r=e.model.isMeCommand(),o=e.model.isRetracted(),a=e.model.get("msgid"),c=e.model.get("sender"),l=e.model.get("time"),d=e.model.occupant||e.model.contact,u=l$(d),h=ad.settings.get("time_format"),f=Rk(n||l).format(h),m=function(e){if("groupchat"===e.get("type")){const t=ad.settings.get("muc_hats").filter((e=>e)).map((e=>e.toLowerCase()));let n=[];t.includes("vcard_roles")&&(n=e.vcard?e.vcard.get("role"):null,n=n?n.split(",").filter((e=>e)).map((e=>({title:e}))):[]);const s=[...e.occupant?[e.occupant.get("role")]:[],...e.occupant?[e.occupant.get("affiliation")]:[]].filter((e=>e)).filter((e=>t.includes(e.toLowerCase()))).map((e=>({title:e})));return[...t.includes("xep317")&&e.occupant?.get("hats")||[],...n,...s]}return[]}(e.model),g=e.model.getDisplayName(),p=r||o,v=!p&&!i,b=e.shouldShowAvatar()&&v,y=d?.vcard?d:e.model;return wh`${s?wh`<div class="message separator"><hr class="separator"><span class="separator-text">${t}</span></div>`:""}<div class="message chat-msg ${e.getExtraMessageClasses()}" data-isodate="${l}" data-msgid="${a}" data-from="${e.model.get("from")}" data-encrypted="${e.model.get("is_encrypted")}"><a id="${a}"></a> ${b?wh`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${y}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${y.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content chat-msg__content--${c} ${p?"chat-msg__content--action":""}">${v?wh`<span class="chat-msg__heading"><span class="chat-msg__author"><a class="show-msg-author-modal" @click="${e.showUserModal}" style="${u}">${g}</a> </span>${m.map((e=>wh`<span class="badge badge-secondary">${e.title}</span>`))} <time timestamp="${n||l}" class="chat-msg__time">${f}</time> ${e.model.get("is_encrypted")?wh`<converse-icon class="fa fa-lock" size="1.1em"></converse-icon>`:""}</span>`:""}<div class="chat-msg__body chat-msg__body--${e.model.get("message_type")} ${e.model.get("received")?"chat-msg__body--received":""} ${e.model.get("is_delayed")?"chat-msg__body--delayed":""}"><div class="chat-msg__message">${p?wh`<time timestamp="${n||l}" class="chat-msg__time">${f}</time> ${r?wh`<span class="chat-msg__author" style="${u}">${r?"**":""}${g}</span>Â `:""}`:""} ${o?e.renderRetraction():e.renderMessageText()}</div><converse-message-actions .model="${e.model}" ?is_retracted="${o}"></converse-message-actions></div>${e.model.get("ogp_metadata")?.map((t=>!0===e.model.get("hide_url_previews")?"":b$(t["og:image"],"image")?wh`<converse-message-unfurl @animationend="${e.onUnfurlAnimationEnd}" class="${e.model.get("url_preview_transition")}" jid="${e.model_with_messages?.get("jid")}" description="${t["og:description"]||""}" title="${t["og:title"]||""}" image="${t["og:image"]||""}" site_name="${t["og:site_name"]||""}" url="${t["og:url"]||""}"></converse-message-unfurl>`:""))}</div></div>`};const zk=e=>{const t=C_("Show more"),n="groupchat"===e.model.get("type"),s=C_("Show less"),i=e.model.get("error_text")||e.model.get("error"),r=`${C_("Message delivery failed.")}\n${i}`,o=wh`<div class="chat-msg__spoiler-hint"><span class="spoiler-hint">${e.model.get("spoiler_hint")}</span> <a class="badge badge-info spoiler-toggle" href="#" @click="${e.toggleSpoilerMessage}"><converse-icon size="1em" color="var(--background-color)" class="fa ${e.model.get("is_spoiler_visible")?"fa-eye-slash":"fa-eye"}"></converse-icon>${e.model.get("is_spoiler_visible")?s:t}</a></div>`,a=e.model.get("is_spoiler")?"spoiler "+(e.model.get("is_spoiler_visible")?"":"hidden"):"",c=e.model.getMessageText(),l=e.model.get("oob_url")&&c!==e.model.get("oob_url"),d=ad.settings.get("render_media");return wh`${e.model.get("is_spoiler")?o:""} ${e.model.get("subject")?wh`<div class="chat-msg__subject">${e.model.get("subject")}</div>`:""} <span class="chat-msg__body--wrapper ${i?"error":""}"><converse-chat-message-body class="chat-msg__text ${e.model.get("is_only_emojis")?"chat-msg__text--larger":""} ${a}" .model="${e.model}" hide_url_previews="${e.model.get("hide_url_previews")}" ?is_me_message="${e.model.isMeCommand()}" text="${c}"></converse-chat-message-body>${!e.model.get("received")||e.model.isMeCommand()||n?"":wh`<converse-icon size="0.75em" color="var(--chat-color)" class="fa fa-check chat-msg__receipt"></converse-icon>`} ${e.model.get("edited")?function(e){const t=C_("This message has been edited");return wh`<converse-icon title="${t}" class="fa fa-edit chat-msg__edit-modal" @click="${e.showMessageVersionsModal}" size="1em"></converse-icon>`}(e):""} </span>${l?wh`<div class="chat-msg__media"><converse-texture text="${e.model.get("oob_url")}" .onImgClick="${t=>e.onImgClick(t)}" ?embed_audio="${d}" ?embed_videos="${d}" ?show_images="${d}"></div>`:""} ${i?wh`<div class="chat-msg__error">${r}</div>`:""}`};var Lk=n(4563),Pk={};Pk.styleTagTransform=L(),Pk.setAttributes=I(),Pk.insert=N().bind(null,"head"),Pk.domAPI=T(),Pk.insertStyleElement=D();C()(Lk.A,Pk);Lk.A&&Lk.A.locals&&Lk.A.locals;const{Strophe:Uk}=Lf.env,{SUCCESS:Bk}=__;ad.elements.define("converse-chat-message",class extends Kx{constructor(){super(),this.model_with_messages=null,this.model=null,this.observable="once"}static get properties(){return{...super.properties,model_with_messages:{type:Object},model:{type:Object}}}async initialize(){super.initialize(),await this.model_with_messages.initialized,await this.model_with_messages.messages.fetched;const e=ad.settings.get();this.listenTo(e,"change:render_media",(()=>{this.model.save("hide_url_previews",void 0),this.requestUpdate()})),this.listenTo(this.model_with_messages,"change:first_unread_id",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"contact:change",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:add",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.model?this.show_spinner?Xx():this.model.get("file")&&this.model.get("upload")!==Bk?this.renderFileProgress():["mep"].includes(this.model.get("type"))?this.renderMEPMessage():["error","info"].includes(this.model.get("type"))?this.renderInfoMessage():this.renderChatMessage():""}renderRetraction(){return(e=>{const t=e.model.isRetracted()?e.getRetractionText():null;return wh`<span class="retraction"><span>${t}</span> ${e.model.get("moderation_reason")?wh`<q class="chat-msg--retracted__reason">${e.model.get("moderation_reason")}</q>`:""}</span>`})(this)}renderMessageText(){return zk(this)}renderMEPMessage(){return(e=>{const t=Tk(e.model.get("time")).toISOString();return wh`<div class="message chat-info message--mep ${e.getExtraMessageClasses()}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-msg__content"><div class="chat-msg__body chat-msg__body--${e.model.get("type")} ${e.model.get("is_delayed")?"chat-msg__body--delayed":""}"><div class="chat-info__message">${e.model.isRetracted()?e.renderRetraction():wh`<converse-texture .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-texture>${e.model.get("reason")?wh`<q class="reason"><converse-texture text="${e.model.get("reason")}"></converse-texture></q>`:""}`}</div><converse-message-actions ?is_retracted="${e.model.isRetracted()}" .model="${e.model}"></converse-message-actions></div></div></div>`})(this)}renderInfoMessage(){return(e=>{const t=kk(e.model.get("time")).toISOString(),n=C_("Retry");return wh`<div class="message chat-info chat-${e.model.get("type")}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-info__message"><converse-texture .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-texture></div>${e.model.get("reason")?wh`<q class="reason">${e.model.get("reason")}</q>`:""} ${e.model.get("error_text")?wh`<q class="reason">${e.model.get("error_text")}</q>`:""} ${e.model.get("retry_event_id")?wh`<a class="retry" @click="${e.onRetryClicked}">${n}</a>`:""}</div>`})(this)}renderFileProgress(){return this.model.file?(e=>{const t=C_("Uploading file:"),n=e.model.file.name,s=Ck(e.model.file.size),i=e.model.occupant||e.model.contact;return wh`<div class="message chat-msg">${e.shouldShowAvatar()?wh`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${i||e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content"><span class="chat-msg__text">${t} <strong>${n}</strong>, ${s}</span><progress value="${e.model.get("progress")}"></div></div>`})(this):""}renderChatMessage(){return Dk(this)}shouldShowAvatar(){return ad.settings.get("show_message_avatar")&&!this.model.isMeCommand()&&["chat","groupchat","normal"].includes(this.model.get("type"))}onImgClick(e){e.preventDefault(),ad.modal.show("converse-image-modal",{src:e.target.src},e)}onUnfurlAnimationEnd(){"fade-out"===this.model.get("url_preview_transition")&&this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}async onRetryClicked(){this.show_spinner=!0,this.requestUpdate(),await ad.trigger(this.model.get("retry_event_id"),{synchronous:!0}),this.model.destroy(),this.parentElement.removeChild(this)}hasMentions(){return"groupchat"===this.model.get("type")&&"them"===this.model.get("sender")&&this.model_with_messages.isUserMentioned(this.model)}getOccupantAffiliation(){return this.model.occupant?.get("affiliation")}getOccupantRole(){return this.model.occupant?.get("role")}getExtraMessageClasses(){const e=this.model.isMeCommand()||this.model.isRetracted(),t=[this.model.isFollowup()?"chat-msg--followup":null,this.model.get("is_delayed")?"delayed":null,e?"chat-msg--action":null,this.model.isRetracted()?"chat-msg--retracted":null,this.model.get("type"),this.shouldShowAvatar()?"chat-msg--with-avatar":null].map((e=>e));return"groupchat"===this.model.get("type")&&(t.push(this.getOccupantRole()??""),t.push(this.getOccupantAffiliation()??""),"them"===this.model.get("sender")&&this.hasMentions()&&t.push("mentioned")),this.model.get("correcting")&&t.push("correcting"),t.filter((e=>e)).join(" ")}getRetractionText(){if(["groupchat","mep"].includes(this.model.get("type"))&&this.model.get("moderated_by")){const e=this.model.get("moderated_by");if(!this.model.mod){const{occupants:t}=this.model_with_messages;this.model.mod=t.findOccupant({jid:e})||t.findOccupant({nick:Uk.getResourceFromJid(e)})}const t=this.model.mod?this.model.mod.getDisplayName():C_("A moderator");return C_("%1$s has removed a message",t)}return"me"===this.model.get("sender")?C_("You have removed a message"):C_("%1$s has removed a message",this.model.getDisplayName())}showUserModal(e){"me"===this.model.get("sender")?ad.modal.show("converse-profile-modal",{model:uo.state.xmppstatus},e):"groupchat"===this.model.get("type")?(e.preventDefault(),ad.modal.show("converse-muc-occupant-modal",{model:this.model.getOccupant(),message:this.model},e)):(e.preventDefault(),ad.modal.show("converse-user-details-modal",{model:this.model_with_messages},e))}showMessageVersionsModal(e){e.preventDefault(),ad.modal.show("converse-message-versions-modal",{model:this.model},e)}toggleSpoilerMessage(e){e?.preventDefault(),this.model.save({is_spoiler_visible:!this.model.get("is_spoiler_visible")})}});ad.elements.define("converse-message-history",class extends O_{constructor(){super(),this.model=null,this.messages=[]}static get properties(){return{model:{type:Object},messages:{type:Array}}}render(){const e=this.messages;return e.length?nC(e,(e=>e.get("id")),(e=>wh`${this.renderMessage(e)}`)):""}renderMessage(e){if(e.get("dangling_retraction")||e.get("dangling_moderation")||e.get("is_only_key"))return"";const t=e.get("template_hook");if("string"==typeof t){const n=ad.hook(t,e,"");return Q_(n,"")}{const t=wh`<converse-chat-message .model_with_messages="${this.model}" .model="${e}"></converse-chat-message>`,n=wC(e);return n?[n,t]:t}}});var qk=n(6120),Fk={};Fk.styleTagTransform=L(),Fk.setAttributes=I(),Fk.insert=N().bind(null,"head"),Fk.domAPI=T(),Fk.insertStyleElement=D();C()(qk.A,Fk);qk.A&&qk.A.locals&&qk.A.locals;const Hk=100;class Gk extends O_{constructor(){super(),this.model=null,this.scrollTop=0,this.scroll_debounce=null,this.window_top=0,this.window_bottom=0,this.scrollHandler=e=>{this.mark_scrolled_debounce&&clearTimeout(this.scroll_debounce),this.mark_scrolled_debounce=setTimeout((()=>{this.#l(e)}),250),requestAnimationFrame((()=>this.#d()))}}static get properties(){return{model:{type:Object},window_top:{state:!0},window_bottom:{state:!0}}}async initialize(){await this.model.initialized,this.listenTo(this.model.messages,"add",(()=>this.#u())),this.listenTo(this.model.messages,"remove",(()=>this.#u())),this.listenTo(this.model.messages,"reset",(()=>this.#u())),this.listenTo(this.model.messages,"change",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"rendered",(()=>this.requestUpdate())),this.listenTo(this.model,"historyPruned",(()=>this.#d())),this.listenTo(this.model.notifications,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change:scrolled",(()=>this.scrollDown())),this.window_bottom=this.model.messages.length-1,this.window_top=Math.max(0,this.window_bottom-Hk),this.requestUpdate()}render(){return this.model?wh`<div class="chat-content__messages" @scroll="${e=>this.scrollHandler(e)}"><div class="chat-content__notifications">${this.model.getNotificationsText()}</div><converse-message-history .model="${this.model}" .messages="${this.model.messages.slice(this.window_top,this.window_bottom+1)}"></converse-message-history></div>${this.model.ui?.get("chat-content-spinner-top")?Xx():""}`:""}#u(){this.#d(),this.requestUpdate()}#l(e){let t=!0;const n=e.target,s=0===Math.floor(n.scrollTop),i=Math.ceil(n.clientHeight-n.scrollTop)>=n.scrollHeight-Math.ceil(n.scrollHeight/20);s?(t=!1,_C(this.model)):i&&ad.trigger("chatBoxScrolledUp",n),this.model.get("scolled")!==t&&this.model.ui.set({scrolled:t})}#d(){const e=this.model.messages.length,t=this.querySelector(".chat-content__messages"),n=Math.ceil(t.scrollHeight/5);if(Math.ceil(t.clientHeight-t.scrollTop)>=t.scrollHeight-n)return this.window_top=Math.max(0,this.window_top-5),void(this.window_bottom=this.window_top+Hk);if(0===Math.floor(t.scrollTop))return this.window_bottom=e-1,void(this.window_top=Math.max(0,this.window_bottom-Hk));return Math.floor(Math.abs(t.scrollTop))<n?(this.window_bottom=Math.min(e-1,this.window_bottom+5),void(this.window_top=Math.max(0,this.window_bottom-Hk))):void 0}scrollDown(){if(!this.model.ui.get("scrolled")){if(this.scrollTo){const e=this.scrollTop?"smooth":"auto";this.scrollTo({top:0,behavior:e})}else this.scrollTop=0;ad.trigger("chatBoxScrolledDown",{chatbox:this.model})}}}ad.elements.define("converse-chat-content",Gk);class Wk extends U_{constructor(e){if(super(e),this.it=xh,e.type!==L_)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===xh||null==e)return this._t=void 0,this.it=e;if(e===Ah)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}Wk.directiveName="unsafeHTML",Wk.resultType=1;const Vk=P_(Wk);ad.elements.define("converse-chat-help",class extends O_{constructor(){super(),this.messages=[],this.model=null,this.type=null}static get properties(){return{chat_type:{type:String},messages:{type:Array},model:{type:Object},type:{type:String}}}render(){const e=(new Date).toISOString();return[wh`<converse-icon class="fas fa-times close-chat-help" @click="${this.close}" path-prefix="${ad.settings.get("assets_path")}" size="1em"></converse-icon>`,...this.messages.map((t=>this.renderHelpMessage({isodate:e,markup:hu.sanitize(t,{ALLOWED_TAGS:["strong"]})})))]}close(){this.model.set({show_help_messages:!1})}renderHelpMessage(e){return wh`<div class="message chat-${this.type}" data-isodate="${e.isodate}">${Vk(e.markup)}</div>`}});const Kk=Lf.env.utils,Jk=e=>{const t=ad.settings.get("emoji_categories");return wh`<ul>${Object.keys(t).map((n=>t[n]?(e=>wh`<li data-category="${e.category}" class="emoji-category ${e.category} ${e.current_category===e.category?"picked":""}" title="${C_(ad.settings.get("emoji_category_labels")[e.category])}"><a class="btn pick-category" @click="${e.onCategoryPicked}" href="#emoji-picker-${e.category}" data-category="${e.category}">${e.emoji}</a></li>`)(Object.assign({category:n,emoji:e.sn2Emoji(t[n])},e)):""))}</ul>`},Yk=e=>wh`<li class="emoji insert-emoji ${e.shouldBeHidden(e.emoji.sn)?"hidden":""}" data-emoji="${e.emoji.sn}" title="${e.emoji.sn}"><a href="#" @click="${e.insertEmoji}" data-emoji="${e.emoji.sn}">${Kk.shortnamesToEmojis(e.emoji.sn)}</a></li>`;function Xk(e){const t=ad.settings.get("emoji_categories");return wh`<span ?hidden="${e.query}" class="emoji-lists__container emoji-lists__container--browse">${Object.keys(t).map((n=>t[n]?function(e){return wh`<a id="emoji-picker-${e.category}" class="emoji-category__heading" data-category="${e.category}">${C_(ad.settings.get("emoji_category_labels")[e.category])}</a><ul class="emoji-picker" data-category="${e.category}">${Object.values(Lf.emojis.json[e.category]).map((t=>Yk(Object.assign({emoji:t},e))))}</ul>`}(Object.assign({category:n},e)):""))}</span>`}function Qk(e,t){const n=C_("Search"),s={tone1:":raised_hand_tone1:",tone2:":raised_hand_tone2:",tone3:":raised_hand_tone3:",tone4:":raised_hand_tone4:",tone5:":raised_hand_tone5:"};return wh`<div class="emoji-picker__header"><input class="form-control emoji-search" name="emoji-search" placeholder="${n}" .value="${t.query||""}" @keydown="${t.onSearchInputKeyDown}" @blur="${t.onSearchInputBlurred}" @focus="${t.onSearchInputFocus}"> ${t.query?"":Jk(t)}</div>${t.render_emojis?wh`<converse-emoji-picker-content .model="${e.state}" .search_results="${t.search_results}" current_skintone="${t.current_skintone}" query="${t.query}"></converse-emoji-picker-content>`:""}<div class="emoji-skintone-picker">Skin tone:<ul>${Object.keys(s).map((e=>function(e,t,n){return wh`<li data-skintone="${n}" class="emoji-skintone ${e.current_skintone===t?"picked":""}"><a class="pick-skintone" href="#" data-skintone="${t}" @click="${e.onSkintonePicked}">${Kk.shortnamesToEmojis(n)}</a></li>`}(t,e,s[e])))}</ul></div>`}const{sizzle:Zk}=Lf.env;ad.elements.define("converse-emoji-picker-content",class extends O_{static get properties(){return{search_results:{type:Array},current_skintone:{type:String},model:{type:Object},query:{type:String}}}constructor(){super(),this.model=null,this.current_skintone=null,this.query=null,this.search_results=null}render(){const e={current_skintone:this.current_skintone,insertEmoji:e=>this.insertEmoji(e),query:this.query,search_results:this.search_results,shouldBeHidden:e=>this.shouldBeHidden(e)};return wh`<div class="emoji-picker__lists">${function(e){const t=C_("Search results");return wh`<span ?hidden="${!e.query}" class="emoji-lists__container emojis-lists__container--search"><a id="emoji-picker-search-results" class="emoji-category__heading">${t}</a><ul class="emoji-picker">${e.search_results.map((t=>Yk(Object.assign({emoji:t},e))))}</ul></span>`}(e)} ${Xk(e)}</div>`}firstUpdated(){this.initIntersectionObserver()}initIntersectionObserver(){if(window.IntersectionObserver){if(this.observer)this.observer.disconnect();else{const e={root:this.querySelector(".emoji-picker__lists"),threshold:[.1]},t=e=>this.setCategoryOnVisibilityChange(e);this.observer=new IntersectionObserver(t,e)}Zk(".emoji-picker",this).forEach((e=>this.observer.observe(e)))}}setCategoryOnVisibilityChange(e){const t=this.parentElement.navigator.selected,n=e.filter((e=>e.target.contains(t))).pop();let s;if(s=n||e.reduce(((e,t)=>t.intersectionRatio>=(e?.intersectionRatio||0)?t:e),null),s&&s.isIntersecting){const e=s.target.getAttribute("data-category");e!==this.model.get("current_category")&&(this.parentElement.preserve_scroll=!0,Rf.safeSave(this.model,{current_category:e}))}}insertEmoji(e){e.preventDefault(),e.stopPropagation();const t=e.target,n="IMG"===t.nodeName?t.parentElement:t;this.parentElement.selectEmoji(n.getAttribute("data-emoji"))}shouldBeHidden(e){if(e.includes("_tone")){if(!this.current_skintone||!e.includes(this.current_skintone))return!0}else if(this.current_skintone&&SC().includes(e))return!0;return!(!this.query||ej(e,this.query))}});const{CHATROOMS_TYPE:eT}=__,{initStorage:tT}=Rf;ad.elements.define("converse-emoji-dropdown",class extends Lx{static get properties(){return{icon_classes:{type:String},items:{type:Array},model:{type:Object}}}constructor(){super(),this.id=Rf.getUniqueId(),this.render_emojis=!1,this.state=null,this.model=null,this.addEventListener("shown.bs.dropdown",(()=>this.onShown()))}initModel(){return this.init_promise||(this.init_promise=(async()=>{await ad.emojis.initialize();const e=`converse.emoji-${uo.session.get("bare_jid")}-${this.model.get("jid")}`;this.state=new Gm({id:e}),tT(this.state,e),await new Promise((e=>this.state.fetch({success:e,error:e}))),this.state.set({autocompleting:null,ac_position:null})})()),this.init_promise}render(){const e=this.model.get("type")===eT?"--muc-color":"--chat-color";return wh`<button class="btn dropdown-toggle dropdown-toggle--no-caret toggle-emojis" type="button" id="${this.id}" title="${C_("Insert emojis")}" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><converse-icon color="var(${e})" class="fa fa-smile" path-prefix="${ad.settings.get("assets_path")}" size="1em"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}"><li>${Q_(this.initModel().then((()=>wh`<converse-emoji-picker .state="${this.state}" .model="${this.model}" @emojiSelected="${()=>this.dropdown.hide()}" ?render_emojis="${this.render_emojis}" current_category="${this.state.get("current_category")||""}" current_skintone="${this.state.get("current_skintone")||""}" query="${this.state.get("query")||""}"></converse-emoji-picker>`)),"")}</li></ul>`}connectedCallback(){super.connectedCallback(),this.render_emojis=!1}async onShown(){await this.initModel(),this.render_emojis||(this.render_emojis=!0,this.requestUpdate(),await this.updateComplete),setTimeout((()=>this.querySelector(".emoji-search")?.focus()))}});var nT=n(9440),sT={};sT.styleTagTransform=L(),sT.setAttributes=I(),sT.insert=N().bind(null,"head"),sT.domAPI=T(),sT.insertStyleElement=D();C()(nT.A,sT);nT.A&&nT.A.locals&&nT.A.locals;const{KEYCODES:iT}=__;ad.elements.define("converse-emoji-picker",class extends O_{static get properties(){return{current_category:{type:String,reflect:!0},current_skintone:{type:String,reflect:!0},model:{type:Object},query:{type:String,reflect:!0},state:{type:Object},render_emojis:{type:Boolean}}}constructor(){super(),this.state=null,this.model=null,this.query="",this.render_emojis=null,this._search_results=[],this.debouncedFilter=$o((e=>this.state.set({query:e.value})),250)}initialize(){super.initialize(),this.dropdown=this.closest("converse-emoji-dropdown")}firstUpdated(e){super.firstUpdated(e),this.listenTo(this.state,"change",(e=>this.onModelChanged(e.changed))),this.initArrowNavigation()}get search_results(){return this._search_results}set search_results(e){this._search_results=e,this.requestUpdate()}render(){return Qk(this,{current_category:this.current_category,current_skintone:this.current_skintone,onCategoryPicked:e=>this.chooseCategory(e),onSearchInputFocus:()=>this.disableArrowNavigation(),onSearchInputKeyDown:e=>this.onSearchInputKeyDown(e),onSkintonePicked:e=>this.chooseSkinTone(e),query:this.query,search_results:this.search_results,render_emojis:this.render_emojis,sn2Emoji:e=>Rf.shortnamesToEmojis(this.getTonedShortname(e))})}updated(e){e.has("query")&&this.updateSearchResults(e),e.has("current_category")&&this.setScrollPosition()}onModelChanged(e){"current_category"in e&&(this.current_category=e.current_category),"current_skintone"in e&&(this.current_skintone=e.current_skintone),"query"in e&&(this.query=e.query)}setScrollPosition(){if(this.preserve_scroll)return void(this.preserve_scroll=!1);const e=this.querySelector(".emoji-lists__container--browse"),t=this.querySelector(`#emoji-picker-${this.current_category}`);t instanceof HTMLElement&&(e.scrollTop=t.offsetTop-3*t.offsetHeight+4)}updateSearchResults(e){const t=e.get("query"),n=ej;if(this.query){if(this.query===t)return this.search_results;t&&this.query.includes(t)?this.search_results=this.search_results.filter((e=>n(e.sn,this.query))):this.search_results=Lf.emojis.list.filter((e=>n(e.sn,this.query)))}else this.search_results.length&&(this.search_results=[])}registerEvents(){this.onKeyDown=e=>this.#a(e),this.dropdown.addEventListener("hide.bs.dropdown",(()=>this.onDropdownHide())),this.addEventListener("keydown",this.onKeyDown)}connectedCallback(){super.connectedCallback(),this.registerEvents()}disconnectedCallback(){this.removeEventListener("keydown",this.onKeyDown),this.disableArrowNavigation(),super.disconnectedCallback()}#a(e){this.navigator&&Rf.isVisible(this)&&(e.key===iT.ENTER?this.onEnterPressed(e):e.key!==iT.DOWN_ARROW||this.navigator.enabled||this.enableArrowNavigation(e))}onDropdownHide(){this.disableArrowNavigation(),this.dispatchEvent(new CustomEvent("emojipickerblur",{bubbles:!0}))}setCategoryForElement(e){const t=this.current_category,n=e?.getAttribute("data-category")||t;t!==n&&this.state.save({current_category:n})}selectEmoji(e){const t=this.state.get("autocompleting"),n=this.state.get("ac_position");this.state.set({autocompleting:null,query:"",ac_position:null}),this.disableArrowNavigation();const s={bubbles:!0,detail:{value:e,autocompleting:t,ac_position:n,jid:this.model.get("jid")}};this.dispatchEvent(new CustomEvent("emojiSelected",s))}chooseSkinTone(e){e.preventDefault(),e.stopPropagation();const t=e.target,n=("IMG"===t.nodeName?t.parentElement:t).getAttribute("data-skintone").trim();this.current_skintone===n?this.state.save({current_skintone:""}):this.state.save({current_skintone:n})}chooseCategory(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();const t=e.target??e.relatedTarget,n=t.matches("li")?t:Rf.ancestor(t,"li");this.setCategoryForElement(n),this.navigator.select(n),!this.navigator.enabled&&this.navigator.enable()}onSearchInputKeyDown(e){const t=e.target;if(e.key===iT.TAB)if(t.value){e.preventDefault();const n=Lf.emojis.shortnames.find((e=>ej(e,t.value)));n&&this.state.set({query:n})}else this.navigator.enabled||this.enableArrowNavigation(e);else e.key!==iT.DOWN_ARROW||this.navigator.enabled?e.key!==iT.ENTER&&e.key!==iT.DOWN_ARROW&&this.debouncedFilter(t):this.enableArrowNavigation(e)}onEnterPressed(e){e.preventDefault(),e.stopPropagation();const t=e.target;Lf.emojis.shortnames.includes(t.value)?this.selectEmoji(t.value):1===this.search_results.length?this.selectEmoji(this.search_results[0].sn):this.navigator.selected&&this.navigator.selected.matches(".insert-emoji")?this.selectEmoji(this.navigator.selected.getAttribute("data-emoji")):this.navigator.selected&&this.navigator.selected.matches(".emoji-category")&&this.chooseCategory(new MouseEvent("click",{relatedTarget:this.navigator.selected}))}getTonedShortname(e){return SC().includes(e)&&this.current_skintone?`${e.slice(0,e.length-1)}_${this.current_skintone}:`:e}initArrowNavigation(){if(!this.navigator){const e="li:not(.hidden):not(.emoji-skintone), .emoji-search",t={jump_to_picked:".emoji-category",jump_to_picked_selector:".emoji-category.picked",jump_to_picked_direction:Lw.DIRECTION.down,picked_selector:".picked",scroll_container:this.querySelector(".emoji-picker__lists"),getSelector:t=>{if(t===Lw.DIRECTION.down){const t=this.navigator.selected&&this.navigator.selected.getAttribute("data-category");return t?`ul[data-category="${t}"] li:not(.hidden):not(.emoji-skintone), .emoji-search`:e}return e},onSelected:e=>{e.matches(".insert-emoji")&&this.setCategoryForElement(e.parentElement),e.matches(".insert-emoji, .emoji-category")&&e.firstElementChild.focus(),e.matches(".emoji-search")&&e.focus()}};this.navigator=new Lw(this,t)}}disableArrowNavigation(){this.navigator?.disable()}enableArrowNavigation(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.handleKeydown(e)}});ad.elements.define("converse-message-limit-indicator",class extends O_{static get properties(){return{model:{type:Object},_draft_length:{state:!0}}}constructor(){super(),this.model=null,this._draft_length=0}connectedCallback(){super.connectedCallback(),this._draft_length=this.model.get("draft")?.length??0,this.listenTo(this.model,"change:draft",(()=>{this._draft_length=this.model.get("draft")?.length??0})),this.listenTo(this.model,"event:keyup",(({ev:e})=>{const t=e.target;this._draft_length=t.value.length}))}render(){const e=ad.settings.get("message_limit");return e?(e=>{const t=C_("Message characters remaining");return wh`<span class="message-limit ${e<1?"error":""}" title="${t}">${e}</span>`})(e-this._draft_length):""}});const rT=e=>{const t=ad.settings.get("message_limit");return wh`<span class="btn-group toolbar-buttons">${Q_(e.getButtons(),"")}</span> <span>${t?wh`<converse-message-limit-indicator .model="${e.model}">`:""} ${e.show_send_button?function(){const e=C_("Send the message");return wh`<button type="submit" class="btn send-button" data-action="sendMessage" title="${e}"><converse-icon color="var(--background-color)" class="fa fa-paper-plane" size="1em"></converse-icon></button>`}():""}</span>`};var oT=n(5501),aT={};aT.styleTagTransform=L(),aT.setAttributes=I(),aT.insert=N().bind(null,"head"),aT.domAPI=T(),aT.insertStyleElement=D();C()(oT.A,aT);oT.A&&oT.A.locals&&oT.A.locals;const cT=Lf.env.Strophe;ad.elements.define("converse-chat-toolbar",class extends O_{static get properties(){return{hidden_occupants:{type:Boolean},is_groupchat:{type:Boolean},message_limit:{type:Number},model:{type:Object},show_call_button:{type:Boolean},show_emoji_button:{type:Boolean},show_send_button:{type:Boolean},show_spoiler_button:{type:Boolean}}}constructor(){super(),this.model=null,this.is_groupchat=null,this.hidden_occupants=!1,this.show_send_button=!1,this.show_spoiler_button=!1,this.show_call_button=!1,this.show_emoji_button=!1}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate()))}render(){return rT(this)}firstUpdated(){ad.trigger("renderToolbar",this)}getButtons(){const e=[];if(this.show_emoji_button&&e.push(wh`<converse-emoji-dropdown .model="${this.model}"></converse-emoji-dropdown>`),this.show_call_button){const t=this.is_groupchat?"--muc-color":"--chat-color",n=C_("Start a call");e.push(wh`<button type="button" class="btn toggle-call" @click="${this.toggleCall}" title="${n}"><converse-icon color="var(${t})" class="fa fa-phone" size="1em"></converse-icon></button>`)}this.show_spoiler_button&&e.push(this.getSpoilerButton());const t=uo.session.get("domain"),n=ad.disco.supports(cT.NS.HTTPUPLOAD,t);return e.push(wh`${Q_(n.then((e=>this.getHTTPUploadButton(!!e))),"")}`),uo.api.hook("getToolbarButtons",this,e)}getHTTPUploadButton(e){if(e){const e=C_("Choose a file to send");return wh`<button type="button" class="btn" title="${e}" @click="${this.toggleFileUpload}"><converse-icon class="fa fa-paperclip" size="1em"></converse-icon></button> <input type="file" @change="${this.onFileSelection}" class="fileupload" multiple="" style="display:none">`}return""}getSpoilerButton(){const e=this.model;if(!this.is_groupchat&&!e.presence?.resources.length)return;let t;t=e.get("composing_spoiler")?C_("Click to write as a normal (non-spoiler) message"):C_("Click to write your message as a spoiler");const n=this.is_groupchat?"--muc-color":"--chat-color",s=wh`<button type="button" class="btn toggle-compose-spoiler" title="${t}" @click="${this.toggleComposeSpoilerMessage}"><converse-icon color="var(${n})" class="fa ${e.get("composing_spoiler")?"fa-eye-slash":"fa-eye"}" size="1em"></converse-icon></button>`;if(this.is_groupchat)return s;{const t=e.get("jid"),n=Promise.all(e.presence.resources.map((e=>ad.disco.supports(cT.NS.SPOILER,`${t}/${e.get("name")}`)))).then((e=>e.reduce(((e,t)=>e&&t),!0)));return wh`${Q_(n.then((()=>s)),"")}`}}toggleFileUpload(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.querySelector(".fileupload").click()}onFileSelection(e){this.model.sendFiles(e.target.files)}toggleComposeSpoilerMessage(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.set("composing_spoiler",!this.model.get("composing_spoiler"))}toggleCall(e){e?.preventDefault?.(),e?.stopPropagation?.(),ad.trigger("callButtonClicked",{connection:ad.connection.get(),model:this.model})}});const{HEADLINES_TYPE:lT}=__;var dT=n(2995),uT={};uT.styleTagTransform=L(),uT.setAttributes=I(),uT.insert=N().bind(null,"head"),uT.domAPI=T(),uT.insertStyleElement=D();C()(dT.A,uT);dT.A&&dT.A.locals&&dT.A.locals;const{Strophe:hT}=Lf.env;ad.elements.define("converse-chat-heading",class extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const{chatboxes:e}=uo.state;this.model=e.get(this.jid),this.listenTo(this.model,"change:status",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.model.contact&&this.listenTo(this.model.contact,"destroy",(()=>this.requestUpdate())),this.model.rosterContactAdded?.then((()=>{this.listenTo(this.model.contact,"change:nickname",(()=>this.requestUpdate())),this.requestUpdate()})),this.requestUpdate()}render(){return(e=>{const{jid:t,status:n,type:s}=e.model.attributes,i=e.getHeadingButtons(),r=t=>e.showUserDetailsModal(t),o=C_("The User's Profile Image"),a=e.model.getDisplayName(),c=wh`<span title="${o}"><converse-avatar .model="${e.model.contact||e.model}" class="avatar chat-msg__avatar" name="${a}" nonce="${e.model.contact?.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></span>`;return wh`<div class="chatbox-title ${n?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${uo.api.settings.get("singleton")?"":wh`<converse-controlbox-navback jid="${t}"></converse-controlbox-navback>`} ${s!==lT?wh`<a class="show-msg-author-modal" @click="${r}">${c}</a>`:""}<div class="chatbox-title__text" title="${t}" role="heading" aria-level="2">${s!==lT?wh`<a class="user show-msg-author-modal" @click="${r}">${a}</a>`:a}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${Q_(bC(i),"")} ${Q_(yC(i),"")}</div></div>${n?wh`<p class="chat-head__desc">${n}</p>`:""}`})(this)}showUserDetailsModal(e){e.preventDefault(),this.model?.contact instanceof uo.exports.Profile?ad.modal.show("converse-profile-modal",{model:this.model},e):ad.modal.show("converse-user-details-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}async getHeadingButtons(){const e=[{a_class:"show-user-details-modal",handler:e=>this.showUserDetailsModal(e),i18n_text:C_("Details"),i18n_title:C_("See more information about this person"),icon_class:"fa-id-card",name:"details",standalone:!1}],t=uo.session.get("domain");if(t&&await ad.disco.supports(hT.NS.BLOCKING,t)){(await ad.blocklist.get()).get(this.model.get("jid"))?e.push({a_class:"unblock-user",handler:async e=>{e.preventDefault();await ad.confirm(C_("Unblock user"),[C_("Are you sure you want to unblock this user?")])&&ad.blocklist.remove(this.model.get("jid"))},i18n_text:C_("Unblock this user"),i18n_title:C_("Allow this user to send you messages"),icon_class:"fa-check",name:"unblock",standalone:!1}):e.push({a_class:"block-user",handler:async e=>{e.preventDefault();if(await ad.confirm(C_("Block user"),[C_("Are you sure you want to prevent %1$s from contacting you further?",this.model.getDisplayName())])){const e=this.model.get("jid");ad.blocklist.add(e),ad.contacts.remove(e,!0),this.model.close()}},i18n_text:C_("Block this user"),i18n_title:C_("Prevent this user from sending you any further messages"),icon_class:"fa-trash",name:"block",standalone:!1})}ad.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:C_("Close"),i18n_title:C_("Close and end this conversation"),icon_class:"fa-times",name:"close",standalone:"overlayed"===ad.settings.get("view_mode")});const{chatboxviews:n}=uo.state,s=n.get(this.getAttribute("jid"));return s?uo.api.hook("getHeadingButtons",s,e):e}});async function fT(e){await ad.confirm(C_("Confirm"),C_("Are you sure you want to clear the messages from this conversation?"))&&await e.clearMessages()}function mT(e){if(!window.CSS?.supports("field-sizing","content"))if(e.target.value){const t=e.target.scrollHeight+"px";e.target.style.height!=t&&(e.target.style.height="auto",e.target.style.height=t)}else e.target.style=""}const{ACTIVE:gT,COMPOSING:pT}=__;class vT extends O_{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}async initialize(){await this.model.initialized,this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate())),this.listenTo(this.model,"change:draft",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>{if(this.model.get("hidden")){const e=this.querySelector(".spoiler-hint")?.value,t=this.querySelector(".chat-textarea")?.value;Rf.safeSave(this.model,{draft:t,draft_hint:e})}})),this.handleEmojiSelection=({detail:e})=>{this.model.get("jid")===e.jid&&this.insertIntoTextArea(e.value,e.autocompleting,e.ac_position)},document.addEventListener("emojiSelected",this.handleEmojiSelection),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("emojiSelected",this.handleEmojiSelection)}render(){return(e=>{const t=e.model.get("composing_spoiler"),n=C_(t?"Hidden message":"Message"),s=C_("Optional hint"),i=ad.settings.get("message_limit"),r=ad.settings.get("visible_toolbar_buttons").call,o=ad.settings.get("visible_toolbar_buttons").emoji,a=ad.settings.get("show_send_button"),c=ad.settings.get("visible_toolbar_buttons").spoiler,l=ad.settings.get("show_toolbar");return wh`<form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?wh`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?composing_spoiler="${t}" ?show_call_button="${r}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" enterkeyhint="send" placeholder="${s||""}" .value="${e.model.get("draft_hint")??""}" @change="${t=>Rf.safeSave(e.model,{draft_hint:t.target.value})}" class="${t?"":"hidden"} spoiler-hint"> <textarea autofocus type="text" enterkeyhint="send" .value="${e.model.get("draft")??""}" @drop="${t=>e.onDrop(t)}" @input="${mT}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>Rf.safeSave(e.model,{draft:t.target.value})}" class="chat-textarea ${e.model.get("correcting")?"correcting":""} ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${n}"></textarea></form>`})(this)}insertIntoTextArea(e,t=!1,n,s=" "){const i=this.querySelector(".chat-textarea");if(t)i.value=n&&"string"==typeof t?i.value.replace(new RegExp(t,"g"),((i,r)=>r==n-t.length?e+s:i)):e;else{let t=i.value;t&&t[t.length-1]!==s&&(t+=s),i.value=t+e+s}const r=new Event("change",{bubbles:!1,cancelable:!0});i.dispatchEvent(r),Rf.placeCaretAtEnd(i)}onEscapePressed(e){const t=this.model.messages.findLastIndex("correcting"),n=t>=0?this.model.messages.at(t):null;n&&(e.preventDefault(),n.save("correcting",!1))}onPaste(e){if(0!==e.clipboardData.files.length)return e.stopPropagation(),e.preventDefault(),void this.model.sendFiles(Array.from(e.clipboardData.files));const t=this.querySelector(".chat-textarea");if(!t)return void Y.error("onPaste: could not find textarea to paste in to!");e.preventDefault(),e.stopPropagation();const n=t.value??"",s=e.clipboardData.getData("text/plain"),i=t.selectionStart,r=n.substring(0,i),o=n.substring(t.selectionEnd),a=r.endsWith(" ")||0===r.length?"":" ",c=o.startsWith(" ")||0===o.length?"":" ";this.model.save({draft:`${r}${a}${s}${c}${o}`});const l=r.length+a.length+s.length+c.length;setTimeout((()=>t.setSelectionRange(l,l)),0)}onDrop(e){0!=e.dataTransfer.files.length&&(e.preventDefault(),this.model.sendFiles(e.dataTransfer.files))}onKeyUp(e){this.model.trigger("event:keyup",{ev:e})}onKeyDown(e){const{keycodes:t}=Lf;if(!(e.ctrlKey||e.shiftKey&&e.key===t.ENTER||[t.SHIFT,t.META,t.ESCAPE,t.ALT].includes(e.key))){if(!e.shiftKey&&!e.altKey&&!e.metaKey){const t=e.target;if(e.key===Lf.keycodes.TAB){const n=Rf.getCurrentWord(t,null,/(:.*?:)/g);n.startsWith(":")&&(e.preventDefault(),e.stopPropagation(),this.model.trigger("emoji-picker-autocomplete",{target:t,value:n}))}else{if(e.key===Lf.keycodes.FORWARD_SLASH)return;if(e.key===Lf.keycodes.ESCAPE)return this.onEscapePressed(e);if(e.key===Lf.keycodes.ENTER)return this.onFormSubmitted(e);if(e.key!==Lf.keycodes.UP_ARROW||t.selectionEnd){if(e.key===Lf.keycodes.DOWN_ARROW&&t.selectionEnd===t.value.length&&this.model.get("correcting"))return this.model.editLaterMessage()}else{if(!this.querySelector(".chat-textarea").value||this.model.get("correcting"))return this.model.editEarlierMessage()}}}this.model.get("chat_state")!==pT&&this.model.setChatState(pT)}}async onFormSubmitted(e){e?.preventDefault?.();const{chatboxviews:t}=uo.state,n=this.querySelector(".chat-textarea"),s=n.value.trim();if(ad.settings.get("message_limit")&&s.length>ad.settings.get("message_limit")||!s.replace(/\s/g,"").length)return;if(!ad.connection.get().authenticated){const e=C_("Sorry, the connection has been lost, and your message could not be sent");return ad.alert("error",C_("Error"),e),void ad.connection.reconnect()}let i,r={};this.model.get("composing_spoiler")&&(r=this.querySelector("form.chat-message-form input.spoiler-hint"),i=r.value),Rf.addClass("disabled",n),n.setAttribute("disabled","disabled"),this.querySelector("converse-emoji-dropdown")?.dropdown.hide();const o=await async function(e,t){const n=t.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(n){let s=!1;if(s=await ad.hook("parseMessageForCommands",{model:e,text:t},s),s)return!0;if("clear"===n[1])return fT(e),!0;if("close"===n[1]){const{chatboxviews:t}=uo.state;return t.get(e.get("jid"))?.close(),!0}if("help"===n[1])return e.set({show_help_messages:!1},{silent:!0}),e.set({show_help_messages:!0}),!0}return!1}(this.model,s),a=o?null:await this.model.sendMessage({body:s,spoiler_hint:i});if((o||a)&&(r.value="",n.value="",n.style.height="auto",this.model.save({draft:""})),"overlayed"===ad.settings.get("view_mode")){t.get(this.model.get("jid")).querySelector(".chat-content__messages").parentElement.style.display="none"}if(n.removeAttribute("disabled"),Rf.removeClass("disabled",n),"overlayed"===ad.settings.get("view_mode")){t.get(this.model.get("jid")).querySelector(".chat-content__messages").parentElement.style.display=""}this.model.setChatState(gT,{silent:!0}),n.focus()}}ad.elements.define("converse-message-form",vT);var bT=n(1089),yT={};yT.styleTagTransform=L(),yT.setAttributes=I(),yT.insert=N().bind(null,"head"),yT.domAPI=T(),yT.insertStyleElement=D();C()(bT.A,yT);bT.A&&bT.A.locals&&bT.A.locals;class _T extends O_{constructor(){super(),this.model=null}static get properties(){return{model:{type:Object}}}async connectedCallback(){super.connectedCallback(),await this.initialize(),this.requestUpdate()}async initialize(){await this.model.initialized,this.listenTo(this.model,"change:num_unread",(()=>this.requestUpdate())),this.listenTo(this.model,"emoji-picker-autocomplete",this.autocompleteInPicker),this.addEventListener("emojipickerblur",(()=>this.querySelector(".chat-textarea").focus()))}render(){return this.model?(e=>{const t=C_("You have unread messages");return wh`${e.model.ui.get("scrolled")&&e.model.get("num_unread")?wh`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">â¼ ${t} â¼</div>`:""}<converse-message-form .model="${e.model}"></converse-message-form>`})({model:this.model,viewUnreadMessages:e=>this.viewUnreadMessages(e)}):""}viewUnreadMessages(e){e?.preventDefault?.(),this.model.ui.set({scrolled:!1})}onDragOver(e){e.preventDefault()}clearMessages(e){e?.preventDefault?.(),fT(this.model)}async autocompleteInPicker(e){const{target:t,value:n}=e;await ad.emojis.initialize();const s=this.querySelector("converse-emoji-picker");if(s){s.state.set({ac_position:t.selectionStart,autocompleting:n,query:n});const e=this.querySelector("converse-emoji-dropdown");e?.dropdown.show()}}}ad.elements.define("converse-chat-bottom-panel",_T);const{CHATROOMS_TYPE:wT,INACTIVE:ST}=__;class AT extends O_{static get properties(){return{jid:{type:String}}}constructor(){super(),this.jid=null,this.model=null}disconnectedCallback(){super.disconnectedCallback(),uo.state.chatboxviews.remove(this.jid,this)}updated(){this.model&&this.jid!==this.model.get("jid")&&(this.stopListening(),uo.state.chatboxviews.remove(this.model.get("jid"),this),delete this.model,this.requestUpdate(),this.initialize())}close(e){return e?.preventDefault?.(),this.model.close(e)}maybeFocus(){ad.settings.get("auto_focus")&&this.focus()}focus(){const e=this.getElementsByClassName("chat-textarea")[0];return e&&document.activeElement!==e&&e.focus(),this}getBottomPanel(){return this.model.get("type")===wT?this.querySelector("converse-muc-bottom-panel"):this.querySelector("converse-chat-bottom-panel")}getMessageForm(){return this.model.get("type")===wT?this.querySelector("converse-muc-message-form"):this.querySelector("converse-message-form")}scrollDown(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.ui.get("scrolled")&&this.model.ui.set({scrolled:!1}),_C(this.model)}onWindowStateChanged(){document.hidden?this.model.setChatState(ST,{silent:!0}):this.model.isHidden()||this.model.clearUnreadMsgCounter()}}const{CHATROOMS_TYPE:xT}=__,{ACTIVE:$T}=__;class ET extends AT{length=200;async initialize(){const{chatboxviews:e,chatboxes:t}=uo.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>!this.model.get("hidden")&&this.afterShown())),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),await this.model.messages.fetched,!this.model.get("hidden")&&this.afterShown(),ad.trigger("chatBoxViewInitialized",this)}render(){return(e=>wh`<div class="flyout box-flyout">${"overlayed"===ad.settings.get("view_mode")?wh`<converse-dragresize></converse-dragresize>`:""} ${e.model?wh`<converse-chat-heading jid="${e.jid}" class="chat-head chat-head-chatbox row g-0"></converse-chat-heading><div class="chat-body"><div class="chat-content ${e.show_send_button?"chat-content-sendbutton":""}" aria-live="polite"><converse-chat-content .model="${e.model}"></converse-chat-content>${e.show_help_messages?wh`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${e.help_messages}" ?hidden="${!e.show_help_messages}" type="info" chat_type="${xT}"></converse-chat-help></div>`:""}</div><converse-chat-bottom-panel .model="${e.model}" class="bottom-panel"></converse-chat-bottom-panel></div>`:""}</div>`)(Object.assign({model:this.model,help_messages:this.getHelpMessages(),show_help_messages:this.model.get("show_help_messages")},this.model.toJSON()))}getHelpMessages(){return[`<strong>/clear</strong>: ${C_("Remove messages")}`,`<strong>/close</strong>: ${C_("Close this chat")}`,`<strong>/me</strong>: ${C_("Write in the third person")}`,`<strong>/help</strong>: ${C_("Show this menu")}`]}afterShown(){this.model.setChatState($T),this.model.clearUnreadMsgCounter(),this.maybeFocus()}}ad.elements.define("converse-chat",ET);var jT=n(2852),CT={};CT.styleTagTransform=L(),CT.setAttributes=I(),CT.insert=N().bind(null,"head"),CT.domAPI=T(),CT.insertStyleElement=D();C()(jT.A,CT);jT.A&&jT.A.locals&&jT.A.locals;const{Strophe:kT}=Lf.env;Lf.plugins.add("converse-chatview",{dependencies:["converse-chatboxviews","converse-chat","converse-disco","converse-modal"],initialize(){ad.settings.extend({fetch_url_headers:!1,allowed_audio_domains:null,allowed_image_domains:null,allowed_video_domains:null,auto_focus:!0,debounced_content_rendering:!0,filter_url_query_params:null,image_urls_regex:null,message_limit:0,muc_hats:["xep317"],render_media:!0,show_message_avatar:!0,show_retraction_warning:!0,show_send_button:!0,show_toolbar:!0,time_format:"HH:mm",use_system_emojis:!0,visible_toolbar_buttons:{call:!1,clear:!0,emoji:!0,spoiler:!1}});const e={ChatBoxView:ET,ChatView:ET};Object.assign(uo,e),Object.assign(uo.exports,e),ad.listen.on("connected",(()=>ad.disco.own.features.add(kT.NS.SPOILER))),ad.listen.on("chatBoxClosed",(e=>{return t=e.get("jid"),void(location.hash===`converse/chat?jid=${t}`&&history.pushState(null,"",window.location.pathname));var t}))}});const{Strophe:TT,u:OT}=Lf.env;function NT(){const e=uo.state.chatboxes.add(new uo.exports.ControlBox({id:"controlbox"}));return uo.state.chatboxviews.get("controlbox")?.setModel(),e}function MT(e){e?.preventDefault?.();const t=uo.state.chatboxes.get("controlbox")||NT();OT.safeSave(t,{closed:!1})}function IT(){const e=uo.state.chatboxes?.get("controlbox");e&&OT.safeSave(e,{connected:!1})}function RT(){const{chatboxviews:e}=uo.state,t=e?.get("controlbox");t&&(OT.safeSave(t.model,{connected:!1}),t?.controlbox_pane&&(t.controlbox_pane.remove(),delete t.controlbox_pane))}async function DT(e){e?.preventDefault();await ad.confirm(C_("Confirm"),C_("Are you sure you want to log out?"))&&ad.user.logout()}function zT(){(uo.state.chatboxes.get("controlbox")||NT()).save({connected:!0})}const{Strophe:LT}=Lf.env,PT=Object.fromEntries([[LT.Status.ERROR,"danger"],[LT.Status.CONNECTING,"info"],[LT.Status.CONNFAIL,"danger"],[LT.Status.AUTHENTICATING,"info"],[LT.Status.AUTHFAIL,"danger"],[LT.Status.CONNECTED,"info"],[LT.Status.DISCONNECTED,"danger"],[LT.Status.DISCONNECTING,"warning"],[LT.Status.ATTACHED,"info"],[LT.Status.REDIRECT,"info"],[LT.Status.RECONNECTING,"warning"]]);ad.elements.define("converse-footer",class extends O_{render(){const e="fullscreen"===ad.settings.get("view_mode"),t=ad.settings.get("theme"),n=["dracula","cyberpunk"].includes(t),s=C_("A big thank you to our sponsors ð");return wh`${e?wh`<footer class="footer mt-auto py-3 pb-3"><div class="container"><div class="row"><div class="col-12 text-center"><p class="brand-subtitle mb-2 subdued">Version: ${uo.VERSION_NAME}</p><p class="brand-subtitle mb-4"><a target="_blank" rel="nofollow" href="https://github.com/conversejs/converse.js">Open Source</a> XMPP chat client brought to you by <a target="_blank" rel="nofollow" href="https://opkode.com/about">Opkode</a>.</p><div class="sponsors text-center"><p class="byline mb-1">${s}</p><div class="fs-6 d-flex flex-wrap justify-content-center align-items-center gap-4 mb-2"><div><a href="https://bairesdev.com/sponsoring-open-source-projects/?utm_source=conversejs" target="_blank" rel="noopener"><img style="width:13em" src="https://conversejs.org/media/logos/bairesdev-primary.png" alt="BairesDev"></a></div><div><a href="https://blokt.com?utm_source=conversejs" target="_blank" rel="noopener"><img style="width:12em" src="${n?"https://conversejs.org/media/logos/blokt-invert.png":"https://conversejs.org/media/logos/blokt.png"}" alt="Blokt Crypto & Privacy"></a></div><div><a href="https://www.keycdn.com?utm_source=conversejs" target="_blank" rel="noopener"><img style="height:3em" src="https://conversejs.org/logo/keycdn.png" alt="KeyCDN"></a></div></div></div><p class="brand-subtitle mb-3">If you'd like to sponsor this project, please visit: <a href="https://github.com/sponsors/jcbrand" target="_blank" rel="noopener">Github</a>, <a href="https://www.patreon.com/jcbrand" target="_blank" rel="noopener">Patreon</a>, <a href="https://liberapay.com/jcbrand" target="_blank" rel="noopener">Liberapay</a> or <a href="https://opkode.com/contact.html" target="_blank" rel="noopener">contact us</a>.</p></div></div></div></footer>`:""}`}});const{ANONYMOUS:UT,EXTERNAL:BT,LOGIN:qT,PREBIND:FT,CONNECTION_STATUS:HT}=__;function GT(){const e=C_("Connection URL"),t=C_("HTTP or websocket URL that is used to connect to your XMPP server"),n=C_("e.g. wss://example.org/xmpp-websocket");return wh`<div class="mb-3 fade-in"><label for="converse-conn-url" class="form-label">${e}</label><p class="form-help instructions">${t}</p><input required id="converse-conn-url" class="form-control" type="url" name="connection-url" placeholder="${n}"></div>`}function WT(){const e=ad.settings.get("authentication"),t=C_("Log in"),n=C_("XMPP Address"),s=ad.settings.get("locked_domain"),i=ad.settings.get("default_domain"),r=(s||i)&&C_("Username")||C_("user@domain"),o=ad.settings.get("allow_user_trust_override");return wh`<div class="mb-3"><label for="converse-login-jid" class="form-label">${n}:</label> <input id="converse-login-jid" ?autofocus="${!!ad.settings.get("auto_focus")}" value="${ad.settings.get("jid")??""}" required class="form-control" type="text" name="jid" placeholder="${r}"></div>${e!==BT?function(){const e=C_("Password");return wh`<div class="mb-3"><label for="converse-login-password" class="form-label">${e}</label> <input id="converse-login-password" class="form-control" required="required" value="${ad.settings.get("password")??""}" type="password" name="password" placeholder="${e}"></div>`}():""} ${ad.settings.get("show_connection_url_input")?GT():""} ${o?function(e){const t=C_("To improve performance, we cache your data in this browser. Uncheck this box if this is a public computer or if you want your data to be deleted when you log out. It's important that you explicitly log out, otherwise not all cached data might be deleted. Please note, when using an untrusted device, OMEMO encryption is NOT available."),n=C_("This is a trusted device");return wh`<div class="form-check mb-2 login-trusted"><input id="converse-login-trusted" type="checkbox" class="form-check-input" name="trusted" ?checked="${e}"> <label for="converse-login-trusted" class="form-check-label login-trusted__desc">${n}</label><converse-popover title="${C_("Info")}" text="${t}"></converse-popover></div>`}("off"!==o):""}<div class="text-center mb-3"><button class="btn btn-primary px-5 mx-auto" type="submit">${t}</button></div><converse-register-link></converse-register-link>`}const VT=e=>{const{connfeedback:t}=uo.state,n=t.get("connection_status"),s=PT?.[n]??"none",i=t.get("message");return wh`<form id="converse-login" class="converse-form" method="post" @submit="${e.onLoginFormSubmitted}"><div class="alert ${`alert-${s}`} conn-feedback mb-3 ${i?"":"d-none"}" role="alert"><span class="feedback-message">${i}</span></div>${["CONNECTED","CONNECTING","AUTHENTICATING","RECONNECTING"].includes(HT[n])?wh`<div class="text-center my-3">${Xx()}</div>`:function(){const e=ad.settings.get("authentication"),t=C_("Disconnected"),n=C_("Click here to log in anonymously");return wh`${e==qT||e==BT?WT():""} ${e==UT?wh`<div class="text-center mb-3"><button class="btn btn-primary login-anon px-5 mx-auto" type="submit">${n}</button></div>`:""} ${e==FT?wh`<p class="alert alert-warning">${t}</p>`:""}`}()}</form>`};var KT=n(5832),JT={};JT.styleTagTransform=L(),JT.setAttributes=I(),JT.insert=N().bind(null,"head"),JT.domAPI=T(),JT.insertStyleElement=D();C()(KT.A,JT);KT.A&&KT.A.locals&&KT.A.locals;const{Strophe:YT}=Lf.env,{ANONYMOUS:XT}=__;class QT extends O_{initialize(){const e=ad.settings.get();this.listenTo(e,"change:show_connection_url_input",(()=>this.requestUpdate())),this.listenTo(uo.state.connfeedback,"change",(()=>this.requestUpdate())),this.handler=()=>this.requestUpdate()}connectedCallback(){super.connectedCallback(),ad.settings.listen.on("change",this.handler)}disconnectedCallback(){super.disconnectedCallback(),ad.settings.listen.not("change",this.handler)}render(){return VT(this)}async onLoginFormSubmitted(e){if(e?.preventDefault(),ad.settings.get("authentication")===XT){const e=uo.session.get("jid");return this.connect(e)}const t=e.target;(function(e){const t=e.querySelector("input[name=jid]");return!t.value||ad.settings.get("locked_domain")||ad.settings.get("default_domain")||OT.isValidJID(t.value)?(t.setCustomValidity(""),!0):(t.setCustomValidity(C_("Please enter a valid XMPP address")),!1)})(t)&&(!function(e,t={}){const n=new FormData(e),s=n.get("connection-url");s?.startsWith("ws")?t.websocket_url=s:s?.startsWith("http")&&(t.bosh_service_url=s);let i=n.get("jid");if(ad.settings.get("locked_domain")){const e="@"+ad.settings.get("locked_domain");i.endsWith(e)&&(i=i.substr(0,i.length-e.length)),i=TT.escapeNode(i)+e}else ad.settings.get("default_domain")&&!i.includes("@")&&(i=i+"@"+ad.settings.get("default_domain"));t.jid=i,t.password=n.get("password"),ad.settings.set(t),uo.state.config.save({trusted:!!n.get("trusted")})}(t),ad.settings.get("bosh_service_url")||ad.settings.get("websocket_url")||await this.discoverConnectionMethods(t),ad.settings.get("bosh_service_url")||ad.settings.get("websocket_url")?this.connect():ad.settings.set("show_connection_url_input",!0))}discoverConnectionMethods(e){if(!ad.settings.get("discover_connection_methods"))return;const t=new FormData(e).get("jid");if(t instanceof File)throw new Error('Found file instead of string for "jid" field in form');const n=YT.getDomainFromJid(t);return ad.connection.init(t),ad.connection.get().discoverConnectionMethods(n)}connect(e){["converse/login","converse/register"].includes(location.hash)&&history.pushState(null,"",window.location.pathname),ad.connection.get()?.reset(),ad.user.login(e)}}ad.elements.define("converse-login-form",QT);const ZT=QT,{dayjs:eO}=Lf.env,{CONTROLBOX_TYPE:tO}=__;class nO extends ie.Model{defaults(){return{bookmarked:!1,box_id:"controlbox",chat_state:void 0,closed:!ad.settings.get("show_controlbox_by_default"),num_unread:0,time_opened:eO(0).valueOf(),type:tO,url:""}}validate(e){return e.type===tO?"embedded"===ad.settings.get("view_mode")&&ad.settings.get("singleton")?"Controlbox not relevant in embedded view mode":void 0:uo.state.ChatBox.prototype.validate.call(this,e)}maybeShow(e){return e||"controlbox"!==this.get("id")?uo.state.ChatBox.prototype.maybeShow.call(this,e):this}onReconnection(){this.save("connected",!0)}}const sO=nO;class iO extends O_{async connectedCallback(){super.connectedCallback(),await ad.waitUntil("initialized");const{chatboxes:e}=uo.state;this.model=e.get("controlbox"),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=ad.connection.connected()?C_("Chat Contacts"):C_("Toggle chat");return wh`<button type="button" class="btn toggle-controlbox ${e.model?.get("closed")?"":"hidden"}" @click="${e=>MT(e)}"><span class="toggle-feedback">${t}</span></button>`})(this)}}ad.elements.define("converse-controlbox-toggle",iO);const rO=iO,{Strophe:oO}=Lf.env,{ANONYMOUS:aO}=__;const cO=e=>wh`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e.model.get("connected")?wh`<converse-user-profile></converse-user-profile><div class="controlbox-pane"><converse-headlines-feeds-list class="controlbox-section"></converse-headlines-feeds-list><div id="chatrooms" class="controlbox-section"><converse-rooms-list></converse-rooms-list></div>${ad.settings.get("authentication")===aO?"":wh`<div id="converse-roster" class="controlbox-section"><converse-roster></div>`}</div>`:function(e){const t="fullscreen"===ad.settings.get("view_mode"),n=uo.state.connfeedback.get("connection_status"),s=[oO.Status.RECONNECTING,oO.Status.CONNECTING].includes(n),i=ad.settings.get("view_mode"),r=ad.settings.get("show_background");return wh`${r&&"fullscreen"===i?wh`<converse-bg></converse-bg>`:""}<converse-controlbox-buttons class="controlbox-padded"></converse-controlbox-buttons><div class="controlbox-pane d-flex flex-column justify-content-between">${t?wh`<converse-controlbox-navbar></converse-controlbox-navbar>`:""}<converse-brand-logo></converse-brand-logo>${s?wh`<converse-spinner class="vertically-centered fade-in"></converse-spinner>`:"register"===e.model.get("active-form")?wh`<converse-registration-form class="fade-in rounded"></converse-registration-form>`:wh`<converse-login-form class="fade-in rounded"></converse-login-form>`} ${t?wh`<converse-footer></converse-footer>`:""}</div>`}(e)}</div>`;ad.elements.define("converse-about-modal",class extends aE{getModalTitle(){return C_("About Converse")}renderModal(){return wh`<p>Converse is an open-source <a href="https://xmpp.org" target="_blank" rel="noopener">XMPP</a> chat app written in JavaScript.</p><p>Just like the XMPP protocol, Converse is built with extensibility in mind.</p><p>Because it is open source, integrators and developers can use it to add chat functionality to their websites.</p><p>Converse is also <a href="https://conversejs.org/docs/html/configuration.html" target="_blank" rel="noopener">configurable</a>, built with modern web technologies and <a href="https://conversejs.org/docs/html/plugin_development.html" target="_blank" rel="noopener">extensible with plugins</a>. It has different modes, which means it can be a full page app, an embedded chat widget, or an overlayed chat box. For a list of supported features and XMPP extensions, please see the <a href="https://github.com/conversejs/converse.js?tab=readme-ov-file#features" target="_blank" rel="noopener">README</a>.</p><p>Converse is translated into over 30 languages. You can <a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">translate</a> it into your own language.</p><p>Converse was created by <a target="_blank" rel="nofollow" href="https://opkode.com">JC Brand</a>. You can <a target="_blank" rel="nofollow" href="https://opkode.com/contact.html">hire me</a> for customizations, support or to build your next project.</p><p>If you're interested in sponsoring Converse, please visit: <a href="https://github.com/sponsors/jcbrand" target="_blank" rel="noopener">Github</a>, <a href="https://www.patreon.com/jcbrand" target="_blank" rel="noopener">Patreon</a>, <a href="https://liberapay.com/jcbrand" target="_blank" rel="noopener">Liberapay</a> or <a href="https://opkode.com/contact.html" target="_blank" rel="noopener">contact us</a>.</p>`}});class lO extends O_{render(){return wh`<nav class="navbar navbar-expand-lg"><div class="container-fluid"><div class="collapse navbar-collapse"><ul class="navbar-nav ms-auto mb-2 mb-lg-0"><li class="nav-item"><a class="nav-link" href="#" @click="${this.openAboutDialog}">About</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://github.com/conversejs/converse.js">Github</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://conversejs.org/docs/html">Documentation</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://opkode.com/contact.html">Contact</a></li></ul></div></div></nav>`}openAboutDialog(e){e.preventDefault(),ad.modal.show("converse-about-modal")}}ad.elements.define("converse-controlbox-navbar",lO);const{LOGOUT:dO}=__;class uO extends O_{initialize(){this.setModel();const{chatboxviews:e}=uo.state;e.add("controlbox",this),this.model.get("connected")&&void 0===this.model.get("closed")&&this.model.set("closed",!ad.settings.get("show_controlbox_by_default")),this.requestUpdate(),ad.trigger("controlBoxInitialized",this)}setModel(){this.model=uo.state.chatboxes.get("controlbox"),this.listenTo(uo.state.connfeedback,"change:connection_status",(()=>this.requestUpdate())),this.listenTo(this.model,"change:active-form",(()=>this.requestUpdate())),this.listenTo(this.model,"change:connected",(()=>this.requestUpdate())),this.listenTo(this.model,"change:closed",(()=>{this.requestUpdate(),this.model.get("closed")||this.afterShown()})),this.requestUpdate()}render(){return"overlayed"===ad.settings.get("view_mode")?this.model&&!this.model.get("closed")?cO(this):"":cO(this)}close(e){e?.preventDefault?.();const t=ad.connection.get();if(("closeAllChatBoxes"!==e?.name||t.disconnection_cause===dO&&!ad.settings.get("show_controlbox_by_default"))&&!ad.settings.get("sticky_controlbox")&&"overlayed"===ad.settings.get("view_mode"))return Rf.safeSave(this.model,{closed:!0}),ad.trigger("controlBoxClosed",this),this}afterShown(){return ad.trigger("controlBoxOpened",this),this}}ad.elements.define("converse-controlbox",uO);const hO=uO,{u:fO}=Lf.env,mO={controlbox:{async open(){await ad.waitUntil("chatBoxesFetched");let e=await ad.chatboxes.get("controlbox");return e||(e=await ad.chatboxes.create("controlbox",{},sO)),fO.safeSave(e,{closed:!1}),e},get:()=>uo.state.chatboxviews.get("controlbox")}},gO=e=>wh`<converse-icon size="1em" class="fa fa-arrow-left" @click="${()=>function(e){MT();const t=uo.state.chatboxes.get(e);OT.safeSave(t,{hidden:!0})}(e)}"></converse-icon>`;class pO extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}render(){return gO(this.jid)}}ad.elements.define("converse-controlbox-navback",pO);function vO(){const e=C_("Log out");return wh`<a class="controlbox-heading__btn logout align-self-center" title="${e}" @click="${DT}"><converse-icon class="fa fa-sign-out-alt" size="1em"></converse-icon></a>`}const bO=e=>{const t=e.model.get("connected"),n=ad.settings.get("show_client_info")||ad.settings.get("allow_adhoc_commands");return wh`<div class="btn-toolbar g-0">${t&&n?function(e){const t=C_("Show details about this chat client");return wh`<a class="controlbox-heading__btn show-client-info align-self-center" title="${t}" @click="${e.showUserSettingsModal}"><converse-icon class="fa fa-cog" size="1em"></converse-icon></a>`}(e):""} ${t&&ad.settings.get("allow_logout")?vO():""} ${ad.settings.get("sticky_controlbox")?"":function(e){return wh`<a class="controlbox-heading__btn close align-self-center" @click="${t=>e.closeControlBox(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></a>`}(e)}</div>`};var yO=n(7190),_O={};_O.styleTagTransform=L(),_O.setAttributes=I(),_O.insert=N().bind(null,"head"),_O.domAPI=T(),_O.insertStyleElement=D();C()(yO.A,_O);yO.A&&yO.A.locals&&yO.A.locals;class wO extends O_{initialize(){const{chatboxes:e}=uo.state;this.model=e.get("controlbox")}render(){return bO(this)}showUserSettingsModal(e){e?.preventDefault(),ad.modal.show("converse-user-settings-modal",{model:uo.state.xmppstatus,_converse:uo},e)}closeControlBox(e){e?.preventDefault();const t=uo.state.chatboxviews.get("controlbox");t?.close()}}ad.elements.define("converse-controlbox-buttons",wO);var SO=n(6264),AO={};AO.styleTagTransform=L(),AO.setAttributes=I(),AO.insert=N().bind(null,"head"),AO.domAPI=T(),AO.insertStyleElement=D();C()(SO.A,AO);SO.A&&SO.A.locals&&SO.A.locals;const{CONTROLBOX_TYPE:xO}=__;Lf.plugins.add("converse-controlbox",{dependencies:["converse-modal","converse-chatboxes","converse-chat","converse-rosterview","converse-chatview"],enabled:e=>!e.api.settings.get("singleton"),initialize(){ad.settings.extend({allow_logout:!0,allow_user_trust_override:!0,default_domain:void 0,locked_domain:void 0,show_connection_url_input:!1,show_controlbox_by_default:!1,sticky_controlbox:!1}),ad.promises.add("controlBoxInitialized",!1),Object.assign(ad,mO);const e={ControlBox:sO,ControlBoxView:hO,ControlBoxToggle:rO,LoginForm:ZT};Object.assign(uo,e),Object.assign(uo.exports,e),ad.chatboxes.registry.add(xO,sO),ad.listen.on("chatBoxesFetched",zT),ad.listen.on("clearSession",RT),ad.listen.on("will-reconnect",IT),ad.waitUntil("chatBoxViewsInitialized").then(NT).catch((e=>Y.fatal(e)))}});ad.elements.define("converse-headlines-heading",class extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}async initialize(){this.model=uo.state.chatboxes.get(this.jid),await this.model.initialized,this.requestUpdate()}render(){return(e=>wh`<div class="chatbox-title ${e.status?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${uo.api.settings.get("singleton")?"":wh`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`}<div class="chatbox-title__text" title="${e.jid}">${e.display_name}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${Q_(yC(e.heading_buttons_promise),"")} ${Q_(bC(e.heading_buttons_promise),"")}</div></div>${e.status?wh`<p class="chat-head__desc">${e.status}</p>`:""}`)({...this.model.toJSON(),display_name:this.model.getDisplayName(),heading_buttons_promise:this.getHeadingButtons()})}getHeadingButtons(){const e=[];return ad.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:C_("Close"),i18n_title:C_("Close these announcements"),icon_class:"fa-times",name:"close",standalone:"overlayed"===ad.settings.get("view_mode")}),uo.api.hook("getHeadingButtons",this,e)}close(e){e.preventDefault(),this.model.close()}});class $O extends AT{async initialize(){const{chatboxviews:e,chatboxes:t}=uo.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>this.afterShown())),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.messages,"add",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"remove",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"reset",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),await this.model.messages.fetched,this.model.maybeShow(),ad.trigger("headlinesBoxViewInitialized",this)}render(){return(e=>wh`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e?wh`<converse-headlines-heading jid="${e.get("jid")}" class="chat-head chat-head-chatbox row g-0"></converse-headlines-heading><div class="chat-body"><div class="chat-content" aria-live="polite"><converse-chat-content .model="${e}"></converse-chat-content></div></div>`:""}</div>`)(this.model)}async close(e){return e?.preventDefault?.(),location.hash==="converse/chat?jid="+this.model.get("jid")&&history.pushState(null,"",window.location.pathname),await this.model.close(e),this}getNotifications(){return[]}afterShown(){this.model.clearUnreadMsgCounter()}}ad.elements.define("converse-headlines",$O);const EO=$O,{HEADLINES_TYPE:jO}=__;const CO=e=>{const t=e.model.filter((e=>e.get("type")===jO)),n=C_("Announcements");return wh`<div class="controlbox-section" id="headline"><div class="d-flex controlbox-padded ${t.length?"":"hidden"}"><span class="w-100 controlbox-heading controlbox-heading--headline" role="heading" aria-level="3">${n}</span></div></div><div class="list-container list-container--headline ${t.length?"":"hidden"}"><div class="items-list rooms-list headline-list">${t.map((t=>function(e,t){const n=C_("Click to open this server message");return wh`<div class="list-item controlbox-padded d-flex flex-row" data-headline-jid="${t.get("jid")}"><a class="list-item-link open-headline available-room w-100" data-headline-jid="${t.get("jid")}" title="${n}" @click="${t=>e.openHeadline(t)}" href="#">${t.get("jid")}</a></div>`}(e,t)))}</div></div>`},{HEADLINES_TYPE:kO}=__;class TO extends O_{initialize(){this.model=uo.state.chatboxes,this.listenTo(this.model,"add",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"remove",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"destroy",(e=>this.renderIfHeadline(e))),this.requestUpdate()}render(){return CO(this)}renderIfHeadline(e){return e?.get("type")===kO&&this.requestUpdate()}async openHeadline(e){e.preventDefault();const t=e.target.getAttribute("data-headline-jid");(await ad.headlines.get(t)).maybeShow(!0)}}ad.elements.define("converse-headlines-feeds-list",TO);var OO=n(3363),NO={};NO.styleTagTransform=L(),NO.setAttributes=I(),NO.insert=N().bind(null,"head"),NO.domAPI=T(),NO.insertStyleElement=D();C()(OO.A,NO);OO.A&&OO.A.locals&&OO.A.locals;var MO=n(6524),IO={};IO.styleTagTransform=L(),IO.setAttributes=I(),IO.insert=N().bind(null,"head"),IO.domAPI=T(),IO.insertStyleElement=D();C()(MO.A,IO);MO.A&&MO.A.locals&&MO.A.locals;Lf.plugins.add("converse-headlines-view",{dependencies:["converse-headlines","converse-chatview"],initialize(){const e={HeadlinesFeedView:EO,HeadlinesFeedsList:TO,HeadlinesPanel:TO};Object.assign(uo,e),Object.assign(uo.exports,e)}});var RO=n(304),DO={};DO.styleTagTransform=L(),DO.setAttributes=I(),DO.insert=N().bind(null,"head"),DO.domAPI=T(),DO.insertStyleElement=D();C()(RO.A,DO);RO.A&&RO.A.locals&&RO.A.locals;class zO extends Kx{static get properties(){return{...super.properties,model:{type:Object}}}constructor(){super(),this.model=null,this.observable="once",this.intersectionRatio=.1}render(){return(e=this).model.get("fetching")?Xx({classes:"hor_centered"}):wh`<a @click="${t=>e.fetchMissingMessages(t)}" title="${C_("Click to load missing messages")}"><div class="message mam-placeholder"></div></a>`;var e}fetchMissingMessages(e){e?.preventDefault?.(),this.model.fetchMissingMessages()}onVisibilityChanged(e){ad.settings.get("auto_fill_history_gaps")&&this.isVisible&&!this.model.get("fetching")&&this.fetchMissingMessages()}}ad.elements.define("converse-mam-placeholder",zO);const{CHATROOMS_TYPE:LO}=__;function PO(e,t){return e instanceof mb?wh`<converse-mam-placeholder .model="${e}"></converse-mam-placeholder>`:t}Lf.plugins.add("converse-mam-views",{dependencies:["converse-mam","converse-chatview","converse-muc-views"],initialize(){ad.settings.extend({auto_fill_history_gaps:!0}),ad.listen.on("getMessageTemplate",PO)}});var UO=n(7478),BO={};BO.styleTagTransform=L(),BO.setAttributes=I(),BO.insert=N().bind(null,"head"),BO.domAPI=T(),BO.insertStyleElement=D();C()(UO.A,BO);UO.A&&UO.A.locals&&UO.A.locals;const{Strophe:qO,sizzle:FO}=Lf.env;class HO extends O_{static get properties(){return{muc:{type:Object},jid:{type:String},affiliation:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}constructor(){super(),this.jid=null,this.muc=null,this.affiliation=null}render(){return(e=>{const t=C_("Change affiliation"),n=C_("New affiliation"),s=C_("Reason"),i=e.muc.getOwnOccupant().getAssignableAffiliations();return wh`<form class="affiliation-form" @submit="${t=>e.assignAffiliation(t)}">${e.alert_message?wh`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""}<div class="mb-3"><div class="row"><div class="col-md-6"><label class="form-label"><strong>${n}:</strong></label> <select class="form-select select-affiliation" name="affiliation">${i.map((t=>wh`<option value="${t}" ?selected="${t===e.affiliation}">${t}</option>`))}</select></div><div class="col-md-6"><label class="form-label"><strong>${s}:</strong></label> <input class="form-control" type="text" name="reason" placeholder="${s}"></div></div></div><div class="text-end"><button type="submit" class="btn btn-primary" name="change">${t}</button></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}async assignAffiliation(e){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),n=t.get("affiliation"),s={jid:this.jid,reason:t.get("reason")},i=this.muc.get("jid");try{await Rf.muc.setAffiliation(n,i,[s])}catch(e){return null===e?this.alert(C_("Timeout error while trying to set the affiliation"),"danger"):FO(`not-allowed[xmlns="${qO.NS.STANZAS}"]`,e).length?this.alert(C_("Sorry, you're not allowed to make that change"),"danger"):this.alert(C_("Sorry, something went wrong while trying to set the affiliation"),"danger"),void Y.error(e)}await this.muc.occupants.fetchMembers();const r=new CustomEvent("affiliationChanged",{bubbles:!0});this.dispatchEvent(r)}}ad.elements.define("converse-muc-affiliation-form",HO);var GO=n(9442),WO={};WO.styleTagTransform=L(),WO.setAttributes=I(),WO.insert=N().bind(null,"head"),WO.domAPI=T(),WO.insertStyleElement=D();C()(GO.A,WO);GO.A&&GO.A.locals&&GO.A.locals;const{Strophe:VO,sizzle:KO}=Lf.env;class JO extends O_{static get properties(){return{muc:{type:Object},jid:{type:String},role:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}constructor(){super(),this.muc=null,this.nick=null,this.jid=null}render(){return(e=>{const t=C_("Change role"),n=C_("New Role"),s=C_("Reason"),i=e.muc.getOwnOccupant().getAssignableRoles();return wh`<form class="role-form" @submit="${e.assignRole}"><input type="hidden" name="jid" value="${e.jid}"> <input type="hidden" name="nick" value="${e.nick}"><div class="mb-3"><div class="row"><div class="col-md-6"><label class="form-label"><strong>${n}:</strong></label> <select class="form-select select-role" name="role">${i.map((t=>wh`<option value="${t}" ?selected="${t===e.role}">${t}</option>`))}</select></div><div class="col-md-6"><label class="form-label"><strong>${s}:</strong></label> <input class="form-control" type="text" name="reason" placeholder="${s}"></div></div></div><div class="text-end"><button type="submit" class="btn btn-primary">${t}</button></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}assignRole(e){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),n=this.muc.getOccupant(t.get("jid")||t.get("nick")),s=t.get("role"),i=t.get("reason");this.muc.setRole(n,s,i,(()=>{const e=new CustomEvent("roleChanged",{bubbles:!0});this.dispatchEvent(e)}),(e=>{KO(`not-allowed[xmlns="${VO.NS.STANZAS}"]`,e).length?this.alert(C_("You're not allowed to make that change"),"danger"):(this.alert(C_("Sorry, something went wrong while trying to set the role"),"danger"),Rf.isErrorObject(e)&&Y.error(e))}))}}ad.elements.define("converse-muc-role-form",JO);ad.elements.define("converse-muc-message-form",class extends vT{async initialize(){super.initialize(),await this.model.initialized,this.initMentionAutoComplete()}render(){return(e=>{const t=e.model.get("composing_spoiler"),n=C_(t?"Hidden message":"Message"),s=C_("Optional hint"),i=ad.settings.get("message_limit"),r=ad.settings.get("visible_toolbar_buttons").call,o=ad.settings.get("visible_toolbar_buttons").emoji,a=ad.settings.get("show_send_button"),c=ad.settings.get("visible_toolbar_buttons").spoiler,l=ad.settings.get("show_toolbar");return wh`<form class="setNicknameButtonForm hidden"><input type="submit" class="btn btn-primary" name="join" value="Join"></form><form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?wh`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?hidden_occupants="${e.model.get("hidden_occupants")}" ?is_groupchat="${"groupchat"===e.model.get("message_type")}" ?show_call_button="${r}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" placeholder="${s||""}" .value="${e.model.get("draft_hint")??""}" @change="${t=>Rf.safeSave(e.model,{draft_hint:t.target.value})}" class="${t?"":"hidden"} spoiler-hint"><div class="suggestion-box"><ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul><textarea autofocus type="text" .value="${e.model.get("draft")??""}" @drop="${t=>e.onDrop(t)}" @input="${mT}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>Rf.safeSave(e.model,{draft:t.target.value})}" class="chat-textarea suggestion-box__input ${e.model.get("correcting")?"correcting":""} ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${n}"></textarea> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div></form>`})(this)}shouldAutoComplete(){const e=this.model instanceof Op?this.model.collection.chatroom:this.model;if(e){return e.session.get("connection_status")===Lf.ROOMSTATUS.ENTERED&&!(e.features.get("moderated")&&"visitor"===e.getOwnRole())}return Y.debug("Could not determine MUC for MUCMessageForm element"),!1}initMentionAutoComplete(){this.auto_complete=new oj(this,{auto_first:!0,min_chars:ad.settings.get("muc_mention_autocomplete_min_chars"),match_current_word:!0,list:()=>this.getAutoCompleteList(),filter:"contains"==ad.settings.get("muc_mention_autocomplete_filter")?ej:tj,ac_triggers:["Tab","@"],include_triggers:[],item:(e,t)=>function(e,t,n){n=n.trim();const s=document.createElement("li");if(s.setAttribute("aria-selected","false"),ad.settings.get("muc_mention_autocomplete_show_avatar")){const n=t.label.toLowerCase(),i=document.createElement("converse-avatar");i.model=e.occupants.findWhere((e=>e.getDisplayName()?.toLowerCase()?.startsWith(n)||e.get("nickname")?.toLowerCase()?.startsWith(n)||e.get("jid")?.toLowerCase()?.startsWith(n)?e:void 0)),i.setAttribute("name",i.model.getDisplayName()),i.setAttribute("height","22"),i.setAttribute("width","22"),i.setAttribute("class","avatar avatar-autocomplete"),s.appendChild(i)}const i=new RegExp("("+n+")","ig");return(n?t.split(i):[t]).forEach((e=>{if(n&&e.match(i)){const t=document.createElement("mark");t.textContent=e,s.appendChild(t)}else s.appendChild(document.createTextNode(e))})),s}(this.model,e,t)}),this.auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}getAutoCompleteList(){return this.model.getAllKnownNicknames().map((e=>({label:e,value:`@${e}`})))}onKeyDown(e){this.shouldAutoComplete()&&this.auto_complete.onKeyDown(e)||super.onKeyDown(e)}onKeyUp(e){this.shouldAutoComplete()&&this.auto_complete.auto_completing&&this.auto_complete.evaluate(e),super.onKeyUp(e)}});var YO=n(4734),XO={};XO.styleTagTransform=L(),XO.setAttributes=I(),XO.insert=N().bind(null,"head"),XO.domAPI=T(),XO.insertStyleElement=D();C()(YO.A,XO);YO.A&&YO.A.locals&&YO.A.locals;class QO extends O_{constructor(){super(),this.jid=null,this.model=null}static get properties(){return{jid:{type:String}}}shouldUpdate(e){if(e.has("jid")&&this.jid){const{chatboxes:e}=uo.state;this.model=e.get(this.jid)}return!0}render(){return(e=>{const t=C_("Nickname"),n=e.model?.isEntered()?C_("Change nickname"):C_("Enter groupchat"),s=ad.settings.get("muc_show_logs_before_join")?C_("Choose a nickname to enter"):C_("Please choose your nickname"),i=e.model?.get("nickname_validation_message");return wh`<div class="chatroom-form-container muc-nickname-form"><form class="converse-form chatroom-form converse-centered-form" @submit="${t=>e.submitNickname(t)}"><fieldset><label class="form-label">${s}</label><p class="validation-message">${i}</p><input type="text" required="required" name="nick" value="${e.model?.get("nick")||""}" class="form-control ${i?"error":""}" placeholder="${t}"></fieldset><fieldset><input type="submit" class="btn btn-primary" name="join" value="${n}"></fieldset></form></div>`})(this)}submitNickname(e){e.preventDefault();const t=e.target.nick.value.trim();t&&(this.model.isEntered()?(this.model.setNickname(t),this.closeModal()):this.model.join(t))}closeModal(){document.querySelector("converse-muc-nickname-modal").close()}}ad.elements.define("converse-muc-nickname-form",QO);var ZO=n(6215),eN={};eN.styleTagTransform=L(),eN.setAttributes=I(),eN.insert=N().bind(null,"head"),eN.domAPI=T(),eN.insertStyleElement=D();C()(ZO.A,eN);ZO.A&&ZO.A.locals&&ZO.A.locals;ad.elements.define("converse-muc-bottom-panel",class extends _T{async initialize(){await super.initialize(),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model,"change:num_unread_general",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",this.renderIfOwnOccupant),this.listenTo(this.model.occupants,"change:role",this.renderIfOwnOccupant),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate()))}render(){return this.model?(e=>{const t=C_("You have unread messages"),n=e.model.session.get("connection_status"),s=C_("You're not allowed to send messages in this room");return n===Lf.ROOMSTATUS.ENTERED?wh`${e.model.ui.get("scrolled")&&e.model.get("num_unread_general")?wh`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">â¼ ${t} â¼</div>`:""} ${e.model.canPostMessages()?wh`<converse-muc-message-form .model="${e.model}"></converse-muc-message-form>`:wh`<span class="muc-bottom-panel muc-bottom-panel--muted">${s}</span>`}`:n!=Lf.ROOMSTATUS.NICKNAME_REQUIRED?"":ad.settings.get("muc_show_logs_before_join")?wh`<span class="muc-bottom-panel muc-bottom-panel--nickname"><converse-muc-nickname-form .model="${e.model}"></converse-muc-nickname-form></span>`:void 0})(this):""}renderIfOwnOccupant(e){const t=uo.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}sendButtonClicked(e){if("sendMessage"===e.delegateTarget?.dataset.action){const t=this.querySelector("converse-muc-message-form");t?.onFormSubmitted(e)}}});const tN=Lf.env.utils;ad.elements.define("converse-muc-invite-modal",class extends aE{constructor(e){super(e),this.id="converse-muc-invite-modal",this.muc=e.muc}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate()))}renderModal(){return(e=>{const t=C_("Invite"),n=C_("user@example.org"),s=C_("Please enter a valid XMPP address"),i=C_("XMPP Address"),r=C_("Optional reason for the invitation");return wh`<form class="converse-form" @submit="${t=>e.submitInviteForm(t)}"><fieldset><label class="form-label clearfix" for="invitee_jids">${i}:</label> ${e.model.get("invalid_invite_jid")?wh`<div class="error error-feedback">${s}</div>`:""}<converse-autocomplete .getAutoCompleteList="${()=>e.getAutoCompleteList()}" ?autofocus="${!0}" min_chars="1" position="below" required="required" name="invitee_jids" id="invitee_jids" placeholder="${n}"></converse-autocomplete></fieldset><fieldset><label class="form-label">${r}:</label> <textarea class="form-control" name="reason"></textarea></fieldset><fieldset><input type="submit" class="btn btn-primary" value="${t}"></fieldset></form>`})(this)}getModalTitle(){return C_("Invite someone to this groupchat")}getAutoCompleteList(){return uo.state.roster.map((e=>({label:e.getDisplayName(),value:e.get("jid")})))}submitInviteForm(e){e.preventDefault();const t=new FormData(e.target),n=t.get("invitee_jids")?.trim(),s=t.get("reason");tN.isValidJID(n)?(this.muc.directInvite(n,s),this.modal.hide()):this.model.set({invalid_invite_jid:!0})}});let nN;function sN(e){nN||function(){let e;nN={},nN.owner={label:C_("Owner"),classname:"badge-groupchat"},nN.admin={label:C_("Admin"),classname:"badge-info"},nN.member={label:C_("Member"),classname:"badge-info"},nN.moderator={label:C_("Moderator"),classname:"badge-info"},nN.visitor={label:C_("Visitor"),classname:"badge-secondary"};for(let t=1;t<5&&(!e||Object.values(e).find((e=>e>1)));t++){const n={};for(const s of Object.values(nN))(!e||(e[s.shortlabel]??0)>=2)&&(s.shortlabel=s.label.substr(0,t).toLocaleUpperCase(),n[s.shortlabel]??=0,n[s.shortlabel]++);e=n}}();const t=nN[e];return t?wh`<span title="${t.label}" aria-label="${t.label}" class="badge ${t.classname??"badge-info"}">${t.shortlabel}</span>`:""}function iN(e){const t=e.get("role"),n=(e=>C_("Click to mention %1$s in your message.",e.get("nick")))(e),s=C_("This user is a moderator."),i=C_("This user can send messages in this groupchat."),r=C_("This user can NOT send messages in this groupchat."),o=e.get("jid")?`${e.get("jid")} `:"";return"moderator"===t?`${o}${s} ${n}`:"participant"===t?`${o}${i} ${n}`:"visitor"===t?`${o}${r} ${n}`:["visitor","participant","moderator"].includes(t)?void 0:`${o}${n}`}const rN=e=>{const t=e.model,{show:n,presence:s,affiliation:i}=e.model.attributes,r=a$[n||s],o=t.get("role");let a,c;[a,c]="chat"===n||!n&&"online"===s?["fa fa-circle","chat-status-online"]:"dnd"===n?["fa fa-minus-circle","chat-status-busy"]:"away"===n||"xa"===n?["fa fa-circle","chat-status-away"]:["fa fa-circle","chat-status-offline"];const l=vC(t);return wh`<li class="list-item occupant" id="${t.id}"><a @click="${n=>e.onOccupantClicked(n,t)}"><div class="row g-0"><div class="col-auto"><converse-avatar .model="${t}" class="avatar chat-msg__avatar" name="${t.getDisplayName()}" nonce="${t.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><converse-icon title="${r}" color="var(--${c})" size="0.82em" class="${a} chat-status chat-status--avatar"></converse-icon>${l?wh`<span class="msgs-indicator badge">${l}</span>`:""}</div><div class="col occupant-nick-badge"><span class="occupant-nick" title="${iN(t)}" style="${l$(t)}">${t.getDisplayName()}</span> <span class="occupant-badges">${"owner"===i?sN("owner"):""} ${"admin"===i?sN("admin"):""} ${"member"===i?sN("member"):""} ${"moderator"===o?sN("moderator"):""} ${"visitor"===o?sN("visitor"):""} </span>${Q_(async function(e){const t=await ad.hook("getOccupantActionButtons",e,[]);if(!t?.length)return"";const n=t.map((e=>wh`<button class="dropdown-item ${e.button_class}" @click="${e.handler}" type="button"><converse-icon class="${e.icon_class}" color="var(--foreground-color)" size="1em" aria-hidden="true"></converse-icon>Â ${e.i18n_text}</button>`));return wh`<converse-dropdown class="occupant-actions chatbox-btn" .items="${n}"></converse-dropdown>`}(t))}</div></div></a></li>`};var oN=n(9613),aN={};aN.styleTagTransform=L(),aN.setAttributes=I(),aN.insert=N().bind(null,"head"),aN.domAPI=T(),aN.insertStyleElement=D();C()(oN.A,aN);oN.A&&oN.A.locals&&oN.A.locals;ad.elements.define("converse-occupant-bottom-panel",class extends _T{static get properties(){return{model:{type:Object,noAccessor:!0},muc:{type:Object}}}constructor(){super(),this.muc=null}async initialize(){await super.initialize(),this.listenTo(this.muc.session,"change:connection_status",(()=>this.requestUpdate()))}render(){return this.model?(e=>{const t=C_("You have unread messages"),n=e.muc.session.get("connection_status"),s=C_("This user is not currently in this groupchat and can't receive messages."),i=C_("Invite this user to join this groupchat"),r=C_("Open a one-on-one chat with this user"),o=C_("Open Chat"),a=C_("Invite");return n===Lf.ROOMSTATUS.ENTERED?wh`${e.muc.ui.get("scrolled")&&e.model.get("num_unread")?wh`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">â¼ ${t} â¼</div>`:""} ${e.canPostMessages()?wh`<converse-muc-message-form .model="${e.model}"></converse-muc-message-form>`:wh`<div class="bottom-panel bottom-panel--muted"><p class="bottom-panel--muted__msg">${s}</p>${e.model.get("jid")?wh`<button @click="${e.openChat}" type="button" class="btn btn-primary" title="${r}">${o}</button> <button @click="${e.invite}" type="button" class="btn btn-secondary" title="${i}">${a}</button>`:""}</div>`}`:""})(this):""}canPostMessages(){return this.muc.isEntered()&&"offline"!==this.model.get("show")}openChat(){const e=this.model.get("jid");return e?ad.chats.open(e,{},!0):ad.alert("error",C_("Error"),"Could not find XMPP address")}invite(){const e=this.model.get("jid");return ad.listen.once("roomInviteSent",(()=>ad.alert("info",C_("Success"),C_("The user has been invited to join this groupchat")))),e?this.muc.directInvite(e):ad.alert("error",C_("Error"),"Could not find XMPP address")}});ad.elements.define("converse-muc-occupant-list-item",class extends Kx{constructor(){super(),this.muc=null,this.observable="once"}static get properties(){return{...super.properties,model:{type:ie.Model},muc:{type:jp}}}async initialize(){super.initialize(),await this.muc.initialized,this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.muc?rN(this):""}onOccupantClicked(e,t){e.preventDefault(),this.muc.getOwnOccupant()===t?ad.modal.show("converse-profile-modal",{model:uo.state.xmppstatus},e):this.muc.save({sidebar_view:`occupant:${t.id}`})}});const cN=e=>{const t=C_("Filter"),n=C_("Filter by name"),s=C_("Filter by status"),i=C_("Any"),r=C_("Online"),o=C_("Chatty"),a=C_("Busy"),c=C_("Away"),l=C_("Extended Away"),d=C_("Offline"),u=e.model.get("state"),h=e.model.get("text"),f=e.model.get("type"),m="overlayed"===ad.settings.get("view_mode");return wh`<form class="items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="${m?"":"flex-nowrap"}"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===f?"selected":""}" data-type="items" title="${n}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===f?"selected":""}" data-type="state" title="${s}"></converse-icon></div><div class="btn-group"><input .value="${h||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===f?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${h&&"state"!==f?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==f?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${i}</option><option ?selected="${"online"===u}" value="online">${r}</option><option ?selected="${"chat"===u}" value="chat">${o}</option><option ?selected="${"dnd"===u}" value="dnd">${a}</option><option ?selected="${"away"===u}" value="away">${c}</option><option ?selected="${"xa"===u}" value="xa">${l}</option><option ?selected="${"offline"===u}" value="offline">${d}</option></select></div></form>`};const lN=e=>{const t=1===e.model.occupants?C_("Participant"):C_("Participants"),n=C_("Hide"),s=C_("Show filter"),i=C_("Hide filter"),r=e.model.get("filter_visible"),o=C_("Invite someone"),a=C_("Invite someone to join this groupchat"),c=[];return e.model.invitesAllowed()&&c.push(wh`<a href="#" class="dropdown-item open-invite-modal" role="button" title="${a}" @click="${t=>e.showInviteModal(t)}"><converse-icon size="1em" class="fa fa-user-plus"></converse-icon>${o}</a>`),e.model.occupants.length>5&&c.push(wh`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${r?i:s}</a>`),c.length?c.push(wh`<a href="#" class="dropdown-item" role="button" @click="${t=>e.closeSidebar(t)}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${n}</a>`):c.push(wh`<i class="hide-occupants" @click="${t=>e.closeSidebar(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></i>`),wh`<div class="occupants"><div class="occupants-header"><div class="occupants-header--title"><span class="occupants-heading sidebar-heading">${e.model.occupants.length} ${t}</span> ${1===c.length?c[0]:wh`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${c}"></converse-dropdown>`}</div></div><ul class="items-list occupant-list">${r?wh`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${e.model.initialized}" .items="${e.model.occupants}" .template="${cN}" .model="${e.filter}"></converse-list-filter>`:""} ${nC(e.model.occupants.models,(e=>e.get("jid")),(t=>function(e,t){if(!e.model.get("filter_visible"))return!1;const n=e.filter.get("type"),s="state"===n?e.filter.get("state").toLowerCase():e.filter.get("text").toLowerCase();if(!s)return!1;if("state"===n){const e=t.get("presence");return"online"===s?["offline","unavailable"].includes(e):"ofline"===s?"online"===e:!t.get("show")?.includes(s)}return"items"===n?!t.getDisplayName().toLowerCase().includes(s):void 0}(e,t)?"":wh`<converse-muc-occupant-list-item .muc="${e.model}" .model="${t}">`))}</ul></div>`};var dN=n(3952),uN={};uN.styleTagTransform=L(),uN.setAttributes=I(),uN.insert=N().bind(null,"head"),uN.domAPI=T(),uN.insertStyleElement=D();C()(dN.A,uN);dN.A&&dN.A.locals&&dN.A.locals;const{u:hN}=Lf.env;ad.elements.define("converse-muc-occupant",class extends O_{constructor(){super(),this.muc_jid=null,this.occupant_id=null}static get properties(){return{muc_jid:{type:String},occupant_id:{type:String}}}async initialize(){super.initialize();const{chatboxes:e}=uo.state;this.muc=e.get(this.muc_jid),await this.muc.initialized,this.model=this.muc.occupants.get(this.occupant_id),this.requestUpdate()}render(){return this.muc?(e=>{const t=C_("Hide"),n=C_("No participant data found"),s=C_("Participants"),i=C_("Show details"),r=e.model?.get("jid"),o=e.model?.get("nick"),a=Rf.firstCharToUpperCase(e.model?.get("role")),c=Rf.firstCharToUpperCase(e.model?.get("affiliation")),l=e.model?.get("hats")?.length?e.model.get("hats").map((({title:e})=>e)):[];return wh`<span class="sidebar-occupant"><div class="sidebar-heading"><span><button type="button" class="btn btn--transparent back-button" @click="${()=>e.muc.save({sidebar_view:"occupants"})}"><converse-icon size="1em" class="fa fa-arrow-left"></converse-icon></button> <a @click="${t=>{t.preventDefault(),e.muc.save({sidebar_view:"occupants"})}}">${s}</a></span><converse-dropdown .items="${[wh`<a class="dropdown-item show-occupant-modal" role="button" title="${i}" @click="${()=>e.showOccupantModal()}"><converse-icon class="fa fa-id-card" size="1em"></converse-icon>${i}</a>`,wh`<a href="#" class="dropdown-item" role="button" @click="${()=>e.closeSidebar()}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${t}</a>`]}"></converse-dropdown></div>${e.model?wh`<div class="row"><div class="col"><converse-avatar .model="${e.model}" class="avatar modal-avatar justify-content-center" name="${e.model.getDisplayName()}" nonce="${e.getVcard()?.get("vcard_updated")}" height="120" width="120"></converse-avatar></div></div>`:""}<ul class="occupant-details">${e.model?wh`${o?wh`<li class="occupant-details-nickname">${o}</li>`:""}<li class="occupant-details-jid">${r?wh`<a @click="${()=>e.openChat(r)}">${r}</a>`:""}</li><li>${c&&"None"!==c?wh`<span class="badge text-bg-primary">${c}</span>`:""} ${a?wh`<span class="badge text-bg-secondary">${a}</span>`:""} ${l.length?wh`${l.map((e=>wh`<span class="badge text-bg-info">${e}</span>`))}`:""}</li>`:wh`<li>${n}</li>`}</ul>${e.model?wh`<div class="chat-body"><div class="chat-content chat-content-sendbutton" aria-live="polite"><converse-chat-content .model="${e.model}"></converse-chat-content></div><converse-occupant-bottom-panel .model="${e.model}" .muc="${e.muc}" class="bottom-panel"></converse-occupant-bottom-panel></div>`:""}</span>`})(this):""}openChat(e){ad.chats.open(e,{},!0)}closeSidebar(){hN.safeSave(this.muc,{hidden_occupants:!0})}showOccupantModal(e){e?.preventDefault?.(),ad.modal.show("converse-muc-occupant-modal",{model:this.model},e)}getVcard(){const e=this.model;if(e.vcard)return e.vcard;const t=e?.get("jid")||e?.get("from");return t?uo.state.vcards.get(t):null}addToContacts(){const e=this.model.get("jid");e&&ad.modal.show("converse-add-contact-modal",{model:new ie.Model({jid:e})})}toggleForm(e){"row-form"===hN.ancestor(e.target,".toggle-form").getAttribute("data-form")?this.show_role_form=!this.show_role_form:this.show_affiliation_form=!this.show_affiliation_form,this.requestUpdate()}});var fN=n(8945),mN={};mN.styleTagTransform=L(),mN.setAttributes=I(),mN.insert=N().bind(null,"head"),mN.domAPI=T(),mN.insertStyleElement=D();C()(fN.A,mN);fN.A&&fN.A.locals&&fN.A.locals;var gN=n(33),pN={};pN.styleTagTransform=L(),pN.setAttributes=I(),pN.insert=N().bind(null,"head"),pN.domAPI=T(),pN.insertStyleElement=D();C()(gN.A,pN);gN.A&&gN.A.locals&&gN.A.locals;const{initStorage:vN}=Rf;ad.elements.define("converse-muc-occupants",class extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const e=`_converse.occupants-filter-${this.jid}`;this.filter=new kv,this.filter.id=e,vN(this.filter,e),this.filter.fetch();const{chatboxes:t}=uo.state;this.model=t.get(this.jid);const n=$o((()=>this.requestUpdate()),200,{maxWait:1e3});this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",n),this.listenTo(this.model.occupants,"change",n),this.listenTo(this.model.occupants,"remove",n),this.listenTo(this.model.occupants,"sort",n),this.listenTo(this.model.features,"change:open",(()=>this.requestUpdate())),this.model.initialized.then((()=>this.requestUpdate()))}render(){return lN(this)}showInviteModal(e){e.preventDefault(),ad.modal.show("converse-muc-invite-modal",{model:new ie.Model,muc:this.model},e)}toggleFilter(e){e?.preventDefault?.(),Rf.safeSave(this.model,{filter_visible:!this.model.get("filter_visible")})}closeSidebar(e){e?.preventDefault?.(),Rf.safeSave(this.model,{hidden_occupants:!0})}});var bN=n(8853),yN={};yN.styleTagTransform=L(),yN.setAttributes=I(),yN.insert=N().bind(null,"head"),yN.domAPI=T(),yN.insertStyleElement=D();C()(bN.A,yN);bN.A&&bN.A.locals&&bN.A.locals;ad.elements.define("converse-muc-sidebar",class extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const{chatboxes:e}=uo.state;this.model=e.get(this.jid),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:open",(()=>this.requestUpdate())),this.model.initialized.then((()=>this.requestUpdate()))}render(){return(e=>{const t=e.model.get("sidebar_view")||"",n=t.split("occupant:").pop();return wh`${t?.startsWith("occupant:")?wh`<converse-muc-occupant muc_jid="${e.jid}" occupant_id="${n}"></converse-muc-occupant>`:wh`<converse-muc-occupants jid="${e.jid}"></converse-muc-occupants>`}`})(this)}closeSidebar(e){e?.preventDefault?.(),Rf.safeSave(this.model,{hidden_occupants:!0})}});var _N=n(4641),wN={};wN.styleTagTransform=L(),wN.setAttributes=I(),wN.insert=N().bind(null,"head"),wN.domAPI=T(),wN.insertStyleElement=D();C()(_N.A,wN);_N.A&&_N.A.locals&&_N.A.locals;ad.elements.define("converse-muc-chat-content",class extends Gk{async initialize(){await super.initialize(),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"change",(()=>this.requestUpdate()))}});const{CHATROOMS_TYPE:SN}=__;ad.elements.define("converse-muc-chatarea",class extends O_{static get properties(){return{jid:{type:String},show_help_messages:{type:Boolean},type:{type:String}}}constructor(){super(),this.jid=null,this.type=null,this.split=null}async initialize(){this.model=await ad.rooms.get(this.jid),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate())),this.#h(),this.hideSidebarIfSmallViewport=Rf.debounce(this.#h.bind(this),100),this.requestUpdate()}render(){return this.model?(e=>{const t=ad.settings.get("show_send_button"),n=ad.settings.get("view_mode");let s,i;return"overlayed"===n?(s="d-none d-md-flex col-s-10 col-md-8",i="col-xs-12 col-s-2 col-md-4"):"fullscreen"===n?(s="d-none d-md-flex col-md-8 col-xl-10",i="col-xs-12 col-md-4 col-xl-2"):"embedded"===n&&(s="d-flex col-8",i="col-4"),wh`<div class="chat-area ${e.shouldShowSidebar()?s:"col-xs-12"}"><div class="chat-content ${t?"chat-content-sendbutton":""}" aria-live="polite"><converse-muc-chat-content .model="${e.model}"></converse-muc-chat-content>${e.model?.get("show_help_messages")?wh`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${e.getHelpMessages()}" type="info" chat_type="${SN}"></converse-chat-help></div>`:""}</div><converse-muc-bottom-panel .model="${e.model}" class="bottom-panel"></converse-muc-bottom-panel></div>${e.model?wh`<converse-split-resize></converse-split-resize><converse-muc-sidebar class="${e.shouldShowSidebar()?i:"col-xs-0 hidden"}" jid="${e.jid}"></converse-muc-sidebar>`:""}`})(this):""}#h(){if(this.model?.get("hidden_occupants"))return;window.matchMedia("(max-width: 576px)").matches&&this.model?.save("hidden_occupants",!0)}connectedCallback(){super.connectedCallback(),window.addEventListener("resize",this.hideSidebarIfSmallViewport,!0)}disconnectedCallback(){super.disconnectedCallback(),window.addEventListener("resize",this.hideSidebarIfSmallViewport,!0)}shouldShowSidebar(){return!this.model.get("hidden_occupants")&&this.model.session.get("connection_status")===Lf.ROOMSTATUS.ENTERED}getHelpMessages(){const e=ad.settings.get("muc_disable_slash_commands"),t=Array.isArray(e)?e:[];return[`<strong>/admin</strong>: ${C_("Change user's affiliation to admin")}`,`<strong>/ban</strong>: ${C_("Ban user by changing their affiliation to outcast")}`,`<strong>/clear</strong>: ${C_("Clear the chat area")}`,`<strong>/close</strong>: ${C_("Close this groupchat")}`,`<strong>/deop</strong>: ${C_("Change user role to participant")}`,`<strong>/destroy</strong>: ${C_("Remove this groupchat")}`,`<strong>/help</strong>: ${C_("Show this menu")}`,`<strong>/kick</strong>: ${C_("Kick user from groupchat")}`,`<strong>/me</strong>: ${C_("Write in 3rd person")}`,`<strong>/member</strong>: ${C_("Grant membership to a user")}`,`<strong>/modtools</strong>: ${C_("Opens up the moderator tools GUI")}`,`<strong>/mute</strong>: ${C_("Remove user's ability to post messages")}`,`<strong>/nick</strong>: ${C_("Change your nickname")}`,`<strong>/op</strong>: ${C_("Grant moderator role to user")}`,`<strong>/owner</strong>: ${C_("Grant ownership of this groupchat")}`,`<strong>/register</strong>: ${C_("Register your nickname")}`,`<strong>/revoke</strong>: ${C_("Revoke the user's current affiliation")}`,`<strong>/subject</strong>: ${C_("Set groupchat subject")}`,`<strong>/topic</strong>: ${C_("Set groupchat subject (alias for /subject)")}`,`<strong>/voice</strong>: ${C_("Allow muted user to post messages")}`].filter((e=>t.every((t=>!e.startsWith(t+"<",9))))).filter((e=>this.model.getAllowedCommands().some((t=>e.startsWith(t+"<",9)))))}});const AN=e=>{const t=C_("This groupchat no longer exists"),n=C_('The following reason was given: "%1$s"',e.reason||"");return wh`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${t}</h3></div>${e.reason?wh`<p class="destroyed-reason">${n}</p>`:""} ${e.moved_jid?(e=>{const t=C_("The conversation has moved to a new address. Click the link below to enter.");return wh`<p class="moved-label">${t}</p><p class="moved-link"><a class="switch-chat" @click="${t=>e.onSwitch(t)}">${e.moved_jid}</a></p>`})(e):""}`};ad.elements.define("converse-muc-destroyed",class extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=uo.state.chatboxes.get(this.jid)}render(){const e=this.model.get("destroyed_reason"),t=this.model.get("moved_jid");return AN({moved_jid:t,reason:e,onSwitch:e=>this.onSwitch(e)})}async onSwitch(e){e.preventDefault();const t=this.model.get("moved_jid");(await ad.rooms.get(t,{},!0)).maybeShow(!0),this.model.destroy()}});ad.elements.define("converse-muc-disconnected",class extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=uo.state.chatboxes.get(this.jid)}render(){const e=this.model.session.get("disconnection_message");if(!e)return;const t=[e],n=this.model.session.get("disconnection_actor");n&&t.push(C_("This action was done by %1$s.",n));const s=this.model.session.get("disconnection_reason");return s&&t.push(C_('The reason given is: "%1$s".',s)),(e=>wh`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${e[0]}</h3>${e.slice(1).map((e=>wh`<p class="disconnect-msg">${e}</p>`))}</div>`)(t)}});var xN=n(998),$N={};$N.styleTagTransform=L(),$N.setAttributes=I(),$N.insert=N().bind(null,"head"),$N.domAPI=T(),$N.insertStyleElement=D();C()(xN.A,$N);xN.A&&xN.A.locals&&xN.A.locals;const EN=Lf.env.utils,{sizzle:jN,u:CN}=Lf.env;ad.elements.define("converse-muc-config-modal",class extends aE{constructor(e){super(e),this.id="converse-muc-config-modal"}initialize(){super.initialize(),this.addListeners()}addListeners(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:passwordprotected",(()=>this.requestUpdate())),this.listenTo(this.model.session,"change:config_stanza",(()=>this.requestUpdate()))}renderModal(){return(e=>{const t=ad.settings.get("roomconfig_whitelist");let n=[],s="",i=C_("Loading configuration form");const r=e.model.session.get("config_stanza");if(r){const o=EN.toStanza(r);let{fields:a}=hm(o);t.length&&(a=a.filter((e=>t.includes(e.var))));const c={new_password:!e.model.features.get("passwordprotected"),fixed_username:e.model.get("jid")};n=a.map((e=>EN.xFormField2TemplateResult(e,c))),s=o.querySelector("instructions")?.textContent,i=o.querySelector("title")?.textContent}const o=C_("Save");return wh`<form class="converse-form chatroom-form ${n.length?"":"converse-form--spinner"}" autocomplete="off" @submit="${t=>e.submitConfigForm(t)}"><fieldset><legend class="centered">${i}</legend>${i!==s?wh`<p class="form-help">${s}</p>`:""} ${n.length&&e.model.features.get("vcard-temp")?wh`<div class="row py-2"><converse-image-picker .model="${e.model}" width="96" height="96"></converse-image-picker></div>`:""} ${n.length?n:Xx({classes:"hor_centered"})}</fieldset>${n.length?wh`<fieldset><input type="submit" class="btn btn-primary" value="${o}"></fieldset>`:""}</form>`})(this)}shouldUpdate(e){return e.has("model")&&this.model&&(this.stopListening(),this.addListeners(),this.getConfig()),!0}getModalTitle(){return C_("Configure %1$s",this.model.getDisplayName())}async getConfig(){const e=await this.model.fetchRoomConfiguration();this.model.session.set("config_stanza",e.outerHTML)}async setAvatar(e){if(!this.model.features.get("vcard-temp"))return;const t=new FormData(e.target).get("avatar_image");if(t?.size){const e=f$?t:await m$(t),n=new FileReader;n.onloadend=async()=>{const e={image:btoa(n.result),image_type:t.type};await ad.vcard.set(this.model.get("jid"),e)},n.readAsBinaryString(e)}}async submitConfigForm(e){e.preventDefault();const t=jN(':input:not([type=button]):not([type=submit]):not([name="avatar_image"][type="file"])',e.target).map(CN.webForm2xForm).filter((e=>e));try{await this.model.sendConfiguration(t)}catch(e){Y.error(e);const t=C_("Sorry, an error occurred while trying to submit the config form.")+" "+C_("Check your browser's developer console for details.");ad.alert("error",C_("Error"),t)}try{await this.setAvatar(e)}catch(e){return Y.fatal(e),void this.alert([C_("Sorry, an error happened while trying to save the groupchat avatar."),C_("You can check your browser's developer console for any error output.")].join(" "))}await this.model.refreshDiscoInfo(),this.modal.hide()}});const kN=e=>{const t=e.config.toJSON(),n=e.features.toJSON(),s=e.occupants.filter((e=>"offline"!==e.get("show"))).length,i=C_("XMPP address"),r=C_("Message archiving"),o=C_("Messages are archived on the server"),a=C_("Description"),c=C_("Features"),l=C_("Hidden"),d=C_("This groupchat is not publicly searchable"),u=C_("This groupchat is restricted to members only"),h=C_("Members only"),f=C_("Moderated"),m=C_("Participants entering this groupchat need to request permission to write"),g=C_("Name"),p=C_("This groupchat does not require a password upon entry"),v=C_("No password required"),b=C_("Not anonymous"),y=C_("All other groupchat participants can see your XMPP address"),_=C_("Not moderated"),w=C_("Participants entering this groupchat can write right away"),S=C_("Online users"),A=C_("Open"),x=C_("Anyone can join this groupchat"),$=C_("This groupchat requires a password before entry"),E=C_("Password protected"),j=C_("Persistent"),C=C_("This groupchat persists even if it's unoccupied"),k=C_("Public"),T=C_("This groupchat is publicly searchable"),O=C_("Semi-anonymous"),N=C_("Only moderators can see your XMPP address"),M=C_("Temporary"),I=C_("This groupchat will disappear once the last person leaves");return wh`<div class="room-info"><converse-avatar .model="${e}" class="avatar align-self-center" name="${e.getDisplayName()}" nonce="${e.vcard?.get("vcard_updated")}" height="72" width="72"></converse-avatar><p class="room-info"><strong>${g}:</strong> ${e.get("name")}</p><p class="room-info"><strong>${i}:</strong><converse-texture text="xmpp:${e.get("jid")}?join"></converse-texture></p><br><p class="room-info"><strong>${a}:</strong><converse-texture text="${t.description}" render_styling></converse-texture></p>${e.get("subject")?(e=>{const t=e.get("subject"),n=C_("Topic"),s=C_("Topic author");return wh`<p class="room-info"><strong>${n}:</strong><converse-texture text="${t.text}" render_styling></converse-texture></p><p class="room-info"><strong>${s}:</strong> ${t&&t.author}</p>`})(e):""}<p class="room-info"><strong>${S}:</strong> ${s}</p><p class="room-info"><strong>${c}:</strong></p><div class="chatroom-features"><ul class="features-list">${n.passwordprotected?wh`<li class="feature"><converse-icon size="1em" class="fa fa-lock"></converse-icon>${E} - <em>${$}</em></li>`:""} ${n.unsecured?wh`<li class="feature"><converse-icon size="1em" class="fa fa-unlock"></converse-icon>${v} - <em>${p}</em></li>`:""} ${n.hidden?wh`<li class="feature"><converse-icon size="1em" class="fa fa-eye-slash"></converse-icon>${l} - <em>${d}</em></li>`:""} ${n.public_room?wh`<li class="feature"><converse-icon size="1em" class="fa fa-eye"></converse-icon>${k} - <em>${T}</em></li>`:""} ${n.membersonly?wh`<li class="feature"><converse-icon size="1em" class="fa fa-address-book"></converse-icon>${h} - <em>${u}</em></li>`:""} ${n.open?wh`<li class="feature"><converse-icon size="1em" class="fa fa-globe"></converse-icon>${A} - <em>${x}</em></li>`:""} ${n.persistent?wh`<li class="feature"><converse-icon size="1em" class="fa fa-save"></converse-icon>${j} - <em>${C}</em></li>`:""} ${n.temporary?wh`<li class="feature"><converse-icon size="1em" class="fa fa-snowflake"></converse-icon>${M} - <em>${I}</em></li>`:""} ${n.nonanonymous?wh`<li class="feature"><converse-icon size="1em" class="fa fa-id-card"></converse-icon>${b} - <em>${y}</em></li>`:""} ${n.semianonymous?wh`<li class="feature"><converse-icon size="1em" class="fa fa-user-secret"></converse-icon>${O} - <em>${N}</em></li>`:""} ${n.moderated?wh`<li class="feature"><converse-icon size="1em" class="fa fa-gavel"></converse-icon>${f} - <em>${m}</em></li>`:""} ${n.unmoderated?wh`<li class="feature"><converse-icon size="1em" class="fa fa-info-circle"></converse-icon>${_} - <em>${w}</em></li>`:""} ${n.mam_enabled?wh`<li class="feature"><converse-icon size="1em" class="fa fa-database"></converse-icon>${r} - <em>${o}</em></li>`:""}</ul></div><p></p></div>`};var TN=n(8011),ON={};ON.styleTagTransform=L(),ON.setAttributes=I(),ON.insert=N().bind(null,"head"),ON.domAPI=T(),ON.insertStyleElement=D();C()(TN.A,ON);TN.A&&TN.A.locals&&TN.A.locals;ad.elements.define("converse-muc-details-modal",class extends aE{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"change",(()=>this.requestUpdate()))}renderModal(){return kN(this.model)}getModalTitle(){return C_("Groupchat info")}});ad.elements.define("converse-muc-nickname-modal",class extends aE{renderModal(){return wh`<converse-muc-nickname-form jid="${this.model.get("jid")}"></converse-muc-nickname-form>`}getModalTitle(){return C_("Change your nickname")}});var NN=n(1742),MN={};MN.styleTagTransform=L(),MN.setAttributes=I(),MN.insert=N().bind(null,"head"),MN.domAPI=T(),MN.insertStyleElement=D();C()(NN.A,MN);NN.A&&NN.A.locals&&NN.A.locals;customElements.define("converse-texture",class extends Bh{static get properties(){return{embed_audio:{type:Boolean},embed_videos:{type:Boolean},mentions:{type:Array},nick:{type:String},offset:{type:Number},onImgClick:{type:Function},onImgLoad:{type:Function},render_styling:{type:Boolean},show_images:{type:Boolean},hide_media_urls:{type:Boolean},show_me_message:{type:Boolean},text:{type:String}}}createRenderRoot(){return this}constructor(){super(),this.nick=null,this.onImgClick=null,this.onImgLoad=null,this.text=null,this.embed_audio=!1,this.embed_videos=!1,this.hide_media_urls=!1,this.mentions=[],this.offset=0,this.render_styling=!1,this.show_image_urls=!0,this.show_images=!1,this.show_me_message=!1}render(){const e={embed_audio:this.embed_audio,embed_videos:this.embed_videos,hide_media_urls:this.hide_media_urls,mentions:this.mentions,nick:this.nick,onImgClick:this.onImgClick,onImgLoad:this.onImgLoad,render_styling:this.render_styling,show_images:this.show_images,show_me_message:this.show_me_message};return lk(this.text,this.offset,e)}});var IN=n(8185),RN={};RN.styleTagTransform=L(),RN.setAttributes=I(),RN.insert=N().bind(null,"head"),RN.domAPI=T(),RN.insertStyleElement=D();C()(IN.A,RN);IN.A&&IN.A.locals&&IN.A.locals;ad.elements.define("converse-muc-heading",class extends O_{async initialize(){const{chatboxes:e}=uo.state;this.model=e.get(this.getAttribute("jid")),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.user_settings=await uo.api.user.settings.getModel(),this.listenTo(this.user_settings,"change:mucs_with_hidden_subject",(()=>this.requestUpdate())),await this.model.initialized;const t=this.model.occupants.findOccupant({jid:uo.session.get("bare_jid")});t&&this.updateIfOwnOccupant(t),this.listenTo(this.model.occupants,"add",this.updateIfOwnOccupant),this.listenTo(this.model.occupants,"change:affiliation",this.updateIfOwnOccupant),this.listenTo(this.model.occupants,"change:role",this.updateIfOwnOccupant),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.model&&this.user_settings?(e=>{const t=e.model.toJSON(),n=e.user_settings?.get("mucs_with_hidden_subject",[])?.includes(e.model.get("jid")),s=e.getHeadingButtons(n),i=C_("Hide the groupchat topic"),r=t.subject?t.subject.text:"",o=r&&!n;return wh`<div class="chatbox-title ${o?"":"chatbox-title--no-desc"}"><a data-room-jid="${e.model.get("jid")}" title="${C_("Show more information on this groupchat")}" @click="${t=>e.showRoomDetailsModal(t)}"><converse-avatar .model="${e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a><div class="chatbox-title--row">${uo.api.settings.get("singleton")?"":wh`<converse-controlbox-navback jid="${t.jid}"></converse-controlbox-navback>`}<div class="chatbox-title__text" role="heading" aria-level="2" title="${"hidden"!==ad.settings.get("locked_muc_domain")?t.jid:""}">${e.model.getDisplayName()}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${Q_(bC(s),"")} ${Q_(yC(s),"")}</div></div>${o?wh`<p class="chat-head__desc" title="${i}"><converse-texture text="${r}" render_styling embed_audio></converse-texture></p>`:""}`})(this):""}updateIfOwnOccupant(e){const t=uo.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}showRoomDetailsModal(e){e.preventDefault(),ad.modal.show("converse-muc-details-modal",{model:this.model},e)}showNicknameModal(e){e.preventDefault(),ad.modal.show("converse-muc-nickname-modal",{model:this.model},e)}toggleTopic(e){e?.preventDefault?.(),this.model.toggleSubjectHiddenState()}toggleOccupants(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.save({hidden_occupants:!this.model.get("hidden_occupants")})}showConfigModal(e){e.preventDefault(),ad.modal.show("converse-muc-config-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}destroy(e){e.preventDefault(),Ij(this.model)}getHeadingButtons(e){const t=[];t.push({i18n_text:C_("Details"),i18n_title:C_("Show more information about this groupchat"),handler:e=>this.showRoomDetailsModal(e),a_class:"show-muc-details-modal",icon_class:"fa-info-circle",name:"details"}),"owner"===this.model.getOwnAffiliation()&&t.push({i18n_text:C_("Configure"),i18n_title:C_("Configure this groupchat"),handler:e=>this.showConfigModal(e),a_class:"configure-chatroom-button",icon_class:"fa-wrench",name:"configure"}),t.push({i18n_text:C_("Nickname"),i18n_title:C_("Change the nickname you're using in this groupchat"),handler:e=>this.showNicknameModal(e),a_class:"open-nickname-modal",icon_class:"fa-smile",name:"nickname"});const n=this.model.get("subject");n&&n.text&&t.push({i18n_text:C_(e?"Show topic":"Hide topic"),i18n_title:C_(e?"Show the topic message in the heading":"Hide the topic in the heading"),handler:e=>this.toggleTopic(e),a_class:"hide-topic",icon_class:"fa-minus-square",name:"toggle-topic"}),t.push({i18n_text:this.model.get("hidden_occupants")?C_("Show participants"):C_("Hide participants"),i18n_title:this.model.get("hidden_occupants")?C_("Show the groupchat participants"):C_("Hide the groupchat participants"),handler:e=>this.toggleOccupants(e),icon_class:"fa-users"});if(this.model.session.get("connection_status")===Lf.ROOMSTATUS.ENTERED){const e=this.model.getAllowedCommands();e.includes("modtools")&&t.push({i18n_text:C_("Moderate"),i18n_title:C_("Moderate this groupchat"),handler:()=>Pj(this.model),a_class:"moderate-chatroom-button",icon_class:"fa-user-cog",name:"moderate"}),e.includes("destroy")&&t.push({i18n_text:C_("Destroy"),i18n_title:C_("Remove this groupchat"),handler:e=>this.destroy(e),a_class:"destroy-chatroom-button",icon_class:"fa-trash",name:"destroy"})}ad.settings.get("singleton")||t.push({i18n_text:C_("Leave"),i18n_title:C_("Leave and close this groupchat"),handler:async e=>{e.stopPropagation();const t=[C_("Are you sure you want to leave this groupchat?")];await ad.confirm(C_("Confirm"),t)&&this.close(e)},a_class:"close-chatbox-button",standalone:"overlayed"===ad.settings.get("view_mode"),icon_class:"fa-sign-out-alt",name:"signout"});const{chatboxviews:s}=uo.state,i=s.get(this.getAttribute("jid"));return i?uo.api.hook("getHeadingButtons",i,t):Promise.resolve(t)}});class DN extends O_{static get properties(){return{jid:{type:String}}}constructor(){super(),this.jid=null}connectedCallback(){super.connectedCallback();const{chatboxes:e}=uo.state;this.model=e.get(this.jid),this.listenTo(this.model,"change:password_validation_message",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=C_("This groupchat requires a password"),n=C_("Password: "),s=C_("Submit");return wh`<form class="converse-form chatroom-form converse-centered-form" @submit="${e.submitPassword}"><fieldset><label class="form-label">${t}</label><p class="validation-message">${e.validation_message}</p><input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.jid}"><input type="password" name="password" required="required" class="form-control ${e.validation_message?"error":""}" placeholder="${n}"></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${s}"></fieldset></form>`})({jid:this.model.get("jid"),submitPassword:e=>this.submitPassword(e),validation_message:this.model.get("password_validation_message")})}submitPassword(e){e.preventDefault();const t=this.querySelector("input[type=password]").value;this.model.join(this.model.get("nick"),t),this.model.set("password_validation_message",null)}}ad.elements.define("converse-muc-password-form",DN);class zN extends AT{length=300;is_chatroom=!0;async initialize(){this.model=await ad.rooms.get(this.jid),uo.state.chatboxviews.add(this.jid,this),this.setAttribute("id",this.model.get("box_id")),this.listenTo(this.model.session,"change:connection_status",this.onConnectionStatusChanged),this.listenTo(this.model.session,"change:view",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),this.onConnectionStatusChanged(),this.model.maybeShow(),ad.trigger("chatRoomViewInitialized",this)}render(){return e=this,wh`<div class="flyout box-flyout">${"overlayed"===ad.settings.get("view_mode")?wh`<converse-dragresize></converse-dragresize>`:""} ${e.model?wh`<converse-muc-heading jid="${e.model.get("jid")}" class="chat-head chat-head-chatroom row g-0"></converse-muc-heading><div class="chat-body chatroom-body row g-0">${Rj(e.model)}</div>`:""}</div>`;var e}onConnectionStatusChanged(){this.model.session.get("connection_status")===Lf.ROOMSTATUS.CONNECTING&&(this.model.session.save({disconnection_actor:void 0,disconnection_message:void 0,disconnection_reason:void 0}),this.model.save({moved_jid:void 0,password_validation_message:void 0,reason:void 0})),this.requestUpdate()}}ad.elements.define("converse-muc",zN);var LN=n(4659),PN={};PN.styleTagTransform=L(),PN.setAttributes=I(),PN.insert=N().bind(null,"head"),PN.domAPI=T(),PN.insertStyleElement=D();C()(LN.A,PN);LN.A&&LN.A.locals&&LN.A.locals;const{Strophe:UN}=Lf.env,{CHATROOMS_TYPE:BN}=__;Lf.MUC.VIEWS={CONFIG:"config-form"},Lf.plugins.add("converse-muc-views",{dependencies:["converse-modal","converse-controlbox","converse-chatview"],initialize(){const{_converse:e}=this;ad.settings.extend({auto_list_rooms:!1,cache_muc_messages:!0,locked_muc_nickname:!1,modtools_disable_query:[],muc_disable_slash_commands:!1,muc_mention_autocomplete_filter:"contains",muc_mention_autocomplete_min_chars:0,muc_mention_autocomplete_show_avatar:!0,muc_roomid_policy:null,muc_roomid_policy_hint:null,muc_search_service:"api@search.jabber.network",roomconfig_whitelist:[],show_retraction_warning:!0});const t={ChatRoomView:zN,MUCView:zN};Object.assign(e,t),Object.assign(e.exports,t),ad.settings.get("muc_domain")||ad.listen.on("serviceDiscovered",(async e=>{if(e?.get("var")===UN.NS.MUC){if(e.entity.get("jid").includes("@"))return;await e.entity.getIdentity("conference","text")&&ad.settings.set("muc_domain",UN.getDomainFromJid(e.get("from")))}})),ad.listen.on("clearsession",(()=>{const t=e.chatboxviews.get("controlbox");t&&t.roomspanel&&(t.roomspanel.model.destroy(),t.roomspanel.remove(),delete t.roomspanel)})),ad.listen.on("chatBoxClosed",(e=>{var t;e.get("type")===BN&&(t=e.get("jid"),location.hash===`converse/room?jid=${t}`&&history.pushState(null,"",window.location.pathname))})),ad.listen.on("parseMessageForCommands",Uj),ad.listen.on("confirmDirectMUCInvitation",Mj)}});class qN extends ie.Model{defaults(){return{collapsed:!1}}}const FN=qN,{dayjs:HN}=Lf.env,{ACTIVE:GN}=__;function WN(e){e.on("change:hidden",(()=>function(e){e.get("hidden")?function(e){ad.trigger("chatBoxMinimized",e)}(e):function(e){e.isScrolledUp()||e.clearUnreadMsgCounter();e.setChatState(GN),ad.trigger("chatBoxMaximized",e)}(e)}(e))),"controlbox"!==e.get("id")&&e.save({hidden:!!e.get("hidden"),time_minimized:e.get("time_minimized")})}function VN(e){if("controlbox"===e.model.get("id")){if(Rf.isVisible(e))return Rf.getOuterWidth(e,!0);{const e=document.querySelector("converse-controlbox-toggle");return e?Rf.getOuterWidth(e,!0):0}}return!e.model.get("hidden")&&Rf.isVisible(e)?Rf.getOuterWidth(e,!0):0}function KN(){const e=document.querySelector("converse-minimized-chats");return uo.state.chatboxes.pluck("hidden").includes(!0)?Rf.getOuterWidth(e,!0):0}function JN(e){const t=e?e.model.get("id"):null,n=e?Rf.getOuterWidth(e,!0):0;return Object.values(uo.state.chatboxviews.xget(t)).reduce(((e,t)=>e+VN(t)),n)}function YN(e){if(ad.settings.get("no_trimming")||"overlayed"!==ad.settings.get("view_mode"))return;const t=uo.state.chatboxviews.filter((e=>!e.model.get("hidden")&&!e.model.get("closed")&&Rf.isVisible(e)));if(t.length<=1)return;const n=Rf.getOuterWidth(document.querySelector("body"),!0);if(VN(t[0])===n)return;if(document.querySelector("converse-minimized-chats"))for(;KN()+JN(e)>n;){const t=XN([e?e.model.get("id"):null]);if(!t)break;{const e=uo.state.chatboxes.get(t.get("id"));e?.save("hidden",!0),ZN(t)}}}function XN(e){e.push("controlbox");let t=0,n=uo.state.chatboxes.sort().at(t);for(;e.includes(n.get("id"))||!0===n.get("hidden");)if(t++,n=uo.state.chatboxes.at(t),!n)return null;return n}function QN(e,t){e?.preventDefault?e.preventDefault():t=e,Rf.safeSave(t,{hidden:!1,time_opened:(new Date).getTime()})}function ZN(e,t){e?.preventDefault?e.preventDefault():t=e,Rf.safeSave(t,{hidden:!0,time_minimized:(new Date).toISOString()})}ad.elements.define("converse-minimized-chats",class extends O_{async initialize(){this.model=uo.state.chatboxes,await this.initToggle(),this.listenTo(this.minchats,"change:collapsed",(()=>this.requestUpdate())),this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"change:fullname",(()=>this.requestUpdate())),this.listenTo(this.model,"change:jid",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>this.requestUpdate())),this.listenTo(this.model,"change:name",(()=>this.requestUpdate())),this.listenTo(this.model,"change:num_unread",(()=>this.requestUpdate())),this.listenTo(this.model,"remove",(()=>this.requestUpdate())),this.listenTo(uo,"connected",(()=>this.requestUpdate())),this.listenTo(uo,"reconnected",(()=>this.requestUpdate())),this.listenTo(uo,"disconnected",(()=>this.requestUpdate()))}render(){return(e=>{const t=e.model.where({hidden:!0}),n=t.reduce(((e,t)=>e+t.get("num_unread")),0),s=t.reduce(((e,t)=>e+(t.get("hidden")?1:0)),0),i=e.minchats.get("collapsed");return wh`<div id="minimized-chats" class="${t.length?"":"hidden"}"><button type="button" class="btn btn-primary" @click="${t=>e.toggle(t)}">${s} ${C_("hidden")} <span class="badge bg-secondary unread-message-count ${n?"":"hidden"}">${n}</span></button><div class="flyout minimized-chats-flyout row g-0 ${i?"hidden":""}">${t.map((e=>wh`<converse-minimized-chat .model="${e}" title="${e.getDisplayName()}" type="${e.get("type")}" num_unread="${e.get("num_unread")}"></converse-minimized-chat>`))}</div></div>`})(this)}async initToggle(){const e=`converse.minchatstoggle-${uo.session.get("bare_jid")}`;this.minchats=new FN({id:e}),Rf.initStorage(this.minchats,e,"session"),await new Promise((e=>this.minchats.fetch({success:e,error:e})))}toggle(e){e?.preventDefault(),this.minchats.save({collapsed:!this.minchats.get("collapsed")})}});ad.elements.define("converse-minimized-chat",class extends O_{static get properties(){return{model:{type:Object},title:{type:String},type:{type:String},num_unread:{type:Number}}}constructor(){super(),this.model=null,this.num_unread=null,this.type=null,this.title=null}render(){return(e=>{const t=C_("Click to restore this chat");let n;return n="chatroom"===e.type?"var(--muc-color)":"headline"===e.type?"var(--headlines-color)":"var(--chat-color)",wh`<div class="chat-head-${e.type} chat-head row g-0"><a class="col-10 restore-chat align-self-center" title="${t}" @click="${t=>e.restore(t)}">${e.num_unread?wh`<span class="message-count badge badge-light">${e.num_unread}</span>`:""} ${e.title} </a><a class="col-2 pl-1" @click="${t=>e.close(t)}"><converse-icon color="${n}" class="fas fa-times" @click="${t=>e.close(t)}" size="1em"></converse-icon></a></div>`})(this)}close(e){e?.preventDefault(),this.model.close()}restore(e){e?.preventDefault(),QN(this.model)}});var eM=n(3195),tM={};tM.styleTagTransform=L(),tM.setAttributes=I(),tM.insert=N().bind(null,"head"),tM.domAPI=T(),tM.insertStyleElement=D();C()(eM.A,tM);eM.A&&eM.A.locals&&eM.A.locals;const{CHATROOMS_TYPE:nM}=__;Lf.plugins.add("converse-minimize",{dependencies:["converse-chatview","converse-controlbox","converse-muc-views","converse-headlines-view","converse-dragresize"],enabled:e=>"overlayed"===e.api.settings.get("view_mode"),initialize(){ad.settings.extend({no_trimming:!1}),ad.promises.add("minimizedChatsInitialized");const e={MinimizedChatsToggle:FN};Object.assign(uo,e),Object.assign(uo.exports,e),Object.assign(uo,{minimize:{trimChats:YN,minimize:ZN,maximize:QN}}),Object.assign(uo.exports,{minimize:{trimChats:YN,minimize:ZN,maximize:QN}}),Object.assign(Rf,{trimChats:YN,minimize:ZN,maximize:QN}),ad.listen.on("chatBoxViewInitialized",(e=>YN(e))),ad.listen.on("chatRoomViewInitialized",(e=>YN(e))),ad.listen.on("controlBoxOpened",(e=>YN(e))),ad.listen.on("chatBoxInitialized",WN),ad.listen.on("chatRoomInitialized",WN),ad.listen.on("getHeadingButtons",((e,t)=>e.model.get("type")===nM?function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>ZN(t,e.model),i18n_text:C_("Minimize"),i18n_title:C_("Minimize this groupchat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===uo.api.settings.get("view_mode")},s=t.map((e=>e.name)),i=s.indexOf("signout");return i>-1?[...t.slice(0,i),n,...t.slice(i)]:[n,...t]}(e,t):function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>ZN(t,e.model),i18n_text:C_("Minimize"),i18n_title:C_("Minimize this chat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===uo.api.settings.get("view_mode")},s=t.map((e=>e.name)),i=s.indexOf("close");return i>-1?[...t.slice(0,i),n,...t.slice(i)]:[n,...t]}(e,t)));const t=$o((()=>YN()),250);ad.listen.on("registeredGlobalEventHandlers",(()=>window.addEventListener("resize",t))),ad.listen.on("unregisteredGlobalEventHandlers",(()=>window.removeEventListener("resize",t)))}});var sM=n(1425),iM=n.n(sM);const{Strophe:rM,u:oM}=Lf.env,{isEmptyMessage:aM,isTestEnv:cM}=oM,lM="Notification"in window;let dM;function uM(e){return cM()||(uo.state.chatboxes.get(e)?.isHidden()??!1)||document.hidden}function hM(){return cM()||lM&&ad.settings.get("show_desktop_notifications")&&"granted"===Notification.permission}function fM(){dM?.badge(0),dM=null,navigator.clearAppBadge?.().catch((e=>Y.error("Could not clear unread count in app badge "+e)))}function mM(){if(ad.settings.get("show_tab_notifications")){dM=dM??new Lf.env.Favico({type:"circle",animation:"pop"});const e=uo.state.chatboxes.models.reduce(((e,t)=>e+(t.get("num_unread")||0)),0);dM.badge(e),navigator.setAppBadge?.(e).catch((e=>Y.error("Could set unread count in app badge - "+e)))}}function gM(e,t,n){const s=uo.session.get("bare_jid");return e.reduce(((e,i)=>e||i.uri&&(e=>[s,`${t}/${n}`].includes(e.uri.replace(/^xmpp:/,"")))(i)),!1)}function pM(e){const{attrs:t}=e;if(!t||t.is_forwarded)return!1;if("groupchat"===t.type)return async function(e){if(!e?.body&&!e?.message)return!1;const t=e.from,n=e.from_muc,s=ad.settings.get("notify_all_room_messages"),i=uo.state.chatboxes.get(n),r=rM.getResourceFromJid(t),o=r&&rM.unescapeNode(r)||"";let a=!1;const c=i.get("nick");ad.settings.get("notify_nicknames_without_references")&&(a=new RegExp(`\\b${c}\\b`).test(e.body));const l=o!==c,d=!0===s||Array.isArray(s)&&s.includes(n)||gM(e.references,n,c)||a;if(l&&d)return await ad.hook("shouldNotifyOfGroupMessage",e,!0);return!1}(t);if("info"===t.type)return async function(e){if(!e.from_muc)return!1;const t=await ad.rooms.get(e.from_muc);if(!t)return!1;const n=t.get("nick"),s=e.from_muc,i=ad.settings.get("notify_all_room_messages");return!0===i||Array.isArray(i)&&i.includes(s)||gM(e.references,s,n)}(t);if(t.is_headline)return uM(t);const n=uo.session.get("bare_jid"),s=rM.getBareJidFromJid(t.from)===n;return!aM(t)&&!s&&("all"===ad.settings.get("show_desktop_notifications")||uM(t))}async function vM(e){if(!await pM(e))return!1;ad.trigger("messageNotification",e);try{!function(){if(ad.settings.get("play_sounds")&&void 0!==window.Audio){const e=new Audio(ad.settings.get("sounds_path")+"msg_received.ogg"),t=e.canPlayType("audio/ogg");if("probably"===t)return e.play();const n=new Audio(ad.settings.get("sounds_path")+"msg_received.mp3"),s=n.canPlayType("audio/mp3");"probably"===s?n.play():"maybe"===t?e.play():"maybe"===s&&n.play()}}()}catch(e){Y.error(e)}!function(e){const{attrs:t}=e;if(t.is_error)return;if(!hM())return;let n,s;const i=t.from,r=rM.getBareJidFromJid(i);if("info"==t.type)n=t.message;else if("headline"===t.type){if(r.includes("@")&&!ad.settings.get("allow_non_roster_messaging"))return;n=C_("Notification from %1$s",r)}else if(r.includes("@"))if("groupchat"===t.type)n=C_("%1$s says",rM.getResourceFromJid(i));else{if(void 0===uo.state.roster)return void Y.error("Could not send notification, because roster is undefined");if(s=uo.state.roster.get(r),void 0!==s)n=C_("%1$s says",s.getDisplayName());else{if(!ad.settings.get("allow_non_roster_messaging"))return;n=C_("%1$s says",r)}}else n=C_("Notification from %1$s",r);let o;if("info"==t.type)o=t.reason;else if(o=t.is_encrypted?t.plaintext:t.body,!o)return;const a=new Notification(n,{body:o,lang:j_.getLocale(),icon:ad.settings.get("notification_icon"),requireInteraction:!ad.settings.get("notification_delay")});ad.settings.get("notification_delay")&&setTimeout((()=>a.close()),ad.settings.get("notification_delay")),a.onclick=function(e){e.preventDefault(),window.focus(),uo.state.chatboxes.get(r).maybeShow(!0)}}(e)}function bM(e){hM()&&function(e){if("error"===e.klass||"warn"===e.klass){const t=new Notification(e.subject,{body:e.message,lang:j_.getLocale(),icon:ad.settings.get("notification_icon")});setTimeout(t.close.bind(t),5e3)}}(e)}function yM(e){hM()&&ad.settings.get("show_chat_state_notifications")&&function(e){if(ad.settings.get("chatstate_notification_blacklist")?.includes(e.get("jid")))return;const t=e.presence.get("show");let n=null;if("offline"===t?n=C_("has gone offline"):"away"===t?n=C_("has gone away"):"dnd"===t?n=C_("is busy"):"online"===t&&(n=C_("has come online")),null===n)return;const s=new Notification(e.getDisplayName(),{body:n,lang:j_.getLocale(),icon:ad.settings.get("notification_icon")});setTimeout((()=>s.close()),5e3)}(e)}function _M(e){hM()&&function(e){const t=new Notification(e.getDisplayName(),{body:C_("wants to be your contact"),lang:j_.getLocale(),icon:ad.settings.get("notification_icon")});setTimeout((()=>t.close()),5e3)}(e)}function wM(){lM&&!["denied","granted"].includes(Notification.permission)&&Notification.requestPermission()}Lf.env.Favico=iM(),Lf.plugins.add("converse-notification",{dependencies:["converse-chatboxes"],initialize(){ad.settings.extend({chatstate_notification_blacklist:[],notification_delay:5e3,notification_icon:"/images/logo/conversejs-filled.svg",notify_all_room_messages:!1,notify_nicknames_without_references:!1,play_sounds:!0,show_chat_state_notifications:!1,show_desktop_notifications:!0,show_tab_notifications:!0,sounds_path:ad.settings.get("assets_path")+"/sounds/"}),ad.listen.on("clearSession",fM),ad.waitUntil("chatBoxesInitialized").then((()=>{const{chatboxes:e}=uo.state;e.on("change:num_unread",mM)})),ad.listen.on("pluginsInitialized",(function(){ad.listen.on("contactRequest",_M),ad.listen.on("contactPresenceChanged",yM),ad.listen.on("message",vM),ad.listen.on("feedback",bM),ad.listen.on("connected",wM)}))}});var SM=n(3546),AM={};AM.styleTagTransform=L(),AM.setAttributes=I(),AM.insert=N().bind(null,"head"),AM.domAPI=T(),AM.insertStyleElement=D();C()(SM.A,AM);SM.A&&SM.A.locals&&SM.A.locals;const xM=Lf.env.utils;ad.elements.define("converse-chat-status-modal",class extends aE{initialize(){super.initialize(),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>{this.querySelector('input[name="status_message"]').focus()}),!1)}renderModal(){return(e=>{const t=C_("Away"),n=C_("Busy"),s=C_("Online"),i=C_("Save"),r=C_("Away for long"),o=C_("Personal status message"),a=e.model.get("show")||e.model.get("presence"),c=e.model.get("status_message");return wh`<form class="converse-form set-xmpp-status" id="set-xmpp-status" @submit="${t=>e.onFormSubmitted(t)}"><div class="mb-3"><div class="form-check"><input ?checked="${"online"===a}" type="radio" id="radio-online" value="online" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-online"><converse-icon size="1em" class="fa fa-circle chat-status chat-status--online"></converse-icon>${s}</label></div><div class="form-check"><input ?checked="${"busy"===a}" type="radio" id="radio-busy" value="dnd" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-busy"><converse-icon size="1em" class="fa fa-minus-circle chat-status chat-status--busy"></converse-icon>${n}</label></div><div class="form-check"><input ?checked="${"away"===a}" type="radio" id="radio-away" value="away" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-away"><converse-icon size="1em" class="fa fa-circle chat-status chat-status--away"></converse-icon>${t}</label></div><div class="form-check"><input ?checked="${"xa"===a}" type="radio" id="radio-xa" value="xa" name="chat_status" class="form-check-input"> <label class="form-check-label" for="radio-xa"><converse-icon size="1em" class="far fa-circle chat-status chat-status--xa"></converse-icon>${r}</label></div></div><div class="mb-3"><div class="input-group"><input name="status_message" type="text" class="form-control" autofocus value="${c||""}" placeholder="${o}"> <button type="button" class="btn btn-outline-secondary" @click="${t=>e.clearStatusMessage(t)}" title="${C_("Clear status message")}"><converse-icon size="1em" class="fa fa-times"></converse-icon></button></div></div><button type="submit" class="btn btn-primary">${i}</button></form>`})(this)}getModalTitle(){return C_("Change chat status")}clearStatusMessage(e){e&&e.preventDefault&&(e.preventDefault(),xM.hideElement(this.querySelector(".clear-input")));this.querySelector('input[name="status_message"]').value=""}onFormSubmitted(e){e.preventDefault();const t=new FormData(e.target);let n,s;const i=t.get("chat_status");"online"===i?s="online":n=i,this.model.save({status_message:t.get("status_message"),presence:s,show:n}),this.close()}});const{Strophe:$M,$iq:EM,sizzle:jM,u:CM}=Lf.env;ad.elements.define("converse-change-password-form",class extends O_{static get properties(){return{passwords_mismatched:{type:Boolean},alert_message:{type:String}}}initialize(){this.passwords_mismatched=!1,this.alert_message=""}render(){return(e=>{const t=C_("Submit"),n=C_("The new passwords must match"),s=C_("New password"),i=C_("Confirm new password");return wh`<form class="converse-form passwordreset-form" method="POST" @submit="${t=>e.onSubmit(t)}">${e.alert_message?wh`<div class="alert alert-danger" role="alert">${e.alert_message}</div>`:""}<div class="py-2"><label for="converse_password_reset_new" class="form-label">${s}</label> <input class="form-control ${e.passwords_mismatched?"error":""}" type="password" name="password" required="required" id="converse_password_reset_new" autocomplete="new-password" minlength="8" ?disabled="${e.alert_message}"></div><div class="py-2"><label for="converse_password_reset_check" class="form-label">${i}</label> <input class="form-control ${e.passwords_mismatched?"error":""}" type="password" name="password_check" required="required" id="converse_password_reset_check" autocomplete="new-password" minlength="8" ?disabled="${e.alert_message}" @input="${t=>e.checkPasswordsMatch(t)}"> ${e.passwords_mismatched?wh`<span class="error">${n}</span>`:""}</div><input class="save-form btn btn-primary" type="submit" value="${t}" ?disabled="${e.alert_message}"></form>`})(this)}checkPasswordsMatch(e){const t=new FormData(e.target.form??e.target),n=t.get("password"),s=t.get("password_check");return this.passwords_mismatched=n&&n!==s,this.passwords_mismatched}async onSubmit(e){if(e.preventDefault(),this.checkPasswordsMatch(e))return;const t=uo.session.get("domain"),n=EM({type:"get",to:t}).c("query",{xmlns:$M.NS.REGISTER}),s=await ad.sendIQ(n);if(null===s)return void(this.alert_message=C_("Timeout error"));if(jM(`error service-unavailable[xmlns="${$M.NS.STANZAS}"]`,s).length)return void(this.alert_message=C_("Your server does not support password reset"));if(CM.isErrorStanza(s))return this.alert_message=C_("Your server responded with an unknown error, check the console for details"),Y.error("Could not set password"),void Y.error(s);const i=s.querySelector("username").textContent,r=new FormData(e.target).get("password"),o=EM({type:"set",to:t}).c("query",{xmlns:$M.NS.REGISTER}).c("username",{},i).c("password",{},r),a=await ad.sendIQ(o);null===a?this.alert_message=C_("Timeout error while trying to set your password"):jM(`error not-allowed[xmlns="${$M.NS.STANZAS}"]`,a).length?this.alert_message=C_("Your server does not allow password reset"):jM(`error forbidden[xmlns="${$M.NS.STANZAS}"]`,a).length||CM.isErrorStanza(a)?this.alert_message=C_("You are not allowed to change your password"):ad.alert("info",C_("Success"),[C_("Your new password has been set")])}});const kM=e=>{const t={...e.model.toJSON(),...e.model.vcard?.toJSON()},n=C_("Email"),s=C_("Full Name"),i=C_("XMPP Address"),r=C_("Nickname"),o=C_("Role"),a=C_("Save and close"),c=C_("Use commas to separate multiple roles. Your roles are shown next to your name on your chat messages."),l=C_("URL"),d=C_("OMEMO"),u=C_("Profile"),h=C_("Reset Password"),f=new Map;return f.set("profile",wh`<li role="presentation" class="nav-item"><a class="nav-link ${"profile"===e.tab?"active":""}" id="profile-tab" href="#profile-tabpanel" aria-controls="profile-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="profile" data-toggle="tab">${u}</a></li>`),function(){const e=uo.api.connection.get()._sasl_mechanism;return"EXTERNAL"!==e.mechname&&"ANONYMOUS"!==e.mechname&&"X-OAUTH2"!==e.mechname&&"OAUTHBEARER"!==e.mechname}()&&f.set("passwordreset",wh`<li role="presentation" class="nav-item"><a class="nav-link ${"passwordreset"===e.tab?"active":""}" id="passwordreset-tab" href="#passwordreset-tabpanel" aria-controls="passwordreset-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="passwordreset" data-toggle="tab">${h}</a></li>`),uo.pluggable.plugins["converse-omemo"]?.enabled(uo)&&f.set("omemo",wh`<li role="presentation" class="nav-item"><a class="nav-link ${"omemo"===e.tab?"active":""}" id="omemo-tab" href="#omemo-tabpanel" aria-controls="omemo-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="omemo" data-toggle="tab">${d}</a></li>`),wh`${f.size?wh`<ul class="nav nav-pills justify-content-center">${Array.from(f.values())}</ul>`:""}<div class="tab-content"><div class="tab-pane ${"profile"===e.tab?"active":""}" id="profile-tabpanel" role="tabpanel" aria-labelledby="profile-tab"><form class="converse-form converse-form--modal" action="#" @submit="${t=>e.onFormSubmitted(t)}"><div class="row py-2"><div class="col-auto"><converse-image-picker .model="${e.model}" width="128" height="128"></converse-image-picker></div><div class="col"><div class="px-3"><label class="col-form-label">${i}:</label><div>${t.jid}</div></div></div></div><div><label for="vcard-fullname" class="col-form-label">${s}:</label> <input id="vcard-fullname" type="text" class="form-control" name="fn" value="${t.fullname||""}"></div><div><label for="vcard-nickname" class="col-form-label">${r}:</label> <input id="vcard-nickname" type="text" class="form-control" name="nickname" value="${t.nickname||""}"></div><div><label for="vcard-url" class="col-form-label">${l}:</label> <input id="vcard-url" type="url" class="form-control" name="url" value="${t.url||""}"></div><div><label for="vcard-email" class="col-form-label">${n}:</label> <input id="vcard-email" type="email" class="form-control" name="email" value="${t.email||""}"></div><div><label for="vcard-role" class="col-form-label">${o}:</label> <input id="vcard-role" type="text" class="form-control" name="role" value="${t.role||""}" aria-describedby="vcard-role-help"> <small id="vcard-role-help" class="form-text text-muted">${c}</small></div><hr><div>${e._submitting?wh`<converse-spinner></converse-spinner>`:wh`<button type="submit" class="save-form btn btn-primary">${a}</button>`}</div></form></div>${f.get("passwordreset")?wh`<div class="tab-pane ${"passwordreset"===e.tab?"active":""}" id="passwordreset-tabpanel" role="tabpanel" aria-labelledby="passwordreset-tab">${"passwordreset"===e.tab?wh`<converse-change-password-form></converse-change-password-form>`:""}</div>`:""} ${f.get("omemo")?function(e){return wh`<div class="tab-pane ${"omemo"===e.tab?"active":""}" id="omemo-tabpanel" role="tabpanel" aria-labelledby="omemo-tab">${"omemo"===e.tab?wh`<converse-omemo-profile></converse-omemo-profile>`:""}</div>`}(e):""}</div>`};var TM=n(7808),OM={};OM.styleTagTransform=L(),OM.setAttributes=I(),OM.insert=N().bind(null,"head"),OM.domAPI=T(),OM.insertStyleElement=D();C()(TM.A,OM);TM.A&&TM.A.locals&&TM.A.locals;class NM extends aE{static properties={_submitting:{state:!0},model:{type:ie.Model}};constructor(e){super(e),this.tab="profile"}initialize(){super.initialize(),this.listenTo(this.model,"change",this.render),ad.trigger("profileModalInitialized",this.model)}renderModal(){return kM(this)}getModalTitle(){return C_("Your Profile")}async setVCard(e){const t=uo.session.get("bare_jid");try{await ad.vcard.set(t,e)}catch(e){return Y.fatal(e),this.alert([C_("Sorry, an error happened while trying to save your profile data."),C_("You can check your browser's developer console for any error output.")].join(" ")),!1}return!0}async onFormSubmitted(e){e.preventDefault(),this._submitting=!0;const t=new FormData(e.target),n=t.get("avatar_image"),s={fn:t.get("fn"),nickname:t.get("nickname"),role:t.get("role"),email:t.get("email"),url:t.get("url")};if(n?.size){const e=await m$(n),t=new FileReader;t.onloadend=async()=>{Object.assign(s,{image:btoa(t.result),image_type:n.type}),await this.setVCard(s)&&(this._submitting=!1,this.modal.hide())},t.readAsBinaryString(e)}else Object.assign(s,{image:this.model.vcard.get("image"),image_type:this.model.vcard.get("image_type")}),await this.setVCard(s)&&(this.modal.hide(),ad.toast.show("vcard-updated",{type:"success",body:C_("Profile updated successfully")})),this._submitting=!1}}ad.elements.define("converse-profile-modal",NM);const MM=e=>{const t=C_("%1$s Open Source %2$s XMPP chat client brought to you by %3$s Opkode %2$s",'<a target="_blank" rel="nofollow" href="https://conversejs.org">',"</a>",'<a target="_blank" rel="nofollow" href="https://opkode.com">'),n=C_("%1$s Translate %2$s it into your own language",'<a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">',"</a>"),s=ad.settings.get("show_client_info"),i=ad.settings.get("allow_adhoc_commands");return wh`${s&&i?(e=>{const t=C_("About"),n=C_("Commands");return wh`<ul class="nav nav-pills justify-content-center"><li role="presentation" class="nav-item"><a class="nav-link ${"about"===e.tab?"active":""}" id="about-tab" href="#about-tabpanel" aria-controls="about-tabpanel" role="tab" data-toggle="tab" data-name="about" @click="${t=>e.switchTab(t)}">${t}</a></li><li role="presentation" class="nav-item"><a class="nav-link ${"commands"===e.tab?"active":""}" id="commands-tab" href="#commands-tabpanel" aria-controls="commands-tabpanel" role="tab" data-toggle="tab" data-name="commands" @click="${t=>e.switchTab(t)}">${n}</a></li></ul>`})(e):""}<div class="tab-content">${s?wh`<div class="tab-pane tab-pane--columns ${"about"===e.tab?"active":""}" id="about-tabpanel" role="tabpanel" aria-labelledby="about-tab"><span class="modal-alert"></span><br><div class="container"><h6 class="brand-heading">Converse</h6><p class="brand-subtitle">${uo.VERSION_NAME}</p><p class="brand-subtitle">${Vk(hu.sanitize(t))}</p><p class="brand-subtitle">${Vk(hu.sanitize(n))}</p></div></div>`:""} ${i?wh`<div class="tab-pane tab-pane--columns ${"commands"===e.tab?"active":""}" id="commands-tabpanel" role="tabpanel" aria-labelledby="commands-tab"><converse-adhoc-commands></div>`:""}</div>`};ad.elements.define("converse-user-settings-modal",class extends aE{constructor(e){super(e);const t=ad.settings.get("show_client_info"),n=ad.settings.get("allow_adhoc_commands");t&&n||t?this.tab="about":n&&(this.tab="commands")}renderModal(){return MM(this)}getModalTitle(){return C_("Settings")}});const IM=e=>{const t=e.model.get("show"),n=e.model.get("presence")||"online",s=t||n,i=e.model.get("status_message")||C_("I am %1$s","chat"===(r=s)?C_("online"):"dnd"===r?C_("busy"):"xa"===r?C_("away for long"):"away"===r?C_("away"):"offline"===r?C_("offline"):C_(r)||C_("online"));var r;const o=C_("Click to change your chat status");let a,c;return[a,c]="chat"===t||!t&&"online"===n?["fa fa-circle chat-status","chat-status-online"]:"dnd"===t?["fa fa-minus-circle chat-status","chat-status-busy"]:"away"===t||"xa"===t?["fa fa-circle chat-status","chat-status-away"]:["fa fa-circle chat-status","comment"],wh`<div class="userinfo"><div class="controlbox-section profile d-flex"><a class="show-profile" href="#" @click="${e.showProfileModal}"><converse-avatar class="avatar align-self-center" .model="${e.model}" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a><span class="username w-100 align-self-center" role="heading" aria-level="2">${e.model.getDisplayName()}</span><converse-controlbox-buttons></converse-controlbox-buttons></div><div class="d-flex xmpp-status"><a class="change-status" title="${o}" data-toggle="modal" data-target="#changeStatusModal" @click="${e.showStatusChangeModal}"><span class="${s} w-100" data-value="${s}"><converse-icon color="var(--${c})" css="margin-top: -0.1em" size="0.82em" class="${a}"></converse-icon><span class="xmpp-status__msg">${i}</span></span></a></div></div>`};var RM=n(9845),DM={};DM.styleTagTransform=L(),DM.setAttributes=I(),DM.insert=N().bind(null,"head"),DM.domAPI=T(),DM.insertStyleElement=D();C()(RM.A,DM);RM.A&&RM.A.locals&&RM.A.locals;class zM extends O_{initialize(){this.model=uo.state.profile,this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate()))}render(){return IM(this)}showProfileModal(e){e?.preventDefault(),ad.modal.show("converse-profile-modal",{model:this.model},e)}showStatusChangeModal(e){e?.preventDefault(),ad.modal.show("converse-chat-status-modal",{model:this.model},e)}}ad.elements.define("converse-user-profile",zM);Lf.plugins.add("converse-profile",{dependencies:["converse-status","converse-modal","converse-vcard","converse-chatboxviews","converse-adhoc-views"],initialize(){ad.settings.extend({show_client_info:!0})}});const LM={name:"AES-GCM",length:128};class PM extends Error{constructor(e,t){super(e),this.name="IQError",this.iq=t}}class UM extends Error{constructor(e){super(e),this.name="UserFacingError",this.user_facing=!0}}const{Strophe:BM,stx:qM,sizzle:FM}=Lf.env;class HM extends ie.Model{get idAttribute(){return"jid"}async initialize(){super.initialize(),this.initialized=re(),await this.initDevices(),this.initialized.resolve()}initDevices(){this.devices=new uo.exports.Devices;const e=`converse.devicelist-${uo.session.get("bare_jid")}-${this.get("jid")}`;return Rf.initStorage(this.devices,e),this.fetchDevices()}async onDevicesFound(e){if(0===e.length){let e=[];try{e=await this.fetchDevicesFromServer()}catch(e){null===e?(Y.error(`Timeout error while fetching OMEMO devices for ${this.get("jid")}`),this.destroy()):Rf.isElement(e)&&await Wf(e)instanceof $l?Y.debug(`No OMEMO devices found for ${this.get("jid")}`):(Y.error(`Could not fetch OMEMO devices for ${this.get("jid")}`),Y.error(e),this.destroy())}const t=uo.session.get("bare_jid");this.get("jid")===t&&this.publishCurrentDevice(e)}}fetchDevices(){return void 0===this._devices_promise&&(this._devices_promise=new Promise((e=>{this.devices.fetch({success:t=>e(this.onDevicesFound(t)),error:(t,n)=>{Y.error(n),e()}})}))),this._devices_promise}async getOwnDeviceId(){const{omemo_store:e}=uo.state;let t=e.get("device_id");return this.devices.get(t)||(await e.generateBundle(),t=e.get("device_id")),t}async publishCurrentDevice(e){const t=uo.session.get("bare_jid");if(this.get("jid")===t){if(await ad.omemo.session.restore(),uo.state.omemo_store)return e.includes(await this.getOwnDeviceId())?void 0:this.publishDevices();Y.debug("publishCurrentDevice: omemo_store is not defined, likely a timing issue")}}async fetchDevicesFromServer(){const e=uo.session.get("bare_jid"),t=qM`
            <iq type='get' from='${e}' to='${this.get("jid")}' xmlns="jabber:client">
                <pubsub xmlns='${BM.NS.PUBSUB}'>
                    <items node='${BM.NS.OMEMO_DEVICELIST}'/>
                </pubsub>
            </iq>`,n=await ad.sendIQ(t),s=`list[xmlns="${BM.NS.OMEMO}"] device`,i=FM(s,n).map((e=>e.getAttribute("id"))),r=this.get("jid");return Promise.all(i.map((e=>this.devices.create({id:e,jid:r},{promise:!0}))))}publishDevices(){const e=qM`
            <item id='current'>
                <list xmlns='${BM.NS.OMEMO}'>
                    ${this.devices.filter((e=>e.get("active"))).map((e=>qM`<device id='${e.get("id")}'/>`))}
                </list>
            </item>`;return ad.pubsub.publish(null,BM.NS.OMEMO_DEVICELIST,e,{access_model:"open"},!1)}async removeOwnDevices(e){const t=uo.session.get("bare_jid");if(this.get("jid")!==t)throw new Error("Cannot remove devices from someone else's device list");return await Promise.all(e.map((e=>this.devices.get(e))).map((e=>new Promise((t=>e.destroy({success:t,error:(e,n)=>{Y.error(n),t()}})))))),this.publishDevices()}}const GM=HM;class WM extends ie.Collection{constructor(){super(),this.model=GM}}const VM=WM,{Strophe:KM,sizzle:JM,stx:YM}=Lf.env,{CHATROOMS_TYPE:XM,PRIVATE_CHAT_TYPE:QM}=__,{appendArrayBuffer:ZM,arrayBufferToBase64:eI,arrayBufferToHex:tI,arrayBufferToString:nI,base64ToArrayBuffer:sI,hexToArrayBuffer:iI,initStorage:rI,isAudioURL:oI,isError:aI,isImageURL:cI,isVideoURL:lI,stringToArrayBuffer:dI}=Rf;function uI(e){e=e.replace(/^05/,"");for(let t=1;t<8;t++){const n=8*t+t-1;e=e.slice(0,n)+" "+e.slice(n)}return e}async function hI(e){return(await jI(e)).length>0}function fI(e,t){return e.get("omemo_active")&&t.body?{...t,is_encrypted:!0,plaintext:t.body,body:C_("This is an OMEMO encrypted message which your client doesnât seem to support. Find more information on https://conversations.im/omemo")}:t}async function mI(e){const t=new URL(e),n="localhost"===window.location.hostname&&"localhost"===t.hostname?"http":"https",s=t.toString().replace(/^aesgcm/,n),i=await async function(e){let t;try{t=await fetch(e)}catch(t){return Y.error(`${t.name}: Failed to download encrypted media: ${e}`),Y.error(t),null}if(t.status>=200&&t.status<400)return t.arrayBuffer()}(s);if(null===i)return Y.error(`Could not decrypt a received encrypted file ${t.toString()} since it could not be downloaded`),new Error(C_("Error: could not decrypt a received encrypted file, because it could not be downloaded"));const r=t.hash.slice(1),o=r.substring(r.length-64),a=r.replace(o,"");let c;try{c=await async function(e,t,n){const s=await crypto.subtle.importKey("raw",iI(t),"AES-GCM",!1,["decrypt"]),i={name:"AES-GCM",iv:iI(e)};return crypto.subtle.decrypt(i,s,n)}(a,o,i)}catch(e){return Y.error(`Could not decrypt file ${t.toString()}`),Y.error(e),null}const[l,d]=t.pathname.split("/").pop().split("."),u=h$[d];try{const e=new File([c],l,{type:u});return URL.createObjectURL(e)}catch(e){return Y.error(`Could not decrypt file ${t.toString()}`),Y.error(e),null}}function gI(e,t,n){return aI(t)?wh`<p class="error">${t.message}</p>`:cI(e)?BC({src:t,onClick:n.onImgClick,onLoad:n.onImgLoad}):oI(e)?MC(t):lI(e)?qC(t):((e,t)=>{const n=C_('Download file "%1$s"',t);return wh`<a target="_blank" rel="noopener" href="${e}">${n}</a>`})(t,yw(e))}function pI(e){uo.state.config.get("trusted")&&e.addAnnotations(((t,n)=>function(e,t,n){const s=[];try{const t={start:/\b(aesgcm:\/\/)/gi};Rf.withinString(e,((e,t,n)=>(s.push({url:e,start:t,end:n}),e)),t)}catch(e){return void Y.debug(e)}s.forEach((e=>{const s=mI(e.url).then((t=>gI(e.url,t,n))),i=wh`${Q_(s,"")}`;n.addTemplateResult(e.start+t,e.end+t,i)}))}(t,n,e)))}async function vI(e,t){if(ad.settings.get("clear_cache_on_logout")||!t.is_encrypted||t.encryption_namespace!==KM.NS.OMEMO)return t;const n=JM(`encrypted[xmlns="${KM.NS.OMEMO}"]`,e).pop(),s=n.querySelector("header");t.encrypted={device_id:s.getAttribute("sid")};const i=await(ad.omemo?.getDeviceID()),r=i&&JM(`key[rid="${i}"]`,n).pop();return r?(Object.assign(t.encrypted,{iv:s.querySelector("iv").textContent,key:r.textContent,payload:n.querySelector("payload")?.textContent||null,prekey:["true","1"].includes(r.getAttribute("prekey"))}),!0===t.encrypted.prekey?async function(e){const t=wI(e),n=_I(t,parseInt(e.encrypted.device_id,10)),s=sI(e.encrypted.key);let i;try{i=await n.decryptPreKeyWhisperMessage(s,"binary")}catch(t){return Y.error(`${t.name} ${t.message}`),Object.assign(e,AI(t))}try{const t=await SI(e,i),{omemo_store:n}=uo.state;return await n.generateMissingPreKeys(),await n.publishBundle(),t?Object.assign(e,{plaintext:t}):Object.assign(e,{is_only_key:!0})}catch(t){return Y.error(`${t.name} ${t.message}`),Object.assign(e,AI(t))}}(t):async function(e){const t=wI(e),n=_I(t,parseInt(e.encrypted.device_id,10)),s=sI(e.encrypted.key);try{const t=await n.decryptWhisperMessage(s,"binary"),i=await SI(e,t);return Object.assign(e,{plaintext:i})}catch(t){return Y.error(`${t.name} ${t.message}`),Object.assign(e,AI(t))}}(t)):Object.assign(t,{error_condition:"not-encrypted-for-this-device",error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"})}function bI(){uo.state.chatboxes.on("add",(e=>{NI(e),e.get("type")===XM&&(e.occupants.on("add",(t=>async function(e,t){if(t.isSelf()||!e.features.get("nonanonymous")||!e.features.get("membersonly"))return;if(e.get("omemo_active")){await hI(t.get("jid"))||(e.createMessage({message:C_("%1$s doesn't appear to have a client that supports OMEMO. Encrypted chat will no longer be possible in this grouchat.",t.get("nick")),type:"error"}),e.save({omemo_active:!1,omemo_supported:!1}))}}(e,t))),e.features.on("change",(()=>NI(e))))}))}function yI(e){e.listenTo(e.model.messages,"add",(t=>{t.get("is_encrypted")&&!t.get("is_error")&&e.model.save("omemo_supported",!0)})),e.listenTo(e.model,"change:omemo_supported",(()=>{!e.model.get("omemo_supported")&&e.model.get("omemo_active")?e.model.set("omemo_active",!1):e.querySelector("converse-chat-toolbar")?.requestUpdate()})),e.listenTo(e.model,"change:omemo_active",(()=>{e.querySelector("converse-chat-toolbar").requestUpdate()}))}function _I(e,t){const{libsignal:n}=window,s=new n.SignalProtocolAddress(e,t);return new n.SessionCipher(uo.state.omemo_store,s)}function wI(e){let t;if(t="me"===e.sender?uo.session.get("bare_jid"):e.contact_jid?e.contact_jid:"from_real_jid"in e?e.from_real_jid:e.from,!t)throw Object.assign(e,{error_text:C_("Sorry, could not decrypt a received OMEMO message because we don't have the XMPP address for that user."),error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}),new Error("Could not find JID to decrypt OMEMO message for");return t}async function SI(e,t){const n=wI(e),s=await ad.omemo.devicelists.get(n,!0),i=e.encrypted;let r=s.devices.get(i.device_id);if(r||(r=await s.devices.create({id:i.device_id,jid:n},{promise:!0})),i.payload){const e=t.slice(0,16),n=t.slice(16),s=await DI.decryptMessage(Object.assign(i,{key:e,tag:n}));return r.save("active",!0),s}}function AI(e){return{error_text:C_("Sorry, could not decrypt a received OMEMO message due to an error.")+` ${e.name} ${e.message}`,error_condition:e.name,error_message:e.message,error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}}function xI(e){const t=e.querySelector("signedPreKeyPublic"),n=e.querySelector("signedPreKeySignature"),s=JM("prekeys > preKeyPublic",e).map((e=>({id:parseInt(e.getAttribute("preKeyId"),10),key:e.textContent})));return{identity_key:e.querySelector("identityKey").textContent.trim(),signed_prekey:{id:parseInt(t.getAttribute("signedPreKeyId"),10),public_key:t.textContent,signature:n.textContent},prekeys:s}}async function $I(e){const t=await jI(e);return Promise.all(t.map((e=>EI(e))))}async function EI(e){if(e.get("bundle")?.fingerprint)return;const t=await e.getBundle();t.fingerprint=tI(sI(t.identity_key)),e.save("bundle",t),e.trigger("change:bundle")}async function jI(e){await ad.waitUntil("OMEMOInitialized");const t=await ad.omemo.devicelists.get(e,!0);return await t.fetchDevices(),t.devices}async function CI(e){if(!e.get("bundle"))return Y.error(`Could not build an OMEMO session for device ${e.get("id")} because we don't have its bundle`),null;const{libsignal:t}=window,n=new t.SignalProtocolAddress(e.get("jid"),e.get("id")),s=await uo.state.omemo_store.loadSession(n.toString());if(s)return s;try{return await async function(e){const{libsignal:t}=window,n=new t.SignalProtocolAddress(e.get("jid"),e.get("id")),s=new t.SessionBuilder(uo.state.omemo_store,n),i=e.getRandomPreKey(),r=await e.getBundle();return s.processPreKey({registrationId:parseInt(e.get("id"),10),identityKey:sI(r.identity_key),signedPreKey:{keyId:r.signed_prekey.id,publicKey:sI(r.signed_prekey.public_key),signature:sI(r.signed_prekey.signature)},preKey:{keyId:i.id,publicKey:sI(i.key)}})}(e)}catch(t){return Y.error(`Could not build an OMEMO session for device ${e.get("id")}`),Y.error(t),null}}async function kI(e){try{JM(`event[xmlns="${KM.NS.PUBSUB}#event"]`,e).length&&(await ad.waitUntil("OMEMOInitialized"),await async function(e){const t=JM(`items[node="${KM.NS.OMEMO_DEVICELIST}"]`,e).pop();if(!t)return;const n=`item list[xmlns="${KM.NS.OMEMO}"] device`,s=JM(n,t).map((e=>e.getAttribute("id"))),i=e.getAttribute("from"),r=await ad.omemo.devicelists.get(i,!0),o=r.devices,a=o.pluck("id").filter((e=>!s.includes(e))),c=uo.session.get("bare_jid");a.forEach((e=>{i===c&&e===uo.state.omemo_store.get("device_id")||o.get(e).save("active",!1)})),s.forEach((e=>{const t=o.get(e);t?t.save("active",!0):o.create({id:e,jid:i})})),Rf.isSameBareJID(c,i)&&r.publishCurrentDevice(s)}(e),await async function(e){const t=JM("items",e).pop();if(!t||!t.getAttribute("node").startsWith(KM.NS.OMEMO_BUNDLES))return;const n=t.getAttribute("node").split(":")[1],s=e.getAttribute("from"),i=JM("item > bundle",t).pop(),r=await ad.omemo.devicelists.get(s,!0);(r.devices.get(n)||r.devices.create({id:n,jid:s})).save({bundle:xI(i)})}(e))}catch(e){Y.error(e)}}function TI(){ad.connection.get().addHandler((e=>(kI(e),!0)),null,"message","headline")}async function OI(e){if(!e)if(uo.state.config.get("trusted")&&!ad.settings.get("clear_cache_on_logout")){try{await async function(){const e=uo.session.get("bare_jid");uo.state.devicelists=new VM;const t=`converse.devicelists-${e}`;rI(uo.state.devicelists,t),await new Promise((e=>{uo.state.devicelists.fetch({success:e,error:(t,n)=>{Y.error(n),e()}})})),await ad.omemo.devicelists.get(e,!0)}(),await ad.omemo.session.restore(),await uo.state.omemo_store.publishBundle()}catch(e){return Y.error("Could not initialize OMEMO support"),void Y.error(e)}ad.trigger("OMEMOInitialized")}else Y.warn("Not initializing OMEMO, since this browser is not trusted or clear_cache_on_logout is set to true")}async function NI(e){let t;e.get("type")===XM?(await ad.waitUntil("OMEMOInitialized"),t=e.features.get("nonanonymous")&&e.features.get("membersonly")):e.get("type")===QM&&(t=await hI(e.get("jid"))),e.set("omemo_supported",!!t),t&&ad.settings.get("omemo_default")&&e.set("omemo_active",!0)}function MI(e){e.stopPropagation(),e.preventDefault();const t=Rf.ancestor(e.target,"converse-chat-toolbar");if(!t.model.get("omemo_supported")){let e;return e=t.model.get("type")===XM?[C_("Cannot use end-to-end encryption in this groupchat, either the groupchat has some anonymity or not all participants support OMEMO.")]:[C_("Cannot use end-to-end encryption because %1$s uses a client that doesn't support OMEMO.",t.model.contact.getDisplayName())],ad.alert("error",C_("Error"),e)}t.model.save({omemo_active:!t.model.get("omemo_active")})}function II(e,t){const n=e.model,s=n.get("type")===XM;let i,r;if(n.get("omemo_supported")){const e=C_("Messages are being sent in plaintext"),t=C_("Messages are sent encrypted");i=n.get("omemo_active")?t:e}else i=C_(s?"This groupchat needs to be members-only and non-anonymous in order to support OMEMO encrypted messages":"OMEMO encryption is not supported");return r=n.get("omemo_supported")?n.get("omemo_active")?s?"var(--muc-color)":"var(--chat-color)":"var(--error-color)":"var(--disabled-color)",t.push(wh`<button type="button" class="btn toggle-omemo" title="${i}" data-disabled="${!n.get("omemo_supported")}" @click="${MI}"><converse-icon class="fa ${n.get("omemo_active")?"fa-lock":"fa-unlock"}" path-prefix="${ad.settings.get("assets_path")}" size="1em" color="${r}"></converse-icon></button>`),t}async function RI(e,t){let{stanza:n}=t;const{message:s}=t;if(!s.get("is_encrypted"))return t;if(!s.get("body"))throw new Error("No message body to encrypt!");const i=await async function(e){const t=C_("Sorry, no devices found to which we can send an OMEMO encrypted message.");let n;if(e instanceof jp){const t=await Promise.all(e.occupants.map((e=>jI(e.get("jid")))));n=t.reduce(((e,t)=>e.concat(t.models)),[])}else if(e.get("type")===QM){const s=await jI(e.get("jid"));if(0===s.length)throw new UM(t);const i=uo.session.get("bare_jid"),r=(await ad.omemo.devicelists.get(i)).devices;n=[...r.models,...s.models]}const s=uo.state.omemo_store.get("device_id");n=n.filter((e=>e.get("id")!==s)),await Promise.all(n.map((e=>e.getBundle())));const i=n.filter((e=>e)).map((e=>CI(e)));if(await Promise.all(i),i.includes(null)&&(n=n.filter((e=>i[n.indexOf(e)])),0===n.length))throw new UM(t);return n}(e),{key_and_tag:r,iv:o,payload:a}=await DI.encryptMessage(s.get("plaintext")),c=await Promise.all(i.filter((e=>-1!=e.get("trusted")&&e.get("active"))).map((e=>function(e,t){return _I(t.get("jid"),t.get("id")).encrypt(e).then((e=>({payload:e,device:t})))}(r,e))));return n.cnode(YM`
            <encrypted xmlns="${KM.NS.OMEMO}">
                <header sid="${uo.state.omemo_store.get("device_id")}">
                    ${c.map((({payload:e,device:t})=>3==parseInt(e.type,10)?YM`<key rid="${t.get("id")}" prekey="true">${btoa(e.body)}</key>`:YM`<key rid="${t.get("id")}">${btoa(e.body)}</key>`))}
                    <iv>${o}</iv>
                </header>
                <payload>${a}</payload>
            </encrypted>`).root(),n.cnode(YM`<store xmlns="${KM.NS.HINTS}"/>`).root(),n.cnode(YM`<encryption xmlns="${KM.NS.EME}" namespace="${KM.NS.OMEMO}"/>`).root(),{message:s,stanza:n}}const DI={decryptMessage:async function(e){const t=await crypto.subtle.importKey("raw",e.key,LM,!0,["encrypt","decrypt"]),n=ZM(sI(e.payload),e.tag),s={name:"AES-GCM",iv:sI(e.iv),tagLength:128};return nI(await crypto.subtle.decrypt(s,t,n))},encryptMessage:async function(e){const t=crypto.getRandomValues(new window.Uint8Array(12)),n=await crypto.subtle.generateKey(LM,!0,["encrypt","decrypt"]),s={iv:t,name:"AES-GCM",tagLength:128},i=await crypto.subtle.encrypt(s,n,dI(e)),r=i.byteLength-16,o=i.slice(0,r),a=i.slice(r),c=await crypto.subtle.exportKey("raw",n);return{tag:a,key:c,key_and_tag:ZM(c,a),payload:eI(o),iv:eI(t)}},formatFingerprint:uI},{u:zI}=Lf.env,LI=e=>{const t=C_("OMEMO Fingerprints"),n=C_("No OMEMO-enabled devices found"),s=e.devicelist.devices;return wh`<ul class="list-group fingerprints"><li class="list-group-item active">${t}</li>${s.length?s.map((t=>((e,t)=>{const n=C_("Trusted"),s=C_("Untrusted"),i=C_("Choose which devices you trust for OMEMO encrypted communication"),r=zI.getUniqueId(),o=zI.getUniqueId(),a=-1!==t.get("trusted");return t.get("bundle")&&t.get("bundle").fingerprint?wh`<li class="list-group-item"><form class="fingerprint-trust"><div class="btn-group btn-group-toggle" role="group" aria-label="${i}"><input type="radio" class="btn-check" name="${t.get("id")}" id="${r}" autocomplete="off" value="1" @click="${e.toggleDeviceTrust}" ?checked="${a}"> <label class="btn ${a?"btn-primary active":"btn-outline-secondary"}" for="${r}">${n}</label> <input type="radio" class="btn-check" name="${t.get("id")}" id="${o}" autocomplete="off" value="-1" @click="${e.toggleDeviceTrust}" ?checked="${!a}"> <label class="btn ${a?"btn-outline-secondary":"btn-primary active"}" for="${o}">${s}</label></div><code class="fingerprint">${uI(t.get("bundle").fingerprint)}</code></form></li>`:""})(e,t))):wh`<li class="list-group-item">${n}</li>`}</ul>`};ad.elements.define("converse-omemo-fingerprints",class extends O_{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}async initialize(){this.devicelist=await ad.omemo.devicelists.get(this.jid,!0),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"change:trusted",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.devicelist?LI(this):""}toggleDeviceTrust(e){const t=e.target;this.devicelist.devices.get(t.getAttribute("name")).save("trusted",parseInt(t.value,10))}});const PI=1,UI=0,BI=3,qI=2,FI=1,HI=2,GI=4,WI=8,VI=0,KI=1,JI=2,YI=3,XI=4,QI=5,ZI=6,eR=7,tR=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],nR=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],sR=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];class iR{constructor(e,t){if(null==e.length)throw new Error(e.length+"/"+t);let n=0;for(;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(let t=0;t<e.length-n;t++)this.num[t]=e[t+n]}get(e){return this.num[e]}getLength(){return this.num.length}multiply(e){let t=new Array(this.getLength()+e.getLength()-1);for(let n=0;n<this.getLength();n++)for(let s=0;s<e.getLength();s++)t[n+s]^=oR.gexp(oR.glog(this.get(n))+oR.glog(e.get(s)));return new iR(t,0)}mod(e){if(this.getLength()-e.getLength()<0)return this;let t=oR.glog(this.get(0))-oR.glog(e.get(0)),n=new Array(this.getLength());for(let e=0;e<this.getLength();e++)n[e]=this.get(e);for(let s=0;s<e.getLength();s++)n[s]^=oR.gexp(oR.glog(e.get(s))+t);return new iR(n,0).mod(e)}}const rR=iR,oR={glog:function(e){if(e<1)throw new Error("glog("+e+")");return oR.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return oR.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(let e=0;e<8;e++)oR.EXP_TABLE[e]=1<<e;for(let e=8;e<256;e++)oR.EXP_TABLE[e]=oR.EXP_TABLE[e-4]^oR.EXP_TABLE[e-5]^oR.EXP_TABLE[e-6]^oR.EXP_TABLE[e-8];for(let e=0;e<255;e++)oR.LOG_TABLE[oR.EXP_TABLE[e]]=e;function aR(e,t){let n=1,s=function(e){let t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e);for(let e=0,i=tR.length;e<=i;e++){let i=0;switch(t){case PI:i=tR[e][0];break;case UI:i=tR[e][1];break;case BI:i=tR[e][2];break;case qI:i=tR[e][3]}if(s<=i)break;n++}if(n>tR.length)throw new Error("Too long data");return n}const cR={G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo(e){let t=e<<10;for(;cR.getBCHDigit(t)-cR.getBCHDigit(cR.G15)>=0;)t^=cR.G15<<cR.getBCHDigit(t)-cR.getBCHDigit(cR.G15);return(e<<10|t)^cR.G15_MASK},getBCHTypeNumber(e){let t=e<<12;for(;cR.getBCHDigit(t)-cR.getBCHDigit(cR.G18)>=0;)t^=cR.G18<<cR.getBCHDigit(t)-cR.getBCHDigit(cR.G18);return e<<12|t},getBCHDigit(e){let t=0;for(;0!=e;)t++,e>>>=1;return t},getPatternPosition:e=>nR[e-1],getMask(e,t,n){switch(e){case VI:return(t+n)%2==0;case KI:return t%2==0;case JI:return n%3==0;case YI:return(t+n)%3==0;case XI:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case QI:return t*n%2+t*n%3==0;case ZI:return(t*n%2+t*n%3)%2==0;case eR:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial(e){let t=new rR([1],0);for(let n=0;n<e;n++)t=t.multiply(new rR([1,oR.gexp(n)],0));return t},getLengthInBits(e,t){if(1<=t&&t<10)switch(e){case FI:return 10;case HI:return 9;case GI:case WI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case FI:return 12;case HI:return 11;case GI:return 16;case WI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case FI:return 14;case HI:return 13;case GI:return 16;case WI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint(e){let t=e.getModuleCount(),n=0;for(let s=0;s<t;s++)for(let i=0;i<t;i++){let r=0,o=e.isDark(s,i);for(let n=-1;n<=1;n++)if(!(s+n<0||t<=s+n))for(let a=-1;a<=1;a++)i+a<0||t<=i+a||0==n&&0==a||o==e.isDark(s+n,i+a)&&r++;r>5&&(n+=3+r-5)}for(let s=0;s<t-1;s++)for(let i=0;i<t-1;i++){let t=0;e.isDark(s,i)&&t++,e.isDark(s+1,i)&&t++,e.isDark(s,i+1)&&t++,e.isDark(s+1,i+1)&&t++,0!=t&&4!=t||(n+=3)}for(let s=0;s<t;s++)for(let i=0;i<t-6;i++)e.isDark(s,i)&&!e.isDark(s,i+1)&&e.isDark(s,i+2)&&e.isDark(s,i+3)&&e.isDark(s,i+4)&&!e.isDark(s,i+5)&&e.isDark(s,i+6)&&(n+=40);for(let s=0;s<t;s++)for(let i=0;i<t-6;i++)e.isDark(i,s)&&!e.isDark(i+1,s)&&e.isDark(i+2,s)&&e.isDark(i+3,s)&&e.isDark(i+4,s)&&!e.isDark(i+5,s)&&e.isDark(i+6,s)&&(n+=40);let s=0;for(let n=0;n<t;n++)for(let i=0;i<t;i++)e.isDark(i,n)&&s++;return n+=10*(Math.abs(100*s/t/t-50)/5),n}};class lR{constructor(e,t){this.text=e,this.errorCorrectLevel=t,this.typeNumber=aR(this.text,this.errorCorrectLevel),this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[new dR(this.text)]}static get PAD0(){return 236}static get PAD1(){return 17}isDark(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}makeImpl(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(let e=0;e<this.moduleCount;e++){this.modules[e]=new Array(this.moduleCount);for(let t=0;t<this.moduleCount;t++)this.modules[e][t]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=lR.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)}setupPositionProbePattern(e,t){for(let n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(let s=-1;s<=7;s++)t+s<=-1||this.moduleCount<=t+s||(this.modules[e+n][t+s]=0<=n&&n<=6&&(0==s||6==s)||0<=s&&s<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=s&&s<=4)}getBestMaskPattern(){let e=0,t=0;for(let n=0;n<8;n++){this.makeImpl(!0,n);let s=cR.getLostPoint(this);(0==n||e>s)&&(e=s,t=n)}return t}setupTimingPattern(){for(let e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(let e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)}setupPositionAdjustPattern(){let e=cR.getPatternPosition(this.typeNumber);for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++){let s=e[t],i=e[n];if(null==this.modules[s][i])for(let e=-2;e<=2;e++)for(let t=-2;t<=2;t++)this.modules[s+e][i+t]=-2==e||2==e||-2==t||2==t||0==e&&0==t}}setupTypeNumber(e){let t=cR.getBCHTypeNumber(this.typeNumber);for(let n=0;n<18;n++){let s=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=s}for(let n=0;n<18;n++){let s=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=s}}setupTypeInfo(e,t){const n=this.errorCorrectLevel<<3|t,s=cR.getBCHTypeInfo(n);for(let t=0;t<15;t++){let n=!e&&1==(s>>t&1);t<6?this.modules[t][8]=n:t<8?this.modules[t+1][8]=n:this.modules[this.moduleCount-15+t][8]=n}for(let t=0;t<15;t++){let n=!e&&1==(s>>t&1);t<8?this.modules[8][this.moduleCount-t-1]=n:t<9?this.modules[8][15-t-1+1]=n:this.modules[8][15-t-1]=n}this.modules[this.moduleCount-8][8]=!e}mapData(e,t){let n=-1,s=this.moduleCount-1,i=7,r=0;for(let o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(let n=0;n<2;n++)if(null==this.modules[s][o-n]){let a=!1;r<e.length&&(a=1==(e[r]>>>i&1)),cR.getMask(t,s,o-n)&&(a=!a),this.modules[s][o-n]=a,i--,-1==i&&(r++,i=7)}if(s+=n,s<0||this.moduleCount<=s){s-=n,n=-n;break}}}static createData(e,t,n){let s=uR.getRSBlocks(e,t);const i=new hR;for(let t=0;t<n.length;t++){let s=n[t];i.put(s.mode,4),i.put(s.getLength(),cR.getLengthInBits(s.mode,e)),s.write(i)}let r=0;for(let e=0;e<s.length;e++)r+=s[e].dataCount;if(i.getLengthInBits()>8*r)throw new Error("code length overflow. ("+i.getLengthInBits()+">"+8*r+")");for(i.getLengthInBits()+4<=8*r&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(!1);for(;!(i.getLengthInBits()>=8*r||(i.put(lR.PAD0,8),i.getLengthInBits()>=8*r));)i.put(lR.PAD1,8);return lR.createBytes(i,s)}static createBytes(e,t){let n=0,s=0,i=0,r=new Array(t.length),o=new Array(t.length);for(let a=0;a<t.length;a++){let c=t[a].dataCount,l=t[a].totalCount-c;s=Math.max(s,c),i=Math.max(i,l),r[a]=new Array(c);for(let t=0;t<r[a].length;t++)r[a][t]=255&e.buffer[t+n];n+=c;let d=cR.getErrorCorrectPolynomial(l),u=new rR(r[a],d.getLength()-1).mod(d);o[a]=new Array(d.getLength()-1);for(let e=0;e<o[a].length;e++){let t=e+u.getLength()-o[a].length;o[a][e]=t>=0?u.get(t):0}}let a=0;for(let e=0;e<t.length;e++)a+=t[e].totalCount;let c=new Array(a),l=0;for(let e=0;e<s;e++)for(let n=0;n<t.length;n++)e<r[n].length&&(c[l++]=r[n][e]);for(let e=0;e<i;e++)for(let n=0;n<t.length;n++)e<o[n].length&&(c[l++]=o[n][e]);return c}}class dR{constructor(e){this.mode=GI,this.data=e,this.parsedData=[];for(let e=0,t=this.data.length;e<t;e++){let t=[],n=this.data.charCodeAt(e);n>65536?(t[0]=240|(1835008&n)>>>18,t[1]=128|(258048&n)>>>12,t[2]=128|(4032&n)>>>6,t[3]=128|63&n):n>2048?(t[0]=224|(61440&n)>>>12,t[1]=128|(4032&n)>>>6,t[2]=128|63&n):n>128?(t[0]=192|(1984&n)>>>6,t[1]=128|63&n):t[0]=n,this.parsedData.push(t)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}getLength(){return this.parsedData.length}write(e){for(let t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}}class uR{constructor(e,t){this.totalCount=e,this.dataCount=t}static getRSBlocks(e,t){let n=uR.getRsBlockTable(e,t);if(null==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);let s=n.length/3,i=[];for(let e=0;e<s;e++){let t=n[3*e+0],s=n[3*e+1],r=n[3*e+2];for(let e=0;e<t;e++)i.push(new uR(s,r))}return i}static getRsBlockTable(e,t){switch(t){case PI:return sR[4*(e-1)+0];case UI:return sR[4*(e-1)+1];case BI:return sR[4*(e-1)+2];case qI:return sR[4*(e-1)+3];default:return}}}class hR{constructor(){this.buffer=[],this.length=0}get(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)}put(e,t){for(let n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))}getLengthInBits(){return this.length}putBit(e){let t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}}var fR=n(5909),mR={};mR.styleTagTransform=L(),mR.setAttributes=I(),mR.insert=N().bind(null,"head"),mR.domAPI=T(),mR.insertStyleElement=D();C()(fR.A,mR);fR.A&&fR.A.locals&&fR.A.locals;class gR extends O_{static get properties(){return{text:{type:String},width:{type:String},height:{type:String}}}#f;constructor(){super(),this.#f=null,this.text=null,this.width="200px",this.height="200px",this.colorDark="#000000",this.colorLight="#ffffff",this.correctLevel=qI}render(){const e=this.#f.getModuleCount(),t=[];for(let n=0;n<e;n++)for(let s=0;s<e;s++)this.#f.isDark(n,s)&&t.push(Sh`<use x="${n}" y="${s}" href="#template"></use>`);return Sh`<svg viewBox="0 0 ${e} ${e}" width="${this.width}" height="${this.height}" fill="${this.colorLight}"><rect fill="${this.colorLight}" width="100%" height="100%"></rect><rect fill="${this.colorDark}" width="1" height="1" id="template"></rect>${t}</svg>`}shouldUpdate(e){return!this.#f||e.has("text")||e.has("correctLevel")?(this.title=this.text,this.#f=new lR(this.text,this.correctLevel),this.#f.make(),super.shouldUpdate(e)||!0):super.shouldUpdate(e)}}ad.elements.define("converse-qr-code",gR);function pR(e){return wh`${e.get("bundle")&&e.get("bundle").fingerprint?function(e){const t=C_("Checkbox for selecting the following fingerprint");return wh`<li class="fingerprint-removal-item list-group-item"><label class="form-label"><input type="checkbox" value="${e.get("id")}" aria-label="${t}"> <span class="fingerprint">${uI(e.get("bundle").fingerprint)}</span></label></li>`}(e):function(e){const t=C_("Device without a fingerprint"),n=C_("Checkbox for selecting the following device");return wh`<li class="fingerprint-removal-item list-group-item"><label class="form-label"><input type="checkbox" value="${e.get("id")}" aria-label="${n}"> <span>${t}</span></label></li>`}(e)}`}const vR=e=>{const t=C_("This device's OMEMO fingerprint"),n=C_("Generate new keys and fingerprint"),s=e?.current_device?.get("bundle").fingerprint;return wh`<form class="converse-form fingerprint-removal" @submit="${e.removeSelectedFingerprints}"><ul class="list-group fingerprints"><li class="list-group-item active">${t}</li><li class="list-group-item">${s?function(e){return wh`<span class="fingerprint">${uI(e.current_device.get("bundle").fingerprint)}</span>`}(e):Xx()}</li><li class="list-group-item p-4">${s?wh`<converse-qr-code class="centered" text="${function(e){const t=uo.state.omemo_store.get("device_id");return`xmpp:${uo.session.get("bare_jid")}?omemo-sid-${t}=${e=e.replace(/^05/,"")}`}(s)}"></converse-qr-code>`:""}</li></ul><div class="pb-3"><button type="button" class="generate-bundle btn btn-danger" @click="${e.generateOMEMODeviceBundle}">${n}</button></div>${e.other_devices?.length?function(e){const t=C_("Other OMEMO-enabled devices"),n=C_("Checkbox to select fingerprints of all other OMEMO devices"),s=C_("Remove checked devices and close"),i=C_("Select all");return wh`<ul class="list-group fingerprints"><li class="list-group-item active"><label class="form-label"><input type="checkbox" class="select-all" @change="${e.selectAll}" title="${i}" aria-label="${n}"> ${t}</label></li>${e.other_devices?.map((e=>pR(e)))}</ul><div><button type="submit" class="save-form btn btn-primary">${s}</button></div>`}(e):""}</form>`},{Strophe:bR,sizzle:yR,u:_R}=Lf.env;ad.elements.define("converse-omemo-profile",class extends O_{async initialize(){const e=uo.session.get("bare_jid");this.devicelist=await ad.omemo.devicelists.get(e,!0),await this.setAttributes(),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.requestUpdate()}async setAttributes(){this.device_id=await ad.omemo.getDeviceID(),this.current_device=this.devicelist.devices.get(this.device_id),this.other_devices=this.devicelist.devices.filter((e=>e.get("id")!==this.device_id))}render(){return this.devicelist?vR(this):Xx()}selectAll(e){let t=_R.ancestor(e.target,"li");for(;t;)t.querySelector('input[type="checkbox"]').checked=e.target.checked,t=t.nextElementSibling}async removeSelectedFingerprints(e){e.preventDefault(),e.stopPropagation(),e.target.querySelector(".select-all").checked=!1;const t=yR('.fingerprint-removal-item input[type="checkbox"]:checked',e.target).map((e=>e.value));try{await this.devicelist.removeOwnDevices(t)}catch(e){Y.error(e),uo.api.alert(bR.LogLevel.ERROR,C_("Error"),[C_("Sorry, an error occurred while trying to remove the devices.")])}await this.setAttributes(),this.requestUpdate()}async generateOMEMODeviceBundle(e){e.preventDefault();await ad.confirm(C_("Confirm"),C_("Are you sure you want to generate new OMEMO keys? This will remove your old keys and all previously encrypted messages will no longer be decryptable on this device."))&&(await ad.omemo.bundle.generate(),await this.setAttributes(),this.requestUpdate())}});const{Strophe:wR,sizzle:SR,stx:AR}=Lf.env;class xR extends ie.Model{defaults(){return{trusted:0,active:!0}}getRandomPreKey(){const e=this.get("bundle");return e.prekeys[Rf.getRandomInt(e.prekeys.length)]}async fetchBundleFromServer(){const e=uo.session.get("bare_jid"),t=AR`
            <iq type="get" from="${e}" to="${this.get("jid")}" xmlns="jabber:client">
                <pubsub xmlns="${wR.NS.PUBSUB}">
                    <items node="${wR.NS.OMEMO_BUNDLES}:${this.get("id")}"/>
                </pubsub>
            </iq>`;let n;try{n=await ad.sendIQ(t)}catch(n){return Y.error(`Could not fetch bundle for device ${this.get("id")} from ${this.get("jid")}`),Y.error(n),null}if(n.querySelector("error"))throw new PM("Could not fetch bundle",n);const s=SR(`items[node="${wR.NS.OMEMO_BUNDLES}:${this.get("id")}"]`,n).pop(),i=xI(SR(`bundle[xmlns="${wR.NS.OMEMO}"]`,s).pop());return this.save("bundle",i),i}getBundle(){return this.get("bundle")?Promise.resolve(this.get("bundle")):this.fetchBundleFromServer()}}const $R=xR;class ER extends ie.Collection{constructor(){super(),this.model=$R}}const jR=ER,{Strophe:CR,stx:kR,u:TR}=Lf.env;class OR extends ie.Model{get Direction(){return{SENDING:1,RECEIVING:2}}getIdentityKeyPair(){const e=this.get("identity_keypair");return Promise.resolve({privKey:TR.base64ToArrayBuffer(e.privKey),pubKey:TR.base64ToArrayBuffer(e.pubKey)})}getLocalRegistrationId(){return Promise.resolve(parseInt(this.get("device_id"),10))}isTrustedIdentity(e,t,n){if(null==e)throw new Error("Can't check identity key for invalid key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identity_key to be an ArrayBuffer");const s=this.get("identity_key"+e);return void 0===s?Promise.resolve(!0):Promise.resolve(TR.arrayBufferToBase64(t)===s)}loadIdentityKey(e){if(null==e)throw new Error("Can't load identity_key for invalid identifier");return Promise.resolve(TR.base64ToArrayBuffer(this.get("identity_key"+e)))}saveIdentity(e,t){if(null==e)throw new Error("Can't save identity_key for invalid identifier");const{libsignal:n}=window,s=new n.SignalProtocolAddress.fromString(e),i=this.get("identity_key"+s.getName()),r=TR.arrayBufferToBase64(t);return this.save("identity_key"+s.getName(),r),i&&r!==i?Promise.resolve(!0):Promise.resolve(!1)}getPreKeys(){return this.get("prekeys")||{}}loadPreKey(e){const t=this.getPreKeys()[e];return t?Promise.resolve({privKey:TR.base64ToArrayBuffer(t.privKey),pubKey:TR.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storePreKey(e,t){const n={};return n[e]={pubKey:TR.arrayBufferToBase64(t.pubKey),privKey:TR.arrayBufferToBase64(t.privKey)},this.save("prekeys",Object.assign(this.getPreKeys(),n)),Promise.resolve()}removePreKey(e){const t={...this.getPreKeys()};return delete t[e],this.save("prekeys",t),Promise.resolve()}loadSignedPreKey(e){const t=this.get("signed_prekey");return t?Promise.resolve({privKey:TR.base64ToArrayBuffer(t.privKey),pubKey:TR.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storeSignedPreKey(e){if("object"!=typeof e)throw new Error("storeSignedPreKey: expected an object");return this.save("signed_prekey",{id:e.keyId,privKey:TR.arrayBufferToBase64(e.keyPair.privKey),pubKey:TR.arrayBufferToBase64(e.keyPair.pubKey),signature:TR.arrayBufferToBase64(e.signature)}),Promise.resolve()}removeSignedPreKey(e){return this.get("signed_prekey").id===e&&(this.unset("signed_prekey"),this.save()),Promise.resolve()}loadSession(e){return Promise.resolve(this.get("session"+e))}storeSession(e,t){return Promise.resolve(this.save("session"+e,t))}removeSession(e){return Promise.resolve(this.unset("session"+e))}removeAllSessions(e){const t=Object.keys(this.attributes).filter((t=>!!t.startsWith("session"+e)&&t)),n={};return t.forEach((e=>{n[e]=void 0})),this.save(n),Promise.resolve()}publishBundle(){const e=this.get("signed_prekey"),t=`${CR.NS.OMEMO_BUNDLES}:${this.get("device_id")}`,n=kR`
            <item>
                <bundle xmlns="${CR.NS.OMEMO}">
                    <signedPreKeyPublic signedPreKeyId="${e.id}">${e.pubKey}</signedPreKeyPublic>
                    <signedPreKeySignature>${e.signature}</signedPreKeySignature>
                    <identityKey>${this.get("identity_keypair").pubKey}</identityKey>
                    <prekeys>${Object.values(this.get("prekeys")).map(((e,t)=>kR`<preKeyPublic preKeyId="${t}">${e.pubKey}</preKeyPublic>`))}
                    </prekeys>
                </bundle>
            </item>`;return ad.pubsub.publish(null,t,n,{access_model:"open"},!1)}async generateMissingPreKeys(){const{libsignal:e}=window,{KeyHelper:t}=e,n=Object.keys(this.getPreKeys()),s=Array.from({length:uo.NUM_PREKEYS},((e,t)=>t.toString())).filter((e=>!n.includes(e)));if(s.length<1)return Y.debug("No missing prekeys to generate for our own device"),Promise.resolve();(await Promise.all(s.map((e=>t.generatePreKey(parseInt(e,10)))))).forEach((e=>this.storePreKey(e.keyId,e.keyPair)));const i=this.getPreKeys(),r=Object.keys(i).map((e=>({id:e,key:i[e].pubKey}))),o=uo.session.get("bare_jid"),a=(await ad.omemo.devicelists.get(o)).devices.get(this.get("device_id")),c=await a.getBundle();a.save("bundle",Object.assign(c,{prekeys:r}))}async generatePreKeys(){const e=uo.NUM_PREKEYS,{libsignal:t}=window,{KeyHelper:n}=t,s=await Promise.all([...Array(e).keys()].map((e=>n.generatePreKey(e))));return s.forEach((e=>this.storePreKey(e.keyId,e.keyPair))),s.map((e=>({id:e.keyId,key:TR.arrayBufferToBase64(e.keyPair.pubKey)})))}async generateBundle(){const{libsignal:e}=window,t=await e.KeyHelper.generateIdentityKeyPair(),n=TR.arrayBufferToBase64(t.pubKey),s=await async function(){const{libsignal:e}=window,t=uo.session.get("bare_jid"),n=(await ad.omemo.devicelists.get(t,!0)).devices.pluck("id");let s=e.KeyHelper.generateRegistrationId(),i=0;for(;n.includes(s);)if(s=e.KeyHelper.generateRegistrationId(),i++,10===i)throw new Error("Unable to generate a unique device ID");return s.toString()}();this.save({device_id:s,identity_key:n,identity_keypair:{privKey:TR.arrayBufferToBase64(t.privKey),pubKey:n}});const i=await e.KeyHelper.generateSignedPreKey(t,0);this.storeSignedPreKey(i);const r={identity_key:n,device_id:s,prekeys:await this.generatePreKeys()};r.signed_prekey={id:i.keyId,public_key:TR.arrayBufferToBase64(i.keyPair.pubKey),signature:TR.arrayBufferToBase64(i.signature)};const o=uo.session.get("bare_jid"),a=await ad.omemo.devicelists.get(o);(await a.devices.create({id:r.device_id,jid:o},{promise:!0})).save("bundle",r)}fetchSession(){return void 0===this._setup_promise&&(this._setup_promise=new Promise(((e,t)=>{this.fetch({success:()=>{this.get("device_id")?e():this.generateBundle().then(e).catch(t)},error:(n,s)=>{Y.warn(`Could restore OMEMO session, we'll generate a new one: ${s}`),this.generateBundle().then(e).catch(t)}})}))),this._setup_promise}}const NR=OR,MR={omemo:{getDeviceID:async()=>(await ad.waitUntil("OMEMOInitialized"),uo.state.omemo_store.get("device_id")),session:{async restore(){const{state:e}=uo;if(void 0===e.omemo_store){const t=`converse.omemosession-${uo.session.get("bare_jid")}`;e.omemo_store=new NR({id:t}),Rf.initStorage(e.omemo_store,t)}await e.omemo_store.fetchSession()}},devicelists:{async get(e,t=!1){const{devicelists:n}=uo.state,s=n.get(e)||(t?n.create({jid:e}):null);return await(s?.initialized),s}},bundle:{async generate(){await ad.waitUntil("OMEMOInitialized");const e=uo.session.get("bare_jid"),t=await ad.omemo.devicelists.get(e),{omemo_store:n}=uo.state,s=n.get("device_id");if(s){const e=t.devices.get(s);n.unset(s),e&&await new Promise((t=>e.destroy({success:t,error:t}))),t.devices.trigger("remove")}await n.generateBundle(),await t.publishDevices();const i=EI(t.devices.get(n.get("device_id")));return await n.publishBundle(),i}}}};var IR=n(9569),RR={};RR.styleTagTransform=L(),RR.setAttributes=I(),RR.insert=N().bind(null,"head"),RR.domAPI=T(),RR.insertStyleElement=D();C()(IR.A,RR);IR.A&&IR.A.locals&&IR.A.locals;const{Strophe:DR}=Lf.env,{shouldClearCache:zR}=Rf;Lf.env.omemo=DI,DR.addNamespace("OMEMO_DEVICELIST",DR.NS.OMEMO+".devicelist"),DR.addNamespace("OMEMO_VERIFICATION",DR.NS.OMEMO+".verification"),DR.addNamespace("OMEMO_WHITELISTED",DR.NS.OMEMO+".whitelisted"),DR.addNamespace("OMEMO_BUNDLES",DR.NS.OMEMO+".bundles"),Lf.plugins.add("converse-omemo",{enabled:e=>window.libsignal&&e.config.get("trusted")&&!ad.settings.get("clear_cache_on_logout")&&!e.api.settings.get("blacklisted_plugins").includes("converse-omemo"),dependencies:["converse-chatview","converse-pubsub","converse-profile"],initialize(){ad.settings.extend({omemo_default:!1}),ad.promises.add(["OMEMOInitialized"]),Object.assign(uo.api,MR);const e={OMEMOStore:NR,Device:$R,Devices:jR,DeviceList:GM,DeviceLists:VM};Object.assign(uo,e),Object.assign(uo.exports,e),ad.waitUntil("chatBoxesInitialized").then(bI),ad.listen.on("getOutgoingMessageAttributes",fI),ad.listen.on("createMessageStanza",(async(e,t)=>{try{t=await RI(e,t)}catch(t){!function(e,t){if(e instanceof PM){t.save("omemo_supported",!1);const n=[];JM(`presence-subscription-required[xmlns="${KM.NS.PUBSUB_ERROR}"]`,e.iq).length?n.push(C_("Sorry, we're unable to send an encrypted message because %1$s requires you to be subscribed to their presence in order to see their OMEMO information",e.iq.getAttribute("from"))):JM('remote-server-not-found[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]',e.iq).length?n.push(C_("Sorry, we're unable to send an encrypted message because the remote server for %1$s could not be found",e.iq.getAttribute("from"))):(n.push(C_("Unable to send an encrypted message due to an unexpected error.")),n.push(e.iq.outerHTML)),ad.alert("error",C_("Error"),n)}else e instanceof UM&&ad.alert("error",C_("Error"),[e.message]);throw e}(t,e)}return t})),ad.listen.on("afterFileUploaded",((e,t)=>e.file.xep454_ivkey?function(e,t){const n=t.oob_url.replace(/^https?:/,"aesgcm:")+"#"+e.file.xep454_ivkey;return Object.assign(t,{oob_url:null,message:n,body:n})}(e,t):t)),ad.listen.on("beforeFileUpload",((e,t)=>e.get("omemo_active")?async function(e){const t=crypto.getRandomValues(new Uint8Array(12)),n=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},n,await e.arrayBuffer()),i=await window.crypto.subtle.exportKey("raw",n),r=new File([s],e.name,{type:e.type,lastModified:e.lastModified});return Object.assign(r,{xep454_ivkey:tI(t)+tI(i)}),r}(t):t)),ad.listen.on("parseMessage",vI),ad.listen.on("parseMUCMessage",vI),ad.listen.on("chatBoxViewInitialized",yI),ad.listen.on("chatRoomViewInitialized",yI),ad.listen.on("connected",TI),ad.listen.on("getToolbarButtons",II),ad.listen.on("statusInitialized",OI),ad.listen.on("addClientFeatures",(()=>ad.disco.own.features.add(`${DR.NS.OMEMO_DEVICELIST}+notify`))),ad.listen.on("afterMessageBodyTransformed",pI),ad.listen.on("userDetailsModalInitialized",(e=>{$I(e.get("jid")).catch((e=>Y.error(e)))})),ad.listen.on("profileModalInitialized",(()=>{$I(uo.session.get("bare_jid")).catch((e=>Y.error(e)))})),ad.listen.on("clearSession",(()=>{delete uo.state.omemo_store,zR(uo)&&uo.state.devicelists&&(uo.state.devicelists.clearStore(),delete uo.state.devicelists)}))}});const{Strophe:LR,$iq:PR}=Lf.env,{CHATROOMS_TYPE:UR}=__;async function BR(e){if(!e){const t=uo.session.get("bare_jid");e=t}const t=uo.session.get("push_enabled")||[];if(t.includes(e))return;const n=ad.settings.get("push_app_servers").filter((e=>!e.disable)),s=ad.settings.get("push_app_servers").filter((e=>e.disable)),i=n.map((t=>async function(e,t){if(!t.jid||!t.node)return;if(!await ad.disco.getIdentity("pubsub","push",t.jid))return Y.warn(`Not enabling push the service "${t.jid}", it doesn't have the right disco identtiy.`);const n=await Promise.all([ad.disco.supports(LR.NS.PUSH,t.jid),ad.disco.supports(LR.NS.PUSH,e)]);if(!n[0]&&!n[1])return void Y.warn(`Not enabling push app server "${t.jid}", no disco support from your server.`);const s=PR({type:"set"});return e!==uo.session.get("bare_jid")&&s.attrs({to:e}),s.c("enable",{xmlns:LR.NS.PUSH,jid:t.jid,node:t.node}),t.secret&&s.c("x",{xmlns:LR.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t(`${LR.NS.PUBSUB}#publish-options`).up().up().c("field",{var:"secret"}).c("value").t(t.secret),ad.sendIQ(s)}(e,t))),r=s.map((t=>async function(e,t){if(!t.jid)return;const n=uo.session.get("bare_jid");if(!await ad.disco.supports(LR.NS.PUSH,e||n))return void Y.warn(`Not disabling push app server "${t.jid}", no disco support from your server.`);const s=PR({type:"set"});e!==n&&s.attrs({to:e}),s.c("disable",{xmlns:LR.NS.PUSH,jid:t.jid}),t.node&&s.attrs({node:t.node}),ad.sendIQ(s).catch((e=>{Y.error(`Could not disable push app server for ${t.jid}`),Y.error(e)}))}(e,t)));try{await Promise.all(i.concat(r))}catch(e){Y.error("Could not enable or disable push App Server"),e&&Y.error(e)}finally{t.push(e)}uo.session.save("push_enabled",t)}function qR(e){e.get("type")==UR&&BR(LR.getDomainFromJid(e.get("jid")))}const{Strophe:FR}=Lf.env;async function HR(e){await ad.waitUntil("controlBoxInitialized");const{chatboxes:t}=uo.state;t.get("controlbox").set({"active-form":e})}function GR(e){"#converse/login"===location.hash?(e?.preventDefault(),HR("login")):"#converse/register"===location.hash&&(e?.preventDefault(),HR("register"))}FR.addNamespace("PUSH","urn:xmpp:push:0"),Lf.plugins.add("converse-push",{initialize(){ad.settings.extend({push_app_servers:[],enable_muc_push:!1}),ad.listen.on("statusInitialized",(()=>BR())),ad.settings.get("enable_muc_push")&&ad.listen.on("chatBoxesInitialized",(()=>uo.state.chatboxes.on("add",qR)))}});const WR=()=>{const e=C_("Already have a chat account?"),t=C_("Go back to login");return wh`<div class="switch-form"><p class="mb-1">${e}</p><a class="login-here toggle-register-login" href="#converse/login">${t}</a></div>`};function VR(e){const t=ad.settings.get("registration_domain"),n=C_("Create your account"),s=C_("Please enter the XMPP provider to register with:"),i=!t&&e.status===KR;return wh`<form id="converse-register" class="converse-form" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${n}</legend><div class="pt-3"><label class="form-label">${s}</label> ${t||function(e){const t=ad.settings.get("domain_placeholder"),n=C_("Tip: A list of public XMPP providers is available"),s=C_("here"),i=ad.settings.get("providers_link");return wh`<input class="form-control" required="required" type="text" name="domain" placeholder="${t}" value="${e.domain}"><p class="form-text text-muted">${n} <a href="${i}" class="url" target="_blank" rel="noopener">${s}</a>.</p>${ad.settings.get("show_connection_url_input")?GT():""}`}(e)}</div>${i?function(){const e=C_("Fetch registration form"),t=C_("Already have a chat account?"),n=C_("Go back to login");return wh`<fieldset class="form-group buttons"><input class="btn btn-primary" type="submit" value="${e}"></fieldset><div class="switch-form"><p class="mb-1">${t}</p><a class="login-here toggle-register-login" href="#converse/login">${n}</a></div>`}():""}</form>`}const KR=0,JR=e=>wh`${e.alert_message?wh`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""} ${e.status===KR?VR(e):""} ${1===e.status?function(e){const t=ad.settings.get("registration_domain"),n=C_("Cancel");return wh`<form id="converse-register" class="converse-form no-scrolling" @submit="${t=>e.onFormSubmission(t)}">${Xx({classes:"hor_centered"})} ${t?"":wh`<button class="btn btn-secondary button-cancel hor_centered" @click="${t=>e.renderProviderChoiceForm(t)}">${n}</button>`}</form>`}(e):""} ${2===e.status?(e=>{const t=C_("Choose a different provider"),n=C_("Account Registration:"),s=C_("Register"),i=ad.settings.get("registration_domain");return wh`<form id="converse-register" class="converse-form rounded" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${n} ${e.domain}</legend><p class="title">${e.title}</p><p class="form-help instructions">${e.instructions}</p><div class="form-errors hidden"></div>${e.form_fields}<fieldset class="buttons form-group">${e.fields?wh`<input type="submit" class="btn btn-primary" value="${s}">`:""} ${i?"":wh`<input type="button" class="btn btn-secondary button-cancel" value="${t}" @click="${t=>e.renderProviderChoiceForm(t)}">`} ${WR()}</fieldset></form>`})(e):""} ${3===e.status?WR():""}`;var YR=n(9847),XR={};XR.styleTagTransform=L(),XR.setAttributes=I(),XR.insert=N().bind(null,"head"),XR.domAPI=T(),XR.insertStyleElement=D();C()(YR.A,XR);YR.A&&YR.A.locals&&YR.A.locals;const{Strophe:QR,sizzle:ZR,$iq:eD}=Lf.env,{CONNECTION_STATUS:tD}=__,nD=1,sD=2;class iD extends O_{static get properties(){return{status:{type:String},domain:{type:String},service_url:{type:String},alert_message:{type:String},alert_type:{type:String}}}constructor(){super(),this.urls=[],this.fields={},this.domain=null,this.alert_type="info",this.setErrorMessage=e=>this.setMessage(e,"danger"),this.setFeedbackMessage=e=>this.setMessage(e,"info")}initialize(){this.reset(),this.listenTo(uo,"connectionInitialized",(()=>this.registerHooks()));const e=ad.settings.get();this.listenTo(e,"change:show_connection_url_input",(()=>this.requestUpdate()));const t=ad.settings.get("registration_domain");t?this.fetchRegistrationForm(t):this.status=0}render(){return JR(this)}setMessage(e,t){this.alert_type=t,this.alert_message=e}registerHooks(){const e=ad.connection.get(),t=e._connect_cb.bind(e);e._connect_cb=(e,n,s)=>{this._registering?this.getRegistrationFields(e,n)&&(this._registering=!1):t(e,n,s)}}getRegistrationFields(e,t){const n=ad.connection.get();n.connected=!0;const s="_reqToData"in n._proto?n._proto._reqToData(e):e;if(!s)return;if(n._proto._connect_cb(s)===QR.Status.CONNFAIL)return this.status=0,this.setErrorMessage(C_("Sorry, we're unable to connect to your chosen provider.")),!1;const i=s.getElementsByTagName("register"),r=s.getElementsByTagName("mechanism");if(0===i.length&&0===r.length)return n._proto._no_auth_received(t),!1;if(0===i.length)return n._changeConnectStatus(QR.Status.REGIFAIL),this.alert_type="danger",this.setErrorMessage(C_("Sorry, the given provider does not support in band account registration. Please try with a different provider.")),!0;n._addSysHandler((e=>this.onRegistrationFields(e)),null,"iq",null,null);const o=eD({type:"get"}).c("query",{xmlns:QR.NS.REGISTER}).tree();return o.setAttribute("id",n.getUniqueId("sendIQ")),n.send(o),n.connected=!1,!0}onRegistrationFields(e){return"error"===e.getAttribute("type")?(this.reportErrors(e),ad.settings.get("registration_domain")?this.status=3:this.status=0,!1):(this.setFields(e),this.status===nD&&this.renderRegistrationForm(e),!1)}reset(e){Object.assign(this,{fields:{},urls:[],title:"",instructions:"",registered:!1,_registering:!1,domain:null,form_type:null}),e&&Object.assign(this,e)}onFormSubmission(e){e?.preventDefault?.();const t=e.target;null===t.querySelector("input[name=domain]")?this.submitRegistrationForm(t):this.onProviderChosen(t)}onProviderChosen(e){const t=e.querySelector("input[name=domain]")?.value;if(t){const n=new FormData(e);let s=null;if(ad.settings.get("show_connection_url_input"))if(s=n.get("connection-url"),s.startsWith("wss:"))ad.settings.set("websocket_url",s);else{if(!s.startsWith("https:"))return this.alert_message=C_("Invalid connection URL, only HTTPS and WSS accepted"),this.alert_type="danger",this.status=0,void this.requestUpdate();ad.settings.set("bosh_service_url",s)}this.fetchRegistrationForm(t.trim(),s?.trim())}else this.status=0}fetchRegistrationForm(e,t){return this.status=nD,this.reset({_registering:!0,domain:QR.getDomainFromJid(e),service_url:t}),ad.connection.init(),ad.connection.get()?.connect(this.domain,"",((e,t)=>this.onConnectStatusChanged(e,t))),!1}onConnectStatusChanged(e,t){if(Y.debug("converse-register: onConnectStatusChanged"),[QR.Status.DISCONNECTED,QR.Status.CONNFAIL,QR.Status.REGIFAIL,QR.Status.NOTACCEPTABLE,QR.Status.CONFLICT].includes(e))Y.warn(`Problem during registration: Strophe.Status is ${tD[e]}`),this.abortRegistration(t);else if(e===QR.Status.REGISTERED){if(Y.debug("Registered successfully."),ad.connection.get().reset(),["converse/login","converse/register"].includes(window.location.hash)&&history.pushState(null,"",window.location.pathname),HR("login"),this.fields.password&&this.fields.username){const e=ad.connection.get();e.connect(this.fields.username.toLowerCase()+"@"+this.domain.toLowerCase(),this.fields.password,e.onConnectStatusChanged),this.setFeedbackMessage(C_("Now logging you in"))}else this.setFeedbackMessage(C_("Registered successfully"));this.reset()}}getLegacyFormFields(){const e=Object.keys(this.fields).map((e=>"username"===e?aw({domain:` @${this.domain}`,name:e,type:"text",label:e,value:"",required:!0}):sw({label:e,name:e,placeholder:e,required:!0,type:"password"===e||"email"===e?e:"text",value:""})));return[...e,...this.urls.map((e=>ow({label:"",value:e})))]}getFormFields(e){if("xform"===this.form_type){const{fields:t}=hm(e);return t?.map((e=>Rf.xFormField2TemplateResult(e,{domain:this.domain})))??[]}return this.getLegacyFormFields()}renderRegistrationForm(e){this.form_fields=this.getFormFields(e),this.status=sD}async reportErrors(e){if(await Wf(e)instanceof _l)return void this.setErrorMessage(`${C_("Registration failed.")} ${C_("Please try a different username.")}`);const t=Array.from(e.querySelectorAll("error"));t.length?this.setErrorMessage(`${C_("Registration failed.")}${t.reduce(((e,t)=>`${e}\n${t.textContent}`),"")}`):this.setErrorMessage(C_("The provider rejected your registration attempt. Please check the values you entered for correctness."))}renderProviderChoiceForm(e){e?.preventDefault?.();const t=ad.connection.get();t._proto._abortAllRequests(),t.reset(),this.status=0}abortRegistration(e){const t=ad.connection.get();t._proto._abortAllRequests(),t.reset(),[nD,sD].includes(this.status)&&ad.settings.get("registration_domain")?this.fetchRegistrationForm(ad.settings.get("registration_domain")):(this.alert_message=e,this.alert_type="danger",this.status=0,this.requestUpdate())}submitRegistrationForm(e){const t=ZR(":input:not([type=button]):not([type=submit])",e),n=eD({type:"set",id:Rf.getUniqueId()}).c("query",{xmlns:QR.NS.REGISTER});if("xform"===this.form_type){n.c("x",{xmlns:QR.NS.XFORM,type:"submit"});const e=t.map((e=>Rf.webForm2xForm(e))).filter((e=>e));e.forEach((e=>n.cnode(e).up()))}else t.forEach((e=>n.c(e.getAttribute("name"),{},e.value)));const s=ad.connection.get();s._addSysHandler((e=>this.#m(e)),null,"iq",null,null),s.send(n),this.setFields(n.tree())}setFields(e){const t=e.querySelector("query"),n=ZR(`x[xmlns="${QR.NS.XFORM}"]`,t);n.length>0?this.setFieldsFromXForm(n.pop()):this.setFieldsFromLegacy(t)}setFieldsFromLegacy(e){[].forEach.call(e.children,(e=>{"instructions"!==e.tagName.toLowerCase()?"x"!==e.tagName.toLowerCase()?this.fields[e.tagName.toLowerCase()]=QR.getText(e):"jabber:x:oob"===e.getAttribute("xmlns")&&this.urls.concat(ZR("url",e).map((e=>e.textContent))):this.instructions=QR.getText(e)})),this.form_type="legacy"}setFieldsFromXForm(e){this.title=e.querySelector("title")?.textContent??"",this.instructions=e.querySelector("instructions")?.textContent??"",e.querySelectorAll("field").forEach((e=>{const t=e.getAttribute("var");t?this.fields[t.toLowerCase()]=e.querySelector("value")?.textContent??"":Y.warn("Found field we couldn't parse")})),this.form_type="xform"}#m(e){const t=ad.connection.get();if("error"===e.getAttribute("type")){Y.info("Registration failed."),this.reportErrors(e);const n=e.getElementsByTagName("error");if(1!==n.length)return t._changeConnectStatus(QR.Status.REGIFAIL,"unknown"),!1;const s=n[0].firstElementChild.tagName.toLowerCase();"conflict"===s?t._changeConnectStatus(QR.Status.CONFLICT,s):"not-acceptable"===s?t._changeConnectStatus(QR.Status.NOTACCEPTABLE,s):t._changeConnectStatus(QR.Status.REGIFAIL,s)}else t._changeConnectStatus(QR.Status.REGISTERED,null);return!1}}ad.elements.define("converse-registration-form",iD);const rD=iD;class oD extends O_{render(){const e=C_("Create an account"),t=C_("Don't have a chat account?");return this.shouldShow()?wh`<div class="mt-3 text-center switch-form"><p class="mb-1">${t}</p><a class="register-account toggle-register-login" href="#converse/register">${e}</a></div>`:""}shouldShow(){return ad.settings.get("allow_registration")&&!ad.settings.get("auto_login")&&uo.pluggable.plugins["converse-register"].enabled(uo)}}ad.elements.define("converse-register-link",oD);const aD=oD,{Strophe:cD}=Lf.env,{CONNECTION_STATUS:lD}=__;cD.addNamespace("REGISTER","jabber:iq:register");const dD=Object.keys(cD.Status).reduce(((e,t)=>Math.max(e,cD.Status[t])),0);cD.Status.REGIFAIL=dD+1,cD.Status.REGISTERED=dD+2,cD.Status.CONFLICT=dD+3,cD.Status.NOTACCEPTABLE=dD+5,Lf.plugins.add("converse-register",{dependencies:["converse-controlbox"],enabled:()=>!0,initialize(){lD[cD.Status.REGIFAIL]="REGIFAIL",lD[cD.Status.REGISTERED]="REGISTERED",lD[cD.Status.CONFLICT]="CONFLICT",lD[cD.Status.NOTACCEPTABLE]="NOTACCEPTABLE",ad.settings.extend({allow_registration:!0,domain_placeholder:C_(" e.g. conversejs.org"),providers_link:"https://compliance.conversations.im/",registration_domain:""});const e={RegisterLink:aD,RegistrationForm:rD};Object.assign(uo.exports,e),GR(),addEventListener("hashchange",GR)}});const{Strophe:uD}=Lf.env,{OPENED:hD}=__;class fD extends ie.Model{defaults(){return{muc_domain:ad.settings.get("muc_domain"),toggle_state:hD,collapsed_domains:[]}}initialize(){super.initialize(),ad.settings.listen.on("change:muc_domain",(e=>this.setDomain(e)))}setDomain(e){ad.settings.get("locked_muc_domain")||this.save("muc_domain",uD.getDomainFromJid(e))}}const mD=fD,{Strophe:gD,$iq:pD,sizzle:vD}=Lf.env;gD.addNamespace("MUCSEARCH","https://xmlns.zombofant.net/muclumbus/search/1.0");const bD={};function yD(e){return bD[e]||(bD[e]=async function(e){const t=ad.settings.get("muc_search_service"),n=uo.session.get("bare_jid"),s=pD({type:"get",from:n,to:t}).c("search",{xmlns:gD.NS.MUCSEARCH}).c("set",{xmlns:gD.NS.RSM}).c("max").t(10).up().up().c("x",{xmlns:gD.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("https://xmlns.zombofant.net/muclumbus/search/1.0#params").up().up().c("field",{var:"q",type:"text-single"}).c("value").t(e).up().up().c("field",{var:"sinname",type:"boolean"}).c("value").t("true").up().up().c("field",{var:"sindescription",type:"boolean"}).c("value").t("false").up().up().c("field",{var:"sinaddr",type:"boolean"}).c("value").t("true").up().up().c("field",{var:"min_users",type:"text-single"}).c("value").t("1").up().up().c("field",{var:"key",type:"list-single"}).c("value").t("address").up().c("option").c("value").t("nusers").up().up().c("option").c("value").t("address");let i;try{i=await ad.sendIQ(s)}catch(e){return Y.error(e),[]}const r=`result[xmlns="${gD.NS.MUCSEARCH}"] item`;return vD(r,i).map((e=>{const t=e.getAttribute("address");return{label:`${e.querySelector("name")?.textContent} (${t})`,value:t}}))}(e)),bD[e]}const _D=e=>{const t=C_("Join");let n;n=ad.settings.get("locked_muc_domain")?C_("Groupchat name"):C_("Groupchat name or address");const s=ad.settings.get("muc_roomid_policy_hint"),i=ad.settings.get("muc_search_service");return wh`<form class="converse-form add-chatroom needs-validation" @submit="${t=>e.openChatRoom(t)}" novalidate><div class="mb-3"><label for="chatroom" class="form-label">${n}:</label><div class="input-group">${i?wh`<converse-autocomplete .getAutoCompleteList="${yD}" .validate="${t=>e.validateMUCJID(t)}" ?autofocus="${!0}" class="add-muc-autocomplete" min_chars="3" name="chatroom" position="below" required></converse-autocomplete>`:""}</div>${s?wh`<div class="mb-3">${Vk(hu.sanitize(s,{ALLOWED_TAGS:["b","br","em"]}))}</div>`:""}</div>${ad.settings.get("locked_muc_nickname")?"":(()=>{const e=C_("Nickname"),t=C_("This field is required");return wh`<div class="mb-3"><label for="nickname" class="form-label">${e}:</label> <input type="text" title="${t}" required name="nickname" value="${uo.exports.getDefaultMUCNickname()||""}" class="form-control"></div>`})()} <input type="submit" class="btn btn-primary mt-3" name="join" value="${t||""}"></form>`};var wD=n(3370),SD={};SD.styleTagTransform=L(),SD.setAttributes=I(),SD.insert=N().bind(null,"head"),SD.domAPI=T(),SD.insertStyleElement=D();C()(wD.A,SD);wD.A&&wD.A.locals&&wD.A.locals;const AD=Lf.env.utils,{Strophe:xD}=Lf.env;ad.elements.define("converse-add-muc-modal",class extends aE{initialize(){super.initialize(),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>{this.querySelector('input[name="chatroom"]')?.focus()}),!1)}renderModal(){return _D(this)}getModalTitle(){return C_("Enter a new Groupchat")}parseRoomDataFromEvent(e){const t=new FormData(e),n=t.get("chatroom")?.trim();let s;if(ad.settings.get("locked_muc_nickname")){if(s=uo.exports.getDefaultMUCNickname(),!s)throw new Error("Using locked_muc_nickname but no nickname found!")}else s=t.get("nickname").trim();return{jid:n,nick:s}}normalizeNode(e){return e.trim().replace(/\s+/g,"-").replace(/\u0142/g,"l").replace(/[^\x00-\x7F]/g,(e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,""))).replace(/[^a-zA-Z0-9-]/g,"-").replace(/-+/g,"-").replace(/[^a-zA-Z0-9]$/g,"").toLowerCase()}async openChatRoom(e){e.preventDefault();const t=this.querySelector("converse-autocomplete");if((await t.onChange()).error_message)return;const{escapeNode:n,getNodeFromJid:s,getDomainFromJid:i}=xD,r=e.target,o=this.parseRoomDataFromEvent(r),a={nick:o.nick??void 0};let c;if(ad.settings.get("locked_muc_domain")||!AD.isValidJID(o.jid)){const e=await AD.muc.getDefaultMUCService();e&&(a.name=o.jid,a.auto_configure=!0,a.roomconfig={roomname:o.jid},c=`${this.normalizeNode(o.jid)}@${e}`.toLowerCase())}c||(c=`${n(s(o.jid))}@${i(o.jid)}`.toLowerCase()),ad.rooms.open(c,{...a,jid:c},!0),r.reset(),this.modal.hide()}async validateMUCJID(e){if(0===e.length)return C_("Invalid groupchat address, it cannot be empty.");if(e.split("/").length-1>0)return C_("Invalid groupchat address, a forward slash is not allowed.");if(e.split("@").length-1>1)return C_("Invalid groupchat address, more than one @ sign is not allowed.");if(e.startsWith("@")||e.endsWith("@"))return C_("Invalid groupchat address, it cannot start or end with an @ sign.");if(!e.includes("@")){if(!await AD.muc.getDefaultMUCService())return C_("No default groupchat service found. You'll need to specify the full address, for example room@conference.example.org")}const t=ad.settings.get("muc_roomid_policy");if(t&&ad.settings.get("muc_domain")){!ad.settings.get("locked_muc_domain")&&AD.isValidJID(e)||(e=`${xD.escapeNode(e)}@${ad.settings.get("muc_domain")}`);const n=xD.getNodeFromJid(e),s=xD.getDomainFromJid(e);if(ad.settings.get("muc_domain")===s&&!t.test(n))return C_("Groupchat id is invalid.")}return""}});const $D=e=>wh`${e.show_form?(e=>{const t=C_("Show groupchats"),n=C_("Server address");return wh`<form class="converse-form list-chatrooms" @submit="${e.submitForm}"><div><label class="form-label" for="chatroom">${n}:</label> <input type="text" autofocus @change="${e.setDomainFromEvent}" value="${e.muc_domain||""}" required="required" name="server" class="form-control" placeholder="${e.server_placeholder}"></div><input type="submit" class="btn btn-primary" name="list" value="${t}"></form>`})(e):""}<ul class="available-chatrooms list-group">${e.loading_items?wh`<li class="list-group-item">${Xx()}</li>`:""} ${e.feedback_text?wh`<li class="list-group-item active">${e.feedback_text}</li>`:""} ${nC(e.items,(e=>e.jid),(t=>((e,t)=>{const n=C_("Show more information on this groupchat"),s=C_("Click to open this groupchat");return wh`<li class="room-item list-group-item"><div class="available-chatroom d-flex flex-row"><a class="open-room available-room w-100" @click="${e.openRoom}" data-room-jid="${t.jid}" data-room-name="${t.name}" title="${s}" href="#">${t.name||t.jid}</a> <a class="right room-info icon-room-info" @click="${e.toggleRoomInfo}" data-room-jid="${t.jid}" title="${n}" href="#"></a></div></li>`})(e,t)))}</ul>`,{Strophe:ED,$iq:jD,sizzle:CD}=Lf.env,{getAttributes:kD}=Rf;function TD(e,t){e.querySelector("span.spinner").remove(),e.querySelector("a.room-info").classList.add("selected"),e.insertAdjacentHTML("beforeend",Rf.getElementFromTemplateResult((e=>{const t=C_("Description:"),n=C_("Groupchat XMPP Address:"),s=C_("Participants:"),i=C_("Features:"),r=C_("Requires authentication"),o=C_("Hidden"),a=C_("Requires an invitation"),c=C_("Moderated"),l=C_("Non-anonymous"),d=C_("Open"),u=C_("Permanent"),h=C_("Public"),f=C_("Semi-anonymous"),m=C_("Temporary"),g=C_("Unmoderated");return wh`<div class="room-info"><p class="room-info"><strong>${n}</strong> ${e.jid}</p><p class="room-info"><strong>${t}</strong> ${e.desc}</p><p class="room-info"><strong>${s}</strong> ${e.occ}</p><p class="room-info"><strong>${i}</strong></p><ul>${e.passwordprotected?wh`<li class="room-info locked">${r}</li>`:""} ${e.hidden?wh`<li class="room-info">${o}</li>`:""} ${e.membersonly?wh`<li class="room-info">${a}</li>`:""} ${e.moderated?wh`<li class="room-info">${c}</li>`:""} ${e.nonanonymous?wh`<li class="room-info">${l}</li>`:""} ${e.open?wh`<li class="room-info">${d}</li>`:""} ${e.persistent?wh`<li class="room-info">${u}</li>`:""} ${e.publicroom?wh`<li class="room-info">${h}</li>`:""} ${e.semianonymous?wh`<li class="room-info">${f}</li>`:""} ${e.temporary?wh`<li class="room-info">${m}</li>`:""} ${e.unmoderated?wh`<li class="room-info">${g}</li>`:""}</ul><p></p></div>`})({jid:t.getAttribute("from"),desc:CD('field[var="muc#roominfo_description"] value',t).shift()?.textContent,occ:CD('field[var="muc#roominfo_occupants"] value',t).shift()?.textContent,hidden:CD('feature[var="muc_hidden"]',t).length,membersonly:CD('feature[var="muc_membersonly"]',t).length,moderated:CD('feature[var="muc_moderated"]',t).length,nonanonymous:CD('feature[var="muc_nonanonymous"]',t).length,open:CD('feature[var="muc_open"]',t).length,passwordprotected:CD('feature[var="muc_passwordprotected"]',t).length,persistent:CD('feature[var="muc_persistent"]',t).length,publicroom:CD('feature[var="muc_publicroom"]',t).length,semianonymous:CD('feature[var="muc_semianonymous"]',t).length,temporary:CD('feature[var="muc_temporary"]',t).length,unmoderated:CD('feature[var="muc_unmoderated"]',t).length})))}ad.elements.define("converse-muc-list-modal",class extends aE{constructor(e){super(e),this.items=[],this.loading_items=!1}initialize(){super.initialize(),this.listenTo(this.model,"change:muc_domain",this.onDomainChange),this.listenTo(this.model,"change:feedback_text",(()=>this.requestUpdate())),this.addEventListener("shown.bs.modal",(()=>ad.settings.get("locked_muc_domain")&&this.updateRoomsList())),this.model.save("feedback_text","")}renderModal(){return $D(Object.assign(this.model.toJSON(),{show_form:!ad.settings.get("locked_muc_domain"),server_placeholder:this.model.get("muc_domain")||C_("conference.example.org"),items:this.items,loading_items:this.loading_items,openRoom:e=>this.openRoom(e),setDomainFromEvent:e=>this.setDomainFromEvent(e),submitForm:e=>this.showRooms(e),toggleRoomInfo:e=>this.toggleRoomInfo(e)}))}getModalTitle(){return C_("Query for Groupchats")}openRoom(e){e.preventDefault();const t=e.target.getAttribute("data-room-jid"),n=e.target.getAttribute("data-room-name");this.modal.hide(),ad.rooms.open(t,{name:n},!0)}toggleRoomInfo(e){e.preventDefault(),function(e){const t=Rf.ancestor(e.target,".room-item"),n=t.querySelector("div.room-info");n?(Rf.slideIn(n).then(Rf.removeElement),t.querySelector("a.room-info").classList.remove("selected")):(t.insertAdjacentElement("beforeend",Rf.getElementFromTemplateResult(Xx())),ad.disco.info(e.target.getAttribute("data-room-jid"),null).then((e=>TD(t,e))).catch((e=>Y.error(e))))}(e)}onDomainChange(){ad.settings.get("auto_list_rooms")&&this.updateRoomsList()}onRoomsFound(e){this.loading_items=!1;const t=e?CD("query item",e):[];return t.length?(this.model.set({feedback_text:C_("Groupchats found")},{silent:!0}),this.items=t.map(kD)):(this.items=[],this.model.set({feedback_text:C_("No groupchats found")},{silent:!0})),this.requestUpdate(),!0}updateRoomsList(){const e=jD({to:this.model.get("muc_domain"),from:ad.connection.get().jid,type:"get"}).c("query",{xmlns:ED.NS.DISCO_ITEMS});ad.sendIQ(e).then((e=>this.onRoomsFound(e))).catch((()=>this.onRoomsFound()))}showRooms(e){e.preventDefault(),this.loading_items=!0,this.requestUpdate();const t=new FormData(e.target);this.model.setDomain(t.get("server")),this.updateRoomsList()}setDomainFromEvent(e){this.model.setDomain(e.target.value)}setNick(e){this.model.save({nick:e.target.value})}});var OD=n(2579),ND={};ND.styleTagTransform=L(),ND.setAttributes=I(),ND.insert=N().bind(null,"head"),ND.domAPI=T(),ND.insertStyleElement=D();C()(OD.A,ND);OD.A&&OD.A.locals&&OD.A.locals;const{CHATROOMS_TYPE:MD,CLOSED:ID}=__,{isUniView:RD}=Rf;function DD(e){return RD()&&!e.get("hidden")}function zD(e,t){const n=C_("Leave this groupchat"),s=t.get("num_unread_general")||t.get("has_activity");return wh`<li class="list-item controlbox-padded available-chatroom d-flex flex-row ${DD(t)?"open":""} ${s?"unread-msgs":""}" data-room-jid="${t.get("jid")}"><a class="list-item-link open-room available-room w-100" data-room-jid="${t.get("jid")}" data-room-name="${t.getDisplayName()}" title="${C_("Click to open this groupchat")}" @click="${t=>e.openRoom(t)}"><converse-avatar .model="${t}" class="avatar avatar-muc" name="${t.getDisplayName()}" nonce="${t.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><span>${t.get("num_unread")?function(e){return wh`<span class="list-item-badge badge badge--muc msgs-indicator">${vC(e)}</span>`}(t):t.get("has_activity")?wh`<span class="list-item-badge badge badge--muc msgs-indicator"></span>`:""} ${t.getDisplayName()}</span> </a><a class="list-item-action close-room" tabindex="0" data-room-jid="${t.get("jid")}" data-room-name="${t.getDisplayName()}" title="${n}" @click="${t=>e.closeRoom(t)}"><converse-icon class="fa fa-sign-out-alt" size="1.2em" color="${DD(t)?"var(--foreground-color)":""}"></converse-icon></a></li>`}function LD(e,t){const n=new Map;for(const e of t){const t=e.get("jid").split("@").at(-1).toLowerCase();n.has(t)?n.get(t).push(e):n.set(t,[e])}const s=Array.from(n.keys());return s.sort(),s.map((t=>function(e,t,n){const s=C_("Click to hide these rooms"),i=e.model.get("collapsed_domains").includes(t);return wh`<div class="muc-domain-group" data-domain="${t}"><a href="#" class="list-toggle muc-domain-group-toggle controlbox-padded" title="${s}" @click="${n=>e.toggleDomainList(n,t)}"><converse-icon class="fa ${i?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--muc-color)"></converse-icon>${t}</a><ul class="items-list muc-domain-group-rooms ${i?"collapsed":""}" data-domain="${t}">${n.map((t=>zD(e,t)))}</ul></div>`}(e,t,n.get(t))))}const{Strophe:PD}=Lf.env,{initStorage:UD}=Rf,{CLOSED:BD,OPENED:qD}=__;ad.elements.define("converse-rooms-list",class extends O_{initialize(){const e=`converse.roomspanel${uo.session.get("bare_jid")}`;this.model=new mD({id:e}),uo.state.roomslist=this.model,UD(this.model,e),this.model.fetch();const{chatboxes:t}=uo.state;this.listenTo(t,"add",this.renderIfChatRoom),this.listenTo(t,"remove",this.renderIfChatRoom),this.listenTo(t,"destroy",this.renderIfChatRoom),this.listenTo(t,"change",this.renderIfRelevantChange),this.listenTo(t,"vcard:add",(()=>this.requestUpdate())),this.listenTo(t,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=ad.settings.get("muc_grouped_by_domain"),{chatboxes:n}=uo.state,s=n.filter((e=>e.get("type")===MD));s.sort(((e,t)=>e.getDisplayName().toLowerCase()<=t.getDisplayName().toLowerCase()?-1:1));const i=C_("Click to toggle the list of open groupchats"),r=C_("Groupchats"),o=C_("Query server"),a=C_("Add groupchat"),c=C_("Bookmarks"),l=e.model.get("toggle_state")===ID,d=[wh`<a class="dropdown-item show-add-muc-modal" role="button" @click="${t=>ad.modal.show("converse-add-muc-modal",{model:e.model},t)}" data-toggle="modal" data-target="#add-chatrooms-modal"><converse-icon class="fa fa-plus" size="1em"></converse-icon>${a}</a>`,wh`<a class="dropdown-item show-list-muc-modal" role="button" @click="${t=>ad.modal.show("converse-muc-list-modal",{model:e.model},t)}" data-toggle="modal" data-target="#muc-list-modal"><converse-icon class="fa fa-list-ul" size="1em"></converse-icon>${o}</a>`,wh`<a class="dropdown-item show-bookmark-list-modal" role="button" @click="${t=>ad.modal.show("converse-bookmark-list-modal",{model:e.model},t)}" data-toggle="modal"><converse-icon class="fa fa-bookmark" size="1em"></converse-icon>${c}</a>`];return wh`<div class="d-flex controlbox-padded"><span class="w-100 controlbox-heading controlbox-heading--groupchats"><a class="list-toggle open-rooms-toggle" role="heading" aria-level="3" title="${i}" @click="${t=>e.toggleRoomsList(t)}">${r} ${s.length?wh`<converse-icon class="fa ${l?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--muc-color)"></converse-icon>`:""}</a></span><converse-dropdown class="btn-group dropstart" .items="${d}"></converse-dropdown></div><div class="list-container list-container--openrooms ${s.length?"":"hidden"}"><ul class="items-list rooms-list open-rooms-list ${l?"collapsed":""}">${t?LD(e,s):s.map((t=>zD(e,t)))}</ul></div>`})(this)}renderIfChatRoom(e){Rf.muc.isChatRoom(e)&&this.requestUpdate()}renderIfRelevantChange(e){const t=["bookmarked","hidden","name","num_unread","num_unread_general","has_activity"],n=e.changed||{};Rf.muc.isChatRoom(e)&&Object.keys(n).filter((e=>t.includes(e))).length&&this.requestUpdate()}async openRoom(e){e.preventDefault();const t=Rf.ancestor(e.target,".open-room"),n=t.getAttribute("data-room-name"),s=t.getAttribute("data-room-jid"),i={name:n||PD.unescapeNode(PD.getNodeFromJid(s))||s};await ad.rooms.open(s,i,!0)}async closeRoom(e){e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-room-name"),s=t.getAttribute("data-room-jid");if(await ad.confirm(C_("Confirm"),C_("Are you sure you want to leave the groupchat %1$s?",n))){(await ad.rooms.get(s)).close()}}toggleRoomsList(e){e?.preventDefault?.();const t=this.querySelector(".open-rooms-list");this.model.get("toggle_state")===BD?Rf.slideOut(t).then((()=>this.model.save({toggle_state:qD}))):Rf.slideIn(t).then((()=>this.model.save({toggle_state:BD})))}toggleDomainList(e,t){e?.preventDefault?.();const n=this.model.get("collapsed_domains");n.includes(t)?this.model.save({collapsed_domains:n.filter((e=>e!==t))}):this.model.save({collapsed_domains:[...n,t]})}}),Lf.plugins.add("converse-roomslist",{dependencies:["converse-singleton","converse-controlbox","converse-muc","converse-bookmarks"],initialize(){ad.settings.extend({muc_grouped_by_domain:!1}),ad.listen.on("clearSession",(()=>{Rf.shouldClearCache(uo)&&uo.state.roomslist?.destroy()}))}});function FD(){return window.matchMedia("(prefers-color-scheme: dark)").matches?ad.settings.get("dark_theme"):ad.settings.get("theme")}function HD(){if(!ad.settings.get("auto_insert"))return;const e=ad.settings.get("root");if(!e.querySelector("converse-root")&&!e.matches?.("converse-root")){const t=document.createElement("converse-root"),n=e.querySelector("body");n?n.appendChild(t):e.appendChild(t)}}var GD=n(5190),WD={};WD.styleTagTransform=L(),WD.setAttributes=I(),WD.insert=N().bind(null,"head"),WD.domAPI=T(),WD.insertStyleElement=D();C()(GD.A,WD);GD.A&&GD.A.locals&&GD.A.locals;class VD extends O_{render(){return(()=>{const e=ad.settings.get("singleton")?["converse-singleton"]:[];return e.push(`converse-${ad.settings.get("view_mode")}`),wh`${ad.settings.get("show_background")?wh`<converse-bg logo></converse-bg>`:""}<converse-chats class="converse-chatboxes row justify-content-start g-0 ${e.join(" ")}"></converse-chats><converse-modals id="converse-modals" class="modals"></converse-modals><converse-toasts></converse-toasts><converse-fontawesome></converse-fontawesome>`})()}initialize(){this.setAttribute("id","conversejs"),this.setThemeAttributes();const e=ad.settings.get();this.listenTo(e,"change:view_mode",(()=>this.setThemeAttributes())),this.listenTo(e,"change:singleton",(()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: light)").addListener((()=>this.setThemeAttributes()))}setThemeAttributes(){const e=FD();this.className="",this.classList.add("container-fluid"),this.classList.add("g-0"),this.classList.add("conversejs"),this.classList.add(`converse-${ad.settings.get("view_mode")}`),this.classList.add(`theme-${e}`),this.setAttribute("data-bs-theme",e),this.setAttribute("data-converse-theme",e);const t=j_.getLocale();this.setAttribute("lang",t);ad.settings.get("rtl_langs").includes(t)?this.setAttribute("dir","rtl"):this.setAttribute("dir","ltr"),this.requestUpdate()}}var KD=n(4842),JD={};JD.styleTagTransform=L(),JD.setAttributes=I(),JD.insert=N().bind(null,"head"),JD.domAPI=T(),JD.insertStyleElement=D();C()(KD.A,JD);KD.A&&KD.A.locals&&KD.A.locals;class YD extends O_{static get properties(){return{logo:{type:Boolean}}}initialize(){this.setThemeAttributes();const e=ad.settings.get();this.listenTo(e,"change:view_mode",(()=>this.setThemeAttributes())),this.listenTo(e,"change:singleton",(()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: light)").addListener((()=>this.setThemeAttributes()))}render(){return e=this,wh`${"cyberpunk"===ad.settings.get("theme")?wh`<section class="moving-grid"><div class="container"><div class="static-lines">${[...Array(20).keys()].map((()=>wh`<div class="vert"></div>`))}</div><div class="moving-lines">${[...Array(60).keys()].map((()=>wh`<div class="horz"></div>`))}</div></div></section>`:""} ${e.hasAttribute("logo")?wh`<div class="inner-content converse-brand row"><div class="converse-brand__heading"><converse-logo></converse-logo><span class="converse-brand__text"><span>converse<span class="subdued">.js</span></span><p class="byline">messaging freedom</p></span></div>${"overlayed"===ad.settings.get("view_mode")?wh`<div class="converse-brand__padding"></div>`:""}</div>`:""}`;var e}setThemeAttributes(){const e=FD();this.classList.add(`theme-${e}`),this.setAttribute("data-converse-theme",e),this.setAttribute("data-bs-theme",e),this.requestUpdate()}}ad.elements.define("converse-bg",YD);Lf.plugins.add("converse-rootview",{initialize(){ad.settings.extend({auto_insert:!0,dark_theme:"dracula",rtl_langs:["ar","fa","he","ug"],show_background:!1,theme:"classic"}),ad.listen.on("chatBoxesInitialized",HD),ad.elements.define("converse-root",VD)}});const XD={dnd:C_("This contact is busy"),online:C_("This contact is online"),offline:C_("This contact is offline"),unavailable:C_("This contact is unavailable"),xa:C_("This contact is away for an extended period"),away:C_("This contact is away")};function QD(e){const t=e.model.getDisplayName(),n=C_("Click to remove %1$s as a contact",t);return wh`<a class="dropdown-item remove-xmpp-contact" role="button" @click="${t=>e.removeContact(t)}" title="${n}" data-toggle="modal"><converse-icon class="fa fa-trash-alt" size="1em"></converse-icon>${C_("Remove")}</a>`}function ZD(e){const t=e.model.getDisplayName(),n=C_("Click to show more details about %1$s",t);return wh`<a class="dropdown-item" role="button" @click="${t=>e.showUserDetailsModal(t)}" title="${n}" data-toggle="modal"><converse-icon class="fa fa-id-card" size="1em"></converse-icon>${C_("Details")}</a>`}function ez(e){const t=e.model.getDisplayName(),n=C_("Click to add %1$s as a contact",t);return wh`<a class="dropdown-item add-contact" role="button" @click="${t=>e.addContact(t)}" title="${n}" data-toggle="modal"><converse-icon class="fa fa-user-plus" size="1.5em"></converse-icon>${C_("Save as contact")}</a>`}class tz extends Kx{constructor(){super(),this.model=null,this.observable="once"}static get properties(){return{...super.properties,model:{type:Object}}}initialize(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"highlight",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"presence:change",(()=>this.requestUpdate()))}render(){if(this.model instanceof uo.exports.RosterContact){if(!0===this.model.get("requesting"))return(e=>{const t=vC(e.model),n=e.model.get("jid"),s=e.model.getDisplayName(),i=C_("Click to accept the contact request from %1$s (XMPP address: %2$s)",s,n),r=C_("Click to decline the contact request from %1$s (XMPP address: %2$s)",s,n),o=C_("Click to chat with %1$s (XMPP address: %2$s)",s,n),a=[wh`<a class="dropdown-item accept-xmpp-request" role="button" @click="${t=>e.acceptRequest(t)}" aria-label="${i}" title="${i}" href="#"><converse-icon class="fa fa-check" size="1em"></converse-icon>${C_("Accept as contact")}</a>`,ZD(e),wh`<a class="dropdown-item decline-xmpp-request" role="button" @click="${t=>e.declineRequest(t)}" aria-label="${r}" title="${r}"><converse-icon class="fa fa-times" size="1em"></converse-icon>${C_("Remove")}</a>`];return wh`<a class="list-item-link cbox-list-item open-chat ${t?"unread-msgs":""}" title="${o}" href="#" data-jid="${n}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar></span>${t?wh`<span class="msgs-indicator badge">${t}</span>`:""} <span class="contact-name ${t?"unread-msgs":""}">${s}</span> </a><span class="contact-actions"><converse-dropdown class="btn-group dropstart list-item-action" .items="${a}"></converse-dropdown></span>`})(this);if(!this.model.get("subscription"))return(e=>{const t=vC(e.model),n=e.model.getDisplayName(),s=e.model.get("jid"),i=C_("Click to chat with %1$s (XMPP address: %2$s)",n,s),r=[ZD(e),ez(e),...ad.settings.get("allow_contact_removal")?[QD(e)]:[]];return wh`<a class="list-item-link cbox-list-item open-chat ${t?"unread-msgs":""}" title="${i}" href="#" data-jid="${s}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar></span>${t?wh`<span class="msgs-indicator badge">${t}</span>`:""} <span class="contact-name ${t?"unread-msgs":""}">${n}</span> </a><span class="contact-actions"><converse-dropdown class="btn-group dropstart list-item-action" .items="${r}"></converse-dropdown></span>`})(this)}return(e=>{const t=uo.session.get("bare_jid"),n=e.model.getStatus()||"offline";let s,i;[s,i]="online"===n?["fa fa-circle","chat-status-online"]:"dnd"===n?["fa fa-minus-circle","chat-status-busy"]:"away"===n?["fa fa-circle","chat-status-away"]:["fa fa-circle","chat-status-offline"];const r=t===e.model.get("jid"),o=XD[n],a=vC(e.model),c=e.model.getDisplayName({context:"roster"}),l=e.model.get("jid"),d=r?C_("Click to chat with yourself"):C_("Click to chat with %1$s (XMPP address: %2$s)",c,l),u=[ZD(e),...ad.settings.get("allow_contact_removal")&&!r?[QD(e)]:[]];return wh`<a class="list-item-link cbox-list-item open-chat ${a?"unread-msgs":""}" title="${d}" href="#" data-jid="${l}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><converse-icon title="${o}" color="var(--${i})" size="1em" class="${s} chat-status chat-status--avatar"></converse-icon></span>${a?wh`<span class="msgs-indicator badge">${a}</span>`:""} <span class="contact-name contact-name--${n} ${a?"unread-msgs":""}">${c}</span> </a><span class="contact-actions"><converse-dropdown class="btn-group dropstart list-item-action" .items="${u}"></converse-dropdown></span>`})(this)}openChat(e){e?.preventDefault?.(),ad.chats.open(this.model.get("jid"),{},!0)}addContact(e){e?.preventDefault?.(),ad.modal.show("converse-add-contact-modal",{contact:this.model,model:new ie.Model},e)}async removeContact(e){e?.preventDefault?.(),await mk(this.model,!0)}async showUserDetailsModal(e){e?.preventDefault?.(),e.preventDefault(),this.model instanceof uo.exports.Profile?ad.modal.show("converse-profile-modal",{model:this.model},e):ad.modal.show("converse-user-details-modal",{model:this.model},e)}async blockContact(e){e?.preventDefault?.(),await pk(this.model)}async acceptRequest(e){e?.preventDefault?.(),ad.modal.show("converse-accept-contact-request-modal",{model:new ie.Model,contact:this.model},e)}async declineRequest(e){e?.preventDefault?.(),gk(this.model)}}ad.elements.define("converse-roster-contact",tz);const nz=e=>{const t=C_("Add"),n=C_("name@example.org"),s=C_("Groups"),i=C_("Use commas to separate multiple values"),r=C_("Name"),o=ad.settings.get("xhr_user_search_url"),a=C_("XMPP Address"),c=o?C_("Search name or XMPP address"):a,l=e.model.get("error");return wh`<div class="modal-body">${l?wh`<div class="alert alert-danger" role="alert">${l}</div>`:""}<form class="converse-form add-xmpp-contact" @submit="${t=>e.addContactFromForm(t)}">${e.contact?wh`<input type="hidden" name="jid" value="${e.contact.get("jid")}">`:wh`<div class="mb-3"><label class="form-label clearfix" for="jid">${c}:</label> ${o?wh`<converse-autocomplete .getAutoCompleteList="${Sk}" position="below" min_chars="2" filter="contains" ?required="${!0}" value="${e.model.get("jid")||""}" placeholder="${n}" name="jid"></converse-autocomplete>`:wh`<converse-autocomplete .list="${function(){const e=uo.state.roster;return[...new Set(e.map((e=>hk.getDomainFromJid(e.get("jid")))))]}()}" .data="${(e,t)=>`${t.slice(0,t.indexOf("@"))}@${e}`}" position="below" min_chars="2" filter="startswith" ?required="${!ad.settings.get("xhr_user_search_url")}" value="${e.model.get("jid")||""}" placeholder="${n}" name="jid"></converse-autocomplete>`}</div>`} ${o?"":wh`<div class="mb-3"><label class="form-label clearfix" for="name">${r}:</label> <input type="text" name="name" value="${e.model.get("nickname")||""}" class="form-control"></div>`}<div class="mb-3"><label class="form-label clearfix" for="name">${s}:</label><div class="mb-1"><small class="form-text text-muted">${i}</small></div><converse-autocomplete .list="${wk()}" name="groups"></converse-autocomplete></div>${e.contact?wh`<div class="mb-3 d-flex justify-content-between"><label class="form-label clearfix w-100" for="jid-display">${a}:</label><p class="form-control-plaintext text-end" id="jid-display">${e.contact.get("jid")}</p></div>`:""} <button type="submit" class="btn btn-primary">${t}</button></form></div>`};var sz=n(3414),iz={};iz.styleTagTransform=L(),iz.setAttributes=I(),iz.insert=N().bind(null,"head"),iz.domAPI=T(),iz.insertStyleElement=D();C()(sz.A,iz);sz.A&&sz.A.locals&&sz.A.locals;ad.elements.define("converse-add-contact-modal",class extends aE{constructor(){super(),this.contact=null}initialize(){super.initialize(),this.listenTo(this.contact,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>this.querySelector('input[name="jid"]')?.focus()),!1)}renderModal(){return nz(this)}getModalTitle(){return C_("Add a Contact")}validateSubmission(e){return!e||e.split("@").filter((e=>!!e)).length<2?(this.model.set("error",C_("Please enter a valid XMPP address")),!1):!this.contact&&uo.state.roster.get(Cr.getBareJidFromJid(e))?(this.model.set("error",C_("This contact has already been added")),!1):(this.model.set("error",null),!0)}async afterSubmission(e,t,n){ad.contacts.add({jid:e,name:t,groups:n}).catch((e=>{Y.error(e),ad.toast.show("contact-add-error",{type:"danger",body:C_("Sorry, something went wrong while adding the contact")})})),ad.chats.open(e,{},!0),this.model.clear(),ad.toast.show("contact-added",{type:"success",body:C_("Contact added successfully")}),this.modal.hide()}async addContactFromForm(e){e.preventDefault();const t=e.target,n=new FormData(t);let s,i=(n.get("jid")||"").trim();if(ad.settings.get("xhr_user_search_url")){const e=i.match(/^(.*) <(.*)>$/);if(!e)return void this.model.set("error",C_('Invalid value for the name and XMPP address. Please use the format "Name <username@example.org>".'));s=e[1].trim(),i=e[2].trim()}else s=(n.get("name")||"").trim();if(this.validateSubmission(i)){const e=n.get("groups")?.split(",").map((e=>e.trim())).filter((e=>e))||[];this.afterSubmission(i,s,e),t.reset()}}});ad.elements.define("converse-accept-contact-request-modal",class extends aE{constructor(e){super(e),this.contact=null}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.contact,"change",(()=>this.requestUpdate())),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>this.querySelector('input[name="name"]')?.focus()),!1)}renderModal(){return(e=>{const t=C_("Accept"),n=C_("Groups"),s=C_("Use commas to separate multiple values"),i=C_("Name"),r=C_("XMPP Address"),o=e.model.get("error");return wh`<div class="modal-body">${o?wh`<div class="alert alert-danger" role="alert">${o}</div>`:""}<form class="converse-form" @submit="${t=>e.acceptContactRequest(t)}"><div class="mb-3"><label class="form-label clearfix" for="name">${i}:</label> <input type="text" name="name" value="${e.contact.vcard?.get("fullname")||""}" class="form-control"></div><div class="mb-3"><label class="form-label clearfix" for="name">${n}:</label><div class="mb-1"><small class="form-text text-muted">${s}</small></div><converse-autocomplete .list="${wk()}" name="groups"></converse-autocomplete></div><div class="mb-3 d-flex justify-content-between"><label class="form-label clearfix w-100" for="jid-display">${r}:</label><p class="form-control-plaintext text-end" id="jid-display">${e.contact.get("jid")}</p></div><button type="submit" class="btn btn-primary">${t}</button></form></div>`})(this)}getModalTitle(){return C_("Contact Request")}async acceptContactRequest(e){e.preventDefault();const t=e.target,n=new FormData(t),s=(n.get("name")||"").trim(),i=n.get("groups")?.split(",").map((e=>e.trim())).filter((e=>e))||[];try{await uo.state.roster.sendContactAddIQ({jid:this.contact.get("jid"),name:s,groups:i}),this.contact.authorize().subscribe()}catch(e){return Y.error(e),void ad.toast.show("accept-request-error",{type:"danger",body:C_("Sorry, something went wrong while accepting the contact request")})}this.contact.save({nickname:s,groups:i}),ad.toast.show("accept-request-success",{type:"success",body:C_("Successfully accepted the contact request")}),this.modal.hide()}});ad.elements.define("converse-new-chat-modal",class extends aE{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.requestUpdate(),this.addEventListener("shown.bs.modal",(()=>this.querySelector('input[name="jid"]')?.focus()),!1)}renderModal(){return(e=>{const t=C_("Start Chat"),n=C_("XMPP Address"),s=e.model.get("error");return wh`<div class="modal-body">${s?wh`<div class="alert alert-danger" role="alert">${s}</div>`:""}<form @submit="${t=>e.startChatFromForm(t)}"><div class="mb-3"><label class="form-label" for="jid">${n}</label> <input type="text" name="jid" class="form-control" required></div><button type="submit" class="btn btn-primary">${t}</button></form></div>`})(this)}getModalTitle(){return C_("Start a new chat")}validateSubmission(e){return!e||e.split("@").filter((e=>!!e)).length<2?(this.model.set("error",C_("Please enter a valid XMPP address")),!1):(this.model.set("error",null),!0)}async afterSubmission(e,t){try{await ad.chats.open(t,{},!0)}catch(e){return Y.error(e),void this.model.set("error",C_("Sorry, something went wrong"))}this.model.clear(),this.modal.hide()}async startChatFromForm(e){e.preventDefault();const t=e.target,n=(new FormData(t).get("jid")||"").trim();this.validateSubmission(n)&&this.afterSubmission(t,n)}});const{isUniView:rz}=Rf;function oz(e){const t=e.get("jid"),n=[];if(rz()){const e=uo.state.chatboxes.get(t);e&&!e.get("hidden")&&n.push("open")}const s=e.get("ask"),i=e.get("requesting"),r=e.get("subscription");return"subscribe"===s||"from"===r?n.push("pending-xmpp-contact"):!0===i?n.push("requesting-xmpp-contact"):("both"===r||"to"===r||Rf.isSameBareJID(t,ad.connection.get().jid))&&(n.push("current-xmpp-contact"),n.push(r),n.push(e.getStatus())),wh`<li class="list-item d-flex controlbox-padded ${n.join(" ")}" data-status="${e.getStatus()}"><converse-roster-contact .model="${e}"></converse-roster-contact></li>`}const az=e=>{const t=C_("Click to hide these contacts"),n=uo.state.roster.state.get("collapsed_groups");return wh`<div class="roster-group" data-group="${e.name}"><a href="#" class="list-toggle group-toggle controlbox-padded" title="${t}" @click="${t=>function(e,t){e?.preventDefault?.();const{roster:n}=uo.state,s=n.state.get("collapsed_groups");s.includes(t)?n.state.save("collapsed_groups",s.filter((e=>e!==t))):n.state.save("collapsed_groups",[...s,t])}(t,e.name)}"><converse-icon color="var(--chat-color)" size="1em" class="fa ${n.includes(e.name)?"fa-caret-right":"fa-caret-down"}"></converse-icon>${e.name}Â  ${e.contacts[0].get("requesting")?wh`<converse-icon color="var(--chat-color)" size="1.2em" class="fa fa-bell-alt"></converse-icon>`:""}</a><ul class="items-list roster-group-contacts ${n.includes(e.name)?"collapsed":""}" data-group="${e.name}">${nC(e.contacts,(e=>e.get("jid")),oz)}</ul></div>`},cz=e=>{const t=C_("Filter"),n=C_("Filter by contact name"),s=C_("Filter by group name"),i=C_("Filter by status"),r=C_("Any"),o=C_("Unread"),{offline:a,xa:c,away:l,dnd:d,chat:u,online:h}=a$,f=e.model.get("state"),m=e.model.get("text"),g=e.model.get("type");return wh`<form class="controlbox-padded items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="flex-nowrap"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===g?"selected":""}" data-type="items" title="${n}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-users clickable ${"groups"===g?"selected":""}" data-type="groups" title="${s}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===g?"selected":""}" data-type="state" title="${i}"></converse-icon></div><div class="btn-group"><input .value="${m||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===g?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${m&&"state"!==g?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==g?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${r}</option><option ?selected="${"unread_messages"===f}" value="unread_messages">${o}</option><option ?selected="${"online"===f}" value="online">${h}</option><option ?selected="${"chat"===f}" value="chat">${u}</option><option ?selected="${"dnd"===f}" value="dnd">${d}</option><option ?selected="${"away"===f}" value="away">${l}</option><option ?selected="${"xa"===f}" value="xa">${c}</option><option ?selected="${"offline"===f}" value="offline">${a}</option></select></div></form>`},{CLOSED:lz}=__,dz=e=>{const t=C_("Contacts"),n=C_("Click to toggle contacts"),s=C_("Add a contact"),i=C_("Start a new chat"),{state:r}=uo,o=[...r.roster||[],...ad.settings.get("show_self_in_roster")?[r.xmppstatus]:[]],a=o.reduce(((e,t)=>function(e,t){const{labels:n}=uo,s=Rf.unique(t.get("groups")??[]);Rf.isOwnJID(t.get("jid"))&&!s.length?s.push(n.HEADER_UNGROUPED):t.get("requesting")?s.push(n.HEADER_REQUESTING_CONTACTS):void 0===t.get("subscription")?s.push(n.HEADER_UNSAVED_CONTACTS):ad.settings.get("roster_groups")?s.length||s.push(n.HEADER_UNGROUPED):s.push(n.HEADER_CURRENT_CONTACTS);for(const n of s)e[n]?.includes(t)||(e[n]?e[n].push(t):e[n]=[t]);if(t.get("num_unread")){const s=n.HEADER_UNREAD;e[s]?e[s].push(t):e[s]=[t]}return e}(e,t)),{}),c=Object.keys(a).filter((t=>function(e,t){if(!t.get("filter_visible"))return!0;const n=uo.state.roster_filter;if("groups"===n.get("type")){const t=n.get("text")?.toLowerCase();if(!t)return!0;if(!e.toLowerCase().includes(t))return!1}return!0}(t,e.model))),l=e.model.get("toggle_state")===lz;c.sort(_k);const d=C_("Show filter"),u=C_("Hide filter"),h=e.model.get("filter_visible"),f=[];if(ad.settings.get("allow_contact_requests")&&f.push(wh`<a href="#" class="dropdown-item add-contact" role="button" @click="${t=>e.showAddContactModal(t)}" title="${s}" data-toggle="modal" data-target="#add-contact-modal"><converse-icon class="fa fa-user-plus" size="1em"></converse-icon>${s}</a>`),ad.settings.get("allow_non_roster_messaging")&&f.push(wh`<a href="#" class="dropdown-item new-chat" role="button" @click="${t=>e.showNewChatModal(t)}" title="${i}" data-toggle="modal" data-target="#new-chat-modal"><converse-icon class="fa fa-user-plus" size="1em"></converse-icon>${i}</a>`),o.length>5&&f.push(wh`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${h?u:d}</a>`),"debug"===ad.settings.get("loglevel")){const t=C_("Re-sync contacts");f.push(wh`<a href="#" class="dropdown-item" role="button" @click="${t=>e.syncContacts(t)}" title="${t}"><converse-icon class="fa fa-sync sync-contacts" size="1em"></converse-icon>${t}</a>`)}return wh`<div class="d-flex controlbox-padded"><span class="w-100 controlbox-heading controlbox-heading--contacts"><a class="list-toggle open-contacts-toggle" title="${n}" role="heading" aria-level="3" @click="${e.toggleRoster}">${t} ${o.length?wh`<converse-icon class="fa ${l?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--chat-color)"></converse-icon>`:""}</a></span><converse-dropdown class="chatbox-btn btn-group dropstart dropdown--contacts" .items="${f}"></converse-dropdown></div><div class="list-container roster-contacts ${l?"hidden":""}">${h?wh`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${ad.waitUntil("rosterInitialized")}" .items="${uo.state.roster}" .template="${cz}" .model="${uo.state.roster_filter}"></converse-list-filter>`:""} ${nC(c,(e=>e),(t=>{const n=a[t].filter((n=>function(e,t,n){if(!n.get("filter_visible"))return!0;const s=e.getStatus();return ad.settings.get("hide_offline_users")&&"offline"===s?("subscribe"===e.get("ask")||"from"===e.get("subscription")||!0===e.get("requesting"))&&!bk(e,t):!bk(e,t)}(n,t,e.model)));return n.sort(yk),n.length?az({contacts:n,name:t}):""}))}</div>`},{initStorage:uz}=Rf,{CLOSED:hz,OPENED:fz}=__;ad.elements.define("converse-roster",class extends O_{async initialize(){const e=`converse.contacts-panel${uo.session.get("bare_jid")}`;this.model=new ie.Model({id:e}),uz(this.model,e),this.model.fetch(),await ad.waitUntil("rosterInitialized");const{chatboxes:t,presences:n,roster:s}=uo.state;this.listenTo(uo,"rosterContactsFetched",(()=>this.requestUpdate())),this.listenTo(n,"change:show",(()=>this.requestUpdate())),this.listenTo(t,"change:hidden",(()=>this.requestUpdate())),this.listenTo(s,"add",(()=>this.requestUpdate())),this.listenTo(s,"destroy",(()=>this.requestUpdate())),this.listenTo(s,"remove",(()=>this.requestUpdate())),this.listenTo(s,"change",(()=>this.requestUpdate())),this.listenTo(s,"presence:change",(()=>this.requestUpdate())),this.listenTo(s.state,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),ad.trigger("rosterViewInitialized")}render(){return dz(this)}showAddContactModal(e){ad.modal.show("converse-add-contact-modal",{model:new ie.Model},e)}showNewChatModal(e){ad.modal.show("converse-new-chat-modal",{model:new ie.Model},e)}async syncContacts(e){e?.preventDefault();const{roster:t}=uo.state;this.syncing_contacts=!0,this.requestUpdate(),t.data.save("version",null),await t.fetchFromServer(),ad.user.presence.send(),this.syncing_contacts=!1,this.requestUpdate()}toggleRoster(e){e?.preventDefault?.();const t=this.querySelector(".list-container.roster-contacts");this.model.get("toggle_state")===hz?jw(t).then((()=>this.model.save({toggle_state:fz}))):Cw(t).then((()=>this.model.save({toggle_state:hz})))}toggleFilter(e){e?.preventDefault?.(),this.model.save({filter_visible:!this.model.get("filter_visible")})}});var mz=n(7702),gz={};gz.styleTagTransform=L(),gz.setAttributes=I(),gz.insert=N().bind(null,"head"),gz.domAPI=T(),gz.insertStyleElement=D();C()(mz.A,gz);mz.A&&mz.A.locals&&mz.A.locals;Lf.plugins.add("converse-rosterview",{dependencies:["converse-roster","converse-modal","converse-chatboxviews","converse-blocklist"],initialize(){ad.settings.extend({allow_contact_removal:!0,hide_offline_users:!1,roster_groups:!0,xhr_user_search_url:null}),ad.promises.add("rosterViewInitialized");const e={RosterFilter:kv,RosterContactView:tz};Object.assign(uo,e),Object.assign(uo.exports,e),ad.listen.on("chatBoxesInitialized",(()=>{uo.state.chatboxes.on("destroy",(e=>vk(e.get("jid")))),uo.state.chatboxes.on("change:hidden",(e=>vk(e.get("jid"))))}))}});var pz=n(8562),vz={};vz.styleTagTransform=L(),vz.setAttributes=I(),vz.insert=N().bind(null,"head"),vz.domAPI=T(),vz.insertStyleElement=D();C()(pz.A,vz);pz.A&&pz.A.locals&&pz.A.locals;Lf.plugins.add("converse-singleton",{enabled:e=>e.api.settings.get("singleton"),initialize(){ad.settings.extend({allow_logout:!1,allow_muc_invitations:!1,hide_muc_server:!0});const e=ad.settings.get("auto_join_rooms"),t=ad.settings.get("auto_join_private_chats");if(!Array.isArray(e)&&!Array.isArray(t))throw new Error("converse-singleton: auto_join_rooms must be an Array");if(0===e.length&&0===t.length)throw new Error("If you set singleton set to true, you need to specify auto_join_rooms or auto_join_private_chats");if(e.length>0&&t.length>0)throw new Error("It doesn't make sense to have singleton set to true and auto_join_rooms or auto_join_private_chats set to more then one, since only one chat room may be open at any time.")}});const{u:bz}=Lf.env;function yz(){document.addEventListener("mousemove",Cz),document.addEventListener("mouseup",kz)}function _z(){document.removeEventListener("mousemove",Cz),document.removeEventListener("mouseup",kz)}function wz(e){const t=Array.from(document.getElementsByTagName("iframe"));for(const n of t)e.addEventListener("mousedown",(()=>{n.style.pointerEvents="none"}),{once:!0}),e.addEventListener("mouseup",(()=>{n.style.pointerEvents="initial"}),{once:!0})}function Sz(e){const t=e.get("height"),n=e.get("width");bz.safeSave(e,{height:jz(t,e.get("default_height")),width:jz(n,e.get("default_width"))})}const Az={};function xz(e,t=!0){if(!ad.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=bz.ancestor(e.target,".box-flyout"),s=window.getComputedStyle(n),i=n.parentElement;i.height=parseInt(s.height.replace(/px$/,""),10),Az.chatbox=i,Az.direction="top",i.prev_pageY=e.pageY,t&&ad.trigger("startVerticalResize",i)}function $z(e,t=!0){if(!ad.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=bz.ancestor(e.target,".box-flyout"),s=window.getComputedStyle(n),i=n.parentElement;i.width=parseInt(s.width.replace(/px$/,""),10),Az.chatbox=i,Az.direction="left",i.prev_pageX=e.pageX,t&&ad.trigger("startHorizontalResize",i)}function Ez(e){$z(e,!1),xz(e,!1),Az.direction="topleft",ad.trigger("startDiagonalResize",this)}function jz(e,t){if(void 0===e)return;if(void 0===t)return e;return e!==t&&Math.abs(e-t)<10?t:e}function Cz(e){if(!Az.chatbox||!ad.settings.get("allow_dragresize"))return!0;e.preventDefault(),Az.chatbox.resizeChatBox(e)}function kz(e){if(!Az.chatbox||!ad.settings.get("allow_dragresize"))return!0;e.preventDefault();const t=jz(Az.chatbox.height,Az.chatbox.model.get("default_height")),n=jz(Az.chatbox.width,Az.chatbox.model.get("default_width"));ad.connection.connected()?(Az.chatbox.model.save({height:t}),Az.chatbox.model.save({width:n})):(Az.chatbox.model.set({height:t}),Az.chatbox.model.set({width:n})),delete Az.chatbox,delete Az.direction}const Tz=()=>wh`<div class="dragresize dragresize-top" @mousedown="${xz}"></div><div class="dragresize dragresize-topleft" @mousedown="${Ez}"></div><div class="dragresize dragresize-left" @mousedown="${$z}"></div>`;ad.elements.define("converse-dragresize",class extends O_{render(){return Tz()}});const Oz={initDragResize(){const e=$o((()=>this.setDimensions()));window.addEventListener("resize",e),this.listenTo(this.model,"destroy",(()=>window.removeEventListener("resize",e)));const t=this.querySelector(".box-flyout"),n=window.getComputedStyle(t);if(void 0===this.model.get("height")){const e=parseInt(n.height.replace(/px$/,""),10),t=parseInt(n.width.replace(/px$/,""),10);this.model.set("height",e),this.model.set("default_height",e),this.model.set("width",t),this.model.set("default_width",t)}const s=n["min-width"],i=n["min-height"];return this.model.set("min_width",s.endsWith("px")?Number(s.replace(/px$/,"")):0),this.model.set("min_height",i.endsWith("px")?Number(i.replace(/px$/,"")):0),this.prev_pageY=0,this.prev_pageX=0,ad.connection.get()?.connected&&(this.height=this.model.get("height"),this.width=this.model.get("width")),this},resizeChatBox(e){let t;const n=Az.direction;if(0===n.indexOf("top")){const n=ad.settings.get("dragresize_top_margin")??0,s=window.innerHeight-n;if(t=e.pageY-this.prev_pageY,t){const n=this.height-t;console.log("------------"),console.log(`window.innerHeight: ${window.innerHeight}`),console.log(`max_height: ${s}`),console.log(`new_height: ${n}`),console.log(`diff: ${t}`),this.height=this.height-t>(this.model.get("min_height")||0)?n<=s?n:s:this.model.get("min_height"),this.prev_pageY=e.pageY,this.setChatBoxHeight(this.height)}}n.includes("left")&&(t=this.prev_pageX-e.pageX,t&&(this.width=this.width+t>(this.model.get("min_width")||0)?this.width+t:this.model.get("min_width"),this.prev_pageX=e.pageX,this.setChatBoxWidth(this.width)))},setDimensions(){this.adjustToViewport(),this.setChatBoxWidth(this.model.get("width")),"overlayed"===ad.settings.get("view_mode")&&this.setChatBoxHeight(this.model.get("height"))},setChatBoxHeight(e){const t=this.querySelector(".box-flyout");null!==t&&(t.style.height=e?jz(e,this.model.get("default_height"))+"px":"")},setChatBoxWidth(e){const t=e?jz(e,this.model.get("default_width"))+"px":"";this.style.width=t;const n=this.querySelector(".box-flyout");null!==n&&(n.style.width=t)},adjustToViewport(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e<=480?(this.model.set("height",void 0),this.model.set("width",void 0)):e<=this.model.get("width")?this.model.set("width",void 0):t<=this.model.get("height")&&this.model.set("height",void 0)}};Lf.plugins.add("converse-dragresize",{dependencies:["converse-chatview","converse-headlines-view","converse-muc-views"],enabled:()=>"overlayed"==ad.settings.get("view_mode"),initialize(){ad.settings.extend({allow_dragresize:!0,dragresize_top_margin:0}),Object.assign(uo.exports.ChatView?.prototype??{},Oz),Object.assign(uo.exports.MUCView?.prototype??{},Oz),Object.assign(uo.exports.HeadlinesFeedView?.prototype??{},Oz),Object.assign(uo.exports.ControlBoxView?.prototype??{},Oz),ad.listen.on("headlinesFeedInitialized",Sz),ad.listen.on("chatBoxInitialized",Sz),ad.listen.on("chatRoomInitialized",Sz),ad.listen.on("registeredGlobalEventHandlers",yz),ad.listen.on("unregisteredGlobalEventHandlers",_z),ad.listen.on("beforeShowingChatView",(e=>e.initDragResize().setDimensions())),ad.listen.on("startDiagonalResize",wz),ad.listen.on("startHorizontalResize",wz),ad.listen.on("startVerticalResize",wz)}});var Nz=n(5431),Mz={};Mz.styleTagTransform=L(),Mz.setAttributes=I(),Mz.insert=N().bind(null,"head"),Mz.domAPI=T(),Mz.insertStyleElement=D();C()(Nz.A,Mz);Nz.A&&Nz.A.locals&&Nz.A.locals;const{isUniView:Iz}=Rf;Lf.plugins.add("converse-fullscreen",{enabled:()=>Iz(),initialize(){ad.settings.extend({chatview_avatar_height:50,chatview_avatar_width:50,hide_open_bookmarks:!0,show_controlbox_by_default:!0,sticky_controlbox:!0})}}),uo.exports.CustomElement=O_;const Rz=Lf.initialize;Lf.initialize=function(e,t){return Array.isArray(e.whitelisted_plugins)?e.whitelisted_plugins=e.whitelisted_plugins.concat(o$):e.whitelisted_plugins=o$,Rz(e,t)};const Dz=Lf},5431:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5501:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5646:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,s="millisecond",i="second",r="minute",o="hour",a="day",c="week",l="month",d="quarter",u="year",h="date",f="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var s=String(e);return!s||s.length>=t?e:""+Array(t+1-s.length).join(n)+e},b={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),s=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+v(s,2,"0")+":"+v(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var s=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(s,l),r=n-i<0,o=t.clone().add(s+(r?-1:1),l);return+(-(s+(n-i)/(r?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:u,w:c,d:a,D:h,h:o,m:r,s:i,ms:s,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",_={};_[y]=p;var w="$isDayjsObject",S=function(e){return e instanceof E||!(!e||!e[w])},A=function e(t,n,s){var i;if(!t)return y;if("string"==typeof t){var r=t.toLowerCase();_[r]&&(i=r),n&&(_[r]=n,i=r);var o=t.split("-");if(!i&&o.length>1)return e(o[0])}else{var a=t.name;_[a]=t,i=a}return!s&&i&&(y=i),i||!s&&y},x=function(e,t){if(S(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new E(n)},$=b;$.l=A,$.i=S,$.w=function(e,t){return x(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function p(e){this.$L=A(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var v=p.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if($.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var s=t.match(m);if(s){var i=s[2]-1||0,r=(s[7]||"0").substring(0,3);return n?new Date(Date.UTC(s[1],i,s[3]||1,s[4]||0,s[5]||0,s[6]||0,r)):new Date(s[1],i,s[3]||1,s[4]||0,s[5]||0,s[6]||0,r)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return $},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(e,t){var n=x(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return x(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<x(e)},v.$g=function(e,t,n){return $.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,s=!!$.u(t)||t,d=$.p(e),f=function(e,t){var i=$.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return s?i:i.endOf(a)},m=function(e,t){return $.w(n.toDate()[e].apply(n.toDate("s"),(s?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,p=this.$M,v=this.$D,b="set"+(this.$u?"UTC":"");switch(d){case u:return s?f(1,0):f(31,11);case l:return s?f(1,p):f(0,p+1);case c:var y=this.$locale().weekStart||0,_=(g<y?g+7:g)-y;return f(s?v-_:v+(6-_),p);case a:case h:return m(b+"Hours",0);case o:return m(b+"Minutes",1);case r:return m(b+"Seconds",2);case i:return m(b+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=$.p(e),d="set"+(this.$u?"UTC":""),f=(n={},n[a]=d+"Date",n[h]=d+"Date",n[l]=d+"Month",n[u]=d+"FullYear",n[o]=d+"Hours",n[r]=d+"Minutes",n[i]=d+"Seconds",n[s]=d+"Milliseconds",n)[c],m=c===a?this.$D+(t-this.$W):t;if(c===l||c===u){var g=this.clone().set(h,1);g.$d[f](m),g.init(),this.$d=g.set(h,Math.min(this.$D,g.daysInMonth())).$d}else f&&this.$d[f](m);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[$.p(e)]()},v.add=function(s,d){var h,f=this;s=Number(s);var m=$.p(d),g=function(e){var t=x(f);return $.w(t.date(t.date()+Math.round(e*s)),f)};if(m===l)return this.set(l,this.$M+s);if(m===u)return this.set(u,this.$y+s);if(m===a)return g(1);if(m===c)return g(7);var p=(h={},h[r]=t,h[o]=n,h[i]=e,h)[m]||1,v=this.$d.getTime()+s*p;return $.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var s=e||"YYYY-MM-DDTHH:mm:ssZ",i=$.z(this),r=this.$H,o=this.$m,a=this.$M,c=n.weekdays,l=n.months,d=n.meridiem,u=function(e,n,i,r){return e&&(e[n]||e(t,s))||i[n].slice(0,r)},h=function(e){return $.s(r%12||12,e,"0")},m=d||function(e,t,n){var s=e<12?"AM":"PM";return n?s.toLowerCase():s};return s.replace(g,(function(e,s){return s||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return $.s(t.$y,4,"0");case"M":return a+1;case"MM":return $.s(a+1,2,"0");case"MMM":return u(n.monthsShort,a,l,3);case"MMMM":return u(l,a);case"D":return t.$D;case"DD":return $.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(n.weekdaysMin,t.$W,c,2);case"ddd":return u(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(r);case"HH":return $.s(r,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return m(r,o,!0);case"A":return m(r,o,!1);case"m":return String(o);case"mm":return $.s(o,2,"0");case"s":return String(t.$s);case"ss":return $.s(t.$s,2,"0");case"SSS":return $.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(s,h,f){var m,g=this,p=$.p(h),v=x(s),b=(v.utcOffset()-this.utcOffset())*t,y=this-v,_=function(){return $.m(g,v)};switch(p){case u:m=_()/12;break;case l:m=_();break;case d:m=_()/3;break;case c:m=(y-b)/6048e5;break;case a:m=(y-b)/864e5;break;case o:m=y/n;break;case r:m=y/t;break;case i:m=y/e;break;default:m=y}return f?m:$.a(m)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return _[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),s=A(e,t,!0);return s&&(n.$L=s),n},v.clone=function(){return $.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},p}(),j=E.prototype;return x.prototype=j,[["$ms",s],["$s",i],["$m",r],["$H",o],["$W",a],["$M",l],["$y",u],["$D",h]].forEach((function(e){j[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),x.extend=function(e,t){return e.$i||(e(t,E,x),e.$i=!0),x},x.locale=A,x.isDayjs=S,x.unix=function(e){return x(1e3*e)},x.en=_[y],x.Ls=_,x.p={},x}()},5832:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5909:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6120:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6215:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6264:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6524:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6669:(e,t,n)=>{var s={"./af.js":[53,5628],"./am.js":[6196,8489],"./ar-dz.js":[2188,3741],"./ar-iq.js":[6216,6605],"./ar-kw.js":[1536,861],"./ar-ly.js":[3053,1696],"./ar-ma.js":[92,7385],"./ar-sa.js":[4350,131],"./ar-tn.js":[4128,7801],"./ar.js":[1193,8880],"./az.js":[7425,9080],"./be.js":[6363,2366],"./bg.js":[2749,1072],"./bi.js":[9271,1938],"./bm.js":[9235,6486],"./bn-bd.js":[9873,6124],"./bn.js":[5625,9423],"./bo.js":[8725,1464],"./br.js":[2194,2643],"./bs.js":[6097,1116],"./ca.js":[9710,9395],"./cs.js":[1092,5825],"./cv.js":[3871,2766],"./cy.js":[8406,7003],"./da.js":[2685,6208],"./de-at.js":[9803,5534],"./de-ch.js":[5437,6064],"./de.js":[9553,5036],"./dv.js":[2568,2993],"./el.js":[2103,9782],"./en-au.js":[4348,6121],"./en-ca.js":[830,5611],"./en-gb.js":[1295,4094],"./en-ie.js":[9044,1665],"./en-il.js":[3939,8178],"./en-in.js":[8213,7028],"./en-nz.js":[7222,8343],"./en-sg.js":[8776,3341],"./en-tt.js":[5586,7627],"./en.js":[9241,6824],"./eo.js":[8378,8031],"./es-do.js":[9042,9271],"./es-mx.js":[1334,591],"./es-pr.js":[6977,2856],"./es-us.js":[6723,4182],"./es.js":[5790,1827],"./et.js":[3407,385],"./eu.js":[8792,933],"./fa.js":[8851,598],"./fi.js":[9835,3166],"./fo.js":[206,7596],"./fr-ca.js":[6671,9870],"./fr-ch.js":[1312,9101],"./fr.js":[9734,8431],"./fy.js":[8619,9710],"./ga.js":[4274,7743],"./gd.js":[9050,5284],"./gl.js":[1781,5724],"./gom-latn.js":[9283,8630],"./gu.js":[6014,8443],"./he.js":[93,2384],"./hi.js":[9961,4852],"./hr.js":[7880,2241],"./ht.js":[654,6007],"./hu.js":[1431,1712],"./hy-am.js":[2228,9589],"./id.js":[9371,4770],"./is.js":[9890,3359],"./it-ch.js":[9839,4718],"./it.js":[1163,4034],"./ja.js":[3543,4434],"./jv.js":[4598,9007],"./ka.js":[5174,4523],"./kk.js":[7860,6641],"./km.js":[98,3287],"./kn.js":[4287,4974],"./ko.js":[7480,8789],"./ku.js":[6778,687],"./ky.js":[126,7491],"./lb.js":[2860,1373],"./lo.js":[7343,6042],"./lt.js":[4522,4859],"./lv.js":[9904,9593],"./me.js":[7923,4333],"./mi.js":[1652,3729],"./mk.js":[3582,5059],"./ml.js":[5887,5998],"./mn.js":[6721,1056],"./mr.js":[9349,4260],"./ms-my.js":[3933,4512],"./ms.js":[7430,2091],"./mt.js":[4583,3014],"./my.js":[6004,561],"./nb.js":[8078,7],"./ne.js":[7087,5946],"./nl-be.js":[9092,9109],"./nl.js":[8624,7497],"./nn.js":[9418,1275],"./oc-lnc.js":[7766,1719],"./pa-in.js":[8069,2664],"./pl.js":[5406,6343],"./pt-br.js":[7035,2014],"./pt.js":[2838,6191],"./rn.js":[1558,3519],"./ro.js":[3397,4584],"./ru.js":[7867,7806],"./rw.js":[1005,8176],"./sd.js":[1985,3664],"./se.js":[4098,9975],"./si.js":[8646,9547],"./sk.js":[8764,6537],"./sl.js":[3401,8232],"./sq.js":[7422,9411],"./sr-cyrl.js":[5894,9331],"./sr.js":[8747,4858],"./ss.js":[9220,2769],"./sv-fi.js":[4193,6660],"./sv.js":[4271,1982],"./sw.js":[2952,2389],"./ta.js":[3437,832],"./te.js":[5873,4636],"./tet.js":[4705,8592],"./tg.js":[6943,7962],"./th.js":[278,6655],"./tk.js":[7395,422],"./tl-ph.js":[2067,8022],"./tlh.js":[7e3,8945],"./tr.js":[7796,9557],"./tzl.js":[2978,3683],"./tzm-latn.js":[1395,138],"./tzm.js":[609,9052],"./ug-cn.js":[9706,3731],"./uk.js":[4390,4107],"./ur.js":[3837,1388],"./uz-latn.js":[3647,5970],"./uz.js":[8421,948],"./vi.js":[4459,3774],"./x-pseudo.js":[815,5790],"./yo.js":[8214,6803],"./zh-cn.js":[5860,4385],"./zh-hk.js":[4324,7013],"./zh-tw.js":[5892,7981],"./zh.js":[6920,4497]};function i(e){if(!n.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,23)))}i.keys=()=>Object.keys(s),i.id=6669,e.exports=i},6759:(e,t,n)=>{e.exports=function e(t,n,s){function i(o,a){if(!n[o]){if(!t[o]){if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return i(n||e)}),l,l.exports,e,t,n,s)}return n[o].exports}for(var r=void 0,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e,t,s){(function(e){"use strict";var n,s,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var r=0,o=new i(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,n=function(){c.port2.postMessage(0)}}var l=[];function d(){var e,t;s=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}s=!1}function u(e){1!==l.push(e)||s||n()}t.exports=u}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var s=e(1);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){s((function(){var s;try{s=t(n)}catch(t){return r.reject(e,t)}s===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,s)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function s(t){n||(n=!0,r.reject(e,t))}function i(t){n||(n=!0,r.resolve(e,t))}function o(){t(i,s)}var a=m(o);"error"===a.status&&s(a.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function g(e){return e instanceof this?e:r.resolve(new this(i),e)}function p(e){var t=new this(i);return r.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,l=new this(i);++c<n;)d(e[c],c);return l;function d(e,i){function c(e){o[i]=e,++a!==n||s||(s=!0,r.resolve(l,o))}t.resolve(e).then(c,(function(e){s||(s=!0,r.reject(l,e))}))}}function b(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(i);++o<n;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){s||(s=!0,r.resolve(a,e))}),(function(e){s||(s=!0,r.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?u(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=m(h,t);if("error"===n.status)return r.reject(e,n.value);var s=n.value;if(s)f(e,s);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},l.resolve=g,l.reject=p,l.all=v,l.race=b},{1:1}],3:[function(e,t,s){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=r();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function d(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var m="local-forage-detect-blob-support",g=void 0,p={},v=Object.prototype.toString,b="readonly",y="readwrite";function _(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),i=0;i<t;i++)s[i]=e.charCodeAt(i);return n}function w(e){return new l((function(t){var n=e.transaction(m,y),s=c([""]);n.objectStore(m).put(s,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof g?l.resolve(g):w(e).then((function(e){return g=e}))}function A(e){var t=p[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function x(e){var t=p[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function $(e,t){var n=p[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function E(e,t){return new l((function(n,s){if(p[e.name]=p[e.name]||D(),e.db){if(!t)return n(e.db);A(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=o.open.apply(o,i);t&&(r.onupgradeneeded=function(t){var n=r.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(m)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),s(r.error)},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close()},n(t),x(e)}}))}function j(e){return E(e,!1)}function C(e){return E(e,!0)}function k(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,i=e.version>e.db.version;if(s&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function T(e){return new l((function(t,n){var s=new FileReader;s.onerror=n,s.onloadend=function(n){var s=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:s,type:e.type})},s.readAsBinaryString(e)}))}function O(e){return c([_(atob(e.data))],{type:e.type})}function N(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,n=t._initReady().then((function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(n,e,e),n}function I(e){A(e);for(var t=p[e.name],n=t.forages,s=0;s<n.length;s++){var i=n[s];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,j(e).then((function(t){return e.db=t,k(e)?C(e):t})).then((function(s){e.db=t.db=s;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=s})).catch((function(t){throw $(e,t),t}))}function R(e,t,n,s){void 0===s&&(s=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(s>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),C(e)})).then((function(){return I(e).then((function(){R(e,t,n,s-1)}))})).catch(n);n(i)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function z(e){var t=this,n={db:null};if(e)for(var s in e)n[s]=e[s];var i=p[n.name];i||(i=D(),p[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=M);var r=[];function o(){return l.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&r.push(c._initReady().catch(o))}var d=i.forages.slice(0);return l.all(r).then((function(){return n.db=i.db,j(n)})).then((function(e){return n.db=e,k(n,t._defaultConfig.version)?C(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var s=0;s<d.length;s++){var r=d[s];r!==t&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}}))}function L(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){R(n._dbInfo,b,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),N(e)&&(e=O(e)),t(e)},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function P(e,t){var n=this,s=new l((function(t,s){n.ready().then((function(){R(n._dbInfo,b,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var s=n.value;N(s)&&(s=O(s));var i=e(s,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function U(e,t,n){var s=this;e=h(e);var i=new l((function(n,i){var r;s.ready().then((function(){return r=s._dbInfo,"[object Blob]"===v.call(t)?S(r.db).then((function(e){return e?t:T(t)})):t})).then((function(t){R(s._dbInfo,y,(function(r,o){if(r)return i(r);try{var a=o.objectStore(s._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return d(i,n),i}function B(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){R(n._dbInfo,y,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){s(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function q(e){var t=this,n=new l((function(e,n){t.ready().then((function(){R(t._dbInfo,y,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function F(e){var t=this,n=new l((function(e,n){t.ready().then((function(){R(t._dbInfo,b,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function H(e,t){var n=this,s=new l((function(t,s){e<0?t(null):n.ready().then((function(){R(n._dbInfo,b,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){s(c.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function G(e){var t=this,n=new l((function(e,n){t.ready().then((function(){R(t._dbInfo,b,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function W(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,i=this;if(e.name){var r=e.name===n.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):j(e).then((function(t){var n=p[e.name],s=n.forages;n.db=t;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=t;return t}));s=e.storeName?r.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;A(e);var s=p[e.name],i=s.forages;t.close();for(var r=0;r<i.length;r++){var a=i[r];a._dbInfo.db=null,a._dbInfo.version=n}var c=new l((function(t,s){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),s(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){s.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,x(n._dbInfo)}})).catch((function(t){throw($(e,t)||l.resolve()).catch((function(){})),t}))}})):r.then((function(t){A(e);var n=p[e.name],s=n.forages;t.close();for(var i=0;i<s.length;i++)s[i]._dbInfo.db=null;var r=new l((function(t,n){var s=o.deleteDatabase(e.name);s.onerror=function(){var e=s.result;e&&e.close(),n(s.error)},s.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},s.onsuccess=function(){var e=s.result;e&&e.close(),t(e)}}));return r.then((function(e){n.db=e;for(var t=0;t<s.length;t++)x(s[t]._dbInfo)})).catch((function(t){throw($(e,t)||l.resolve()).catch((function(){})),t}))}))}else s=l.reject("Invalid arguments");return d(s,t),s}var V={_driver:"asyncStorage",_initStorage:z,_support:a(),iterate:P,getItem:L,setItem:U,removeItem:B,clear:q,length:F,key:H,keys:G,dropInstance:W};function K(){return"function"==typeof openDatabase}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y="~~local_forage_type~",X=/^~~local_forage_type~([^~]+)~/,Q="__lfsc__:",Z=Q.length,ee="arbf",te="blob",ne="si08",se="ui08",ie="uic8",re="si16",oe="si32",ae="ur16",ce="ui32",le="fl32",de="fl64",ue=Z+ee.length,he=Object.prototype.toString;function fe(e){var t,n,s,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=J.indexOf(e[t]),s=J.indexOf(e[t+1]),i=J.indexOf(e[t+2]),r=J.indexOf(e[t+3]),d[c++]=n<<2|s>>4,d[c++]=(15&s)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function me(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=J[n[t]>>2],s+=J[(3&n[t])<<4|n[t+1]>>4],s+=J[(15&n[t+1])<<2|n[t+2]>>6],s+=J[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}function ge(e,t){var n="";if(e&&(n=he.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var s,i=Q;e instanceof ArrayBuffer?(s=e,i+=ee):(s=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=se:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=re:"[object Uint16Array]"===n?i+=ae:"[object Int32Array]"===n?i+=oe:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=le:"[object Float64Array]"===n?i+=de:t(new Error("Failed to get type for BinaryArray"))),t(i+me(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n=Y+e.type+"~"+me(this.result);t(Q+te+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function pe(e){if(e.substring(0,Z)!==Q)return JSON.parse(e);var t,n=e.substring(ue),s=e.substring(Z,ue);if(s===te&&X.test(n)){var i=n.match(X);t=i[1],n=n.substring(i[0].length)}var r=fe(n);switch(s){case ee:return r;case te:return c([r],{type:t});case ne:return new Int8Array(r);case se:return new Uint8Array(r);case ie:return new Uint8ClampedArray(r);case re:return new Int16Array(r);case ae:return new Uint16Array(r);case oe:return new Int32Array(r);case ce:return new Uint32Array(r);case le:return new Float32Array(r);case de:return new Float64Array(r);default:throw new Error("Unkown type: "+s)}}var ve={serialize:ge,deserialize:pe,stringToBuffer:fe,bufferToString:me};function be(e,t,n,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,s)}function ye(e){var t=this,n={db:null};if(e)for(var s in e)n[s]="string"!=typeof e[s]?e[s].toString():e[s];var i=new l((function(e,s){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return s(e)}n.db.transaction((function(i){be(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){s(t)}))}),s)}));return n.serializer=ve,i}function _e(e,t,n,s,i,r){e.executeSql(n,s,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):be(e,t,(function(){e.executeSql(n,s,i,r)}),r)}),r):r(e,o)}),r)}function we(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var s=n.rows.length?n.rows.item(0).value:null;s&&(s=i.serializer.deserialize(s)),t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function Se(e,t){var n=this,s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName,[],(function(n,s){for(var r=s.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function Ae(e,t,n,s){var i=this;e=h(e);var r=new l((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(n){_e(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(s>0)return void r(Ae.apply(i,[e,a,n,s-1]));o(t)}}))}))})).catch(o)}));return d(r,n),r}function xe(e,t,n){return Ae.apply(this,[e,t,n,1])}function $e(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function Ee(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){_e(t,s,"DELETE FROM "+s.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function je(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){_e(t,s,"SELECT COUNT(key) as c FROM "+s.storeName,[],(function(t,n){var s=n.rows.item(0).c;e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Ce(e,t){var n=this,s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var s=n.rows.length?n.rows.item(0).key:null;t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function ke(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){_e(t,s,"SELECT key FROM "+s.storeName,[],(function(t,n){for(var s=[],i=0;i<n.rows.length;i++)s.push(n.rows.item(i).key);e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Te(e){return new l((function(t,n){e.transaction((function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,s){for(var i=[],r=0;r<s.rows.length;r++)i.push(s.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function Oe(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,i=this;return d(s=e.name?new l((function(t){var s;s=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:s,storeNames:[e.storeName]}):t(Te(s))})).then((function(e){return new l((function(t,n){e.db.transaction((function(s){function i(e){return new l((function(t,n){s.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var r=[],o=0,a=e.storeNames.length;o<a;o++)r.push(i(e.storeNames[o]));l.all(r).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),t),s}var Ne={_driver:"webSQLStorage",_initStorage:ye,_support:K(),iterate:Se,getItem:we,setItem:xe,removeItem:$e,clear:Ee,length:je,key:Ce,keys:ke,dropInstance:Oe};function Me(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ie(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Re(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function De(){return!Re()||localStorage.length>0}function ze(e){var t=this,n={};if(e)for(var s in e)n[s]=e[s];return n.keyPrefix=Ie(e,t._defaultConfig),De()?(t._dbInfo=n,n.serializer=ve,l.resolve()):l.reject()}function Le(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var s=localStorage.key(n);0===s.indexOf(e)&&localStorage.removeItem(s)}}));return d(n,e),n}function Pe(e,t){var n=this;e=h(e);var s=n.ready().then((function(){var t=n._dbInfo,s=localStorage.getItem(t.keyPrefix+e);return s&&(s=t.serializer.deserialize(s)),s}));return d(s,t),s}function Ue(e,t){var n=this,s=n.ready().then((function(){for(var t=n._dbInfo,s=t.keyPrefix,i=s.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(s)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return d(s,t),s}function Be(e,t){var n=this,s=n.ready().then((function(){var t,s=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(s.keyPrefix.length)),t}));return d(s,t),s}function qe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,s=[],i=0;i<n;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&s.push(r.substring(e.keyPrefix.length))}return s}));return d(n,e),n}function Fe(e){var t=this.keys().then((function(e){return e.length}));return d(t,e),t}function He(e,t){var n=this;e=h(e);var s=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return d(s,t),s}function Ge(e,t,n){var s=this;e=h(e);var i=s.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(i,r){var o=s._dbInfo;o.serializer.serialize(t,(function(t,s){if(s)r(s);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return d(i,n),i}function We(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var s,i=this;return s=e.name?new l((function(t){e.storeName?t(Ie(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),d(s,t),s}var Ve={_driver:"localStorageWrapper",_initStorage:ze,_support:Me(),iterate:Ue,getItem:Pe,setItem:Ge,removeItem:He,clear:Le,length:Fe,key:Be,keys:qe,dropInstance:We},Ke=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Je=function(e,t){for(var n=e.length,s=0;s<n;){if(Ke(e[s],t))return!0;s++}return!1},Ye=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Qe={},Ze={INDEXEDDB:V,WEBSQL:Ne,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),st={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function rt(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ye(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ot=function(){function e(t){for(var n in i(this,e),Ze)if(Ze.hasOwnProperty(n)){var s=Ze[n],r=s._driver;this[n]=r,Xe[r]||this.defineDriver(s)}this._defaultConfig=rt({},st),this._config=rt({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":s(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var s=new l((function(t,n){try{var s=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var r=nt.concat("_initStorage"),o=0,a=r.length;o<a;o++){var c=r[o];if((!Je(tt,c)||e[c])&&"function"!=typeof e[c])return void n(i)}var u=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=l.reject(t);return d(n,arguments[arguments.length-1]),n}},n=0,s=tt.length;n<s;n++){var i=tt[n];e[i]||(e[i]=t(i))}};u();var h=function(n){Xe[s]&&console.info("Redefining LocalForage driver: "+s),Xe[s]=e,Qe[s]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return u(s,t,n),s},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var s=Xe[e]?l.resolve(Xe[e]):l.reject(new Error("Driver not found."));return u(s,t,n),s},e.prototype.getSerializer=function(e){var t=l.resolve(ve);return u(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(n,e,e),n},e.prototype.setDriver=function(e,t,n){var s=this;Ye(e)||(e=[e]);var i=this._getSupportedDrivers(e);function r(){s._config.driver=s.driver()}function o(e){return s._extend(e),r(),s._ready=s._initStorage(s._config),s._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(i).then(o).catch(n)}r();var a=new Error("No available storage method found.");return s._driverSet=l.reject(a),s._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=c.then((function(){var e=i[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then((function(e){s._driver=e._driver,r(),s._wrapLibraryMethodsWithReady(),s._initDriver=a(i)}))})).catch((function(){r();var e=new Error("No available storage method found.");return s._driverSet=l.reject(e),s._driverSet})),u(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Qe[e]},e.prototype._extend=function(e){rt(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,s=e.length;n<s;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)},6865:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7187:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7190:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7391:e=>{window,e.exports=function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImageElement=function(e,t){return new Promise((function(n,s){e.addEventListener("load",(function(){n(e)}),!1),e.addEventListener("error",(function(e){s(e)}),!1),e.src=t}))},t.resize=function(e,t,n,s){if(!n&&!s)return{currentWidth:e,currentHeight:t};var i=e/t,r=void 0,o=void 0;return i>n/s?o=(r=Math.min(e,n))/i:r=(o=Math.min(t,s))*i,{width:r,height:o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64ToFile=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=window.atob(e),s=[],i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return new window.Blob([new Uint8Array(s)],{type:t})},t.imageToCanvas=function(e,t,n,s){var i=document.createElement("canvas"),r=i.getContext("2d");if(i.width=t,i.height=n,!s||s>8)return r.drawImage(e,0,0,i.width,i.height),i;switch(s>4&&(i.width=n,i.height=t),s){case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,n),r.rotate(Math.PI);break;case 4:r.translate(0,n),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-n);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-n),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}return s>4?r.drawImage(e,0,0,i.height,i.width):r.drawImage(e,0,0,i.width,i.height),i},t.canvasToBlob=function(e,t){return new Promise((function(n,s){e.toBlob((function(e){n(e)}),"image/jpeg",t)}))},t.size=function(e){return{kB:.001*e,MB:1e-6*e}},t.blobToBase64=function(e){return new Promise((function(t,n){var s=new window.FileReader;s.addEventListener("load",(function(e){t(e.target.result)}),!1),s.addEventListener("error",(function(e){n(e)}),!1),s.readAsDataURL(e)}))}},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractOrientation=function(e){return new Promise((function(t,n){var s=new window.FileReader;s.onload=function(e){var n=new DataView(e.target.result);65496!==n.getUint16(0,!1)&&t(-2);for(var s=n.byteLength,i=2;i<s;){var r=n.getUint16(i,!1);if(i+=2,65505===r){1165519206!==n.getUint32(i+=2,!1)&&t(-1);var o=18761===n.getUint16(i+=6,!1);i+=n.getUint32(i+4,o);var a=n.getUint16(i,o);i+=2;for(var c=0;c<a;c++)274===n.getUint16(i+12*c,o)&&t(n.getUint16(i+12*c+8,o))}else{if(65280&~r)break;i+=n.getUint16(i,!1)}}t(-1)},s.readAsArrayBuffer(e.slice(0,65536))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=(s=n(2))&&s.__esModule?s:{default:s},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=n(3),a=n(0),c=n(1);function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function s(i,r){try{var o=t[i](r),a=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(a).then((function(e){s("next",e)}),(function(e){s("throw",e)}));e(a)}("next")}))}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.name=t.name,this.type=t.type,this.size=t.size}return r(e,[{key:"setData",value:function(e){this.data=e,this.size=e.size,this.type=e.type}},{key:"_calculateOrientation",value:function(){var e=l(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.extractOrientation)(this.data);case 2:t=e.sent,this.orientation=t;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=l(i.default.mark((function e(){var t,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._calculateOrientation();case 2:return t=URL.createObjectURL(this.data),n=new window.Image,e.next=6,(0,a.loadImageElement)(n,t);case 6:URL.revokeObjectURL(t),this._img=n,this.width=n.naturalWidth,this.height=n.naturalHeight;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCanvas",value:function(e,t,n){return void 0!==n?(0,c.imageToCanvas)(this._img,e,t,n):(0,c.imageToCanvas)(this._img,e,t,this.orientation)}}]),e}();t.default=d,e.exports=t.default},function(e,t){!function(t){"use strict";var n,s=Object.prototype,i=s.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag",l="object"==typeof e,d=t.regeneratorRuntime;if(d)l&&(e.exports=d);else{(d=t.regeneratorRuntime=l?e.exports:{}).wrap=_;var u="suspendedStart",h="suspendedYield",f="executing",m="completed",g={},p={};p[o]=function(){return this};var v=Object.getPrototypeOf,b=v&&v(v(O([])));b&&b!==s&&i.call(b,o)&&(p=b);var y=x.prototype=S.prototype=Object.create(p);A.prototype=y.constructor=x,x.constructor=A,x[c]=A.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===A||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(y),e},d.awrap=function(e){return{__await:e}},$(E.prototype),E.prototype[a]=function(){return this},d.AsyncIterator=E,d.async=function(e,t,n,s){var i=new E(_(e,t,n,s));return d.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},$(y),y[c]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var s=t.pop();if(s in e)return n.value=s,n.done=!1,n}return n.done=!0,n}},d.values=O,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(s,i){return a.type="throw",a.arg=e,t.next=s,i&&(t.method="next",t.arg=n),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var i=s.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,s){return this.delegate={iterator:O(e),resultName:t,nextLoc:s},"next"===this.method&&(this.arg=n),g}}}function _(e,t,n,s){var i=t&&t.prototype instanceof S?t:S,r=Object.create(i.prototype),o=new T(s||[]);return r._invoke=function(e,t,n){var s=u;return function(i,r){if(s===f)throw new Error("Generator is already running");if(s===m){if("throw"===i)throw r;return N()}for(n.method=i,n.arg=r;;){var o=n.delegate;if(o){var a=j(o,n);if(a){if(a===g)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===u)throw s=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=f;var c=w(e,t,n);if("normal"===c.type){if(s=n.done?m:h,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s=m,n.method="throw",n.arg=c.arg)}}}(e,n,o),r}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function S(){}function A(){}function x(){}function $(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function E(e){var t;this._invoke=function(n,s){function r(){return new Promise((function(t,r){!function t(n,s,r,o){var a=w(e[n],e,s);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,r,o)}),(function(e){t("throw",e,r,o)})):Promise.resolve(l).then((function(e){c.value=e,r(c)}),o)}o(a.arg)}(n,s,t,r)}))}return t=t?t.then(r,r):r()}}function j(e,t){var s=e.iterator[t.method];if(s===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,j(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=w(s,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,g;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function O(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,r=function t(){for(;++s<e.length;)if(i.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=n,t.done=!0,t};return r.next=r}}return{next:N}}function N(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){var s=function(){return this}()||Function("return this")(),i=s.regeneratorRuntime&&Object.getOwnPropertyNames(s).indexOf("regeneratorRuntime")>=0,r=i&&s.regeneratorRuntime;if(s.regeneratorRuntime=void 0,e.exports=n(5),i)s.regeneratorRuntime=r;else try{delete s.regeneratorRuntime}catch(e){s.regeneratorRuntime=void 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=c(n(2)),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)),o=n(0),a=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function s(i,r){try{var o=t[i](r),a=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(a).then((function(e){s("next",e)}),(function(e){s("throw",e)}));e(a)}("next")}))}}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setOptions(t)}return i(e,[{key:"setOptions",value:function(e){var t={targetSize:1/0,quality:.75,minQuality:.5,qualityStepSize:.1,maxWidth:1920,maxHeight:1920,resize:!0,throwIfSizeNotReached:!1,autoRotate:!0},n=new Proxy(e,{get:function(e,n){return n in e?e[n]:t[n]}});this.options=n}},{key:"_compressFile",value:function(){var e=l(s.default.mark((function e(t){var n,i;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new a.default(t),(i={}).start=window.performance.now(),i.quality=this.options.quality,i.startType=n.type,e.next=7,n.load();case 7:return e.next=9,this._compressImage(n,i);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_compressImage",value:function(){var e=l(s.default.mark((function e(t,n){var i,a,c,l,d;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.startWidth=t.width,n.startHeight=t.height,i=void 0,a=void 0,this.options.resize?(c=(0,o.resize)(t.width,t.height,this.options.maxWidth,this.options.maxHeight),i=c.width,a=c.height):(i=t.width,a=t.height),n.endWidth=i,n.endHeight=a,l=this.doAutoRotation?void 0:1,d=t.getCanvas(i,a,l),n.iterations=0,n.startSizeMB=r.size(t.size).MB,e.next=12,this._loopCompression(d,t,n);case 12:return n.endSizeMB=r.size(t.size).MB,n.sizeReducedInPercent=(n.startSizeMB-n.endSizeMB)/n.startSizeMB*100,n.end=window.performance.now(),n.elapsedTimeInSeconds=(n.end-n.start)/1e3,n.endType=t.type,e.abrupt("return",{photo:t,info:n});case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_loopCompression",value:function(){var e=l(s.default.mark((function e(t,n,i){var o;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.iterations++,e.t0=n,e.next=4,r.canvasToBlob(t,i.quality);case 4:if(e.t1=e.sent,e.t0.setData.call(e.t0,e.t1),1==i.iterations&&(n.width=i.endWidth,n.height=i.endHeight),!(r.size(n.size).MB>this.options.targetSize)){e.next=24;break}if(!(i.quality.toFixed(10)-.1<this.options.minQuality)){e.next=18;break}if(o="Couldn't compress image to target size while maintaining quality.\n        Target size: "+this.options.targetSize+"\n        Actual size: "+r.size(n.size).MB,this.options.throwIfSizeNotReached){e.next=14;break}console.error(o),e.next=15;break;case 14:throw new Error(o);case 15:case 24:return e.abrupt("return");case 18:return i.quality-=this.options.qualityStepSize,e.next=21,this._loopCompression(t,n,i);case 21:return e.abrupt("return",e.sent);case 22:e.next=25;break;case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,s){return e.apply(this,arguments)}}()},{key:"setAutoRotate",value:function(){var t=l(s.default.mark((function t(){var n;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.automaticRotationFeatureTest();case 2:n=t.sent,this.doAutoRotation=this.options.autoRotate&&!n;case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"compress",value:function(){var e=l(s.default.mark((function e(t){var n=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setAutoRotate();case 2:return e.abrupt("return",Promise.all(t.map((function(e){return n._compressFile(e)}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"blobToBase64",value:function(){var e=l(s.default.mark((function e(){var t=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.blobToBase64.apply(r,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadImageElement",value:function(){var e=l(s.default.mark((function e(){var t=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.loadImageElement.apply(void 0,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"automaticRotationFeatureTest",value:function(){return new Promise((function(e){var t=new Image;t.onload=function(){var n=1===t.width&&2===t.height;e(n)},t.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="}))}}]),e}();t.default=d,e.exports=t.default}])},7478:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7659:e=>{"use strict";var t={};e.exports=function(e,n){var s=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},7698:(e,t,n)=>{var s=n(4227).default;e.exports=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7702:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7808:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7811:function(e,t,n){e=n.nmd(e),function(t){"use strict";var s="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,i="object"==typeof self&&self&&self.Object===Object&&self,r=s||i||Function("return this")(),o=r.Symbol;function a(e,t){for(var n=-1,s=null==e?0:e.length,i=Array(s);++n<s;)i[n]=t(e[n],n,e);return i}var c=Array.isArray,l=Object.prototype,d=l.hasOwnProperty,u=l.toString,h=o?o.toStringTag:void 0;function f(e){var t=d.call(e,h),n=e[h];try{e[h]=void 0;var s=!0}catch(e){}var i=u.call(e);return s&&(t?e[h]=n:delete e[h]),i}var m=Object.prototype.toString;function g(e){return m.call(e)}var p="[object Null]",v="[object Undefined]",b=o?o.toStringTag:void 0;function y(e){return null==e?void 0===e?v:p:b&&b in Object(e)?f(e):g(e)}function _(e){return null!=e&&"object"==typeof e}var w="[object Symbol]";function S(e){return"symbol"==typeof e||_(e)&&y(e)==w}var A=o?o.prototype:void 0,x=A?A.toString:void 0;function $(e){if("string"==typeof e)return e;if(c(e))return a(e,$)+"";if(S(e))return x?x.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function E(e){return null==e?"":$(e)}var j=0;function C(e){var t=++j;return E(e)+t}const k=globalThis,T=k.trustedTypes,O=T?T.createPolicy("lit-html",{createHTML:e=>e}):void 0,N="$lit$",M=`lit$${Math.random().toFixed(9).slice(2)}$`,I="?"+M,R=`<${I}>`,D=document,z=()=>D.createComment(""),L=e=>null===e||"object"!=typeof e&&"function"!=typeof e,P=Array.isArray,U=e=>P(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),B="[ \t\n\f\r]",q=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,F=/-->/g,H=/>/g,G=RegExp(`>|${B}(?:([^\\s"'>=/]+)(${B}*=${B}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),W=/'/g,V=/"/g,K=/^(?:script|style|textarea|title)$/i,J=Symbol.for("lit-noChange"),Y=Symbol.for("lit-nothing"),X=new WeakMap,Q=D.createTreeWalker(D,129);function Z(e,t){if(!P(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==O?O.createHTML(t):t}const ee=(e,t)=>{const n=e.length-1,s=[];let i,r=2===t?"<svg>":3===t?"<math>":"",o=q;for(let t=0;t<n;t++){const n=e[t];let c,l,d=-1,u=0;for(;u<n.length&&(o.lastIndex=u,l=o.exec(n),null!==l);){var a;u=o.lastIndex,o===q?"!--"===l[1]?o=F:void 0!==l[1]?o=H:void 0!==l[2]?(K.test(l[2])&&(i=RegExp("</"+l[2],"g")),o=G):void 0!==l[3]&&(o=G):o===G?">"===l[0]?(o=null!==(a=i)&&void 0!==a?a:q,d=-1):void 0===l[1]?d=-2:(d=o.lastIndex-l[2].length,c=l[1],o=void 0===l[3]?G:'"'===l[3]?V:W):o===V||o===W?o=G:o===F||o===H?o=q:(o=G,i=void 0)}const h=o===G&&e[t+1].startsWith("/>")?" ":"";r+=o===q?n+R:d>=0?(s.push(c),n.slice(0,d)+N+n.slice(d)+M+h):n+M+(-2===d?t:h)}return[Z(e,r+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]};class te{constructor({strings:e,_$litType$:t},n){let s;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=ee(e,t);if(this.el=te.createElement(c,n),Q.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=Q.nextNode())&&a.length<o;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(N)){const t=l[r++],n=s.getAttribute(e).split(M),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:n,ctor:"."===o[1]?oe:"?"===o[1]?ae:"@"===o[1]?ce:re}),s.removeAttribute(e)}else e.startsWith(M)&&(a.push({type:6,index:i}),s.removeAttribute(e));if(K.test(s.tagName)){const e=s.textContent.split(M),t=e.length-1;if(t>0){s.textContent=T?T.emptyScript:"";for(let n=0;n<t;n++)s.append(e[n],z()),Q.nextNode(),a.push({type:2,index:++i});s.append(e[t],z())}}}else if(8===s.nodeType)if(s.data===I)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=s.data.indexOf(M,e+1));)a.push({type:7,index:i}),e+=M.length-1}i++}}static createElement(e,t){const n=D.createElement("template");return n.innerHTML=e,n}}function ne(e,t,n=e,s){var i,r,o,a;if(t===J)return t;let c=void 0!==s?null===(i=n._$Co)||void 0===i?void 0:i[s]:n._$Cl;const l=L(t)?void 0:t._$litDirective$;return(null===(r=c)||void 0===r?void 0:r.constructor)!==l&&(null!==(o=c)&&void 0!==o&&null!==(a=o._$AO)&&void 0!==a&&a.call(o,!1),void 0===l?c=void 0:(c=new l(e),c._$AT(e,n,s)),void 0!==s?(n._$Co??=[])[s]=c:n._$Cl=c),void 0!==c&&(t=ne(e,c._$AS(e,t.values),c,s)),t}class se{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:n},parts:s}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:D).importNode(n,!0);Q.currentNode=i;let r=Q.nextNode(),o=0,a=0,c=s[0];for(;void 0!==c;){var l;if(o===c.index){let t;2===c.type?t=new ie(r,r.nextSibling,this,e):1===c.type?t=new c.ctor(r,c.name,c.strings,this,e):6===c.type&&(t=new le(r,this,e)),this._$AV.push(t),c=s[++a]}o!==(null===(l=c)||void 0===l?void 0:l.index)&&(r=Q.nextNode(),o++)}return Q.currentNode=D,i}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class ie{get _$AU(){var e,t;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cv}constructor(e,t,n,s){var i;this.type=2,this._$AH=Y,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=s,this._$Cv=null===(i=null==s?void 0:s.isConnected)||void 0===i||i}get parentNode(){var e;let t=this._$AA.parentNode;const n=this._$AM;return void 0!==n&&11===(null===(e=t)||void 0===e?void 0:e.nodeType)&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=ne(this,e,t),L(e)?e===Y||null==e||""===e?(this._$AH!==Y&&this._$AR(),this._$AH=Y):e!==this._$AH&&e!==J&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):U(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Y&&L(this._$AH)?this._$AA.nextSibling.data=e:this.T(D.createTextNode(e)),this._$AH=e}$(e){var t;const{values:n,_$litType$:s}=e,i="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=te.createElement(Z(s.h,s.h[0]),this.options)),s);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.p(n);else{const e=new se(i,this),t=e.u(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let t=X.get(e.strings);return void 0===t&&X.set(e.strings,t=new te(e)),t}k(e){P(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,s=0;for(const i of e)s===t.length?t.push(n=new ie(this.O(z()),this.O(z()),this,this.options)):n=t[s],n._$AI(i),s++;s<t.length&&(this._$AR(n&&n._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$AB;){var n;const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cv=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class re{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,s,i){this.type=1,this._$AH=Y,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Y}_$AI(e,t=this,n,s){const i=this.strings;let r=!1;if(void 0===i)e=ne(this,e,t,0),r=!L(e)||e!==this._$AH&&e!==J,r&&(this._$AH=e);else{const s=e;let a,c;for(e=i[0],a=0;a<i.length-1;a++){var o;c=ne(this,s[n+a],t,a),c===J&&(c=this._$AH[a]),r||=!L(c)||c!==this._$AH[a],c===Y?e=Y:e!==Y&&(e+=(null!==(o=c)&&void 0!==o?o:"")+i[a+1]),this._$AH[a]=c}}r&&!s&&this.j(e)}j(e){e===Y?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class oe extends re{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Y?void 0:e}}class ae extends re{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Y)}}class ce extends re{constructor(e,t,n,s,i){super(e,t,n,s,i),this.type=5}_$AI(e,t=this){var n;if((e=null!==(n=ne(this,e,t,0))&&void 0!==n?n:Y)===J)return;const s=this._$AH,i=e===Y&&s!==Y||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,r=e!==Y&&(s===Y||i);i&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;"function"==typeof this._$AH?this._$AH.call(null!==(t=null===(n=this.options)||void 0===n?void 0:n.host)&&void 0!==t?t:this.element,e):this._$AH.handleEvent(e)}}class le{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){ne(this,e)}}const de=k.litHtmlPolyfillSupport;null!=de&&de(te,ie),(k.litHtmlVersions??=[]).push("3.2.1");const ue=(e,t,n)=>{var s;const i=null!==(s=void 0)&&void 0!==s?s:t;let r=i._$litPart$;if(void 0===r){var o;const e=null!==(o=void 0)&&void 0!==o?o:null;i._$litPart$=r=new ie(t.insertBefore(z(),e),e,void 0,{})}return r._$AI(e),r};var he=Object.prototype;function fe(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||he)}function me(e,t){return function(n){return e(t(n))}}var ge=me(Object.keys,Object),pe=Object.prototype.hasOwnProperty;function ve(e){if(!fe(e))return ge(e);var t=[];for(var n in Object(e))pe.call(e,n)&&"constructor"!=n&&t.push(n);return t}function be(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var ye="[object AsyncFunction]",_e="[object Function]",we="[object GeneratorFunction]",Se="[object Proxy]";function Ae(e){if(!be(e))return!1;var t=y(e);return t==_e||t==we||t==ye||t==Se}var xe,$e=r["__core-js_shared__"],Ee=(xe=/[^.]+$/.exec($e&&$e.keys&&$e.keys.IE_PROTO||""))?"Symbol(src)_1."+xe:"";function je(e){return!!Ee&&Ee in e}var Ce=Function.prototype.toString;function ke(e){if(null!=e){try{return Ce.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var Te=/[\\^$.*+?()[\]{}|]/g,Oe=/^\[object .+?Constructor\]$/,Ne=Function.prototype,Me=Object.prototype,Ie=Ne.toString,Re=Me.hasOwnProperty,De=RegExp("^"+Ie.call(Re).replace(Te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ze(e){return!(!be(e)||je(e))&&(Ae(e)?De:Oe).test(ke(e))}function Le(e,t){return null==e?void 0:e[t]}function Pe(e,t){var n=Le(e,t);return ze(n)?n:void 0}var Ue=Pe(r,"DataView"),Be=Pe(r,"Map"),qe=Pe(r,"Promise"),Fe=Pe(r,"Set"),He=Pe(r,"WeakMap"),Ge="[object Map]",We="[object Object]",Ve="[object Promise]",Ke="[object Set]",Je="[object WeakMap]",Ye="[object DataView]",Xe=ke(Ue),Qe=ke(Be),Ze=ke(qe),et=ke(Fe),tt=ke(He),nt=y;(Ue&&nt(new Ue(new ArrayBuffer(1)))!=Ye||Be&&nt(new Be)!=Ge||qe&&nt(qe.resolve())!=Ve||Fe&&nt(new Fe)!=Ke||He&&nt(new He)!=Je)&&(nt=function(e){var t=y(e),n=t==We?e.constructor:void 0,s=n?ke(n):"";if(s)switch(s){case Xe:return Ye;case Qe:return Ge;case Ze:return Ve;case et:return Ke;case tt:return Je}return t});var st="[object Arguments]";function it(e){return _(e)&&y(e)==st}var rt=Object.prototype,ot=rt.hasOwnProperty,at=rt.propertyIsEnumerable,ct=it(function(){return arguments}())?it:function(e){return _(e)&&ot.call(e,"callee")&&!at.call(e,"callee")},lt=9007199254740991;function dt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=lt}function ut(e){return null!=e&&dt(e.length)&&!Ae(e)}function ht(){return!1}var ft="object"==typeof t&&t&&!t.nodeType&&t,mt=ft&&e&&!e.nodeType&&e,gt=mt&&mt.exports===ft?r.Buffer:void 0,pt=(gt?gt.isBuffer:void 0)||ht,vt="[object Arguments]",bt="[object Array]",yt="[object Boolean]",_t="[object Date]",wt="[object Error]",St="[object Function]",At="[object Map]",xt="[object Number]",$t="[object Object]",Et="[object RegExp]",jt="[object Set]",Ct="[object String]",kt="[object WeakMap]",Tt="[object ArrayBuffer]",Ot="[object DataView]",Nt="[object Float64Array]",Mt="[object Int8Array]",It="[object Int16Array]",Rt="[object Int32Array]",Dt="[object Uint8Array]",zt="[object Uint8ClampedArray]",Lt="[object Uint16Array]",Pt="[object Uint32Array]",Ut={};function Bt(e){return _(e)&&dt(e.length)&&!!Ut[y(e)]}function qt(e){return function(t){return e(t)}}Ut["[object Float32Array]"]=Ut[Nt]=Ut[Mt]=Ut[It]=Ut[Rt]=Ut[Dt]=Ut[zt]=Ut[Lt]=Ut[Pt]=!0,Ut[vt]=Ut[bt]=Ut[Tt]=Ut[yt]=Ut[Ot]=Ut[_t]=Ut[wt]=Ut[St]=Ut[At]=Ut[xt]=Ut[$t]=Ut[Et]=Ut[jt]=Ut[Ct]=Ut[kt]=!1;var Ft="object"==typeof t&&t&&!t.nodeType&&t,Ht=Ft&&e&&!e.nodeType&&e,Gt=Ht&&Ht.exports===Ft&&s.process,Wt=function(){try{var e=Ht&&Ht.require&&Ht.require("util").types;return e||Gt&&Gt.binding&&Gt.binding("util")}catch(e){}}(),Vt=Wt&&Wt.isTypedArray,Kt=Vt?qt(Vt):Bt,Jt="[object Map]",Yt="[object Set]",Xt=Object.prototype.hasOwnProperty;function Qt(e){if(null==e)return!0;if(ut(e)&&(c(e)||"string"==typeof e||"function"==typeof e.splice||pt(e)||Kt(e)||ct(e)))return!e.length;var t=nt(e);if(t==Jt||t==Yt)return!e.size;if(fe(e))return!ve(e).length;for(var n in e)if(Xt.call(e,n))return!1;return!0}function Zt(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}var en=9007199254740991,tn=/^(?:0|[1-9]\d*)$/;function nn(e,t){var n=typeof e;return!!(t=null==t?en:t)&&("number"==n||"symbol"!=n&&tn.test(e))&&e>-1&&e%1==0&&e<t}var sn=Object.prototype.hasOwnProperty;function rn(e,t){var n=c(e),s=!n&&ct(e),i=!n&&!s&&pt(e),r=!n&&!s&&!i&&Kt(e),o=n||s||i||r,a=o?Zt(e.length,String):[],l=a.length;for(var d in e)!t&&!sn.call(e,d)||o&&("length"==d||i&&("offset"==d||"parent"==d)||r&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||nn(d,l))||a.push(d);return a}function on(e){return ut(e)?rn(e):ve(e)}var an=/\s/;function cn(e){for(var t=e.length;t--&&an.test(e.charAt(t)););return t}var ln=/^\s+/;function dn(e){return e?e.slice(0,cn(e)+1).replace(ln,""):e}var un=NaN,hn=/^[-+]0x[0-9a-f]+$/i,fn=/^0b[01]+$/i,mn=/^0o[0-7]+$/i,gn=parseInt;function pn(e){if("number"==typeof e)return e;if(S(e))return un;if(be(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=be(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=dn(e);var n=fn.test(e);return n||mn.test(e)?gn(e.slice(2),n?2:8):hn.test(e)?un:+e}var vn=1/0,bn=17976931348623157e292;function yn(e){return e?(e=pn(e))===vn||e===-1/0?(e<0?-1:1)*bn:e==e?e:0:0===e?e:0}function _n(e){var t=yn(e),n=t%1;return t==t?n?t-n:t:0}var wn="Expected a function";function Sn(e,t){var n;if("function"!=typeof t)throw new TypeError(wn);return e=_n(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}function An(e){return Sn(2,e)}const xn=/\s+/;function $n(e,t,n,s,i){let r,o=0;if(n&&"object"==typeof n){void 0!==s&&"context"in i&&void 0===i.context&&(i.context=s);for(r=on(n);o<r.length;o++)t=$n(e,t,r[o],n[r[o]],i)}else if(n&&xn.test(n))for(r=n.split(xn);o<r.length;o++)t=e(t,r[o],s,i);else t=e(t,n,s,i);return t}function En(e,t,n,s){if(n){const i=e[t]||(e[t]=[]),r=s.context,o=s.ctx,a=s.listening;a&&a.count++,i.push({callback:n,context:r,ctx:r||o,listening:a})}return e}function jn(e,t,n,s){try{e.on(t,n,s)}catch(e){return e}}function Cn(e,t,n,s){if(!e)return;const i=s.context,r=s.listeners;let o,a=0;if(t||i||n){for(o=t?[t]:on(e);a<o.length;a++){const s=e[t=o[a]];if(!s)break;const r=[];for(let e=0;e<s.length;e++){const o=s[e];if(n&&n!==o.callback&&n!==o.callback._callback||i&&i!==o.context)r.push(o);else{const e=o.listening;e&&e.stop(t,n)}}r.length?e[t]=r:delete e[t]}return e}for(o=on(r);a<o.length;a++)r[o[a]].cleanup()}function kn(e,t,n,s){if(n){const i=e[t]=An((function(){s(t,i),n.apply(this,arguments)}));i._callback=n}return e}function Tn(e,t,n,s){if(e){const n=e[t];let i=e.all;n&&i&&(i=i.slice()),n&&On(n,s),i&&On(i,[t].concat(s))}return e}function On(e,t){let n,s=-1;const i=e.length,r=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++s<i;)(n=e[s]).callback.call(n.ctx);return;case 1:for(;++s<i;)(n=e[s]).callback.call(n.ctx,r);return;case 2:for(;++s<i;)(n=e[s]).callback.call(n.ctx,r,o);return;case 3:for(;++s<i;)(n=e[s]).callback.call(n.ctx,r,o,a);return;default:for(;++s<i;)(n=e[s]).callback.apply(n.ctx,t);return}}class Nn{constructor(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0}start(e,t,n,s){return this._events=$n(En,this._events||{},e,t,{context:this.obj,ctx:n,listening:s}),s&&((this.obj._listeners||(this.obj._listeners={}))[this.id]=this,this.interop=!1),this}stop(e,t){let n;this.interop?(this._events=$n(Cn,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()}cleanup(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]}}let Mn;function In(e){return class extends e{on(e,t,n){return this._events=$n(En,this._events||{},e,t,{context:n,ctx:this,listening:Mn}),Mn&&((this._listeners||(this._listeners={}))[Mn.id]=Mn,Mn.interop=!1),this}listenTo(e,t,n){if(!e)return this;const s=e._listenId||(e._listenId=C("l")),i=this._listeningTo||(this._listeningTo={});let r=Mn=i[s];r||(this._listenId||(this._listenId=C("l")),r=Mn=i[s]=new Nn(this,e));const o=jn(e,t,n,this);if(Mn=void 0,o)throw o;return r.interop&&r.start(t,n,this,Mn),this}off(e,t,n){return this._events?(this._events=$n(Cn,this._events,e,t,{context:n,listeners:this._listeners}),this):this}stopListening(e,t,n){const s=this._listeningTo;if(!s)return this;const i=e?[e._listenId]:on(s);for(let e=0;e<i.length;e++){const r=s[i[e]];if(!r)break;r.obj.off(t,n,this),r.interop&&r.stop(t,n)}return Qt(s)&&(this._listeningTo=void 0),this}once(e,t,n){const s=$n(kn,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(s,t,n)}listenToOnce(e,t,n){const s=$n(kn,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,s)}trigger(e,...t){return this._events?($n(Tn,this._events,e,void 0,t),this):this}}}const Rn=/^(\S+)\s*(.*)$/;class Dn extends(In(HTMLElement)){set events(e){this._declarativeEvents=e}get events(){return this._declarativeEvents}constructor(e={}){super(),this.stopListening=null,this.cid=C("view"),this._declarativeEvents={},this._domEvents=[];const{model:t,collection:n,events:s}=e;Object.assign(this,{model:t,collection:n,events:s})}createRenderRoot(){return this}connectedCallback(){this._initialized||(this.preinitialize.apply(this,arguments),this.initialize.apply(this,arguments),this._initialized=!0),this.delegateEvents()}disconnectedCallback(){var e;this.undelegateEvents(),null===(e=this.stopListening)||void 0===e||e.call(this)}preinitialize(){}initialize(){}beforeRender(){}afterRender(){}render(){return this.beforeRender(),ue(this.toHTML(),this),this.afterRender(),this}toHTML(){return""}delegateEvents(){if(!this.events)return this;this.undelegateEvents();for(const e in this.events){let t=this.events[e];if("function"!=typeof t&&(t=this[t]),!t)continue;const n=e.match(Rn);this.delegate(n[1],n[2],t.bind(this))}return this}delegate(e,t,n){const s=this;if(!s)return this;if("function"==typeof t&&(n=t,t=null),-1!==["focus","blur"].indexOf(e)){const s=this.querySelectorAll(t);for(let t=0,i=s.length;t<i;t++){const i=s[t];i.addEventListener(e,n,!1),this._domEvents.push({el:i,eventName:e,handler:n})}return n}const i=t?function(e){let i=e.target||e.srcElement;for(;i&&i!=s;i=i.parentNode)i.matches(t)&&(e.delegateTarget=i,n(e))}:n;return this.addEventListener(e,i,!1),this._domEvents.push({el:this,eventName:e,handler:i,listener:n,selector:t}),this}undelegateEvents(){if(this){for(let e=0,t=this._domEvents.length;e<t;e++){const t=this._domEvents[e];t.el.removeEventListener(t.eventName,t.handler,!1)}this._domEvents.length=0}return this}undelegate(e,t,n){if("function"==typeof t&&(n=t,t=null),this){const s=this._domEvents.slice();let i=s.length;for(;i--;){const r=s[i];!(r.eventName!==e||n&&r.listener!==n||t&&r.selector!==t)&&(r.el.removeEventListener(r.eventName,r.handler,!1),this._domEvents.splice(i,1))}}return this}}function zn(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ln(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}}var Pn=/^~~local_forage_type~([^~]+)~/,Un=9,Bn=Un+4,qn=Object.prototype.toString;function Fn(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var s=new ArrayBuffer(t),i=new Uint8Array(s),r=0,o=0;r<n;r+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|l>>2,i[o++]=(3&l)<<6|63&d}return s}function Hn(e){for(var t=new Uint8Array(e),n="",s=0;s<t.length;s+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[s]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[s])<<4|t[s+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[s+1])<<2|t[s+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[s+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function Gn(e,t){var n="";if(e&&(n=qn.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===qn.call(e.buffer))){var s=void 0,i="__lfsc__:";e instanceof ArrayBuffer?(s=e,i+="arbf"):(s=e.buffer,"[object Int8Array]"===n?i+="si08":"[object Uint8Array]"===n?i+="ui08":"[object Uint8ClampedArray]"===n?i+="uic8":"[object Int16Array]"===n?i+="si16":"[object Uint16Array]"===n?i+="ur16":"[object Int32Array]"===n?i+="si32":"[object Uint32Array]"===n?i+="ui32":"[object Float32Array]"===n?i+="fl32":"[object Float64Array]"===n?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+Hn(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n="~~local_forage_type~"+e.type+"~"+Hn(this.result);t("__lfsc__:blob"+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function Wn(e){if("__lfsc__:"!==e.substring(0,Un))return JSON.parse(e);var t,n=e.substring(Bn),s=e.substring(Un,Bn);if("blob"===s&&Pn.test(n)){var i=n.match(Pn);t=i[1],n=n.substring(i[0].length)}var r=Fn(n);switch(s){case"arbf":return r;case"blob":return Ln([r],{type:t});case"si08":return new Int8Array(r);case"ui08":return new Uint8Array(r);case"uic8":return new Uint8ClampedArray(r);case"si16":return new Int16Array(r);case"ur16":return new Uint16Array(r);case"si32":return new Int32Array(r);case"ui32":return new Uint32Array(r);case"fl32":return new Float32Array(r);case"fl64":return new Float64Array(r);default:throw new Error("Unkown type: "+s)}}function Vn(e){var t,n;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var s=e instanceof Date?new Date(e):e.constructor();try{for(var i=zn(Object.keys(e)),r=i.next();!r.done;r=i.next()){var o=r.value;Object.prototype.hasOwnProperty.call(e,o)&&(e.isActiveClone=null,s[o]=Vn(e[o]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return s}function Kn(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function Jn(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function Yn(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function Xn(e,t){var n=this;if(t=Yn.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var s=this.config();e.name=e.name||s.name,e.storeName=e.storeName||s.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(Kn(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function Qn(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var Zn={bufferToString:Hn,deserialize:Wn,serialize:Gn,stringToBuffer:Fn},es="localforage-driver-memory",ts={},ns=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return ts[t]||(ts[t]=new e(t)),ts[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete ts[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function ss(e){var t=e?Vn(e):{},n=Kn(t,this._defaultConfig),s=ns.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=Zn,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=s,Promise.resolve()}function is(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return Jn(n,e),n}function rs(e,t){var n=Xn.apply(this,arguments),s=n.promise,i=n.callback;return Jn(s.then((function(e){ns.resolve(e).drop()})),i),s}function os(e,t){var n=this;e=Qn(e);var s=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return Jn(s,t),s}function as(e,t){var n=this,s=this.ready().then((function(){for(var t=n._dbInfo.mStore,s=t.keys(),i=0;i<s.length;i++){var r=t.get(s[i]);if(r&&(r=n._dbInfo.serializer.deserialize(r)),void 0!==(r=e(r,s[i],i+1)))return r}}));return Jn(s,t),s}function cs(e,t){var n=this,s=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return Jn(s,t),s}function ls(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return Jn(n,e),n}function ds(e){var t=this.keys().then((function(e){return e.length}));return Jn(t,e),t}function us(e,t){var n=this;e=Qn(e);var s=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return Jn(s,t),s}function hs(e,t,n){var s=this;e=Qn(e);var i=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(i,r){s._dbInfo.serializer.serialize(t,(function(t,o){if(o)r(o);else try{s._dbInfo.mStore.set(e,t),i(n)}catch(e){r(e)}}))}))}));return Jn(i,n),i}var fs=!0,ms=Object.freeze({__proto__:null,_driver:es,_initStorage:ss,_support:fs,clear:is,dropInstance:rs,getItem:os,iterate:as,key:cs,keys:ls,length:ds,removeItem:us,setItem:hs});function gs(){this.__data__=[],this.size=0}function ps(e,t){return e===t||e!=e&&t!=t}function vs(e,t){for(var n=e.length;n--;)if(ps(e[n][0],t))return n;return-1}var bs=Array.prototype.splice;function ys(e){var t=this.__data__,n=vs(t,e);return!(n<0||(n==t.length-1?t.pop():bs.call(t,n,1),--this.size,0))}function _s(e){var t=this.__data__,n=vs(t,e);return n<0?void 0:t[n][1]}function ws(e){return vs(this.__data__,e)>-1}function Ss(e,t){var n=this.__data__,s=vs(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}function As(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function xs(){this.__data__=new As,this.size=0}function $s(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Es(e){return this.__data__.get(e)}function js(e){return this.__data__.has(e)}As.prototype.clear=gs,As.prototype.delete=ys,As.prototype.get=_s,As.prototype.has=ws,As.prototype.set=Ss;var Cs=Pe(Object,"create");function ks(){this.__data__=Cs?Cs(null):{},this.size=0}function Ts(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Os="__lodash_hash_undefined__",Ns=Object.prototype.hasOwnProperty;function Ms(e){var t=this.__data__;if(Cs){var n=t[e];return n===Os?void 0:n}return Ns.call(t,e)?t[e]:void 0}var Is=Object.prototype.hasOwnProperty;function Rs(e){var t=this.__data__;return Cs?void 0!==t[e]:Is.call(t,e)}var Ds="__lodash_hash_undefined__";function zs(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Cs&&void 0===t?Ds:t,this}function Ls(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function Ps(){this.size=0,this.__data__={hash:new Ls,map:new(Be||As),string:new Ls}}function Us(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function Bs(e,t){var n=e.__data__;return Us(t)?n["string"==typeof t?"string":"hash"]:n.map}function qs(e){var t=Bs(this,e).delete(e);return this.size-=t?1:0,t}function Fs(e){return Bs(this,e).get(e)}function Hs(e){return Bs(this,e).has(e)}function Gs(e,t){var n=Bs(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}function Ws(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Ls.prototype.clear=ks,Ls.prototype.delete=Ts,Ls.prototype.get=Ms,Ls.prototype.has=Rs,Ls.prototype.set=zs,Ws.prototype.clear=Ps,Ws.prototype.delete=qs,Ws.prototype.get=Fs,Ws.prototype.has=Hs,Ws.prototype.set=Gs;var Vs=200;function Ks(e,t){var n=this.__data__;if(n instanceof As){var s=n.__data__;if(!Be||s.length<Vs-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ws(s)}return n.set(e,t),this.size=n.size,this}function Js(e){var t=this.__data__=new As(e);this.size=t.size}function Ys(e,t){for(var n=-1,s=null==e?0:e.length;++n<s&&!1!==t(e[n],n,e););return e}Js.prototype.clear=xs,Js.prototype.delete=$s,Js.prototype.get=Es,Js.prototype.has=js,Js.prototype.set=Ks;var Xs=function(){try{var e=Pe(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();function Qs(e,t,n){"__proto__"==t&&Xs?Xs(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var Zs=Object.prototype.hasOwnProperty;function ei(e,t,n){var s=e[t];Zs.call(e,t)&&ps(s,n)&&(void 0!==n||t in e)||Qs(e,t,n)}function ti(e,t,n,s){var i=!n;n||(n={});for(var r=-1,o=t.length;++r<o;){var a=t[r],c=void 0;void 0===c&&(c=e[a]),i?Qs(n,a,c):ei(n,a,c)}return n}function ni(e,t){return e&&ti(t,on(t),e)}function si(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var ii=Object.prototype.hasOwnProperty;function ri(e){if(!be(e))return si(e);var t=fe(e),n=[];for(var s in e)("constructor"!=s||!t&&ii.call(e,s))&&n.push(s);return n}function oi(e){return ut(e)?rn(e,!0):ri(e)}function ai(e,t){return e&&ti(t,oi(t),e)}var ci="object"==typeof t&&t&&!t.nodeType&&t,li=ci&&e&&!e.nodeType&&e,di=li&&li.exports===ci?r.Buffer:void 0,ui=di?di.allocUnsafe:void 0;function hi(e,t){if(t)return e.slice();var n=e.length,s=ui?ui(n):new e.constructor(n);return e.copy(s),s}function fi(e,t){var n=-1,s=e.length;for(t||(t=Array(s));++n<s;)t[n]=e[n];return t}function mi(e,t){for(var n=-1,s=null==e?0:e.length,i=0,r=[];++n<s;){var o=e[n];t(o,n,e)&&(r[i++]=o)}return r}function gi(){return[]}var pi=Object.prototype.propertyIsEnumerable,vi=Object.getOwnPropertySymbols,bi=vi?function(e){return null==e?[]:(e=Object(e),mi(vi(e),(function(t){return pi.call(e,t)})))}:gi;function yi(e,t){return ti(e,bi(e),t)}function _i(e,t){for(var n=-1,s=t.length,i=e.length;++n<s;)e[i+n]=t[n];return e}var wi=me(Object.getPrototypeOf,Object),Si=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)_i(t,bi(e)),e=wi(e);return t}:gi;function Ai(e,t){return ti(e,Si(e),t)}function xi(e,t,n){var s=t(e);return c(e)?s:_i(s,n(e))}function $i(e){return xi(e,on,bi)}function Ei(e){return xi(e,oi,Si)}var ji=Object.prototype.hasOwnProperty;function Ci(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ji.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var ki=r.Uint8Array;function Ti(e){var t=new e.constructor(e.byteLength);return new ki(t).set(new ki(e)),t}function Oi(e,t){var n=t?Ti(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var Ni=/\w*$/;function Mi(e){var t=new e.constructor(e.source,Ni.exec(e));return t.lastIndex=e.lastIndex,t}var Ii=o?o.prototype:void 0,Ri=Ii?Ii.valueOf:void 0;function Di(e){return Ri?Object(Ri.call(e)):{}}function zi(e,t){var n=t?Ti(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var Li="[object Boolean]",Pi="[object Date]",Ui="[object Map]",Bi="[object Number]",qi="[object RegExp]",Fi="[object Set]",Hi="[object String]",Gi="[object Symbol]",Wi="[object ArrayBuffer]",Vi="[object DataView]",Ki="[object Float32Array]",Ji="[object Float64Array]",Yi="[object Int8Array]",Xi="[object Int16Array]",Qi="[object Int32Array]",Zi="[object Uint8Array]",er="[object Uint8ClampedArray]",tr="[object Uint16Array]",nr="[object Uint32Array]";function sr(e,t,n){var s=e.constructor;switch(t){case Wi:return Ti(e);case Li:case Pi:return new s(+e);case Vi:return Oi(e,n);case Ki:case Ji:case Yi:case Xi:case Qi:case Zi:case er:case tr:case nr:return zi(e,n);case Ui:return new s;case Bi:case Hi:return new s(e);case qi:return Mi(e);case Fi:return new s;case Gi:return Di(e)}}var ir=Object.create,rr=function(){function e(){}return function(t){if(!be(t))return{};if(ir)return ir(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function or(e){return"function"!=typeof e.constructor||fe(e)?{}:rr(wi(e))}var ar="[object Map]";function cr(e){return _(e)&&nt(e)==ar}var lr=Wt&&Wt.isMap,dr=lr?qt(lr):cr,ur="[object Set]";function hr(e){return _(e)&&nt(e)==ur}var fr=Wt&&Wt.isSet,mr=fr?qt(fr):hr,gr=1,pr=2,vr=4,br="[object Arguments]",yr="[object Array]",_r="[object Boolean]",wr="[object Date]",Sr="[object Error]",Ar="[object Function]",xr="[object GeneratorFunction]",$r="[object Map]",Er="[object Number]",jr="[object Object]",Cr="[object RegExp]",kr="[object Set]",Tr="[object String]",Or="[object Symbol]",Nr="[object WeakMap]",Mr="[object ArrayBuffer]",Ir="[object DataView]",Rr="[object Float32Array]",Dr="[object Float64Array]",zr="[object Int8Array]",Lr="[object Int16Array]",Pr="[object Int32Array]",Ur="[object Uint8Array]",Br="[object Uint8ClampedArray]",qr="[object Uint16Array]",Fr="[object Uint32Array]",Hr={};function Gr(e,t,n,s,i,r){var o,a=t&gr,l=t&pr,d=t&vr;if(n&&(o=i?n(e,s,i,r):n(e)),void 0!==o)return o;if(!be(e))return e;var u=c(e);if(u){if(o=Ci(e),!a)return fi(e,o)}else{var h=nt(e),f=h==Ar||h==xr;if(pt(e))return hi(e,a);if(h==jr||h==br||f&&!i){if(o=l||f?{}:or(e),!a)return l?Ai(e,ai(o,e)):yi(e,ni(o,e))}else{if(!Hr[h])return i?e:{};o=sr(e,h,a)}}r||(r=new Js);var m=r.get(e);if(m)return m;r.set(e,o),mr(e)?e.forEach((function(s){o.add(Gr(s,t,n,s,e,r))})):dr(e)&&e.forEach((function(s,i){o.set(i,Gr(s,t,n,i,e,r))}));var g=u?void 0:(d?l?Ei:$i:l?oi:on)(e);return Ys(g||e,(function(s,i){g&&(s=e[i=s]),ei(o,i,Gr(s,t,n,i,e,r))})),o}Hr[br]=Hr[yr]=Hr[Mr]=Hr[Ir]=Hr[_r]=Hr[wr]=Hr[Rr]=Hr[Dr]=Hr[zr]=Hr[Lr]=Hr[Pr]=Hr[$r]=Hr[Er]=Hr[jr]=Hr[Cr]=Hr[kr]=Hr[Tr]=Hr[Or]=Hr[Ur]=Hr[Br]=Hr[qr]=Hr[Fr]=!0,Hr[Sr]=Hr[Ar]=Hr[Nr]=!1;var Wr=1,Vr=4;function Kr(e){return Gr(e,Wr|Vr)}var Jr="[object String]";function Yr(e){return"string"==typeof e||!c(e)&&_(e)&&y(e)==Jr}var Xr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function Qr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Zr(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var eo,to={exports:{}};function no(){return eo||(eo=1,function(e){!function(t){e.exports=t()}((function(){return function e(t,n,s){function i(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof Zr&&Zr;if(!a&&c)return c(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[o]={exports:{}};t[o][0].call(d.exports,(function(e){var n=t[o][1][e];return i(n||e)}),d,d.exports,e,t,n,s)}return n[o].exports}for(var r="function"==typeof Zr&&Zr,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e,t,n){(function(e){var n,s,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var r=0,o=new i(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,n=function(){c.port2.postMessage(0)}}var l=[];function d(){var e,t;s=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}s=!1}function u(e){1!==l.push(e)||s||n()}t.exports=u}).call(this,void 0!==Xr?Xr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var s=e(1);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){s((function(){var s;try{s=t(n)}catch(t){return r.reject(e,t)}s===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,s)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function s(t){n||(n=!0,r.reject(e,t))}function i(t){n||(n=!0,r.resolve(e,t))}function o(){t(i,s)}var a=m(o);"error"===a.status&&s(a.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function g(e){return e instanceof this?e:r.resolve(new this(i),e)}function p(e){var t=new this(i);return r.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,l=new this(i);++c<n;)d(e[c],c);return l;function d(e,i){function c(e){o[i]=e,++a!==n||s||(s=!0,r.resolve(l,o))}t.resolve(e).then(c,(function(e){s||(s=!0,r.reject(l,e))}))}}function b(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(i);++o<n;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){s||(s=!0,r.resolve(a,e))}),(function(e){s||(s=!0,r.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?u(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=m(h,t);if("error"===n.status)return r.reject(e,n.value);var s=n.value;if(s)f(e,s);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},l.resolve=g,l.reject=p,l.all=v,l.race=b},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==Xr?Xr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=r();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function d(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var m="local-forage-detect-blob-support",g=void 0,p={},v=Object.prototype.toString,b="readonly",y="readwrite";function _(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),i=0;i<t;i++)s[i]=e.charCodeAt(i);return n}function w(e){return new l((function(t){var n=e.transaction(m,y),s=c([""]);n.objectStore(m).put(s,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof g?l.resolve(g):w(e).then((function(e){return g=e}))}function A(e){var t=p[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function x(e){var t=p[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function $(e,t){var n=p[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function E(e,t){return new l((function(n,s){if(p[e.name]=p[e.name]||D(),e.db){if(!t)return n(e.db);A(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=o.open.apply(o,i);t&&(r.onupgradeneeded=function(t){var n=r.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(m)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),s(r.error)},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close()},n(t),x(e)}}))}function j(e){return E(e,!1)}function C(e){return E(e,!0)}function k(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,i=e.version>e.db.version;if(s&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function T(e){return new l((function(t,n){var s=new FileReader;s.onerror=n,s.onloadend=function(n){var s=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:s,type:e.type})},s.readAsBinaryString(e)}))}function O(e){return c([_(atob(e.data))],{type:e.type})}function N(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,n=t._initReady().then((function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(n,e,e),n}function I(e){A(e);for(var t=p[e.name],n=t.forages,s=0;s<n.length;s++){var i=n[s];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,j(e).then((function(t){return e.db=t,k(e)?C(e):t})).then((function(s){e.db=t.db=s;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=s})).catch((function(t){throw $(e,t),t}))}function R(e,t,n,s){void 0===s&&(s=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(s>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),C(e)})).then((function(){return I(e).then((function(){R(e,t,n,s-1)}))})).catch(n);n(i)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function z(e){var t=this,n={db:null};if(e)for(var s in e)n[s]=e[s];var i=p[n.name];i||(i=D(),p[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=M);var r=[];function o(){return l.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&r.push(c._initReady().catch(o))}var d=i.forages.slice(0);return l.all(r).then((function(){return n.db=i.db,j(n)})).then((function(e){return n.db=e,k(n,t._defaultConfig.version)?C(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var s=0;s<d.length;s++){var r=d[s];r!==t&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}}))}function L(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){R(n._dbInfo,b,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),N(e)&&(e=O(e)),t(e)},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function P(e,t){var n=this,s=new l((function(t,s){n.ready().then((function(){R(n._dbInfo,b,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var s=n.value;N(s)&&(s=O(s));var i=e(s,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function U(e,t,n){var s=this;e=h(e);var i=new l((function(n,i){var r;s.ready().then((function(){return r=s._dbInfo,"[object Blob]"===v.call(t)?S(r.db).then((function(e){return e?t:T(t)})):t})).then((function(t){R(s._dbInfo,y,(function(r,o){if(r)return i(r);try{var a=o.objectStore(s._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return d(i,n),i}function B(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){R(n._dbInfo,y,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){s(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function q(e){var t=this,n=new l((function(e,n){t.ready().then((function(){R(t._dbInfo,y,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function F(e){var t=this,n=new l((function(e,n){t.ready().then((function(){R(t._dbInfo,b,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function H(e,t){var n=this,s=new l((function(t,s){e<0?t(null):n.ready().then((function(){R(n._dbInfo,b,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){s(c.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,t),s}function G(e){var t=this,n=new l((function(e,n){t.ready().then((function(){R(t._dbInfo,b,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function W(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,i=this;if(e.name){var r=e.name===n.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):j(e).then((function(t){var n=p[e.name],s=n.forages;n.db=t;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=t;return t}));s=e.storeName?r.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;A(e);var s=p[e.name],i=s.forages;t.close();for(var r=0;r<i.length;r++){var a=i[r];a._dbInfo.db=null,a._dbInfo.version=n}var c=new l((function(t,s){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),s(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){s.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,x(n._dbInfo)}})).catch((function(t){throw($(e,t)||l.resolve()).catch((function(){})),t}))}})):r.then((function(t){A(e);var n=p[e.name],s=n.forages;t.close();for(var i=0;i<s.length;i++)s[i]._dbInfo.db=null;var r=new l((function(t,n){var s=o.deleteDatabase(e.name);s.onerror=function(){var e=s.result;e&&e.close(),n(s.error)},s.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},s.onsuccess=function(){var e=s.result;e&&e.close(),t(e)}}));return r.then((function(e){n.db=e;for(var t=0;t<s.length;t++)x(s[t]._dbInfo)})).catch((function(t){throw($(e,t)||l.resolve()).catch((function(){})),t}))}))}else s=l.reject("Invalid arguments");return d(s,t),s}var V={_driver:"asyncStorage",_initStorage:z,_support:a(),iterate:P,getItem:L,setItem:U,removeItem:B,clear:q,length:F,key:H,keys:G,dropInstance:W};function K(){return"function"==typeof openDatabase}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y="~~local_forage_type~",X=/^~~local_forage_type~([^~]+)~/,Q="__lfsc__:",Z=Q.length,ee="arbf",te="blob",ne="si08",se="ui08",ie="uic8",re="si16",oe="si32",ae="ur16",ce="ui32",le="fl32",de="fl64",ue=Z+ee.length,he=Object.prototype.toString;function fe(e){var t,n,s,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=J.indexOf(e[t]),s=J.indexOf(e[t+1]),i=J.indexOf(e[t+2]),r=J.indexOf(e[t+3]),d[c++]=n<<2|s>>4,d[c++]=(15&s)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function me(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=J[n[t]>>2],s+=J[(3&n[t])<<4|n[t+1]>>4],s+=J[(15&n[t+1])<<2|n[t+2]>>6],s+=J[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}function ge(e,t){var n="";if(e&&(n=he.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var s,i=Q;e instanceof ArrayBuffer?(s=e,i+=ee):(s=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=se:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=re:"[object Uint16Array]"===n?i+=ae:"[object Int32Array]"===n?i+=oe:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=le:"[object Float64Array]"===n?i+=de:t(new Error("Failed to get type for BinaryArray"))),t(i+me(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n=Y+e.type+"~"+me(this.result);t(Q+te+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function pe(e){if(e.substring(0,Z)!==Q)return JSON.parse(e);var t,n=e.substring(ue),s=e.substring(Z,ue);if(s===te&&X.test(n)){var i=n.match(X);t=i[1],n=n.substring(i[0].length)}var r=fe(n);switch(s){case ee:return r;case te:return c([r],{type:t});case ne:return new Int8Array(r);case se:return new Uint8Array(r);case ie:return new Uint8ClampedArray(r);case re:return new Int16Array(r);case ae:return new Uint16Array(r);case oe:return new Int32Array(r);case ce:return new Uint32Array(r);case le:return new Float32Array(r);case de:return new Float64Array(r);default:throw new Error("Unkown type: "+s)}}var ve={serialize:ge,deserialize:pe,stringToBuffer:fe,bufferToString:me};function be(e,t,n,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,s)}function ye(e){var t=this,n={db:null};if(e)for(var s in e)n[s]="string"!=typeof e[s]?e[s].toString():e[s];var i=new l((function(e,s){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return s(e)}n.db.transaction((function(i){be(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){s(t)}))}),s)}));return n.serializer=ve,i}function _e(e,t,n,s,i,r){e.executeSql(n,s,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):be(e,t,(function(){e.executeSql(n,s,i,r)}),r)}),r):r(e,o)}),r)}function we(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var s=n.rows.length?n.rows.item(0).value:null;s&&(s=i.serializer.deserialize(s)),t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function Se(e,t){var n=this,s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT * FROM "+i.storeName,[],(function(n,s){for(var r=s.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function Ae(e,t,n,s){var i=this;e=h(e);var r=new l((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(n){_e(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(s>0)return void r(Ae.apply(i,[e,a,n,s-1]));o(t)}}))}))})).catch(o)}));return d(r,n),r}function xe(e,t,n){return Ae.apply(this,[e,t,n,1])}function $e(e,t){var n=this;e=h(e);var s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function Ee(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){_e(t,s,"DELETE FROM "+s.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function je(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){_e(t,s,"SELECT COUNT(key) as c FROM "+s.storeName,[],(function(t,n){var s=n.rows.item(0).c;e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Ce(e,t){var n=this,s=new l((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){_e(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var s=n.rows.length?n.rows.item(0).key:null;t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,t),s}function ke(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){_e(t,s,"SELECT key FROM "+s.storeName,[],(function(t,n){for(var s=[],i=0;i<n.rows.length;i++)s.push(n.rows.item(i).key);e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Te(e){return new l((function(t,n){e.transaction((function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,s){for(var i=[],r=0;r<s.rows.length;r++)i.push(s.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function Oe(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,i=this;return s=e.name?new l((function(t){var s;s=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:s,storeNames:[e.storeName]}):t(Te(s))})).then((function(e){return new l((function(t,n){e.db.transaction((function(s){function i(e){return new l((function(t,n){s.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var r=[],o=0,a=e.storeNames.length;o<a;o++)r.push(i(e.storeNames[o]));l.all(r).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),d(s,t),s}var Ne={_driver:"webSQLStorage",_initStorage:ye,_support:K(),iterate:Se,getItem:we,setItem:xe,removeItem:$e,clear:Ee,length:je,key:Ce,keys:ke,dropInstance:Oe};function Me(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ie(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Re(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function De(){return!Re()||localStorage.length>0}function ze(e){var t=this,n={};if(e)for(var s in e)n[s]=e[s];return n.keyPrefix=Ie(e,t._defaultConfig),De()?(t._dbInfo=n,n.serializer=ve,l.resolve()):l.reject()}function Le(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var s=localStorage.key(n);0===s.indexOf(e)&&localStorage.removeItem(s)}}));return d(n,e),n}function Pe(e,t){var n=this;e=h(e);var s=n.ready().then((function(){var t=n._dbInfo,s=localStorage.getItem(t.keyPrefix+e);return s&&(s=t.serializer.deserialize(s)),s}));return d(s,t),s}function Ue(e,t){var n=this,s=n.ready().then((function(){for(var t=n._dbInfo,s=t.keyPrefix,i=s.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(s)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return d(s,t),s}function Be(e,t){var n=this,s=n.ready().then((function(){var t,s=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(s.keyPrefix.length)),t}));return d(s,t),s}function qe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,s=[],i=0;i<n;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&s.push(r.substring(e.keyPrefix.length))}return s}));return d(n,e),n}function Fe(e){var t=this.keys().then((function(e){return e.length}));return d(t,e),t}function He(e,t){var n=this;e=h(e);var s=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return d(s,t),s}function Ge(e,t,n){var s=this;e=h(e);var i=s.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(i,r){var o=s._dbInfo;o.serializer.serialize(t,(function(t,s){if(s)r(s);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return d(i,n),i}function We(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var s,i=this;return s=e.name?new l((function(t){e.storeName?t(Ie(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),d(s,t),s}var Ve={_driver:"localStorageWrapper",_initStorage:ze,_support:Me(),iterate:Ue,getItem:Pe,setItem:Ge,removeItem:He,clear:Le,length:Fe,key:Be,keys:qe,dropInstance:We},Ke=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Je=function(e,t){for(var n=e.length,s=0;s<n;){if(Ke(e[s],t))return!0;s++}return!1},Ye=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Qe={},Ze={INDEXEDDB:V,WEBSQL:Ne,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),st={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function rt(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ye(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ot=function(){function e(t){for(var n in i(this,e),Ze)if(Ze.hasOwnProperty(n)){var s=Ze[n],r=s._driver;this[n]=r,Xe[r]||this.defineDriver(s)}this._defaultConfig=rt({},st),this._config=rt({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":s(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var s=new l((function(t,n){try{var s=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var r=nt.concat("_initStorage"),o=0,a=r.length;o<a;o++){var c=r[o];if((!Je(tt,c)||e[c])&&"function"!=typeof e[c])return void n(i)}var u=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=l.reject(t);return d(n,arguments[arguments.length-1]),n}},n=0,s=tt.length;n<s;n++){var i=tt[n];e[i]||(e[i]=t(i))}};u();var h=function(n){Xe[s]&&console.info("Redefining LocalForage driver: "+s),Xe[s]=e,Qe[s]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return u(s,t,n),s},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var s=Xe[e]?l.resolve(Xe[e]):l.reject(new Error("Driver not found."));return u(s,t,n),s},e.prototype.getSerializer=function(e){var t=l.resolve(ve);return u(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(n,e,e),n},e.prototype.setDriver=function(e,t,n){var s=this;Ye(e)||(e=[e]);var i=this._getSupportedDrivers(e);function r(){s._config.driver=s.driver()}function o(e){return s._extend(e),r(),s._ready=s._initStorage(s._config),s._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(i).then(o).catch(n)}r();var a=new Error("No available storage method found.");return s._driverSet=l.reject(a),s._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=c.then((function(){var e=i[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then((function(e){s._driver=e._driver,r(),s._wrapLibraryMethodsWithReady(),s._initDriver=a(i)}))})).catch((function(){r();var e=new Error("No available storage method found.");return s._driverSet=l.reject(e),s._driverSet})),u(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Qe[e]},e.prototype._extend=function(e){rt(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,s=e.length;n<s;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)}))}(to)),to.exports}var so=Qr(no());function io(e,t,n){(void 0!==n&&!ps(e[t],n)||void 0===n&&!(t in e))&&Qs(e,t,n)}function ro(e){return function(e,t,n){for(var s=-1,i=Object(e),r=n(e),o=r.length;o--;){var a=r[++s];if(!1===t(i[a],a,i))break}return e}}var oo=ro();function ao(e){return _(e)&&ut(e)}var co="[object Object]",lo=Function.prototype,uo=Object.prototype,ho=lo.toString,fo=uo.hasOwnProperty,mo=ho.call(Object);function go(e){if(!_(e)||y(e)!=co)return!1;var t=wi(e);if(null===t)return!0;var n=fo.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ho.call(n)==mo}function po(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function vo(e){return ti(e,oi(e))}function bo(e,t,n,s,i,r,o){var a=po(e,n),l=po(t,n),d=o.get(l);if(d)io(e,n,d);else{var u=r?r(a,l,n+"",e,t,o):void 0,h=void 0===u;if(h){var f=c(l),m=!f&&pt(l),g=!f&&!m&&Kt(l);u=l,f||m||g?c(a)?u=a:ao(a)?u=fi(a):m?(h=!1,u=hi(l,!0)):g?(h=!1,u=zi(l,!0)):u=[]:go(l)||ct(l)?(u=a,ct(a)?u=vo(a):be(a)&&!Ae(a)||(u=or(l))):h=!1}h&&(o.set(l,u),i(u,l,s,r,o),o.delete(l)),io(e,n,u)}}function yo(e,t,n,s,i){e!==t&&oo(t,(function(r,o){if(i||(i=new Js),be(r))bo(e,t,o,n,yo,s,i);else{var a=s?s(po(e,o),r,o+"",e,t,i):void 0;void 0===a&&(a=r),io(e,o,a)}}),oi)}function _o(e){return e}function wo(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var So=Math.max;function Ao(e,t,n){return t=So(void 0===t?e.length-1:t,0),function(){for(var s=arguments,i=-1,r=So(s.length-t,0),o=Array(r);++i<r;)o[i]=s[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=s[i];return a[t]=n(o),wo(e,this,a)}}function xo(e){return function(){return e}}var $o=Xs?function(e,t){return Xs(e,"toString",{configurable:!0,enumerable:!1,value:xo(t),writable:!0})}:_o,Eo=800,jo=16,Co=Date.now;function ko(e){var t=0,n=0;return function(){var s=Co(),i=jo-(s-n);if(n=s,i>0){if(++t>=Eo)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var To=ko($o);function Oo(e,t){return To(Ao(e,t,_o),e+"")}function No(e,t,n){if(!be(n))return!1;var s=typeof t;return!!("number"==s?ut(n)&&nn(t,n.length):"string"==s&&t in n)&&ps(n[t],e)}function Mo(e){return Oo((function(t,n){var s=-1,i=n.length,r=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(r=e.length>3&&"function"==typeof r?(i--,r):void 0,o&&No(n[0],n[1],o)&&(r=i<3?void 0:r,i=1),t=Object(t);++s<i;){var a=n[s];a&&e(t,a,s,r)}return t}))}var Io=Mo((function(e,t,n){yo(e,t,n)})),Ro=Mo((function(e,t,n,s){yo(e,t,n,s)}));function Do(){const e={isResolved:!1,isPending:!0,isRejected:!1};let t,n=()=>{},s=()=>{};if("function"==typeof Promise.withResolvers){const{promise:e,resolve:i,reject:r}=Promise.withResolvers();t=e,n=i,s=r}else t=new Promise(((e,t)=>{n=e,s=t}));return Object.assign(t,{...e,resolve:n,reject:s}),t.then((e=>(t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e)),(e=>{throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}const zo="Expected a function",Lo=Math.max,Po=Math.min;function Uo(e){if("number"==typeof e)return e;if("string"==typeof e){const t=parseFloat(e);return isNaN(t)?0:t}return 0}function Bo(e){const t=typeof e;return null!=e&&("object"===t||"function"===t)}function qo(e,t,n={}){let s,i,r,o,a,c,l=0,d=!1,u=n.promise?Do():null;if("function"!=typeof e)throw new TypeError(zo);function h(t){const r=s,a=i,c=u;return s=i=void 0,l=t,o=e.apply(a,r),n.promise&&(c.resolve(o),u=Do()),n.promise?c:o}function f(e){return l=e,a=setTimeout(p,t),n.promise?u:o}function m(e){const n=t-(e-c);return d?Po(n,r-(e-l)):n}function g(e){const n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=r}function p(){const e=Date.now();if(g(e))return v(e);a=setTimeout(p,m(e))}function v(e){return a=void 0,s?h(e):(s=i=void 0,n.promise?u:o)}function b(){void 0!==a&&clearTimeout(a),l=0,s=c=i=a=void 0}function y(){return void 0===a?o:v(Date.now())}function _(e,t){if(Array.isArray(e)&&Array.isArray(t))return null!=n&&n.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function w(e){var t;return null!==(t=s)&&void 0!==t&&t.length?e.length?null!=n&&n.concatArrays||null!=n&&n.dedupeArrays?Ro(s,e,_):Io(s,e):s:e||[]}function S(){const e=Date.now(),r=g(e);if(s=w(Array.from(arguments)),i=this,c=e,r){if(void 0===a)return f(c);if(d)return clearTimeout(a),a=setTimeout(p,t),h(c)}return void 0===a&&(a=setTimeout(p,t)),n.promise?u:o}return t=Uo(t)||0,Bo(n)&&(d="maxWait"in n,r=d?Lo(Uo(n.maxWait)||0,t):r),S.cancel=b,S.flush=y,S}function Fo(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function Ho(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function Go(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function Wo(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}}var Vo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ko="~~local_forage_type~",Jo=/^~~local_forage_type~([^~]+)~/,Yo="__lfsc__:",Xo=Yo.length,Qo="arbf",Zo="blob",ea="si08",ta="ui08",na="uic8",sa="si16",ia="si32",ra="ur16",oa="ui32",aa="fl32",ca="fl64",la=Xo+Qo.length,da=Object.prototype.toString;function ua(e){var t,n,s,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=Vo.indexOf(e[t]),s=Vo.indexOf(e[t+1]),i=Vo.indexOf(e[t+2]),r=Vo.indexOf(e[t+3]),d[c++]=n<<2|s>>4,d[c++]=(15&s)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function ha(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=Vo[n[t]>>2],s+=Vo[(3&n[t])<<4|n[t+1]>>4],s+=Vo[(15&n[t+1])<<2|n[t+2]>>6],s+=Vo[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}function fa(e,t){var n="";if(e&&(n=da.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===da.call(e.buffer))){var s,i=Yo;e instanceof ArrayBuffer?(s=e,i+=Qo):(s=e.buffer,"[object Int8Array]"===n?i+=ea:"[object Uint8Array]"===n?i+=ta:"[object Uint8ClampedArray]"===n?i+=na:"[object Int16Array]"===n?i+=sa:"[object Uint16Array]"===n?i+=ra:"[object Int32Array]"===n?i+=ia:"[object Uint32Array]"===n?i+=oa:"[object Float32Array]"===n?i+=aa:"[object Float64Array]"===n?i+=ca:t(new Error("Failed to get type for BinaryArray"))),t(i+ha(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n=Ko+e.type+"~"+ha(this.result);t(Yo+Zo+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function ma(e){if(e.substring(0,Xo)!==Yo)return JSON.parse(e);var t,n=e.substring(la),s=e.substring(Xo,la);if(s===Zo&&Jo.test(n)){var i=n.match(Jo);t=i[1],n=n.substring(i[0].length)}var r=ua(n);switch(s){case Qo:return r;case Zo:return Wo([r],{type:t});case ea:return new Int8Array(r);case ta:return new Uint8Array(r);case na:return new Uint8ClampedArray(r);case sa:return new Int16Array(r);case ra:return new Uint16Array(r);case ia:return new Int32Array(r);case oa:return new Uint32Array(r);case aa:return new Float32Array(r);case ca:return new Float64Array(r);default:throw new Error("Unkown type: "+s)}}var ga={serialize:fa,deserialize:ma};const pa=ga.serialize,va=ga.deserialize;function ba(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}function ya(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const _a={serializer:{serialize:pa,deserialize:va}};function wa(e){if(_a.keyPrefix=ya(e,this._defaultConfig),e)for(const t in e)_a[t]=e[t]}function Sa(e){const t=this.ready().then((function(){const e=_a.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return Fo(t,e),t}function Aa(e,t){e=Go(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(_a.keyPrefix+e);return t&&(t=_a.serializer.deserialize(t)),t}));return Fo(n,t),n}function xa(e,t){const n=this.ready().then((function(){const t=_a.keyPrefix,n=t.length,s=sessionStorage.length;let i=1;for(let r=0;r<s;r++){const s=sessionStorage.key(r);if(0!==s.indexOf(t))continue;let o=sessionStorage.getItem(s);if(o&&(o=_a.serializer.deserialize(o)),o=e(o,s.substring(n),i++),void 0!==o)return o}}));return Fo(n,t),n}function $a(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(_a.keyPrefix.length)),t}));return Fo(n,t),n}function Ea(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(_a.keyPrefix)&&t.push(e.substring(_a.keyPrefix.length))}return t}));return Fo(t,e),t}function ja(e){const t=this.keys().then((function(e){return e.length}));return Fo(t,e),t}function Ca(e,t){e=Go(e);const n=this.ready().then((function(){sessionStorage.removeItem(_a.keyPrefix+e)}));return Fo(n,t),n}async function ka(e,t,n){var s;e=Go(e),await this.ready();const i=t=null!==(s=t)&&void 0!==s?s:null;return _a.serializer.serialize(t,((t,s)=>{if(s)throw s;try{sessionStorage.setItem(_a.keyPrefix+e,t),Fo(Promise.resolve(i),n)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}})),t}function Ta(e,t){if(t=Ho.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let s;return s=e.name?new Promise((function(t){e.storeName?t(ya(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),Fo(s,t),s}const Oa={_driver:"sessionStorageWrapper",_initStorage:wa,_support:ba(),iterate:xa,getItem:Aa,setItem:ka,removeItem:Ca,clear:Sa,length:ja,key:$a,keys:Ea,dropInstance:Ta};var Na,Ma={exports:{}};function Ia(){return Na||(Na=1,function(e,t){!function(e,n){n(t,no())}(0,(function(e,t){function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,n,s){function i(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var r=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),n=i(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];r.push(s(t(c),n(c)))}}else for(var l in e)e.hasOwnProperty(l)&&r.push(s(l,e[l]));return r}function r(e,t,n,r){var o=this,a=o.ready().then((function(){return new Promise((function(s,r){var a,c=o._dbInfo,l=c.db.transaction(c.storeName,"readwrite"),d=l.objectStore(c.storeName);function u(e){var t=e.target||this;a=t.error||t.transaction.error,r(a)}l.oncomplete=function(){s(e)},l.onabort=l.onerror=function(e){r(a||e.target)},i(e,t,n,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=u}))}))}));return s(a,r),a}function o(e,t,r,o){var a=this,c=new Promise((function(s,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var l="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=i(e,t,r,(function(e,t){return new Promise((function(s,i){n.serialize(t,(function(t,n){n?i(n):a.executeSql(l,[e,t],(function(){s()}),(function(e,t){i(t)}))}))}))}));Promise.all(d).then((function(){s(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return s(c,o),c}function a(e,t,n,r){var o=this,a=i(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return s(c,r),c}function c(e,t,n,s){var i=this,c=i.driver();return c===i.INDEXEDDB?r.call(i,e,t,n,s):c===i.WEBSQL?o.call(i,e,t,n,s):a.call(i,e,t,n,s)}function l(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return r.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=l(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=l,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}))}(0,Ma.exports)),Ma.exports}Ma.exports;var Ra=Ia();function Da(e){return Da.result?Da.result:e&&"function"==typeof e.getSerializer?(Da.result=e.getSerializer(),Da.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function za(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function La(e,t){var n=this.getItem(e).then((function(t){return{key:e,value:t}}));return za(n,t),n}function Pa(e){var t=this,n=new Promise((function(n,s){for(var i=[],r=0,o=e.length;r<o;r++)i.push(La.call(t,e[r]));Promise.all(i).then((function(e){for(var t={},s=0,i=e.length;s<i;s++){var r=e[s];t[r.key]=r.value}n(t)})).catch(s)}));return n}function Ua(){var e={};return this.iterate((function(t,n){e[n]=t})).then((function(){return e}))}function Ba(){return"undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0}var qa=Ba();function Fa(e){e=e.slice();var t=this;function n(e,t){return e<t?-1:e>t?1:0}var s=new Promise((function(s,i){t.ready().then((function(){var r,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),c=e.sort(n),l=qa.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(r=a.getAll(l)).onsuccess=function(){var e=r.result;void 0===e&&(e=null),s(e)};else{r=a.openCursor(l);var d={},u=0;r.onsuccess=function(){var e=r.result;if(e){for(var t=e.key;t>c[u];)if(++u===c.length)return void s(d);if(t===c[u]){var n=e.value;void 0===n&&(n=null),d[t]=n,e.continue()}else e.continue(c[u])}else s(d)}}r.onerror=function(){i(r.error)}})).catch(i)}));return s}function Ha(e){var t=this,n=new Promise((function(n,s){t.ready().then((function(){return Da(t)})).then((function(i){var r=t._dbInfo;r.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+r.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var s={},r=t.rows,o=0,a=r.length;o<a;o++){var c=r.item(o),l=c.value;l&&(l=i.deserialize(l)),s[c.key]=l}n(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return n}function Ga(e,t){var n,s=this;if(arguments.length&&null!==e){var i=s.driver();n=i===s.INDEXEDDB?Fa.apply(s,arguments):i===s.WEBSQL?Ha.apply(s,arguments):Pa.apply(s,arguments)}else n=Ua.apply(s);return za(n,t),n}function Wa(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=Ga,t.getItems.indexedDB=function(){return Fa.apply(this,arguments)},t.getItems.websql=function(){return Ha.apply(this,arguments)},t.getItems.generic=function(){return Pa.apply(this,arguments)})}Wa(so);var Va=Object.prototype.hasOwnProperty;function Ka(e,t){return null!=e&&Va.call(e,t)}var Ja=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ya=/^\w*$/;function Xa(e,t){if(c(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!S(e))||Ya.test(e)||!Ja.test(e)||null!=t&&e in Object(t)}var Qa="Expected a function";function Za(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Qa);var n=function(){var s=arguments,i=t?t.apply(this,s):s[0],r=n.cache;if(r.has(i))return r.get(i);var o=e.apply(this,s);return n.cache=r.set(i,o)||r,o};return n.cache=new(Za.Cache||Ws),n}Za.Cache=Ws;var ec=500;function tc(e){var t=Za(e,(function(e){return n.size===ec&&n.clear(),e})),n=t.cache;return t}var nc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,sc=/\\(\\)?/g,ic=tc((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(nc,(function(e,n,s,i){t.push(s?i.replace(sc,"$1"):n||e)})),t}));function rc(e,t){return c(e)?e:Xa(e,t)?[e]:ic(E(e))}function oc(e){if("string"==typeof e||S(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ac(e,t,n){for(var s=-1,i=(t=rc(t,e)).length,r=!1;++s<i;){var o=oc(t[s]);if(!(r=null!=e&&n(e,o)))break;e=e[o]}return r||++s!=i?r:!!(i=null==e?0:e.length)&&dt(i)&&nn(o,i)&&(c(e)||ct(e))}function cc(e,t){return null!=e&&ac(e,t,Ka)}function lc(e,t,n){var s=-1,i=(t=rc(t,e)).length;for(i||(i=1,e=void 0);++s<i;){var r=null==e?void 0:e[oc(t[s])];void 0===r&&(s=i,r=n),e=Ae(r)?r.call(e):r}return e}function dc(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function uc(){return dc()+dc()+"-"+dc()+"-"+dc()+"-"+dc()+"-"+dc()+dc()+dc()}function hc(){const e={isResolved:!1,isPending:!0,isRejected:!1,resolve:null,reject:null},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function fc(){throw new Error('A "url" property or function must be specified')}function mc(e,t){const n=t.error;t.error=function(s){n&&n.call(t.context,e,s,t),e.trigger("error",e,s,t)}}const gc={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function pc(e){const t=lc(e,"browserStorage")||lc(e.collection,"browserStorage");return t?t.sync():vc}function vc(e,t,n={}){let s=n.data;null!=s||!t||"create"!==e&&"update"!==e&&"patch"!==e||(s=n.attrs||t.toJSON());const i={method:gc[e],body:s?JSON.stringify(s):"",success:n.success,error:n.error},r=n.url||lc(t,"url")||fc(),o=n.xhr=fetch(r,i);return t.trigger("request",t,o,{...i,xhr:o}),o}const bc=es;so.defineDriver(ms),Ra.extendPrototype(so),Wa(so);class yc{constructor(e,t,n=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");Yr(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=qo((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)await so.setDriver(Oa._driver);else if("local"===e)await so.config({driver:so.LOCALSTORAGE});else if("in_memory"===e)await so.config({driver:bc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=so,t&&(this.store.debouncedSetItems=qo((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){var e;return null===(e=this.store.debouncedSetItems)||void 0===e?void 0:e.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(){const e=this;async function t(t,n,s){let i,r,o,a;const c=n.collection;["patch","update"].includes(t)&&(a=Kr(n.attributes)),await e.storeInitialized;try{const r=n.attributes;switch(t){case"read":i=void 0!==n.id?await e.find(n):await e.findAll();break;case"create":i=await e.create(n,s);break;case"patch":case"update":s.wait&&(n.attributes=a),o=e.update(n),s.wait&&(n.attributes=r),i=await o;break;case"delete":i=await e.destroy(n,c)}}catch(t){r=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(i){if(s&&s.success){const e="read"===t?i:null;s.success(e,s)}}else r=r||"Record Not Found",s&&s.error&&s.error(r)}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),s=this.getItemName(e.id);return n.includes(s)||n.push(s),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const s={};return s[this.name]=t,s}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),n}}create(e,t){return e.id||(e.id=uc(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);if(null!=e&&e.length){const t=await this.store.getItems(e);return Object.values(t)}return[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}yc.sessionStorageInitialized=so.defineDriver(Oa),yc.localForage=so;var _c=4;function wc(e){return Gr(e,_c)}var Sc=Object.prototype,Ac=Sc.hasOwnProperty,xc=Oo((function(e,t){e=Object(e);var n=-1,s=t.length,i=s>2?t[2]:void 0;for(i&&No(t[0],t[1],i)&&(s=1);++n<s;)for(var r=t[n],o=oi(r),a=-1,c=o.length;++a<c;){var l=o[a],d=e[l];(void 0===d||ps(d,Sc[l])&&!Ac.call(e,l))&&(e[l]=r[l])}return e})),$c="Expected a function";function Ec(e,t,n){if("function"!=typeof e)throw new TypeError($c);return setTimeout((function(){e.apply(void 0,n)}),t)}var jc=Oo((function(e,t){return Ec(e,1,t)}));function Cc(e,t){return e&&oo(e,t,on)}function kc(e,t,n,s){return Cc(e,(function(e,i,r){t(s,n(e),i,r)})),s}function Tc(e,t){return function(n,s){return kc(n,e,t(s),{})}}var Oc=Object.prototype.toString,Nc=Tc((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Oc.call(t)),e[t]=n}),xo(_o)),Mc="__lodash_hash_undefined__";function Ic(e){return this.__data__.set(e,Mc),this}function Rc(e){return this.__data__.has(e)}function Dc(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Ws;++t<n;)this.add(e[t])}function zc(e,t){for(var n=-1,s=null==e?0:e.length;++n<s;)if(t(e[n],n,e))return!0;return!1}function Lc(e,t){return e.has(t)}Dc.prototype.add=Dc.prototype.push=Ic,Dc.prototype.has=Rc;var Pc=1,Uc=2;function Bc(e,t,n,s,i,r){var o=n&Pc,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=r.get(e),d=r.get(t);if(l&&d)return l==t&&d==e;var u=-1,h=!0,f=n&Uc?new Dc:void 0;for(r.set(e,t),r.set(t,e);++u<a;){var m=e[u],g=t[u];if(s)var p=o?s(g,m,u,t,e,r):s(m,g,u,e,t,r);if(void 0!==p){if(p)continue;h=!1;break}if(f){if(!zc(t,(function(e,t){if(!Lc(f,t)&&(m===e||i(m,e,n,s,r)))return f.push(t)}))){h=!1;break}}else if(m!==g&&!i(m,g,n,s,r)){h=!1;break}}return r.delete(e),r.delete(t),h}function qc(e){var t=-1,n=Array(e.size);return e.forEach((function(e,s){n[++t]=[s,e]})),n}function Fc(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var Hc=1,Gc=2,Wc="[object Boolean]",Vc="[object Date]",Kc="[object Error]",Jc="[object Map]",Yc="[object Number]",Xc="[object RegExp]",Qc="[object Set]",Zc="[object String]",el="[object Symbol]",tl="[object ArrayBuffer]",nl="[object DataView]",sl=o?o.prototype:void 0,il=sl?sl.valueOf:void 0;function rl(e,t,n,s,i,r,o){switch(n){case nl:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case tl:return!(e.byteLength!=t.byteLength||!r(new ki(e),new ki(t)));case Wc:case Vc:case Yc:return ps(+e,+t);case Kc:return e.name==t.name&&e.message==t.message;case Xc:case Zc:return e==t+"";case Jc:var a=qc;case Qc:var c=s&Hc;if(a||(a=Fc),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;s|=Gc,o.set(e,t);var d=Bc(a(e),a(t),s,i,r,o);return o.delete(e),d;case el:if(il)return il.call(e)==il.call(t)}return!1}var ol=1,al=Object.prototype.hasOwnProperty;function cl(e,t,n,s,i,r){var o=n&ol,a=$i(e),c=a.length;if(c!=$i(t).length&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in t:al.call(t,d)))return!1}var u=r.get(e),h=r.get(t);if(u&&h)return u==t&&h==e;var f=!0;r.set(e,t),r.set(t,e);for(var m=o;++l<c;){var g=e[d=a[l]],p=t[d];if(s)var v=o?s(p,g,d,t,e,r):s(g,p,d,e,t,r);if(!(void 0===v?g===p||i(g,p,n,s,r):v)){f=!1;break}m||(m="constructor"==d)}if(f&&!m){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(f=!1)}return r.delete(e),r.delete(t),f}var ll=1,dl="[object Arguments]",ul="[object Array]",hl="[object Object]",fl=Object.prototype.hasOwnProperty;function ml(e,t,n,s,i,r){var o=c(e),a=c(t),l=o?ul:nt(e),d=a?ul:nt(t),u=(l=l==dl?hl:l)==hl,h=(d=d==dl?hl:d)==hl,f=l==d;if(f&&pt(e)){if(!pt(t))return!1;o=!0,u=!1}if(f&&!u)return r||(r=new Js),o||Kt(e)?Bc(e,t,n,s,i,r):rl(e,t,l,n,s,i,r);if(!(n&ll)){var m=u&&fl.call(e,"__wrapped__"),g=h&&fl.call(t,"__wrapped__");if(m||g){var p=m?e.value():e,v=g?t.value():t;return r||(r=new Js),i(p,v,n,s,r)}}return!!f&&(r||(r=new Js),cl(e,t,n,s,i,r))}function gl(e,t,n,s,i){return e===t||(null==e||null==t||!_(e)&&!_(t)?e!=e&&t!=t:ml(e,t,n,s,gl,i))}function pl(e,t){return gl(e,t)}var vl=1,bl=2;function yl(e,t,n,s){var i=n.length,r=i;if(null==e)return!r;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<r;){var a=(o=n[i])[0],c=e[a],l=o[1];if(o[2]){if(void 0===c&&!(a in e))return!1}else{var d,u=new Js;if(!(void 0===d?gl(l,c,vl|bl,s,u):d))return!1}}return!0}function _l(e){return e==e&&!be(e)}function wl(e){for(var t=on(e),n=t.length;n--;){var s=t[n],i=e[s];t[n]=[s,i,_l(i)]}return t}function Sl(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}function Al(e){var t=wl(e);return 1==t.length&&t[0][2]?Sl(t[0][0],t[0][1]):function(n){return n===e||yl(n,e,t)}}function xl(e,t){for(var n=0,s=(t=rc(t,e)).length;null!=e&&n<s;)e=e[oc(t[n++])];return n&&n==s?e:void 0}function $l(e,t,n){var s=null==e?void 0:xl(e,t);return void 0===s?n:s}function El(e,t){return null!=e&&t in Object(e)}function jl(e,t){return null!=e&&ac(e,t,El)}var Cl=1,kl=2;function Tl(e,t){return Xa(e)&&_l(t)?Sl(oc(e),t):function(n){var s=$l(n,e);return void 0===s&&s===t?jl(n,e):gl(t,s,Cl|kl)}}function Ol(e){return function(t){return null==t?void 0:t[e]}}function Nl(e){return function(t){return xl(t,e)}}function Ml(e){return Xa(e)?Ol(oc(e)):Nl(e)}function Il(e){return"function"==typeof e?e:null==e?_o:"object"==typeof e?c(e)?Tl(e[0],e[1]):Al(e):Ml(e)}var Rl=1;function Dl(e){return Il("function"==typeof e?e:Gr(e,Rl))}function zl(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function Ll(e,t,n){var s=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var r=Array(i);++s<i;)r[s]=e[s+t];return r}function Pl(e,t){return t.length<2?e:xl(e,Ll(t,0,-1))}function Ul(e,t){return null==(e=Pl(e,t=rc(t,e)))||delete e[oc(zl(t))]}function Bl(e){return go(e)?void 0:e}var ql=o?o.isConcatSpreadable:void 0;function Fl(e){return c(e)||ct(e)||!!(ql&&e&&e[ql])}function Hl(e,t,n,s,i){var r=-1,o=e.length;for(n||(n=Fl),i||(i=[]);++r<o;){var a=e[r];n(a)?_i(i,a):i[i.length]=a}return i}function Gl(e){return null!=e&&e.length?Hl(e):[]}function Wl(e){return To(Ao(e,void 0,Gl),e+"")}var Vl=1,Kl=2,Jl=4,Yl=Wl((function(e,t){var n={};if(null==e)return n;var s=!1;t=a(t,(function(t){return t=rc(t,e),s||(s=t.length>1),t})),ti(e,Ei(e),n),s&&(n=Gr(n,Vl|Kl|Jl,Bl));for(var i=t.length;i--;)Ul(n,t[i]);return n}));function Xl(e,t,n,s){if(!be(e))return e;for(var i=-1,r=(t=rc(t,e)).length,o=r-1,a=e;null!=a&&++i<r;){var c=oc(t[i]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var d=a[c];void 0===(l=void 0)&&(l=be(d)?d:nn(t[i+1])?[]:{})}ei(a,c,l),a=a[c]}return e}function Ql(e,t,n){for(var s=-1,i=t.length,r={};++s<i;){var o=t[s],a=xl(e,o);n(a,o)&&Xl(r,rc(o,e),a)}return r}function Zl(e,t){return Ql(e,t,(function(t,n){return jl(e,n)}))}var ed=Wl((function(e,t){return null==e?{}:Zl(e,t)}));class td extends(In(Object)){constructor(e,t){super();let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=C(this.cidPrefix),this.attributes={},this.validationError=null,t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const s=lc(this,"defaults");n=xc(Object.assign({},s,n),s),this.set(n,t),this.initialize.apply(this,arguments),this.changed={}}set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get idAttribute(){return"id"}get cidPrefix(){return"c"}preinitialize(){}initialize(e,t){}validate(e,t){return""}toJSON(){return wc(this.attributes)}sync(e,t,n){return pc(t)(e,t,n)}get(e){return this.attributes[e]}keys(){return Object.keys(this.attributes)}values(){return Object.values(this.attributes)}pairs(){return this.entries()}entries(){return Object.entries(this.attributes)}invert(){return Nc(this.attributes)}pick(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),ed(this.attributes,e)}omit(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),Yl(this.attributes,e)}isEmpty(){return Qt(this.attributes)}has(e){return null!=this.get(e)}matches(e){return!!Dl(e)(this.attributes)}set(e,t,n){if(null==e)return this;let s;if("object"==typeof e?(s=e,n=t):(s={})[e]=t,n||(n={}),!this._validate(s,n))return!1;const i=n.unset,r=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=wc(this.attributes),this.changed={});const c=this.attributes,l=this.changed,d=this._previousAttributes;for(const e in s)t=s[e],pl(c[e],t)||o.push(e),pl(d[e],t)?delete l[e]:l[e]=t,i?delete c[e]:c[e]=t;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!r){o.length&&(this._pending=n);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],n)}if(a)return this;if(!r)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this}unset(e,t){return this.set(e,void 0,Object.assign({},t,{unset:!0}))}clear(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Object.assign({},e,{unset:!0}))}hasChanged(e){return null==e?!Qt(this.changed):cc(this.changed,e)}changedAttributes(e){if(!e)return!!this.hasChanged()&&wc(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let s;for(const i in e){const r=e[i];pl(t[i],r)||(n[i]=r,s=!0)}return!!s&&n}previous(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null}previousAttributes(){return wc(this._previousAttributes)}fetch(e={}){const t=(e=Object.assign({parse:!0},e)).success;return e.success=n=>{const s=e.parse?this.parse(n,e):n;if(!this.set(s,e))return!1;t&&t.call(e.context,this,n,e),this.trigger("sync",this,n,e)},mc(this,e),this.sync("read",this,e)}save(e,t,n){let s;null==e||"object"==typeof e?(s=e,n=t):(s={})[e]=t;const i=(n=Object.assign({validate:!0,parse:!0},n)).wait,r=n.promise,o=r&&hc();if(s&&!i){if(!this.set(s,n))return!1}else if(!this._validate(s,n))return!1;const a=n.success,c=n.error,l=this.attributes;n.success=e=>{this.attributes=l;let t=n.parse?this.parse(e,n):e;if(i&&(t=Object.assign({},s,t)),t&&!this.set(t,n))return!1;a&&a.call(n.context,this,e,n),this.trigger("sync",this,e,n),r&&o.resolve()},n.error=(e,t,n)=>{c&&c.call(n.context,e,t,n),r&&o.reject(t)},mc(this,n),s&&i&&(this.attributes=Object.assign({},l,s));const d=this.isNew()?"create":n.patch?"patch":"update";"patch"!==d||n.attrs||(n.attrs=s);const u=this.sync(d,this,n);return this.attributes=l,r?o:u}destroy(e){const t=(e=e?wc(e):{}).success,n=e.wait,s=()=>{this.stopListening(),this.trigger("destroy",this,this.collection,e)};e.success=i=>{n&&s(),t&&t.call(e.context,this,i,e),this.isNew()||this.trigger("sync",this,i,e)};let i=!1;return this.isNew()?jc(e.success):(mc(this,e),i=this.sync("delete",this,e)),n||s(),i}url(){const e=lc(this,"urlRoot")||lc(this.collection,"url")||fc();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)}parse(e,t){return e}isNew(){return!this.has(this.idAttribute)}isValid(e){return this._validate({},Object.assign({},e,{validate:!0}))}_validate(e,t){if(!t.validate||!this.validate)return!0;e=Object.assign({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,Object.assign(t,{validationError:n})),!1)}}function nd(e,t,n,s){for(var i=-1,r=null==e?0:e.length;++i<r;){var o=e[i];t(s,o,n(o),e)}return s}function sd(e,t){return function(t,n){if(null==t)return t;if(!ut(t))return e(t,n);for(var s=t.length,i=-1,r=Object(t);++i<s&&!1!==n(r[i],i,r););return t}}var id=sd(Cc);function rd(e,t,n,s){return id(e,(function(e,i,r){t(s,e,n(e),r)})),s}function od(e,t){return function(t,n){var s={};return(c(t)?nd:rd)(t,e,Il(n),s)}}var ad=Object.prototype.hasOwnProperty,cd=od((function(e,t,n){ad.call(e,n)?++e[n]:Qs(e,n,1)})),ld=Object.prototype.hasOwnProperty,dd=od((function(e,t,n){ld.call(e,n)?e[n].push(t):Qs(e,n,[t])})),ud=od((function(e,t,n){Qs(e,n,t)}));function hd(e,t){var n=-1,s=ut(e)?Array(e.length):[];return id(e,(function(e,i,r){s[++n]=t(e,i,r)})),s}function fd(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function md(e,t){if(e!==t){var n=void 0!==e,s=null===e,i=e==e,r=S(e),o=void 0!==t,a=null===t,c=t==t,l=S(t);if(!a&&!l&&!r&&e>t||r&&o&&c&&!a&&!l||s&&o&&c||!n&&c||!i)return 1;if(!s&&!r&&!l&&e<t||l&&n&&i&&!s&&!r||a&&n&&i||!o&&i||!c)return-1}return 0}function gd(e,t,n){for(var s=-1,i=e.criteria,r=t.criteria,o=i.length,a=n.length;++s<o;){var c=md(i[s],r[s]);if(c)return s>=a?c:c*("desc"==n[s]?-1:1)}return e.index-t.index}function pd(e,t,n){t=t.length?a(t,(function(e){return c(e)?function(t){return xl(t,1===e.length?e[0]:e)}:e})):[_o];var s=-1;t=a(t,qt(Il));var i=hd(e,(function(e,n,i){var r=a(t,(function(t){return t(e)}));return{criteria:r,index:++s,value:e}}));return fd(i,(function(e,t){return gd(e,t,n)}))}var vd=Oo((function(e,t){if(null==e)return[];var n=t.length;return n>1&&No(e,t[0],t[1])?t=[]:n>2&&No(t[0],t[1],t[2])&&(t=[t[0]]),pd(e,Hl(t),[])}));const bd=Array.prototype.slice,yd={add:!0,remove:!0,merge:!0},_d={add:!0,remove:!1};class wd extends(In(Object)){constructor(e,t){super(),t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this._model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,Object.assign({silent:!0},t)),this[Symbol.iterator]=this.values}set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get model(){var e;return null!==(e=this._model)&&void 0!==e?e:td}set model(e){this._model=e}get length(){return this.models.length}preinitialize(){}initialize(){}toJSON(e){return this.map((function(t){return t.toJSON(e)}))}sync(e,t,n){return pc(this)(e,t,n)}add(e,t){return this.set(e,Object.assign({merge:!1},t,_d))}remove(e,t){t=Object.assign({},t);const n=!Array.isArray(e),s=n?[e]:e.slice(),i=this._removeModels(s,t);return!t.silent&&i.length&&(t.changes={added:[],merged:[],removed:i},this.trigger("update",this,t)),n?i[0]:i}set(e,t){if(null==e)return;(t=Object.assign({},yd,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!Array.isArray(e);e=n?[e]:e.slice();let s=t.at;null!=s&&(s=+s),s>this.length&&(s=this.length),s<0&&(s+=this.length+1);const i=[],r=[],o=[],a=[],c={},l=t.add,d=t.merge,u=t.remove;let h=!1;const f=this.comparator&&null==s&&!1!==t.sort,m=Yr(this.comparator)?this.comparator:null;let g,p;for(p=0;p<e.length;p++){g=e[p];const n=this.get(g);if(n){if(d&&g!==n){let e=this._isModel(g)?g.attributes:g;t.parse&&(e=n.parse(e,t)),n.set(e,t),o.push(n),f&&!h&&(h=n.hasChanged(m))}c[n.cid]||(c[n.cid]=!0,i.push(n)),e[p]=n}else l&&(g=e[p]=this._prepareModel(g,t),g&&(r.push(g),this._addReference(g,t),c[g.cid]=!0,i.push(g)))}if(u){for(p=0;p<this.length;p++)g=this.models[p],c[g.cid]||a.push(g);a.length&&this._removeModels(a,t)}let v=!1;const b=!f&&l&&u;if(i.length&&b)v=this.length!==i.length||this.models.some(((e,t)=>e!==i[t])),this.models.length=0,this.models.splice(0,0,...i);else if(r.length){f&&(h=!0);let e=null==s?this.length:s;e=Math.min(Math.max(e,0),this.models.length),this.models.splice(e,0,...r)}if(h&&this.sort({silent:!0}),!t.silent){for(p=0;p<r.length;p++)null!=s&&(t.index=s+p),g=r[p],g.trigger("add",g,this,t);(h||v)&&this.trigger("sort",this,t),(r.length||a.length||o.length)&&(t.changes={added:r,removed:a,merged:o},this.trigger("update",this,t))}return n?e[0]:e}async clearStore(e={},t=e=>e){await Promise.all(this.models.filter(t).map((t=>new Promise((n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))))),await this.browserStorage.clear(),this.reset()}reset(e,t){t=t?wc(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,Object.assign({silent:!0},t)),t.silent||this.trigger("reset",this,t),e}push(e,t){return this.add(e,Object.assign({at:this.length},t))}pop(e){const t=this.at(this.length-1);return this.remove(t,e)}unshift(e,t){return this.add(e,Object.assign({at:0},t))}shift(e){const t=this.at(0);return this.remove(t,e)}slice(){return bd.apply(this.models,arguments)}filter(e,t){return this.models.filter(Ae(e)?e:t=>t.matches(e),t)}every(e){return Ae(e)?this.models.map((e=>e.attributes)).every(e):this.models.every((t=>t.matches(e)))}difference(e){return this.models.filter((t=>!e.includes(t)))}max(){return Math.max.apply(Math,this.models)}min(){return Math.min.apply(Math,this.models)}drop(e=1){return this.models.slice(e)}some(e){return Ae(e)?this.models.map((e=>e.attributes)).some(e):this.models.some((t=>t.matches(e)))}sortBy(e){return vd(this.models,Ae(e)?e:t=>Yr(e)?t.get(e):t.matches(e))}isEmpty(){return!this.models.length}keyBy(e){return ud(this.models,e)}each(e,t){return this.forEach(e,t)}forEach(e,t){return this.models.forEach(e,t)}includes(e){return this.models.includes(e)}size(){return this.models.length}countBy(e){return cd(this.models,Ae(e)?e:t=>Yr(e)?t.get(e):t.matches(e))}groupBy(e){return dd(this.models,Ae(e)?e:t=>Yr(e)?t.get(e):t.matches(e))}indexOf(e){return this.models.indexOf(e)}findLastIndex(e,t){return this.models.findLastIndex(Ae(e)?e:t=>Yr(e)?t.get(e):t.matches(e),t)}lastIndexOf(e){return this.models.lastIndexOf(e)}findIndex(e){return this.models.findIndex(Ae(e)?e:t=>Yr(e)?t.get(e):t.matches(e))}last(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0}head(){return this.models[0]}first(){return this.head()}map(e,t){return this.models.map(Ae(e)?e:t=>Yr(e)?t.get(e):t.matches(e),t)}reduce(e,t){return this.models.reduce(e,t||this.models[0])}reduceRight(e,t){return this.models.reduceRight(e,t||this.models[0])}toArray(){return Array.from(this.models)}get(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]}has(e){return null!=this.get(e)}at(e){return e<0&&(e+=this.length),this.models[e]}where(e,t){return this[t?"find":"filter"](e)}findWhere(e){return this.where(e,!0)}find(e,t){const n=Ae(e)?e:t=>t.matches(e);return this.models.find(n,t)}sort(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return Ae(t)&&(t=t.bind(this)),1===n||Yr(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this}pluck(e){return this.map(e+"")}fetch(e){const t=(e=Object.assign({parse:!0},e)).success,n=this,s=e.promise&&hc();return e.success=function(i){const r=e.reset?"reset":"set";n[r](i,e),t&&t.call(e.context,n,i,e),s&&s.resolve(),n.trigger("sync",n,i,e)},mc(this,e),s||this.sync("read",this,e)}create(e,t){const n=(t=t?wc(t):{}).wait,s=t.promise,i=s&&hc();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const r=this,o=t.success,a=t.error;return t.success=function(e,t,a){n&&r.add(e,a),o&&o.call(a.context,e,t,a),s&&i.resolve(e)},t.error=function(e,t,n){a&&a.call(n.context,e,t,n),s&&i.reject(t)},e.save(null,Object.assign(t,{promise:!1})),s?i:e}parse(e,t){return e}modelId(e){var t;return e[(null===(t=this.model.prototype)||void 0===t?void 0:t.idAttribute)||"id"]}values(){return new $d(this,Sd)}keys(){return new $d(this,Ad)}entries(){return new $d(this,xd)}_reset(){this.models=[],this._byId={}}createModel(e,t){return new(0,this.model)(e,t)}_prepareModel(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?wc(t):{}).collection=this;const n=this.createModel(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),null):n}_removeModels(e,t){const n=[];for(let s=0;s<e.length;s++){const i=this.get(e[s]);if(!i)continue;const r=this.indexOf(i);this.models.splice(r,1),delete this._byId[i.cid];const o=this.modelId(i.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=r,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n}_isModel(e){return e instanceof td}_addReference(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)}_removeReference(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)}_onModelEvent(e,t,n,s){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,s),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}}const Sd=1,Ad=2,xd=3;class $d{constructor(e,t){this._collection=e,this._kind=t,this._index=0}next(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===Sd)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===Ad?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}}[Symbol.iterator](){return this}}const Ed={Collection:wd,ElementView:Dn,EventEmitter:In,Model:td,sync:vc},jd="object"==typeof self&&self.self===self&&self||"object"==typeof n.g&&n.g.global===n.g&&n.g;Ed.VERSION="0.0.1";const Cd=jd.Skeletor;Ed.noConflict=function(){return jd.Skeletor=Cd,this},jd.Skeletor=Ed,t.Collection=wd,t.ElementView=Dn,t.EventEmitter=In,t.Model=td,t.Storage=yc,t.default=Ed,t.sync=vc,Object.defineProperty(t,"__esModule",{value:!0})}(t)},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,i&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7983:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7988:function(e,t){!function(n,s){var i=Array.prototype,r=Object.prototype,o=i.slice,a=r.hasOwnProperty,c=i.forEach,l={},d={forEach:function(e,t,n){var s,i,r;if(null!==e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(s=0,i=e.length;s<i;s++)if(s in e&&t.call(n,e[s],s,e)===l)return}else for(r in e)if(a.call(e,r)&&t.call(n,e[r],r,e)===l)return},extend:function(e){return this.forEach(o.call(arguments,1),(function(t){for(var n in t)e[n]=t[n]})),e}},u=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=d.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return u.PF.compile(e||"nplurals=2; plural=(n != 1);")}function f(e,t){this._key=e,this._i18n=t}u.context_delimiter=String.fromCharCode(4),d.extend(f.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?u.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),d.extend(u.prototype,{translate:function(e){return new f(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,s,s,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,s,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,s,t)},ngettext:function(e,t,n){return this.dcnpgettext.call(this,s,s,e,t,n)},dngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,s,t,n,i)},dcngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,s,t,n,i)},pgettext:function(e,t){return this.dcnpgettext.call(this,s,e,t)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,t,n,i){return this.dcnpgettext.call(this,s,e,t,n,i)},dnpgettext:function(e,t,n,s,i){return this.dcnpgettext.call(this,e,t,n,s,i)},dcnpgettext:function(e,t,n,s,i){var r;if(s=s||n,e=e||this._textdomain,!this.options)return(r=new u).dcnpgettext.call(r,void 0,void 0,n,s,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");var o,a,c,l=t?t+u.context_delimiter+n:n,d=this.options.locale_data,f=d[e],m=(d.messages||this.defaults.locale_data.messages)[""],g=f[""].plural_forms||f[""]["Plural-Forms"]||f[""]["plural-forms"]||m.plural_forms||m["Plural-Forms"]||m["plural-forms"];if(void 0===i)c=0;else{if("number"!=typeof i&&(i=parseInt(i,10),isNaN(i)))throw new Error("The number that was passed in is not a number.");c=h(g)(i)}if(!f)throw new Error("No domain named `"+e+"` could be found.");return!(o=f[l])||c>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(l,e),a=[n,s],!0===this.options.debug&&console.log(a[h(g)(i)]),a[h()(i)]):(a=o[c])||(a=[n,s])[h()(i)]}});var m,g,p=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,s){var i,r,o,a,c,l,d,u=1,h=n.length,f="",m=[];for(r=0;r<h;r++)if("string"===(f=e(n[r])))m.push(n[r]);else if("array"===f){if((a=n[r])[2])for(i=s[u],o=0;o<a[2].length;o++){if(!i.hasOwnProperty(a[2][o]))throw p('[sprintf] property "%s" does not exist',a[2][o]);i=i[a[2][o]]}else i=a[1]?s[a[1]]:s[u++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw p("[sprintf] expecting number but found %s",e(i));switch(null==i&&(i=""),a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,l=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",d=a[6]-String(i).length,c=a[6]?t(l,d):"",m.push(a[5]?i+c:c+i)}return m.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],s=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))s.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))s.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){i|=1;var r=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(r.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";r.push(a[1])}n[2]=r}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";s.push(n)}t=t.substring(n[0].length)}return s},n}();u.parse_plural=function(e,t){return e=e.replace(/n/g,t),u.parse_expression(e)},u.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?function(e,t){return t.unshift(e),p.apply(null,t)}(e,[].slice.call(t)):p.apply(this,[].slice.call(arguments))},u.prototype.sprintf=function(){return u.sprintf.apply(this,arguments)},(u.PF={}).parse=function(e){var t=u.PF.extractPluralExpr(e);return u.PF.parser.parse.call(u.PF.parser,t)},u.PF.compile=function(e){var t=u.PF.parse(e);return function(e){return!0===(n=u.PF.interpreter(t)(e))?1:n||0;var n}},u.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return u.PF.interpreter(e.expr)(t);case"TERNARY":return u.PF.interpreter(e.expr)(t)?u.PF.interpreter(e.truthy)(t):u.PF.interpreter(e.falsey)(t);case"OR":return u.PF.interpreter(e.left)(t)||u.PF.interpreter(e.right)(t);case"AND":return u.PF.interpreter(e.left)(t)&&u.PF.interpreter(e.right)(t);case"LT":return u.PF.interpreter(e.left)(t)<u.PF.interpreter(e.right)(t);case"GT":return u.PF.interpreter(e.left)(t)>u.PF.interpreter(e.right)(t);case"LTE":return u.PF.interpreter(e.left)(t)<=u.PF.interpreter(e.right)(t);case"GTE":return u.PF.interpreter(e.left)(t)>=u.PF.interpreter(e.right)(t);case"EQ":return u.PF.interpreter(e.left)(t)==u.PF.interpreter(e.right)(t);case"NEQ":return u.PF.interpreter(e.left)(t)!=u.PF.interpreter(e.right)(t);case"MOD":return u.PF.interpreter(e.left)(t)%u.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},u.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,n=/nplurals\=(\d+);/,s=e.match(n);if(!(s.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(s[1],!((t=(e=e.replace(n,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},u.PF.parser=(m={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,n,s,i,r,o){var a=r.length-1;switch(i){case 1:return{type:"GROUP",expr:r[a-1]};case 2:this.$={type:"TERNARY",expr:r[a-4],truthy:r[a-2],falsey:r[a]};break;case 3:this.$={type:"OR",left:r[a-2],right:r[a]};break;case 4:this.$={type:"AND",left:r[a-2],right:r[a]};break;case 5:this.$={type:"LT",left:r[a-2],right:r[a]};break;case 6:this.$={type:"LTE",left:r[a-2],right:r[a]};break;case 7:this.$={type:"GT",left:r[a-2],right:r[a]};break;case 8:this.$={type:"GTE",left:r[a-2],right:r[a]};break;case 9:this.$={type:"NEQ",left:r[a-2],right:r[a]};break;case 10:this.$={type:"EQ",left:r[a-2],right:r[a]};break;case 11:this.$={type:"MOD",left:r[a-2],right:r[a]};break;case 12:this.$={type:"GROUP",expr:r[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],s=[null],i=[],r=this.table,o="",a=0,c=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;function u(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}i.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,f,m,g,p,v,b,y,_,w,S={};;){if(m=n[n.length-1],this.defaultActions[m]?g=this.defaultActions[m]:(null==h&&(h=u()),g=r[m]&&r[m][h]),void 0===g||!g.length||!g[0]){if(!l){for(v in _=[],r[m])this.terminals_[v]&&v>2&&_.push("'"+this.terminals_[v]+"'");var A="";A=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(A,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:_})}if(3==l){if(1==h)throw new Error(A||"Parsing halted.");c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,h=u()}for(;!(2..toString()in r[m]);){if(0==m)throw new Error(A||"Parsing halted.");w=1,n.length=n.length-2*w,s.length=s.length-w,i.length=i.length-w,m=n[n.length-1]}f=h,h=2,g=r[m=n[n.length-1]]&&r[m][2],l=3}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+h);switch(g[0]){case 1:n.push(h),s.push(this.lexer.yytext),i.push(this.lexer.yylloc),n.push(g[1]),h=null,f?(h=f,f=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,l>0&&l--);break;case 2:if(b=this.productions_[g[1]][1],S.$=s[s.length-b],S._$={first_line:i[i.length-(b||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(b||1)].first_column,last_column:i[i.length-1].last_column},void 0!==(p=this.performAction.call(S,o,c,a,this.yy,g[1],s,i)))return p;b&&(n=n.slice(0,-1*b*2),s=s.slice(0,-1*b),i=i.slice(0,-1*b)),n.push(this.productions_[g[1]][0]),s.push(S.$),i.push(S._$),y=r[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},g=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),s=0;s<n.length;s++)if(e=this._input.match(this.rules[n[s]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,n[s],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,n,s){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}};return e}(),m.lexer=g,m),e.exports&&(t=e.exports=u),t.Jed=u}()},8006:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(1519),i=n(4632),r={blocks:function(e){for(var t=[],n=e.data.length,s=0,r=(0,i.readByte)()(e);0!==r&&r;r=(0,i.readByte)()(e)){if(e.pos+r>=n){var o=n-e.pos;t.push((0,i.readBytes)(o)(e)),s+=o;break}t.push((0,i.readBytes)(r)(e)),s+=r}for(var a=new Uint8Array(s),c=0,l=0;l<t.length;l++)a.set(t[l],c),c+=t[l].length;return a}},o=(0,s.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&249===t[1]})),a=(0,s.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,s.conditional)({lct:(0,i.readArray)(3,(function(e,t,n){return Math.pow(2,n.descriptor.lct.size+1)}))},(function(e,t,n){return n.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},r]}]},(function(e){return 44===(0,i.peekByte)()(e)})),c=(0,s.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(e,t,n){return(0,i.readBytes)(n.text.blockSize)(e)}},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&1===t[1]})),l=(0,s.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(e,t,n){return(0,i.readString)(n.blockSize)(e)}},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&255===t[1]})),d=(0,s.conditional)({comment:[{codes:(0,i.readBytes)(2)},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&254===t[1]})),u=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,s.conditional)({gct:(0,i.readArray)(3,(function(e,t){return Math.pow(2,t.lsd.gct.size+1)}))},(function(e,t){return t.lsd.gct.exists})),{frames:(0,s.loop)([o,l,d,a,c],(function(e){var t=(0,i.peekByte)()(e);return 33===t||44===t}))}];t.default=u},8011:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8083:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8185:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8188:(e,t,n)=>{var s=n(4227).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(t){h=function(e,t,n){return e[t]=n}}function f(e,t,n,s){var i=t&&t.prototype instanceof _?t:_,r=Object.create(i.prototype),o=new M(s||[]);return a(r,"_invoke",{value:k(e,n,o)}),r}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var g="suspendedStart",p="suspendedYield",v="executing",b="completed",y={};function _(){}function w(){}function S(){}var A={};h(A,l,(function(){return this}));var x=Object.getPrototypeOf,$=x&&x(x(I([])));$&&$!==r&&o.call($,l)&&(A=$);var E=S.prototype=_.prototype=Object.create(A);function j(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(i,r,a,c){var l=m(e[i],e,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==s(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(u).then((function(e){d.value=e,a(d)}),(function(e){return n("throw",e,a,c)}))}c(l.arg)}var i;a(this,"_invoke",{value:function(e,s){function r(){return new t((function(t,i){n(e,s,t,i)}))}return i=i?i.then(r,r):r()}})}function k(e,n,s){var i=g;return function(r,o){if(i===v)throw Error("Generator is already running");if(i===b){if("throw"===r)throw o;return{value:t,done:!0}}for(s.method=r,s.arg=o;;){var a=s.delegate;if(a){var c=T(a,s);if(c){if(c===y)continue;return c}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(i===g)throw i=b,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);i=v;var l=m(e,n,s);if("normal"===l.type){if(i=s.done?b:p,l.arg===y)continue;return{value:l.arg,done:s.done}}"throw"===l.type&&(i=b,s.method="throw",s.arg=l.arg)}}}function T(e,n){var s=n.method,i=e.iterator[s];if(i===t)return n.delegate=null,"throw"===s&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),y;var r=m(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function I(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(s(e)+" is not iterable")}return w.prototype=S,a(E,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:w,configurable:!0}),w.displayName=h(S,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,h(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},n.awrap=function(e){return{__await:e}},j(C.prototype),h(C.prototype,d,(function(){return this})),n.AsyncIterator=C,n.async=function(e,t,s,i,r){void 0===r&&(r=Promise);var o=new C(f(e,t,s,i),r);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},j(E),h(E,u,"Generator"),h(E,l,(function(){return this})),h(E,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},n.values=I,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function s(s,i){return a.type="throw",a.arg=e,n.next=s,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r.completion;if("root"===r.tryLoc)return s("end");if(r.tryLoc<=this.prev){var c=o.call(r,"catchLoc"),l=o.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return s(r.catchLoc,!0);if(this.prev<r.finallyLoc)return s(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return s(r.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return s(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&o.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var i=s.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,s){return this.delegate={iterator:I(e),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=t),y}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},8461:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,n,s){function i(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var r=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),n=i(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];r.push(s(t(c),n(c)))}}else for(var l in e)e.hasOwnProperty(l)&&r.push(s(l,e[l]));return r}function r(e,t,n,r){var o=this,a=o.ready().then((function(){return new Promise((function(s,r){var a,c=o._dbInfo,l=c.db.transaction(c.storeName,"readwrite"),d=l.objectStore(c.storeName);function u(e){var t=e.target||this;a=t.error||t.transaction.error,r(a)}l.oncomplete=function(){s(e)},l.onabort=l.onerror=function(e){r(a||e.target)},i(e,t,n,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=u}))}))}));return s(a,r),a}function o(e,t,r,o){var a=this,c=new Promise((function(s,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var l="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=i(e,t,r,(function(e,t){return new Promise((function(s,i){n.serialize(t,(function(t,n){n?i(n):a.executeSql(l,[e,t],(function(){s()}),(function(e,t){i(t)}))}))}))}));Promise.all(d).then((function(){s(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return s(c,o),c}function a(e,t,n,r){var o=this,a=i(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return s(c,r),c}function c(e,t,n,s){var i=this,c=i.driver();return c===i.INDEXEDDB?r.call(i,e,t,n,s):c===i.WEBSQL?o.call(i,e,t,n,s):a.call(i,e,t,n,s)}function l(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return r.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=l(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=l,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(6759))},8555:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8562:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8609:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8610:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8663:(e,t,n)=>{"use strict";var s=n(569);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.getStorage)(),s=!(!n||!n[t]),c=s?n[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},l=c.clear.bind(c),d=c.get.bind(c),u=c.remove.bind(c),h=c.set.bind(c);return{_driver:e,_support:s,_initStorage:function(){return Promise.resolve()},clear:function(e){return(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l(),e&&e();case 2:case"end":return t.stop()}}),t)})))()},iterate:function(e,t){return(0,o.default)(i.default.mark((function n(){var s;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(d,null);case 2:s=n.sent,Object.keys(s).forEach((function(t,n){return e(s[t],t,n)})),t&&t();case 6:case"end":return n.stop()}}),n)})))()},getItem:function(e,t){return(0,o.default)(i.default.mark((function n(){var s;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,a.usePromise)(d,e);case 3:return s=n.sent,s=void 0===(s="string"==typeof e?s[e]:s)?null:s,t&&t(null,s),n.abrupt("return",s);case 10:throw n.prev=10,n.t0=n.catch(0),t&&t(n.t0),n.t0;case 14:case"end":return n.stop()}}),n,null,[[0,10]])})))()},key:function(e,t){return(0,o.default)(i.default.mark((function n(){var s,r;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(d,null);case 2:return s=n.sent,r=Object.keys(s)[e],t&&t(r),n.abrupt("return",r);case 6:case"end":return n.stop()}}),n)})))()},keys:function(e){return(0,o.default)(i.default.mark((function t(){var n,s;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return n=t.sent,s=Object.keys(n),e&&e(s),t.abrupt("return",s);case 6:case"end":return t.stop()}}),t)})))()},length:function(e){return(0,o.default)(i.default.mark((function t(){var n,s,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return n=t.sent,s=Object.keys(n),r=s.length,e&&e(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},removeItem:function(e,t){return(0,o.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(u,e);case 2:t&&t();case 3:case"end":return n.stop()}}),n)})))()},setItem:function(e,t,n){return(0,o.default)(i.default.mark((function s(){return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.usePromise)(h,(0,r.default)({},e,t));case 2:n&&n();case 3:case"end":return s.stop()}}),s)})))()}}};var i=s(n(9467)),r=s(n(4200)),o=s(n(4968)),a=n(4912)},8850:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8853:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8945:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9440:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9442:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9467:(e,t,n)=>{var s=n(8188)();e.exports=s;try{regeneratorRuntime=s}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}},9495:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9569:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9613:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9844:function(e){e.exports=function(){"use strict";return function(e,t){var n=t.prototype,s=n.format;n.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return s.bind(this)(e);var i=this.$utils(),r=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return s.bind(this)(r)}}}()},9845:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9847:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(1943),i=n.n(s),r=n(1133),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(n,s){if(1&s&&(n=this(n)),8&s)return n;if("object"==typeof n&&n){if(4&s&&n.__esModule)return n;if(16&s&&"function"==typeof n.then)return n}var i=Object.create(null);o.r(i);var r={};e=e||[null,t({}),t([]),t(t)];for(var a=2&s&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>n[e]));return r.default=()=>n,o.d(i,r),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>({7:"locales/dayjs/nb-js",131:"locales/dayjs/ar-sa-js",138:"locales/dayjs/tzm-latn-js",221:"locales/vi-LC_MESSAGES-converse-po",290:"locales/nl_BE-LC_MESSAGES-converse-po",345:"locales/el-LC_MESSAGES-converse-po",385:"locales/dayjs/et-js",422:"locales/dayjs/tk-js",453:"locales/fa-LC_MESSAGES-converse-po",507:"locales/mr-LC_MESSAGES-converse-po",528:"locales/ko-LC_MESSAGES-converse-po",548:"locales/tr-LC_MESSAGES-converse-po",561:"locales/dayjs/my-js",591:"locales/dayjs/es-mx-js",598:"locales/dayjs/fa-js",687:"locales/dayjs/ku-js",799:"locales/hi-LC_MESSAGES-converse-po",832:"locales/dayjs/ta-js",861:"locales/dayjs/ar-kw-js",933:"locales/dayjs/eu-js",948:"locales/dayjs/uz-js",962:"locales/ca-LC_MESSAGES-converse-po",1056:"locales/dayjs/mn-js",1072:"locales/dayjs/bg-js",1116:"locales/dayjs/bs-js",1275:"locales/dayjs/nn-js",1373:"locales/dayjs/lb-js",1388:"locales/dayjs/ur-js",1437:"locales/be-LC_MESSAGES-converse-po",1462:"locales/lt-LC_MESSAGES-converse-po",1464:"locales/dayjs/bo-js",1665:"locales/dayjs/en-ie-js",1696:"locales/dayjs/ar-ly-js",1712:"locales/dayjs/hu-js",1719:"locales/dayjs/oc-lnc-js",1827:"locales/dayjs/es-js",1938:"locales/dayjs/bi-js",1963:"locales/ro-LC_MESSAGES-converse-po",1982:"locales/dayjs/sv-js",2014:"locales/dayjs/pt-br-js",2091:"locales/dayjs/ms-js",2168:"locales/eu-LC_MESSAGES-converse-po",2241:"locales/dayjs/hr-js",2366:"locales/dayjs/be-js",2384:"locales/dayjs/he-js",2389:"locales/dayjs/sw-js",2546:"locales/pt-LC_MESSAGES-converse-po",2643:"locales/dayjs/br-js",2664:"locales/dayjs/pa-in-js",2766:"locales/dayjs/cv-js",2769:"locales/dayjs/ss-js",2787:"locales/gl-LC_MESSAGES-converse-po",2856:"locales/dayjs/es-pr-js",2894:"locales/ug-LC_MESSAGES-converse-po",2974:"emojis",2993:"locales/dayjs/dv-js",3014:"locales/dayjs/mt-js",3166:"locales/dayjs/fi-js",3287:"locales/dayjs/km-js",3330:"locales/th-LC_MESSAGES-converse-po",3341:"locales/dayjs/en-sg-js",3359:"locales/dayjs/is-js",3519:"locales/dayjs/rn-js",3613:"locales/fi-LC_MESSAGES-converse-po",3664:"locales/dayjs/sd-js",3683:"locales/dayjs/tzl-js",3698:"locales/fr-LC_MESSAGES-converse-po",3729:"locales/dayjs/mi-js",3731:"locales/dayjs/ug-cn-js",3741:"locales/dayjs/ar-dz-js",3774:"locales/dayjs/vi-js",3881:"locales/ja-LC_MESSAGES-converse-po",4034:"locales/dayjs/it-js",4094:"locales/dayjs/en-gb-js",4107:"locales/dayjs/uk-js",4146:"locales/sq-LC_MESSAGES-converse-po",4182:"locales/dayjs/es-us-js",4202:"locales/es-LC_MESSAGES-converse-po",4260:"locales/dayjs/mr-js",4267:"locales/af-LC_MESSAGES-converse-po",4315:"locales/pt_BR-LC_MESSAGES-converse-po",4333:"locales/dayjs/me-js",4336:"locales/nl-LC_MESSAGES-converse-po",4385:"locales/dayjs/zh-cn-js",4434:"locales/dayjs/ja-js",4497:"locales/dayjs/zh-js",4512:"locales/dayjs/ms-my-js",4523:"locales/dayjs/ka-js",4584:"locales/dayjs/ro-js",4636:"locales/dayjs/te-js",4718:"locales/dayjs/it-ch-js",4749:"locales/id-LC_MESSAGES-converse-po",4770:"locales/dayjs/id-js",4852:"locales/dayjs/hi-js",4858:"locales/dayjs/sr-js",4859:"locales/dayjs/lt-js",4974:"locales/dayjs/kn-js",5036:"locales/dayjs/de-js",5059:"locales/dayjs/mk-js",5283:"locales/ta-LC_MESSAGES-converse-po",5284:"locales/dayjs/gd-js",5534:"locales/dayjs/de-at-js",5611:"locales/dayjs/en-ca-js",5628:"locales/dayjs/af-js",5724:"locales/dayjs/gl-js",5743:"locales/ar-LC_MESSAGES-converse-po",5790:"locales/dayjs/x-pseudo-js",5825:"locales/dayjs/cs-js",5946:"locales/dayjs/ne-js",5970:"locales/dayjs/uz-latn-js",5998:"locales/dayjs/ml-js",6007:"locales/dayjs/ht-js",6042:"locales/dayjs/lo-js",6064:"locales/dayjs/de-ch-js",6109:"locales/it-LC_MESSAGES-converse-po",6121:"locales/dayjs/en-au-js",6124:"locales/dayjs/bn-bd-js",6179:"locales/bg-LC_MESSAGES-converse-po",6191:"locales/dayjs/pt-js",6208:"locales/dayjs/da-js",6311:"locales/de-LC_MESSAGES-converse-po",6343:"locales/dayjs/pl-js",6345:"locales/sv-LC_MESSAGES-converse-po",6486:"locales/dayjs/bm-js",6537:"locales/dayjs/sk-js",6550:"locales/zh_CN-LC_MESSAGES-converse-po",6605:"locales/dayjs/ar-iq-js",6641:"locales/dayjs/kk-js",6655:"locales/dayjs/th-js",6660:"locales/dayjs/sv-fi-js",6733:"locales/ru-LC_MESSAGES-converse-po",6803:"locales/dayjs/yo-js",6824:"locales/dayjs/en-js",6963:"locales/da-LC_MESSAGES-converse-po",7003:"locales/dayjs/cy-js",7013:"locales/dayjs/zh-hk-js",7028:"locales/dayjs/en-in-js",7370:"locales/pl-LC_MESSAGES-converse-po",7385:"locales/dayjs/ar-ma-js",7491:"locales/dayjs/ky-js",7494:"locales/eo-LC_MESSAGES-converse-po",7497:"locales/dayjs/nl-js",7576:"locales/oc-LC_MESSAGES-converse-po",7596:"locales/dayjs/fo-js",7627:"locales/dayjs/en-tt-js",7743:"locales/dayjs/ga-js",7801:"locales/dayjs/ar-tn-js",7806:"locales/dayjs/ru-js",7962:"locales/dayjs/tg-js",7981:"locales/dayjs/zh-tw-js",8022:"locales/dayjs/tl-ph-js",8031:"locales/dayjs/eo-js",8176:"locales/dayjs/rw-js",8178:"locales/dayjs/en-il-js",8227:"locales/he-LC_MESSAGES-converse-po",8232:"locales/dayjs/sl-js",8252:"locales/cs-LC_MESSAGES-converse-po",8343:"locales/dayjs/en-nz-js",8431:"locales/dayjs/fr-js",8443:"locales/dayjs/gu-js",8489:"locales/dayjs/am-js",8592:"locales/dayjs/tet-js",8630:"locales/dayjs/gom-latn-js",8714:"locales/si-LC_MESSAGES-converse-po",8789:"locales/dayjs/ko-js",8880:"locales/dayjs/ar-js",8898:"locales/uk-LC_MESSAGES-converse-po",8945:"locales/dayjs/tlh-js",8986:"locales/zh_TW-LC_MESSAGES-converse-po",9007:"locales/dayjs/jv-js",9052:"locales/dayjs/tzm-js",9080:"locales/dayjs/az-js",9101:"locales/dayjs/fr-ch-js",9109:"locales/dayjs/nl-be-js",9139:"locales/hu-LC_MESSAGES-converse-po",9271:"locales/dayjs/es-do-js",9331:"locales/dayjs/sr-cyrl-js",9395:"locales/dayjs/ca-js",9411:"locales/dayjs/sq-js",9423:"locales/dayjs/bn-js",9547:"locales/dayjs/si-js",9557:"locales/dayjs/tr-js",9562:"locales/nb-LC_MESSAGES-converse-po",9589:"locales/dayjs/hy-am-js",9593:"locales/dayjs/lv-js",9710:"locales/dayjs/fy-js",9782:"locales/dayjs/el-js",9870:"locales/dayjs/fr-ca-js",9975:"locales/dayjs/se-js"}[e]+".js"),o.miniCssF=e=>{},o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},s="converse.js:",o.l=(e,t,i,r)=>{if(n[e])n[e].push(t);else{var a,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==s+i){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",s+i),a.src=e),n[e]=[t];var h=(t,s)=>{a.onerror=a.onload=null,clearTimeout(f);var i=n[e];if(delete n[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(s))),t)return t(s)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="/dist/",(()=>{var e={50:0,6968:0};o.f.j=(t,n)=>{var s=o.o(e,t)?e[t]:void 0;if(0!==s)if(s)n.push(s[2]);else{var i=new Promise(((n,i)=>s=e[t]=[n,i]));n.push(s[2]=i);var r=o.p+o.u(t),a=new Error;o.l(r,(n=>{if(o.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",a.name="ChunkLoadError",a.type=i,a.request=r,s[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var s,i,[r,a,c]=n,l=0;if(r.some((t=>0!==e[t]))){for(s in a)o.o(a,s)&&(o.m[s]=a[s]);if(c)c(o)}for(t&&t(n);l<r.length;l++)i=r[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkconverse_js=self.webpackChunkconverse_js||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.nc=void 0,(()=>{"use strict";const e={},t={plugins:{add(t,n){if(void 0!==e[t])throw new TypeError(`Error: plugin with name "${t}" has already been registered!`);e[t]=n}},initialize:(e={})=>t.load(e).initialize(e),load:(n={})=>(n.assets_path&&(o.p=n.assets_path),o(5299),Object.keys(e).forEach((n=>t.plugins.add(n,e[n]))),t)};window.converse=t;const n=new CustomEvent("converse-loaded",{detail:{converse:t}});window.dispatchEvent(n)})()})();
//# sourceMappingURL=converse.min.js.map